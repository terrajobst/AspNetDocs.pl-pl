---
uid: mvc/overview/older-versions-1/nerddinner/enable-automated-unit-testing
title: Włącz automatyczne testowanie jednostek | Microsoft Docs
author: microsoft
description: Krok 12 pokazuje, jak opracować pakiet zautomatyzowanych testów jednostkowych, które weryfikują funkcje NerdDinner, co zapewni nam zaufanie do wprowadzania zmian...
ms.author: riande
ms.date: 07/27/2010
ms.assetid: a19ff2ce-3f7e-4358-9a51-a1403da9c63e
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/enable-automated-unit-testing
msc.type: authoredcontent
ms.openlocfilehash: 09a7aa186605a6cce48ee94028425ded957c00d3
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 03/06/2020
ms.locfileid: "78541679"
---
# <a name="enable-automated-unit-testing"></a><span data-ttu-id="9d6bf-103">Włączanie automatycznych testów jednostkowych</span><span class="sxs-lookup"><span data-stu-id="9d6bf-103">Enable Automated Unit Testing</span></span>

<span data-ttu-id="9d6bf-104">przez [firmę Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="9d6bf-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="9d6bf-105">Pobierz plik PDF</span><span class="sxs-lookup"><span data-stu-id="9d6bf-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="9d6bf-106">Jest to krok 12 bezpłatnego [samouczka dotyczącego aplikacji "NerdDinner"](introducing-the-nerddinner-tutorial.md) , który zawiera instrukcje tworzenia niewielkiej, ale kompletnej aplikacji sieci Web przy użyciu ASP.NET MVC 1.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-106">This is step 12 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="9d6bf-107">Krok 12 pokazuje, jak opracować pakiet zautomatyzowanych testów jednostkowych, które weryfikują nasze funkcje NerdDinner, dzięki czemu firma Microsoft będzie mieć pewność, że zmiany i usprawnienia aplikacji w przyszłości zostaną wprowadzone.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-107">Step 12 shows how to develop a suite of automated unit tests that verify our NerdDinner functionality, and which will give us the confidence to make changes and improvements to the application in the future.</span></span>
> 
> <span data-ttu-id="9d6bf-108">Jeśli używasz ASP.NET MVC 3, zalecamy użycie [wprowadzenie ze samouczkami ze sklepu MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) lub [MVC](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) .</span><span class="sxs-lookup"><span data-stu-id="9d6bf-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>

## <a name="nerddinner-step-12-unit-testing"></a><span data-ttu-id="9d6bf-109">NerdDinner Krok 12: testowanie jednostkowe</span><span class="sxs-lookup"><span data-stu-id="9d6bf-109">NerdDinner Step 12: Unit Testing</span></span>

<span data-ttu-id="9d6bf-110">Opracowujmy pakiet zautomatyzowanych testów jednostkowych, które weryfikują nasze funkcje NerdDinner, co zapewni nam pewność, że zmienią się i ulepszają aplikacje w przyszłości.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-110">Let's develop a suite of automated unit tests that verify our NerdDinner functionality, and which will give us the confidence to make changes and improvements to the application in the future.</span></span>

### <a name="why-unit-test"></a><span data-ttu-id="9d6bf-111">Dlaczego test jednostkowy?</span><span class="sxs-lookup"><span data-stu-id="9d6bf-111">Why Unit Test?</span></span>

<span data-ttu-id="9d6bf-112">Na dysku do pracy o jeden dzień rano masz nagłe błyskanie inspiracji dotyczącej aplikacji, nad którą pracujesz.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-112">On the drive into work one morning you have a sudden flash of inspiration about an application you are working on.</span></span> <span data-ttu-id="9d6bf-113">Istnieje zmiana, którą można zaimplementować, aby zwiększyć jej wydajność.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-113">You realize there is a change you can implement that will make the application dramatically better.</span></span> <span data-ttu-id="9d6bf-114">Może to być Refaktoryzacja, która czyści kod, dodaje nową funkcję lub naprawia usterkę.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-114">It might be a refactoring that cleans up the code, adds a new feature, or fixes a bug.</span></span>

<span data-ttu-id="9d6bf-115">Pytanie, które ponosisz, gdy przytrzesz do komputera, to "jak bezpiecznie jest to ulepszenie?"</span><span class="sxs-lookup"><span data-stu-id="9d6bf-115">The question that confronts you when you arrive at your computer is – "how safe is it to make this improvement?"</span></span> <span data-ttu-id="9d6bf-116">Co zrobić, jeśli wprowadzanie zmian ma efekty uboczne lub przerywa coś?</span><span class="sxs-lookup"><span data-stu-id="9d6bf-116">What if making the change has side effects or breaks something?</span></span> <span data-ttu-id="9d6bf-117">Ta zmiana może być prosta i trwa tylko kilka minut, ale co zrobić, aby ręcznie przetestować wszystkie scenariusze aplikacji?</span><span class="sxs-lookup"><span data-stu-id="9d6bf-117">The change might be simple and only take a few minutes to implement, but what if it takes hours to manually test out all of the application scenarios?</span></span> <span data-ttu-id="9d6bf-118">Co należy zrobić, jeśli zapomnisz o tym scenariuszu, a uszkodzona aplikacja zacznie działać w środowisku produkcyjnym?</span><span class="sxs-lookup"><span data-stu-id="9d6bf-118">What if you forget to cover a scenario and a broken application goes into production?</span></span> <span data-ttu-id="9d6bf-119">Czy zwiększa to nakład pracy?</span><span class="sxs-lookup"><span data-stu-id="9d6bf-119">Is making this improvement really worth all the effort?</span></span>

<span data-ttu-id="9d6bf-120">Zautomatyzowane testy jednostkowe mogą zapewniać bezpieczeństwo sieci, które umożliwiają ciągłe ulepszanie aplikacji oraz uniknięcie boisz kodu, nad którym pracujesz.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-120">Automated unit tests can provide a safety net that enables you to continually enhance your applications, and avoid being afraid of the code you are working on.</span></span> <span data-ttu-id="9d6bf-121">Dzięki automatycznym testom, które szybko weryfikują funkcje, umożliwiają łatwe zakodowanie i umożliwienie wprowadzenia ulepszeń.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-121">Having automated tests that quickly verify functionality enables you to code with confidence – and empower you to make improvements you might otherwise not have felt comfortable doing.</span></span> <span data-ttu-id="9d6bf-122">Ułatwiają one również tworzenie rozwiązań, które są bardziej utrzymywane i mają dłuższy okres istnienia, co prowadzi do znacznie większego zwrotu z inwestycji.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-122">They also help create solutions that are more maintainable and have a longer lifetime - which leads to a much higher return on investment.</span></span>

<span data-ttu-id="9d6bf-123">Platforma ASP.NET MVC umożliwia łatwe i naturalne działanie aplikacji testów jednostkowych.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-123">The ASP.NET MVC Framework makes it easy and natural to unit test application functionality.</span></span> <span data-ttu-id="9d6bf-124">Umożliwia także przepływ pracy programowania testowego (TDD), który umożliwia tworzenie na podstawie testów w pierwszej kolejności.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-124">It also enables a Test Driven Development (TDD) workflow that enables test-first based development.</span></span>

### <a name="nerddinnertests-project"></a><span data-ttu-id="9d6bf-125">NerdDinner.Tests Project</span><span class="sxs-lookup"><span data-stu-id="9d6bf-125">NerdDinner.Tests Project</span></span>

<span data-ttu-id="9d6bf-126">Po utworzeniu naszej aplikacji NerdDinner na początku tego samouczka zostanie wyświetlony monit z oknem dialogowym z pytaniem, czy chcemy utworzyć projekt testu jednostkowego, aby przejść do projektu aplikacji:</span><span class="sxs-lookup"><span data-stu-id="9d6bf-126">When we created our NerdDinner application at the beginning of this tutorial, we were prompted with a dialog asking whether we wanted to create a unit test project to go along with the application project:</span></span>

![](enable-automated-unit-testing/_static/image1.png)

<span data-ttu-id="9d6bf-127">Pozostawiono przycisk radiowy "tak, Utwórz projekt testu jednostkowego", który spowodował dodanie projektu "NerdDinner. Tests" do naszego rozwiązania:</span><span class="sxs-lookup"><span data-stu-id="9d6bf-127">We kept the "Yes, create a unit test project" radio button selected – which resulted in a "NerdDinner.Tests" project being added to our solution:</span></span>

![](enable-automated-unit-testing/_static/image2.png)

<span data-ttu-id="9d6bf-128">Projekt NerdDinner. Tests odwołuje się do zestawu projektu aplikacji NerdDinner i umożliwia łatwe dodawanie do niego zautomatyzowanych testów, które weryfikują funkcjonalność aplikacji.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-128">The NerdDinner.Tests project references the NerdDinner application project assembly, and enables us to easily add automated tests to it that verify the application functionality.</span></span>

### <a name="creating-unit-tests-for-our-dinner-model-class"></a><span data-ttu-id="9d6bf-129">Tworzenie testów jednostkowych dla naszej klasy modelu obiadu</span><span class="sxs-lookup"><span data-stu-id="9d6bf-129">Creating Unit Tests for our Dinner Model Class</span></span>

<span data-ttu-id="9d6bf-130">Dodajmy kilka testów do naszego projektu NerdDinner. Tests, który weryfikuje klasę obiadu utworzoną podczas tworzenia naszej warstwy modelu.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-130">Let's add some tests to our NerdDinner.Tests project that verify the Dinner class we created when we built our model layer.</span></span>

<span data-ttu-id="9d6bf-131">Zaczniemy od utworzenia nowego folderu w naszym projekcie testowym o nazwie "models", gdzie umieścimy testy związane z modelem.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-131">We'll start by creating a new folder within our test project called "Models" where we'll place our model-related tests.</span></span> <span data-ttu-id="9d6bf-132">Następnie kliknij prawym przyciskiem myszy folder i wybierz polecenie **dodaj&gt;nowego testu** .</span><span class="sxs-lookup"><span data-stu-id="9d6bf-132">We'll then right-click on the folder and choose the **Add-&gt;New Test** menu command.</span></span> <span data-ttu-id="9d6bf-133">Spowoduje to wyświetlenie okna dialogowego "Dodawanie nowego testu".</span><span class="sxs-lookup"><span data-stu-id="9d6bf-133">This will bring up the "Add New Test" dialog.</span></span>

<span data-ttu-id="9d6bf-134">Utworzymy "test jednostkowy" i nadaj mu nazwę "DinnerTest.cs":</span><span class="sxs-lookup"><span data-stu-id="9d6bf-134">We'll choose to create a "Unit Test" and name it "DinnerTest.cs":</span></span>

![](enable-automated-unit-testing/_static/image3.png)

<span data-ttu-id="9d6bf-135">Po kliknięciu przycisku "OK" program Visual Studio doda (i otworzy) plik DinnerTest.cs do projektu:</span><span class="sxs-lookup"><span data-stu-id="9d6bf-135">When we click the "ok" button Visual Studio will add (and open) a DinnerTest.cs file to the project:</span></span>

![](enable-automated-unit-testing/_static/image4.png)

<span data-ttu-id="9d6bf-136">Domyślny szablon testu jednostkowego programu Visual Studio zawiera wiele kodów płyt kotłów w tym samym czasie.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-136">The default Visual Studio unit test template has a bunch of boiler-plate code within it that I find a little messy.</span></span> <span data-ttu-id="9d6bf-137">Wyczyśćmy go, aby dokładnie zawierał Poniższy kod:</span><span class="sxs-lookup"><span data-stu-id="9d6bf-137">Let's clean it up to just contain the code below:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample1.cs)]

<span data-ttu-id="9d6bf-138">Atrybut [TestClass] w powyższej klasie DinnerTest identyfikuje go jako klasę, która będzie zawierać testy, a także opcjonalne inicjalizacje testu i kod usuwania.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-138">The [TestClass] attribute on the DinnerTest class above identifies it as a class that will contain tests, as well as optional test initialization and teardown code.</span></span> <span data-ttu-id="9d6bf-139">Możemy definiować testy w ramach tego programu, dodając do nich metody publiczne, które mają atrybut [TestMethod].</span><span class="sxs-lookup"><span data-stu-id="9d6bf-139">We can define tests within it by adding public methods that have a [TestMethod] attribute on them.</span></span>

<span data-ttu-id="9d6bf-140">Poniżej znajdują się pierwsze dwa testy, które dodamy do naszej klasy obiadu.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-140">Below are the first of two tests we'll add that exercise our Dinner class.</span></span> <span data-ttu-id="9d6bf-141">Pierwszy test sprawdza, czy nasz obiad jest nieprawidłowy, jeśli zostanie utworzony nowy obiad bez poprawnego ustawiania wszystkich właściwości.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-141">The first test verifies that our Dinner is invalid if a new Dinner is created without all properties being set correctly.</span></span> <span data-ttu-id="9d6bf-142">Drugi test sprawdza, czy nasz obiad jest ważny, gdy kolacja ma wszystkie właściwości ustawione z prawidłowymi wartościami:</span><span class="sxs-lookup"><span data-stu-id="9d6bf-142">The second test verifies that our Dinner is valid when a Dinner has all properties set with valid values:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample2.cs)]

<span data-ttu-id="9d6bf-143">Należy zauważyć, że nasze nazwy testów są bardzo jawne (i nieco pełne).</span><span class="sxs-lookup"><span data-stu-id="9d6bf-143">You'll notice above that our test names are very explicit (and somewhat verbose).</span></span> <span data-ttu-id="9d6bf-144">Możemy to zrobić, ponieważ możemy utworzyć setki lub tysiące małych testów i chcemy ułatwić szybkie ustalenie założeń i zachowań dla każdego z nich (zwłaszcza w przypadku przeszukiwania listy błędów w module uruchamiającego testy).</span><span class="sxs-lookup"><span data-stu-id="9d6bf-144">We are doing this because we might end up creating hundreds or thousands of small tests, and we want to make it easy to quickly determine the intent and behavior of each of them (especially when we are looking through a list of failures in a test runner).</span></span> <span data-ttu-id="9d6bf-145">Nazwy testów należy nazwać po testowaniu funkcji.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-145">The test names should be named after the functionality they are testing.</span></span> <span data-ttu-id="9d6bf-146">W powyższym przypadku użyto wzorca nazewnictwa "rzeczownik\_powinien\_".</span><span class="sxs-lookup"><span data-stu-id="9d6bf-146">Above we are using a "Noun\_Should\_Verb" naming pattern.</span></span>

<span data-ttu-id="9d6bf-147">Prowadzimy do tworzenia struktury testów przy użyciu wzorca testowania "AAA" — który oznacza "porządkowanie, działanie, potwierdzenie":</span><span class="sxs-lookup"><span data-stu-id="9d6bf-147">We are structuring the tests using the "AAA" testing pattern – which stands for "Arrange, Act, Assert":</span></span>

- <span data-ttu-id="9d6bf-148">Rozmieść: konfiguruje testowaną jednostkę</span><span class="sxs-lookup"><span data-stu-id="9d6bf-148">Arrange: Setup the unit being tested</span></span>
- <span data-ttu-id="9d6bf-149">Działanie: wykonywanie testu i wyników przechwytywania</span><span class="sxs-lookup"><span data-stu-id="9d6bf-149">Act: Exercise the unit under test and capture results</span></span>
- <span data-ttu-id="9d6bf-150">Potwierdzenie: sprawdzenie zachowania</span><span class="sxs-lookup"><span data-stu-id="9d6bf-150">Assert: Verify the behavior</span></span>

<span data-ttu-id="9d6bf-151">Podczas pisania testów, które chcemy uniknąć, że poszczególne testy są zbyt duże.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-151">When we write tests we want to avoid having the individual tests do too much.</span></span> <span data-ttu-id="9d6bf-152">Zamiast tego każdy test powinien weryfikować tylko pojedyncze koncepcje (co znacznie ułatwia identyfikowanie przyczyn błędów).</span><span class="sxs-lookup"><span data-stu-id="9d6bf-152">Instead each test should verify only a single concept (which will make it much easier to pinpoint the cause of failures).</span></span> <span data-ttu-id="9d6bf-153">Dobrym warunkiem jest wypróbowanie i posiadanie tylko jednej instrukcji Assert dla każdego testu.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-153">A good guideline is to try and only have a single assert statement for each test.</span></span> <span data-ttu-id="9d6bf-154">Jeśli masz więcej niż jedną instrukcję Assert w metodzie testowej, upewnij się, że są one używane do testowania tego samego pojęcia.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-154">If you have more than one assert statement in a test method, make sure they are all being used to test the same concept.</span></span> <span data-ttu-id="9d6bf-155">W razie wątpliwości wykonaj inny test.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-155">When in doubt, make another test.</span></span>

### <a name="running-tests"></a><span data-ttu-id="9d6bf-156">Uruchamianie testów</span><span class="sxs-lookup"><span data-stu-id="9d6bf-156">Running Tests</span></span>

<span data-ttu-id="9d6bf-157">Program Visual Studio 2008 Professional (i nowsze wersje) zawiera wbudowany moduł uruchamiający testy, który może służyć do uruchamiania projektów testów jednostkowych programu Visual Studio w środowisku IDE.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-157">Visual Studio 2008 Professional (and higher editions) includes a built-in test runner that can be used to run Visual Studio Unit Test projects within the IDE.</span></span> <span data-ttu-id="9d6bf-158">Aby uruchomić wszystkie testy jednostkowe, możemy wybrać polecenie **test-&gt;Run-&gt;wszystkie testy w rozwiązaniu** .</span><span class="sxs-lookup"><span data-stu-id="9d6bf-158">We can select the **Test-&gt;Run-&gt;All Tests in Solution** menu command (or type Ctrl R, A) to run all of our unit tests.</span></span> <span data-ttu-id="9d6bf-159">Alternatywnie możemy umieścić kursor w ramach konkretnej klasy testowej lub metody testowej, a następnie użyć **test-&gt;Run-&gt;testy w bieżącym menu kontekstowym** (lub wpisać Ctrl R, t), aby uruchomić podzestaw testów jednostkowych.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-159">Or alternatively we can position our cursor within a specific test class or test method and use the **Test-&gt;Run-&gt;Tests in Current Context** menu command (or type Ctrl R, T) to run a subset of the unit tests.</span></span>

<span data-ttu-id="9d6bf-160">Umieść kursor w klasie DinnerTest i wpisz ciąg "Ctrl R, T", aby uruchomić dwa testy, które właśnie zostały zdefiniowane.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-160">Let's position our cursor within the DinnerTest class and type "Ctrl R, T" to run the two tests we just defined.</span></span> <span data-ttu-id="9d6bf-161">Gdy to zrobisz, okno "Wyniki testów" pojawi się w programie Visual Studio i zobaczymy wyniki naszego przebiegu testu w ramach tego elementu:</span><span class="sxs-lookup"><span data-stu-id="9d6bf-161">When we do this a "Test Results" window will appear within Visual Studio and we'll see the results of our test run listed within it:</span></span>

![](enable-automated-unit-testing/_static/image5.png)

<span data-ttu-id="9d6bf-162">*Uwaga: w oknie wyników testów programu VS nie jest domyślnie wyświetlana kolumna Nazwa klasy. Możesz to zrobić, klikając prawym przyciskiem myszy w oknie Wyniki testów i korzystając z menu Dodaj/Usuń kolumny.*</span><span class="sxs-lookup"><span data-stu-id="9d6bf-162">*Note: The VS test results window does not show the Class Name column by default. You can add this by right-clicking within the Test Results window and using the Add/Remove Columns menu command.*</span></span>

<span data-ttu-id="9d6bf-163">Nasze dwa testy miały tylko część sekundową do uruchomienia — i są widoczne w obu przypadkach.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-163">Our two tests took only a fraction of a second to run – and as you can see they both passed.</span></span> <span data-ttu-id="9d6bf-164">Możemy teraz przejść i rozszerzyć je przez utworzenie dodatkowych testów, które weryfikują określone walidacje reguł, a także obejmują dwie metody pomocnika-IsUserHost () i IsUserRegistered () — dodawane do klasy obiadu.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-164">We can now go on and augment them by creating additional tests that verify specific rule validations, as well as cover the two helper methods - IsUserHost() and IsUserRegistered() – that we added to the Dinner class.</span></span> <span data-ttu-id="9d6bf-165">Wszystkie te testy dla klasy obiadu znacznie ułatwiają i bezpiecznie dodają do nich nowe reguły biznesowe oraz ich walidacje.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-165">Having all these tests in place for the Dinner class will make it much easier and safer to add new business rules and validations to it in the future.</span></span> <span data-ttu-id="9d6bf-166">Możemy dodać nową logikę reguł do obiadu, a następnie w ciągu kilku sekund Sprawdź, czy nie zainstalowano żadnej z poprzednich funkcji logiki.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-166">We can add our new rule logic to Dinner, and then within seconds verify that it hasn't broken any of our previous logic functionality.</span></span>

<span data-ttu-id="9d6bf-167">Zwróć uwagę, jak za pomocą opisowej nazwy testu ułatwić szybkie zapoznanie się z każdym testem.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-167">Notice how using a descriptive test name makes it easy to quickly understand what each test is verifying.</span></span> <span data-ttu-id="9d6bf-168">Zaleca się użycie polecenia **Narzędzia-&gt;opcje** menu, otwarcie ekranu narzędzia testowe —&gt;konfiguracja wykonywania testu, a zaznaczenie pola wyboru "podwójna kliknięcie wyniku testu jednostkowego zakończonego niepowodzeniem lub niejednoznacznego spowoduje wyświetlenie punktu awarii w teście".</span><span class="sxs-lookup"><span data-stu-id="9d6bf-168">I recommend using the **Tools-&gt;Options** menu command, opening the Test Tools-&gt;Test Execution configuration screen, and checking the "Double-clicking a failed or inconclusive unit test result displays the point of failure in the test" checkbox.</span></span> <span data-ttu-id="9d6bf-169">Umożliwi to dwukrotne kliknięcie błędu w oknie wyników testu i natychmiastowe przechodzenie do błędu potwierdzenia.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-169">This will allow you to double-click on a failure in the test results window and jump immediately to the assert failure.</span></span>

### <a name="creating-dinnerscontroller-unit-tests"></a><span data-ttu-id="9d6bf-170">Tworzenie testów jednostkowych DinnersController</span><span class="sxs-lookup"><span data-stu-id="9d6bf-170">Creating DinnersController Unit Tests</span></span>

<span data-ttu-id="9d6bf-171">Utwórzmy teraz testy jednostkowe, które weryfikują funkcje DinnersController.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-171">Let's now create some unit tests that verify our DinnersController functionality.</span></span> <span data-ttu-id="9d6bf-172">Rozpocznie się po kliknięciu prawym przyciskiem myszy folderu "controllers" w naszym projekcie testowym, a następnie wybierz polecenie **Add-&gt;New test** menu.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-172">We'll start by right-clicking on the "Controllers" folder within our Test project and then choose the **Add-&gt;New Test** menu command.</span></span> <span data-ttu-id="9d6bf-173">Utworzymy "test jednostkowy" i nadaj mu nazwę "DinnersControllerTest.cs".</span><span class="sxs-lookup"><span data-stu-id="9d6bf-173">We'll create a "Unit Test" and name it "DinnersControllerTest.cs".</span></span>

<span data-ttu-id="9d6bf-174">Utworzymy dwie metody testowe, które weryfikują metodę Action () na DinnersController.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-174">We'll create two test methods that verify the Details() action method on the DinnersController.</span></span> <span data-ttu-id="9d6bf-175">Pierwsza z nich sprawdzi, czy widok jest zwracany po zażądaniu istniejącego obiadu.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-175">The first will verify that a View is returned when an existing Dinner is requested.</span></span> <span data-ttu-id="9d6bf-176">Drugi sprawdzi, czy widok "NotFound" jest zwracany, gdy zażądano nieistniejącego obiadu:</span><span class="sxs-lookup"><span data-stu-id="9d6bf-176">The second will verify that a "NotFound" view is returned when a non-existent Dinner is requested:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample3.cs)]

<span data-ttu-id="9d6bf-177">Powyższy kod kompiluje czysty.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-177">The above code compiles clean.</span></span> <span data-ttu-id="9d6bf-178">Gdy uruchamiamy testy, to oba z nich kończą się niepowodzeniem:</span><span class="sxs-lookup"><span data-stu-id="9d6bf-178">When we run the tests, though, they both fail:</span></span>

![](enable-automated-unit-testing/_static/image6.png)

<span data-ttu-id="9d6bf-179">Jeśli przejdziesz do komunikatów o błędach, zobaczymy, że przyczyna niepowodzenia testów była spowodowana tym, że nasze klasy DinnersRepository nie mogły nawiązać połączenia z bazą danych.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-179">If we look at the error messages, we'll see that the reason the tests failed was because our DinnersRepository class was unable to connect to a database.</span></span> <span data-ttu-id="9d6bf-180">Nasza aplikacja NerdDinner korzysta z parametrów połączenia do lokalnego pliku SQL Server Express, który znajduje się w katalogu \app\_danych projektu aplikacji NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-180">Our NerdDinner application is using a connection-string to a local SQL Server Express file which lives under the \App\_Data directory of the NerdDinner application project.</span></span> <span data-ttu-id="9d6bf-181">Ponieważ nasze projekty NerdDinner. Tests kompilują i uruchamiają się w innym katalogu, projekt aplikacji, lokalizacja ścieżki względnej naszego ciągu połączenia jest niepoprawna.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-181">Because our NerdDinner.Tests project compiles and runs in a different directory then the application project, the relative path location of our connection-string is incorrect.</span></span>

<span data-ttu-id="9d6bf-182">Możemy *rozwiązać* ten problem, kopiując plik bazy danych SQL Express do naszego projektu testowego, a następnie Dodaj do niego odpowiednie parametry połączenia testowego w pliku App. config naszego projektu testowego.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-182">We *could* fix this by copying the SQL Express database file to our test project, and then add an appropriate test connection-string to it in the App.config of our test project.</span></span> <span data-ttu-id="9d6bf-183">Powyższe testy zostaną odblokowane i uruchomione.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-183">This would get the above tests unblocked and running.</span></span>

<span data-ttu-id="9d6bf-184">Kod testu jednostkowego korzystający z rzeczywistej bazy danych, mimo że oferuje mu wiele wyzwań.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-184">Unit testing code using a real database, though, brings with it a number of challenges.</span></span> <span data-ttu-id="9d6bf-185">Są to:</span><span class="sxs-lookup"><span data-stu-id="9d6bf-185">Specifically:</span></span>

- <span data-ttu-id="9d6bf-186">Znacznie spowalnia czas wykonywania testów jednostkowych.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-186">It significantly slows down the execution time of unit tests.</span></span> <span data-ttu-id="9d6bf-187">Im dłużej trwa uruchamianie testów, tym mniej najprawdopodobniej są one wykonywane często.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-187">The longer it takes to run tests, the less likely you are to execute them frequently.</span></span> <span data-ttu-id="9d6bf-188">Najlepiej, aby testy jednostkowe mogły być uruchamiane w ciągu kilku sekund — i mieć coś, co w przypadku kompilowania projektu.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-188">Ideally you want your unit tests to be able to be run in seconds – and have it be something you do as naturally as compiling the project.</span></span>
- <span data-ttu-id="9d6bf-189">Powoduje to skomplikowanie logiki instalacji i czyszczenia w ramach testów.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-189">It complicates the setup and cleanup logic within tests.</span></span> <span data-ttu-id="9d6bf-190">Każdy test jednostkowy ma być odizolowany i niezależny od innych (bez efektów ubocznych ani zależności).</span><span class="sxs-lookup"><span data-stu-id="9d6bf-190">You want each unit test to be isolated and independent of others (with no side effects or dependencies).</span></span> <span data-ttu-id="9d6bf-191">Podczas pracy z rzeczywistą bazą danych należy mieć na uwadze stan i zresetować ją między testami.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-191">When working against a real database you have to be mindful of state and reset it between tests.</span></span>

<span data-ttu-id="9d6bf-192">Przyjrzyjmy się wzorowi projektu o nazwie "iniekcja zależności", który może pomóc nam w obejść te problemy i uniknąć konieczności używania rzeczywistej bazy danych z naszymi testami.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-192">Let's look at a design pattern called "dependency injection" that can help us work around these issues and avoid the need to use a real database with our tests.</span></span>

### <a name="dependency-injection"></a><span data-ttu-id="9d6bf-193">Wstrzykiwanie zależności</span><span class="sxs-lookup"><span data-stu-id="9d6bf-193">Dependency Injection</span></span>

<span data-ttu-id="9d6bf-194">Teraz DinnersController jest ściśle "sprzężone" z klasą DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-194">Right now DinnersController is tightly "coupled" to the DinnerRepository class.</span></span> <span data-ttu-id="9d6bf-195">"Sprzęganie" odnosi się do sytuacji, w której Klasa jawnie opiera się na innej klasie w celu pracy:</span><span class="sxs-lookup"><span data-stu-id="9d6bf-195">"Coupling" refers to a situation where a class explicitly relies on another class in order to work:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample4.cs)]

<span data-ttu-id="9d6bf-196">Ponieważ Klasa DinnerRepository wymaga dostępu do bazy danych, ściśle sprzężona zależność klasy DinnersController ma na DinnerRepository, co pozwala na przetestowanie metod akcji DinnersController.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-196">Because the DinnerRepository class requires access to a database, the tightly coupled dependency the DinnersController class has on the DinnerRepository ends up requiring us to have a database in order for the DinnersController action methods to be tested.</span></span>

<span data-ttu-id="9d6bf-197">Można to zrobić, wykorzystując Wzorzec projektowy nazywany "iniekcją zależności", który jest podejściem, w którym zależności (takie jak klasy repozytorium, które zapewniają dostęp do danych), nie są już niejawnie tworzone w ramach klas, które z nich korzystają.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-197">We can get around this by employing a design pattern called "dependency injection" – which is an approach where dependencies (like repository classes that provide data access) are no longer implicitly created within classes that use them.</span></span> <span data-ttu-id="9d6bf-198">Zamiast tego zależności mogą być jawnie przekazane do klasy, która używa ich przy użyciu argumentów konstruktora.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-198">Instead, dependencies can be explicitly passed to the class that uses them using constructor arguments.</span></span> <span data-ttu-id="9d6bf-199">Jeśli zależności są zdefiniowane przy użyciu interfejsów, zapewniamy elastyczność przekazywania "fałszywych" implementacji zależności dla scenariuszy testów jednostkowych.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-199">If the dependencies are defined using interfaces, we then have the flexibility to pass in "fake" dependency implementations for unit test scenarios.</span></span> <span data-ttu-id="9d6bf-200">Dzięki temu możemy tworzyć specyficzne dla testów implementacje zależne, które nie wymagają dostępu do bazy danych.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-200">This enables us to create test-specific dependency implementations that do not actually require access to a database.</span></span>

<span data-ttu-id="9d6bf-201">Aby zobaczyć to w działaniu, zaimplementujmy iniekcję zależności z naszymi DinnersController.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-201">To see this in action, let's implement dependency injection with our DinnersController.</span></span>

#### <a name="extracting-an-idinnerrepository-interface"></a><span data-ttu-id="9d6bf-202">Wyodrębnianie interfejsu IDinnerRepository</span><span class="sxs-lookup"><span data-stu-id="9d6bf-202">Extracting an IDinnerRepository interface</span></span>

<span data-ttu-id="9d6bf-203">Pierwszym krokiem jest utworzenie nowego interfejsu IDinnerRepository, który hermetyzuje kontrakt repozytorium wymagane przez naszych kontrolerów do pobierania i aktualizowania obiadów.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-203">Our first step will be to create a new IDinnerRepository interface that encapsulates the repository contract our controllers require to retrieve and update Dinners.</span></span>

<span data-ttu-id="9d6bf-204">Możemy zdefiniować ten kontrakt interfejsu ręcznie, klikając prawym przyciskiem myszy folder \Models, a następnie wybierając polecenie menu **&gt;Dodaj nowy element** i tworząc nowy interfejs o nazwie IDinnerRepository.cs.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-204">We can define this interface contract manually by right-clicking on the \Models folder, and then choosing the **Add-&gt;New Item** menu command and creating a new interface named IDinnerRepository.cs.</span></span>

<span data-ttu-id="9d6bf-205">Alternatywnie możemy użyć narzędzi refaktoryzacji wbudowanych Visual Studio Professional (i wyższych) do automatycznego wyodrębniania i tworzenia interfejsu dla nas z istniejącej klasy DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-205">Alternatively we can use the refactoring tools built-into Visual Studio Professional (and higher editions) to automatically extract and create an interface for us from our existing DinnerRepository class.</span></span> <span data-ttu-id="9d6bf-206">Aby wyodrębnić ten interfejs przy użyciu programu VS, po prostu umieść kursor w edytorze tekstu na klasie DinnerRepository, a następnie kliknij prawym przyciskiem myszy i wybierz polecenie **&gt;"Wyodrębnij interfejs menu interfejsu** :</span><span class="sxs-lookup"><span data-stu-id="9d6bf-206">To extract this interface using VS, simply position the cursor in the text editor on the DinnerRepository class, and then right-click and choose the **Refactor-&gt;Extract Interface** menu command:</span></span>

![](enable-automated-unit-testing/_static/image7.png)

<span data-ttu-id="9d6bf-207">Spowoduje to uruchomienie okna dialogowego "wyodrębnienie interfejsu" i wyświetlenie monitu o podanie nazwy interfejsu do utworzenia.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-207">This will launch the "Extract Interface" dialog and prompt us for the name of the interface to create.</span></span> <span data-ttu-id="9d6bf-208">Zostanie ona domyślnie IDinnerRepository i automatycznie wybierze wszystkie metody publiczne z istniejącej klasy DinnerRepository w celu dodania do interfejsu:</span><span class="sxs-lookup"><span data-stu-id="9d6bf-208">It will default to IDinnerRepository and automatically select all public methods on the existing DinnerRepository class to add to the interface:</span></span>

![](enable-automated-unit-testing/_static/image8.png)

<span data-ttu-id="9d6bf-209">Po kliknięciu przycisku "OK" program Visual Studio doda do naszej aplikacji nowy interfejs IDinnerRepository:</span><span class="sxs-lookup"><span data-stu-id="9d6bf-209">When we click the "ok" button, Visual Studio will add a new IDinnerRepository interface to our application:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample5.cs)]

<span data-ttu-id="9d6bf-210">I istniejąca Klasa DinnerRepository zostanie zaktualizowana w celu zaimplementowania interfejsu:</span><span class="sxs-lookup"><span data-stu-id="9d6bf-210">And our existing DinnerRepository class will be updated so that it implements the interface:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample6.cs)]

#### <a name="updating-dinnerscontroller-to-support-constructor-injection"></a><span data-ttu-id="9d6bf-211">Aktualizowanie DinnersController na potrzeby obsługi iniekcji konstruktorów</span><span class="sxs-lookup"><span data-stu-id="9d6bf-211">Updating DinnersController to support constructor injection</span></span>

<span data-ttu-id="9d6bf-212">Teraz zaktualizujemy klasę DinnersController, aby korzystała z nowego interfejsu.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-212">We'll now update the DinnersController class to use the new interface.</span></span>

<span data-ttu-id="9d6bf-213">Obecnie DinnersController jest zakodowana w taki sposób, że pole "dinnerRepository" zawsze jest klasą DinnerRepository:</span><span class="sxs-lookup"><span data-stu-id="9d6bf-213">Currently DinnersController is hard-coded such that its "dinnerRepository" field is always a DinnerRepository class:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample7.cs)]

<span data-ttu-id="9d6bf-214">Zmienimy ją tak, aby pole "dinnerRepository" było typu IDinnerRepository zamiast DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-214">We'll change it so that the "dinnerRepository" field is of type IDinnerRepository instead of DinnerRepository.</span></span> <span data-ttu-id="9d6bf-215">Następnie dodamy dwa publiczne konstruktory DinnersController.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-215">We'll then add two public DinnersController constructors.</span></span> <span data-ttu-id="9d6bf-216">Jeden z konstruktorów umożliwia przekazanie IDinnerRepository jako argumentu.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-216">One of the constructors allows an IDinnerRepository to be passed as an argument.</span></span> <span data-ttu-id="9d6bf-217">Drugi jest konstruktorem domyślnym, który używa naszej istniejącej implementacji DinnerRepository:</span><span class="sxs-lookup"><span data-stu-id="9d6bf-217">The other is a default constructor that uses our existing DinnerRepository implementation:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample8.cs)]

<span data-ttu-id="9d6bf-218">Ponieważ ASP.NET MVC domyślnie tworzy klasy kontrolerów przy użyciu konstruktorów domyślnych, nasze DinnersController w środowisku uruchomieniowym nadal będzie używać klasy DinnerRepository do wykonywania dostępu do danych.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-218">Because ASP.NET MVC by default creates controller classes using default constructors, our DinnersController at runtime will continue to use the DinnerRepository class to perform data access.</span></span>

<span data-ttu-id="9d6bf-219">Teraz możemy zaktualizować nasze testy jednostkowe, aby przekazać "fałszywą" implementację repozytorium obiadu przy użyciu konstruktora parametrów.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-219">We can now update our unit tests, though, to pass in a "fake" dinner repository implementation using the parameter constructor.</span></span> <span data-ttu-id="9d6bf-220">To "fałszywe" repozytorium obiadu nie będzie wymagało dostępu do rzeczywistej bazy danych, a zamiast tego będzie używać danych przykładowych w pamięci.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-220">This "fake" dinner repository will not require access to a real database, and instead will use in-memory sample data.</span></span>

#### <a name="creating-the-fakedinnerrepository-class"></a><span data-ttu-id="9d6bf-221">Tworzenie klasy FakeDinnerRepository</span><span class="sxs-lookup"><span data-stu-id="9d6bf-221">Creating the FakeDinnerRepository class</span></span>

<span data-ttu-id="9d6bf-222">Utwórzmy klasę FakeDinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-222">Let's create a FakeDinnerRepository class.</span></span>

<span data-ttu-id="9d6bf-223">Zaczniemy od utworzenia katalogu "sztuczne" w projekcie NerdDinner. Tests, a następnie dodania do niego nowej klasy FakeDinnerRepository (kliknij prawym przyciskiem myszy folder i wybierz polecenie **Dodaj-&gt;nową klasę**):</span><span class="sxs-lookup"><span data-stu-id="9d6bf-223">We'll begin by creating a "Fakes" directory within our NerdDinner.Tests project and then add a new FakeDinnerRepository class to it (right-click on the folder and choose **Add-&gt;New Class**):</span></span>

![](enable-automated-unit-testing/_static/image9.png)

<span data-ttu-id="9d6bf-224">Zaktualizujemy kod, tak aby Klasa FakeDinnerRepository implementuje interfejs IDinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-224">We'll update the code so that the FakeDinnerRepository class implements the IDinnerRepository interface.</span></span> <span data-ttu-id="9d6bf-225">Następnie możemy kliknąć prawym przyciskiem myszy i wybrać polecenie menu kontekstowego "Implementuj interfejs IDinnerRepository":</span><span class="sxs-lookup"><span data-stu-id="9d6bf-225">We can then right-click on it and choose the "Implement interface IDinnerRepository" context menu command:</span></span>

![](enable-automated-unit-testing/_static/image10.png)

<span data-ttu-id="9d6bf-226">Spowoduje to, że program Visual Studio automatycznie doda wszystkie elementy członkowskie interfejsu IDinnerRepository do klasy FakeDinnerRepository z domyślnymi implementacjami "szczątkowego":</span><span class="sxs-lookup"><span data-stu-id="9d6bf-226">This will cause Visual Studio to automatically add all of the IDinnerRepository interface members to our FakeDinnerRepository class with default "stub out" implementations:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample9.cs)]

<span data-ttu-id="9d6bf-227">Następnie możemy zaktualizować implementację FakeDinnerRepository, aby mogła zostać wykorzystana z listy znajdującej się w pamięci&lt;obiad&gt; przekazanej do niego jako argument konstruktora:</span><span class="sxs-lookup"><span data-stu-id="9d6bf-227">We can then update the FakeDinnerRepository implementation to work off of an in-memory List&lt;Dinner&gt; collection passed to it as a constructor argument:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample10.cs)]

<span data-ttu-id="9d6bf-228">Mamy teraz fałszywą implementację IDinnerRepository, która nie wymaga bazy danych, i można w zamian wprowadzić ją na liście obiektów obiadu znajdujących się w pamięci.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-228">We now have a fake IDinnerRepository implementation that does not require a database, and can instead work off an in-memory list of Dinner objects.</span></span>

#### <a name="using-the-fakedinnerrepository-with-unit-tests"></a><span data-ttu-id="9d6bf-229">Używanie FakeDinnerRepository z testami jednostkowymi</span><span class="sxs-lookup"><span data-stu-id="9d6bf-229">Using the FakeDinnerRepository with Unit Tests</span></span>

<span data-ttu-id="9d6bf-230">Wróćmy do testów jednostkowych DinnersController, które nie powiodły się wcześniej, ponieważ baza danych nie była dostępna.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-230">Let's return to the DinnersController unit tests that failed earlier because the database wasn't available.</span></span> <span data-ttu-id="9d6bf-231">Możemy zaktualizować metody testowe, aby użyć FakeDinnerRepository wypełnionego przykładowymi danymi obiadu w pamięci do DinnersController przy użyciu poniższego kodu:</span><span class="sxs-lookup"><span data-stu-id="9d6bf-231">We can update the test methods to use a FakeDinnerRepository populated with sample in-memory Dinner data to the DinnersController using the code below:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample11.cs)]

<span data-ttu-id="9d6bf-232">Teraz, gdy uruchomimy te testy w obu przebiegach:</span><span class="sxs-lookup"><span data-stu-id="9d6bf-232">And now when we run these tests they both pass:</span></span>

![](enable-automated-unit-testing/_static/image11.png)

<span data-ttu-id="9d6bf-233">Najlepszym rozwiązaniem jest użycie tylko części sekundy do uruchomienia i nie wymaga skomplikowanej logiki instalacji/oczyszczania.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-233">Best of all, they take only a fraction of a second to run, and do not require any complicated setup/cleanup logic.</span></span> <span data-ttu-id="9d6bf-234">Możemy teraz testować jednostkowo cały kod metody akcji DinnersController (w tym wyświetlanie, stronicowanie, szczegóły, tworzenie, aktualizowanie i usuwanie) bez konieczności nawiązywania połączenia z rzeczywistą bazą danych.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-234">We can now unit test all of our DinnersController action method code (including listing, paging, details, create, update and delete) without ever needing to connect to a real database.</span></span>

| <span data-ttu-id="9d6bf-235">**Temat boczny: struktury iniekcji zależności**</span><span class="sxs-lookup"><span data-stu-id="9d6bf-235">**Side Topic: Dependency Injection Frameworks**</span></span> |
| --- |
| <span data-ttu-id="9d6bf-236">Ręczne wstrzyknięcie zależności (na przykład powyżej) działa prawidłowo, ale staje się trudniejsze do utrzymania w miarę zwiększania liczby zależności i składników w aplikacji.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-236">Performing manual dependency injection (like we are above) works fine, but does become harder to maintain as the number of dependencies and components in an application increases.</span></span> <span data-ttu-id="9d6bf-237">Istnieje kilka struktur iniekcji zależności dla platformy .NET, które mogą pomóc zapewnić jeszcze większą elastyczność zarządzania zależnościami.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-237">Several dependency injection frameworks exist for .NET that can help provide even more dependency management flexibility.</span></span> <span data-ttu-id="9d6bf-238">Te struktury, czasami nazywane kontenerami "Inversion of Control" (IoC), zapewniają mechanizmy, które umożliwiają obsługę dodatkowego poziomu konfiguracji do określania i przekazywania zależności do obiektów w czasie wykonywania (najczęściej przy użyciu iniekcji konstruktorów ).</span><span class="sxs-lookup"><span data-stu-id="9d6bf-238">These frameworks, also sometimes called "Inversion of Control" (IoC) containers, provide mechanisms that enable an additional level of configuration support for specifying and passing dependencies to objects at runtime (most often using constructor injection).</span></span> <span data-ttu-id="9d6bf-239">Niektóre z najpopularniejszych struktur iniekcji/IOC w programie .NET obejmują: AutoFac, Ninject, Spring.NET, StructureMap i Windsor.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-239">Some of the more popular OSS Dependency Injection / IOC frameworks in .NET include: AutoFac, Ninject, Spring.NET, StructureMap, and Windsor.</span></span> <span data-ttu-id="9d6bf-240">ASP.NET MVC uwidacznia interfejsy API rozszerzalności, które umożliwiają deweloperom uczestnictwo w rozwiązywaniu i tworzeniu wystąpień kontrolerów, co pozwala na czystą integrację funkcji iniekcji/IoC w ramach tego procesu.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-240">ASP.NET MVC exposes extensibility APIs that enable developers to participate in the resolution and instantiation of controllers, and which enables Dependency Injection / IoC frameworks to be cleanly integrated within this process.</span></span> <span data-ttu-id="9d6bf-241">Przy użyciu platformy DI/IOC można również usunąć konstruktora domyślnego z naszego DinnersController — spowoduje to całkowite usunięcie sprzężenia między nim i DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-241">Using a DI/IOC framework would also enable us to remove the default constructor from our DinnersController – which would completely remove the coupling between it and the DinnerRepository.</span></span> <span data-ttu-id="9d6bf-242">Nie będziemy używać platformy iniekcji/IOC z naszą aplikacją NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-242">We won't be using a dependency injection / IOC framework with our NerdDinner application.</span></span> <span data-ttu-id="9d6bf-243">Jest to jednak coś, co możemy wziąć pod uwagę w przyszłości, jeśli NerdDinner kod — podstawowy i możliwości.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-243">But it is something we could consider for the future if the NerdDinner code-base and capabilities grew.</span></span> |

### <a name="creating-edit-action-unit-tests"></a><span data-ttu-id="9d6bf-244">Tworzenie testów jednostkowych akcji edycji</span><span class="sxs-lookup"><span data-stu-id="9d6bf-244">Creating Edit Action Unit Tests</span></span>

<span data-ttu-id="9d6bf-245">Utwórz teraz testy jednostkowe, które weryfikują funkcje edycji DinnersController.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-245">Let's now create some unit tests that verify the Edit functionality of the DinnersController.</span></span> <span data-ttu-id="9d6bf-246">Zaczniemy od przetestowania wersji HTTP-GET operacji edycji:</span><span class="sxs-lookup"><span data-stu-id="9d6bf-246">We'll start by testing the HTTP-GET version of our Edit action:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample12.cs)]

<span data-ttu-id="9d6bf-247">Utworzymy test, który sprawdza, czy widok, którego kopia zapasowa jest obiektem DinnerFormViewModel, jest renderowany z powrotem po zażądaniu prawidłowego obiadu:</span><span class="sxs-lookup"><span data-stu-id="9d6bf-247">We'll create a test that verifies that a View backed by a DinnerFormViewModel object is rendered back when a valid dinner is requested:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample13.cs)]

<span data-ttu-id="9d6bf-248">Gdy uruchamiamy test, okaże się, że nie powiedzie się, ponieważ wyjątek odwołania o wartości null jest generowany, gdy metoda Edytuj uzyskuje dostęp do właściwości User.Identity.Name w celu wykonania sprawdzenia obiadu. IsHostedBy ().</span><span class="sxs-lookup"><span data-stu-id="9d6bf-248">When we run the test, though, we'll find that it fails because a null reference exception is thrown when the Edit method accesses the User.Identity.Name property to perform the Dinner.IsHostedBy() check.</span></span>

<span data-ttu-id="9d6bf-249">Obiekt User w klasie bazowej kontrolera hermetyzuje szczegóły dotyczące zalogowanego użytkownika i jest wypełniany przez ASP.NET MVC, gdy tworzy kontroler w czasie wykonywania.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-249">The User object on the Controller base class encapsulates details about the logged-in user, and is populated by ASP.NET MVC when it creates the controller at runtime.</span></span> <span data-ttu-id="9d6bf-250">Ponieważ testujemy DinnersController poza środowiskiem serwera sieci Web, obiekt User nie jest ustawiony (w związku z tym wyjątek odwołania o wartości null).</span><span class="sxs-lookup"><span data-stu-id="9d6bf-250">Because we are testing the DinnersController outside of a web-server environment, the User object isn't set (hence the null reference exception).</span></span>

### <a name="mocking-the-useridentityname-property"></a><span data-ttu-id="9d6bf-251">Imitacja właściwości User.Identity.Name</span><span class="sxs-lookup"><span data-stu-id="9d6bf-251">Mocking the User.Identity.Name property</span></span>

<span data-ttu-id="9d6bf-252">Tworzenie struktur ułatwia testowanie dzięki umożliwieniu nam dynamicznego tworzenia fałszywych wersji obiektów zależnych, które obsługują nasze testy.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-252">Mocking frameworks make testing easier by enabling us to dynamically create fake versions of dependent objects that support our tests.</span></span> <span data-ttu-id="9d6bf-253">Na przykład możemy użyć struktury imitacji w naszym teście edycji akcji, aby dynamicznie utworzyć obiekt użytkownika, którego nasza DinnersController może użyć do wyszukiwania symulowanej nazwy użytkownika.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-253">For example, we can use a mocking framework in our Edit action test to dynamically create a User object that our DinnersController can use to lookup a simulated username.</span></span> <span data-ttu-id="9d6bf-254">Spowoduje to uniknięcie zgłoszenia pustego odwołania podczas wykonywania testu.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-254">This will avoid a null reference from being thrown when we run our test.</span></span>

<span data-ttu-id="9d6bf-255">Istnieje wiele struktur szkieletowych platformy .NET, które mogą być używane z ASP.NET MVC (w tym miejscu można zobaczyć listę poniżej: [http://www.mockframeworks.com/](http://www.mockframeworks.com/)).</span><span class="sxs-lookup"><span data-stu-id="9d6bf-255">There are many .NET mocking frameworks that can be used with ASP.NET MVC (you can see a list of them here: [http://www.mockframeworks.com/](http://www.mockframeworks.com/)).</span></span> <span data-ttu-id="9d6bf-256">W celu przetestowania naszej aplikacji NerdDinner będziemy używać struktury "MOQ" o nazwie "open source", którą można pobrać bezpłatnie z [http://www.mockframeworks.com/moq](http://www.mockframeworks.com/moq).</span><span class="sxs-lookup"><span data-stu-id="9d6bf-256">For testing our NerdDinner application we'll use an open source mocking framework called "Moq", which can be downloaded for free from [http://www.mockframeworks.com/moq](http://www.mockframeworks.com/moq).</span></span>

<span data-ttu-id="9d6bf-257">Po pobraniu należy dodać odwołanie w naszym projekcie NerdDinner. Tests do zestawu MOQ. dll:</span><span class="sxs-lookup"><span data-stu-id="9d6bf-257">Once downloaded, we'll add a reference in our NerdDinner.Tests project to the Moq.dll assembly:</span></span>

![](enable-automated-unit-testing/_static/image12.png)

<span data-ttu-id="9d6bf-258">Następnie dodamy metodę pomocnika "CreateDinnersControllerAs (username)" do klasy testowej, która przyjmuje nazwę użytkownika jako parametr, a następnie "imitacje" właściwości User.Identity.Name w wystąpieniu DinnersController:</span><span class="sxs-lookup"><span data-stu-id="9d6bf-258">We'll then add a "CreateDinnersControllerAs(username)" helper method to our test class that takes a username as a parameter, and which then "mocks" the User.Identity.Name property on the DinnersController instance:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample14.cs)]

<span data-ttu-id="9d6bf-259">Powyżej korzystamy z MOQ do utworzenia obiektu przypominającego, który jest obiektem ControllerContext (który jest przekazywanym przez ASP.NET MVC do klas kontrolera, aby uwidocznić obiekty środowiska uruchomieniowego, takie jak użytkownik, żądanie, odpowiedź i sesja).</span><span class="sxs-lookup"><span data-stu-id="9d6bf-259">Above we are using Moq to create a Mock object that fakes a ControllerContext object (which is what ASP.NET MVC passes to Controller classes to expose runtime objects like User, Request, Response, and Session).</span></span> <span data-ttu-id="9d6bf-260">Wywołujemy metodę "SetupGet" na potrzeby makiety, aby wskazać, że Właściwość HttpContext.User.Identity.Name w ControllerContext powinna zwracać ciąg username, który został przesłany do metody pomocnika.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-260">We are calling the "SetupGet" method on the Mock to indicate that the HttpContext.User.Identity.Name property on ControllerContext should return the username string we passed to the helper method.</span></span>

<span data-ttu-id="9d6bf-261">Możemy zasymulować dowolną liczbę właściwości i metod ControllerContext.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-261">We can mock any number of ControllerContext properties and methods.</span></span> <span data-ttu-id="9d6bf-262">Aby zilustrować to, dodaliśmy również wywołanie SetupGet () dla właściwości Request. IsAuthenticated (która nie jest w rzeczywistości wymagana dla testów poniżej, ale które ułatwiają zilustrowanie sposobu tworzenia właściwości żądania).</span><span class="sxs-lookup"><span data-stu-id="9d6bf-262">To illustrate this I've also added a SetupGet() call for the Request.IsAuthenticated property (which isn't actually needed for the tests below – but which helps illustrate how you can mock Request properties).</span></span> <span data-ttu-id="9d6bf-263">Po wykonaniu tych czynności przypiszemy wystąpienie makiety ControllerContext do DinnersController metody pomocnika.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-263">When we are done we assign an instance of the ControllerContext mock to the DinnersController our helper method returns.</span></span>

<span data-ttu-id="9d6bf-264">Teraz możemy napisać testy jednostkowe, które używają tej metody pomocnika do testowania scenariuszy edycji obejmujących różnych użytkowników:</span><span class="sxs-lookup"><span data-stu-id="9d6bf-264">We can now write unit tests that use this helper method to test Edit scenarios involving different users:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample15.cs)]

<span data-ttu-id="9d6bf-265">Teraz, gdy uruchamiamy testy, które przechodzą:</span><span class="sxs-lookup"><span data-stu-id="9d6bf-265">And now when we run the tests they pass:</span></span>

![](enable-automated-unit-testing/_static/image13.png)

### <a name="testing-updatemodel-scenarios"></a><span data-ttu-id="9d6bf-266">Testowanie scenariuszy UpdateModel ()</span><span class="sxs-lookup"><span data-stu-id="9d6bf-266">Testing UpdateModel() scenarios</span></span>

<span data-ttu-id="9d6bf-267">Utworzyliśmy testy, które obejmują wersję HTTP-GET akcji edycji.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-267">We've created tests that cover the HTTP-GET version of the Edit action.</span></span> <span data-ttu-id="9d6bf-268">Teraz Utwórz kilka testów, które weryfikują wersję HTTP-POST akcji Edytuj:</span><span class="sxs-lookup"><span data-stu-id="9d6bf-268">Let's now create some tests that verify the HTTP-POST version of the Edit action:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample16.cs)]

<span data-ttu-id="9d6bf-269">Interesujący nowy scenariusz testowania dla nas do obsługi tej metody działania jest jego użycie metody pomocnika UpdateModel () w klasie podstawowej kontrolera.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-269">The interesting new testing scenario for us to support with this action method is its usage of the UpdateModel() helper method on the Controller base class.</span></span> <span data-ttu-id="9d6bf-270">Używamy tej metody pomocnika do powiązania wartości formularza post z naszym wystąpieniem obiektu obiadu.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-270">We are using this helper method to bind form-post values to our Dinner object instance.</span></span>

<span data-ttu-id="9d6bf-271">Poniżej znajdują się dwa testy, które pokazują, w jaki sposób możemy dostarczyć wartości z formularza dla metody pomocnika UpdateModel () do użycia.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-271">Below are two tests that demonstrates how we can supply form posted values for the UpdateModel() helper method to use.</span></span> <span data-ttu-id="9d6bf-272">W tym celu należy utworzyć i wypełnić obiekt FormCollection, a następnie przypisać go do właściwości "ValueProvider" na kontrolerze.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-272">We'll do this by creating and populating a FormCollection object, and then assign it to the "ValueProvider" property on the Controller.</span></span>

<span data-ttu-id="9d6bf-273">Pierwszy test weryfikuje, że po pomyślnym zapisaniu przeglądarka zostanie przekierowana do akcji szczegóły.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-273">The first test verifies that on a successful save the browser is redirected to the details action.</span></span> <span data-ttu-id="9d6bf-274">Drugi test weryfikuje, że po opublikowaniu nieprawidłowych danych wejściowych Akcja ponownie wyświetla widok edycji z komunikatem o błędzie.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-274">The second test verifies that when invalid input is posted the action redisplays the edit view again with an error message.</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample17.cs)]

### <a name="testing-wrap-up"></a><span data-ttu-id="9d6bf-275">Zawinięcie testów</span><span class="sxs-lookup"><span data-stu-id="9d6bf-275">Testing Wrap-Up</span></span>

<span data-ttu-id="9d6bf-276">Zostały omówione podstawowe koncepcje związane z klasami kontrolera testów jednostkowych.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-276">We've covered the core concepts involved in unit testing controller classes.</span></span> <span data-ttu-id="9d6bf-277">Możemy używać tych technik do łatwego tworzenia setek prostych testów, które weryfikują zachowanie naszej aplikacji.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-277">We can use these techniques to easily create hundreds of simple tests that verify the behavior of our application.</span></span>

<span data-ttu-id="9d6bf-278">Ponieważ nasze testy kontrolera i modelu nie wymagają rzeczywistej bazy danych, są one niezwykle szybkie i łatwe do uruchomienia.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-278">Because our controller and model tests do not require a real database, they are extremely fast and easy to run.</span></span> <span data-ttu-id="9d6bf-279">Będziemy mogli wykonywać setki zautomatyzowanych testów w ciągu kilku sekund i natychmiast uzyskać informacje o tym, czy wprowadzono zmianę.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-279">We'll be able to execute hundreds of automated tests in seconds, and immediately get feedback as to whether a change we made broke something.</span></span> <span data-ttu-id="9d6bf-280">Dzięki temu firma Microsoft zapewnia zaufanie do ciągłego ulepszania, refaktoryzacji i udoskonalania naszej aplikacji.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-280">This will help provide us the confidence to continually improve, refactor, and refine our application.</span></span>

<span data-ttu-id="9d6bf-281">Omawiamy testy jako ostatni temat w tym rozdziale, ale nie ponieważ testowanie jest coś, co należy zrobić na końcu procesu opracowywania.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-281">We covered testing as the last topic in this chapter – but not because testing is something you should do at the end of a development process!</span></span> <span data-ttu-id="9d6bf-282">W przeciwieństwie do tego należy pisać zautomatyzowane testy tak szybko, jak to możliwe w procesie tworzenia oprogramowania.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-282">On the contrary, you should write automated tests as early as possible in your development process.</span></span> <span data-ttu-id="9d6bf-283">Dzięki temu można uzyskać natychmiastową opinię podczas opracowywania aplikacji, a tym samym Thoughtfully się na temat scenariuszy przypadków użycia i przeprowadzisz projektowanie aplikacji przy użyciu czystych warstw i sprzężeń.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-283">Doing so enables you to get immediate feedback as you develop, helps you think thoughtfully about your application's use case scenarios, and guides you to design your application with clean layering and coupling in mind.</span></span>

<span data-ttu-id="9d6bf-284">W dalszej części książki w książce omówiono projektowanie na podstawie testów (TDD) i sposób korzystania z niego z ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-284">A later chapter in the book will discuss Test Driven Development (TDD), and how to use it with ASP.NET MVC.</span></span> <span data-ttu-id="9d6bf-285">TDD to iteracyjna metoda kodowania, w której należy najpierw napisać testy, które będą spełniały otrzymany kod.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-285">TDD is an iterative coding practice where you first write the tests that your resulting code will satisfy.</span></span> <span data-ttu-id="9d6bf-286">Przy użyciu funkcji TDD Rozpocznij każdą funkcję, tworząc test, który weryfikuje funkcjonalność, która ma zostać zaimplementowana.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-286">With TDD you begin each feature by creating a test that verifies the functionality you are about to implement.</span></span> <span data-ttu-id="9d6bf-287">Pisząc test jednostkowy, należy zadbać o to, aby dobrze zrozumieć funkcję i jak powinna ona zostać zadziałała.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-287">Writing the unit test first helps ensure that you clearly understand the feature and how it is supposed to work.</span></span> <span data-ttu-id="9d6bf-288">Dopiero po zapisaniu testu (i sprawdzeniu, że nie powiodło się), można zaimplementować rzeczywiste funkcje sprawdzane przez test.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-288">Only after the test is written (and you have verified that it fails) do you then implement the actual functionality the test verifies.</span></span> <span data-ttu-id="9d6bf-289">Ponieważ już poświęcasz sobie nad przypadkiem użycia, w jaki sposób funkcja powinna być działała, będziesz mieć lepszy wgląd w wymagania i jak najlepiej wdrożyć je.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-289">Because you've already spent time thinking about the use case of how the feature is supposed to work, you will have a better understanding of the requirements and how best to implement them.</span></span> <span data-ttu-id="9d6bf-290">Po wykonaniu tej czynności możesz ponownie uruchomić test — i natychmiast uzyskać opinię na temat tego, czy funkcja działa prawidłowo.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-290">When you are done with the implementation you can re-run the test – and get immediate feedback as to whether the feature works correctly.</span></span> <span data-ttu-id="9d6bf-291">Zajmiemy się tym, że będziemy więcej w rozdziale 10.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-291">We'll cover TDD more in Chapter 10.</span></span>

### <a name="next-step"></a><span data-ttu-id="9d6bf-292">Następny krok</span><span class="sxs-lookup"><span data-stu-id="9d6bf-292">Next Step</span></span>

<span data-ttu-id="9d6bf-293">Niektóre końcowe zawinięte Komentarze.</span><span class="sxs-lookup"><span data-stu-id="9d6bf-293">Some final wrap up comments.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="9d6bf-294">[Poprzednie](use-ajax-to-implement-mapping-scenarios.md)
> [dalej](nerddinner-wrap-up.md)</span><span class="sxs-lookup"><span data-stu-id="9d6bf-294">[Previous](use-ajax-to-implement-mapping-scenarios.md)
[Next](nerddinner-wrap-up.md)</span></span>
