---
uid: mvc/overview/older-versions-1/nerddinner/build-a-model-with-business-rule-validations
title: Kompilowanie modelu przy użyciu walidacji reguł firmy | Microsoft Docs
author: microsoft
description: Krok 3 pokazuje, jak utworzyć model, za pomocą którego można wysyłać zapytania i aktualizować bazę danych dla naszej aplikacji NerdDinner.
ms.author: riande
ms.date: 07/27/2010
ms.assetid: 0bc191b2-4311-479a-a83a-7f1b1c32e6fe
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/build-a-model-with-business-rule-validations
msc.type: authoredcontent
ms.openlocfilehash: 6ebf1b71c089229ba9139ff7dc788b8978724046
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 03/06/2020
ms.locfileid: "78541665"
---
# <a name="build-a-model-with-business-rule-validations"></a><span data-ttu-id="55ab5-103">Budowanie modelu z walidacją reguł biznesowych</span><span class="sxs-lookup"><span data-stu-id="55ab5-103">Build a Model with Business Rule Validations</span></span>

<span data-ttu-id="55ab5-104">przez [firmę Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="55ab5-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="55ab5-105">Pobierz plik PDF</span><span class="sxs-lookup"><span data-stu-id="55ab5-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="55ab5-106">Jest to krok 3 bezpłatnego [samouczka dotyczącego aplikacji "NerdDinner"](introducing-the-nerddinner-tutorial.md) , który zawiera instrukcje tworzenia niewielkiej, ale kompletnej aplikacji sieci Web przy użyciu ASP.NET MVC 1.</span><span class="sxs-lookup"><span data-stu-id="55ab5-106">This is step 3 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="55ab5-107">Krok 3 pokazuje, jak utworzyć model, za pomocą którego można wysyłać zapytania i aktualizować bazę danych dla naszej aplikacji NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="55ab5-107">Step 3 shows how to create a model that we can use to both query and update the database for our NerdDinner application.</span></span>
> 
> <span data-ttu-id="55ab5-108">Jeśli używasz ASP.NET MVC 3, zalecamy użycie [wprowadzenie ze samouczkami ze sklepu MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) lub [MVC](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) .</span><span class="sxs-lookup"><span data-stu-id="55ab5-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>

## <a name="nerddinner-step-3-building-the-model"></a><span data-ttu-id="55ab5-109">NerdDinner krok 3: kompilowanie modelu</span><span class="sxs-lookup"><span data-stu-id="55ab5-109">NerdDinner Step 3: Building the Model</span></span>

<span data-ttu-id="55ab5-110">W strukturze kontrolera widoku modelu pojęcie "model" odnosi się do obiektów, które reprezentują dane aplikacji, a także odpowiedniej logiki domeny, która integruje sprawdzanie poprawności i reguły biznesowe.</span><span class="sxs-lookup"><span data-stu-id="55ab5-110">In a model-view-controller framework the term "model" refers to the objects that represent the data of the application, as well as the corresponding domain logic that integrates validation and business rules with it.</span></span> <span data-ttu-id="55ab5-111">Model jest na wiele sposobów "serca" aplikacji opartej na MVC i w miarę jak zostanie on rozmieszczony w sposób bardziej podstawowy.</span><span class="sxs-lookup"><span data-stu-id="55ab5-111">The model is in many ways the "heart" of an MVC-based application, and as we'll see later fundamentally drives the behavior of it.</span></span>

<span data-ttu-id="55ab5-112">Platforma ASP.NET MVC obsługuje używanie dowolnych technologii dostępu do danych, a deweloperzy mogą wybierać spośród różnych zaawansowanych opcji danych platformy .NET, aby zaimplementować ich modele, w tym: LINQ to Entities, LINQ to SQL, NHibernate, LLBLGen Pro, Subsonic, WilsonORM lub tylko RAW ADO. NET DataReader lub zestawy danych.</span><span class="sxs-lookup"><span data-stu-id="55ab5-112">The ASP.NET MVC framework supports using any data access technology, and developers can choose from a variety of rich .NET data options to implement their models including: LINQ to Entities, LINQ to SQL, NHibernate, LLBLGen Pro, SubSonic, WilsonORM, or just raw ADO.NET DataReaders or DataSets.</span></span>

<span data-ttu-id="55ab5-113">W naszej aplikacji NerdDinner będziemy używać LINQ to SQL, aby utworzyć prosty model, który jest ściśle zbliżony do naszego projektu bazy danych i dodaje niestandardową logikę sprawdzania poprawności i reguły biznesowe.</span><span class="sxs-lookup"><span data-stu-id="55ab5-113">For our NerdDinner application we are going to use LINQ to SQL to create a simple model that corresponds fairly closely to our database design, and adds some custom validation logic and business rules.</span></span> <span data-ttu-id="55ab5-114">Następnie zaimplementujemy klasę repozytorium, która pomaga w rozróżnieniu implementacji trwałości danych od pozostałej części aplikacji, i umożliwi nam łatwe przetestowanie go.</span><span class="sxs-lookup"><span data-stu-id="55ab5-114">We will then implement a repository class that helps abstract away the data persistence implementation from the rest of the application, and enables us to easily unit test it.</span></span>

### <a name="linq-to-sql"></a><span data-ttu-id="55ab5-115">LINQ to SQL</span><span class="sxs-lookup"><span data-stu-id="55ab5-115">LINQ to SQL</span></span>

<span data-ttu-id="55ab5-116">LINQ to SQL to obiekt ORM (mapowanie relacyjne obiektów), który jest dostarczany jako część .NET 3,5.</span><span class="sxs-lookup"><span data-stu-id="55ab5-116">LINQ to SQL is an ORM (object relational mapper) that ships as part of .NET 3.5.</span></span>

<span data-ttu-id="55ab5-117">LINQ to SQL zapewnia łatwy sposób mapowania tabel bazy danych na klasy .NET, z których możemy się odkodować.</span><span class="sxs-lookup"><span data-stu-id="55ab5-117">LINQ to SQL provides an easy way to map database tables to .NET classes we can code against.</span></span> <span data-ttu-id="55ab5-118">W naszej aplikacji NerdDinner będzie ona używana do mapowania obiadów i tabel RSVP w naszej bazie danych na obiad i RSVP klasy.</span><span class="sxs-lookup"><span data-stu-id="55ab5-118">For our NerdDinner application we'll use it to map the Dinners and RSVP tables within our database to Dinner and RSVP classes.</span></span> <span data-ttu-id="55ab5-119">Kolumny obiadów i tabel RSVP będą odpowiadały właściwościom na obiad i RSVP klas.</span><span class="sxs-lookup"><span data-stu-id="55ab5-119">The columns of the Dinners and RSVP tables will correspond to properties on the Dinner and RSVP classes.</span></span> <span data-ttu-id="55ab5-120">Każdy obiekt obiadu i RSVP będzie reprezentował osobny wiersz w ramach obiadów lub tabel RSVP w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="55ab5-120">Each Dinner and RSVP object will represent a separate row within the Dinners or RSVP tables in the database.</span></span>

<span data-ttu-id="55ab5-121">LINQ to SQL pozwala uniknąć konieczności ręcznego konstruowania instrukcji SQL w celu pobierania i aktualizowania obiektów obiadu i RSVP z danymi bazy danych.</span><span class="sxs-lookup"><span data-stu-id="55ab5-121">LINQ to SQL allows us to avoid having to manually construct SQL statements to retrieve and update Dinner and RSVP objects with database data.</span></span> <span data-ttu-id="55ab5-122">Zamiast tego zdefiniujemy klasy obiadu i RSVP, jak są one mapowane do/z bazy danych oraz relacje między nimi.</span><span class="sxs-lookup"><span data-stu-id="55ab5-122">Instead, we'll define the Dinner and RSVP classes, how they map to/from the database, and the relationships between them.</span></span> <span data-ttu-id="55ab5-123">LINQ to SQL następnie będzie obsługiwać generowanie odpowiedniej logiki wykonywania SQL do użycia w czasie wykonywania, gdy będziemy korzystać z nich.</span><span class="sxs-lookup"><span data-stu-id="55ab5-123">LINQ to SQL will then takes care of generating the appropriate SQL execution logic to use at runtime when we interact and use them.</span></span>

<span data-ttu-id="55ab5-124">Możemy użyć obsługi języka LINQ w języku VB i C# napisać zapytania ekspresowe, które pobierają obiekty obiadu i RSVP z bazy danych.</span><span class="sxs-lookup"><span data-stu-id="55ab5-124">We can use the LINQ language support within VB and C# to write expressive queries that retrieve Dinner and RSVP objects from the database.</span></span> <span data-ttu-id="55ab5-125">Pozwala to zminimalizować ilość kodu danych, który należy napisać, i umożliwia nam tworzenie czystych aplikacji.</span><span class="sxs-lookup"><span data-stu-id="55ab5-125">This minimizes the amount of data code we need to write, and allows us to build really clean applications.</span></span>

### <a name="adding-linq-to-sql-classes-to-our-project"></a><span data-ttu-id="55ab5-126">Dodawanie LINQ to SQL klas do naszego projektu</span><span class="sxs-lookup"><span data-stu-id="55ab5-126">Adding LINQ to SQL Classes to our project</span></span>

<span data-ttu-id="55ab5-127">Rozpocznie się po kliknięciu prawym przyciskiem myszy folderu "models" w naszym projekcie i wybraniu polecenia menu **dodaj&gt;nowy element** :</span><span class="sxs-lookup"><span data-stu-id="55ab5-127">We'll begin by right-clicking on the "Models" folder within our project, and select the **Add-&gt;New Item** menu command:</span></span>

![](build-a-model-with-business-rule-validations/_static/image1.png)

<span data-ttu-id="55ab5-128">Spowoduje to wyświetlenie okna dialogowego "Dodawanie nowego elementu".</span><span class="sxs-lookup"><span data-stu-id="55ab5-128">This will bring up the "Add New Item" dialog.</span></span> <span data-ttu-id="55ab5-129">Będziemy filtrować według kategorii "dane" i wybieramy w niej szablon "LINQ to SQL Classes":</span><span class="sxs-lookup"><span data-stu-id="55ab5-129">We'll filter by the "Data" category and select the "LINQ to SQL Classes" template within it:</span></span>

![](build-a-model-with-business-rule-validations/_static/image2.png)

<span data-ttu-id="55ab5-130">Nazwamy elementu "NerdDinner" i kliknij przycisk "Dodaj".</span><span class="sxs-lookup"><span data-stu-id="55ab5-130">We'll name the item "NerdDinner" and click the "Add" button.</span></span> <span data-ttu-id="55ab5-131">Program Visual Studio doda plik NerdDinner. dbml w katalogu \Models, a następnie otworzy projektanta obiektów relacyjnych LINQ to SQL Object:</span><span class="sxs-lookup"><span data-stu-id="55ab5-131">Visual Studio will add a NerdDinner.dbml file under our \Models directory, and then open the LINQ to SQL object relational designer:</span></span>

![](build-a-model-with-business-rule-validations/_static/image3.png)

### <a name="creating-data-model-classes-with-linq-to-sql"></a><span data-ttu-id="55ab5-132">Tworzenie klas modelu danych za pomocą LINQ to SQL</span><span class="sxs-lookup"><span data-stu-id="55ab5-132">Creating Data Model Classes with LINQ to SQL</span></span>

<span data-ttu-id="55ab5-133">LINQ to SQL pozwala nam szybko utworzyć klasy modelu danych z istniejącego schematu bazy danych.</span><span class="sxs-lookup"><span data-stu-id="55ab5-133">LINQ to SQL enables us to quickly create data model classes from existing database schema.</span></span> <span data-ttu-id="55ab5-134">W tym celu należy otworzyć bazę danych NerdDinner w Eksplorator serwera i wybrać tabele, które chcemy modelować:</span><span class="sxs-lookup"><span data-stu-id="55ab5-134">To-do this we'll open the NerdDinner database in the Server Explorer, and select the Tables we want to model in it:</span></span>

![](build-a-model-with-business-rule-validations/_static/image4.png)

<span data-ttu-id="55ab5-135">Następnie możemy przeciągnąć tabele na powierzchnię projektanta LINQ to SQL.</span><span class="sxs-lookup"><span data-stu-id="55ab5-135">We can then drag the tables onto the LINQ to SQL designer surface.</span></span> <span data-ttu-id="55ab5-136">Gdy wykonamy tę LINQ to SQL automatycznie utworzysz klasy obiadu i RSVP przy użyciu schematu tabel (z właściwościami klasy, które są mapowane na kolumny tabeli bazy danych):</span><span class="sxs-lookup"><span data-stu-id="55ab5-136">When we do this LINQ to SQL will automatically create Dinner and RSVP classes using the schema of the tables (with class properties that map to the database table columns):</span></span>

![](build-a-model-with-business-rule-validations/_static/image5.png)

<span data-ttu-id="55ab5-137">Domyślnie Projektant LINQ to SQL automatycznie "zmienia" nazwy tabel i kolumn podczas tworzenia klas opartych na schemacie bazy danych.</span><span class="sxs-lookup"><span data-stu-id="55ab5-137">By default the LINQ to SQL designer automatically "pluralizes" table and column names when it creates classes based on a database schema.</span></span> <span data-ttu-id="55ab5-138">Na przykład: tabela "obiady" w naszym przykładzie powyżej spowodowało powstanie klasy "obiad".</span><span class="sxs-lookup"><span data-stu-id="55ab5-138">For example: the "Dinners" table in our example above resulted in a "Dinner" class.</span></span> <span data-ttu-id="55ab5-139">Takie nazywanie klas pomaga zapewnić spójność naszych modeli z konwencjami nazewnictwa platformy .NET, a zazwyczaj znajduje się w tym, że projektant naprawił to wygodne (szczególnie w przypadku dodawania wielu tabel).</span><span class="sxs-lookup"><span data-stu-id="55ab5-139">This class naming helps make our models consistent with .NET naming conventions, and I usually find that having the designer fix this up convenient (especially when adding lots of tables).</span></span> <span data-ttu-id="55ab5-140">Jeśli nie podoba Ci się nazwa klasy lub właściwości, które generuje Projektant, możesz zawsze zastąpić ją i zmienić na dowolną żądaną nazwę.</span><span class="sxs-lookup"><span data-stu-id="55ab5-140">If you don't like the name of a class or property that the designer generates, though, you can always override it and change it to any name you want.</span></span> <span data-ttu-id="55ab5-141">Można to zrobić, edytując nazwę jednostki/właściwości w obrębie projektanta lub modyfikując ją za pośrednictwem siatki właściwości.</span><span class="sxs-lookup"><span data-stu-id="55ab5-141">You can do this either by editing the entity/property name in-line within the designer or by modifying it via the property grid.</span></span>

<span data-ttu-id="55ab5-142">Domyślnie Projektant LINQ to SQL sprawdza także relacje między kluczami podstawowymi i kluczami obcym tabel, a na podstawie nich automatycznie tworzy domyślne "skojarzenia relacji" między różnymi tworzonymi przez siebie klasami modelu.</span><span class="sxs-lookup"><span data-stu-id="55ab5-142">By default the LINQ to SQL designer also inspects the primary key/foreign key relationships of the tables, and based on them automatically creates default "relationship associations" between the different model classes it creates.</span></span> <span data-ttu-id="55ab5-143">Na przykład podczas przeciągania obiadów i tabel protokołu RSVP do projektanta LINQ to SQL skojarzenie relacji jeden-do-wielu między nimi zostało wywnioskowane na podstawie faktu, że tabela protokołu RSVP ma klucz obcy do tabeli obiadów (jest to wskazywane przez strzałkę w Projektant):</span><span class="sxs-lookup"><span data-stu-id="55ab5-143">For example, when we dragged the Dinners and RSVP tables onto the LINQ to SQL designer a one-to-many relationship association between the two was inferred based on the fact that the RSVP table had a foreign-key to the Dinners table (this is indicated by the arrow in the designer):</span></span>

![](build-a-model-with-business-rule-validations/_static/image6.png)

<span data-ttu-id="55ab5-144">Powyższe skojarzenie spowoduje, że LINQ to SQL dodać do klasy RSVP właściwość o jednoznacznie określonym typie "obiad", którą deweloperzy mogą wykorzystać w celu uzyskania dostępu do obiadu skojarzonego z daną RSVP.</span><span class="sxs-lookup"><span data-stu-id="55ab5-144">The above association will cause LINQ to SQL to add a strongly typed "Dinner" property to the RSVP class that developers can use to access the Dinner associated with a given RSVP.</span></span> <span data-ttu-id="55ab5-145">Spowoduje to również, że Klasa obiadu ma mieć Właściwość kolekcji "RSVP", która umożliwia deweloperom pobieranie i aktualizowanie obiektów RSVP skojarzonych z określonym obiadem.</span><span class="sxs-lookup"><span data-stu-id="55ab5-145">It will also cause the Dinner class to have a "RSVPs" collection property that enables developers to retrieve and update RSVP objects associated with a particular Dinner.</span></span>

<span data-ttu-id="55ab5-146">Poniżej można zobaczyć przykład funkcji IntelliSense w programie Visual Studio podczas tworzenia nowego obiektu RSVP i dodawania go do kolekcji RSVP w Obiadie.</span><span class="sxs-lookup"><span data-stu-id="55ab5-146">Below you can see an example of intellisense within Visual Studio when we create a new RSVP object and add it to a Dinner's RSVPs collection.</span></span> <span data-ttu-id="55ab5-147">Zwróć uwagę, jak LINQ to SQL automatycznie dodać kolekcję "RSVP" w obiekcie obiadu:</span><span class="sxs-lookup"><span data-stu-id="55ab5-147">Notice how LINQ to SQL automatically added a "RSVPs" collection on the Dinner object:</span></span>

![](build-a-model-with-business-rule-validations/_static/image7.png)

<span data-ttu-id="55ab5-148">Dodając obiekt RSVP do kolekcji RSVP w Obiadie, informujemy LINQ to SQL o skojarzeniu z kluczem obcym relacji między obiadem a wierszem RSVP w naszej bazie danych:</span><span class="sxs-lookup"><span data-stu-id="55ab5-148">By adding the RSVP object to the Dinner's RSVPs collection we are telling LINQ to SQL to associate a foreign-key relationship between the Dinner and the RSVP row in our database:</span></span>

![](build-a-model-with-business-rule-validations/_static/image8.png)

<span data-ttu-id="55ab5-149">Jeśli nie chcesz, aby Projektant utworzył model lub nazwane skojarzenie tabeli, możesz go zastąpić.</span><span class="sxs-lookup"><span data-stu-id="55ab5-149">If you don't like how the designer has modeled or named a table association, you can override it.</span></span> <span data-ttu-id="55ab5-150">Po prostu kliknij strzałkę skojarzenia w Projektancie i uzyskaj dostęp do jego właściwości za pośrednictwem siatki właściwości, aby zmienić nazwę, usunąć lub zmodyfikować ją.</span><span class="sxs-lookup"><span data-stu-id="55ab5-150">Just click on the association arrow within the designer and access its properties via the property grid to rename, delete or modify it.</span></span> <span data-ttu-id="55ab5-151">W naszej aplikacji NerdDinner, chociaż domyślne reguły skojarzenia działają dobrze dla klas modelu danych, które tworzysz, i można po prostu użyć zachowania domyślnego.</span><span class="sxs-lookup"><span data-stu-id="55ab5-151">For our NerdDinner application, though, the default association rules work well for the data model classes we are building and we can just use the default behavior.</span></span>

### <a name="nerddinnerdatacontext-class"></a><span data-ttu-id="55ab5-152">Klasa NerdDinnerDataContext</span><span class="sxs-lookup"><span data-stu-id="55ab5-152">NerdDinnerDataContext Class</span></span>

<span data-ttu-id="55ab5-153">Program Visual Studio automatycznie utworzy klasy platformy .NET, które reprezentują modele i relacje baz danych zdefiniowane za pomocą projektanta LINQ to SQL.</span><span class="sxs-lookup"><span data-stu-id="55ab5-153">Visual Studio will automatically create .NET classes that represent the models and database relationships defined using the LINQ to SQL designer.</span></span> <span data-ttu-id="55ab5-154">Klasa DataContext LINQ to SQL jest również generowana dla każdego pliku projektanta LINQ to SQL dodanego do rozwiązania.</span><span class="sxs-lookup"><span data-stu-id="55ab5-154">A LINQ to SQL DataContext class is also generated for each LINQ to SQL designer file added to the solution.</span></span> <span data-ttu-id="55ab5-155">Ze względu na to, że nazywamy nasze LINQ to SQL element klasy "NerdDinner", utworzona klasa DataContext zostanie wywołana "NerdDinnerDataContext".</span><span class="sxs-lookup"><span data-stu-id="55ab5-155">Because we named our LINQ to SQL class item "NerdDinner", the DataContext class created will be called "NerdDinnerDataContext".</span></span> <span data-ttu-id="55ab5-156">Ta klasa NerdDinnerDataContext jest podstawowym sposobem, w jaki będziemy współdziałać z bazą danych.</span><span class="sxs-lookup"><span data-stu-id="55ab5-156">This NerdDinnerDataContext class is the primary way we will interact with the database.</span></span>

<span data-ttu-id="55ab5-157">Nasze klasy NerdDinnerDataContext udostępniają dwie właściwości — "obiad" i "RSVP" — reprezentujące dwie tabele, które są modelowane w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="55ab5-157">Our NerdDinnerDataContext class exposes two properties - "Dinners" and "RSVPs" - that represent the two tables we modeled within the database.</span></span> <span data-ttu-id="55ab5-158">Możemy użyć C# do zapisywania zapytań LINQ względem tych właściwości, aby wykonywać zapytania i pobierać obiekty obiadu i RSVP z bazy danych.</span><span class="sxs-lookup"><span data-stu-id="55ab5-158">We can use C# to write LINQ queries against those properties to query and retrieve Dinner and RSVP objects from the database.</span></span>

<span data-ttu-id="55ab5-159">Poniższy kod ilustruje sposób tworzenia wystąpienia obiektu NerdDinnerDataContext i wykonywania zapytania LINQ względem niego w celu uzyskania sekwencji obiadów występujących w przyszłości.</span><span class="sxs-lookup"><span data-stu-id="55ab5-159">The following code demonstrates how to instantiate a NerdDinnerDataContext object and perform a LINQ query against it to obtain a sequence of Dinners that occur in the future.</span></span> <span data-ttu-id="55ab5-160">Program Visual Studio udostępnia pełną technologię IntelliSense podczas pisania zapytania LINQ, a obiekty zwracane z tego typu są jednoznacznie wpisane i obsługują technologię IntelliSense:</span><span class="sxs-lookup"><span data-stu-id="55ab5-160">Visual Studio provides full intellisense when writing the LINQ query, and the objects returned from it are strongly-typed and also support intellisense:</span></span>

![](build-a-model-with-business-rule-validations/_static/image9.png)

<span data-ttu-id="55ab5-161">Oprócz umożliwienia nam wykonywania zapytań dotyczących obiektów obiad i RSVP, NerdDinnerDataContext automatycznie śledzi wszelkie zmiany, które następnie przejdziemy na obiad i obiekty RSVP, do których pobieramy.</span><span class="sxs-lookup"><span data-stu-id="55ab5-161">In addition to allowing us to query for Dinner and RSVP objects, a NerdDinnerDataContext also automatically tracks any changes we subsequently make to the Dinner and RSVP objects we retrieve through it.</span></span> <span data-ttu-id="55ab5-162">Za pomocą tej funkcji można łatwo zapisywać zmiany z powrotem w bazie danych — bez konieczności pisania kodu jawnej aktualizacji SQL.</span><span class="sxs-lookup"><span data-stu-id="55ab5-162">We can use this functionality to easily save the changes back to the database - without having to write any explicit SQL update code.</span></span>

<span data-ttu-id="55ab5-163">Na przykład poniższy kod pokazuje, jak używać zapytania LINQ do pobierania pojedynczego obiektu obiadu z bazy danych, aktualizować dwie właściwości obiadu, a następnie zapisywać zmiany z powrotem w bazie danych:</span><span class="sxs-lookup"><span data-stu-id="55ab5-163">For example, the code below demonstrates how to use a LINQ query to retrieve a single Dinner object from the database, update two of the Dinner properties, and then save the changes back to the database:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample1.cs)]

<span data-ttu-id="55ab5-164">Obiekt NerdDinnerDataContext w powyższym kodzie automatycznie przeprowadził automatyczne śledzenie zmian właściwości wprowadzonych do obiektu obiadu, który został przez nas pobrany.</span><span class="sxs-lookup"><span data-stu-id="55ab5-164">The NerdDinnerDataContext object in the code above automatically tracked the property changes made to the Dinner object we retrieved from it.</span></span> <span data-ttu-id="55ab5-165">Po wywołaniu metody "SubmitChanges ()" spowoduje to wykonanie odpowiedniej instrukcji "UPDATE" programu SQL Server w bazie danych, aby zachować zaktualizowane wartości z powrotem.</span><span class="sxs-lookup"><span data-stu-id="55ab5-165">When we called the "SubmitChanges()" method, it will execute an appropriate SQL "UPDATE" statement to the database to persist the updated values back.</span></span>

### <a name="creating-a-dinnerrepository-class"></a><span data-ttu-id="55ab5-166">Tworzenie klasy DinnerRepository</span><span class="sxs-lookup"><span data-stu-id="55ab5-166">Creating a DinnerRepository Class</span></span>

<span data-ttu-id="55ab5-167">W przypadku małych aplikacji czasami warto mieć kontrolery działające bezpośrednio dla LINQ to SQLj klasy DataContext i osadzić zapytania LINQ na kontrolerach.</span><span class="sxs-lookup"><span data-stu-id="55ab5-167">For small applications it is sometimes fine to have Controllers work directly against a LINQ to SQL DataContext class, and embed LINQ queries within the Controllers.</span></span> <span data-ttu-id="55ab5-168">Aplikacje są coraz większe, ale takie podejście jest uciążliwe do utrzymania i przetestowania.</span><span class="sxs-lookup"><span data-stu-id="55ab5-168">As applications get larger, though, this approach becomes cumbersome to maintain and test.</span></span> <span data-ttu-id="55ab5-169">Może to również prowadzić do duplikowania tych samych zapytań LINQ w wielu miejscach.</span><span class="sxs-lookup"><span data-stu-id="55ab5-169">It can also lead to us duplicating the same LINQ queries in multiple places.</span></span>

<span data-ttu-id="55ab5-170">Jednym z rozwiązań, które może ułatwić zachowanie aplikacji i przetestowanie, jest użycie wzorca "Repository".</span><span class="sxs-lookup"><span data-stu-id="55ab5-170">One approach that can make applications easier to maintain and test is to use a "repository" pattern.</span></span> <span data-ttu-id="55ab5-171">Klasa repozytorium pomaga hermetyzować zapytania dotyczące danych i logikę trwałości oraz deabstrakcyjne szczegóły implementacji trwałości danych z aplikacji.</span><span class="sxs-lookup"><span data-stu-id="55ab5-171">A repository class helps encapsulate data querying and persistence logic, and abstracts away the implementation details of the data persistence from the application.</span></span> <span data-ttu-id="55ab5-172">Oprócz tworzenia oczyszczarki kodu aplikacji Używanie wzorca repozytorium może ułatwić zmianę implementacji usługi Data Storage w przyszłości, a także ułatwić testowanie jednostkowe aplikacji bez konieczności rzeczywistej bazy danych.</span><span class="sxs-lookup"><span data-stu-id="55ab5-172">In addition to making application code cleaner, using a repository pattern can make it easier to change data storage implementations in the future, and it can help facilitate unit testing an application without requiring a real database.</span></span>

<span data-ttu-id="55ab5-173">W naszej aplikacji NerdDinner zdefiniujemy klasę DinnerRepository z następującym podpisem:</span><span class="sxs-lookup"><span data-stu-id="55ab5-173">For our NerdDinner application we'll define a DinnerRepository class with the below signature:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample2.cs)]

<span data-ttu-id="55ab5-174">*Uwaga: w dalszej części tego rozdziału wyodrębnimy interfejs IDinnerRepository z tej klasy i włączysz dla niego iniekcję zależności na naszych kontrolerach. Aby zacząć od, należy zacząć proste i działać bezpośrednio z klasą DinnerRepository.*</span><span class="sxs-lookup"><span data-stu-id="55ab5-174">*Note: Later in this chapter we'll extract an IDinnerRepository interface from this class and enable dependency injection with it on our Controllers. To begin with, though, we are going to start simple and just work directly with the DinnerRepository class.*</span></span>

<span data-ttu-id="55ab5-175">Aby zaimplementować tę klasę, należy kliknąć prawym przyciskiem myszy nasz folder "models" i wybrać polecenie menu **dodaj&gt;nowego elementu** .</span><span class="sxs-lookup"><span data-stu-id="55ab5-175">To implement this class we'll right-click on our "Models" folder and choose the **Add-&gt;New Item** menu command.</span></span> <span data-ttu-id="55ab5-176">W oknie dialogowym Dodaj nowy element wybierz szablon "Klasa" i nadaj mu nazwę "DinnerRepository.cs":</span><span class="sxs-lookup"><span data-stu-id="55ab5-176">Within the "Add New Item" dialog we'll select the "Class" template and name the file "DinnerRepository.cs":</span></span>

![](build-a-model-with-business-rule-validations/_static/image10.png)

<span data-ttu-id="55ab5-177">Możemy wdrożyć nasze klasy DinnerRepository, korzystając z poniższego kodu:</span><span class="sxs-lookup"><span data-stu-id="55ab5-177">We can then implement our DinnerRepository class using the code below:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample3.cs)]

### <a name="retrieving-updating-inserting-and-deleting-using-the-dinnerrepository-class"></a><span data-ttu-id="55ab5-178">Pobieranie, aktualizowanie, wstawianie i usuwanie przy użyciu klasy DinnerRepository</span><span class="sxs-lookup"><span data-stu-id="55ab5-178">Retrieving, Updating, Inserting and Deleting using the DinnerRepository class</span></span>

<span data-ttu-id="55ab5-179">Teraz, po utworzeniu naszej klasy DinnerRepository, przyjrzyjmy się kilku przykładom kodu, które demonstrują typowe zadania, które możemy nam wykonać:</span><span class="sxs-lookup"><span data-stu-id="55ab5-179">Now that we've created our DinnerRepository class, let's look at a few code examples that demonstrate common tasks we can do with it:</span></span>

#### <a name="querying-examples"></a><span data-ttu-id="55ab5-180">Przykłady zapytań</span><span class="sxs-lookup"><span data-stu-id="55ab5-180">Querying Examples</span></span>

<span data-ttu-id="55ab5-181">Poniższy kod pobiera pojedynczy obiad przy użyciu wartości DinnerID:</span><span class="sxs-lookup"><span data-stu-id="55ab5-181">The code below retrieves a single Dinner using the DinnerID value:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample4.cs)]

<span data-ttu-id="55ab5-182">Poniższy kod pobiera wszystkie nadchodzące obiady i pętle na ich temat:</span><span class="sxs-lookup"><span data-stu-id="55ab5-182">The code below retrieves all upcoming dinners and loops over them:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample5.cs)]

#### <a name="insert-and-update-examples"></a><span data-ttu-id="55ab5-183">Przykłady wstawiania i aktualizacji</span><span class="sxs-lookup"><span data-stu-id="55ab5-183">Insert and Update Examples</span></span>

<span data-ttu-id="55ab5-184">Poniższy kod ilustruje dodanie dwóch nowych obiadów.</span><span class="sxs-lookup"><span data-stu-id="55ab5-184">The code below demonstrates adding two new dinners.</span></span> <span data-ttu-id="55ab5-185">Dodatki/modyfikacje repozytorium nie są zatwierdzane do bazy danych do momentu wywołania metody "Save ()".</span><span class="sxs-lookup"><span data-stu-id="55ab5-185">Additions/modifications to the repository aren't committed to the database until the "Save()" method is called on it.</span></span> <span data-ttu-id="55ab5-186">LINQ to SQL automatycznie zawija wszystkie zmiany w transakcji bazy danych — w związku z tym wszystkie zmiany są wykonywane lub żadne z nich nie są wykonywane, gdy repozytorium zapisuje:</span><span class="sxs-lookup"><span data-stu-id="55ab5-186">LINQ to SQL automatically wraps all changes in a database transaction – so either all changes happen or none of them do when our repository saves:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample6.cs)]

<span data-ttu-id="55ab5-187">Poniższy kod pobiera istniejący obiekt obiadu i modyfikuje dwie właściwości.</span><span class="sxs-lookup"><span data-stu-id="55ab5-187">The code below retrieves an existing Dinner object, and modifies two properties on it.</span></span> <span data-ttu-id="55ab5-188">Zmiany są zatwierdzane z powrotem do bazy danych, gdy metoda "Save ()" jest wywoływana w naszym repozytorium:</span><span class="sxs-lookup"><span data-stu-id="55ab5-188">The changes are committed back to the database when the "Save()" method is called on our repository:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample7.cs)]

<span data-ttu-id="55ab5-189">Poniższy kod pobiera obiad, a następnie dodaje do niego RSVP.</span><span class="sxs-lookup"><span data-stu-id="55ab5-189">The code below retrieves a dinner and then adds an RSVP to it.</span></span> <span data-ttu-id="55ab5-190">Wykonuje to przy użyciu kolekcji RSVP w obiekcie obiadu, który LINQ to SQL utworzony dla nas (ponieważ istnieje relacja podstawowego klucza/klucza obcego między dwoma w bazie danych).</span><span class="sxs-lookup"><span data-stu-id="55ab5-190">It does this using the RSVPs collection on the Dinner object that LINQ to SQL created for us (because there is a primary-key/foreign-key relationship between the two in the database).</span></span> <span data-ttu-id="55ab5-191">Ta zmiana jest utrwalana w bazie danych jako nowy wiersz tabeli RSVP w przypadku wywołania metody "Save ()" w repozytorium:</span><span class="sxs-lookup"><span data-stu-id="55ab5-191">This change is persisted back to the database as a new RSVP table row when the "Save()" method is called on the repository:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample8.cs)]

#### <a name="delete-example"></a><span data-ttu-id="55ab5-192">Usuń przykład</span><span class="sxs-lookup"><span data-stu-id="55ab5-192">Delete Example</span></span>

<span data-ttu-id="55ab5-193">Poniższy kod pobiera istniejący obiekt obiadu, a następnie oznacza go jako usunięty.</span><span class="sxs-lookup"><span data-stu-id="55ab5-193">The code below retrieves an existing Dinner object, and then marks it to be deleted.</span></span> <span data-ttu-id="55ab5-194">Gdy metoda "Save ()" jest wywoływana w repozytorium, spowoduje to usunięcie z powrotem do bazy danych:</span><span class="sxs-lookup"><span data-stu-id="55ab5-194">When the "Save()" method is called on the repository it will commit the delete back to the database:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample9.cs)]

### <a name="integrating-validation-and-business-rule-logic-with-model-classes"></a><span data-ttu-id="55ab5-195">Integrowanie logiki reguł sprawdzania poprawności i reguły biznesowej z klasami modelu</span><span class="sxs-lookup"><span data-stu-id="55ab5-195">Integrating Validation and Business Rule Logic with Model Classes</span></span>

<span data-ttu-id="55ab5-196">Integrowanie logiki reguł sprawdzania poprawności i reguły biznesowej jest kluczową częścią wszystkich aplikacji, które współdziałają z danymi.</span><span class="sxs-lookup"><span data-stu-id="55ab5-196">Integrating validation and business rule logic is a key part of any application that works with data.</span></span>

#### <a name="schema-validation"></a><span data-ttu-id="55ab5-197">Sprawdzanie poprawności schematu</span><span class="sxs-lookup"><span data-stu-id="55ab5-197">Schema Validation</span></span>

<span data-ttu-id="55ab5-198">Gdy klasy modelu są definiowane przy użyciu projektanta LINQ to SQL, typy danych właściwości w klasach modelu danych odpowiadają typem danych w tabeli bazy.</span><span class="sxs-lookup"><span data-stu-id="55ab5-198">When model classes are defined using the LINQ to SQL designer, the datatypes of the properties in the data model classes correspond to the datatypes of the database table.</span></span> <span data-ttu-id="55ab5-199">Na przykład: Jeśli kolumna "EventDate" w tabeli obiadów ma wartość "DateTime", Klasa modelu danych utworzona przez LINQ to SQL będzie typu "DateTime" (który jest wbudowanym typem danych .NET).</span><span class="sxs-lookup"><span data-stu-id="55ab5-199">For example: if the "EventDate" column in the Dinners table is a "datetime", the data model class created by LINQ to SQL will be of type "DateTime" (which is a built-in .NET datatype).</span></span> <span data-ttu-id="55ab5-200">Oznacza to, że podczas próby przypisania wartości całkowitej lub wartości logicznej do jej z kodu zostanie wyświetlony komunikat o błędzie, a próba niejawnego przekonwertowania nieprawidłowego typu ciągu na go w czasie wykonywania zostanie podjęta automatycznie.</span><span class="sxs-lookup"><span data-stu-id="55ab5-200">This means you will get compile errors if you attempt to assign an integer or boolean to it from code, and it will raise an error automatically if you attempt to implicitly convert a non-valid string type to it at runtime.</span></span>

<span data-ttu-id="55ab5-201">LINQ to SQL również automatycznie obsługuje ucieczki wartości SQL w przypadku korzystania z ciągów, co pomaga chronić przed atakami polegającymi na iniekcji kodu SQL podczas korzystania z niego.</span><span class="sxs-lookup"><span data-stu-id="55ab5-201">LINQ to SQL will also automatically handles escaping SQL values for you when using strings - which helps protect you against SQL injection attacks when using it.</span></span>

#### <a name="validation-and-business-rule-logic"></a><span data-ttu-id="55ab5-202">Sprawdzanie poprawności i logika reguły biznesowej</span><span class="sxs-lookup"><span data-stu-id="55ab5-202">Validation and Business Rule Logic</span></span>

<span data-ttu-id="55ab5-203">Sprawdzanie poprawności schematu jest przydatne jako pierwszy krok, ale jest rzadko wystarczające.</span><span class="sxs-lookup"><span data-stu-id="55ab5-203">Schema validation is useful as a first step, but is rarely sufficient.</span></span> <span data-ttu-id="55ab5-204">Najpopularniejsze scenariusze wymagają możliwości określenia bogatszej logiki walidacji, która może obejmować wiele właściwości, wykonywać kod i często ma świadomość stanu modelu (na przykład: czy jest tworzony/Updated/Deleted, czy w ramach stanu specyficznego dla domeny, takiego jak "zarchiwizowany").</span><span class="sxs-lookup"><span data-stu-id="55ab5-204">Most real-world scenarios require the ability to specify richer validation logic that can span multiple properties, execute code, and often have awareness of a model's state (for example: is it being created /updated/deleted, or within a domain-specific state like "archived").</span></span> <span data-ttu-id="55ab5-205">Istnieją rozmaite różne wzorce i struktury, które mogą służyć do definiowania i stosowania reguł walidacji do klas modeli, a istnieje kilka platform opartych na architekturze .NET, które mogą być używane w tym celu.</span><span class="sxs-lookup"><span data-stu-id="55ab5-205">There are a variety of different patterns and frameworks that can be used to define and apply validation rules to model classes, and there are several .NET based frameworks out there that can be used to help with this.</span></span> <span data-ttu-id="55ab5-206">Możesz użyć całkiem dowolnej z nich w aplikacjach ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="55ab5-206">You can use pretty much any of them within ASP.NET MVC applications.</span></span>

<span data-ttu-id="55ab5-207">Na potrzeby naszej aplikacji NerdDinner będziemy używać stosunkowo prostej i prostej wzorca, w której zostanie ujawniona Właściwość IsValid i Metoda GetRuleViolations () w naszym obiekcie modelu obiadu.</span><span class="sxs-lookup"><span data-stu-id="55ab5-207">For the purposes of our NerdDinner application, we'll use a relatively simple and straight-forward pattern where we expose an IsValid property and a GetRuleViolations() method on our Dinner model object.</span></span> <span data-ttu-id="55ab5-208">Właściwość IsValid zwróci wartość true lub false w zależności od tego, czy sprawdzanie poprawności i reguły biznesowe są prawidłowe.</span><span class="sxs-lookup"><span data-stu-id="55ab5-208">The IsValid property will return true or false depending on whether the validation and business rules are all valid.</span></span> <span data-ttu-id="55ab5-209">Metoda GetRuleViolations () zwróci listę błędów reguł.</span><span class="sxs-lookup"><span data-stu-id="55ab5-209">The GetRuleViolations() method will return a list of any rule errors.</span></span>

<span data-ttu-id="55ab5-210">Będziemy implementować IsValid i GetRuleViolations () dla naszego modelu obiadu przez dodanie "klasy częściowej" do projektu.</span><span class="sxs-lookup"><span data-stu-id="55ab5-210">We'll implement IsValid and GetRuleViolations() for our Dinner model by adding a "partial class" to our project.</span></span> <span data-ttu-id="55ab5-211">Klasy częściowe mogą służyć do dodawania metod/właściwości/zdarzeń do klas obsługiwanych przez projektanta VS (na przykład w przypadku klasy obiadu wygenerowanej przez projektanta LINQ to SQL) i pomóc w uniknięciu tego narzędzia w kodzie.</span><span class="sxs-lookup"><span data-stu-id="55ab5-211">Partial classes can be used to add methods/properties/events to classes maintained by a VS designer (like the Dinner class generated by the LINQ to SQL designer) and help avoid the tool from messing with our code.</span></span> <span data-ttu-id="55ab5-212">Do projektu można dodać nową klasę częściową, klikając prawym przyciskiem myszy folder \Models, a następnie wybierając polecenie menu "Dodaj nowy element".</span><span class="sxs-lookup"><span data-stu-id="55ab5-212">We can add a new partial class to our project by right-clicking on the \Models folder, and then select the "Add New Item" menu command.</span></span> <span data-ttu-id="55ab5-213">Następnie możemy wybrać szablon "Klasa" w oknie dialogowym "Dodawanie nowego elementu" i nadaj mu nazwę Dinner.cs.</span><span class="sxs-lookup"><span data-stu-id="55ab5-213">We can then choose the "Class" template within the "Add New Item" dialog and name it Dinner.cs.</span></span>

![](build-a-model-with-business-rule-validations/_static/image11.png)

<span data-ttu-id="55ab5-214">Kliknięcie przycisku "Dodaj" spowoduje dodanie pliku Dinner.cs do projektu i otwarcie go w środowisku IDE.</span><span class="sxs-lookup"><span data-stu-id="55ab5-214">Clicking the "Add" button will add a Dinner.cs file to our project and open it within the IDE.</span></span> <span data-ttu-id="55ab5-215">Następnie możemy zaimplementować podstawową regułę/strukturę wymuszania walidacji przy użyciu poniższego kodu:</span><span class="sxs-lookup"><span data-stu-id="55ab5-215">We can then implement a basic rule/validation enforcement framework using the below code:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample10.cs)]

<span data-ttu-id="55ab5-216">Kilka informacji o powyższym kodzie:</span><span class="sxs-lookup"><span data-stu-id="55ab5-216">A few notes about the above code:</span></span>

- <span data-ttu-id="55ab5-217">Klasa obiadu jest poprzedzona słowem kluczowym "częściowe", co oznacza, że kod zawarty w nim zostanie połączony z klasą wygenerowaną/obsługiwaną przez projektanta LINQ to SQL i skompilowana w jednej klasie.</span><span class="sxs-lookup"><span data-stu-id="55ab5-217">The Dinner class is prefaced with a "partial" keyword – which means the code contained within it will be combined with the class generated/maintained by the LINQ to SQL designer and compiled into a single class.</span></span>
- <span data-ttu-id="55ab5-218">Klasa RuleViolation jest klasą pomocników dodawaną do projektu, który umożliwia nam dostarczenie szczegółowych informacji o naruszeniu reguły.</span><span class="sxs-lookup"><span data-stu-id="55ab5-218">The RuleViolation class is a helper class we'll add to the project that allows us to provide more details about a rule violation.</span></span>
- <span data-ttu-id="55ab5-219">Metoda obiad. GetRuleViolations () powoduje, że nasze weryfikacje i reguły biznesowe są oceniane (wkrótce zaimplementujemy je).</span><span class="sxs-lookup"><span data-stu-id="55ab5-219">The Dinner.GetRuleViolations() method causes our validation and business rules to be evaluated (we'll implement them shortly).</span></span> <span data-ttu-id="55ab5-220">Następnie zwraca sekwencję obiektów RuleViolation, które zawierają więcej szczegółowych informacji o błędach reguł.</span><span class="sxs-lookup"><span data-stu-id="55ab5-220">It then returns back a sequence of RuleViolation objects that provide more details about any rule errors.</span></span>
- <span data-ttu-id="55ab5-221">Właściwość obiad. IsValid udostępnia wygodną Właściwość pomocnika, która wskazuje, czy obiekt obiadu ma wszystkie aktywne RuleViolations.</span><span class="sxs-lookup"><span data-stu-id="55ab5-221">The Dinner.IsValid property provides a convenient helper property that indicates whether the Dinner object has any active RuleViolations.</span></span> <span data-ttu-id="55ab5-222">Może być aktywnie sprawdzana przez dewelopera przy użyciu obiektu obiadu w dowolnym momencie (i nie zgłasza wyjątku).</span><span class="sxs-lookup"><span data-stu-id="55ab5-222">It can be proactively checked by a developer using the Dinner object at anytime (and does not raise an exception).</span></span>
- <span data-ttu-id="55ab5-223">Metoda częściowa "obiad. OnValidate ()" jest punktem zaczepienia, który LINQ to SQL zapewnia, że wszyscy z nich otrzymają powiadomienie, gdy obiekt obiadu zostanie utrwalony w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="55ab5-223">The Dinner.OnValidate() partial method is a hook that LINQ to SQL provides that allows us to be notified anytime the Dinner object is about to be persisted within the database.</span></span> <span data-ttu-id="55ab5-224">Nasze wdrożenie OnValidate () powyżej gwarantuje, że obiad nie ma RuleViolations przed jego zapisaniem.</span><span class="sxs-lookup"><span data-stu-id="55ab5-224">Our OnValidate() implementation above ensures that the Dinner has no RuleViolations before it is saved.</span></span> <span data-ttu-id="55ab5-225">Jeśli jest w nieprawidłowym stanie, zgłasza wyjątek, co spowoduje, że LINQ to SQL przerywa transakcji.</span><span class="sxs-lookup"><span data-stu-id="55ab5-225">If it is in an invalid state it raises an exception, which will cause LINQ to SQL to abort the transaction.</span></span>

<span data-ttu-id="55ab5-226">To podejście zapewnia prostą strukturę, którą możemy zintegrować weryfikację i reguły biznesowe.</span><span class="sxs-lookup"><span data-stu-id="55ab5-226">This approach provides a simple framework that we can integrate validation and business rules into.</span></span> <span data-ttu-id="55ab5-227">Teraz dodajmy poniższe reguły do naszej metody GetRuleViolations ():</span><span class="sxs-lookup"><span data-stu-id="55ab5-227">For now let's add the below rules to our GetRuleViolations() method:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample11.cs)]

<span data-ttu-id="55ab5-228">Używamy funkcji "yield return", C# aby zwrócić sekwencję dowolnych RuleViolations.</span><span class="sxs-lookup"><span data-stu-id="55ab5-228">We are using the "yield return" feature of C# to return a sequence of any RuleViolations.</span></span> <span data-ttu-id="55ab5-229">Pierwsze sześć reguł sprawdza powyżej po prostu wymuszenie, że właściwości ciągu na Obiadie nie mogą mieć wartości null ani być puste.</span><span class="sxs-lookup"><span data-stu-id="55ab5-229">The first six rule checks above simply enforce that string properties on our Dinner cannot be null or empty.</span></span> <span data-ttu-id="55ab5-230">Ostatnia reguła jest nieco bardziej interesująca i wywołuje metodę pomocnika PhoneValidator. IsValidNumber (), którą można dodać do naszego projektu, aby sprawdzić, czy format numeru ContactPhone jest zgodny z krajem obiadu.</span><span class="sxs-lookup"><span data-stu-id="55ab5-230">The last rule is a little more interesting, and calls a PhoneValidator.IsValidNumber() helper method that we can add to our project to verify that the ContactPhone number format matches the Dinner's country.</span></span>

<span data-ttu-id="55ab5-231">Możemy użyć. Obsługa wyrażenia regularnego w sieci w celu zaimplementowania tej obsługi sprawdzania poprawności telefonu.</span><span class="sxs-lookup"><span data-stu-id="55ab5-231">We can use .NET's regular expression support to implement this phone validation support.</span></span> <span data-ttu-id="55ab5-232">Poniżej znajduje się prosta implementacja PhoneValidator, którą możemy dodać do naszego projektu, który pozwala nam dodawać testy wzorca wyrażenia regularnego specyficzne dla kraju:</span><span class="sxs-lookup"><span data-stu-id="55ab5-232">Below is a simple PhoneValidator implementation that we can add to our project that enables us to add country-specific Regex pattern checks:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample12.cs)]

#### <a name="handling-validation-and-business-logic-violations"></a><span data-ttu-id="55ab5-233">Obsługa walidacji i naruszeń logiki biznesowej</span><span class="sxs-lookup"><span data-stu-id="55ab5-233">Handling Validation and Business Logic Violations</span></span>

<span data-ttu-id="55ab5-234">Teraz, po dodaniu powyższego kodu sprawdzania poprawności i reguły biznesowej, zawsze, gdy spróbujemy utworzyć lub zaktualizować obiad, zostaną ocenione i wymuszone reguły logiki walidacji.</span><span class="sxs-lookup"><span data-stu-id="55ab5-234">Now that we've added the above validation and business rule code, any time we try to create or update a Dinner, our validation logic rules will be evaluated and enforced.</span></span>

<span data-ttu-id="55ab5-235">Deweloperzy mogą napisać kod jak poniżej, aby aktywnie określić, czy obiekt obiadu jest prawidłowy, i pobrać listę wszystkich naruszeń w nim bez ponoszenia wyjątków:</span><span class="sxs-lookup"><span data-stu-id="55ab5-235">Developers can write code like below to proactively determine if a Dinner object is valid, and retrieve a list of all violations in it without raising any exceptions:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample13.cs)]

<span data-ttu-id="55ab5-236">Jeśli podjęto próbę zapisania obiadu w nieprawidłowym stanie, zostanie zgłoszony wyjątek podczas wywoływania metody Save () na DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="55ab5-236">If we attempt to save a Dinner in an invalid state, an exception will be raised when we call the Save() method on the DinnerRepository.</span></span> <span data-ttu-id="55ab5-237">Dzieje się tak, ponieważ LINQ to SQL automatycznie wywołuje nasz obiad. OnValidate () — Metoda częściowa przed zapisaniem zmian obiadu i dodaliśmy kod do obiadu. OnValidate (), aby zgłosić wyjątek, jeśli jakiekolwiek naruszenia reguł istnieją na Obiadie.</span><span class="sxs-lookup"><span data-stu-id="55ab5-237">This occurs because LINQ to SQL automatically calls our Dinner.OnValidate() partial method before it saves the Dinner's changes, and we added code to Dinner.OnValidate() to raise an exception if any rule violations exist in the Dinner.</span></span> <span data-ttu-id="55ab5-238">Możemy przechwycić ten wyjątek i ponownie pobrać listę naruszeń, które należy rozwiązać:</span><span class="sxs-lookup"><span data-stu-id="55ab5-238">We can catch this exception and reactively retrieve a list of the violations to fix:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample14.cs)]

<span data-ttu-id="55ab5-239">Ponieważ nasze reguły sprawdzania poprawności i biznesowe zostały zaimplementowane w ramach naszej warstwy modelu, a nie w warstwie interfejsu użytkownika, zostaną one zastosowane i użyte we wszystkich scenariuszach w naszej aplikacji.</span><span class="sxs-lookup"><span data-stu-id="55ab5-239">Because our validation and business rules are implemented within our model layer, and not within the UI layer, they will be applied and used across all scenarios within our application.</span></span> <span data-ttu-id="55ab5-240">Możemy później zmienić lub dodać reguły biznesowe oraz cały kod, który współdziała z naszymi obiektami obiadu.</span><span class="sxs-lookup"><span data-stu-id="55ab5-240">We can later change or add business rules and have all code that works with our Dinner objects honor them.</span></span>

<span data-ttu-id="55ab5-241">Możliwość zmiany reguł firmy w jednym miejscu, bez konieczności wprowadzania zmian w całej aplikacji i logiki interfejsu użytkownika, jest znakiem dobrze nadanej aplikacji i korzyścią, którą może pomóc architektura MVC.</span><span class="sxs-lookup"><span data-stu-id="55ab5-241">Having the flexibility to change business rules in one place, without having these changes ripple throughout the application and UI logic, is a sign of a well-written application, and a benefit that an MVC framework helps encourage.</span></span>

### <a name="next-step"></a><span data-ttu-id="55ab5-242">Następny krok</span><span class="sxs-lookup"><span data-stu-id="55ab5-242">Next Step</span></span>

<span data-ttu-id="55ab5-243">Mamy już model, za pomocą którego możemy wysyłać zapytania i aktualizować bazę danych.</span><span class="sxs-lookup"><span data-stu-id="55ab5-243">We've now got a model that we can use to both query and update our database.</span></span>

<span data-ttu-id="55ab5-244">Teraz Dodajmy do projektu niektóre kontrolery i widoki, których można użyć do utworzenia środowiska interfejsu użytkownika HTML.</span><span class="sxs-lookup"><span data-stu-id="55ab5-244">Let's now add some controllers and views to the project that we can use to build an HTML UI experience around it.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="55ab5-245">[Poprzednie](create-a-database.md)
> [dalej](use-controllers-and-views-to-implement-a-listingdetails-ui.md)</span><span class="sxs-lookup"><span data-stu-id="55ab5-245">[Previous](create-a-database.md)
[Next](use-controllers-and-views-to-implement-a-listingdetails-ui.md)</span></span>
