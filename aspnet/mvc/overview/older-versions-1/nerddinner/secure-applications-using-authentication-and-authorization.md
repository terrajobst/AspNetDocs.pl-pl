---
uid: mvc/overview/older-versions-1/nerddinner/secure-applications-using-authentication-and-authorization
title: Zabezpieczanie aplikacji przy użyciu uwierzytelniania i autoryzacji | Microsoft Docs
author: microsoft
description: Krok 9 pokazuje, jak dodać uwierzytelnianie i autoryzację w celu zabezpieczenia naszej aplikacji NerdDinner, aby użytkownicy musieli zarejestrować się i zalogować się do witryny w celu utworzenia...
ms.author: riande
ms.date: 07/27/2010
ms.assetid: 9e4d5cac-b071-440c-b044-20b6d0c964fb
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/secure-applications-using-authentication-and-authorization
msc.type: authoredcontent
ms.openlocfilehash: 8d509c5f15bb4d5014e53b8dc2a736454238e72c
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 03/06/2020
ms.locfileid: "78600983"
---
# <a name="secure-applications-using-authentication-and-authorization"></a><span data-ttu-id="d55c6-103">Zabezpieczanie aplikacji przy użyciu uwierzytelniania i autoryzacji</span><span class="sxs-lookup"><span data-stu-id="d55c6-103">Secure Applications Using Authentication and Authorization</span></span>

<span data-ttu-id="d55c6-104">przez [firmę Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="d55c6-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="d55c6-105">Pobierz plik PDF</span><span class="sxs-lookup"><span data-stu-id="d55c6-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="d55c6-106">Jest to krok 9 bezpłatnego [samouczka dotyczącego aplikacji "NerdDinner"](introducing-the-nerddinner-tutorial.md) , który zawiera instrukcje tworzenia niewielkiej, ale kompletnej aplikacji sieci Web przy użyciu ASP.NET MVC 1.</span><span class="sxs-lookup"><span data-stu-id="d55c6-106">This is step 9 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="d55c6-107">Krok 9 pokazuje, jak dodać uwierzytelnianie i autoryzację w celu zabezpieczenia naszej aplikacji NerdDinner, dzięki czemu użytkownicy muszą zarejestrować się i zalogować się do witryny w celu utworzenia nowych obiadów, a tylko użytkownik, który obsługuje obiad, może później edytować go.</span><span class="sxs-lookup"><span data-stu-id="d55c6-107">Step 9 shows how to add authentication and authorization to secure our NerdDinner application, so that users need to register and login to the site to create new dinners, and only the user who is hosting a dinner can edit it later.</span></span>
> 
> <span data-ttu-id="d55c6-108">Jeśli używasz ASP.NET MVC 3, zalecamy użycie [wprowadzenie ze samouczkami ze sklepu MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) lub [MVC](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) .</span><span class="sxs-lookup"><span data-stu-id="d55c6-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>

## <a name="nerddinner-step-9-authentication-and-authorization"></a><span data-ttu-id="d55c6-109">NerdDinner krok 9: uwierzytelnianie i autoryzacja</span><span class="sxs-lookup"><span data-stu-id="d55c6-109">NerdDinner Step 9: Authentication and Authorization</span></span>

<span data-ttu-id="d55c6-110">Teraz nasza aplikacja NerdDinner przyznaje każdej osobie odwiedzającej witrynę możliwość tworzenia i edytowania szczegółów każdego obiadu.</span><span class="sxs-lookup"><span data-stu-id="d55c6-110">Right now our NerdDinner application grants anyone visiting the site the ability to create and edit the details of any dinner.</span></span> <span data-ttu-id="d55c6-111">Zmieńmy to tak, aby użytkownicy musieli zarejestrować się w witrynie i zalogować się do niej, aby utworzyć nowe uroczyste obiady, a następnie dodać ograniczenie, tak aby tylko użytkownik, który obsługuje obiad, mógł go później edytować.</span><span class="sxs-lookup"><span data-stu-id="d55c6-111">Let's change this so that users need to register and login to the site to create new dinners, and add a restriction so that only the user who is hosting a dinner can edit it later.</span></span>

<span data-ttu-id="d55c6-112">Aby to umożliwić, użyjemy uwierzytelniania i autoryzacji do zabezpieczenia naszej aplikacji.</span><span class="sxs-lookup"><span data-stu-id="d55c6-112">To enable this we'll use authentication and authorization to secure our application.</span></span>

### <a name="understanding-authentication-and-authorization"></a><span data-ttu-id="d55c6-113">Informacje o uwierzytelnianiu i autoryzacji</span><span class="sxs-lookup"><span data-stu-id="d55c6-113">Understanding Authentication and Authorization</span></span>

<span data-ttu-id="d55c6-114">*Uwierzytelnianie* to proces identyfikowania i weryfikowania tożsamości klienta uzyskującego dostęp do aplikacji.</span><span class="sxs-lookup"><span data-stu-id="d55c6-114">*Authentication* is the process of identifying and validating the identity of a client accessing an application.</span></span> <span data-ttu-id="d55c6-115">Po prostu zapoznaj się z tematem "kto" jest użytkownikiem końcowym podczas odwiedzania witryny sieci Web.</span><span class="sxs-lookup"><span data-stu-id="d55c6-115">Put more simply, it is about identifying "who" the end-user is when they visit a website.</span></span> <span data-ttu-id="d55c6-116">ASP.NET obsługuje wiele sposobów uwierzytelniania użytkowników przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="d55c6-116">ASP.NET supports multiple ways to authenticate browser users.</span></span> <span data-ttu-id="d55c6-117">W przypadku aplikacji internetowych sieci Web najczęściej używane podejście uwierzytelniania nazywa się "uwierzytelnianie formularzy".</span><span class="sxs-lookup"><span data-stu-id="d55c6-117">For Internet web applications, the most common authentication approach used is called "Forms Authentication".</span></span> <span data-ttu-id="d55c6-118">Uwierzytelnianie formularzy umożliwia deweloperowi tworzenie formularza logowania HTML w swojej aplikacji, a następnie Weryfikowanie nazwy użytkownika/hasła, które są przesyłane przez użytkownika końcowego do bazy danych lub innego magazynu poświadczeń haseł.</span><span class="sxs-lookup"><span data-stu-id="d55c6-118">Forms Authentication enables a developer to author an HTML login form within their application, and then validate the username/password an end-user submits against a database or other password credential store.</span></span> <span data-ttu-id="d55c6-119">Jeśli kombinacja nazwy użytkownika/hasła jest poprawna, programista może zadawać ASP.NET do wystawienia zaszyfrowanego pliku cookie protokołu HTTP w celu zidentyfikowania użytkownika w przyszłych żądaniach.</span><span class="sxs-lookup"><span data-stu-id="d55c6-119">If the username/password combination is correct, the developer can then ask ASP.NET to issue an encrypted HTTP cookie to identify the user across future requests.</span></span> <span data-ttu-id="d55c6-120">Będziemy używać uwierzytelniania formularzy w naszej aplikacji NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="d55c6-120">We'll by using forms authentication with our NerdDinner application.</span></span>

<span data-ttu-id="d55c6-121">*Autoryzacja* to proces ustalania, czy uwierzytelniony użytkownik ma uprawnienia dostępu do określonego adresu URL/zasobu lub wykonywania pewnych akcji.</span><span class="sxs-lookup"><span data-stu-id="d55c6-121">*Authorization* is the process of determining whether an authenticated user has permission to access a particular URL/resource or to perform some action.</span></span> <span data-ttu-id="d55c6-122">Na przykład w naszej aplikacji NerdDinner chcemy autoryzować, że tylko zalogowani użytkownicy mogą uzyskiwać dostęp do adresu URL */Dinners/Create* i tworzyć nowe obiady.</span><span class="sxs-lookup"><span data-stu-id="d55c6-122">For example, within our NerdDinner application we'll want to authorize that only users who are logged in can access the */Dinners/Create* URL and create new Dinners.</span></span> <span data-ttu-id="d55c6-123">Chcemy również dodać logikę autoryzacji, tak aby tylko użytkownik, który obsługuje obiad, mógł go edytować — i odmówić dostępu do edycji wszystkim innym użytkownikom.</span><span class="sxs-lookup"><span data-stu-id="d55c6-123">We'll also want to add authorization logic so that only the user who is hosting a dinner can edit it – and deny edit access to all other users.</span></span>

### <a name="forms-authentication-and-the-accountcontroller"></a><span data-ttu-id="d55c6-124">Uwierzytelnianie formularzy i elementu AccountController</span><span class="sxs-lookup"><span data-stu-id="d55c6-124">Forms Authentication and the AccountController</span></span>

<span data-ttu-id="d55c6-125">Domyślny szablon projektu programu Visual Studio dla ASP.NET MVC automatycznie włącza uwierzytelnianie formularzy podczas tworzenia nowych aplikacji ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="d55c6-125">The default Visual Studio project template for ASP.NET MVC automatically enables forms authentication when new ASP.NET MVC applications are created.</span></span> <span data-ttu-id="d55c6-126">Automatycznie dodaje wstępnie skompilowaną implementację strony logowania do projektu, dzięki czemu można łatwo zintegrować zabezpieczenia w obrębie lokacji.</span><span class="sxs-lookup"><span data-stu-id="d55c6-126">It also automatically adds a pre-built account login page implementation to the project – which makes it really easy to integrate security within a site.</span></span>

<span data-ttu-id="d55c6-127">Domyślna strona główna witryny. Master wyświetla link "Zaloguj się" w prawym górnym rogu witryny, gdy użytkownik uzyskuje do niej dostęp, nie jest uwierzytelniany:</span><span class="sxs-lookup"><span data-stu-id="d55c6-127">The default Site.master master page displays a "Log On" link at the top-right of the site when the user accessing it is not authenticated:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image1.png)

<span data-ttu-id="d55c6-128">Kliknięcie linku "Zaloguj się" spowoduje przejście użytkownika do adresu URL */Account/LogOn* :</span><span class="sxs-lookup"><span data-stu-id="d55c6-128">Clicking the "Log On" link takes a user to the */Account/LogOn* URL:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image2.png)

<span data-ttu-id="d55c6-129">Odwiedzający, którzy nie zostali zarejestrowani, mogą to zrobić przez kliknięcie linku "Register" (Zarejestruj), który przeniesie je do adresu URL */Account/Register* i umożliwi im wprowadzanie szczegółowych informacji o koncie:</span><span class="sxs-lookup"><span data-stu-id="d55c6-129">Visitors who haven't registered can do so by clicking the "Register" link – which will take them to the */Account/Register* URL and allow them to enter account details:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image3.png)

<span data-ttu-id="d55c6-130">Kliknięcie przycisku "Zarejestruj" spowoduje utworzenie nowego użytkownika w ramach systemu członkostwa ASP.NET i uwierzytelnienie użytkownika w lokacji przy użyciu uwierzytelniania formularzy.</span><span class="sxs-lookup"><span data-stu-id="d55c6-130">Clicking the "Register" button will create a new user within the ASP.NET Membership system, and authenticate the user onto the site using forms authentication.</span></span>

<span data-ttu-id="d55c6-131">Gdy użytkownik jest zalogowany, witryna. Master zmieni w prawym górnym rogu strony, aby wyprowadził "Witamy [nazwa_użytkownika]!"</span><span class="sxs-lookup"><span data-stu-id="d55c6-131">When a user is logged-in, the Site.master changes the top-right of the page to output a "Welcome [username]!"</span></span> <span data-ttu-id="d55c6-132">komunikat i renderuje link "Wyloguj się" zamiast "Zaloguj się".</span><span class="sxs-lookup"><span data-stu-id="d55c6-132">message and renders a "Log Off" link instead of a "Log On" one.</span></span> <span data-ttu-id="d55c6-133">Kliknięcie linku "Wyloguj się" wylogowuje użytkownika:</span><span class="sxs-lookup"><span data-stu-id="d55c6-133">Clicking the "Log Off" link logs out the user:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image4.png)

<span data-ttu-id="d55c6-134">Powyższe funkcje logowania, wylogowywania i rejestracji są implementowane w klasie elementu AccountController, która została dodana do projektu przez program Visual Studio podczas tworzenia projektu.</span><span class="sxs-lookup"><span data-stu-id="d55c6-134">The above login, logout, and registration functionality is implemented within the AccountController class that was added to our project by Visual Studio when it created the project.</span></span> <span data-ttu-id="d55c6-135">Interfejs użytkownika dla elementu AccountController jest implementowany przy użyciu szablonów widoku w katalogu \Views\Account:</span><span class="sxs-lookup"><span data-stu-id="d55c6-135">The UI for the AccountController is implemented using view templates within the \Views\Account directory:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image5.png)

<span data-ttu-id="d55c6-136">Klasa elementu AccountController używa systemu uwierzytelniania formularzy ASP.NET w celu wystawiania zaszyfrowanych plików cookie uwierzytelniania oraz interfejsu API członkostwa ASP.NET w celu przechowywania i weryfikowania nazw użytkowników/haseł.</span><span class="sxs-lookup"><span data-stu-id="d55c6-136">The AccountController class uses the ASP.NET Forms Authentication system to issue encrypted authentication cookies, and the ASP.NET Membership API to store and validate usernames/passwords.</span></span> <span data-ttu-id="d55c6-137">Interfejs API członkostwa ASP.NET jest rozszerzalny i umożliwia używanie dowolnego magazynu poświadczeń haseł.</span><span class="sxs-lookup"><span data-stu-id="d55c6-137">The ASP.NET Membership API is extensible and enables any password credential store to be used.</span></span> <span data-ttu-id="d55c6-138">ASP.NET jest dostarczany z wbudowanymi implementacjami dostawców członkostwa, które przechowują nazwy użytkownika/hasła w bazie danych SQL lub w Active Directory.</span><span class="sxs-lookup"><span data-stu-id="d55c6-138">ASP.NET ships with built-in membership provider implementations that store username/passwords within a SQL database, or within Active Directory.</span></span>

<span data-ttu-id="d55c6-139">Możemy skonfigurować dostawcę członkostwa, którego aplikacja NerdDinner powinna używać, otwierając plik "Web. config" w katalogu głównym projektu i szukając w nim sekcji &lt;Membership&gt;.</span><span class="sxs-lookup"><span data-stu-id="d55c6-139">We can configure which membership provider our NerdDinner application should use by opening the "web.config" file at the root of the project and looking for the &lt;membership&gt; section within it.</span></span> <span data-ttu-id="d55c6-140">Plik Web. config dodany podczas tworzenia projektu rejestruje dostawcę członkostwa SQL i konfiguruje go tak, aby korzystał z parametrów połączenia o nazwie "ApplicationServices" w celu określenia lokalizacji bazy danych.</span><span class="sxs-lookup"><span data-stu-id="d55c6-140">The default web.config added when the project was created registers the SQL membership provider, and configures it to use a connection-string named "ApplicationServices" to specify the database location.</span></span>

<span data-ttu-id="d55c6-141">Domyślne parametry połączenia "ApplicationServices" (określone w sekcji &lt;connectionStrings&gt; pliku Web. config) są skonfigurowane do korzystania z programu SQL Express.</span><span class="sxs-lookup"><span data-stu-id="d55c6-141">The default "ApplicationServices" connection string (which is specified within the &lt;connectionStrings&gt; section of the web.config file) is configured to use SQL Express.</span></span> <span data-ttu-id="d55c6-142">Wskazuje bazę danych SQL Express o nazwie "ASPNETDB. MDF "w katalogu" App\_Data "aplikacji.</span><span class="sxs-lookup"><span data-stu-id="d55c6-142">It points to a SQL Express database named "ASPNETDB.MDF" under the application's "App\_Data" directory.</span></span> <span data-ttu-id="d55c6-143">Jeśli ta baza danych nie istnieje przy pierwszym użyciu interfejsu API członkostwa w aplikacji, ASP.NET automatycznie utworzy bazę danych i zainicjuje w niej odpowiedni schemat bazy danych członkostwa:</span><span class="sxs-lookup"><span data-stu-id="d55c6-143">If this database doesn't exist the first time the Membership API is used within the application, ASP.NET will automatically create the database and provision the appropriate membership database schema within it:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image6.png)

<span data-ttu-id="d55c6-144">Jeśli zamiast korzystania z programu SQL Express chciałem korzystać z pełnego SQL Server wystąpienia (lub nawiązać połączenie ze zdalną bazą danych), należy zaktualizować parametry połączenia "ApplicationServices" w pliku Web. config i upewnić się, że odpowiedni schemat członkostwa dodano do bazy danych, do której odwołuje się.</span><span class="sxs-lookup"><span data-stu-id="d55c6-144">If instead of using SQL Express we wanted to use a full SQL Server instance (or connect to a remote database), all we'd need to-do is to update the "ApplicationServices" connection string within the web.config file and make sure that the appropriate membership schema has been added to the database it points at.</span></span> <span data-ttu-id="d55c6-145">Aby dodać odpowiedni schemat dla członkostwa i innych usług aplikacji ASP.NET do bazy danych, można uruchomić narzędzie "ASPNET\_regsql. exe" w katalogu \Windows\Microsoft.NET\Framework\v2.0.50727\.</span><span class="sxs-lookup"><span data-stu-id="d55c6-145">You can run the "aspnet\_regsql.exe" utility within the \Windows\Microsoft.NET\Framework\v2.0.50727\ directory to add the appropriate schema for membership and the other ASP.NET application services to a database.</span></span>

### <a name="authorizing-the-dinnerscreate-url-using-the-authorize-filter"></a><span data-ttu-id="d55c6-146">Autoryzowanie adresu URL/Dinners/Create przy użyciu filtru [autoryzować]</span><span class="sxs-lookup"><span data-stu-id="d55c6-146">Authorizing the /Dinners/Create URL using the [Authorize] filter</span></span>

<span data-ttu-id="d55c6-147">Nie musimy pisać żadnego kodu w celu włączenia bezpiecznego uwierzytelniania i implementacji zarządzania kontami dla aplikacji NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="d55c6-147">We didn't have to write any code to enable a secure authentication and account management implementation for the NerdDinner application.</span></span> <span data-ttu-id="d55c6-148">Użytkownicy mogą rejestrować nowe konta przy użyciu naszej aplikacji, a także zalogować/wylogować witrynę.</span><span class="sxs-lookup"><span data-stu-id="d55c6-148">Users can register new accounts with our application, and login/logout of the site.</span></span>

<span data-ttu-id="d55c6-149">Teraz możemy dodać logikę autoryzacji do aplikacji i użyć stanu uwierzytelniania oraz nazwy użytkownika osób odwiedzających, aby określić, co może i czego nie można wykonać w ramach lokacji.</span><span class="sxs-lookup"><span data-stu-id="d55c6-149">Now we can add authorization logic to the application, and use the authentication status and username of visitors to control what they can and can't do within the site.</span></span> <span data-ttu-id="d55c6-150">Zacznijmy od dodania logiki autoryzacji do metod akcji "Create" naszej klasy DinnersController.</span><span class="sxs-lookup"><span data-stu-id="d55c6-150">Let's begin by adding authorization logic to the "Create" action methods of our DinnersController class.</span></span> <span data-ttu-id="d55c6-151">W każdym przypadku wymagane jest zalogowanie użytkowników uzyskujących dostęp do adresu URL */Dinners/Create* .</span><span class="sxs-lookup"><span data-stu-id="d55c6-151">Specifically, we will require that users accessing the */Dinners/Create* URL must be logged in.</span></span> <span data-ttu-id="d55c6-152">Jeśli użytkownik nie jest zalogowany, przekierowuje je do strony logowania, aby mogli się zalogować.</span><span class="sxs-lookup"><span data-stu-id="d55c6-152">If they aren't logged in we'll redirect them to the login page so that they can sign-in.</span></span>

<span data-ttu-id="d55c6-153">Implementacja tej logiki jest łatwa w obsłudze.</span><span class="sxs-lookup"><span data-stu-id="d55c6-153">Implementing this logic is pretty easy.</span></span> <span data-ttu-id="d55c6-154">Wszystko, czego potrzebujemy do dodania atrybutu filtru [autoryzuje] do naszych metod akcji tworzenia, takich jak:</span><span class="sxs-lookup"><span data-stu-id="d55c6-154">All we need to-do is to add an [Authorize] filter attribute to our Create action methods like so:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample1.cs)]

<span data-ttu-id="d55c6-155">ASP.NET MVC obsługuje możliwość tworzenia "filtrów akcji", których można użyć do zaimplementowania logiki wielokrotnego użytku, która może być deklaratywnie stosowana do metod akcji.</span><span class="sxs-lookup"><span data-stu-id="d55c6-155">ASP.NET MVC supports the ability to create "action filters" that can be used to implement re-usable logic that can be declaratively applied to action methods.</span></span> <span data-ttu-id="d55c6-156">Filtr [Autoryzuj] jest jednym z wbudowanych filtrów akcji udostępnianych przez ASP.NET MVC i umożliwia deweloperom deklaratywne stosowanie reguł autoryzacji do metod akcji i klas kontrolerów.</span><span class="sxs-lookup"><span data-stu-id="d55c6-156">The [Authorize] filter is one of the built-in action filters provided by ASP.NET MVC, and it enables a developer to declaratively apply authorization rules to action methods and controller classes.</span></span>

<span data-ttu-id="d55c6-157">Jeśli zastosowano bez parametrów (jak powyżej) filtr [Autoryzuj] wymusza, że użytkownik wykonujący żądanie metody akcji musi być zalogowany — i automatycznie przekieruje przeglądarkę do adresu URL logowania, jeśli nie.</span><span class="sxs-lookup"><span data-stu-id="d55c6-157">When applied without any parameters (like above) the [Authorize] filter enforces that the user making the action method request must be logged in – and it will automatically redirect the browser to the login URL if they aren't.</span></span> <span data-ttu-id="d55c6-158">Podczas tego przekierowania pierwotnie żądany adres URL jest przesyłany jako argument QueryString (na przykład:/Account/LogOn? ReturnUrl =% 2fDinners% 2fCreate).</span><span class="sxs-lookup"><span data-stu-id="d55c6-158">When doing this redirect the originally requested URL is passed as a querystring argument (for example: /Account/LogOn?ReturnUrl=%2fDinners%2fCreate).</span></span> <span data-ttu-id="d55c6-159">Następnie elementu AccountController przekieruje użytkownika z powrotem do pierwotnie żądanego adresu URL po zalogowaniu się.</span><span class="sxs-lookup"><span data-stu-id="d55c6-159">The AccountController will then redirect the user back to the originally requested URL once they login.</span></span>

<span data-ttu-id="d55c6-160">Filtr [Autoryzuj] opcjonalnie obsługuje możliwość określania właściwości "Users" lub "Roles", za pomocą której można wymagać, aby użytkownik zalogował się zarówno na liście dozwolonych użytkowników, jak i w ramach dozwolonej roli zabezpieczeń.</span><span class="sxs-lookup"><span data-stu-id="d55c6-160">The [Authorize] filter optionally supports the ability to specify a "Users" or "Roles" property that can be used to require that the user is both logged in and within a list of allowed users or a member of an allowed security role.</span></span> <span data-ttu-id="d55c6-161">Na przykład poniższy kod zezwala na dostęp do adresu URL/Dinners/Create tylko dwóm określonym użytkownikom, "scottgu" i "billg":</span><span class="sxs-lookup"><span data-stu-id="d55c6-161">For example, the code below only allows two specific users, "scottgu" and "billg", to access the /Dinners/Create URL:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample2.cs)]

<span data-ttu-id="d55c6-162">Osadzenie określonych nazw użytkowników w kodzie może być całkiem niełatwa do utrzymania.</span><span class="sxs-lookup"><span data-stu-id="d55c6-162">Embedding specific user names within code tends to be pretty un-maintainable though.</span></span> <span data-ttu-id="d55c6-163">Lepszym rozwiązaniem jest zdefiniowanie ról wyższego poziomu, które są sprawdzane przez kod, a następnie mapowania użytkowników do roli przy użyciu bazy danych lub systemu usługi Active Directory (dzięki włączeniu rzeczywistej listy mapowania użytkowników, która ma być przechowywana zewnętrznie z kodu).</span><span class="sxs-lookup"><span data-stu-id="d55c6-163">A better approach is to define higher-level "roles" that the code checks against, and then to map users into the role using either a database or active directory system (enabling the actual user mapping list to be stored externally from the code).</span></span> <span data-ttu-id="d55c6-164">ASP.NET zawiera wbudowany interfejs API zarządzania rolami, a także Wbudowany zestaw dostawców ról (w tym dla SQL i Active Directory), które mogą ułatwić wykonywanie mapowania użytkownika/roli.</span><span class="sxs-lookup"><span data-stu-id="d55c6-164">ASP.NET includes a built-in role management API as well as a built-in set of role providers (including ones for SQL and Active Directory) that can help perform this user/role mapping.</span></span> <span data-ttu-id="d55c6-165">Następnie możemy zaktualizować kod, aby umożliwić użytkownikom z określoną rolą "Administrator" dostęp do adresu URL/Dinners/Create:</span><span class="sxs-lookup"><span data-stu-id="d55c6-165">We could then update the code to only allow users within a specific "admin" role to access the /Dinners/Create URL:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample3.cs)]

### <a name="using-the-useridentityname-property-when-creating-dinners"></a><span data-ttu-id="d55c6-166">Używanie właściwości User.Identity.Name podczas tworzenia obiadów</span><span class="sxs-lookup"><span data-stu-id="d55c6-166">Using the User.Identity.Name property when Creating Dinners</span></span>

<span data-ttu-id="d55c6-167">Możemy pobrać nazwę użytkownika aktualnie zalogowanego użytkownika żądania przy użyciu właściwości User.Identity.Name uwidocznionej w klasie podstawowej kontrolera.</span><span class="sxs-lookup"><span data-stu-id="d55c6-167">We can retrieve the username of the currently logged-in user of a request using the User.Identity.Name property exposed on the Controller base class.</span></span>

<span data-ttu-id="d55c6-168">Wcześniej, gdy zaimplementowano wersję HTTP-POST metody akcji Create (), stałe Właściwość "HostedBy" obiadu do statycznego ciągu.</span><span class="sxs-lookup"><span data-stu-id="d55c6-168">Earlier when we implemented the HTTP-POST version of our Create() action method we had hardcoded the "HostedBy" property of the Dinner to a static string.</span></span> <span data-ttu-id="d55c6-169">Teraz możemy zaktualizować ten kod, aby użyć właściwości User.Identity.Name, a także automatycznie dodać RSVP dla hosta tworzącego obiad:</span><span class="sxs-lookup"><span data-stu-id="d55c6-169">We can now update this code to instead use the User.Identity.Name property, as well as automatically add an RSVP for the host creating the Dinner:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample4.cs)]

<span data-ttu-id="d55c6-170">Ze względu na to, że dodaliśmy atrybut [autoryzuje] do metody Create (), ASP.NET MVC zapewnia, że metoda akcji jest wykonywana tylko wtedy, gdy użytkownik odwiedzający adres URL/Dinners/Create jest zalogowany w witrynie.</span><span class="sxs-lookup"><span data-stu-id="d55c6-170">Because we have added an [Authorize] attribute to the Create() method, ASP.NET MVC ensures that the action method only executes if the user visiting the /Dinners/Create URL is logged in on the site.</span></span> <span data-ttu-id="d55c6-171">W związku z tym wartość właściwości User.Identity.Name zawsze będzie zawierać prawidłową nazwę użytkownika.</span><span class="sxs-lookup"><span data-stu-id="d55c6-171">As such, the User.Identity.Name property value will always contain a valid username.</span></span>

### <a name="using-the-useridentityname-property-when-editing-dinners"></a><span data-ttu-id="d55c6-172">Używanie właściwości User.Identity.Name podczas edytowania obiadów</span><span class="sxs-lookup"><span data-stu-id="d55c6-172">Using the User.Identity.Name property when Editing Dinners</span></span>

<span data-ttu-id="d55c6-173">Dodajmy teraz logikę autoryzacji, która ogranicza użytkowników, aby mogli edytować tylko te właściwości.</span><span class="sxs-lookup"><span data-stu-id="d55c6-173">Let's now add some authorization logic that restricts users so that they can only edit the properties of dinners they themselves are hosting.</span></span>

<span data-ttu-id="d55c6-174">Aby Ci pomóc, najpierw dodamy metodę pomocnika "IsHostedBy (username)" do naszego obiektu obiadu (w ramach klasy częściowej Dinner.cs, która została wcześniej utworzona).</span><span class="sxs-lookup"><span data-stu-id="d55c6-174">To help with this, we'll first add an "IsHostedBy(username)" helper method to our Dinner object (within the Dinner.cs partial class we built earlier).</span></span> <span data-ttu-id="d55c6-175">Ta metoda pomocnika zwraca wartość PRAWDA lub FAŁSZ w zależności od tego, czy podana nazwa użytkownika jest zgodna z właściwością HostedBy obiadu, i hermetyzuje logikę niezbędną do wykonania porównania ciągów z uwzględnieniem wielkości liter:</span><span class="sxs-lookup"><span data-stu-id="d55c6-175">This helper method returns true or false depending on whether a supplied username matches the Dinner HostedBy property, and encapsulates the logic necessary to perform a case-insensitive string comparison of them:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample5.cs)]

<span data-ttu-id="d55c6-176">Następnie dodamy atrybut [autoryzuje] do metod akcji Edit () w ramach naszej klasy DinnersController.</span><span class="sxs-lookup"><span data-stu-id="d55c6-176">We'll then add an [Authorize] attribute to the Edit() action methods within our DinnersController class.</span></span> <span data-ttu-id="d55c6-177">Dzięki temu użytkownicy muszą być zalogowani w celu zażądania adresu URL */Dinners/Edit/[ID]* .</span><span class="sxs-lookup"><span data-stu-id="d55c6-177">This will ensure that users must be logged in to request a */Dinners/Edit/[id]* URL.</span></span>

<span data-ttu-id="d55c6-178">Następnie możemy dodać kod do naszych metod edycji wykorzystujących metodę pomocnika obiad. IsHostedBy (username), aby sprawdzić, czy zalogowany użytkownik jest zgodny z hostem obiadu.</span><span class="sxs-lookup"><span data-stu-id="d55c6-178">We can then add code to our Edit methods that uses the Dinner.IsHostedBy(username) helper method to verify that the logged-in user matches the Dinner host.</span></span> <span data-ttu-id="d55c6-179">Jeśli użytkownik nie jest hostem, zostanie wyświetlony widok "InvalidOwner" i zakończenie żądania.</span><span class="sxs-lookup"><span data-stu-id="d55c6-179">If the user is not the host, we'll display an "InvalidOwner" view and terminate the request.</span></span> <span data-ttu-id="d55c6-180">Kod, aby to zrobić, wygląda jak poniżej:</span><span class="sxs-lookup"><span data-stu-id="d55c6-180">The code to do this looks like below:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample6.cs)]

<span data-ttu-id="d55c6-181">Następnie można kliknąć prawym przyciskiem myszy katalog \Views\Dinners i wybrać polecenie menu Dodaj&gt;widok, aby utworzyć nowy widok "InvalidOwner".</span><span class="sxs-lookup"><span data-stu-id="d55c6-181">We can then right-click on the \Views\Dinners directory and choose the Add-&gt;View menu command to create a new "InvalidOwner" view.</span></span> <span data-ttu-id="d55c6-182">Zapełnimy go następującym komunikatem o błędzie:</span><span class="sxs-lookup"><span data-stu-id="d55c6-182">We'll populate it with the below error message:</span></span>

[!code-aspx[Main](secure-applications-using-authentication-and-authorization/samples/sample7.aspx)]

<span data-ttu-id="d55c6-183">A teraz, gdy użytkownik próbuje edytować obiad, którego nie posiada, zostanie wyświetlony komunikat o błędzie:</span><span class="sxs-lookup"><span data-stu-id="d55c6-183">And now when a user attempts to edit a dinner they don't own, they'll get an error message:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image7.png)

<span data-ttu-id="d55c6-184">Możemy powtórzyć te same kroki dla metod akcji Delete () w naszym kontrolerze, aby zablokować uprawnienia do usuwania obiadów, a także upewnić się, że tylko host na obiad może go usunąć.</span><span class="sxs-lookup"><span data-stu-id="d55c6-184">We can repeat the same steps for the Delete() action methods within our controller to lock down permission to delete Dinners as well, and ensure that only the host of a Dinner can delete it.</span></span>

### <a name="showinghiding-edit-and-delete-links"></a><span data-ttu-id="d55c6-185">Wyświetlanie/ukrywanie linków do edycji i usuwania</span><span class="sxs-lookup"><span data-stu-id="d55c6-185">Showing/Hiding Edit and Delete Links</span></span>

<span data-ttu-id="d55c6-186">Łączymy się z metodą akcji Edytuj i Usuń dla naszej klasy DinnersController z naszego adresu URL szczegółów:</span><span class="sxs-lookup"><span data-stu-id="d55c6-186">We are linking to the Edit and Delete action method of our DinnersController class from our Details URL:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image8.png)

<span data-ttu-id="d55c6-187">Obecnie wyświetlamy linki do akcji Edytuj i Usuń, niezależnie od tego, czy odwiedzający adres URL jest hostem obiadu.</span><span class="sxs-lookup"><span data-stu-id="d55c6-187">Currently we are showing the Edit and Delete action links regardless of whether the visitor to the details URL is the host of the dinner.</span></span> <span data-ttu-id="d55c6-188">Zmieńmy to tak, aby linki były wyświetlane tylko wtedy, gdy użytkownik będący odwiedzający jest właścicielem obiadu.</span><span class="sxs-lookup"><span data-stu-id="d55c6-188">Let's change this so that the links are only displayed if the visiting user is the owner of the dinner.</span></span>

<span data-ttu-id="d55c6-189">Metoda akcji Details () w ramach DinnersController pobiera obiekt obiadu, a następnie przekazuje go jako obiekt modelu do naszego szablonu widoku:</span><span class="sxs-lookup"><span data-stu-id="d55c6-189">The Details() action method within our DinnersController retrieves a Dinner object and then passes it as the model object to our view template:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample8.cs)]

<span data-ttu-id="d55c6-190">Możemy zaktualizować nasz szablon widoku, aby warunkowo pokazać/ukryć linki Edytuj i Usuń za pomocą metody pomocnika obiad. IsHostedBy () podobnej do poniższego:</span><span class="sxs-lookup"><span data-stu-id="d55c6-190">We can update our view template to conditionally show/hide the Edit and Delete links by using the Dinner.IsHostedBy() helper method like below:</span></span>

[!code-aspx[Main](secure-applications-using-authentication-and-authorization/samples/sample9.aspx)]

#### <a name="next-steps"></a><span data-ttu-id="d55c6-191">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="d55c6-191">Next Steps</span></span>

<span data-ttu-id="d55c6-192">Teraz przyjrzyjmy się, jak możemy umożliwić użytkownikom uwierzytelnionym korzystanie z usługi RSVP w przypadku obiadów przy użyciu technologii AJAX.</span><span class="sxs-lookup"><span data-stu-id="d55c6-192">Let's now look at how we can enable authenticated users to RSVP for dinners using AJAX.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="d55c6-193">[Poprzednie](implement-efficient-data-paging.md)
> [dalej](use-ajax-to-deliver-dynamic-updates.md)</span><span class="sxs-lookup"><span data-stu-id="d55c6-193">[Previous](implement-efficient-data-paging.md)
[Next](use-ajax-to-deliver-dynamic-updates.md)</span></span>
