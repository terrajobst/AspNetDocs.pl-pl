---
uid: mvc/overview/older-versions-1/contact-manager/iteration-5-create-unit-tests-cs
title: 'Iteracja #5 — Tworzenie testów jednostkowych (C#) | Microsoft Docs'
author: microsoft
description: W piątej iteracji upraszczamy obsługę i modyfikację naszej aplikacji przez dodanie testów jednostkowych. Tworzymy nasze klasy modelu danych i Kompiluj testy jednostkowe dla o...
ms.author: riande
ms.date: 02/20/2009
ms.assetid: 28ad8f80-b8a5-444e-b478-8b15a846060c
msc.legacyurl: /mvc/overview/older-versions-1/contact-manager/iteration-5-create-unit-tests-cs
msc.type: authoredcontent
ms.openlocfilehash: 32e81cce34a0e0b1f6b01934334e1b66dce89651
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 03/06/2020
ms.locfileid: "78544304"
---
# <a name="iteration-5--create-unit-tests-c"></a><span data-ttu-id="9d6eb-104">Iteracja #5 — Tworzenie testów jednostkowych (C#)</span><span class="sxs-lookup"><span data-stu-id="9d6eb-104">Iteration #5 – Create unit tests (C#)</span></span>

<span data-ttu-id="9d6eb-105">przez [firmę Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="9d6eb-105">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="9d6eb-106">Pobierz kod</span><span class="sxs-lookup"><span data-stu-id="9d6eb-106">Download Code</span></span>](iteration-5-create-unit-tests-cs/_static/contactmanager_5_cs1.zip)

> <span data-ttu-id="9d6eb-107">W piątej iteracji upraszczamy obsługę i modyfikację naszej aplikacji przez dodanie testów jednostkowych.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-107">In the fifth iteration, we make our application easier to maintain and modify by adding unit tests.</span></span> <span data-ttu-id="9d6eb-108">Tworzymy klasy modelu danych i kompilujemy testy jednostkowe dla naszych kontrolerów i logiki walidacji.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-108">We mock our data model classes and build unit tests for our controllers and validation logic.</span></span>

## <a name="building-a-contact-management-aspnet-mvc-application-c"></a><span data-ttu-id="9d6eb-109">Tworzenie aplikacji do zarządzania kontaktami ASP.NET MVCC#()</span><span class="sxs-lookup"><span data-stu-id="9d6eb-109">Building a Contact Management ASP.NET MVC Application (C#)</span></span>

<span data-ttu-id="9d6eb-110">W tej serii samouczków tworzymy całą aplikację do zarządzania kontaktami od początku do końca.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-110">In this series of tutorials, we build an entire Contact Management application from start to finish.</span></span> <span data-ttu-id="9d6eb-111">Aplikacja Contact Manager umożliwia przechowywanie informacji kontaktowych — nazw, numerów telefonów i adresów e-mail — w celu uzyskania listy osób.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-111">The Contact Manager application enables you to store contact information - names, phone numbers and email addresses - for a list of people.</span></span>

<span data-ttu-id="9d6eb-112">Aplikacja została utworzona przez wiele iteracji.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-112">We build the application over multiple iterations.</span></span> <span data-ttu-id="9d6eb-113">W przypadku każdej iteracji stopniowo ulepszamy aplikację.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-113">With each iteration, we gradually improve the application.</span></span> <span data-ttu-id="9d6eb-114">Celem tej wielu iteracji jest umożliwienie zrozumienia przyczyny każdej zmiany.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-114">The goal of this multiple iteration approach is to enable you to understand the reason for each change.</span></span>

- <span data-ttu-id="9d6eb-115">#1 iteracji — Utwórz aplikację.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-115">Iteration #1 - Create the application.</span></span> <span data-ttu-id="9d6eb-116">W pierwszej iteracji tworzymy Menedżera kontaktów w najprostszy sposób.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-116">In the first iteration, we create the Contact Manager in the simplest way possible.</span></span> <span data-ttu-id="9d6eb-117">Dodaliśmy obsługę podstawowych operacji bazy danych: Tworzenie, odczytywanie, aktualizowanie i usuwanie (CRUD).</span><span class="sxs-lookup"><span data-stu-id="9d6eb-117">We add support for basic database operations: Create, Read, Update, and Delete (CRUD).</span></span>

- <span data-ttu-id="9d6eb-118">Iteracja #2 — Zwiększ wygląd aplikacji.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-118">Iteration #2 - Make the application look nice.</span></span> <span data-ttu-id="9d6eb-119">W tej iteracji ulepszamy wygląd aplikacji, modyfikując domyślną stronę wzorcową widoku MVC ASP.NET i kaskadowy arkusz stylów.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-119">In this iteration, we improve the appearance of the application by modifying the default ASP.NET MVC view master page and cascading style sheet.</span></span>

- <span data-ttu-id="9d6eb-120">Iteracja #3 — Dodawanie walidacji formularza.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-120">Iteration #3 - Add form validation.</span></span> <span data-ttu-id="9d6eb-121">W trzeciej iteracji zostanie dodana podstawowa Walidacja formularza.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-121">In the third iteration, we add basic form validation.</span></span> <span data-ttu-id="9d6eb-122">Uniemożliwiamy użytkownikom przesyłanie formularza bez wykonywania wymaganych pól formularza.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-122">We prevent people from submitting a form without completing required form fields.</span></span> <span data-ttu-id="9d6eb-123">Sprawdzamy również adresy e-mail i numery telefonów.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-123">We also validate email addresses and phone numbers.</span></span>

- <span data-ttu-id="9d6eb-124">Iteracja #4 — możliwość swobodnego łączenia aplikacji.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-124">Iteration #4 - Make the application loosely coupled.</span></span> <span data-ttu-id="9d6eb-125">W tej czwartej iteracji wykorzystujemy kilka wzorców projektowych oprogramowania, aby ułatwić konserwację i modyfikowanie aplikacji Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-125">In this fourth iteration, we take advantage of several software design patterns to make it easier to maintain and modify the Contact Manager application.</span></span> <span data-ttu-id="9d6eb-126">Na przykład Refaktoryzacja naszej aplikacji używa wzorca repozytorium i wzorca iniekcji zależności.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-126">For example, we refactor our application to use the Repository pattern and the Dependency Injection pattern.</span></span>

- <span data-ttu-id="9d6eb-127">#5 iteracji — Utwórz testy jednostkowe.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-127">Iteration #5 - Create unit tests.</span></span> <span data-ttu-id="9d6eb-128">W piątej iteracji upraszczamy obsługę i modyfikację naszej aplikacji przez dodanie testów jednostkowych.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-128">In the fifth iteration, we make our application easier to maintain and modify by adding unit tests.</span></span> <span data-ttu-id="9d6eb-129">Tworzymy klasy modelu danych i kompilujemy testy jednostkowe dla naszych kontrolerów i logiki walidacji.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-129">We mock our data model classes and build unit tests for our controllers and validation logic.</span></span>

- <span data-ttu-id="9d6eb-130">Iteracja #6 — Użyj programowania opartego na testach.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-130">Iteration #6 - Use test-driven development.</span></span> <span data-ttu-id="9d6eb-131">W tej szóstej iteracji Dodaliśmy nowe funkcje do naszej aplikacji, pisząc testy jednostkowe jako pierwsze i pisząc kod na testach jednostkowych.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-131">In this sixth iteration, we add new functionality to our application by writing unit tests first and writing code against the unit tests.</span></span> <span data-ttu-id="9d6eb-132">W tej iteracji dodamy grupy kontaktów.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-132">In this iteration, we add contact groups.</span></span>

- <span data-ttu-id="9d6eb-133">Iteracja #7 — Dodawanie funkcji AJAX.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-133">Iteration #7 - Add Ajax functionality.</span></span> <span data-ttu-id="9d6eb-134">W siódmej iteracji poprawimy czas reakcji i wydajność naszej aplikacji przez dodanie obsługi technologii AJAX.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-134">In the seventh iteration, we improve the responsiveness and performance of our application by adding support for Ajax.</span></span>

## <a name="this-iteration"></a><span data-ttu-id="9d6eb-135">Ta iteracja</span><span class="sxs-lookup"><span data-stu-id="9d6eb-135">This Iteration</span></span>

<span data-ttu-id="9d6eb-136">W poprzedniej iteracji aplikacji Contact Manager firma Microsoft Refaktoryzacja aplikację, aby była bardziej luźno powiązana.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-136">In the previous iteration of the Contact Manager application, we refactored the application to be more loosely coupled.</span></span> <span data-ttu-id="9d6eb-137">Aplikacja została oddzielona do odrębnych warstw kontrolera, usług i repozytorium.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-137">We separated the application into distinct controller, service, and repository layers.</span></span> <span data-ttu-id="9d6eb-138">Każda warstwa współdziała z warstwą znajdującą się poniżej za pomocą interfejsów.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-138">Each layer interacts with the layer beneath it through interfaces.</span></span>

<span data-ttu-id="9d6eb-139">Aplikacja została Refaktoryzacja, aby ułatwić jej zachowanie i modyfikację.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-139">We refactored the application to make the application easier to maintain and modify.</span></span> <span data-ttu-id="9d6eb-140">Jeśli na przykład będziemy musieli użyć nowej technologii dostępu do danych, można po prostu zmienić warstwę repozytorium bez dotknięcia kontrolera lub warstwy usług.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-140">For example, if we need to use a new data access technology, we can simply change the repository layer without touching the controller or service layer.</span></span> <span data-ttu-id="9d6eb-141">Dzięki połączeniu z Menedżerem kontaktów luźno powiązana aplikacja została bardziej odporna na zmianę.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-141">By making the Contact Manager loosely coupled, we ve made the application more resilient to change.</span></span>

<span data-ttu-id="9d6eb-142">Ale co się stanie, gdy będziemy musiał dodać nową funkcję do aplikacji Contact Manager?</span><span class="sxs-lookup"><span data-stu-id="9d6eb-142">But, what happens when we need to add a new feature to the Contact Manager application?</span></span> <span data-ttu-id="9d6eb-143">Lub co się stanie, gdy naprawimy usterkę?</span><span class="sxs-lookup"><span data-stu-id="9d6eb-143">Or, what happens when we fix a bug?</span></span> <span data-ttu-id="9d6eb-144">Dokument SAD, ale dobrze sprawdzono, prawdziwie pisania kodu polega na tym, że po każdym dotknięciu kodu utworzysz ryzyko wprowadzenia nowych usterek.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-144">A sad, but well proven, truth of writing code is that whenever you touch code you create the risk of introducing new bugs.</span></span>

<span data-ttu-id="9d6eb-145">Na przykład jeden dzień, Menedżer może zażądać dodania nowej funkcji do Menedżera kontaktów.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-145">For example, one fine day, your manager might ask you to add a new feature to the Contact Manager.</span></span> <span data-ttu-id="9d6eb-146">Chce dodać obsługę grup kontaktów.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-146">She wants you to add support for Contact Groups.</span></span> <span data-ttu-id="9d6eb-147">Chce umożliwić użytkownikom organizowanie swoich kontaktów w grupy, takie jak znajomi, firma i tak dalej.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-147">She wants you to enable users to organize their contacts into groups such as Friends, Business, and so on.</span></span>

<span data-ttu-id="9d6eb-148">W celu zaimplementowania tej nowej funkcji należy zmodyfikować wszystkie trzy warstwy aplikacji Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-148">In order to implement this new feature, you'll need to modify all three layers of the Contact Manager application.</span></span> <span data-ttu-id="9d6eb-149">Należy dodać nowe funkcje do kontrolerów, warstwy usług i repozytorium.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-149">You'll need to add new functionality to the controllers, the service layer, and the repository.</span></span> <span data-ttu-id="9d6eb-150">Od razu po rozpoczęciu modyfikowania kodu zostanie podwyższone ryzyko naruszenia funkcjonalności, która działała wcześniej.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-150">As soon as you start modifying code, you risk breaking functionality that worked before.</span></span>

<span data-ttu-id="9d6eb-151">Jest to dobry efekt refaktoryzacji naszej aplikacji do osobnych warstw.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-151">Refactoring our application into separate layers, as we did in the previous iteration, was a good thing.</span></span> <span data-ttu-id="9d6eb-152">Było to dobry efekt, ponieważ umożliwia nam wprowadzanie zmian w całych warstwach bez dotykania reszty aplikacji.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-152">It was a good thing because it enables us to make changes to entire layers without touching the rest of the application.</span></span> <span data-ttu-id="9d6eb-153">Jeśli jednak chcesz, aby kod w ramach warstwy był łatwiejszy do utrzymania i modyfikacji, musisz utworzyć testy jednostkowe dla kodu.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-153">However, if you want to make the code within a layer easier to maintain and modify, you need to create unit tests for the code.</span></span>

<span data-ttu-id="9d6eb-154">Do testowania pojedynczej jednostki kodu służy test jednostkowy.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-154">You use a unit test to test an individual unit of code.</span></span> <span data-ttu-id="9d6eb-155">Te jednostki kodu są mniejsze niż w przypadku całej warstwy aplikacji.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-155">These units of code are smaller than entire application layers.</span></span> <span data-ttu-id="9d6eb-156">Zazwyczaj należy użyć testu jednostkowego, aby sprawdzić, czy dana metoda w kodzie działa w oczekiwany sposób.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-156">Typically, you use a unit test to verify whether a particular method in your code behaves in the way that you expect.</span></span> <span data-ttu-id="9d6eb-157">Na przykład można utworzyć test jednostkowy dla metody "ContactManagerService" () uwidocznionej przez klasę usługi.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-157">For example, you would create a unit test for the CreateContact() method exposed by the ContactManagerService class.</span></span>

<span data-ttu-id="9d6eb-158">Testy jednostkowe aplikacji działają podobnie jak w przypadku zabezpieczeń sieci.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-158">The unit tests for an application work just like a safety net.</span></span> <span data-ttu-id="9d6eb-159">Za każdym razem, gdy modyfikujesz kod w aplikacji, możesz uruchomić zestaw testów jednostkowych, aby sprawdzić, czy modyfikacja przerywa istniejące funkcje.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-159">Whenever you modify code in an application, you can run a set of unit tests to check whether the modification breaks existing functionality.</span></span> <span data-ttu-id="9d6eb-160">Testy jednostkowe sprawiają, że kod można bezpiecznie modyfikować.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-160">Unit tests make your code safe to modify.</span></span> <span data-ttu-id="9d6eb-161">Testy jednostkowe sprawiają, że cały kod w aplikacji jest bardziej odporny na zmianę.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-161">Unit tests make all of the code in your application more resilient to change.</span></span>

<span data-ttu-id="9d6eb-162">W tej iteracji dodamy testy jednostkowe do naszej aplikacji Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-162">In this iteration, we add unit tests to our Contact Manager application.</span></span> <span data-ttu-id="9d6eb-163">Dzięki temu w następnej iteracji możemy dodać grupy kontaktów do naszej aplikacji bez konieczności przerywania istniejących funkcji.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-163">That way, in the next iteration, we can add Contact Groups to our application without worrying about breaking existing functionality.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="9d6eb-164">Istnieją różne platformy testowania jednostkowego, w tym NUnit, xUnit.net i MbUnit.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-164">There are a variety of unit testing frameworks including NUnit, xUnit.net, and MbUnit.</span></span> <span data-ttu-id="9d6eb-165">W tym samouczku używamy struktury testów jednostkowych dołączonej do programu Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-165">In this tutorial, we use the unit testing framework included with Visual Studio.</span></span> <span data-ttu-id="9d6eb-166">Można jednak równie łatwo korzystać z jednej z tych alternatywnych platform.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-166">However, you could just as easily use one of these alternative frameworks.</span></span>

## <a name="what-gets-tested"></a><span data-ttu-id="9d6eb-167">Co zostanie przetestowane</span><span class="sxs-lookup"><span data-stu-id="9d6eb-167">What Gets Tested</span></span>

<span data-ttu-id="9d6eb-168">W idealnym świecie cały kod zostanie objęty testami jednostkowymi.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-168">In the perfect world, all of your code would be covered by unit tests.</span></span> <span data-ttu-id="9d6eb-169">W idealnym świecie będziesz mieć doskonałe bezpieczeństwo sieci.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-169">In the perfect world, you would have the perfect safety net.</span></span> <span data-ttu-id="9d6eb-170">Można modyfikować każdą linię kodu w aplikacji i natychmiast wiedzieć, wykonując testy jednostkowe, niezależnie od tego, czy zmiana nie powoduje zerwania istniejących funkcji.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-170">You would be able to modify any line of code in your application and know instantly, by executing your unit tests, whether the change broke existing functionality.</span></span>

<span data-ttu-id="9d6eb-171">Jednak firma Microsoft nie pracuje na doskonałym świecie.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-171">However, we don t live in a perfect world.</span></span> <span data-ttu-id="9d6eb-172">W przypadku pisania testów jednostkowych skoncentrowano się na pisaniu testów dla logiki biznesowej (na przykład logiki walidacji).</span><span class="sxs-lookup"><span data-stu-id="9d6eb-172">In practice, when writing unit tests, you concentrate on writing tests for your business logic (for example, validation logic).</span></span> <span data-ttu-id="9d6eb-173">W szczególności *nie są* zapisywane testy jednostkowe dla logiki dostępu do danych ani do logiki widoku.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-173">In particular, you *do not* write unit tests for your data access logic or your view logic.</span></span>

<span data-ttu-id="9d6eb-174">Aby być przydatne, testy jednostkowe muszą być wykonywane bardzo szybko.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-174">To be useful, unit tests must execute very quickly.</span></span> <span data-ttu-id="9d6eb-175">Można łatwo zbierać setki (lub nawet tysiące) testów jednostkowych dla aplikacji.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-175">You easily can accumulate hundreds (or even thousands) of unit tests for an application.</span></span> <span data-ttu-id="9d6eb-176">Jeśli uruchomienie testów jednostkowych potrwa dużo czasu, należy unikać ich wykonywania.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-176">If the unit tests take a long time to run then you'll avoid executing them.</span></span> <span data-ttu-id="9d6eb-177">Innymi słowy, długotrwałe testy jednostkowe są bezużyteczne do celów kodowania od dnia do dnia.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-177">In other words, long running unit tests are useless for day to day coding purposes.</span></span>

<span data-ttu-id="9d6eb-178">Z tego powodu zazwyczaj nie należy pisać testów jednostkowych dla kodu, który współdziała z bazą danych.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-178">For this reason, you typically do not write unit tests for code that interacts with a database.</span></span> <span data-ttu-id="9d6eb-179">Uruchamianie setek testów jednostkowych względem aktywnej bazy danych byłoby zbyt wolne.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-179">Running hundreds of unit tests against a live database would be too slow.</span></span> <span data-ttu-id="9d6eb-180">Zamiast tego należy zasymulować bazę danych i napisać kod, który współdziała z bazą danych z makietą (omawiamy sposób tworzenia bazy danych poniżej).</span><span class="sxs-lookup"><span data-stu-id="9d6eb-180">Instead, you mock your database and write code that interacts with the mock database (we discuss mocking a database below).</span></span>

<span data-ttu-id="9d6eb-181">Z podobnej przyczyny zazwyczaj nie są zapisywane testy jednostkowe dla widoków.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-181">For a similar reason, you typically do not write unit tests for views.</span></span> <span data-ttu-id="9d6eb-182">Aby przetestować widok, należy uruchomić serwer sieci Web.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-182">In order to test a view, you must spin up a web server.</span></span> <span data-ttu-id="9d6eb-183">Ponieważ połączenie serwera sieci Web jest procesem stosunkowo wolno, tworzenie testów jednostkowych dla widoków nie jest zalecane.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-183">Because spinning up a web server is a relatively slow process, creating unit tests for your views is not recommended.</span></span>

<span data-ttu-id="9d6eb-184">Jeśli widok zawiera skomplikowaną logikę, należy rozważyć przeniesienie logiki do metod pomocnika.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-184">If your view contains complicated logic then you should consider moving the logic into Helper methods.</span></span> <span data-ttu-id="9d6eb-185">Można napisać testy jednostkowe dla metod pomocniczych, które są wykonywane bez nawirowania serwera sieci Web.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-185">You can write unit tests for Helper methods that execute without spinning up a web server.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="9d6eb-186">Podczas pisania testów logiki dostępu do danych lub logiki widoku nie jest dobrym pomysłem podczas pisania testów jednostkowych, te testy mogą być bardzo cenne podczas tworzenia testów funkcjonalnych lub integracji.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-186">While writing tests for data access logic or view logic is not a good idea when writing unit tests, these tests can be very valuable when building functional or integration tests.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="9d6eb-187">ASP.NET MVC to aparat widoku formularzy sieci Web.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-187">ASP.NET MVC is the Web Forms View Engine.</span></span> <span data-ttu-id="9d6eb-188">Gdy aparat widoku formularzy sieci Web jest zależny od serwera sieci Web, inne aparaty widoków mogą nie być.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-188">While the Web Forms View Engine is dependent on a web server, other view engines might not be.</span></span>

## <a name="using-a-mock-object-framework"></a><span data-ttu-id="9d6eb-189">Korzystanie z struktury obiektów makiety</span><span class="sxs-lookup"><span data-stu-id="9d6eb-189">Using a Mock Object Framework</span></span>

<span data-ttu-id="9d6eb-190">Podczas kompilowania testów jednostkowych niemal zawsze trzeba skorzystać z struktury obiektów makiety.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-190">When building unit tests, you almost always need to take advantage of a Mock Object framework.</span></span> <span data-ttu-id="9d6eb-191">Struktura obiektów makiety umożliwia tworzenie makiet i wycinków klas w aplikacji.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-191">A Mock Object framework enables you to create mocks and stubs for the classes in your application.</span></span>

<span data-ttu-id="9d6eb-192">Na przykład można użyć struktury obiektu makiety do wygenerowania makiety klasy repozytorium.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-192">For example, you can use a Mock Object framework to generate a mock version of your repository class.</span></span> <span data-ttu-id="9d6eb-193">W ten sposób można użyć klasy repozytorium makiety zamiast rzeczywistej klasy repozytorium w testach jednostkowych.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-193">That way, you can use the mock repository class instead of the real repository class in your unit tests.</span></span> <span data-ttu-id="9d6eb-194">Użycie repozytorium makiety pozwala uniknąć wykonywania kodu bazy danych podczas wykonywania testu jednostkowego.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-194">Using the mock repository enables you to avoid executing database code when executing a unit test.</span></span>

<span data-ttu-id="9d6eb-195">Program Visual Studio nie zawiera struktury obiektów makiety.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-195">Visual Studio does not include a Mock Object framework.</span></span> <span data-ttu-id="9d6eb-196">Istnieje jednak kilka struktur obiektów dla programu .NET Framework komercyjnych i otwartych źródeł:</span><span class="sxs-lookup"><span data-stu-id="9d6eb-196">However, there are several commercial and open source Mock Object frameworks available for the .NET framework:</span></span>

1. <span data-ttu-id="9d6eb-197">MOQ — Platforma ta jest dostępna w ramach licencji Open Source systemu BSD.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-197">Moq - This framework is available under the open source BSD license.</span></span> <span data-ttu-id="9d6eb-198">Możesz pobrać MOQ z [https://code.google.com/p/moq/](https://code.google.com/p/moq/).</span><span class="sxs-lookup"><span data-stu-id="9d6eb-198">You can download Moq from [https://code.google.com/p/moq/](https://code.google.com/p/moq/).</span></span>
2. <span data-ttu-id="9d6eb-199">Makiety Rhino — Ta struktura jest dostępna w ramach licencji Open Source systemu BSD.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-199">Rhino Mocks - This framework is available under the open source BSD license.</span></span> <span data-ttu-id="9d6eb-200">Makiety Rhino można pobrać z [http://ayende.com/projects/rhino-mocks.aspx](http://ayende.com/projects/rhino-mocks.aspx).</span><span class="sxs-lookup"><span data-stu-id="9d6eb-200">You can download Rhino Mocks from [http://ayende.com/projects/rhino-mocks.aspx](http://ayende.com/projects/rhino-mocks.aspx).</span></span>
3. <span data-ttu-id="9d6eb-201">Typemock Isolator — to jest platforma komercyjna.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-201">Typemock Isolator - This is a commercial framework.</span></span> <span data-ttu-id="9d6eb-202">Wersję próbną można pobrać z [http://www.typemock.com/](http://www.typemock.com/).</span><span class="sxs-lookup"><span data-stu-id="9d6eb-202">You can download a trial version from [http://www.typemock.com/](http://www.typemock.com/).</span></span>

<span data-ttu-id="9d6eb-203">W tym samouczku postanowiono używać MOQ.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-203">In this tutorial, I decided to use Moq.</span></span> <span data-ttu-id="9d6eb-204">Można jednak równie łatwo używać Rhinoów lub Isolator Typemock do tworzenia obiektów makiety dla aplikacji Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-204">However, you could just as easily use Rhino Mocks or Typemock Isolator to create the Mock objects for the Contact Manager application.</span></span>

<span data-ttu-id="9d6eb-205">Aby można było korzystać z MOQ, należy wykonać następujące czynności:</span><span class="sxs-lookup"><span data-stu-id="9d6eb-205">Before you can use Moq, you need to complete the following steps:</span></span>

1. <span data-ttu-id="9d6eb-206">.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-206">.</span></span>
2. <span data-ttu-id="9d6eb-207">Przed rozpakowaniem pobranego pliku upewnij się, że kliknięto prawym przyciskiem myszy plik, a następnie kliknij przycisk zatytułowany **Odblokuj** (patrz rysunek 1).</span><span class="sxs-lookup"><span data-stu-id="9d6eb-207">Before you unzip the download, make sure that you right-click the file and click the button labeled **Unblock** (see Figure 1).</span></span>
3. <span data-ttu-id="9d6eb-208">Rozpakuj pobieranie.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-208">Unzip the download.</span></span>
4. <span data-ttu-id="9d6eb-209">Dodaj odwołanie do zestawu MOQ, klikając prawym przyciskiem myszy folder References w projekcie ContactManager. Tests i wybierając pozycję **Dodaj odwołanie**.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-209">Add a reference to the Moq assembly by right-clicking the References folder in the ContactManager.Tests project and selecting **Add Reference**.</span></span> <span data-ttu-id="9d6eb-210">Na karcie przeglądanie przejdź do folderu, w którym został rozpakowany MOQ, a następnie wybierz zestaw MOQ. dll.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-210">Under the Browse tab, browse to the folder where you unzipped Moq and select the Moq.dll assembly.</span></span> <span data-ttu-id="9d6eb-211">Kliknij przycisk **OK**.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-211">Click the **OK** button.</span></span>
5. <span data-ttu-id="9d6eb-212">Po wykonaniu tych kroków folder odwołań powinien wyglądać jak rysunek 2.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-212">After you complete these steps, your References folder should look like Figure 2.</span></span>

<span data-ttu-id="9d6eb-213">[![odblokowywanie MOQ](iteration-5-create-unit-tests-cs/_static/image1.jpg)](iteration-5-create-unit-tests-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="9d6eb-213">[![Unblocking Moq](iteration-5-create-unit-tests-cs/_static/image1.jpg)](iteration-5-create-unit-tests-cs/_static/image1.png)</span></span>

<span data-ttu-id="9d6eb-214">**Ilustracja 01**. Odblokowywanie MOQ ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](iteration-5-create-unit-tests-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="9d6eb-214">**Figure 01**: Unblocking Moq([Click to view full-size image](iteration-5-create-unit-tests-cs/_static/image2.png))</span></span>

<span data-ttu-id="9d6eb-215">[Odwołania ![po dodaniu MOQ](iteration-5-create-unit-tests-cs/_static/image2.jpg)](iteration-5-create-unit-tests-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="9d6eb-215">[![References after adding Moq](iteration-5-create-unit-tests-cs/_static/image2.jpg)](iteration-5-create-unit-tests-cs/_static/image3.png)</span></span>

<span data-ttu-id="9d6eb-216">**Ilustracja 02**: odwołania po dodaniu MOQ ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](iteration-5-create-unit-tests-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="9d6eb-216">**Figure 02**: References after adding Moq([Click to view full-size image](iteration-5-create-unit-tests-cs/_static/image4.png))</span></span>

## <a name="creating-unit-tests-for-the-service-layer"></a><span data-ttu-id="9d6eb-217">Tworzenie testów jednostkowych dla warstwy usług</span><span class="sxs-lookup"><span data-stu-id="9d6eb-217">Creating Unit Tests for the Service Layer</span></span>

<span data-ttu-id="9d6eb-218">Zacznij od utworzenia zestawu testów jednostkowych dla naszej warstwy usług aplikacji menedżera kontaktów.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-218">Let s start by creating a set of unit tests for our Contact Manager application s service layer.</span></span> <span data-ttu-id="9d6eb-219">Będziemy używać tych testów do weryfikacji logiki walidacji.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-219">We'll use these tests to verify our validation logic.</span></span>

<span data-ttu-id="9d6eb-220">Utwórz nowy folder o nazwie models w projekcie ContactManager. tests.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-220">Create a new folder named Models in the ContactManager.Tests project.</span></span> <span data-ttu-id="9d6eb-221">Następnie kliknij prawym przyciskiem myszy folder modele i wybierz polecenie **Dodaj, nowy test**.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-221">Next, right-click the Models folder and select **Add, New Test**.</span></span> <span data-ttu-id="9d6eb-222">Zostanie wyświetlone okno dialogowe **Dodawanie nowego testu** pokazane na rysunku 3.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-222">The **Add New Test** dialog shown in Figure 3 appears.</span></span> <span data-ttu-id="9d6eb-223">Wybierz szablon **testu jednostkowego** i nazwij nowy test ContactManagerServiceTest.cs.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-223">Select the **Unit Test** template and name your new test ContactManagerServiceTest.cs.</span></span> <span data-ttu-id="9d6eb-224">Kliknij przycisk **OK** , aby dodać nowy test do projektu testowego.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-224">Click the **OK** button to add your new test to your Test Project.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="9d6eb-225">Ogólnie rzecz biorąc, struktura folderów projektu testowego powinna być zgodna ze strukturą folderów projektu MVC ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-225">In general, you want the folder structure of your Test Project to match the folder structure of your ASP.NET MVC project.</span></span> <span data-ttu-id="9d6eb-226">Na przykład umieszczasz testy kontrolera w folderze controllers, modeluje testy w folderze modeli i tak dalej.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-226">For example, you place controller tests in a Controllers folder, model tests in a Models folder, and so on.</span></span>

<span data-ttu-id="9d6eb-227">[![Models\ContactManagerServiceTest.cs](iteration-5-create-unit-tests-cs/_static/image3.jpg)](iteration-5-create-unit-tests-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="9d6eb-227">[![Models\ContactManagerServiceTest.cs](iteration-5-create-unit-tests-cs/_static/image3.jpg)](iteration-5-create-unit-tests-cs/_static/image5.png)</span></span>

<span data-ttu-id="9d6eb-228">**Ilustracja 03**: Models\ContactManagerServiceTest.cs ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](iteration-5-create-unit-tests-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="9d6eb-228">**Figure 03**: Models\ContactManagerServiceTest.cs([Click to view full-size image](iteration-5-create-unit-tests-cs/_static/image6.png))</span></span>

<span data-ttu-id="9d6eb-229">Początkowo chcemy przetestować metodę my Contact () uwidocznioną przez klasę ContactManagerService.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-229">Initially, we want to test the CreateContact() method exposed by the ContactManagerService class.</span></span> <span data-ttu-id="9d6eb-230">Utworzymy następujące pięć testów:</span><span class="sxs-lookup"><span data-stu-id="9d6eb-230">We'll create the following five tests:</span></span>

- <span data-ttu-id="9d6eb-231">GetContact () — testuje, że element nocontact () zwraca wartość true, gdy prawidłowy kontakt jest przekazaniem do metody.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-231">CreateContact() - Tests that CreateContact() returns the value true when a valid Contact is passed to the method.</span></span>
- <span data-ttu-id="9d6eb-232">CreateContactRequiredFirstName () — testuje, że komunikat o błędzie jest dodawany do stanu modelu, gdy kontakt z brakującą nazwą jest przesyłany do metody oncontact ().</span><span class="sxs-lookup"><span data-stu-id="9d6eb-232">CreateContactRequiredFirstName() - Tests that an error message is added to model state when a Contact with a missing first name is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="9d6eb-233">CreateContactRequiredLastName () — testuje, że komunikat o błędzie jest dodawany do stanu modelu, gdy kontakt z brakującą nazwiskiem jest przesyłany do metody oncontact ().</span><span class="sxs-lookup"><span data-stu-id="9d6eb-233">CreateContactRequiredLastName() - Tests that an error message is added to model state when a Contact with a missing last name is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="9d6eb-234">CreateContactInvalidPhone () — testuje, że komunikat o błędzie jest dodawany do stanu modelu, gdy kontakt z nieprawidłowym numerem telefonu jest przesyłany do metody oncontact ().</span><span class="sxs-lookup"><span data-stu-id="9d6eb-234">CreateContactInvalidPhone() - Tests that an error message is added to model state when a Contact with an invalid phone number is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="9d6eb-235">CreateContactInvalidEmail () — testuje, że komunikat o błędzie jest dodawany do stanu modelu, gdy kontakt z nieprawidłowym adresem e-mail jest przesyłany do metody oncontact ().</span><span class="sxs-lookup"><span data-stu-id="9d6eb-235">CreateContactInvalidEmail() - Tests that an error message is added to model state when a Contact with an invalid email address is passed to the CreateContact() method..</span></span>

<span data-ttu-id="9d6eb-236">Pierwszy test weryfikuje, czy prawidłowy kontakt nie generuje błędu walidacji.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-236">The first test verifies that a valid Contact does not generate a validation error.</span></span> <span data-ttu-id="9d6eb-237">Pozostałe testy sprawdzają każdą z reguł walidacji.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-237">The remaining tests check each of the validation rules.</span></span>

<span data-ttu-id="9d6eb-238">Kod dla tych testów znajduje się na liście 1.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-238">The code for these tests is contained in Listing 1.</span></span>

<span data-ttu-id="9d6eb-239">**Lista 1 — Models\ContactManagerServiceTest.cs**</span><span class="sxs-lookup"><span data-stu-id="9d6eb-239">**Listing 1 - Models\ContactManagerServiceTest.cs**</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample1.cs)]

<span data-ttu-id="9d6eb-240">Ponieważ korzystamy z klasy Contact w aukcji 1, musimy dodać odwołanie do Entity Framework firmy Microsoft do naszego projektu testowego.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-240">Because we use the Contact class in Listing 1, we need to add a reference to the Microsoft Entity Framework to our Test project.</span></span> <span data-ttu-id="9d6eb-241">Dodaj odwołanie do zestawu System. Data. Entity.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-241">Add a reference to the System.Data.Entity assembly.</span></span>

<span data-ttu-id="9d6eb-242">Lista 1 zawiera metodę o nazwie Initialize (), która ma atrybut [TestInitialize].</span><span class="sxs-lookup"><span data-stu-id="9d6eb-242">Listing 1 contains a method named Initialize() that is decorated with the [TestInitialize] attribute.</span></span> <span data-ttu-id="9d6eb-243">Ta metoda jest wywoływana automatycznie przed uruchomieniem każdego z testów jednostkowych (jest wywoływana 5 razy bezpośrednio przed każdym z testów jednostkowych).</span><span class="sxs-lookup"><span data-stu-id="9d6eb-243">This method is called automatically before each of the unit tests is run (it is called 5 times right before each of the unit tests).</span></span> <span data-ttu-id="9d6eb-244">Metoda Initialize () tworzy repozytorium makiety z następującym wierszem kodu:</span><span class="sxs-lookup"><span data-stu-id="9d6eb-244">The Initialize() method creates a mock repository with the following line of code:</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample2.cs)]

<span data-ttu-id="9d6eb-245">Ten wiersz kodu używa struktury MOQ do generowania repozytorium makiety z interfejsu IContactManagerRepository.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-245">This line of code uses the Moq framework to generate a mock repository from the IContactManagerRepository interface.</span></span> <span data-ttu-id="9d6eb-246">Repozytorium makiety jest używane zamiast rzeczywistego EntityContactManagerRepository, aby uniknąć uzyskiwania dostępu do bazy danych podczas uruchamiania każdego testu jednostkowego.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-246">The mock repository is used instead of the actual EntityContactManagerRepository to avoid accessing the database when each unit test is run.</span></span> <span data-ttu-id="9d6eb-247">Repozytorium makiety implementuje metody interfejsu IContactManagerRepository, ale metody not nie wykonują żadnego działania.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-247">The mock repository implements the methods of the IContactManagerRepository interface, but the methods don t actually do anything.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="9d6eb-248">W przypadku korzystania z MOQ Framework istnieje rozróżnienie między \_mockRepository i \_mockRepository. Object.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-248">When using the Moq framework, there is a distinction between \_mockRepository and \_mockRepository.Object.</span></span> <span data-ttu-id="9d6eb-249">Dawna odwołuje się&lt;do formy IContactManagerRepository, która&gt; Klasa, która zawiera metody określania sposobu zachowania repozytorium makiety.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-249">The former refers to the Mock&lt;IContactManagerRepository&gt; class that contains methods for specifying how the mock repository will behave.</span></span> <span data-ttu-id="9d6eb-250">Ta ostatnia odwołuje się do rzeczywistego repozytorium makiety, które implementuje interfejs IContactManagerRepository.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-250">The latter refers to the actual mock repository that implements the IContactManagerRepository interface.</span></span>

<span data-ttu-id="9d6eb-251">Repozytorium makiety jest używane w metodzie Initialize () podczas tworzenia wystąpienia klasy ContactManagerService.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-251">The mock repository is used in the Initialize() method when creating an instance of the ContactManagerService class.</span></span> <span data-ttu-id="9d6eb-252">Wszystkie testy jednostkowe są używane w tym wystąpieniu klasy ContactManagerService.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-252">All of the individual unit tests use this instance of the ContactManagerService class.</span></span>

<span data-ttu-id="9d6eb-253">Lista 1 zawiera pięć metod, które odpowiadają każdej z testów jednostkowych.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-253">Listing 1 contains five methods that correspond to each of the unit tests.</span></span> <span data-ttu-id="9d6eb-254">Każda z tych metod ma atrybut [TestMethod].</span><span class="sxs-lookup"><span data-stu-id="9d6eb-254">Each of these methods is decorated with the [TestMethod] attribute.</span></span> <span data-ttu-id="9d6eb-255">Po uruchomieniu testów jednostkowych każda metoda, która ma ten atrybut jest wywoływana.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-255">When you run the unit tests, any method that has this attribute is called.</span></span> <span data-ttu-id="9d6eb-256">Innymi słowy, każda metoda, która jest uzupełniona atrybutem [TestMethod] jest testem jednostkowym.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-256">In other words, any method that is decorated with the [TestMethod] attribute is a unit test.</span></span>

<span data-ttu-id="9d6eb-257">Pierwszy test jednostkowy o nazwie CreateInstance () sprawdza, czy wywołanie metody CreateInstance () zwraca wartość true, gdy do metody jest przenoszona prawidłowe wystąpienie klasy Contact.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-257">The first unit test, named CreateContact(), verifies that calling CreateContact() returns the value true when a valid instance of the Contact class is passed to the method.</span></span> <span data-ttu-id="9d6eb-258">Test tworzy wystąpienie klasy Contact, wywołuje metodę nocontact () i sprawdza, czy element "nocontact () zwróci wartość true.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-258">The test creates an instance of the Contact class, calls the CreateContact() method, and verifies that CreateContact() returns the value true.</span></span>

<span data-ttu-id="9d6eb-259">Pozostałe testy sprawdzają, czy gdy metoda nocontact () jest wywoływana z nieprawidłowym kontaktem, a następnie metoda zwraca wartość false, a oczekiwany komunikat o błędzie walidacji jest dodawany do stanu modelu.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-259">The remaining tests verify that when the CreateContact() method is called with an invalid Contact then the method returns false and the expected validation error message is added to model state.</span></span> <span data-ttu-id="9d6eb-260">Na przykład, test CreateContactRequiredFirstName () tworzy wystąpienie klasy Contact z pustym ciągiem dla jego właściwości FirstName.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-260">For example, the CreateContactRequiredFirstName() test creates an instance of the Contact class with an empty string for its FirstName property.</span></span> <span data-ttu-id="9d6eb-261">Następnie Metoda nocontact () jest wywoływana z nieprawidłowym kontaktem.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-261">Next, the CreateContact() method is called with the invalid Contact.</span></span> <span data-ttu-id="9d6eb-262">Na koniec test weryfikuje, czy element iscontact () zwraca wartość false, a ten stan modelu zawiera oczekiwany komunikat o błędzie walidacji "pierwsze nazwisko jest wymagane".</span><span class="sxs-lookup"><span data-stu-id="9d6eb-262">Finally, the test verifies that CreateContact() returns false and that model state contains the expected validation error message "First name is required."</span></span>

<span data-ttu-id="9d6eb-263">Testy jednostkowe można uruchomić z listy 1, wybierając opcję menu **test, Uruchom, wszystkie testy w rozwiązaniu (Ctrl + R, A)** .</span><span class="sxs-lookup"><span data-stu-id="9d6eb-263">You can run the unit tests in Listing 1 by selecting the menu option **Test, Run, All Tests in Solution (CTRL+R, A)**.</span></span> <span data-ttu-id="9d6eb-264">Wyniki testów są wyświetlane w oknie Wyniki testów (zobacz rysunek 4).</span><span class="sxs-lookup"><span data-stu-id="9d6eb-264">The results of the tests are displayed in the Test Results window (see Figure 4).</span></span>

<span data-ttu-id="9d6eb-265">[![Wyniki testów](iteration-5-create-unit-tests-cs/_static/image4.jpg)](iteration-5-create-unit-tests-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="9d6eb-265">[![Test Results](iteration-5-create-unit-tests-cs/_static/image4.jpg)](iteration-5-create-unit-tests-cs/_static/image7.png)</span></span>

<span data-ttu-id="9d6eb-266">**Ilustracja 04**: wyniki testów ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](iteration-5-create-unit-tests-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="9d6eb-266">**Figure 04**: Test Results ([Click to view full-size image](iteration-5-create-unit-tests-cs/_static/image8.png))</span></span>

## <a name="creating-unit-tests-for-controllers"></a><span data-ttu-id="9d6eb-267">Tworzenie testów jednostkowych dla kontrolerów</span><span class="sxs-lookup"><span data-stu-id="9d6eb-267">Creating Unit Tests for Controllers</span></span>

<span data-ttu-id="9d6eb-268">Aplikacja ASP. NETMVC steruje przepływem interakcji użytkownika.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-268">ASP.NETMVC application control the flow of user interaction.</span></span> <span data-ttu-id="9d6eb-269">Podczas testowania kontrolera, należy sprawdzić, czy kontroler zwróci odpowiednie wyniki akcji i wyświetli dane.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-269">When testing a controller, you want to test whether the controller returns the right action result and view data.</span></span> <span data-ttu-id="9d6eb-270">Warto również sprawdzić, czy kontroler współdziała z klasami modelu w oczekiwany sposób.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-270">You also might want to test whether a controller interacts with model classes in the manner expected.</span></span>

<span data-ttu-id="9d6eb-271">Na przykład lista 2 zawiera dwa testy jednostkowe dla metody Create () kontrolera Contact.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-271">For example, Listing 2 contains two unit tests for the Contact controller Create() method.</span></span> <span data-ttu-id="9d6eb-272">Pierwszy test jednostkowy sprawdza, czy gdy prawidłowy kontakt jest przesyłany do metody Create (), a następnie Metoda Create () przekierowuje do akcji index.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-272">The first unit test verifies that when a valid Contact is passed to the Create() method then the Create() method redirects to the Index action.</span></span> <span data-ttu-id="9d6eb-273">Innymi słowy, gdy przeszedł prawidłowy kontakt, Metoda Create () powinna zwrócić element RedirectToRouteResult, który reprezentuje akcję indeksu.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-273">In other words, when passed a valid Contact, the Create() method should return a RedirectToRouteResult that represents the Index action.</span></span>

<span data-ttu-id="9d6eb-274">Nie chcemy przetestować warstwy usługi ContactManager podczas testowania warstwy kontrolera.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-274">We don t want to test the ContactManager service layer when we are testing the controller layer.</span></span> <span data-ttu-id="9d6eb-275">W związku z tym tworzymy warstwę usługi przy użyciu następującego kodu w metodzie Initialize:</span><span class="sxs-lookup"><span data-stu-id="9d6eb-275">Therefore, we mock the service layer with the following code in the Initialize method:</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample3.cs)]

<span data-ttu-id="9d6eb-276">W teście jednostkowym CreateValidContact () tworzymy zachowanie wywoływania metody () warstwy usługi z następującym wierszem kodu:</span><span class="sxs-lookup"><span data-stu-id="9d6eb-276">In the CreateValidContact() unit test, we mock the behavior of calling the service layer CreateContact() method with the following line of code:</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample4.cs)]

<span data-ttu-id="9d6eb-277">Ten wiersz kodu powoduje, że usługa makieter nie zwraca wartości true, gdy wywoływana jest metoda oncontact ().</span><span class="sxs-lookup"><span data-stu-id="9d6eb-277">This line of code causes the mock ContactManager service to return the value true when its CreateContact() method is called.</span></span> <span data-ttu-id="9d6eb-278">Poprzez imitację warstwy usług możemy przetestować zachowanie naszego kontrolera bez konieczności wykonywania kodu w warstwie usług.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-278">By mocking the service layer, we can test the behavior of our controller without needing to execute any code in the service layer.</span></span>

<span data-ttu-id="9d6eb-279">Drugi test jednostkowy sprawdza, czy akcja Utwórz () zwraca widok, gdy do metody jest przenoszona nieprawidłowy kontakt.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-279">The second unit test verifies that the Create() action returns the Create view when an invalid contact is passed to the method.</span></span> <span data-ttu-id="9d6eb-280">Powoduje to, że metoda oncontact () warstwy usługi zwróci wartość false z następującym wierszem kodu:</span><span class="sxs-lookup"><span data-stu-id="9d6eb-280">We cause the service layer CreateContact() method to return the value false with the following line of code:</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample5.cs)]

<span data-ttu-id="9d6eb-281">Jeśli metoda Create () będzie działać w oczekiwany sposób, powinien zwrócić widok, gdy warstwa usługi zwróci wartość false.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-281">If the Create() method behaves as we expect then it should return the Create view when the service layer returns the value false.</span></span> <span data-ttu-id="9d6eb-282">Dzięki temu kontroler może wyświetlać komunikaty o błędach walidacji w widoku tworzenia, a użytkownik ma szansę poprawić te nieprawidłowe właściwości kontaktu.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-282">That way, the controller can display the validation error messages in the Create view and the user has a chance to correct that invalid Contact properties.</span></span>

<span data-ttu-id="9d6eb-283">Jeśli planujesz kompilację testów jednostkowych dla kontrolerów, musisz zwrócić jawne nazwy widoków z akcji kontrolera.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-283">If you plan to build unit tests for your controllers then you need to return explicit view names from your controller actions.</span></span> <span data-ttu-id="9d6eb-284">Na przykład nie należy zwracać widoku w następujący sposób:</span><span class="sxs-lookup"><span data-stu-id="9d6eb-284">For example, do not return a view like this:</span></span>

<span data-ttu-id="9d6eb-285">Widok zwracany ();</span><span class="sxs-lookup"><span data-stu-id="9d6eb-285">return View();</span></span>

<span data-ttu-id="9d6eb-286">Zamiast tego Zwróć widok podobny do tego:</span><span class="sxs-lookup"><span data-stu-id="9d6eb-286">Instead, return the view like this:</span></span>

<span data-ttu-id="9d6eb-287">return View("Create");</span><span class="sxs-lookup"><span data-stu-id="9d6eb-287">return View("Create");</span></span>

<span data-ttu-id="9d6eb-288">Jeśli podczas zwracania widoku nie są jawne, właściwość ViewResult. viewName zwraca pusty ciąg.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-288">If you are not explicit when returning a view then the ViewResult.ViewName property returns an empty string.</span></span>

<span data-ttu-id="9d6eb-289">**Lista 2 — Controllers\ContactControllerTest.cs**</span><span class="sxs-lookup"><span data-stu-id="9d6eb-289">**Listing 2 - Controllers\ContactControllerTest.cs**</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample6.cs)]

## <a name="summary"></a><span data-ttu-id="9d6eb-290">Podsumowanie</span><span class="sxs-lookup"><span data-stu-id="9d6eb-290">Summary</span></span>

<span data-ttu-id="9d6eb-291">W tej iteracji utworzyliśmy testy jednostkowe dla naszej aplikacji menedżera kontaktów.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-291">In this iteration, we created unit tests for our Contact Manager application.</span></span> <span data-ttu-id="9d6eb-292">Możemy uruchomić te testy jednostkowe w dowolnym momencie, aby upewnić się, że aplikacja nadal działa w oczekiwany sposób.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-292">We can run these unit tests at any time to verify that our application still behaves in the manner that we expect.</span></span> <span data-ttu-id="9d6eb-293">Testy jednostkowe działają jako sieć bezpieczeństwa dla naszej aplikacji, dzięki czemu możemy bezpiecznie modyfikować naszą aplikację w przyszłości.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-293">The unit tests act as a safety net for our application enabling us to safely modify our application in the future.</span></span>

<span data-ttu-id="9d6eb-294">Utworzyliśmy dwa zestawy testów jednostkowych.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-294">We created two sets of unit tests.</span></span> <span data-ttu-id="9d6eb-295">Najpierw przetestowano nasze logiki walidacji, tworząc testy jednostkowe dla naszej warstwy usług.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-295">First, we tested our validation logic by creating unit tests for our service layer.</span></span> <span data-ttu-id="9d6eb-296">Następnie przetestowano nasze logiki kontroli przepływu, tworząc testy jednostkowe dla naszej warstwy kontrolera.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-296">Next, we tested our flow control logic by creating unit tests for our controller layer.</span></span> <span data-ttu-id="9d6eb-297">Podczas testowania naszej warstwy usług wykryliśmy nasze testy dla naszej warstwy usług z naszej warstwy repozytorium przez imitację naszej warstwy repozytorium.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-297">When testing our service layer, we isolated our tests for our service layer from our repository layer by mocking our repository layer.</span></span> <span data-ttu-id="9d6eb-298">Podczas testowania warstwy kontrolera odizolowano nasze testy dla naszej warstwy kontrolera przez imitację warstwy usług.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-298">When testing the controller layer, we isolated our tests for our controller layer by mocking the service layer.</span></span>

<span data-ttu-id="9d6eb-299">W następnej iteracji zmodyfikujemy aplikację Contact Manager, aby obsługiwała grupy kontaktów.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-299">In the next iteration, we modify the Contact Manager application so that it supports Contact Groups.</span></span> <span data-ttu-id="9d6eb-300">Ta nowa funkcjonalność zostanie dodana do naszej aplikacji przy użyciu procesu projektowania oprogramowania zwanego programowaniem opartym na testach.</span><span class="sxs-lookup"><span data-stu-id="9d6eb-300">We'll add this new functionality to our application using a software design process called test-driven development.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="9d6eb-301">[Poprzednie](iteration-4-make-the-application-loosely-coupled-cs.md)
> [dalej](iteration-6-use-test-driven-development-cs.md)</span><span class="sxs-lookup"><span data-stu-id="9d6eb-301">[Previous](iteration-4-make-the-application-loosely-coupled-cs.md)
[Next](iteration-6-use-test-driven-development-cs.md)</span></span>
