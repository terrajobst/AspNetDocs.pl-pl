---
uid: mvc/overview/older-versions/using-oauth-providers-with-mvc
title: Przy użyciu dostawców uwierzytelniania OAuth w MVC 4 | Dokumentacja firmy Microsoft
author: Rick-Anderson
description: W tym samouczku dowiesz się, jak utworzyć aplikację sieci web platformy ASP.NET MVC 4, która umożliwia użytkownikom logowanie się przy użyciu poświadczeń z zewnętrznego dostawcy, takich jak Facebo...
ms.author: riande
ms.date: 06/19/2013
ms.assetid: 7a87f16f-0e19-4f15-a88a-094ae866c4a2
msc.legacyurl: /mvc/overview/older-versions/using-oauth-providers-with-mvc
msc.type: authoredcontent
ms.openlocfilehash: d0203b62c911056fc56ed103c1c42f67816cbbf0
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 03/01/2019
ms.locfileid: "57078386"
---
<a name="using-oauth-providers-with-mvc-4"></a><span data-ttu-id="37d18-103">Korzystanie z dostawców uwierzytelniania OAuth we wzorcu MVC 4</span><span class="sxs-lookup"><span data-stu-id="37d18-103">Using OAuth Providers with MVC 4</span></span>
====================
<span data-ttu-id="37d18-104">przez [Tom FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="37d18-104">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

> <span data-ttu-id="37d18-105">W tym samouczku dowiesz się, jak utworzyć aplikację sieci web platformy ASP.NET MVC 4, która umożliwia użytkownikom logowanie za pomocą poświadczeń z zewnętrznego dostawcy, takich jak Facebook, Twitter, Microsoft lub Google, a następnie zintegrować niektóre funkcje, które z tych dostawców w sieci Aplikacja sieci Web.</span><span class="sxs-lookup"><span data-stu-id="37d18-105">This tutorial shows you how to build an ASP.NET MVC 4 web application that enables users to log in with credentials from an external provider, such as Facebook, Twitter, Microsoft, or Google, and then integrate some of the functionality from those providers into your web application.</span></span> <span data-ttu-id="37d18-106">Dla uproszczenia ten samouczek koncentruje się na pracy przy użyciu poświadczeń z usługi Facebook.</span><span class="sxs-lookup"><span data-stu-id="37d18-106">For simplicity, this tutorial focuses on working with credentials from Facebook.</span></span>
> 
> <span data-ttu-id="37d18-107">Aby użyć zewnętrznych poświadczeń w aplikacji sieci web programu ASP.NET MVC 5, zobacz [tworzenie aplikacji platformy ASP.NET MVC 5 za pomocą usługi Facebook i Google OAuth2 i OpenID logowanie jednokrotne](../security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md).</span><span class="sxs-lookup"><span data-stu-id="37d18-107">To use external credentials in an ASP.NET MVC 5 web application, see [Create an ASP.NET MVC 5 App with Facebook and Google OAuth2 and OpenID Sign-on](../security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md).</span></span>
> 
> <span data-ttu-id="37d18-108">Włączanie tych poświadczeń w witrynach sieci web zapewnia znaczące korzyści, ponieważ milionom użytkowników mają już konta z tych dostawców zewnętrznych.</span><span class="sxs-lookup"><span data-stu-id="37d18-108">Enabling these credentials in your web sites provides a significant advantage because millions of users already have accounts with these external providers.</span></span> <span data-ttu-id="37d18-109">Tacy użytkownicy mogą być bardziej skłonni się zarejestrować dla danej witryny, gdy ta osoba nie ma do tworzenia i Zapamiętaj nowego zestawu poświadczeń.</span><span class="sxs-lookup"><span data-stu-id="37d18-109">These users may be more inclined to sign up for your site if they do not have to create and remember a new set of credentials.</span></span> <span data-ttu-id="37d18-110">Ponadto po użytkownik jest zalogowany za pomocą jednego z tych dostawców, można zastosować operacji społecznościowych od dostawcy.</span><span class="sxs-lookup"><span data-stu-id="37d18-110">Also, after a user has logged in through one of these providers, you can incorporate social operations from the provider.</span></span>


## <a name="what-youll-build"></a><span data-ttu-id="37d18-111">Będziesz tworzyć</span><span class="sxs-lookup"><span data-stu-id="37d18-111">What you'll build</span></span>

<span data-ttu-id="37d18-112">Istnieją dwa główne cele, w tym samouczku:</span><span class="sxs-lookup"><span data-stu-id="37d18-112">There are two main goals in this tutorial:</span></span>

1. <span data-ttu-id="37d18-113">Umożliwić użytkownikowi logowanie się przy użyciu poświadczeń z dostawcą uwierzytelniania OAuth.</span><span class="sxs-lookup"><span data-stu-id="37d18-113">Enable a user to log in with credentials from an OAuth provider.</span></span>
2. <span data-ttu-id="37d18-114">Pobranie informacji o koncie z dostawcy i zintegrowania z rejestracji konta dla danej witryny.</span><span class="sxs-lookup"><span data-stu-id="37d18-114">Retrieve account information from the provider and integrate that information with the account registration for your site.</span></span>

<span data-ttu-id="37d18-115">Mimo że na potrzeby przykładów w tym samouczku skoncentrować się na temat korzystania z usługi Facebook jako dostawcy uwierzytelniania, można zmodyfikować kod, aby użyć innych dostawców.</span><span class="sxs-lookup"><span data-stu-id="37d18-115">Although the examples in this tutorial focus on using Facebook as the authentication provider, you can modify the code to use any of the providers.</span></span> <span data-ttu-id="37d18-116">Kroki, aby wdrożyć u innego dostawcy są bardzo podobne do czynności, które będą widoczne w tym samouczku.</span><span class="sxs-lookup"><span data-stu-id="37d18-116">The steps to implement any provider are very similar to the steps you will see in this tutorial.</span></span> <span data-ttu-id="37d18-117">Można zauważyć tylko między nimi istotne różnice bezpośrednie wywołania interfejsu API dostawcy zestawu.</span><span class="sxs-lookup"><span data-stu-id="37d18-117">You will only notice significant differences when making direct calls to the provider's API set.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="37d18-118">Wymagania wstępne</span><span class="sxs-lookup"><span data-stu-id="37d18-118">Prerequisites</span></span>

- <span data-ttu-id="37d18-119">[Microsoft Visual Studio 2012](https://www.microsoft.com/visualstudio/eng/downloads#vs) lub [programu Microsoft Visual Studio Express 2012 for Web](https://www.microsoft.com/visualstudio/eng/downloads#d-2012-express)</span><span class="sxs-lookup"><span data-stu-id="37d18-119">[Microsoft Visual Studio 2012](https://www.microsoft.com/visualstudio/eng/downloads#vs) or [Microsoft Visual Studio Express 2012 for Web](https://www.microsoft.com/visualstudio/eng/downloads#d-2012-express)</span></span>

<span data-ttu-id="37d18-120">Lub</span><span class="sxs-lookup"><span data-stu-id="37d18-120">Or</span></span>

- <span data-ttu-id="37d18-121">Microsoft Visual Studio 2010 z dodatkiem SP1 lub [Visual Web Developer Express 2010 z dodatkiem SP1](https://www.microsoft.com/visualstudio/eng/downloads#d-2010-express)</span><span class="sxs-lookup"><span data-stu-id="37d18-121">Microsoft Visual Studio 2010 SP1 or [Visual Web Developer Express 2010 SP1](https://www.microsoft.com/visualstudio/eng/downloads#d-2010-express)</span></span>
- [<span data-ttu-id="37d18-122">ASP.NET MVC 4</span><span class="sxs-lookup"><span data-stu-id="37d18-122">ASP.NET MVC 4</span></span>](https://go.microsoft.com/fwlink/?LinkId=243392)

<span data-ttu-id="37d18-123">Ponadto w tym temacie założono, że masz podstawową wiedzę na temat platformy ASP.NET MVC i programu Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="37d18-123">Furthermore, this topic assumes you have basic knowledge about ASP.NET MVC and Visual Studio.</span></span> <span data-ttu-id="37d18-124">Wprowadzenie do platformy ASP.NET MVC 4, odwiedź stronę [wprowadzenie do platformy ASP.NET MVC 4](getting-started-with-aspnet-mvc4/intro-to-aspnet-mvc-4.md).</span><span class="sxs-lookup"><span data-stu-id="37d18-124">If you need an introduction to ASP.NET MVC 4, see [Intro to ASP.NET MVC 4](getting-started-with-aspnet-mvc4/intro-to-aspnet-mvc-4.md).</span></span>

## <a name="create-the-project"></a><span data-ttu-id="37d18-125">Utwórz projekt</span><span class="sxs-lookup"><span data-stu-id="37d18-125">Create the project</span></span>

<span data-ttu-id="37d18-126">W programie Visual Studio Utwórz nową aplikację sieci Web 4 platformy ASP.NET MVC i nadaj mu &quot;OAuthMVC&quot;.</span><span class="sxs-lookup"><span data-stu-id="37d18-126">In Visual Studio, create a new ASP.NET MVC 4 Web Application, and name it &quot;OAuthMVC&quot;.</span></span> <span data-ttu-id="37d18-127">Można kierować platformy .NET Framework 4.5 lub 4.</span><span class="sxs-lookup"><span data-stu-id="37d18-127">You can target either .NET Framework 4.5 or 4.</span></span>

![Tworzenie projektu](using-oauth-providers-with-mvc/_static/image1.png)

<span data-ttu-id="37d18-129">W oknie nowego projektu programu ASP.NET MVC 4 Wybierz **aplikacji internetowej** i pozostawić **Razor** aparatu widoku.</span><span class="sxs-lookup"><span data-stu-id="37d18-129">In the New ASP.NET MVC 4 Project window, select **Internet Application** and leave **Razor** as the view engine.</span></span>

![Wybierz aplikację internetową](using-oauth-providers-with-mvc/_static/image2.png)

## <a name="enable-a-provider"></a><span data-ttu-id="37d18-131">Włącz dostawcę</span><span class="sxs-lookup"><span data-stu-id="37d18-131">Enable a provider</span></span>

<span data-ttu-id="37d18-132">Gdy tworzysz aplikację sieci web MVC 4 przy użyciu szablonu aplikacji internetowej, projekt zostanie utworzony przy użyciu pliku o nazwie AuthConfig.cs w aplikacji\_folder początkowy.</span><span class="sxs-lookup"><span data-stu-id="37d18-132">When you create an MVC 4 web application with the Internet Application template, the project is created with a file named AuthConfig.cs in the App\_Start folder.</span></span>

![Plik AuthConfig](using-oauth-providers-with-mvc/_static/image3.png)

<span data-ttu-id="37d18-134">Plik AuthConfig zawiera kod, aby zarejestrować klientów dla dostawcy uwierzytelniania zewnętrznego.</span><span class="sxs-lookup"><span data-stu-id="37d18-134">The AuthConfig file contains code to register clients for external authentication providers.</span></span> <span data-ttu-id="37d18-135">Domyślnie ten kod został umieszczony w komentarzach, więc żaden z zewnętrznych dostawców są włączone.</span><span class="sxs-lookup"><span data-stu-id="37d18-135">By default, this code is commented out, so none of the external providers are enabled.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample1.cs)]

<span data-ttu-id="37d18-136">Należy Usuń komentarz ten kod w celu korzystania z klienta zewnętrznego uwierzytelnienia.</span><span class="sxs-lookup"><span data-stu-id="37d18-136">You must uncomment this code to use the external authentication client.</span></span> <span data-ttu-id="37d18-137">Usuń znaczniki komentarza dostawców, które mają zostać uwzględnione w lokacji.</span><span class="sxs-lookup"><span data-stu-id="37d18-137">You uncomment only the providers you want to include in your site.</span></span> <span data-ttu-id="37d18-138">Na potrzeby tego samouczka umożliwi tylko poświadczeń serwisu Facebook.</span><span class="sxs-lookup"><span data-stu-id="37d18-138">For this tutorial, you will only enable the Facebook credentials.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample2.cs)]

<span data-ttu-id="37d18-139">Zwróć uwagę, w powyższym przykładzie, że metoda zawiera puste ciągi dla parametrów rejestracji.</span><span class="sxs-lookup"><span data-stu-id="37d18-139">Notice in the above example that the method includes empty strings for the registration parameters.</span></span> <span data-ttu-id="37d18-140">Jeśli zostanie podjęta próba uruchomienia aplikację teraz, aplikacja zgłasza wyjątek argumentu, ponieważ puste ciągi nie są dozwolone dla parametrów.</span><span class="sxs-lookup"><span data-stu-id="37d18-140">If you try to run the application now, the application throws an argument exception because empty strings are not allowed for the parameters.</span></span> <span data-ttu-id="37d18-141">Aby zapewnić prawidłowe wartości, należy zarejestrować witryny sieci web przy użyciu dostawców zewnętrznych, jak pokazano w następnej sekcji.</span><span class="sxs-lookup"><span data-stu-id="37d18-141">To provide valid values, you must register your web site with the external providers, as shown in the next section.</span></span>

## <a name="registering-with-an-external-provider"></a><span data-ttu-id="37d18-142">Rejestrowanie przy użyciu zewnętrznego dostawcy</span><span class="sxs-lookup"><span data-stu-id="37d18-142">Registering with an external provider</span></span>

<span data-ttu-id="37d18-143">Do uwierzytelniania użytkowników za pomocą poświadczeń z zewnętrznego dostawcy, należy zarejestrować witryny sieci web za pomocą dostawcy.</span><span class="sxs-lookup"><span data-stu-id="37d18-143">To authenticate users with credentials from an external provider, you must register your web site with the provider.</span></span> <span data-ttu-id="37d18-144">Po zarejestrowaniu witryny, otrzyma parametry (takie jak klucz lub identyfikator i klucz tajny) do uwzględnienia podczas rejestrowania klienta.</span><span class="sxs-lookup"><span data-stu-id="37d18-144">When you register your site, you will receive the parameters (such as key or id, and secret) to include when registering the client.</span></span> <span data-ttu-id="37d18-145">Musisz mieć konto z dostawcami, które chcesz użyć.</span><span class="sxs-lookup"><span data-stu-id="37d18-145">You must have an account with the providers you wish to use.</span></span>

<span data-ttu-id="37d18-146">W tym samouczku nie są wyświetlane wszystkie kroki, które należy wykonać, aby zarejestrować za pomocą tych dostawców.</span><span class="sxs-lookup"><span data-stu-id="37d18-146">This tutorial does not show all of the steps you must perform to register with these providers.</span></span> <span data-ttu-id="37d18-147">Kroki nie są zwykle trudne.</span><span class="sxs-lookup"><span data-stu-id="37d18-147">The steps are typically not difficult.</span></span> <span data-ttu-id="37d18-148">Aby pomyślnie zarejestrować witrynę, wykonaj instrukcje podane w tych witrynach.</span><span class="sxs-lookup"><span data-stu-id="37d18-148">To successfully register your site, follow the instructions provided on those sites.</span></span> <span data-ttu-id="37d18-149">Aby rozpocząć pracę z zarejestrowaniem witryny, zobacz witryny dla deweloperów dla:</span><span class="sxs-lookup"><span data-stu-id="37d18-149">To get started with registering your site, see the developer site for:</span></span>

- [<span data-ttu-id="37d18-150">Facebook</span><span class="sxs-lookup"><span data-stu-id="37d18-150">Facebook</span></span>](https://developers.facebook.com/)
- [<span data-ttu-id="37d18-151">Google</span><span class="sxs-lookup"><span data-stu-id="37d18-151">Google</span></span>](https://developers.google.com/)
- [<span data-ttu-id="37d18-152">Microsoft</span><span class="sxs-lookup"><span data-stu-id="37d18-152">Microsoft</span></span>](http://manage.dev.live.com/)
- [<span data-ttu-id="37d18-153">Twitter</span><span class="sxs-lookup"><span data-stu-id="37d18-153">Twitter</span></span>](https://dev.twitter.com/)

<span data-ttu-id="37d18-154">W przypadku rejestrowania witryny za pomocą usługi Facebook, można zapewnić &quot;localhost&quot; dla domeny, lokacji i `&quot; http://localhost/&quot;` dla adresu URL, jak pokazano na poniższej ilustracji.</span><span class="sxs-lookup"><span data-stu-id="37d18-154">When registering your site with Facebook, you can provide &quot;localhost&quot; for the site domain and `&quot;http://localhost/&quot;` for the URL, as shown in the image below.</span></span> <span data-ttu-id="37d18-155">Przy użyciu localhost pracuje z dostawcami większość, ale obecnie nie współpracujesz z dostawcy firmy Microsoft.</span><span class="sxs-lookup"><span data-stu-id="37d18-155">Using localhost works with most providers, but currently does not work with the Microsoft provider.</span></span> <span data-ttu-id="37d18-156">W przypadku dostawcy firmy Microsoft musi zawierać prawidłową witrynę sieci web adres URL.</span><span class="sxs-lookup"><span data-stu-id="37d18-156">For the Microsoft provider, you must include a valid web site URL.</span></span>

![Rejestracja witryny](using-oauth-providers-with-mvc/_static/image4.png)

<span data-ttu-id="37d18-158">Na poprzedniej ilustracji zostały usunięte wartości identyfikatora aplikacji, klucz tajny aplikacji i kontaktowy adres e-mail.</span><span class="sxs-lookup"><span data-stu-id="37d18-158">In the previous image, the values for the app id, app secret, and contact email have been removed.</span></span> <span data-ttu-id="37d18-159">Po zarejestrowaniu faktycznie witryny, te wartości będą obecne.</span><span class="sxs-lookup"><span data-stu-id="37d18-159">When you actually register your site, those values will be present.</span></span> <span data-ttu-id="37d18-160">Należy pamiętać wartości identyfikatora aplikacji i klucz tajny aplikacji, ponieważ spowoduje dodanie ich do aplikacji.</span><span class="sxs-lookup"><span data-stu-id="37d18-160">You will want to note the values for app id and app secret because you will add them to your application.</span></span>

## <a name="creating-test-users"></a><span data-ttu-id="37d18-161">Tworzenie użytkowników testowych</span><span class="sxs-lookup"><span data-stu-id="37d18-161">Creating test users</span></span>

<span data-ttu-id="37d18-162">Jeśli możesz nie mieć nic przeciwko do Testuj swoją witrynę przy użyciu istniejącego konta serwisu Facebook, możesz pominąć tę sekcję.</span><span class="sxs-lookup"><span data-stu-id="37d18-162">If you do not mind using an existing Facebook account to test your site, you can skip this section.</span></span>

<span data-ttu-id="37d18-163">Można łatwo utworzyć użytkowników testowych dla aplikacji w ramach strony zarządzania aplikacji usługi Facebook.</span><span class="sxs-lookup"><span data-stu-id="37d18-163">You can easily create test users for your application within the Facebook app management page.</span></span> <span data-ttu-id="37d18-164">Te konta, zaloguj się do witryny testowe.</span><span class="sxs-lookup"><span data-stu-id="37d18-164">You can use these test accounts to log in to your site.</span></span> <span data-ttu-id="37d18-165">Utwórz użytkowników testowych, klikając pozycję **role** łącze w okienku nawigacji po lewej stronie, a kliknięcie **Utwórz** łącza.</span><span class="sxs-lookup"><span data-stu-id="37d18-165">You create test users by clicking the **Roles** link in the left navigation pane and the clicking the **Create** link.</span></span>

![Utwórz użytkowników testowych](using-oauth-providers-with-mvc/_static/image5.png)

<span data-ttu-id="37d18-167">W witrynie Facebook automatycznie tworzy liczby kont testowych, które w przypadku żądania.</span><span class="sxs-lookup"><span data-stu-id="37d18-167">The Facebook site automatically creates the number of test accounts that you request.</span></span>

## <a name="adding-application-id-and-secret-from-the-provider"></a><span data-ttu-id="37d18-168">Dodawanie identyfikatora aplikacji i klucza tajnego od dostawcy</span><span class="sxs-lookup"><span data-stu-id="37d18-168">Adding application id and secret from the provider</span></span>

<span data-ttu-id="37d18-169">Teraz, gdy otrzymane identyfikatora i klucza tajnego z usługi Facebook, wróć do pliku AuthConfig i dodać je jako wartości parametrów.</span><span class="sxs-lookup"><span data-stu-id="37d18-169">Now that you have received the id and secret from Facebook, go back to the AuthConfig file and add them as the parameter values.</span></span> <span data-ttu-id="37d18-170">Poniższe wartości nie są rzeczywiste wartości.</span><span class="sxs-lookup"><span data-stu-id="37d18-170">The values shown below are not real values.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample3.cs)]

## <a name="log-in-with-external-credentials"></a><span data-ttu-id="37d18-171">Zaloguj się przy użyciu poświadczeń zewnętrznych</span><span class="sxs-lookup"><span data-stu-id="37d18-171">Log in with external credentials</span></span>

<span data-ttu-id="37d18-172">To wszystko, co trzeba zrobić, aby umożliwić zewnętrznych poświadczeń w lokacji.</span><span class="sxs-lookup"><span data-stu-id="37d18-172">That is all you have to do to enable external credentials in your site.</span></span> <span data-ttu-id="37d18-173">Uruchom aplikację i kliknij łącze Zaloguj się w prawym górnym rogu.</span><span class="sxs-lookup"><span data-stu-id="37d18-173">Run your application and click the login link in the upper right corner.</span></span> <span data-ttu-id="37d18-174">Ten szablon automatycznie rozpoznaje zarejestrowano usługi Facebook jako dostawca i zawiera przycisk dla dostawcy.</span><span class="sxs-lookup"><span data-stu-id="37d18-174">The template automatically recognizes that you have registered Facebook as a provider and includes a button for the provider.</span></span> <span data-ttu-id="37d18-175">Jeśli zarejestrujesz wielu dostawców, przycisk dla każdej z nich jest automatycznie dołączane.</span><span class="sxs-lookup"><span data-stu-id="37d18-175">If you register multiple providers, a button for each one is automatically included.</span></span>

![Logowanie zewnętrzne](using-oauth-providers-with-mvc/_static/image6.png)

<span data-ttu-id="37d18-177">W tym samouczku opisano, jak dostosować logowania przycisków do zewnętrznych dostawców.</span><span class="sxs-lookup"><span data-stu-id="37d18-177">This tutorial does not cover how to customize the log in buttons for the external providers.</span></span> <span data-ttu-id="37d18-178">Aby uzyskać te informacje, zobacz [Dostosowywanie interfejs użytkownika logowania w przypadku korzystania z uwierzytelniania OAuth/OpenID](https://blogs.msdn.com/b/pranav_rastogi/archive/2012/08/24/customizing-the-login-ui-when-using-oauth-openid.aspx).</span><span class="sxs-lookup"><span data-stu-id="37d18-178">For that information, see [Customizing the login UI when using OAuth/OpenID](https://blogs.msdn.com/b/pranav_rastogi/archive/2012/08/24/customizing-the-login-ui-when-using-oauth-openid.aspx).</span></span>

<span data-ttu-id="37d18-179">Kliknij przycisk Facebook, aby zalogować się przy użyciu poświadczeń serwisu Facebook.</span><span class="sxs-lookup"><span data-stu-id="37d18-179">Click on the Facebook button to log in with Facebook credentials.</span></span> <span data-ttu-id="37d18-180">Po wybraniu jednego z dostawców zewnętrznych są przekierowywane do tej lokacji i zostanie wyświetlony monit tej usługi, aby zalogować się.</span><span class="sxs-lookup"><span data-stu-id="37d18-180">When you select one of the external providers, you are redirected to that site and prompted by that service to log in.</span></span>

<span data-ttu-id="37d18-181">Na poniższej ilustracji przedstawiono ekran logowania za pomocą konta Facebook.</span><span class="sxs-lookup"><span data-stu-id="37d18-181">The following image shows the login screen for Facebook.</span></span> <span data-ttu-id="37d18-182">Stwierdza, że używasz konta w serwisie Facebook, zaloguj się do witryny o nazwie oauthmvcexample.</span><span class="sxs-lookup"><span data-stu-id="37d18-182">It notes that you are using your Facebook account to log in to a site named oauthmvcexample.</span></span>

![Uwierzytelnianie serwisu Facebook](using-oauth-providers-with-mvc/_static/image7.png)

<span data-ttu-id="37d18-184">Po zalogowaniu się przy użyciu poświadczeń serwisu Facebook, strony informuje użytkownika, że lokacji będą mieć dostęp do podstawowych informacji.</span><span class="sxs-lookup"><span data-stu-id="37d18-184">After logging in with Facebook credentials, a page informs the user that the site will have access to basic information.</span></span>

![żądanie uprawnień](using-oauth-providers-with-mvc/_static/image8.png)

<span data-ttu-id="37d18-186">Po wybraniu **przejdź do aplikacji**, użytkownik musi zarejestrować się dla witryny.</span><span class="sxs-lookup"><span data-stu-id="37d18-186">After selecting **Go to App**, the user must register for the site.</span></span> <span data-ttu-id="37d18-187">Na poniższej ilustracji przedstawiono na stronie rejestracji po użytkownik zalogował się przy użyciu poświadczeń serwisu Facebook.</span><span class="sxs-lookup"><span data-stu-id="37d18-187">The following image shows the registration page after a user has logged in with Facebook credentials.</span></span> <span data-ttu-id="37d18-188">Nazwa użytkownika jest zazwyczaj są wstępnie wypełnione nazwą od dostawcy.</span><span class="sxs-lookup"><span data-stu-id="37d18-188">The user name is typically pre-filled with a name from the provider.</span></span>

![zarejestruj](using-oauth-providers-with-mvc/_static/image9.png)

<span data-ttu-id="37d18-190">Kliknij przycisk **zarejestrować** do ukończenia rejestracji.</span><span class="sxs-lookup"><span data-stu-id="37d18-190">Click **Register** to complete registration.</span></span> <span data-ttu-id="37d18-191">Zamknij przeglądarkę.</span><span class="sxs-lookup"><span data-stu-id="37d18-191">Close the browser.</span></span>

<span data-ttu-id="37d18-192">Widać, że dodano nowe konto z bazą danych.</span><span class="sxs-lookup"><span data-stu-id="37d18-192">You can see that the new account has been added to your database.</span></span> <span data-ttu-id="37d18-193">Otwórz w Eksploratorze serwera **DefaultConnection** bazy danych, a następnie otwórz **tabel** folderu.</span><span class="sxs-lookup"><span data-stu-id="37d18-193">In Server Explorer, open the **DefaultConnection** database and open the **Tables** folder.</span></span>

![tabele bazy danych](using-oauth-providers-with-mvc/_static/image10.png)

<span data-ttu-id="37d18-195">Kliknij prawym przyciskiem myszy **UserProfile** tabeli, a następnie wybierz pozycję **Pokaż dane tabeli**.</span><span class="sxs-lookup"><span data-stu-id="37d18-195">Right-click the **UserProfile** table and select **Show Table Data**.</span></span>

![Pokaż dane](using-oauth-providers-with-mvc/_static/image11.png)

<span data-ttu-id="37d18-197">Zobaczysz nowe konto, którą dodałeś.</span><span class="sxs-lookup"><span data-stu-id="37d18-197">You will see the new account you added.</span></span> <span data-ttu-id="37d18-198">Spójrz na dane w **strony sieci Web\_OAuthMembership** tabeli.</span><span class="sxs-lookup"><span data-stu-id="37d18-198">Look at the data in **webpage\_OAuthMembership** table.</span></span> <span data-ttu-id="37d18-199">Zobaczysz większej ilości danych związanych z zewnętrznego dostawcy dla konta, który właśnie został dodany.</span><span class="sxs-lookup"><span data-stu-id="37d18-199">You will see more data related to the external provider for the account you just added.</span></span>

<span data-ttu-id="37d18-200">Jeśli chcesz włączyć uwierzytelnianie zewnętrzne, wszystko będzie gotowe.</span><span class="sxs-lookup"><span data-stu-id="37d18-200">If you only want to enable external authentication, you are done.</span></span> <span data-ttu-id="37d18-201">Jednak można dodatkowo zintegrować informacje od dostawcy nowy proces rejestracji użytkownika, jak pokazano w poniższych sekcjach.</span><span class="sxs-lookup"><span data-stu-id="37d18-201">However, you can further integrate information from the provider into the new user registration process, as shown in the following sections.</span></span>

## <a name="create-models-for-additional-user-information"></a><span data-ttu-id="37d18-202">Twórz modele, aby uzyskać dodatkowe informacje dotyczące użytkownika</span><span class="sxs-lookup"><span data-stu-id="37d18-202">Create models for additional user information</span></span>

<span data-ttu-id="37d18-203">Jak można zauważyć w poprzednich sekcjach, nie musisz pobierać żadnych dodatkowych informacji dotyczących rejestracji wbudowanego konta do pracy.</span><span class="sxs-lookup"><span data-stu-id="37d18-203">As you noticed in the previous sections, you do not need to retrieve any additional information for the built-in account registration to work.</span></span> <span data-ttu-id="37d18-204">Jednak większość zewnętrznych dostawców przekazać ponownie dodatkowe informacje o użytkowniku.</span><span class="sxs-lookup"><span data-stu-id="37d18-204">However, most external providers pass back additional information about the user.</span></span> <span data-ttu-id="37d18-205">Poniższe sekcje pokazują, jak zachować te informacje i zapisywanie w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="37d18-205">The following sections show how to retain that information and save it to a database.</span></span> <span data-ttu-id="37d18-206">W szczególności zostaną zachowane, wartości pełną nazwę użytkownika, identyfikator URI Osobista strona sieci web przez użytkownika i wartość, która wskazuje, czy Facebook wykryła konta.</span><span class="sxs-lookup"><span data-stu-id="37d18-206">Specifically, you will retain values for the user's full name, the URI of the user's personal web page, and a value that indicates whether Facebook has verified the account.</span></span>

<span data-ttu-id="37d18-207">Użyjesz [migracje Code First](https://msdn.microsoft.com/data/jj591621) Dodawanie tabeli do przechowywania dodatkowych informacji dotyczących użytkowników.</span><span class="sxs-lookup"><span data-stu-id="37d18-207">You will use [Code First Migrations](https://msdn.microsoft.com/data/jj591621) to add a table for storing additional user information.</span></span> <span data-ttu-id="37d18-208">Dodajesz tabeli do istniejącej bazy danych, dlatego najpierw należy utworzyć migawkę bieżącej bazy danych.</span><span class="sxs-lookup"><span data-stu-id="37d18-208">You are adding the table to an existing database, so you will first need to create a snapshot of the current database.</span></span> <span data-ttu-id="37d18-209">Tworząc migawkę bieżącej bazy danych, możesz później utworzyć migracji, który zawiera nową tabelę.</span><span class="sxs-lookup"><span data-stu-id="37d18-209">By creating a snapshot of the current database, you can later create a migration that contains only the new table.</span></span> <span data-ttu-id="37d18-210">Aby utworzyć migawkę bieżącej bazy danych:</span><span class="sxs-lookup"><span data-stu-id="37d18-210">To create a snapshot of the current database:</span></span>

1. <span data-ttu-id="37d18-211">Otwórz **Konsola Menedżera pakietów**</span><span class="sxs-lookup"><span data-stu-id="37d18-211">Open the **Package Manager Console**</span></span>
2. <span data-ttu-id="37d18-212">Uruchom polecenie **enable-migrations**</span><span class="sxs-lookup"><span data-stu-id="37d18-212">Run the command **enable-migrations**</span></span>
3. <span data-ttu-id="37d18-213">Uruchom polecenie **początkowej migracji Dodaj — IgnoreChanges**</span><span class="sxs-lookup"><span data-stu-id="37d18-213">Run the command **add-migration initial –IgnoreChanges**</span></span>
4. <span data-ttu-id="37d18-214">Uruchom polecenie **Aktualizuj bazy danych**</span><span class="sxs-lookup"><span data-stu-id="37d18-214">Run the command **update-database**</span></span>

<span data-ttu-id="37d18-215">Teraz należy dodać nowe właściwości.</span><span class="sxs-lookup"><span data-stu-id="37d18-215">Now, you will add the new properties.</span></span> <span data-ttu-id="37d18-216">W folderze modeli Otwórz plik AccountModels.cs i znaleźć klasy RegisterExternalLoginModel.</span><span class="sxs-lookup"><span data-stu-id="37d18-216">In the Models folder, open the AccountModels.cs file, and find the RegisterExternalLoginModel class.</span></span> <span data-ttu-id="37d18-217">Klasa RegisterExternalLoginModel przechowuje wartości, które pochodzą dostawcy uwierzytelniania.</span><span class="sxs-lookup"><span data-stu-id="37d18-217">The RegisterExternalLoginModel class holds values that come back from the authentication provider.</span></span> <span data-ttu-id="37d18-218">Dodaj właściwości o nazwie FullName i łącza, jak wyróżniono poniżej.</span><span class="sxs-lookup"><span data-stu-id="37d18-218">Add properties named FullName and Link, as highlighted below.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample4.cs?highlight=9-13)]

<span data-ttu-id="37d18-219">Również w AccountModels.cs, Dodaj nową klasę o nazwie ExtraUserInformation.</span><span class="sxs-lookup"><span data-stu-id="37d18-219">Also in AccountModels.cs, add a new class called ExtraUserInformation.</span></span> <span data-ttu-id="37d18-220">Ta klasa reprezentuje nową tabelę, która zostanie utworzona w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="37d18-220">This class represents the new table which will be created in the database.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample5.cs)]

<span data-ttu-id="37d18-221">W klasie UsersContext Dodaj wyróżniony kod poniżej, aby utworzyć właściwość DbSet dla nowej klasy.</span><span class="sxs-lookup"><span data-stu-id="37d18-221">In the UsersContext class, add the highlighted code below to create a DbSet property for the new class.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample6.cs?highlight=9)]

<span data-ttu-id="37d18-222">Teraz możesz przystąpić do tworzenia nowej tabeli.</span><span class="sxs-lookup"><span data-stu-id="37d18-222">You are now ready to create the new table.</span></span> <span data-ttu-id="37d18-223">Otwórz konsolę Menedżera pakietów, ponownie i tym razem:</span><span class="sxs-lookup"><span data-stu-id="37d18-223">Open the Package Manager Console again and this time:</span></span>

1. <span data-ttu-id="37d18-224">Uruchom polecenie **AddExtraUserInformation Dodaj migracji**</span><span class="sxs-lookup"><span data-stu-id="37d18-224">Run the command **add-migration AddExtraUserInformation**</span></span>
2. <span data-ttu-id="37d18-225">Uruchom polecenie **Aktualizuj bazy danych**</span><span class="sxs-lookup"><span data-stu-id="37d18-225">Run the command **update-database**</span></span>

<span data-ttu-id="37d18-226">Nowa tabela istnieje teraz w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="37d18-226">The new table now exists in the database.</span></span>

## <a name="retrieve-the-additional-data"></a><span data-ttu-id="37d18-227">Pobrania dodatkowych danych.</span><span class="sxs-lookup"><span data-stu-id="37d18-227">Retrieve the additional data</span></span>

<span data-ttu-id="37d18-228">Istnieją dwa sposoby, aby pobrać dodatkowe dane użytkownika.</span><span class="sxs-lookup"><span data-stu-id="37d18-228">There are two ways to retrieve additional user data.</span></span> <span data-ttu-id="37d18-229">Pierwszy sposób polega na przechowywanie danych użytkownika, przekazanych, domyślnie podczas żądania uwierzytelniania.</span><span class="sxs-lookup"><span data-stu-id="37d18-229">The first way is to retain user data that is passed back, by default, during the authentication request.</span></span> <span data-ttu-id="37d18-230">Druga metoda jest specjalnie wywołanie dostawcy interfejsu API i uzyskasz więcej informacji.</span><span class="sxs-lookup"><span data-stu-id="37d18-230">The second way is to specifically call the provider API and request more information.</span></span> <span data-ttu-id="37d18-231">Wartości FullName i łącza są automatycznie przekazywane przez usługi Facebook.</span><span class="sxs-lookup"><span data-stu-id="37d18-231">Values for FullName and Link are automatically passed back by Facebook.</span></span> <span data-ttu-id="37d18-232">Wartość, która wskazuje, czy Facebook wykryła konta są pobierane za pomocą wywołania interfejsu API usługi Facebook.</span><span class="sxs-lookup"><span data-stu-id="37d18-232">A value that indicates whether Facebook has verified the account is retrieved through a call to the Facebook API.</span></span> <span data-ttu-id="37d18-233">Najpierw zostanie wypełniony wartości FullName i Link i później, nastąpi pobranie wartości zweryfikowane.</span><span class="sxs-lookup"><span data-stu-id="37d18-233">First, you will populate values for FullName and Link, and then later, you will get the verified value.</span></span>

<span data-ttu-id="37d18-234">Aby pobrać dodatkowe dane użytkownika, należy otworzyć **AccountController.cs** w pliku **kontrolerów** folderu.</span><span class="sxs-lookup"><span data-stu-id="37d18-234">To retrieve the additional user data, open the **AccountController.cs** file in the **Controllers** folder.</span></span>

<span data-ttu-id="37d18-235">Ten plik zawiera logikę do rejestrowania, rejestrowanie i zarządzania kontami.</span><span class="sxs-lookup"><span data-stu-id="37d18-235">This file contains the logic for logging, registering, and managing accounts.</span></span> <span data-ttu-id="37d18-236">W szczególności zwróć uwagę, metody o nazwie **ExternalLoginCallback** i **ExternalLoginConfirmation**.</span><span class="sxs-lookup"><span data-stu-id="37d18-236">In particular, notice the methods called **ExternalLoginCallback** and **ExternalLoginConfirmation**.</span></span> <span data-ttu-id="37d18-237">W ramach tych metod możesz dodać kod, aby dostosować operacje logowania zewnętrznego dla aplikacji.</span><span class="sxs-lookup"><span data-stu-id="37d18-237">Within these methods, you can add code to customize external login operations for your application.</span></span> <span data-ttu-id="37d18-238">W pierwszym wierszu **ExternalLoginCallback** metoda zawiera:</span><span class="sxs-lookup"><span data-stu-id="37d18-238">The first line of the **ExternalLoginCallback** method contains:</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample7.cs)]

<span data-ttu-id="37d18-239">Dodatkowe dane użytkownika jest przekazywany w **ExtraData** właściwość **AuthenticationResult** obiekt, który jest zwracany z **VerifyAuthentication** metody.</span><span class="sxs-lookup"><span data-stu-id="37d18-239">Additional user data is passed back in the **ExtraData** property of the **AuthenticationResult** object that is returned from the **VerifyAuthentication** method.</span></span> <span data-ttu-id="37d18-240">Klient usługi Facebook zawiera następujące wartości w **ExtraData** właściwości:</span><span class="sxs-lookup"><span data-stu-id="37d18-240">The Facebook client contains the following values in the **ExtraData** property:</span></span>

- <span data-ttu-id="37d18-241">identyfikator</span><span class="sxs-lookup"><span data-stu-id="37d18-241">id</span></span>
- <span data-ttu-id="37d18-242">nazwa</span><span class="sxs-lookup"><span data-stu-id="37d18-242">name</span></span>
- <span data-ttu-id="37d18-243">Link</span><span class="sxs-lookup"><span data-stu-id="37d18-243">link</span></span>
- <span data-ttu-id="37d18-244">płeć</span><span class="sxs-lookup"><span data-stu-id="37d18-244">gender</span></span>
- <span data-ttu-id="37d18-245">accesstoken</span><span class="sxs-lookup"><span data-stu-id="37d18-245">accesstoken</span></span>

<span data-ttu-id="37d18-246">Innych dostawców mają podobne, lecz nieco różni się danych we właściwości ExtraData.</span><span class="sxs-lookup"><span data-stu-id="37d18-246">Other providers will have similar but slightly different data in the ExtraData property.</span></span>

<span data-ttu-id="37d18-247">Jeśli jesteś nowym użytkownikiem witryny jest użytkownik, będzie pobrać niektóre dodatkowe dane i przekazywać dane do widoku potwierdzenia.</span><span class="sxs-lookup"><span data-stu-id="37d18-247">If the user is new to your site, you will retrieve some the additional data and pass that data to the confirmation view.</span></span> <span data-ttu-id="37d18-248">Ostatni blok kodu w metodzie jest uruchamiane tylko wtedy, gdy użytkownik jest nowym składnikiem w lokacji.</span><span class="sxs-lookup"><span data-stu-id="37d18-248">The last block of code in the method is run only if the user is new to your site.</span></span> <span data-ttu-id="37d18-249">Zastąp następujący wiersz:</span><span class="sxs-lookup"><span data-stu-id="37d18-249">Replace the following line:</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample8.cs)]

<span data-ttu-id="37d18-250">w tym:</span><span class="sxs-lookup"><span data-stu-id="37d18-250">With this line:</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample9.cs)]

<span data-ttu-id="37d18-251">Ta zmiana obejmuje tylko wartości dla właściwości FullName i łącza.</span><span class="sxs-lookup"><span data-stu-id="37d18-251">This change merely includes values for the FullName and Link properties.</span></span>

<span data-ttu-id="37d18-252">W **ExternalLoginConfirmation** metody, zmodyfikuj kod wyróżniony poniżej, aby zapisać dodatkowe informacje dotyczące użytkownika.</span><span class="sxs-lookup"><span data-stu-id="37d18-252">In the **ExternalLoginConfirmation** method, modify the code as highlighted below to save the additional user information.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample10.cs?highlight=4,7-13)]

## <a name="adjusting-the-view"></a><span data-ttu-id="37d18-253">Dostosowywanie widoku</span><span class="sxs-lookup"><span data-stu-id="37d18-253">Adjusting the view</span></span>

<span data-ttu-id="37d18-254">Pobranie z dostawcy danych dodatkowych użytkownika pojawi się na stronie rejestracji.</span><span class="sxs-lookup"><span data-stu-id="37d18-254">The additional user data that you retrieve from the provider will be displayed in the registration page.</span></span>

<span data-ttu-id="37d18-255">W **widoków**/**konta** folder, otwórz **ExternalLoginConfirmation.cshtml**.</span><span class="sxs-lookup"><span data-stu-id="37d18-255">In the **Views**/**Account** folder, open **ExternalLoginConfirmation.cshtml**.</span></span> <span data-ttu-id="37d18-256">Poniżej istniejącego pola dla nazwy użytkownika należy dodać pola Imię i nazwisko, Link i PictureLink.</span><span class="sxs-lookup"><span data-stu-id="37d18-256">Below the existing field for user name, add fields for FullName, Link, and PictureLink.</span></span>

[!code-cshtml[Main](using-oauth-providers-with-mvc/samples/sample11.cshtml)]

<span data-ttu-id="37d18-257">Teraz jesteś już prawie gotowe uruchomić aplikację i zarejestrować nowego użytkownika o dodatkowe informacje, które są zapisywane.</span><span class="sxs-lookup"><span data-stu-id="37d18-257">You are now almost ready to run the application and register a new user with the additional information saved.</span></span> <span data-ttu-id="37d18-258">Konieczne jest posiadanie konta, które nie jest już zarejestrowany w witrynie.</span><span class="sxs-lookup"><span data-stu-id="37d18-258">You must have an account that is not already registered with the site.</span></span> <span data-ttu-id="37d18-259">Możesz używać konta innego testu, lub usuwanie wierszy w **UserProfile** i **stron sieci Web\_OAuthMembership** tabel dla konta chcesz użyć ponownie.</span><span class="sxs-lookup"><span data-stu-id="37d18-259">You can either use a different test account, or delete the rows in the **UserProfile** and **webpages\_OAuthMembership** tables for the account you wish to reuse.</span></span> <span data-ttu-id="37d18-260">Przez usunięcie tych wierszy, użytkownik musi zagwarantować ponownie zarejestrować konto.</span><span class="sxs-lookup"><span data-stu-id="37d18-260">By deleting those rows, you will ensure that the account is registered again.</span></span>

<span data-ttu-id="37d18-261">Uruchom aplikację i zarejestrować nowego użytkownika.</span><span class="sxs-lookup"><span data-stu-id="37d18-261">Run the application and register the new user.</span></span> <span data-ttu-id="37d18-262">Należy zauważyć, że tym razem strona potwierdzenia zawiera więcej wartości.</span><span class="sxs-lookup"><span data-stu-id="37d18-262">Notice that this time the confirmation page contains more values.</span></span>

![zarejestruj](using-oauth-providers-with-mvc/_static/image12.png)

<span data-ttu-id="37d18-264">Po zakończeniu rejestracji, zamknij przeglądarkę.</span><span class="sxs-lookup"><span data-stu-id="37d18-264">After completing registration, close the browser.</span></span> <span data-ttu-id="37d18-265">Szukaj w bazie danych, zwróć uwagę na nowe wartości w **ExtraUserInformation** tabeli.</span><span class="sxs-lookup"><span data-stu-id="37d18-265">Look in the database to notice the new values in the **ExtraUserInformation** table.</span></span>

## <a name="install-nuget-package-for-facebook-api"></a><span data-ttu-id="37d18-266">Zainstaluj pakiet NuGet dla interfejsu API usługi Facebook</span><span class="sxs-lookup"><span data-stu-id="37d18-266">Install NuGet package for Facebook API</span></span>

<span data-ttu-id="37d18-267">Udostępnia usługi Facebook [API](https://developers.facebook.com/docs/reference/apis/) , można wywołać w celu wykonania operacji.</span><span class="sxs-lookup"><span data-stu-id="37d18-267">Facebook provides an [API](https://developers.facebook.com/docs/reference/apis/) that you can call to perform operations.</span></span> <span data-ttu-id="37d18-268">Możesz wywołać interfejs API usługi Facebook, kierując wysyłania żądań HTTP lub przy użyciu instalacji pakietu NuGet, który ułatwia wysyłanie tych żądań.</span><span class="sxs-lookup"><span data-stu-id="37d18-268">You can call the Facebook API either by directing sending HTTP requests, or by using installing a NuGet package that facilitates sending those requests.</span></span> <span data-ttu-id="37d18-269">Przy użyciu pakietu NuGet jest wyświetlany w tym samouczku, ale NuGet Instalowanie pakietu nie jest istotne.</span><span class="sxs-lookup"><span data-stu-id="37d18-269">Using a NuGet package is shown in this tutorial, but installing NuGet package is not essential.</span></span> <span data-ttu-id="37d18-270">W tym samouczku przedstawiono sposób użycia pakietu zestawu SDK języka C# usługi Facebook.</span><span class="sxs-lookup"><span data-stu-id="37d18-270">This tutorial shows how to use the Facebook C# SDK package.</span></span> <span data-ttu-id="37d18-271">Istnieją inne pakiety NuGet uzyskanymi podczas wywoływania interfejsu API usługi Facebook.</span><span class="sxs-lookup"><span data-stu-id="37d18-271">There are other NuGet packages that assist with calling the Facebook API.</span></span>

<span data-ttu-id="37d18-272">Z **Zarządzaj pakietami NuGet** systemu windows, wybierz pakiet zestawu SDK języka C# usługi Facebook.</span><span class="sxs-lookup"><span data-stu-id="37d18-272">From the **Manage NuGet Packages** windows, select the Facebook C# SDK package.</span></span>

![Zainstaluj pakiet](using-oauth-providers-with-mvc/_static/image13.png)

<span data-ttu-id="37d18-274">Użyjesz Facebook zestawu SDK C# do wywołania operacji, która wymaga tokenu dostępu dla użytkownika.</span><span class="sxs-lookup"><span data-stu-id="37d18-274">You will use the Facebook C# SDK to call an operation that requires the access token for the user.</span></span> <span data-ttu-id="37d18-275">Następna sekcja pokazuje, jak uzyskać token dostępu.</span><span class="sxs-lookup"><span data-stu-id="37d18-275">The next section shows how to get the access token.</span></span>

## <a name="retrieve-access-token"></a><span data-ttu-id="37d18-276">Pobieranie tokenu dostępu</span><span class="sxs-lookup"><span data-stu-id="37d18-276">Retrieve access token</span></span>

<span data-ttu-id="37d18-277">Większość zewnętrznych dostawców przesłać token dostępu po zweryfikowaniu poświadczeń użytkownika.</span><span class="sxs-lookup"><span data-stu-id="37d18-277">Most external providers pass back an access token after the user's credentials are verified.</span></span> <span data-ttu-id="37d18-278">Ten token dostępu jest bardzo ważne, ponieważ umożliwia wywoływanie operacji, które są dostępne tylko dla uwierzytelnionych użytkowników.</span><span class="sxs-lookup"><span data-stu-id="37d18-278">This access token is very important because it enables you to call operations that are only available to authenticated users.</span></span> <span data-ttu-id="37d18-279">W związku z tym pobierania i przechowywania token dostępu jest niezbędne zapewnić więcej funkcji.</span><span class="sxs-lookup"><span data-stu-id="37d18-279">Therefore, retrieving and storing the access token is essential when you want to provide more functionality.</span></span>

<span data-ttu-id="37d18-280">W zależności od zewnętrznego dostawcy tokenu dostępu może mieć okresu ważności ograniczoną ilość czasu.</span><span class="sxs-lookup"><span data-stu-id="37d18-280">Depending on the external provider, the access token may be valid for only a limited amount of time.</span></span> <span data-ttu-id="37d18-281">Aby upewnić się, że masz token dostępu nie jest ważna, można będzie pobrać każdorazowo użytkownik loguje się i zapisz go jako wartość sesji zamiast zapisywanie w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="37d18-281">To ensure that you have a valid access token, you will retrieve it each time the user logs in, and store it as a session value rather than save it to a database.</span></span>

<span data-ttu-id="37d18-282">W **ExternalLoginCallback** metody token dostępu jest również przekazany z powrotem do **ExtraData** właściwość **AuthenticationResult** obiektu.</span><span class="sxs-lookup"><span data-stu-id="37d18-282">In the **ExternalLoginCallback** method, the access token is also passed back in the **ExtraData** property of the **AuthenticationResult** object.</span></span> <span data-ttu-id="37d18-283">Dodaj wyróżniony kod do **ExternalLoginCallback** zapisanie tokenu dostępu w **sesji** obiektu.</span><span class="sxs-lookup"><span data-stu-id="37d18-283">Add the highlighted code to **ExternalLoginCallback** to save the access token in the **Session** object.</span></span> <span data-ttu-id="37d18-284">Ten kod jest uruchamiany za każdym razem, gdy użytkownik zaloguje się za pomocą konta w serwisie Facebook.</span><span class="sxs-lookup"><span data-stu-id="37d18-284">This code is run every time the user logs in with a Facebook account.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample12.cs?highlight=11-14)]

<span data-ttu-id="37d18-285">Mimo że w tym przykładzie pobiera token dostępu z usługi Facebook, możesz pobrać token dostępu z dowolnego zewnętrznego dostawcy za pomocą tego samego klucza o nazwie &quot;accesstoken&quot;.</span><span class="sxs-lookup"><span data-stu-id="37d18-285">Although this example retrieves an access token from Facebook, you can retrieve the access token from any external provider through the same key named &quot;accesstoken&quot;.</span></span>

## <a name="logging-off"></a><span data-ttu-id="37d18-286">Trwa wylogowywanie</span><span class="sxs-lookup"><span data-stu-id="37d18-286">Logging off</span></span>

<span data-ttu-id="37d18-287">Wartość domyślna **wylogowania** metody logowania użytkownika z aplikacji, ale nie rejestruje użytkownika poza zewnętrznego dostawcy.</span><span class="sxs-lookup"><span data-stu-id="37d18-287">The default **LogOff** method logs the user out of your application, but does not log the user out of the external provider.</span></span> <span data-ttu-id="37d18-288">Aby zalogować użytkownika z usługi Facebook i uniemożliwić przechowywanie po wylogowaniu użytkownika tokenu, można dodać następujący wyróżniony kod do **wylogowania** metody w elementu AccountController.</span><span class="sxs-lookup"><span data-stu-id="37d18-288">To log the user out of Facebook, and prevent the token from persisting after the user has logged off, you can add the following highlighted code to the **LogOff** method in the AccountController.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample13.cs?highlight=6-14)]

<span data-ttu-id="37d18-289">Wartości podane `next` parametr jest adres URL do użycia po użytkownik zaloguje się z serwisem Facebook.</span><span class="sxs-lookup"><span data-stu-id="37d18-289">The value you provide in the `next` parameter is the URL to use after the user has logged out of Facebook.</span></span> <span data-ttu-id="37d18-290">Podczas testowania, na komputerze lokalnym, czy Podaj prawidłowy numer portu lokacji lokalnej.</span><span class="sxs-lookup"><span data-stu-id="37d18-290">When testing on your local computer, you would provide the correct port number for your local site.</span></span> <span data-ttu-id="37d18-291">W środowisku produkcyjnym zapewni domyślną stronę, np. contoso.com.</span><span class="sxs-lookup"><span data-stu-id="37d18-291">In production, you would provide a default page, such as contoso.com.</span></span>

## <a name="retrieve-user-information-that-requires-the-access-token"></a><span data-ttu-id="37d18-292">Pobierz informacje o użytkowniku, który wymaga tokenu dostępu</span><span class="sxs-lookup"><span data-stu-id="37d18-292">Retrieve user information that requires the access token</span></span>

<span data-ttu-id="37d18-293">Skoro masz przechowywane token dostępu i zainstalować pakiet zestawu SDK języka C# usługi Facebook, możesz użyć ich do żądania dodatkowych informacji dotyczących użytkowników z usługi Facebook.</span><span class="sxs-lookup"><span data-stu-id="37d18-293">Now that you have stored the access token and installed the Facebook C# SDK package, you can use them together to request additional user information from Facebook.</span></span> <span data-ttu-id="37d18-294">W **ExternalLoginConfirmation** metody, Utwórz wystąpienie obiektu **FacebookClient** klasy, przekazując wartość tokenu dostępu.</span><span class="sxs-lookup"><span data-stu-id="37d18-294">In the **ExternalLoginConfirmation** method, create an instance of the **FacebookClient** class by passing the value of the access token.</span></span> <span data-ttu-id="37d18-295">Wartość żądania **zweryfikować** właściwość obecnie uwierzytelniony użytkownik.</span><span class="sxs-lookup"><span data-stu-id="37d18-295">Request the value of the **verified** property for the current, authenticated user.</span></span> <span data-ttu-id="37d18-296">**Zweryfikować** właściwość wskazuje, czy Facebook został zweryfikowany konta w inny sposób, na przykład wysłanie wiadomości na telefon komórkowy.</span><span class="sxs-lookup"><span data-stu-id="37d18-296">The **verified** property indicates whether Facebook has validated the account through some other means, such as sending a message to a cell phone.</span></span> <span data-ttu-id="37d18-297">Zapisz tę wartość w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="37d18-297">Save this value in the database.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample14.cs?highlight=7-18,25)]

<span data-ttu-id="37d18-298">Należy ponownie usunąć rekordy w bazie danych użytkownika albo użyj innego konta w serwisie Facebook.</span><span class="sxs-lookup"><span data-stu-id="37d18-298">You will again need to either delete the records in the database for the user, or use a different Facebook account.</span></span>

<span data-ttu-id="37d18-299">Uruchom aplikację i zarejestrować nowego użytkownika.</span><span class="sxs-lookup"><span data-stu-id="37d18-299">Run the application, and register the new user.</span></span> <span data-ttu-id="37d18-300">Przyjrzyj się **ExtraUserInformation** tabelę, aby sprawdzić wartość właściwości zweryfikowany.</span><span class="sxs-lookup"><span data-stu-id="37d18-300">Look at the **ExtraUserInformation** table to see the value for the Verified property.</span></span>

## <a name="conclusion"></a><span data-ttu-id="37d18-301">Wniosek</span><span class="sxs-lookup"><span data-stu-id="37d18-301">Conclusion</span></span>

<span data-ttu-id="37d18-302">W tym samouczku utworzono lokację, która jest zintegrowana z usługą Facebook do uwierzytelniania użytkowników i dane rejestracji.</span><span class="sxs-lookup"><span data-stu-id="37d18-302">In this tutorial, you created a site that is integrated with Facebook for user authentication and registration data.</span></span> <span data-ttu-id="37d18-303">Wiesz już o zachowanie domyślne, które zostało skonfigurowane do aplikacji sieci web MVC 4 oraz jak dostosować to zachowanie domyślne.</span><span class="sxs-lookup"><span data-stu-id="37d18-303">You learned about the default behavior that is set up for MVC 4 web application, and how to customize that default behavior.</span></span>

## <a name="related-topics"></a><span data-ttu-id="37d18-304">Tematy pokrewne</span><span class="sxs-lookup"><span data-stu-id="37d18-304">Related topics</span></span>

- [<span data-ttu-id="37d18-305">Tworzenie aplikacji ASP.NET MVC z uwierzytelnianiem i bazą danych SQL i wdrażanie w usłudze Azure App Service</span><span class="sxs-lookup"><span data-stu-id="37d18-305">Create an ASP.NET MVC app with auth and SQL DB and deploy to Azure App Service</span></span>](https://docs.microsoft.com/aspnet/core/security/authorization/secure-data)
