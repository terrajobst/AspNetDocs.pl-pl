---
uid: mvc/overview/older-versions/getting-started-with-ef-5-using-mvc-4/sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application
title: Sortowanie, filtrowanie i stronicowanie za pomocą Entity Framework w aplikacji ASP.NET MVC (3 z 10) | Microsoft Docs
author: tdykstra
description: Przykładowa aplikacja internetowa Contoso University pokazuje, jak tworzyć aplikacje ASP.NET MVC 4 przy użyciu Code First Entity Framework 5 i programu Visual Studio...
ms.author: riande
ms.date: 07/30/2013
ms.assetid: 8af630e0-fffa-4110-9eca-c96e201b2724
msc.legacyurl: /mvc/overview/older-versions/getting-started-with-ef-5-using-mvc-4/sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application
msc.type: authoredcontent
ms.openlocfilehash: b1ddb70805dcb07fb60eea895ff572c054bde5c6
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 11/28/2019
ms.locfileid: "74595221"
---
# <a name="sorting-filtering-and-paging-with-the-entity-framework-in-an-aspnet-mvc-application-3-of-10"></a><span data-ttu-id="8023b-103">Sortowanie, filtrowanie i stronicowanie przy użyciu Entity Framework w aplikacji ASP.NET MVC (3 z 10)</span><span class="sxs-lookup"><span data-stu-id="8023b-103">Sorting, Filtering, and Paging with the Entity Framework in an ASP.NET MVC Application (3 of 10)</span></span>

<span data-ttu-id="8023b-104">Autor [Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="8023b-104">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

[<span data-ttu-id="8023b-105">Pobierz ukończony projekt</span><span class="sxs-lookup"><span data-stu-id="8023b-105">Download Completed Project</span></span>](https://code.msdn.microsoft.com/Getting-Started-with-dd0e2ed8)

> <span data-ttu-id="8023b-106">Przykładowa aplikacja internetowa Contoso University pokazuje, jak tworzyć aplikacje ASP.NET MVC 4 przy użyciu Entity Framework 5 Code First i programu Visual Studio 2012.</span><span class="sxs-lookup"><span data-stu-id="8023b-106">The Contoso University sample web application demonstrates how to create ASP.NET MVC 4 applications using the Entity Framework 5 Code First and Visual Studio 2012.</span></span> <span data-ttu-id="8023b-107">Aby uzyskać informacje na temat serii samouczków, zobacz [pierwszy samouczek w serii](creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span><span class="sxs-lookup"><span data-stu-id="8023b-107">For information about the tutorial series, see [the first tutorial in the series](creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span></span> <span data-ttu-id="8023b-108">Możesz uruchomić serię samouczków od początku lub [pobrać początkowy projekt dla tego rozdziału](building-the-ef5-mvc4-chapter-downloads.md) i Zacznij tutaj.</span><span class="sxs-lookup"><span data-stu-id="8023b-108">You can start the tutorial series from the beginning or [download a starter project for this chapter](building-the-ef5-mvc4-chapter-downloads.md) and start here.</span></span>
> 
> > [!NOTE] 
> > 
> > <span data-ttu-id="8023b-109">Jeśli wystąpi problem, którego nie można rozwiązać, [Pobierz ukończony rozdział](building-the-ef5-mvc4-chapter-downloads.md) i spróbuj odtworzyć problem.</span><span class="sxs-lookup"><span data-stu-id="8023b-109">If you run into a problem you can't resolve, [download the completed chapter](building-the-ef5-mvc4-chapter-downloads.md) and try to reproduce your problem.</span></span> <span data-ttu-id="8023b-110">Ogólnie rzecz biorąc, można znaleźć rozwiązanie problemu, porównując kod z kompletnym kodem.</span><span class="sxs-lookup"><span data-stu-id="8023b-110">You can generally find the solution to the problem by comparing your code to the completed code.</span></span> <span data-ttu-id="8023b-111">Niektóre typowe błędy i sposoby ich rozwiązywania można znaleźć w temacie [błędy i obejścia.](advanced-entity-framework-scenarios-for-an-mvc-web-application.md#errors)</span><span class="sxs-lookup"><span data-stu-id="8023b-111">For some common errors and how to solve them, see [Errors and Workarounds.](advanced-entity-framework-scenarios-for-an-mvc-web-application.md#errors)</span></span>

<span data-ttu-id="8023b-112">W poprzednim samouczku zaimplementowano zestaw stron sieci Web dla podstawowych operacji CRUD dla jednostek `Student`.</span><span class="sxs-lookup"><span data-stu-id="8023b-112">In the previous tutorial you implemented a set of web pages for basic CRUD operations for `Student` entities.</span></span> <span data-ttu-id="8023b-113">W tym samouczku dodasz funkcje sortowania, filtrowania i stronicowania na stronie indeksu **uczniów** .</span><span class="sxs-lookup"><span data-stu-id="8023b-113">In this tutorial you'll add sorting, filtering, and paging functionality to the **Students** Index page.</span></span> <span data-ttu-id="8023b-114">Utworzysz również stronę, która będzie prostą grupowaniem.</span><span class="sxs-lookup"><span data-stu-id="8023b-114">You'll also create a page that does simple grouping.</span></span>

<span data-ttu-id="8023b-115">Na poniższej ilustracji przedstawiono, jak będzie wyglądać strona po zakończeniu.</span><span class="sxs-lookup"><span data-stu-id="8023b-115">The following illustration shows what the page will look like when you're done.</span></span> <span data-ttu-id="8023b-116">Nagłówki kolumn to linki, które użytkownik może kliknąć, aby posortować według tej kolumny.</span><span class="sxs-lookup"><span data-stu-id="8023b-116">The column headings are links that the user can click to sort by that column.</span></span> <span data-ttu-id="8023b-117">Wielokrotne kliknięcie nagłówka kolumny powoduje przełączenie między rosnącą i malejącą kolejnością sortowania.</span><span class="sxs-lookup"><span data-stu-id="8023b-117">Clicking a column heading repeatedly toggles between ascending and descending sort order.</span></span>

![Students_Index_page_with_paging](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image1.png)

## <a name="add-column-sort-links-to-the-students-index-page"></a><span data-ttu-id="8023b-119">Dodaj linki do sortowania kolumn na stronie indeksu uczniów</span><span class="sxs-lookup"><span data-stu-id="8023b-119">Add Column Sort Links to the Students Index Page</span></span>

<span data-ttu-id="8023b-120">Aby dodać sortowanie na stronie indeksu ucznia, należy zmienić metodę `Index` kontrolera `Student` i dodać kod do widoku indeksu `Student`.</span><span class="sxs-lookup"><span data-stu-id="8023b-120">To add sorting to the Student Index page, you'll change the `Index` method of the `Student` controller and add code to the `Student` Index view.</span></span>

### <a name="add-sorting-functionality-to-the-index-method"></a><span data-ttu-id="8023b-121">Dodawanie funkcji sortowania do metody index</span><span class="sxs-lookup"><span data-stu-id="8023b-121">Add Sorting Functionality to the Index Method</span></span>

<span data-ttu-id="8023b-122">W *Controllers\StudentController.cs*Zastąp metodę `Index` następującym kodem:</span><span class="sxs-lookup"><span data-stu-id="8023b-122">In *Controllers\StudentController.cs*, replace the `Index` method with the following code:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample1.cs)]

<span data-ttu-id="8023b-123">Ten kod otrzymuje parametr `sortOrder` z ciągu zapytania w adresie URL.</span><span class="sxs-lookup"><span data-stu-id="8023b-123">This code receives a `sortOrder` parameter from the query string in the URL.</span></span> <span data-ttu-id="8023b-124">Wartość ciągu zapytania jest dostarczana przez ASP.NET MVC jako parametr do metody akcji.</span><span class="sxs-lookup"><span data-stu-id="8023b-124">The query string value is provided by ASP.NET MVC as a parameter to the action method.</span></span> <span data-ttu-id="8023b-125">Parametr będzie ciągiem "name" lub "date", opcjonalnie po znaku podkreślenia i ciągu "DESC" w celu określenia kolejności malejącej.</span><span class="sxs-lookup"><span data-stu-id="8023b-125">The parameter will be a string that's either "Name" or "Date", optionally followed by an underscore and the string "desc" to specify descending order.</span></span> <span data-ttu-id="8023b-126">Domyślna kolejność sortowania to Ascending.</span><span class="sxs-lookup"><span data-stu-id="8023b-126">The default sort order is ascending.</span></span>

<span data-ttu-id="8023b-127">Podczas pierwszego żądania strony indeksu nie ma ciągu zapytania.</span><span class="sxs-lookup"><span data-stu-id="8023b-127">The first time the Index page is requested, there's no query string.</span></span> <span data-ttu-id="8023b-128">Studenci są wyświetlani w kolejności rosnącej według `LastName`, która jest wartością domyślną ustanowioną przez przypadek przypadania w instrukcji `switch`.</span><span class="sxs-lookup"><span data-stu-id="8023b-128">The students are displayed in ascending order by `LastName`, which is the default as established by the fall-through case in the `switch` statement.</span></span> <span data-ttu-id="8023b-129">Gdy użytkownik kliknie hiperlink nagłówka kolumny, odpowiednia wartość `sortOrder` jest podawana w ciągu zapytania.</span><span class="sxs-lookup"><span data-stu-id="8023b-129">When the user clicks a column heading hyperlink, the appropriate `sortOrder` value is provided in the query string.</span></span>

<span data-ttu-id="8023b-130">Dwie zmienne `ViewBag` są używane, aby widok mógł skonfigurować hiperłącza nagłówków kolumn z odpowiednimi wartościami ciągu zapytania:</span><span class="sxs-lookup"><span data-stu-id="8023b-130">The two `ViewBag` variables are used so that the view can configure the column heading hyperlinks with the appropriate query string values:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample2.cs)]

<span data-ttu-id="8023b-131">Są to "Trzyelementowy".</span><span class="sxs-lookup"><span data-stu-id="8023b-131">These are ternary statements.</span></span> <span data-ttu-id="8023b-132">Pierwszy z nich określa, że jeśli parametr `sortOrder` ma wartość null lub jest pusty, `ViewBag.NameSortParm` powinna być ustawiona na wartość "name\_DESC"; w przeciwnym razie należy ustawić pusty ciąg.</span><span class="sxs-lookup"><span data-stu-id="8023b-132">The first one specifies that if the `sortOrder` parameter is null or empty, `ViewBag.NameSortParm` should be set to "name\_desc"; otherwise, it should be set to an empty string.</span></span> <span data-ttu-id="8023b-133">Te dwie instrukcje umożliwiają widokowi ustawienie hiperłączy nagłówka kolumny w następujący sposób:</span><span class="sxs-lookup"><span data-stu-id="8023b-133">These two statements enable the view to set the column heading hyperlinks as follows:</span></span>

| <span data-ttu-id="8023b-134">Bieżący porządek sortowania</span><span class="sxs-lookup"><span data-stu-id="8023b-134">Current sort order</span></span> | <span data-ttu-id="8023b-135">Hiperłącze nazwisko</span><span class="sxs-lookup"><span data-stu-id="8023b-135">Last Name Hyperlink</span></span> | <span data-ttu-id="8023b-136">Hiperłącze daty</span><span class="sxs-lookup"><span data-stu-id="8023b-136">Date Hyperlink</span></span> |
| --- | --- | --- |
| <span data-ttu-id="8023b-137">Nazwisko — rosnąco</span><span class="sxs-lookup"><span data-stu-id="8023b-137">Last Name ascending</span></span> | <span data-ttu-id="8023b-138">descending</span><span class="sxs-lookup"><span data-stu-id="8023b-138">descending</span></span> | <span data-ttu-id="8023b-139">ascending</span><span class="sxs-lookup"><span data-stu-id="8023b-139">ascending</span></span> |
| <span data-ttu-id="8023b-140">Nazwisko malejąco</span><span class="sxs-lookup"><span data-stu-id="8023b-140">Last Name descending</span></span> | <span data-ttu-id="8023b-141">ascending</span><span class="sxs-lookup"><span data-stu-id="8023b-141">ascending</span></span> | <span data-ttu-id="8023b-142">ascending</span><span class="sxs-lookup"><span data-stu-id="8023b-142">ascending</span></span> |
| <span data-ttu-id="8023b-143">Data rosnąca</span><span class="sxs-lookup"><span data-stu-id="8023b-143">Date ascending</span></span> | <span data-ttu-id="8023b-144">ascending</span><span class="sxs-lookup"><span data-stu-id="8023b-144">ascending</span></span> | <span data-ttu-id="8023b-145">descending</span><span class="sxs-lookup"><span data-stu-id="8023b-145">descending</span></span> |
| <span data-ttu-id="8023b-146">Data malejąca</span><span class="sxs-lookup"><span data-stu-id="8023b-146">Date descending</span></span> | <span data-ttu-id="8023b-147">ascending</span><span class="sxs-lookup"><span data-stu-id="8023b-147">ascending</span></span> | <span data-ttu-id="8023b-148">ascending</span><span class="sxs-lookup"><span data-stu-id="8023b-148">ascending</span></span> |

<span data-ttu-id="8023b-149">Metoda używa [LINQ to Entities](https://msdn.microsoft.com/library/bb386964.aspx) , aby określić kolumnę, według której ma zostać wykonane sortowanie.</span><span class="sxs-lookup"><span data-stu-id="8023b-149">The method uses [LINQ to Entities](https://msdn.microsoft.com/library/bb386964.aspx) to specify the column to sort by.</span></span> <span data-ttu-id="8023b-150">Kod tworzy zmienną [IQueryable](https://msdn.microsoft.com/library/bb351562.aspx) przed instrukcją `switch`, modyfikuje ją w instrukcji `switch` i wywołuje metodę `ToList` po instrukcji `switch`.</span><span class="sxs-lookup"><span data-stu-id="8023b-150">The code creates an [IQueryable](https://msdn.microsoft.com/library/bb351562.aspx) variable before the `switch` statement, modifies it in the `switch` statement, and calls the `ToList` method after the `switch` statement.</span></span> <span data-ttu-id="8023b-151">Gdy tworzysz i modyfikujesz zmienne `IQueryable`, żadne zapytanie nie jest wysyłane do bazy danych.</span><span class="sxs-lookup"><span data-stu-id="8023b-151">When you create and modify `IQueryable` variables, no query is sent to the database.</span></span> <span data-ttu-id="8023b-152">Zapytanie nie jest wykonywane do momentu przekonwertowania obiektu `IQueryable` do kolekcji przez wywołanie metody, takiej jak `ToList`.</span><span class="sxs-lookup"><span data-stu-id="8023b-152">The query is not executed until you convert the `IQueryable` object into a collection by calling a method such as `ToList`.</span></span> <span data-ttu-id="8023b-153">W związku z tym ten kod skutkuje pojedynczym zapytaniem, które nie jest wykonywane do momentu instrukcji `return View`.</span><span class="sxs-lookup"><span data-stu-id="8023b-153">Therefore, this code results in a single query that is not executed until the `return View` statement.</span></span>

### <a name="add-column-heading-hyperlinks-to-the-student-index-view"></a><span data-ttu-id="8023b-154">Dodawanie hiperłączy nagłówka kolumny do widoku indeksu ucznia</span><span class="sxs-lookup"><span data-stu-id="8023b-154">Add Column Heading Hyperlinks to the Student Index View</span></span>

<span data-ttu-id="8023b-155">W *Views\Student\Index.cshtml*zastąp `<tr>` i `<th>` elementów dla wiersza nagłówka z wyróżnionym kodem:</span><span class="sxs-lookup"><span data-stu-id="8023b-155">In *Views\Student\Index.cshtml*, replace the `<tr>` and `<th>` elements for the heading row with the highlighted code:</span></span>

[!code-cshtml[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample3.cshtml?highlight=5-15)]

<span data-ttu-id="8023b-156">Ten kod używa informacji we właściwościach `ViewBag`, aby skonfigurować hiperłącza z odpowiednimi wartościami ciągu zapytania.</span><span class="sxs-lookup"><span data-stu-id="8023b-156">This code uses the information in the `ViewBag` properties to set up hyperlinks with the appropriate query string values.</span></span>

<span data-ttu-id="8023b-157">Uruchom stronę i kliknij nagłówki kolumny **nazwisko** i **Data rejestracji** , aby sprawdzić, czy sortowanie działa.</span><span class="sxs-lookup"><span data-stu-id="8023b-157">Run the page and click the **Last Name** and **Enrollment Date** column headings to verify that sorting works.</span></span>

![Students_Index_page_with_sort_hyperlinks](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image2.png)

<span data-ttu-id="8023b-159">Po **kliknięciu nagłówka nazwisko** uczniowie będą wyświetlane w kolejności malejących nazwisk.</span><span class="sxs-lookup"><span data-stu-id="8023b-159">After you click the **Last Name** heading, students are displayed in descending last name order.</span></span>

![](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image3.png)

## <a name="add-a-search-box-to-the-students-index-page"></a><span data-ttu-id="8023b-160">Dodawanie pola wyszukiwania do strony indeksu uczniów</span><span class="sxs-lookup"><span data-stu-id="8023b-160">Add a Search Box to the Students Index Page</span></span>

<span data-ttu-id="8023b-161">Aby dodać filtrowanie do strony indeksu uczniów, należy dodać pole tekstowe i przycisk Prześlij do widoku i wprowadzić odpowiednie zmiany w metodzie `Index`.</span><span class="sxs-lookup"><span data-stu-id="8023b-161">To add filtering to the Students Index page, you'll add a text box and a submit button to the view and make corresponding changes in the `Index` method.</span></span> <span data-ttu-id="8023b-162">Pole tekstowe umożliwia wprowadzenie ciągu do wyszukania w polach Imię i nazwisko.</span><span class="sxs-lookup"><span data-stu-id="8023b-162">The text box will let you enter a string to search for in the first name and last name fields.</span></span>

### <a name="add-filtering-functionality-to-the-index-method"></a><span data-ttu-id="8023b-163">Dodawanie funkcji filtrowania do metody index</span><span class="sxs-lookup"><span data-stu-id="8023b-163">Add Filtering Functionality to the Index Method</span></span>

<span data-ttu-id="8023b-164">W *Controllers\StudentController.cs*Zastąp metodę `Index` następującym kodem (zmiany są wyróżnione):</span><span class="sxs-lookup"><span data-stu-id="8023b-164">In *Controllers\StudentController.cs*, replace the `Index` method with the following code (the changes are highlighted):</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample4.cs?highlight=1,7-11)]

<span data-ttu-id="8023b-165">Do metody `Index` został dodany parametr `searchString`.</span><span class="sxs-lookup"><span data-stu-id="8023b-165">You've added a `searchString` parameter to the `Index` method.</span></span> <span data-ttu-id="8023b-166">Dodano również do instrukcji LINQ `where` klauzulę, która wybiera tylko uczniów, których imię lub nazwisko zawiera ciąg wyszukiwania.</span><span class="sxs-lookup"><span data-stu-id="8023b-166">You've also added to the LINQ statement a `where` clause that selects only students whose first name or last name contains the search string.</span></span> <span data-ttu-id="8023b-167">Wartość ciągu wyszukiwania jest odbierana z pola tekstowego, które zostanie dodane do widoku indeksu. Instrukcja, która dodaje klauzulę [WHERE](https://msdn.microsoft.com/library/bb535040.aspx) , jest wykonywana tylko wtedy, gdy istnieje wartość do wyszukania.</span><span class="sxs-lookup"><span data-stu-id="8023b-167">The search string value is received from a text box that you'll add to the Index view.The statement that adds the [where](https://msdn.microsoft.com/library/bb535040.aspx) clause is executed only if there's a value to search for.</span></span>

> [!NOTE]
> <span data-ttu-id="8023b-168">W wielu przypadkach można wywołać tę samą metodę w ramach zestawu jednostek Entity Framework lub jako metodę rozszerzenia w kolekcji w pamięci.</span><span class="sxs-lookup"><span data-stu-id="8023b-168">In many cases you can call the same method either on an Entity Framework entity set or as an extension method on an in-memory collection.</span></span> <span data-ttu-id="8023b-169">Wyniki są zwykle takie same, ale w niektórych przypadkach mogą być różne.</span><span class="sxs-lookup"><span data-stu-id="8023b-169">The results are normally the same but in some cases may be different.</span></span> <span data-ttu-id="8023b-170">Na przykład .NET Framework implementacja metody `Contains` zwraca wszystkie wiersze w przypadku przekazania do niego pustego ciągu, ale dostawca Entity Framework dla SQL Server Compact 4,0 zwraca zero wierszy dla pustych ciągów.</span><span class="sxs-lookup"><span data-stu-id="8023b-170">For example, the .NET Framework implementation of the `Contains` method returns all rows when you pass an empty string to it, but the Entity Framework provider for SQL Server Compact 4.0 returns zero rows for empty strings.</span></span> <span data-ttu-id="8023b-171">W związku z tym kod w przykładzie (umieszczenie instrukcji `Where` wewnątrz instrukcji `if`) gwarantuje, że te same wyniki są uzyskiwane dla wszystkich wersji SQL Server.</span><span class="sxs-lookup"><span data-stu-id="8023b-171">Therefore the code in the example (putting the `Where` statement inside an `if` statement) makes sure that you get the same results for all versions of SQL Server.</span></span> <span data-ttu-id="8023b-172">Ponadto .NET Framework implementacja metody `Contains` domyślnie wykonuje porównanie z uwzględnieniem wielkości liter, ale Entity Framework dostawca SQL Server domyślnie wykonuje porównania bez uwzględniania wielkości liter.</span><span class="sxs-lookup"><span data-stu-id="8023b-172">Also, the .NET Framework implementation of the `Contains` method performs a case-sensitive comparison by default, but Entity Framework SQL Server providers perform case-insensitive comparisons by default.</span></span> <span data-ttu-id="8023b-173">W związku z tym, wywołując metodę `ToUpper`, aby test jawnie nie uwzględniał wielkości liter, nie zmienia się w przypadku późniejszej zmiany kodu w celu użycia repozytorium, które zwróci `IEnumerable` kolekcji zamiast obiektu `IQueryable`.</span><span class="sxs-lookup"><span data-stu-id="8023b-173">Therefore, calling the `ToUpper` method to make the test explicitly case-insensitive ensures that results do not change when you change the code later to use a repository, which will return an `IEnumerable` collection instead of an `IQueryable` object.</span></span> <span data-ttu-id="8023b-174">(W przypadku wywołania metody `Contains` w kolekcji `IEnumerable` zostanie .NET Framework implementacja. po wywołaniu dla obiektu `IQueryable` zostanie wykorzystana implementacja dostawcy bazy danych).</span><span class="sxs-lookup"><span data-stu-id="8023b-174">(When you call the `Contains` method on an `IEnumerable` collection, you get the .NET Framework implementation; when you call it on an `IQueryable` object, you get the database provider implementation.)</span></span>

### <a name="add-a-search-box-to-the-student-index-view"></a><span data-ttu-id="8023b-175">Dodawanie pola wyszukiwania do widoku indeksu ucznia</span><span class="sxs-lookup"><span data-stu-id="8023b-175">Add a Search Box to the Student Index View</span></span>

<span data-ttu-id="8023b-176">W *Views\Student\Index.cshtml*, Dodaj wyróżniony kod bezpośrednio przed otwierającym tagiem `table`, aby utworzyć podpis, pole tekstowe i przycisk **wyszukiwania** .</span><span class="sxs-lookup"><span data-stu-id="8023b-176">In *Views\Student\Index.cshtml*, add the highlighted code immediately before the opening `table` tag in order to create a caption, a text box, and a **Search** button.</span></span>

[!code-cshtml[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample5.cshtml?highlight=5-10)]

<span data-ttu-id="8023b-177">Uruchom stronę, wprowadź ciąg wyszukiwania, a następnie kliknij przycisk **Wyszukaj** , aby sprawdzić, czy filtrowanie działa.</span><span class="sxs-lookup"><span data-stu-id="8023b-177">Run the page, enter a search string, and click **Search** to verify that filtering is working.</span></span>

![Students_Index_page_with_search_box](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image4.png)

<span data-ttu-id="8023b-179">Zwróć uwagę, że adres URL nie zawiera ciągu wyszukiwania "a", co oznacza, że jeśli utworzysz zakładkę na tej stronie, nie otrzymasz filtrowanej listy przy użyciu zakładki.</span><span class="sxs-lookup"><span data-stu-id="8023b-179">Notice the URL doesn't contain the "an" search string, which means that if you bookmark this page, you won't get the filtered list when you use the bookmark.</span></span> <span data-ttu-id="8023b-180">Zmienisz przycisk **wyszukiwania** , aby używać ciągów zapytania dla kryteriów filtrowania w dalszej części tego samouczka.</span><span class="sxs-lookup"><span data-stu-id="8023b-180">You'll change the **Search** button to use query strings for filter criteria later in the tutorial.</span></span>

## <a name="add-paging-to-the-students-index-page"></a><span data-ttu-id="8023b-181">Dodawanie stronicowania do strony indeksu uczniów</span><span class="sxs-lookup"><span data-stu-id="8023b-181">Add Paging to the Students Index Page</span></span>

<span data-ttu-id="8023b-182">Aby dodać stronicowanie do strony indeksu uczniów, Zacznij od zainstalowania pakietu NuGet **PagedList. MVC** .</span><span class="sxs-lookup"><span data-stu-id="8023b-182">To add paging to the Students Index page, you'll start by installing the **PagedList.Mvc** NuGet package.</span></span> <span data-ttu-id="8023b-183">Następnie wprowadzisz dodatkowe zmiany w metodzie `Index` i dodasz linki stronicowania do widoku `Index`.</span><span class="sxs-lookup"><span data-stu-id="8023b-183">Then you'll make additional changes in the `Index` method and add paging links to the `Index` view.</span></span> <span data-ttu-id="8023b-184">**PagedList. MVC** to jeden z wielu dobrych pakietów stronicowania i sortowania dla ASP.NET MVC, a jego użycie w tym miejscu jest przeznaczone tylko jako przykład, a nie jako zalecenia dotyczące innych opcji.</span><span class="sxs-lookup"><span data-stu-id="8023b-184">**PagedList.Mvc** is one of many good paging and sorting packages for ASP.NET MVC, and its use here is intended only as an example, not as a recommendation for it over other options.</span></span> <span data-ttu-id="8023b-185">Na poniższej ilustracji przedstawiono linki stronicowania.</span><span class="sxs-lookup"><span data-stu-id="8023b-185">The following illustration shows the paging links.</span></span>

![Students_index_page_with_paging](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image5.png)

### <a name="install-the-pagedlistmvc-nuget-package"></a><span data-ttu-id="8023b-187">Zainstaluj pakiet NuGet PagedList. MVC</span><span class="sxs-lookup"><span data-stu-id="8023b-187">Install the PagedList.MVC NuGet Package</span></span>

<span data-ttu-id="8023b-188">Pakiet NuGet **PagedList. MVC** automatycznie instaluje pakiet **PagedList** jako zależność.</span><span class="sxs-lookup"><span data-stu-id="8023b-188">The NuGet **PagedList.Mvc** package automatically installs the **PagedList** package as a dependency.</span></span> <span data-ttu-id="8023b-189">Pakiet **PagedList** instaluje `PagedList` typ kolekcji i metody rozszerzające dla kolekcji `IQueryable` i `IEnumerable`.</span><span class="sxs-lookup"><span data-stu-id="8023b-189">The **PagedList** package installs a `PagedList` collection type and extension methods for `IQueryable` and `IEnumerable` collections.</span></span> <span data-ttu-id="8023b-190">Metody rozszerzające umożliwiają utworzenie pojedynczej strony danych w kolekcji `PagedList` z `IQueryable` lub `IEnumerable`, a kolekcja `PagedList` zawiera kilka właściwości i metod, które ułatwiają stronicowanie.</span><span class="sxs-lookup"><span data-stu-id="8023b-190">The extension methods create a single page of data in a `PagedList` collection out of your `IQueryable` or `IEnumerable`, and the `PagedList` collection provides several properties and methods that facilitate paging.</span></span> <span data-ttu-id="8023b-191">Pakiet **PagedList. MVC** instaluje pomocnika stronicowania, który wyświetla przyciski stronicowania.</span><span class="sxs-lookup"><span data-stu-id="8023b-191">The **PagedList.Mvc** package installs a paging helper that displays the paging buttons.</span></span>

<span data-ttu-id="8023b-192">W menu **Narzędzia** wybierz pozycję **Menedżer pakietów NuGet** , a następnie **Zarządzaj pakietami NuGet dla rozwiązania**.</span><span class="sxs-lookup"><span data-stu-id="8023b-192">From the **Tools** menu, select **NuGet Package Manager** and then **Manage NuGet Packages for Solution**.</span></span>

<span data-ttu-id="8023b-193">W oknie dialogowym **Zarządzanie pakietami NuGet** kliknij kartę **online** po lewej stronie, a następnie wprowadź "stronicowane" w polu wyszukiwania.</span><span class="sxs-lookup"><span data-stu-id="8023b-193">In the **Manage NuGet Packages** dialog box, click the **Online** tab on the left and then enter "paged" in the search box.</span></span> <span data-ttu-id="8023b-194">Gdy zobaczysz pakiet **PagedList. MVC** , kliknij przycisk **Instaluj**.</span><span class="sxs-lookup"><span data-stu-id="8023b-194">When you see the **PagedList.Mvc** package, click **Install**.</span></span>

![](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image6.png)

<span data-ttu-id="8023b-195">W polu **Wybierz projekty** kliknij przycisk **OK**.</span><span class="sxs-lookup"><span data-stu-id="8023b-195">In the **Select Projects** box, click **OK**.</span></span>

![](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image7.png)

### <a name="add-paging-functionality-to-the-index-method"></a><span data-ttu-id="8023b-196">Dodawanie funkcji stronicowania do metody index</span><span class="sxs-lookup"><span data-stu-id="8023b-196">Add Paging Functionality to the Index Method</span></span>

<span data-ttu-id="8023b-197">W *Controllers\StudentController.cs*dodaj instrukcję `using` dla przestrzeni nazw `PagedList`:</span><span class="sxs-lookup"><span data-stu-id="8023b-197">In *Controllers\StudentController.cs*, add a `using` statement for the `PagedList` namespace:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample6.cs)]

<span data-ttu-id="8023b-198">Zastąp metodę `Index` następującym kodem:</span><span class="sxs-lookup"><span data-stu-id="8023b-198">Replace the `Index` method with the following code:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample7.cs)]

<span data-ttu-id="8023b-199">Ten kod dodaje parametr `page`, bieżący parametr kolejności sortowania i bieżący parametr filtru do sygnatury metody, jak pokazano poniżej:</span><span class="sxs-lookup"><span data-stu-id="8023b-199">This code adds a `page` parameter, a current sort order parameter, and a current filter parameter to the method signature, as shown here:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample8.cs)]

<span data-ttu-id="8023b-200">Gdy strona jest wyświetlana po raz pierwszy lub jeśli użytkownik nie kliknął linku stronicowania ani sortowania, wszystkie parametry będą mieć wartość null.</span><span class="sxs-lookup"><span data-stu-id="8023b-200">The first time the page is displayed, or if the user hasn't clicked a paging or sorting link, all the parameters will be null.</span></span> <span data-ttu-id="8023b-201">Jeśli zostanie kliknięty link stronicowania, zmienna `page` będzie zawierać numer strony do wyświetlenia.</span><span class="sxs-lookup"><span data-stu-id="8023b-201">If a paging link is clicked, the `page` variable will contain the page number to display.</span></span>

<span data-ttu-id="8023b-202">Właściwość `A ViewBag` zapewnia widok z bieżącą kolejnością sortowania, ponieważ musi być uwzględniony w łączach stronicowania, aby zachować porządek sortowania w tym samym czasie podczas stronicowania:</span><span class="sxs-lookup"><span data-stu-id="8023b-202">`A ViewBag` property provides the view with the current sort order, because this must be included in the paging links in order to keep the sort order the same while paging:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample9.cs)]

<span data-ttu-id="8023b-203">Inna właściwość, `ViewBag.CurrentFilter`, udostępnia widok z bieżącym ciągiem filtru.</span><span class="sxs-lookup"><span data-stu-id="8023b-203">Another property, `ViewBag.CurrentFilter`, provides the view with the current filter string.</span></span> <span data-ttu-id="8023b-204">Ta wartość musi być uwzględniona w łączach stronicowania, aby zachować ustawienia filtru podczas stronicowania, i musi zostać przywrócone do pola tekstowego, gdy strona jest ponownie wyświetlana.</span><span class="sxs-lookup"><span data-stu-id="8023b-204">This value must be included in the paging links in order to maintain the filter settings during paging, and it must be restored to the text box when the page is redisplayed.</span></span> <span data-ttu-id="8023b-205">Jeśli ciąg wyszukiwania zostanie zmieniony podczas stronicowania, należy zresetować stronę do 1, ponieważ nowy filtr może spowodować wyświetlenie różnych danych.</span><span class="sxs-lookup"><span data-stu-id="8023b-205">If the search string is changed during paging, the page has to be reset to 1, because the new filter can result in different data to display.</span></span> <span data-ttu-id="8023b-206">Ciąg wyszukiwania jest zmieniany, gdy wartość zostanie wprowadzona w polu tekstowym, a przycisk Prześlij zostanie naciśnięty.</span><span class="sxs-lookup"><span data-stu-id="8023b-206">The search string is changed when a value is entered in the text box and the submit button is pressed.</span></span> <span data-ttu-id="8023b-207">W takim przypadku parametr `searchString` nie ma wartości null.</span><span class="sxs-lookup"><span data-stu-id="8023b-207">In that case, the `searchString` parameter is not null.</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample10.cs)]

<span data-ttu-id="8023b-208">Na końcu metody `ToPagedList` Metoda rozszerzenia w obiekcie Students `IQueryable` konwertuje zapytanie ucznia na jedną stronę uczniów w typie kolekcji, który obsługuje stronicowanie.</span><span class="sxs-lookup"><span data-stu-id="8023b-208">At the end of the method, the `ToPagedList` extension method on the students `IQueryable` object converts the student query to a single page of students in a collection type that supports paging.</span></span> <span data-ttu-id="8023b-209">Ta pojedyncza strona studentów jest następnie przenoszona do widoku:</span><span class="sxs-lookup"><span data-stu-id="8023b-209">That single page of students is then passed to the view:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample11.cs)]

<span data-ttu-id="8023b-210">Metoda `ToPagedList` przyjmuje numer strony.</span><span class="sxs-lookup"><span data-stu-id="8023b-210">The `ToPagedList` method takes a page number.</span></span> <span data-ttu-id="8023b-211">Dwa znaki zapytania reprezentują [operator łączenia wartości null](https://msdn.microsoft.com/library/ms173224.aspx).</span><span class="sxs-lookup"><span data-stu-id="8023b-211">The two question marks represent the [null-coalescing operator](https://msdn.microsoft.com/library/ms173224.aspx).</span></span> <span data-ttu-id="8023b-212">Operator łączenia wartości null definiuje wartość domyślną dla typu dopuszczającego wartość null; wyrażenie `(page ?? 1)` oznacza zwrócenie wartości `page`, jeśli ma wartość, lub zwraca wartość 1, jeśli `page` jest wartością null.</span><span class="sxs-lookup"><span data-stu-id="8023b-212">The null-coalescing operator defines a default value for a nullable type; the expression `(page ?? 1)` means return the value of `page` if it has a value, or return 1 if `page` is null.</span></span>

### <a name="add-paging-links-to-the-student-index-view"></a><span data-ttu-id="8023b-213">Dodawanie linków stronicowania do widoku indeksu ucznia</span><span class="sxs-lookup"><span data-stu-id="8023b-213">Add Paging Links to the Student Index View</span></span>

<span data-ttu-id="8023b-214">W *Views\Student\Index.cshtml*Zastąp istniejący kod następującym kodem:</span><span class="sxs-lookup"><span data-stu-id="8023b-214">In *Views\Student\Index.cshtml*, replace the existing code with the following code:</span></span>

[!code-cshtml[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample12.cshtml?highlight=6,9,14-20,56-58)]

<span data-ttu-id="8023b-215">Instrukcja `@model` w górnej części strony określa, że widok pobiera teraz obiekt `PagedList` zamiast obiektu `List`.</span><span class="sxs-lookup"><span data-stu-id="8023b-215">The `@model` statement at the top of the page specifies that the view now gets a `PagedList` object instead of a `List` object.</span></span>

<span data-ttu-id="8023b-216">Instrukcja `using` dla `PagedList.Mvc` daje dostęp do pomocnika MVC dla przycisków stronicowania.</span><span class="sxs-lookup"><span data-stu-id="8023b-216">The `using` statement for `PagedList.Mvc` gives access to the MVC helper for the paging buttons.</span></span>

<span data-ttu-id="8023b-217">Kod używa przeciążenia elementu [BeginForm](https://msdn.microsoft.com/library/system.web.mvc.html.formextensions.beginform(v=vs.108).aspx) , który umożliwia określenie [FormMethod. Get](https://msdn.microsoft.com/library/system.web.mvc.formmethod(v=vs.100).aspx/css).</span><span class="sxs-lookup"><span data-stu-id="8023b-217">The code uses an overload of [BeginForm](https://msdn.microsoft.com/library/system.web.mvc.html.formextensions.beginform(v=vs.108).aspx) that allows it to specify [FormMethod.Get](https://msdn.microsoft.com/library/system.web.mvc.formmethod(v=vs.100).aspx/css).</span></span>

[!code-cshtml[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample13.cshtml?highlight=1)]

<span data-ttu-id="8023b-218">Wartość domyślna [BeginForm](https://msdn.microsoft.com/library/system.web.mvc.html.formextensions.beginform(v=vs.108).aspx) przesyła dane formularza z wpisem, co oznacza, że parametry są przesyłane w treści wiadomości HTTP, a nie w adresie URL jako ciągi zapytań.</span><span class="sxs-lookup"><span data-stu-id="8023b-218">The default [BeginForm](https://msdn.microsoft.com/library/system.web.mvc.html.formextensions.beginform(v=vs.108).aspx) submits form data with a POST, which means that parameters are passed in the HTTP message body and not in the URL as query strings.</span></span> <span data-ttu-id="8023b-219">Po określeniu protokołu HTTP GET dane formularza są przesyłane w adresie URL jako ciągi zapytań, co umożliwia użytkownikom tworzenie zakładek w adresie URL.</span><span class="sxs-lookup"><span data-stu-id="8023b-219">When you specify HTTP GET, the form data is passed in the URL as query strings, which enables users to bookmark the URL.</span></span> <span data-ttu-id="8023b-220">[Wskazówki W3C dotyczące korzystania z protokołu HTTP GET](http://www.w3.org/2001/tag/doc/whenToUseGet.html) określają, że należy używać Get, gdy akcja nie spowoduje aktualizacji.</span><span class="sxs-lookup"><span data-stu-id="8023b-220">The [W3C guidelines for the use of HTTP GET](http://www.w3.org/2001/tag/doc/whenToUseGet.html) specify that you should use GET when the action does not result in an update.</span></span>

<span data-ttu-id="8023b-221">Pole tekstowe jest inicjowane z bieżącym ciągiem wyszukiwania, więc po kliknięciu nowej strony można zobaczyć bieżący ciąg wyszukiwania.</span><span class="sxs-lookup"><span data-stu-id="8023b-221">The text box is initialized with the current search string so when you click a new page you can see the current search string.</span></span>

[!code-cshtml[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample14.cshtml?highlight=1)]

<span data-ttu-id="8023b-222">Linki nagłówka kolumny używają ciągu zapytania, aby przekazać bieżący ciąg wyszukiwania do kontrolera, tak aby użytkownik mógł sortować wyniki filtrów:</span><span class="sxs-lookup"><span data-stu-id="8023b-222">The column header links use the query string to pass the current search string to the controller so that the user can sort within filter results:</span></span>

[!code-cshtml[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample15.cshtml?highlight=1)]

<span data-ttu-id="8023b-223">Zostanie wyświetlona bieżąca strona i całkowita liczba stron.</span><span class="sxs-lookup"><span data-stu-id="8023b-223">The current page and total number of pages are displayed.</span></span>

[!code-cshtml[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample16.cshtml)]

<span data-ttu-id="8023b-224">Jeśli nie ma żadnych stron do wyświetlenia, wyświetlana jest wartość "Strona 0 z 0".</span><span class="sxs-lookup"><span data-stu-id="8023b-224">If there are no pages to display, "Page 0 of 0" is shown.</span></span> <span data-ttu-id="8023b-225">(W tym przypadku numer strony jest większy niż liczba stron, ponieważ `Model.PageNumber` wynosi 1, a `Model.PageCount` to 0).</span><span class="sxs-lookup"><span data-stu-id="8023b-225">(In that case the page number is greater than the page count because `Model.PageNumber` is 1, and `Model.PageCount` is 0.)</span></span>

<span data-ttu-id="8023b-226">Przyciski stronicowania są wyświetlane przez pomocnika `PagedListPager`:</span><span class="sxs-lookup"><span data-stu-id="8023b-226">The paging buttons are displayed by the `PagedListPager` helper:</span></span>

[!code-cshtml[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample17.cshtml)]

<span data-ttu-id="8023b-227">Pomocnik `PagedListPager` udostępnia wiele opcji, które można dostosować, w tym adresy URL i style.</span><span class="sxs-lookup"><span data-stu-id="8023b-227">The `PagedListPager` helper provides a number of options that you can customize, including URLs and styling.</span></span> <span data-ttu-id="8023b-228">Aby uzyskać więcej informacji, zobacz [TroyGoode/PagedList](https://github.com/TroyGoode/PagedList) w witrynie GitHub.</span><span class="sxs-lookup"><span data-stu-id="8023b-228">For more information, see [TroyGoode / PagedList](https://github.com/TroyGoode/PagedList) on the GitHub site.</span></span>

<span data-ttu-id="8023b-229">Uruchom stronę.</span><span class="sxs-lookup"><span data-stu-id="8023b-229">Run the page.</span></span>

![Students_index_page_with_paging](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image8.png)

<span data-ttu-id="8023b-231">Kliknij linki stronicowania w różnych kolejności sortowania, aby upewnić się, że stronicowanie działa.</span><span class="sxs-lookup"><span data-stu-id="8023b-231">Click the paging links in different sort orders to make sure paging works.</span></span> <span data-ttu-id="8023b-232">Następnie wprowadź ciąg wyszukiwania i spróbuj ponownie wykonać stronicowanie, aby sprawdzić, czy stronicowanie działa prawidłowo z sortowaniem i filtrowaniem.</span><span class="sxs-lookup"><span data-stu-id="8023b-232">Then enter a search string and try paging again to verify that paging also works correctly with sorting and filtering.</span></span>

![](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image9.png)

## <a name="create-an-about-page-that-shows-student-statistics"></a><span data-ttu-id="8023b-233">Utwórz stronę informacje z informacjami o statystyce uczniów</span><span class="sxs-lookup"><span data-stu-id="8023b-233">Create an About Page That Shows Student Statistics</span></span>

<span data-ttu-id="8023b-234">Na stronie informacje o witrynie sieci Web dla uniwersytetów firmy Contoso można wyświetlić liczbę studentów zarejestrowanych dla każdej daty rejestracji.</span><span class="sxs-lookup"><span data-stu-id="8023b-234">For the Contoso University website's About page, you'll display how many students have enrolled for each enrollment date.</span></span> <span data-ttu-id="8023b-235">Wymaga to grupowania i prostych obliczeń dla grup.</span><span class="sxs-lookup"><span data-stu-id="8023b-235">This requires grouping and simple calculations on the groups.</span></span> <span data-ttu-id="8023b-236">Aby to osiągnąć, należy wykonać następujące czynności:</span><span class="sxs-lookup"><span data-stu-id="8023b-236">To accomplish this, you'll do the following:</span></span>

- <span data-ttu-id="8023b-237">Utwórz klasę modelu widoku dla danych, które należy przekazać do widoku.</span><span class="sxs-lookup"><span data-stu-id="8023b-237">Create a view model class for the data that you need to pass to the view.</span></span>
- <span data-ttu-id="8023b-238">Zmodyfikuj metodę `About` na kontrolerze `Home`.</span><span class="sxs-lookup"><span data-stu-id="8023b-238">Modify the `About` method in the `Home` controller.</span></span>
- <span data-ttu-id="8023b-239">Zmodyfikuj widok `About`.</span><span class="sxs-lookup"><span data-stu-id="8023b-239">Modify the `About` view.</span></span>

### <a name="create-the-view-model"></a><span data-ttu-id="8023b-240">Tworzenie modelu widoku</span><span class="sxs-lookup"><span data-stu-id="8023b-240">Create the View Model</span></span>

<span data-ttu-id="8023b-241">Utwórz folder *modele widoków* .</span><span class="sxs-lookup"><span data-stu-id="8023b-241">Create a *ViewModels* folder.</span></span> <span data-ttu-id="8023b-242">W tym folderze Dodaj plik klasy *EnrollmentDateGroup.cs* i Zastąp istniejący kod następującym kodem:</span><span class="sxs-lookup"><span data-stu-id="8023b-242">In that folder, add a class file *EnrollmentDateGroup.cs* and replace the existing code with the following code:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample18.cs)]

### <a name="modify-the-home-controller"></a><span data-ttu-id="8023b-243">Modyfikowanie kontrolera macierzystego</span><span class="sxs-lookup"><span data-stu-id="8023b-243">Modify the Home Controller</span></span>

<span data-ttu-id="8023b-244">W *HomeController.cs*Dodaj następujące instrukcje `using` w górnej części pliku:</span><span class="sxs-lookup"><span data-stu-id="8023b-244">In *HomeController.cs*, add the following `using` statements at the top of the file:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample19.cs)]

<span data-ttu-id="8023b-245">Dodaj zmienną klasy dla kontekstu bazy danych bezpośrednio po otwierającym nawiasie klamrowym dla klasy:</span><span class="sxs-lookup"><span data-stu-id="8023b-245">Add a class variable for the database context immediately after the opening curly brace for the class:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample20.cs?highlight=3)]

<span data-ttu-id="8023b-246">Zastąp metodę `About` następującym kodem:</span><span class="sxs-lookup"><span data-stu-id="8023b-246">Replace the `About` method with the following code:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample21.cs)]

<span data-ttu-id="8023b-247">Instrukcja LINQ grupuje jednostki uczniów według daty rejestracji, oblicza liczbę jednostek w każdej grupie i zapisuje wyniki w kolekcji `EnrollmentDateGroup` widoku obiektów modelu.</span><span class="sxs-lookup"><span data-stu-id="8023b-247">The LINQ statement groups the student entities by enrollment date, calculates the number of entities in each group, and stores the results in a collection of `EnrollmentDateGroup` view model objects.</span></span>

<span data-ttu-id="8023b-248">Dodaj metodę `Dispose`:</span><span class="sxs-lookup"><span data-stu-id="8023b-248">Add a `Dispose` method:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample22.cs)]

### <a name="modify-the-about-view"></a><span data-ttu-id="8023b-249">Modyfikowanie widoku informacje</span><span class="sxs-lookup"><span data-stu-id="8023b-249">Modify the About View</span></span>

<span data-ttu-id="8023b-250">Zastąp kod w pliku *Views\Home\About.cshtml* następującym kodem:</span><span class="sxs-lookup"><span data-stu-id="8023b-250">Replace the code in the *Views\Home\About.cshtml* file with the following code:</span></span>

[!code-cshtml[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample23.cshtml)]

<span data-ttu-id="8023b-251">Uruchom aplikację i kliknij łącze **informacje** .</span><span class="sxs-lookup"><span data-stu-id="8023b-251">Run the app and click the **About** link.</span></span> <span data-ttu-id="8023b-252">W tabeli zostanie wyświetlona liczba uczniów dla każdej daty rejestracji.</span><span class="sxs-lookup"><span data-stu-id="8023b-252">The count of students for each enrollment date is displayed in a table.</span></span>

![About_page](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image10.png)

## <a name="optional-deploy-the-app-to-windows-azure"></a><span data-ttu-id="8023b-254">Opcjonalne: wdrażanie aplikacji w systemie Windows Azure</span><span class="sxs-lookup"><span data-stu-id="8023b-254">Optional: Deploy the app to Windows Azure</span></span>

<span data-ttu-id="8023b-255">Do tej pory aplikacja została uruchomiona lokalnie w IIS Express na komputerze deweloperskim.</span><span class="sxs-lookup"><span data-stu-id="8023b-255">So far your application has been running locally in IIS Express on your development computer.</span></span> <span data-ttu-id="8023b-256">Aby udostępnić je innym osobom, które będą mogły korzystać z Internetu, należy wdrożyć je dla dostawcy hostingu w sieci Web.</span><span class="sxs-lookup"><span data-stu-id="8023b-256">To make it available for other people to use over the Internet, you have to deploy it to a web hosting provider.</span></span> <span data-ttu-id="8023b-257">W tej opcjonalnej sekcji samouczka wdrożono ją w witrynie sieci Web systemu Windows Azure.</span><span class="sxs-lookup"><span data-stu-id="8023b-257">In this optional section of the tutorial you'll deploy it to a Windows Azure Web Site.</span></span>

### <a name="using-code-first-migrations-to-deploy-the-database"></a><span data-ttu-id="8023b-258">Wdrażanie bazy danych przy użyciu Migracje Code First</span><span class="sxs-lookup"><span data-stu-id="8023b-258">Using Code First Migrations to Deploy the Database</span></span>

<span data-ttu-id="8023b-259">Do wdrożenia bazy danych, która będzie używana Migracje Code First.</span><span class="sxs-lookup"><span data-stu-id="8023b-259">To deploy the database you'll use Code First Migrations.</span></span> <span data-ttu-id="8023b-260">Podczas tworzenia profilu publikowania, który służy do konfigurowania ustawień wdrożenia z programu Visual Studio, należy zaznaczyć pole wyboru z etykietą **wykonaj migracje Code First (uruchamia się przy uruchamianiu aplikacji)** .</span><span class="sxs-lookup"><span data-stu-id="8023b-260">When you create the publish profile that you use to configure settings for deploying from Visual Studio, you'll select a check box that is labeled **Execute Code First Migrations (runs on application start)**.</span></span> <span data-ttu-id="8023b-261">To ustawienie powoduje, że proces wdrażania automatycznie skonfiguruje plik *Web. config* aplikacji na serwerze docelowym, tak aby Code First używa klasy inicjatora `MigrateDatabaseToLatestVersion`.</span><span class="sxs-lookup"><span data-stu-id="8023b-261">This setting causes the deployment process to automatically configure the application *Web.config* file on the destination server so that Code First uses the `MigrateDatabaseToLatestVersion` initializer class.</span></span>

<span data-ttu-id="8023b-262">Program Visual Studio nie robi niczego w przypadku bazy danych podczas procesu wdrażania.</span><span class="sxs-lookup"><span data-stu-id="8023b-262">Visual Studio does not do anything with the database during the deployment process.</span></span> <span data-ttu-id="8023b-263">Gdy wdrożona aplikacja uzyskuje dostęp do bazy danych po raz pierwszy po wdrożeniu, Code First automatycznie tworzy bazę danych lub aktualizuje schemat bazy danych do najnowszej wersji.</span><span class="sxs-lookup"><span data-stu-id="8023b-263">When the deployed application accesses the database for the first time after deployment, Code First automatically creates the database or updates the database schema to the latest version.</span></span> <span data-ttu-id="8023b-264">Jeśli aplikacja implementuje metodę `Seed` migracji, Metoda zostanie uruchomiona po utworzeniu bazy danych lub zaktualizowaniu schematu.</span><span class="sxs-lookup"><span data-stu-id="8023b-264">If the application implements a Migrations `Seed` method, the method runs after the database is created or the schema is updated.</span></span>

<span data-ttu-id="8023b-265">Migracja `Seed` Metoda wstawia dane testowe.</span><span class="sxs-lookup"><span data-stu-id="8023b-265">Your Migrations `Seed` method inserts test data.</span></span> <span data-ttu-id="8023b-266">W przypadku wdrażania w środowisku produkcyjnym należy zmienić metodę `Seed` tak, aby wstawiali tylko dane, które mają zostać wstawione do produkcyjnej bazy danych.</span><span class="sxs-lookup"><span data-stu-id="8023b-266">If you were deploying to a production environment, you would have to change the `Seed` method so that it only inserts data that you want to be inserted into your production database.</span></span> <span data-ttu-id="8023b-267">Na przykład w bieżącym modelu danych może być konieczne posiadanie rzeczywistych kursów, ale fikcyjnych uczniów w bazie danych programistycznych.</span><span class="sxs-lookup"><span data-stu-id="8023b-267">For example, in your current data model you might want to have real courses but fictional students in the development database.</span></span> <span data-ttu-id="8023b-268">Można napisać metodę `Seed`, aby załadować zarówno w fazie tworzenia, jak i dodać komentarz do fikcyjnych uczniów przed wdrożeniem w środowisku produkcyjnym.</span><span class="sxs-lookup"><span data-stu-id="8023b-268">You can write a `Seed` method to load both in development, and then comment out the fictional students before you deploy to production.</span></span> <span data-ttu-id="8023b-269">Możesz też napisać `Seed` metodę, aby załadować tylko kursy i ręcznie wprowadzić fikcyjne uczniów w bazie danych testowych przy użyciu interfejsu użytkownika aplikacji.</span><span class="sxs-lookup"><span data-stu-id="8023b-269">Or you can write a `Seed` method to load only courses, and enter the fictional students in the test database manually by using the application's UI.</span></span>

### <a name="get-a-windows-azure-account"></a><span data-ttu-id="8023b-270">Pobierz konto platformy Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="8023b-270">Get a Windows Azure account</span></span>

<span data-ttu-id="8023b-271">Będziesz potrzebować konta platformy Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="8023b-271">You'll need a Windows Azure account.</span></span> <span data-ttu-id="8023b-272">Jeśli jeszcze tego nie masz, możesz utworzyć bezpłatne konto próbne w zaledwie kilka minut.</span><span class="sxs-lookup"><span data-stu-id="8023b-272">If you don't already have one, you can create a free trial account in just a couple of minutes.</span></span> <span data-ttu-id="8023b-273">Aby uzyskać szczegółowe informacje, zobacz [bezpłatna wersja próbna platformy Microsoft Azure](https://azure.microsoft.com/free/?WT.mc_id=A443DD604).</span><span class="sxs-lookup"><span data-stu-id="8023b-273">For details, see [Windows Azure Free Trial](https://azure.microsoft.com/free/?WT.mc_id=A443DD604).</span></span>

### <a name="create-a-web-site-and-a-sql-database-in-windows-azure"></a><span data-ttu-id="8023b-274">Tworzenie witryny sieci Web i bazy danych SQL w systemie Windows Azure</span><span class="sxs-lookup"><span data-stu-id="8023b-274">Create a web site and a SQL database in Windows Azure</span></span>

<span data-ttu-id="8023b-275">Witryna sieci Web systemu Windows Azure będzie działać w udostępnionym środowisku hostingu, co oznacza, że jest ono uruchamiane na maszynach wirtualnych, które są udostępniane innym klientom systemu Windows Azure.</span><span class="sxs-lookup"><span data-stu-id="8023b-275">Your Windows Azure Web Site will run in a shared hosting environment, which means it runs on virtual machines (VMs) that are shared with other Windows Azure clients.</span></span> <span data-ttu-id="8023b-276">Udostępnione środowisko hostingu jest tanim sposobem na rozpoczęcie pracy w chmurze.</span><span class="sxs-lookup"><span data-stu-id="8023b-276">A shared hosting environment is a low-cost way to get started in the cloud.</span></span> <span data-ttu-id="8023b-277">Później, jeśli ruch internetowy zostanie zwiększony, aplikacja może skalować się, aby zaspokoić potrzeby, uruchamiając na dedykowanych maszynach wirtualnych.</span><span class="sxs-lookup"><span data-stu-id="8023b-277">Later, if your web traffic increases, the application can scale to meet the need by running on dedicated VMs.</span></span> <span data-ttu-id="8023b-278">Jeśli potrzebujesz bardziej złożonej architektury, możesz przeprowadzić migrację do usługi w chmurze platformy Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="8023b-278">If you need a more complex architecture, you can migrate to a Windows Azure Cloud Service.</span></span> <span data-ttu-id="8023b-279">Usługi w chmurze są uruchamiane na dedykowanych maszynach wirtualnych, które można skonfigurować zgodnie z potrzebami.</span><span class="sxs-lookup"><span data-stu-id="8023b-279">Cloud services run on dedicated VMs that you can configure according to your needs.</span></span>

<span data-ttu-id="8023b-280">Windows Azure SQL Database jest usługą relacyjnej bazy danych opartą na chmurze, która jest oparta na technologiach SQL Server.</span><span class="sxs-lookup"><span data-stu-id="8023b-280">Windows Azure SQL Database is a cloud-based relational database service that is built on SQL Server technologies.</span></span> <span data-ttu-id="8023b-281">Narzędzia i aplikacje, które działają z SQL Server również współpracują z SQL Database.</span><span class="sxs-lookup"><span data-stu-id="8023b-281">Tools and applications that work with SQL Server also work with SQL Database.</span></span>

1. <span data-ttu-id="8023b-282">Na [platformie Microsoft Azure Portal zarządzania](https://manage.windowsazure.com/)kliknij pozycję **witryny sieci Web** na lewej karcie, a następnie kliknij pozycję **Nowy**.</span><span class="sxs-lookup"><span data-stu-id="8023b-282">In the [Windows Azure Management Portal](https://manage.windowsazure.com/), click **Web Sites** in the left tab, and then click **New**.</span></span>

    ![Przycisk Nowy w portal zarządzania](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image11.png)
2. <span data-ttu-id="8023b-284">Kliknij pozycję **Tworzenie niestandardowe**.</span><span class="sxs-lookup"><span data-stu-id="8023b-284">Click **CUSTOM CREATE**.</span></span>

    ![Utwórz za pomocą linku bazy danych w portal zarządzania](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image12.png)

   <span data-ttu-id="8023b-286">Zostanie otwarta **Nowa witryna sieci Web — Kreator tworzenia niestandardowego** .</span><span class="sxs-lookup"><span data-stu-id="8023b-286">The **New Web Site - Custom Create** wizard opens.</span></span>
3. <span data-ttu-id="8023b-287">W kroku kreatora **nowej witryny sieci Web** wprowadź ciąg w polu **adresu URL** , który będzie używany jako unikatowy adres URL aplikacji.</span><span class="sxs-lookup"><span data-stu-id="8023b-287">In the **New Web Site** step of the wizard, enter a string in the **URL** box to use as the unique URL for your application.</span></span> <span data-ttu-id="8023b-288">Pełny adres URL będzie zawierać dane wprowadzane tutaj oraz sufiks wyświetlany obok pola tekstowego.</span><span class="sxs-lookup"><span data-stu-id="8023b-288">The complete URL will consist of what you enter here plus the suffix that you see next to the text box.</span></span> <span data-ttu-id="8023b-289">Na ilustracji przedstawiono wartość "ConU", ale ten adres URL jest prawdopodobnie potrzebny do wybrania innego.</span><span class="sxs-lookup"><span data-stu-id="8023b-289">The illustration shows "ConU", but that URL is probably taken so you will have to choose a different one.</span></span>

    ![Utwórz za pomocą linku bazy danych w portal zarządzania](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image13.png)
4. <span data-ttu-id="8023b-291">Z listy rozwijanej **region** wybierz region blisko siebie.</span><span class="sxs-lookup"><span data-stu-id="8023b-291">In the **Region** drop-down list, choose a region close to you.</span></span> <span data-ttu-id="8023b-292">To ustawienie określa centrum danych, w którym zostanie uruchomiona witryna sieci Web.</span><span class="sxs-lookup"><span data-stu-id="8023b-292">This setting specifies which data center your web site will run in.</span></span>
5. <span data-ttu-id="8023b-293">Z listy rozwijanej **baza danych** wybierz pozycję **Utwórz bezpłatną bazę danych SQL o rozmiarze 20 MB**.</span><span class="sxs-lookup"><span data-stu-id="8023b-293">In the **Database** drop-down list, choose **Create a free 20 MB SQL database**.</span></span>

    ![](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image14.png)
6. <span data-ttu-id="8023b-294">W polu **nazwa parametrów połączenia bazy danych**wprowadź *SchoolContext*.</span><span class="sxs-lookup"><span data-stu-id="8023b-294">In the **DB CONNECTION STRING NAME**, enter *SchoolContext*.</span></span>

    ![](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image15.png)
7. <span data-ttu-id="8023b-295">Kliknij strzałkę wskazującą w prawo u dołu pola.</span><span class="sxs-lookup"><span data-stu-id="8023b-295">Click the arrow that points to the right at the bottom of the box.</span></span> <span data-ttu-id="8023b-296">Kreator przechodzi do kroku **Ustawienia bazy danych** .</span><span class="sxs-lookup"><span data-stu-id="8023b-296">The wizard advances to the **Database Settings** step.</span></span>
8. <span data-ttu-id="8023b-297">W polu **Nazwa** wprowadź *ContosoUniversityDB*.</span><span class="sxs-lookup"><span data-stu-id="8023b-297">In the **Name** box, enter *ContosoUniversityDB*.</span></span>
9. <span data-ttu-id="8023b-298">W polu **serwer** wybierz pozycję **nowy serwer SQL Database**.</span><span class="sxs-lookup"><span data-stu-id="8023b-298">In the **Server** box, select **New SQL Database server**.</span></span> <span data-ttu-id="8023b-299">Alternatywnie, jeśli wcześniej utworzono serwer, można wybrać ten serwer z listy rozwijanej.</span><span class="sxs-lookup"><span data-stu-id="8023b-299">Alternatively, if you previously created a server, you can select that server from the drop-down list.</span></span>
10. <span data-ttu-id="8023b-300">Wprowadź **nazwę logowania** i **hasło**administratora.</span><span class="sxs-lookup"><span data-stu-id="8023b-300">Enter an administrator **LOGIN NAME** and **PASSWORD**.</span></span> <span data-ttu-id="8023b-301">Jeśli wybrano opcję **nowy serwer SQL Database** nie wprowadzono w tym miejscu istniejącej nazwy i hasła, zostanie wprowadzona nowa nazwa i hasło, które będą używane później podczas uzyskiwania dostępu do bazy danych.</span><span class="sxs-lookup"><span data-stu-id="8023b-301">If you selected **New SQL Database server** you aren't entering an existing name and password here, you're entering a new name and password that you're defining now to use later when you access the database.</span></span> <span data-ttu-id="8023b-302">W przypadku wybrania wcześniej utworzonego serwera należy wprowadzić poświadczenia dla tego serwera.</span><span class="sxs-lookup"><span data-stu-id="8023b-302">If you selected a server that you created previously, you'll enter credentials for that server.</span></span> <span data-ttu-id="8023b-303">W tym samouczku nie zostanie zaznaczone pole wyboru ***Zaawansowane*** .</span><span class="sxs-lookup"><span data-stu-id="8023b-303">For this tutorial, you won't select the ***Advanced*** check box.</span></span> <span data-ttu-id="8023b-304">Opcje ***Zaawansowane*** umożliwiają ustawienie [sortowania](https://msdn.microsoft.com/library/aa174903(v=SQL.80).aspx)bazy danych.</span><span class="sxs-lookup"><span data-stu-id="8023b-304">The ***Advanced*** options enable you to set the database [collation](https://msdn.microsoft.com/library/aa174903(v=SQL.80).aspx).</span></span>
11. <span data-ttu-id="8023b-305">Wybierz ten sam **region** , który został wybrany dla witryny sieci Web.</span><span class="sxs-lookup"><span data-stu-id="8023b-305">Choose the same **Region** that you chose for the web site.</span></span>
12. <span data-ttu-id="8023b-306">Kliknij znacznik wyboru w prawym dolnym rogu pola, aby wskazać, że wszystko zostało zakończone.</span><span class="sxs-lookup"><span data-stu-id="8023b-306">Click the check mark at the bottom right of the box to indicate that you're finished.</span></span>   
  
    ![Krok ustawień bazy danych nowej witryny sieci Web — Kreator tworzenia z bazą danych](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image16.png)  

    <span data-ttu-id="8023b-308">Na poniższej ilustracji przedstawiono korzystanie z istniejących SQL Server i logowania.</span><span class="sxs-lookup"><span data-stu-id="8023b-308">The following image shows using an existing SQL Server and Login.</span></span>   
  
    ![Krok ustawień bazy danych nowej witryny sieci Web — Kreator tworzenia z bazą danych](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image17.png)  
  
    <span data-ttu-id="8023b-310">Portal zarządzania wraca do strony witryny sieci Web, a kolumna **stan** wskazuje, że witryna jest tworzona.</span><span class="sxs-lookup"><span data-stu-id="8023b-310">The Management Portal returns to the Web Sites page, and the **Status** column shows that the site is being created.</span></span> <span data-ttu-id="8023b-311">Po czasie (zazwyczaj krótszym niż minutę) kolumna **stan** pokazuje, że witryna została pomyślnie utworzona.</span><span class="sxs-lookup"><span data-stu-id="8023b-311">After a while (typically less than a minute), the **Status** column shows that the site was successfully created.</span></span> <span data-ttu-id="8023b-312">Na pasku nawigacyjnym po lewej stronie liczba witryn znajdujących się na koncie pojawia się obok ikony **witryny sieci Web** , a liczba baz danych pojawia się obok ikony **bazy danych SQL** .</span><span class="sxs-lookup"><span data-stu-id="8023b-312">In the navigation bar at the left, the number of sites you have in your account appears next to the **Web Sites** icon, and the number of databases appears next to the **SQL Databases** icon.</span></span>

## <a name="deploy-the-application-to-windows-azure"></a><span data-ttu-id="8023b-313">Wdrażanie aplikacji w systemie Windows Azure</span><span class="sxs-lookup"><span data-stu-id="8023b-313">Deploy the application to Windows Azure</span></span>

1. <span data-ttu-id="8023b-314">W programie Visual Studio kliknij prawym przyciskiem myszy projekt w **Eksplorator rozwiązań** i wybierz polecenie **Publikuj** z menu kontekstowego.</span><span class="sxs-lookup"><span data-stu-id="8023b-314">In Visual Studio, right-click the project in **Solution Explorer** and select **Publish** from the context menu.</span></span>  
  
    ![Menu kontekstowe publikowania w projekcie](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image18.png)
2. <span data-ttu-id="8023b-316">Na karcie **profil** Kreatora publikacji w **sieci Web** kliknij pozycję **Importuj**.</span><span class="sxs-lookup"><span data-stu-id="8023b-316">In the **Profile** tab of the **Publish Web** wizard, click **Import**.</span></span>  
  
    ![Importuj ustawienia publikowania](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image19.png)
3. <span data-ttu-id="8023b-318">Jeśli nie dodano wcześniej subskrypcji systemu Windows Azure w programie Visual Studio, wykonaj następujące czynności.</span><span class="sxs-lookup"><span data-stu-id="8023b-318">If you have not previously added your Windows Azure subscription in Visual Studio, perform the following steps.</span></span> <span data-ttu-id="8023b-319">W tych krokach dodajesz subskrypcję, aby lista rozwijana **importowana z witryny sieci Web systemu Windows Azure** obejmowała witrynę sieci Web.</span><span class="sxs-lookup"><span data-stu-id="8023b-319">In these steps you add your subscription so that the drop-down list under **Import from a Windows Azure web site** will include your web site.</span></span>

    <span data-ttu-id="8023b-320">a.</span><span class="sxs-lookup"><span data-stu-id="8023b-320">a.</span></span> <span data-ttu-id="8023b-321">W oknie dialogowym **Importowanie profilu publikowania** kliknij pozycję **Importuj z witryny sieci Web systemu Windows Azure**, a następnie kliknij pozycję **Dodaj subskrypcję systemu Windows Azure**.</span><span class="sxs-lookup"><span data-stu-id="8023b-321">In the **Import Publish Profile** dialog box, click **Import from a Windows Azure web site**, and then click **Add Windows Azure subscription**.</span></span>

    ![Dodaj subskrypcję systemu Windows Azure](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image20.png)

    <span data-ttu-id="8023b-323">b.</span><span class="sxs-lookup"><span data-stu-id="8023b-323">b.</span></span> <span data-ttu-id="8023b-324">W oknie dialogowym **Importowanie subskrypcji systemu Windows Azure** kliknij pozycję **Pobierz plik subskrypcji**.</span><span class="sxs-lookup"><span data-stu-id="8023b-324">In the **Import Windows Azure Subscriptions** dialog box, click **Download subscription file**.</span></span>

    ![Pobierz plik subskrypcji](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image21.png)

    <span data-ttu-id="8023b-326">s.</span><span class="sxs-lookup"><span data-stu-id="8023b-326">c.</span></span> <span data-ttu-id="8023b-327">W oknie przeglądarki Zapisz plik *. publishsettings* .</span><span class="sxs-lookup"><span data-stu-id="8023b-327">In your browser window, save the *.publishsettings* file.</span></span>

    ![Pobierz plik. publishsettings](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image22.png)

    > [!WARNING]
    > <span data-ttu-id="8023b-329">Zabezpieczenia — plik *publishsettings* zawiera Twoje poświadczenia (niekodowane), które są używane do administrowania subskrypcjami i usługami systemu Windows Azure.</span><span class="sxs-lookup"><span data-stu-id="8023b-329">Security - The *publishsettings* file contains your credentials (unencoded) that are used to administer your Windows Azure subscriptions and services.</span></span> <span data-ttu-id="8023b-330">Najlepszym rozwiązaniem w zakresie zabezpieczeń dla tego pliku jest przechowywanie go tymczasowo poza katalogami źródłowymi (na przykład w folderze *Libraries\Documents* ), a następnie usunięcie go po zakończeniu importu.</span><span class="sxs-lookup"><span data-stu-id="8023b-330">The security best practice for this file is to store it temporarily outside your source directories (for example in the *Libraries\Documents* folder), and then delete it once the import has completed.</span></span> <span data-ttu-id="8023b-331">Złośliwy użytkownik, który uzyskuje dostęp do pliku `.publishsettings`, może edytować, tworzyć i usuwać usługi systemu Windows Azure.</span><span class="sxs-lookup"><span data-stu-id="8023b-331">A malicious user who gains access to the `.publishsettings` file can edit, create, and delete your Windows Azure services.</span></span>

    <span data-ttu-id="8023b-332">Wykres.</span><span class="sxs-lookup"><span data-stu-id="8023b-332">d.</span></span> <span data-ttu-id="8023b-333">W oknie dialogowym **Importowanie subskrypcji systemu Windows Azure** kliknij przycisk **Przeglądaj** i przejdź do pliku *publishsettings* .</span><span class="sxs-lookup"><span data-stu-id="8023b-333">In the **Import Windows Azure Subscriptions** dialog box, click **Browse** and navigate to the *.publishsettings* file.</span></span>

    ![Pobierz podrzędny](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image23.png)

    <span data-ttu-id="8023b-335">adres.</span><span class="sxs-lookup"><span data-stu-id="8023b-335">e.</span></span> <span data-ttu-id="8023b-336">Kliknij pozycję **Importuj**.</span><span class="sxs-lookup"><span data-stu-id="8023b-336">Click **Import**.</span></span>

    ![import](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image24.png)
4. <span data-ttu-id="8023b-338">W oknie dialogowym **Importowanie profilu publikowania** wybierz pozycję **Importuj z witryny sieci Web systemu Windows Azure**, wybierz witrynę sieci Web z listy rozwijanej, a następnie kliknij przycisk **OK**.</span><span class="sxs-lookup"><span data-stu-id="8023b-338">In the **Import Publish Profile** dialog box, select **Import from a Windows Azure web site**, select your web site from the drop-down list, and then click **OK**.</span></span>  
  
    ![Importuj profil publikowania](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image25.png)
5. <span data-ttu-id="8023b-340">Na karcie **połączenie** kliknij pozycję **Sprawdź poprawność połączenia** , aby upewnić się, że ustawienia są poprawne.</span><span class="sxs-lookup"><span data-stu-id="8023b-340">In the **Connection** tab, click **Validate Connection** to make sure that the settings are correct.</span></span>  
  
    ![Weryfikuj połączenie](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image26.png)
6. <span data-ttu-id="8023b-342">Po sprawdzeniu poprawności połączenia zostanie wyświetlony zielony znacznik wyboru obok przycisku **Weryfikuj połączenie** .</span><span class="sxs-lookup"><span data-stu-id="8023b-342">When the connection has been validated, a green check mark is shown next to the **Validate Connection** button.</span></span> <span data-ttu-id="8023b-343">Kliknij przycisk **Dalej**.</span><span class="sxs-lookup"><span data-stu-id="8023b-343">Click **Next**.</span></span>  
  
    ![Pomyślnie zweryfikowano połączenie](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image27.png)
7. <span data-ttu-id="8023b-345">Otwórz listę rozwijaną **Parametry połączenia zdalnego** w obszarze **SchoolContext** i wybierz parametry połączenia dla utworzonej bazy danych.</span><span class="sxs-lookup"><span data-stu-id="8023b-345">Open the **Remote connection string** drop-down list under **SchoolContext** and select the connection string for the database you created.</span></span>
8. <span data-ttu-id="8023b-346">Wybierz pozycję **wykonaj migracje Code First (uruchamiaj przy uruchamianiu aplikacji)** .</span><span class="sxs-lookup"><span data-stu-id="8023b-346">Select **Execute Code First Migrations (runs on application start)**.</span></span>
9. <span data-ttu-id="8023b-347">Usuń zaznaczenie pola **Użyj tych parametrów połączenia w czasie wykonywania** dla **UserContext (DefaultConnection)** , ponieważ ta aplikacja nie korzysta z bazy danych członkostwa.</span><span class="sxs-lookup"><span data-stu-id="8023b-347">Uncheck **Use this connection string at runtime** for the **UserContext (DefaultConnection)**, since this application is not using the membership database.</span></span>   
  
    ![Karta Ustawienia](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image28.png)
10. <span data-ttu-id="8023b-349">Kliknij przycisk **Dalej**.</span><span class="sxs-lookup"><span data-stu-id="8023b-349">Click **Next**.</span></span>
11. <span data-ttu-id="8023b-350">Na karcie **Podgląd** kliknij pozycję **Rozpocznij podgląd**.</span><span class="sxs-lookup"><span data-stu-id="8023b-350">In the **Preview** tab, click **Start Preview**.</span></span>  
  
    ![Przycisk StartPreview na karcie Podgląd](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image29.png)  
  
    <span data-ttu-id="8023b-352">Na karcie zostanie wyświetlona lista plików, które zostaną skopiowane na serwer programu.</span><span class="sxs-lookup"><span data-stu-id="8023b-352">The tab displays a list of the files that will be copied to the server.</span></span> <span data-ttu-id="8023b-353">Wyświetlanie wersji zapoznawczej nie jest wymagane do opublikowania aplikacji, ale jest przydatną funkcją.</span><span class="sxs-lookup"><span data-stu-id="8023b-353">Displaying the preview isn't required to publish the application but is a useful function to be aware of.</span></span> <span data-ttu-id="8023b-354">W takim przypadku nie trzeba wykonywać żadnych czynności z listy wyświetlanych plików.</span><span class="sxs-lookup"><span data-stu-id="8023b-354">In this case, you don't need to do anything with the list of files that is displayed.</span></span> <span data-ttu-id="8023b-355">Przy następnym wdrożeniu tej aplikacji na tej liście będą znajdować się tylko te pliki, które uległy zmianie.</span><span class="sxs-lookup"><span data-stu-id="8023b-355">The next time you deploy this application, only the files that have changed will be in this list.</span></span>  
  
    ![Dane wyjściowe pliku StartPreview](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image30.png)
12. <span data-ttu-id="8023b-357">Kliknij przycisk **Publikuj**.</span><span class="sxs-lookup"><span data-stu-id="8023b-357">Click **Publish**.</span></span>  
    <span data-ttu-id="8023b-358">Program Visual Studio rozpoczyna proces kopiowania plików na serwer systemu Windows Azure.</span><span class="sxs-lookup"><span data-stu-id="8023b-358">Visual Studio begins the process of copying the files to the Windows Azure server.</span></span>
13. <span data-ttu-id="8023b-359">W oknie **danych wyjściowych** znajdują się informacje o wykonywaniu akcji wdrażania i raporty o pomyślnym zakończeniu wdrożenia.</span><span class="sxs-lookup"><span data-stu-id="8023b-359">The **Output** window shows what deployment actions were taken and reports successful completion of the deployment.</span></span>  
  
    ![Pomyślne wdrożenie raportowania okna danych wyjściowych](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image31.png)
14. <span data-ttu-id="8023b-361">Po pomyślnym wdrożeniu domyślna przeglądarka automatycznie otwiera adres URL wdrożonej witryny sieci Web.</span><span class="sxs-lookup"><span data-stu-id="8023b-361">Upon successful deployment, the default browser automatically opens to the URL of the deployed web site.</span></span>  
    <span data-ttu-id="8023b-362">Utworzona aplikacja jest teraz uruchomiona w chmurze.</span><span class="sxs-lookup"><span data-stu-id="8023b-362">The application you created is now running in the cloud.</span></span> <span data-ttu-id="8023b-363">Kliknij kartę studenci.</span><span class="sxs-lookup"><span data-stu-id="8023b-363">Click the Students tab.</span></span>  
  
    ![Students_index_page_with_paging](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image32.png)

<span data-ttu-id="8023b-365">W tym momencie baza danych *SchoolContext* została utworzona w Azure SQL Database systemu Windows, ponieważ wybrano **Polecenie Execute migracje Code First (uruchamiany przy uruchamianiu aplikacji)** .</span><span class="sxs-lookup"><span data-stu-id="8023b-365">At this point your *SchoolContext* database has been created in the Windows Azure SQL Database because you selected **Execute Code First Migrations (runs on app start)**.</span></span> <span data-ttu-id="8023b-366">Plik *Web. config* w wdrożonej witrynie sieci Web został zmieniony tak, aby inicjator [MigrateDatabaseToLatestVersion](https://msdn.microsoft.com/library/hh829476(v=vs.103).aspx) był uruchamiany podczas pierwszego odczytywania lub zapisywania danych w bazie danych (co się stało po wybraniu karty **uczniów** ):</span><span class="sxs-lookup"><span data-stu-id="8023b-366">The *Web.config* file in the deployed web site has been changed so that the [MigrateDatabaseToLatestVersion](https://msdn.microsoft.com/library/hh829476(v=vs.103).aspx) initializer would run the first time your code reads or writes data in the database (which happened when you selected the **Students** tab):</span></span>

![](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image33.png)

<span data-ttu-id="8023b-367">Proces wdrażania również utworzył nowe parametry połączenia *(SchoolContext\_DatabasePublish*) dla migracje Code First, które mają być używane do aktualizowania schematu bazy danych i wypełniania bazy danych.</span><span class="sxs-lookup"><span data-stu-id="8023b-367">The deployment process also created a new connection string *(SchoolContext\_DatabasePublish*) for Code First Migrations to use for updating the database schema and seeding the database.</span></span>

![Database_Publish parametry połączenia](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image34.png)

<span data-ttu-id="8023b-369">Parametry połączenia *DefaultConnection* są przeznaczone dla bazy danych członkostwa (której nie używamy w tym samouczku).</span><span class="sxs-lookup"><span data-stu-id="8023b-369">The *DefaultConnection* connection string is for the membership database (which we are not using in this tutorial).</span></span> <span data-ttu-id="8023b-370">Parametry połączenia *SchoolContext* są przeznaczone dla bazy danych ContosoUniversity.</span><span class="sxs-lookup"><span data-stu-id="8023b-370">The *SchoolContext* connection string is for the ContosoUniversity database.</span></span>

<span data-ttu-id="8023b-371">Wdrożoną wersję pliku Web. config można znaleźć na własnym komputerze w *ContosoUniversity\obj\Release\Package\PackageTmp\Web.config*. Możesz uzyskać dostęp do wdrożonego pliku *Web. config* przy użyciu protokołu FTP.</span><span class="sxs-lookup"><span data-stu-id="8023b-371">You can find the deployed version of the Web.config file on your own computer in *ContosoUniversity\obj\Release\Package\PackageTmp\Web.config*. You can access the deployed *Web.config* file itself by using FTP.</span></span> <span data-ttu-id="8023b-372">Aby uzyskać instrukcje, zobacz [ASP.NET Web Deployment using Visual Studio: wdrażanie aktualizacji kodu](../../../../web-forms/overview/deployment/visual-studio-web-deployment/deploying-a-code-update.md).</span><span class="sxs-lookup"><span data-stu-id="8023b-372">For instructions, see [ASP.NET Web Deployment using Visual Studio: Deploying a Code Update](../../../../web-forms/overview/deployment/visual-studio-web-deployment/deploying-a-code-update.md).</span></span> <span data-ttu-id="8023b-373">Postępuj zgodnie z instrukcjami, które zaczynają się od "Aby użyć narzędzia FTP, potrzebne są trzy rzeczy: adres URL FTP, nazwa użytkownika i hasło".</span><span class="sxs-lookup"><span data-stu-id="8023b-373">Follow the instructions that start with "To use an FTP tool, you need three things: the FTP URL, the user name, and the password."</span></span>

> [!NOTE]
> <span data-ttu-id="8023b-374">Aplikacja sieci Web nie implementuje zabezpieczeń, dlatego każda osoba, która odnajdzie adres URL, może zmienić dane.</span><span class="sxs-lookup"><span data-stu-id="8023b-374">The web app doesn't implement security, so anyone who finds the URL can change the data.</span></span> <span data-ttu-id="8023b-375">Aby uzyskać instrukcje dotyczące zabezpieczania witryny sieci Web, zobacz [wdrażanie aplikacji secure ASP.NET MVC z członkostwem, uwierzytelnianiem OAuth i SQL Database w witrynie sieci Web systemu Windows Azure](https://docs.microsoft.com/aspnet/core/security/authorization/secure-data).</span><span class="sxs-lookup"><span data-stu-id="8023b-375">For instructions on how to secure the web site, see [Deploy a Secure ASP.NET MVC app with Membership, OAuth, and SQL Database to a Windows Azure Web Site](https://docs.microsoft.com/aspnet/core/security/authorization/secure-data).</span></span> <span data-ttu-id="8023b-376">Można uniemożliwić innym osobom korzystanie z witryny przy użyciu portal zarządzania platformy Windows Azure lub **Eksplorator serwera** w programie Visual Studio, aby zatrzymać lokację.</span><span class="sxs-lookup"><span data-stu-id="8023b-376">You can prevent other people from using the site by using the Windows Azure Management Portal or **Server Explorer** in Visual Studio to stop the site.</span></span>

![](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image35.png)

## <a name="code-first-initializers"></a><span data-ttu-id="8023b-377">Inicjatory Code First</span><span class="sxs-lookup"><span data-stu-id="8023b-377">Code First Initializers</span></span>

<span data-ttu-id="8023b-378">W sekcji Deployment (wdrażanie) wykorzystano inicjatora [MigrateDatabaseToLatestVersion](https://msdn.microsoft.com/library/hh829476(v=vs.103).aspx) .</span><span class="sxs-lookup"><span data-stu-id="8023b-378">In the deployment section you saw the [MigrateDatabaseToLatestVersion](https://msdn.microsoft.com/library/hh829476(v=vs.103).aspx) initializer being used.</span></span> <span data-ttu-id="8023b-379">Code First udostępnia również inne inicjatory, których można użyć, w tym [CreateDatabaseIfNotExists](https://msdn.microsoft.com/library/gg679221(v=vs.103).aspx) (wartość domyślna), [DropCreateDatabaseIfModelChanges](https://msdn.microsoft.com/library/gg679604(v=VS.103).aspx) i [DropCreateDatabaseAlways](https://msdn.microsoft.com/library/gg679506(v=VS.103).aspx).</span><span class="sxs-lookup"><span data-stu-id="8023b-379">Code First also provides other initializers that you can use, including [CreateDatabaseIfNotExists](https://msdn.microsoft.com/library/gg679221(v=vs.103).aspx) (the default), [DropCreateDatabaseIfModelChanges](https://msdn.microsoft.com/library/gg679604(v=VS.103).aspx) and [DropCreateDatabaseAlways](https://msdn.microsoft.com/library/gg679506(v=VS.103).aspx).</span></span> <span data-ttu-id="8023b-380">Inicjator `DropCreateAlways` może być przydatny do ustawiania warunków dla testów jednostkowych.</span><span class="sxs-lookup"><span data-stu-id="8023b-380">The `DropCreateAlways` initializer can be useful for setting up conditions for unit tests.</span></span> <span data-ttu-id="8023b-381">Możesz również napisać własne inicjatory i można wywołać inicjalizację jawnie, jeśli nie chcesz czekać, aż aplikacja odczyta lub zapisze w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="8023b-381">You can also write your own initializers, and you can call an initializer explicitly if you don't want to wait until the application reads from or writes to the database.</span></span> <span data-ttu-id="8023b-382">Aby zapoznać się ze szczegółowym opisem inicjatorów, zobacz rozdział 6 [Entity Framework programowania w książce: Code First](http://shop.oreilly.com/product/0636920022220.do) przez Julie Lerman i Rowan Miller.</span><span class="sxs-lookup"><span data-stu-id="8023b-382">For a comprehensive explanation of initializers, see chapter 6 of the book [Programming Entity Framework: Code First](http://shop.oreilly.com/product/0636920022220.do) by Julie Lerman and Rowan Miller.</span></span>

## <a name="summary"></a><span data-ttu-id="8023b-383">Podsumowanie</span><span class="sxs-lookup"><span data-stu-id="8023b-383">Summary</span></span>

<span data-ttu-id="8023b-384">W tym samouczku pokazano, jak utworzyć model danych i zaimplementować podstawowe funkcje CRUD, sortowania, filtrowania, stronicowania i grupowania.</span><span class="sxs-lookup"><span data-stu-id="8023b-384">In this tutorial you've seen how to create a data model and implement basic CRUD, sorting, filtering, paging, and grouping functionality.</span></span> <span data-ttu-id="8023b-385">W następnym samouczku zobaczysz bardziej zaawansowane tematy, rozszerzając model danych.</span><span class="sxs-lookup"><span data-stu-id="8023b-385">In the next tutorial you'll begin looking at more advanced topics by expanding the data model.</span></span>

<span data-ttu-id="8023b-386">Linki do innych zasobów Entity Framework można znaleźć w [mapie zawartości dostęp do danych ASP.NET](../../../../whitepapers/aspnet-data-access-content-map.md).</span><span class="sxs-lookup"><span data-stu-id="8023b-386">Links to other Entity Framework resources can be found in the [ASP.NET Data Access Content Map](../../../../whitepapers/aspnet-data-access-content-map.md).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="8023b-387">[Poprzednie](implementing-basic-crud-functionality-with-the-entity-framework-in-asp-net-mvc-application.md)
> [dalej](creating-a-more-complex-data-model-for-an-asp-net-mvc-application.md)</span><span class="sxs-lookup"><span data-stu-id="8023b-387">[Previous](implementing-basic-crud-functionality-with-the-entity-framework-in-asp-net-mvc-application.md)
[Next](creating-a-more-complex-data-model-for-an-asp-net-mvc-application.md)</span></span>
