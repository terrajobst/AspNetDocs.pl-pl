---
uid: mvc/overview/security/preventing-open-redirection-attacks
title: Zapobieganie atakom typu OpenC#przekierowania () | Microsoft Docs
author: jongalloway
description: W tym samouczku wyjaśniono, jak można zapobiec atakom typu Open przekierowania w aplikacjach ASP.NET MVC. W tym samouczku omówiono wprowadzone zmiany...
ms.author: riande
ms.date: 02/27/2014
ms.assetid: 69fb02e0-f5b7-4c35-878c-fa87164fc785
msc.legacyurl: /mvc/overview/security/preventing-open-redirection-attacks
msc.type: authoredcontent
ms.openlocfilehash: cfa635d4fd14d031993c5b452325cbe334f82dc2
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 03/06/2020
ms.locfileid: "78538172"
---
# <a name="preventing-open-redirection-attacks-c"></a><span data-ttu-id="a4a34-104">Zapobieganie atakom na otwarte przekierowywanie (C#)</span><span class="sxs-lookup"><span data-stu-id="a4a34-104">Preventing Open Redirection Attacks (C#)</span></span>

<span data-ttu-id="a4a34-105">przez [Jan Galloway](https://github.com/jongalloway)</span><span class="sxs-lookup"><span data-stu-id="a4a34-105">by [Jon Galloway](https://github.com/jongalloway)</span></span>

> <span data-ttu-id="a4a34-106">W tym samouczku wyjaśniono, jak można zapobiec atakom typu Open przekierowania w aplikacjach ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="a4a34-106">This tutorial explains how you can prevent open redirection attacks in your ASP.NET MVC applications.</span></span> <span data-ttu-id="a4a34-107">W tym samouczku omówiono zmiany wprowadzone w elementu AccountController w ASP.NET MVC 3 i zademonstrowano, jak można zastosować te zmiany w istniejących aplikacjach ASP.NET MVC 1,0 i 2.</span><span class="sxs-lookup"><span data-stu-id="a4a34-107">This tutorial discusses the changes that have been made in the AccountController in ASP.NET MVC 3 and demonstrates how you can apply these changes in your existing ASP.NET MVC 1.0 and 2 applications.</span></span>

## <a name="what-is-an-open-redirection-attack"></a><span data-ttu-id="a4a34-108">Co to jest atak typu "Open przekierowania"?</span><span class="sxs-lookup"><span data-stu-id="a4a34-108">What is an Open Redirection Attack?</span></span>

<span data-ttu-id="a4a34-109">Dowolna aplikacja sieci Web, która przekierowuje do adresu URL, który jest określony za pośrednictwem żądania, takiego jak QueryString lub dane formularza, może zostać naruszona w celu przekierowania użytkowników do zewnętrznego, złośliwego adresu URL.</span><span class="sxs-lookup"><span data-stu-id="a4a34-109">Any web application that redirects to a URL that is specified via the request such as the querystring or form data can potentially be tampered with to redirect users to an external, malicious URL.</span></span> <span data-ttu-id="a4a34-110">Takie manipulowanie nazywa się atakiem typu Open przekierowania.</span><span class="sxs-lookup"><span data-stu-id="a4a34-110">This tampering is called an open redirection attack.</span></span>

<span data-ttu-id="a4a34-111">Za każdym razem, gdy logika aplikacji przekieruje do określonego adresu URL, należy sprawdzić, czy adres URL przekierowania nie został naruszony.</span><span class="sxs-lookup"><span data-stu-id="a4a34-111">Whenever your application logic redirects to a specified URL, you must verify that the redirection URL hasn't been tampered with.</span></span> <span data-ttu-id="a4a34-112">Logowanie używane w domyślnej elementu AccountController zarówno dla ASP.NET MVC 1,0, jak i ASP.NET MVC 2 jest podatne na ataki typu Open przekierowania.</span><span class="sxs-lookup"><span data-stu-id="a4a34-112">The login used in the default AccountController for both ASP.NET MVC 1.0 and ASP.NET MVC 2 is vulnerable to open redirection attacks.</span></span> <span data-ttu-id="a4a34-113">Na szczęście można łatwo aktualizować istniejące aplikacje, aby używać poprawek z wersji zapoznawczej ASP.NET MVC 3.</span><span class="sxs-lookup"><span data-stu-id="a4a34-113">Fortunately, it is easy to update your existing applications to use the corrections from the ASP.NET MVC 3 Preview.</span></span>

<span data-ttu-id="a4a34-114">Aby zrozumieć lukę w zabezpieczeniach, przyjrzyjmy się działaniu przekierowania logowania w domyślnym projekcie aplikacji sieci Web MVC 2 ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="a4a34-114">To understand the vulnerability, let's look at how the login redirection works in a default ASP.NET MVC 2 Web Application project.</span></span> <span data-ttu-id="a4a34-115">W tej aplikacji próba odwiedzenia akcji kontrolera, która ma atrybut [autoryzuje], spowoduje przekierowanie nieautoryzowanych użytkowników do widoku/Account/LogOn.</span><span class="sxs-lookup"><span data-stu-id="a4a34-115">In this application, attempting to visit a controller action that has the [Authorize] attribute will redirect unauthorized users to the /Account/LogOn view.</span></span> <span data-ttu-id="a4a34-116">To przekierowanie do/Account/LogOn będzie zawierać parametr returnUrl QueryString, dzięki czemu można zwrócić użytkownika do pierwotnie żądanego adresu URL po pomyślnym zalogowaniu się.</span><span class="sxs-lookup"><span data-stu-id="a4a34-116">This redirect to /Account/LogOn will include a returnUrl querystring parameter so that the user can be returned to the originally requested URL after they have successfully logged in.</span></span>

<span data-ttu-id="a4a34-117">Na poniższym zrzucie ekranu można zobaczyć, że próba uzyskania dostępu do widoku/Account/ChangePassword, gdy nie jest zalogowany, spowoduje przekierowanie do/Account/LogOn? ReturnUrl =% 2fAccount% 2fChangePassword% 2f.</span><span class="sxs-lookup"><span data-stu-id="a4a34-117">In the screenshot below, we can see that an attempt to access the /Account/ChangePassword view when not logged in results in a redirect to /Account/LogOn?ReturnUrl=%2fAccount%2fChangePassword%2f.</span></span>

[![](preventing-open-redirection-attacks/_static/image2.png)](preventing-open-redirection-attacks/_static/image1.png)

<span data-ttu-id="a4a34-118">**Ilustracja 01**: Strona logowania z otwartym przekierowaniem</span><span class="sxs-lookup"><span data-stu-id="a4a34-118">**Figure 01**: Login page with an open redirection</span></span>

<span data-ttu-id="a4a34-119">Ponieważ parametr QueryString ReturnUrl nie jest zweryfikowany, osoba atakująca może ją zmodyfikować, aby wstrzyknąć dowolny adres URL do parametru w celu przeprowadzenia ataku typu Open przekierowania.</span><span class="sxs-lookup"><span data-stu-id="a4a34-119">Since the ReturnUrl querystring parameter is not validated, an attacker can modify it to inject any URL address into the parameter to conduct an open redirection attack.</span></span> <span data-ttu-id="a4a34-120">Aby to zademonstrować, można zmodyfikować parametr ReturnUrl na [http://bing.com](http://bing.com), więc otrzymany adres URL logowania będzie/Account/LogOn? ReturnUrl =<http://www.bing.com/>.</span><span class="sxs-lookup"><span data-stu-id="a4a34-120">To demonstrate this, we can modify the ReturnUrl parameter to [http://bing.com](http://bing.com), so the resulting login URL will be /Account/LogOn?ReturnUrl=<http://www.bing.com/>.</span></span> <span data-ttu-id="a4a34-121">Po pomyślnym zalogowaniu się w witrynie nastąpi przekierowanie do [http://bing.com](http://bing.com).</span><span class="sxs-lookup"><span data-stu-id="a4a34-121">Upon successfully logging in to the site, we are redirected to [http://bing.com](http://bing.com).</span></span> <span data-ttu-id="a4a34-122">Ponieważ przekierowanie nie jest zweryfikowane, może to oznaczać złośliwą witrynę, która próbuje nakłonić użytkownika.</span><span class="sxs-lookup"><span data-stu-id="a4a34-122">Since this redirection is not validated, it could instead point to a malicious site that attempts to trick the user.</span></span>

### <a name="a-more-complex-open-redirection-attack"></a><span data-ttu-id="a4a34-123">Bardziej skomplikowany atak typu Open przekierowania</span><span class="sxs-lookup"><span data-stu-id="a4a34-123">A more complex Open Redirection Attack</span></span>

<span data-ttu-id="a4a34-124">Ataki typu Open przekierowania są szczególnie niebezpieczne, ponieważ osoba atakująca wie, że próbujemy zalogować się do określonej witryny sieci Web, co sprawia, że firma Microsoft jest narażona na [ataki wyłudzania informacji](https://www.microsoft.com/protect/fraud/phishing/symptoms.aspx).</span><span class="sxs-lookup"><span data-stu-id="a4a34-124">Open redirection attacks are especially dangerous because an attacker knows that we're trying to log into a specific website, which makes us vulnerable to a [phishing attack](https://www.microsoft.com/protect/fraud/phishing/symptoms.aspx).</span></span> <span data-ttu-id="a4a34-125">Na przykład osoba atakująca może wysyłać złośliwe wiadomości e-mail do użytkowników witryny sieci Web przy próbie przechwycenia ich haseł.</span><span class="sxs-lookup"><span data-stu-id="a4a34-125">For example, an attacker could send malicious emails to website users in an attempt to capture their passwords.</span></span> <span data-ttu-id="a4a34-126">Przyjrzyjmy się tym, jak to działa w witrynie NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="a4a34-126">Let's look at how this would work on the NerdDinner site.</span></span> <span data-ttu-id="a4a34-127">(Należy zauważyć, że witryna Live NerdDinner została zaktualizowana w celu ochrony przed atakami typu Open przekierowania).</span><span class="sxs-lookup"><span data-stu-id="a4a34-127">(Note that the live NerdDinner site has been updated to protect against open redirection attacks.)</span></span>

<span data-ttu-id="a4a34-128">Najpierw osoba atakująca wysyła nam link do strony logowania w witrynie NerdDinner, która zawiera przekierowanie do sfałszowanej strony:</span><span class="sxs-lookup"><span data-stu-id="a4a34-128">First, an attacker sends us a link to the login page on NerdDinner that includes a redirect to their forged page:</span></span>

[http://nerddinner.com/Account/LogOn?returnUrl=http://nerddiner.com/Account/LogOn](http://nerddinner.com/Account/LogOn?returnUrl=http://nerddiner.com/Account/LogOn)

<span data-ttu-id="a4a34-129">Zwróć uwagę, że zwrotny adres URL wskazuje na nerddiner.com, w którym brakuje "n" na obiad wyrazu.</span><span class="sxs-lookup"><span data-stu-id="a4a34-129">Note that the return URL points to nerddiner.com, which is missing an "n" from the word dinner.</span></span> <span data-ttu-id="a4a34-130">W tym przykładzie jest to domena, którą osoba atakująca kontroluje.</span><span class="sxs-lookup"><span data-stu-id="a4a34-130">In this example, this is a domain that the attacker controls.</span></span> <span data-ttu-id="a4a34-131">Gdy uzyskujemy dostęp do powyższego linku, nastąpi przekierowanie do strony logowania do NerdDinner.com.</span><span class="sxs-lookup"><span data-stu-id="a4a34-131">When we access the above link, we're taken to the legitimate NerdDinner.com login page.</span></span>

[![](preventing-open-redirection-attacks/_static/image4.png)](preventing-open-redirection-attacks/_static/image3.png)

<span data-ttu-id="a4a34-132">**Ilustracja 02**: Strona logowania NerdDinner z otwartym przekierowaniem</span><span class="sxs-lookup"><span data-stu-id="a4a34-132">**Figure 02**: NerdDinner login page with an open redirection</span></span>

<span data-ttu-id="a4a34-133">Po poprawnym zalogowaniu się akcja logowania ASP.NET MVC elementu AccountController przekierowuje nas do adresu URL określonego w parametrze QueryString returnUrl.</span><span class="sxs-lookup"><span data-stu-id="a4a34-133">When we correctly log in, the ASP.NET MVC AccountController's LogOn action redirects us to the URL specified in the returnUrl querystring parameter.</span></span> <span data-ttu-id="a4a34-134">W tym przypadku jest to adres URL wprowadzony przez atakującego, który jest [http://nerddiner.com/Account/LogOn](http://nerddiner.com/Account/LogOn).</span><span class="sxs-lookup"><span data-stu-id="a4a34-134">In this case, it's the URL that the attacker has entered, which is [http://nerddiner.com/Account/LogOn](http://nerddiner.com/Account/LogOn).</span></span> <span data-ttu-id="a4a34-135">O ile nie jest to niezwykle zauważalne, prawdopodobnie nie będzie to konieczne, szczególnie dlatego, że osoba atakująca ma ostrożność, aby upewnić się, że ich sfałszowana strona wygląda podobnie jak legalna Strona logowania.</span><span class="sxs-lookup"><span data-stu-id="a4a34-135">Unless we're extremely watchful, it's very likely we won't notice this, especially because the attacker has been careful to make sure that their forged page looks exactly like the legitimate login page.</span></span> <span data-ttu-id="a4a34-136">Ta strona logowania zawiera komunikat o błędzie z żądaniem ponownego zalogowania.</span><span class="sxs-lookup"><span data-stu-id="a4a34-136">This login page includes an error message requesting that we login again.</span></span> <span data-ttu-id="a4a34-137">Clumsy nam, musimy mieć wpisane hasło.</span><span class="sxs-lookup"><span data-stu-id="a4a34-137">Clumsy us, we must have mistyped our password.</span></span>

[![](preventing-open-redirection-attacks/_static/image6.png)](preventing-open-redirection-attacks/_static/image5.png)

<span data-ttu-id="a4a34-138">**Ilustracja 03**: ekran logowania NerdDinner sfałszowany</span><span class="sxs-lookup"><span data-stu-id="a4a34-138">**Figure 03**: Forged NerdDinner Login screen</span></span>

<span data-ttu-id="a4a34-139">Po przepisaniu nazwy użytkownika i hasła na stronie logowania sfałszowane informacje są zapisywane i wysyłane z powrotem do zaufanej witryny NerdDinner.com.</span><span class="sxs-lookup"><span data-stu-id="a4a34-139">When we retype our user name and password, the forged login page saves the information and sends us back to the legitimate NerdDinner.com site.</span></span> <span data-ttu-id="a4a34-140">W tym momencie lokacja NerdDinner.com została już uwierzytelniona, więc Strona logowania sfałszowana może zostać przekierowana bezpośrednio do tej strony.</span><span class="sxs-lookup"><span data-stu-id="a4a34-140">At this point, the NerdDinner.com site has already authenticated us, so the forged login page can redirect directly to that page.</span></span> <span data-ttu-id="a4a34-141">Oznacza to, że osoba atakująca ma swoją nazwę użytkownika i hasło, a firma Microsoft nie uważa, że została przez nas udostępniona.</span><span class="sxs-lookup"><span data-stu-id="a4a34-141">The end result is that the attacker has our user name and password, and we are unaware that we've provided it to them.</span></span>

## <a name="looking-at-the-vulnerable-code-in-the-accountcontroller-logon-action"></a><span data-ttu-id="a4a34-142">Spojrzenie na kod zagrożony w akcji logowania elementu AccountController</span><span class="sxs-lookup"><span data-stu-id="a4a34-142">Looking at the vulnerable code in the AccountController LogOn Action</span></span>

<span data-ttu-id="a4a34-143">Poniżej przedstawiono kod akcji logowania w aplikacji ASP.NET MVC 2.</span><span class="sxs-lookup"><span data-stu-id="a4a34-143">The code for the LogOn action in an ASP.NET MVC 2 application is shown below.</span></span> <span data-ttu-id="a4a34-144">Należy pamiętać, że po pomyślnym zalogowaniu kontroler zwraca przekierowanie do returnUrl.</span><span class="sxs-lookup"><span data-stu-id="a4a34-144">Note that upon a successful login, the controller returns a redirect to the returnUrl.</span></span> <span data-ttu-id="a4a34-145">Można sprawdzić, czy nie jest wykonywana żadna Walidacja w odniesieniu do parametru returnUrl.</span><span class="sxs-lookup"><span data-stu-id="a4a34-145">You can see that no validation is being performed against the returnUrl parameter.</span></span>

<span data-ttu-id="a4a34-146">**Wyświetlanie listy 1 – ASP.NET akcji logowania MVC 2 w `AccountController.cs`**</span><span class="sxs-lookup"><span data-stu-id="a4a34-146">**Listing 1 – ASP.NET MVC 2 LogOn action in `AccountController.cs`**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample1.cs)]

<span data-ttu-id="a4a34-147">Teraz przyjrzyjmy się zmianom akcji logowania ASP.NET MVC 3.</span><span class="sxs-lookup"><span data-stu-id="a4a34-147">Now let's look at the changes to the ASP.NET MVC 3 LogOn action.</span></span> <span data-ttu-id="a4a34-148">Ten kod został zmieniony, aby sprawdzić poprawność parametru returnUrl przez wywołanie nowej metody w klasie pomocnika system. Web. MVC. URL o nazwie `IsLocalUrl()`.</span><span class="sxs-lookup"><span data-stu-id="a4a34-148">This code has been changed to validate the returnUrl parameter by calling a new method in the System.Web.Mvc.Url helper class named `IsLocalUrl()`.</span></span>

<span data-ttu-id="a4a34-149">**Lista 2 – ASP.NET akcji logowania MVC 3 w `AccountController.cs`**</span><span class="sxs-lookup"><span data-stu-id="a4a34-149">**Listing 2 – ASP.NET MVC 3 LogOn action in `AccountController.cs`**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample2.cs)]

<span data-ttu-id="a4a34-150">Ten element został zmieniony w celu zweryfikowania parametru zwrotnego adresu URL, wywołując nową metodę w klasie pomocnika system. Web. MVC. URL `IsLocalUrl()`.</span><span class="sxs-lookup"><span data-stu-id="a4a34-150">This has been changed to validate the return URL parameter by calling a new method in the System.Web.Mvc.Url helper class, `IsLocalUrl()`.</span></span>

## <a name="protecting-your-aspnet-mvc-10-and-mvc-2-applications"></a><span data-ttu-id="a4a34-151">Ochrona aplikacji ASP.NET MVC 1,0 i MVC 2</span><span class="sxs-lookup"><span data-stu-id="a4a34-151">Protecting Your ASP.NET MVC 1.0 and MVC 2 Applications</span></span>

<span data-ttu-id="a4a34-152">Możemy wykorzystać zmiany ASP.NET MVC 3 w istniejących aplikacjach ASP.NET MVC 1,0 i 2 przez dodanie metody pomocnika IsLocalUrl () i zaktualizowanie akcji logowania w celu sprawdzenia poprawności parametru returnUrl.</span><span class="sxs-lookup"><span data-stu-id="a4a34-152">We can take advantage of the ASP.NET MVC 3 changes in our existing ASP.NET MVC 1.0 and 2 applications by adding the IsLocalUrl() helper method and updating the LogOn action to validate the returnUrl parameter.</span></span>

<span data-ttu-id="a4a34-153">Metoda UrlHelper IsLocalUrl () faktycznie wywołuje metodę w programie System. Web. Webpages, ponieważ ta Walidacja jest również używana przez aplikacje ASP.NET Web Pages.</span><span class="sxs-lookup"><span data-stu-id="a4a34-153">The UrlHelper IsLocalUrl() method actually just calling into a method in System.Web.WebPages, as this validation is also used by ASP.NET Web Pages applications.</span></span>

<span data-ttu-id="a4a34-154">**Lista 3 — Metoda IsLocalUrl () z ASP.NET MVC 3 UrlHelper `class`**</span><span class="sxs-lookup"><span data-stu-id="a4a34-154">**Listing 3 – The IsLocalUrl() method from the ASP.NET MVC 3 UrlHelper `class`**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample3.cs)]

<span data-ttu-id="a4a34-155">Metoda IsUrlLocalToHost zawiera rzeczywistą logikę walidacji, jak pokazano na liście 4.</span><span class="sxs-lookup"><span data-stu-id="a4a34-155">The IsUrlLocalToHost method contains the actual validation logic, as shown in Listing 4.</span></span>

<span data-ttu-id="a4a34-156">**Wyświetlanie listy 4 – IsUrlLocalToHost () metody z klasy System. Web. Webpages RequestExtensions**</span><span class="sxs-lookup"><span data-stu-id="a4a34-156">**Listing 4 – IsUrlLocalToHost() method from the System.Web.WebPages RequestExtensions class**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample4.cs)]

<span data-ttu-id="a4a34-157">W naszej aplikacji ASP.NET MVC 1,0 lub 2 dodamy do elementu AccountController metodę IsLocalUrl (), ale zaleca się dodanie jej do innej klasy pomocnika, jeśli to możliwe.</span><span class="sxs-lookup"><span data-stu-id="a4a34-157">In our ASP.NET MVC 1.0 or 2 application, we'll add a IsLocalUrl() method to the AccountController, but you're encouraged to add it to a separate helper class if possible.</span></span> <span data-ttu-id="a4a34-158">Wprowadzimy dwie małe zmiany w wersji ASP.NET MVC 3 IsLocalUrl (), dzięki czemu będzie ona działała wewnątrz elementu AccountController.</span><span class="sxs-lookup"><span data-stu-id="a4a34-158">We will make two small changes to the ASP.NET MVC 3 version of IsLocalUrl() so that it will work inside the AccountController.</span></span> <span data-ttu-id="a4a34-159">Najpierw zmienimy ją z metody publicznej na prywatną metodę, ponieważ metody publiczne w kontrolerach są dostępne jako akcje kontrolera.</span><span class="sxs-lookup"><span data-stu-id="a4a34-159">First, we'll change it from a public method to a private method, since public methods in controllers can be accessed as controller actions.</span></span> <span data-ttu-id="a4a34-160">Następnie zmodyfikujemy wywołanie sprawdzające Host adresu URL względem hosta aplikacji.</span><span class="sxs-lookup"><span data-stu-id="a4a34-160">Second, we'll modify the call that checks the URL host against the application host.</span></span> <span data-ttu-id="a4a34-161">To wywołanie umożliwia użycie lokalnego pola RequestContext w klasie UrlHelper.</span><span class="sxs-lookup"><span data-stu-id="a4a34-161">That call makes use of a local RequestContext field in the UrlHelper class.</span></span> <span data-ttu-id="a4a34-162">Zamiast tego. RequestContext. HttpContext. Request. URL. host, użyjemy tego. Request. URL. host.</span><span class="sxs-lookup"><span data-stu-id="a4a34-162">Instead of using this.RequestContext.HttpContext.Request.Url.Host, we will use this.Request.Url.Host.</span></span> <span data-ttu-id="a4a34-163">Poniższy kod przedstawia zmodyfikowaną metodę IsLocalUrl () do użycia z klasą kontrolera w aplikacjach ASP.NET MVC 1,0 i 2.</span><span class="sxs-lookup"><span data-stu-id="a4a34-163">The following code shows the modified IsLocalUrl() method for use with a controller class in ASP.NET MVC 1.0 and 2 applications.</span></span>

<span data-ttu-id="a4a34-164">**Lista 5 — Metoda IsLocalUrl (), która jest modyfikowana do użycia z klasą kontrolera MVC**</span><span class="sxs-lookup"><span data-stu-id="a4a34-164">**Listing 5 – IsLocalUrl() method, which is modified for use with an MVC Controller class**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample5.cs)]

<span data-ttu-id="a4a34-165">Teraz, gdy metoda IsLocalUrl () jest na miejscu, możemy wywołać ją z naszej akcji logowania, aby sprawdzić poprawność parametru returnUrl, jak pokazano w poniższym kodzie.</span><span class="sxs-lookup"><span data-stu-id="a4a34-165">Now that the IsLocalUrl() method is in place, we can call it from our LogOn action to validate the returnUrl parameter, as shown in the following code.</span></span>

<span data-ttu-id="a4a34-166">**Lista 6 — zaktualizowana metoda logowania, która sprawdza poprawność parametru returnUrl**</span><span class="sxs-lookup"><span data-stu-id="a4a34-166">**Listing 6 – Updated LogOn method which validates the returnUrl parameter**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample6.cs)]

<span data-ttu-id="a4a34-167">Teraz możemy przetestować atak typu Open przekierowania, próbując zalogować się przy użyciu zewnętrznego zwrotnego adresu URL.</span><span class="sxs-lookup"><span data-stu-id="a4a34-167">Now we can test an open redirection attack by attempting to log in using an external return URL.</span></span> <span data-ttu-id="a4a34-168">Użyjmy/Account/LogOn? ReturnUrl =<http://www.bing.com/> ponownie.</span><span class="sxs-lookup"><span data-stu-id="a4a34-168">Let's use /Account/LogOn?ReturnUrl=<http://www.bing.com/> again.</span></span>

[![](preventing-open-redirection-attacks/_static/image8.png)](preventing-open-redirection-attacks/_static/image7.png)

<span data-ttu-id="a4a34-169">**Rysunek 04**: testowanie zaktualizowanej akcji logowania</span><span class="sxs-lookup"><span data-stu-id="a4a34-169">**Figure 04**: Testing the updated LogOn Action</span></span>

<span data-ttu-id="a4a34-170">Po pomyślnym zalogowaniu zostanie przekierowany do akcji kontrolera domu/indeksu, a nie zewnętrznego adresu URL.</span><span class="sxs-lookup"><span data-stu-id="a4a34-170">After successfully logging in, we are redirected to the Home/Index Controller action rather than the external URL.</span></span>

[![](preventing-open-redirection-attacks/_static/image10.png)](preventing-open-redirection-attacks/_static/image9.png)

<span data-ttu-id="a4a34-171">**Ilustracja 05**. podlegające atakom typu "Otwieranie przekierowania"</span><span class="sxs-lookup"><span data-stu-id="a4a34-171">**Figure 05**: Open Redirection attack defeated</span></span>

## <a name="summary"></a><span data-ttu-id="a4a34-172">Podsumowanie</span><span class="sxs-lookup"><span data-stu-id="a4a34-172">Summary</span></span>

<span data-ttu-id="a4a34-173">Ataki typu Open przekierowania mogą wystąpić, gdy adresy URL przekierowania są przesyłane jako parametry w adresie URL aplikacji.</span><span class="sxs-lookup"><span data-stu-id="a4a34-173">Open redirection attacks can occur when redirection URLs are passed as parameters in the URL for an application.</span></span> <span data-ttu-id="a4a34-174">Szablon ASP.NET MVC 3 zawiera kod chroniący przed atakami typu Open przekierowania.</span><span class="sxs-lookup"><span data-stu-id="a4a34-174">The ASP.NET MVC 3 template includes code to protect against open redirection attacks.</span></span> <span data-ttu-id="a4a34-175">Można dodać ten kod z modyfikacją ASP.NET MVC 1,0 i 2 aplikacji.</span><span class="sxs-lookup"><span data-stu-id="a4a34-175">You can add this code with some modification to ASP.NET MVC 1.0 and 2 applications.</span></span> <span data-ttu-id="a4a34-176">Aby chronić przed atakami typu "Otwieranie przekierowań" podczas logowania się do aplikacji ASP.NET 1,0 i 2, Dodaj metodę IsLocalUrl () i sprawdź poprawność parametru returnUrl w akcji logowania.</span><span class="sxs-lookup"><span data-stu-id="a4a34-176">To protect against open redirection attacks when logging into ASP.NET 1.0 and 2 applications, add a IsLocalUrl() method and validate the returnUrl parameter in the LogOn action.</span></span>
