---
uid: web-api/overview/security/individual-accounts-in-web-api
title: Zabezpieczanie interfejsu API sieci Web za pomocą indywidualnych kont i logowania lokalnego we wzorcu ASP.NET Web API 2.2 | Dokumentacja firmy Microsoft
author: MikeWasson
description: W tym temacie pokazano, jak zabezpieczyć internetowy interfejs API za pomocą protokołu OAuth2, do uwierzytelniania względem bazy danych członkostwa. Wersje oprogramowania używany w samouczku Visual 201 Studio...
ms.author: riande
ms.date: 10/15/2014
ms.assetid: 92c84846-f0ea-4b5e-94b6-5004874eb060
msc.legacyurl: /web-api/overview/security/individual-accounts-in-web-api
msc.type: authoredcontent
ms.openlocfilehash: 29c3670ad7ab93acb0be878e5bd961d0ea446eee
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 04/17/2019
ms.locfileid: "59396235"
---
# <a name="secure-a-web-api-with-individual-accounts-and-local-login-in-aspnet-web-api-22"></a><span data-ttu-id="9e2cf-104">Zabezpieczanie interfejsu API sieci Web za pomocą indywidualnych kont i logowania lokalnego we wzorcu ASP.NET Web API 2.2</span><span class="sxs-lookup"><span data-stu-id="9e2cf-104">Secure a Web API with Individual Accounts and Local Login in ASP.NET Web API 2.2</span></span>

<span data-ttu-id="9e2cf-105">przez [Mike Wasson](https://github.com/MikeWasson)</span><span class="sxs-lookup"><span data-stu-id="9e2cf-105">by [Mike Wasson](https://github.com/MikeWasson)</span></span>

[<span data-ttu-id="9e2cf-106">Pobierz przykładową aplikację</span><span class="sxs-lookup"><span data-stu-id="9e2cf-106">Download Sample App</span></span>](https://github.com/MikeWasson/LocalAccountsApp)

> <span data-ttu-id="9e2cf-107">W tym temacie pokazano, jak zabezpieczyć internetowy interfejs API za pomocą protokołu OAuth2, do uwierzytelniania względem bazy danych członkostwa.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-107">This topic shows how to secure a web API using OAuth2 to authenticate against a membership database.</span></span>
> 
> ## <a name="software-versions-used-in-the-tutorial"></a><span data-ttu-id="9e2cf-108">Wersje oprogramowania używanego w tym samouczku</span><span class="sxs-lookup"><span data-stu-id="9e2cf-108">Software versions used in the tutorial</span></span>
> 
> 
> - [<span data-ttu-id="9e2cf-109">Visual Studio 2013 Update 3</span><span class="sxs-lookup"><span data-stu-id="9e2cf-109">Visual Studio 2013 Update 3</span></span>](https://www.microsoft.com/visualstudio/eng/2013-downloads)
> - [<span data-ttu-id="9e2cf-110">Składnik Web API 2.2</span><span class="sxs-lookup"><span data-stu-id="9e2cf-110">Web API 2.2</span></span>](../releases/whats-new-in-aspnet-web-api-22.md)
> - [<span data-ttu-id="9e2cf-111">ASP.NET Identity 2.1</span><span class="sxs-lookup"><span data-stu-id="9e2cf-111">ASP.NET Identity 2.1</span></span>](../../../identity/index.md)


<span data-ttu-id="9e2cf-112">W programie Visual Studio 2013 szablon projektu interfejsu API sieci Web udostępnia trzy metody uwierzytelniania:</span><span class="sxs-lookup"><span data-stu-id="9e2cf-112">In Visual Studio 2013, the Web API project template gives you three options for authentication:</span></span>

- <span data-ttu-id="9e2cf-113">**Indywidualne konta.**</span><span class="sxs-lookup"><span data-stu-id="9e2cf-113">**Individual accounts.**</span></span> <span data-ttu-id="9e2cf-114">Aplikacja korzysta z bazy danych członkostwa.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-114">The app uses a membership database.</span></span>
- <span data-ttu-id="9e2cf-115">**Konta organizacji.**</span><span class="sxs-lookup"><span data-stu-id="9e2cf-115">**Organizational accounts.**</span></span> <span data-ttu-id="9e2cf-116">Użytkownicy zalogować się przy użyciu ich usługi Azure Active Directory, usługi Office 365, poświadczeń usługi Active Directory w środowisku lokalnym.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-116">Users sign in with their Azure Active Directory, Office 365, or on-premise Active Directory credentials.</span></span>
- <span data-ttu-id="9e2cf-117">**Uwierzytelnianie Windows.**</span><span class="sxs-lookup"><span data-stu-id="9e2cf-117">**Windows authentication.**</span></span> <span data-ttu-id="9e2cf-118">Ta opcja jest przeznaczona dla aplikacji intranetowych i używa modułu Windows uwierzytelniania w usługach IIS.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-118">This option is intended for Intranet applications, and uses the Windows Authentication IIS module.</span></span>

<span data-ttu-id="9e2cf-119">Aby uzyskać więcej informacji o tych opcjach, zobacz [tworzenia projektów sieci Web platformy ASP.NET w programie Visual Studio 2013](../../../visual-studio/overview/2013/creating-web-projects-in-visual-studio.md#auth).</span><span class="sxs-lookup"><span data-stu-id="9e2cf-119">For more details about these options, see [Creating ASP.NET Web Projects in Visual Studio 2013](../../../visual-studio/overview/2013/creating-web-projects-in-visual-studio.md#auth).</span></span>

<span data-ttu-id="9e2cf-120">Indywidualne konta zapewniają użytkownikowi na logowanie na dwa sposoby:</span><span class="sxs-lookup"><span data-stu-id="9e2cf-120">Individual accounts provide two ways for a user to log in:</span></span>

- <span data-ttu-id="9e2cf-121">**Lokalny identyfikator logowania**.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-121">**Local login**.</span></span> <span data-ttu-id="9e2cf-122">Użytkownik rejestruje w danej lokacji, wprowadzając nazwę użytkownika i hasło.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-122">The user registers at the site, entering a username and password.</span></span> <span data-ttu-id="9e2cf-123">Aplikacja przechowuje wartość skrótu hasła w bazie danych członkostwa.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-123">The app stores the password hash in the membership database.</span></span> <span data-ttu-id="9e2cf-124">Gdy użytkownik się zaloguje, system produktu ASP.NET Identity weryfikuje hasło.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-124">When the user logs in, the ASP.NET Identity system verifies the password.</span></span>
- <span data-ttu-id="9e2cf-125">**Logowania społecznościowych**.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-125">**Social login**.</span></span> <span data-ttu-id="9e2cf-126">Użytkownik loguje się przy użyciu usługi zewnętrznej, np. Facebook, Microsoft lub Google.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-126">The user signs in with an external service, such as Facebook, Microsoft, or Google.</span></span> <span data-ttu-id="9e2cf-127">Aplikacja nadal tworzy wpis dla użytkownika w bazie danych członkostwa, ale nie przechowuje żadnych poświadczeń.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-127">The app still creates an entry for the user in the membership database, but does not store any credentials.</span></span> <span data-ttu-id="9e2cf-128">Użytkownik jest uwierzytelniany, logując się do usługi zewnętrznej.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-128">The user authenticates by signing into the external service.</span></span>

<span data-ttu-id="9e2cf-129">W tym artykule przedstawiono w scenariuszu do logowania lokalnego.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-129">This article looks at the local login scenario.</span></span> <span data-ttu-id="9e2cf-130">Do logowania zarówno lokalnych, jak i społecznościowych internetowy interfejs API używa protokołu OAuth2, do uwierzytelniania żądań.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-130">For both local and social login, Web API uses OAuth2 to authenticate requests.</span></span> <span data-ttu-id="9e2cf-131">Przepływy poświadczeń są jednak inne w przypadku logowania lokalnego i społecznościowych.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-131">However, the credential flows are different for local and social login.</span></span>

<span data-ttu-id="9e2cf-132">W tym artykule zademonstruję prosta aplikacja, którą użytkownicy będą mogli zalogować się i wysyłać uwierzytelnionych wywołań AJAX do internetowego interfejsu API.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-132">In this article, I'll demonstrate a simple app that lets the user log in and send authenticated AJAX calls to a web API.</span></span> <span data-ttu-id="9e2cf-133">Możesz pobrać przykładowy kod [tutaj](https://github.com/MikeWasson/LocalAccountsApp).</span><span class="sxs-lookup"><span data-stu-id="9e2cf-133">You can download the sample code [here](https://github.com/MikeWasson/LocalAccountsApp).</span></span> <span data-ttu-id="9e2cf-134">Plik readme zawiera opis sposobu tworzenia przykładu od podstaw w programie Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-134">The readme describes how to create the sample from scratch in Visual Studio.</span></span>

[![](individual-accounts-in-web-api/_static/image2.png)](individual-accounts-in-web-api/_static/image1.png)

<span data-ttu-id="9e2cf-135">Przykładowa aplikacja korzysta z użyciem Knockout.js powiązanie danych i jQuery wysyłanie żądań AJAX.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-135">The sample app uses Knockout.js for data-binding and jQuery for sending AJAX requests.</span></span> <span data-ttu-id="9e2cf-136">I będzie można koncentrujących się na wywołań AJAX, więc nie trzeba znać struktura Knockout.js na potrzeby tego artykułu.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-136">I'll be focusing on the AJAX calls, so you don't need to know Knockout.js for this article.</span></span>

<span data-ttu-id="9e2cf-137">Po drodze będzie I opisano:</span><span class="sxs-lookup"><span data-stu-id="9e2cf-137">Along the way, I'll describe:</span></span>

- <span data-ttu-id="9e2cf-138">Jakie działania aplikacji po stronie klienta.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-138">What the app is doing on the client side.</span></span>
- <span data-ttu-id="9e2cf-139">Co się dzieje na serwerze.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-139">What's happening on the server.</span></span>
- <span data-ttu-id="9e2cf-140">Ruch HTTP w środku.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-140">The HTTP traffic in the middle.</span></span>

<span data-ttu-id="9e2cf-141">Najpierw należy zdefiniować niektóre terminologii OAuth2.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-141">First, we need to define some OAuth2 terminology.</span></span>

- <span data-ttu-id="9e2cf-142">*Zasób*.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-142">*Resource*.</span></span> <span data-ttu-id="9e2cf-143">Niektóre części danych, które mogą być chronione.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-143">Some piece of data that can be protected.</span></span>
- <span data-ttu-id="9e2cf-144">*Serwer zasobów*.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-144">*Resource server*.</span></span> <span data-ttu-id="9e2cf-145">Serwer hostujący zasób.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-145">The server that hosts the resource.</span></span>
- <span data-ttu-id="9e2cf-146">*Właściciel zasobu*.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-146">*Resource owner*.</span></span> <span data-ttu-id="9e2cf-147">Jednostka, która może udzielić uprawnień do uzyskania dostępu do zasobu.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-147">The entity that can grant permission to access a resource.</span></span> <span data-ttu-id="9e2cf-148">(Zazwyczaj użytkownik.)</span><span class="sxs-lookup"><span data-stu-id="9e2cf-148">(Typically the user.)</span></span>
- <span data-ttu-id="9e2cf-149">*Klient*: Aplikacja, która chce uzyskać dostęp do zasobu.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-149">*Client*: The app that wants access to the resource.</span></span> <span data-ttu-id="9e2cf-150">W tym artykule klient jest przeglądarki sieci web.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-150">In this article, the client is a web browser.</span></span>
- <span data-ttu-id="9e2cf-151">*Token dostępu*.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-151">*Access token*.</span></span> <span data-ttu-id="9e2cf-152">Token udzielający dostępu do zasobu.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-152">A token that grants access to a resource.</span></span>
- <span data-ttu-id="9e2cf-153">*Token elementu nośnego*.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-153">*Bearer token*.</span></span> <span data-ttu-id="9e2cf-154">Określony typ tokenu dostępu, za pomocą właściwości, każda osoba może użyć tokenu.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-154">A particular type of access token, with the property that anyone can use the token.</span></span> <span data-ttu-id="9e2cf-155">Innymi słowy klient nie wymaga klucza kryptograficznego lub inne hasło do użycia tokenu elementu nośnego.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-155">In other words, a client doesn't need a cryptographic key or other secret to use a bearer token.</span></span> <span data-ttu-id="9e2cf-156">Z tego powodu tokenów elementu nośnego powinna służyć wyłącznie za pośrednictwem protokołu HTTPS, a powinien mieć stosunkowo krótkich okresach ważności.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-156">For that reason, bearer tokens should only be used over a HTTPS, and should have relatively short expiration times.</span></span>
- <span data-ttu-id="9e2cf-157">*Serwer autoryzacji*.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-157">*Authorization server*.</span></span> <span data-ttu-id="9e2cf-158">Serwer, który daje się tokenów dostępu.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-158">A server that gives out access tokens.</span></span>

<span data-ttu-id="9e2cf-159">Aplikacja może działać jako serwer zasobów i serwera autoryzacji.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-159">An application can act as both authorization server and resource server.</span></span> <span data-ttu-id="9e2cf-160">Szablon projektu interfejsu API sieci Web to wzorcem.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-160">The Web API project template follows this pattern.</span></span>

## <a name="local-login-credential-flow"></a><span data-ttu-id="9e2cf-161">Przepływ poświadczeń do logowania lokalnego</span><span class="sxs-lookup"><span data-stu-id="9e2cf-161">Local Login Credential Flow</span></span>

<span data-ttu-id="9e2cf-162">W przypadku logowania lokalnego używa interfejsu API sieci Web [przepływu hasła właściciela zasobu](http://oauthlib.readthedocs.org/en/latest/oauth2/grants/password.html) zdefiniowany typ tokenu protokołu oauth2.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-162">For local login, Web API uses the [resource owner password flow](http://oauthlib.readthedocs.org/en/latest/oauth2/grants/password.html) defined in OAuth2.</span></span>

1. <span data-ttu-id="9e2cf-163">Użytkownik wprowadza nazwę i hasło do klienta.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-163">The user enters a name and password into the client.</span></span>
2. <span data-ttu-id="9e2cf-164">Klient wysyła te poświadczenia do autoryzacji serwera.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-164">The client sends these credentials to the authorization server.</span></span>
3. <span data-ttu-id="9e2cf-165">Serwer autoryzacji uwierzytelnia poświadczenia i zwraca token dostępu.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-165">The authorization server authenticates the credentials and returns an access token.</span></span>
4. <span data-ttu-id="9e2cf-166">Aby uzyskać dostęp do chronionego zasobu, klient dołącza token dostępu w nagłówku autoryzacji żądania HTTP.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-166">To access a protected resource, the client includes the access token in the Authorization header of the HTTP request.</span></span>

![](individual-accounts-in-web-api/_static/image3.png)

<span data-ttu-id="9e2cf-167">Po wybraniu **indywidualnych kont** w szablonie projektu interfejsu API sieci Web, projekt obejmuje serwera autoryzacji, weryfikuje poświadczenia użytkownika, która wystawia tokeny.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-167">When you select **Individual accounts** in the Web API project template, the project includes an authorization server that validates user credentials and issues tokens.</span></span> <span data-ttu-id="9e2cf-168">Na poniższym diagramie przedstawiono sam przepływ poświadczeń w zakresie składników interfejsu API sieci Web.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-168">The following diagram shows the same credential flow in terms of Web API components.</span></span>

![](individual-accounts-in-web-api/_static/image4.png)

<span data-ttu-id="9e2cf-169">W tym scenariuszu kontrolerów internetowych interfejsów API działać jako serwery zasobów.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-169">In this scenario, Web API controllers act as resource servers.</span></span> <span data-ttu-id="9e2cf-170">Filtr uwierzytelniania weryfikuje tokeny dostępu i **[Authorize]** atrybut jest używany w celu ochrony zasobu.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-170">An authentication filter validates access tokens, and the **[Authorize]** attribute is used to protect a resource.</span></span> <span data-ttu-id="9e2cf-171">Jeśli kontroler lub akcję ma **[Authorize]** atrybut, wszystkie żądania do tego kontrolera lub akcji, które musi zostać uwierzytelniony.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-171">When a controller or action has the **[Authorize]** attribute, all requests to that controller or action must be authenticated.</span></span> <span data-ttu-id="9e2cf-172">W przeciwnym razie odmowy autoryzacji i internetowy interfejs API zwraca (błąd nieupoważnionego dostępu 401).</span><span class="sxs-lookup"><span data-stu-id="9e2cf-172">Otherwise, authorization is denied, and Web API returns a 401 (Unauthorized) error.</span></span>

<span data-ttu-id="9e2cf-173">Serwer autoryzacji i filtr uwierzytelniania zarówno wywoływać [oprogramowania pośredniczącego OWIN](../../../aspnet/overview/owin-and-katana/an-overview-of-project-katana.md) składnik, który obsłuży OAuth2.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-173">The authorization server and the authentication filter both call into an [OWIN middleware](../../../aspnet/overview/owin-and-katana/an-overview-of-project-katana.md) component that handles the details of OAuth2.</span></span> <span data-ttu-id="9e2cf-174">Czy mogę będzie opisują projektowania bardziej szczegółowo w dalszej części tego samouczka.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-174">I'll describe the design in more detail later in this tutorial.</span></span>

## <a name="sending-an-unauthorized-request"></a><span data-ttu-id="9e2cf-175">Wysyłanie nieautoryzowanego żądania</span><span class="sxs-lookup"><span data-stu-id="9e2cf-175">Sending an Unauthorized Request</span></span>

<span data-ttu-id="9e2cf-176">Aby rozpocząć pracę, uruchomić aplikację, a następnie kliknij przycisk **Wywołaj interfejs API** przycisku.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-176">To get started, run the app and click the **Call API** button.</span></span> <span data-ttu-id="9e2cf-177">Po ukończeniu żądania powinien zostać wyświetlony komunikat o błędzie w **wynik** pole.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-177">When the request completes, you should see an error message in the **Result** box.</span></span> <span data-ttu-id="9e2cf-178">To, ponieważ żądanie nie zawiera token dostępu, więc nie ma autoryzacji żądania.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-178">That's because the request does not contain an access token, so the request is unauthorized.</span></span>

[![](individual-accounts-in-web-api/_static/image6.png)](individual-accounts-in-web-api/_static/image5.png)

<span data-ttu-id="9e2cf-179">**Wywołaj interfejs API** przycisk wysyła żądanie AJAX ~/api/wartości, które wywołuje akcji kontrolera interfejsu API sieci Web.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-179">The **Call API** button sends an AJAX request to ~/api/values, which invokes a Web API controller action.</span></span> <span data-ttu-id="9e2cf-180">Poniżej przedstawiono sekcję kodu JavaScript, który wysyła żądanie AJAX.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-180">Here is the section of JavaScript code that sends the AJAX request.</span></span> <span data-ttu-id="9e2cf-181">W przykładowej aplikacji całego kodu aplikacji JavaScript znajduje się w pliku Scripts\app.js.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-181">In the sample app, all of the JavaScript app code is located in the Scripts\app.js file.</span></span>

[!code-javascript[Main](individual-accounts-in-web-api/samples/sample1.js)]

<span data-ttu-id="9e2cf-182">Dopóki użytkownik loguje się, istnieje żaden token elementu nośnego i dlatego nie nagłówek autoryzacji w żądaniu.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-182">Until the user logs in, there is no bearer token, and therefore no Authorization header in the request.</span></span> <span data-ttu-id="9e2cf-183">Powoduje to, że żądanie zwróciło błąd 401 — dostęp.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-183">This causes the request to return a 401 error.</span></span>

<span data-ttu-id="9e2cf-184">Oto żądania HTTP.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-184">Here is the HTTP request.</span></span> <span data-ttu-id="9e2cf-185">(Dawniej [Fiddler](http://www.telerik.com/fiddler) do przechwytywania ruchu HTTP.)</span><span class="sxs-lookup"><span data-stu-id="9e2cf-185">(I used [Fiddler](http://www.telerik.com/fiddler) to capture the HTTP traffic.)</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample2.cmd)]

<span data-ttu-id="9e2cf-186">Odpowiedź HTTP:</span><span class="sxs-lookup"><span data-stu-id="9e2cf-186">HTTP response:</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample3.cmd?highlight=1,4)]

<span data-ttu-id="9e2cf-187">Należy zauważyć, że odpowiedź zawiera nagłówka Www-Authenticate z żądaniem równa elementu nośnego.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-187">Notice that the response includes a Www-Authenticate header with the challenge set to Bearer.</span></span> <span data-ttu-id="9e2cf-188">Wskazuje, że token elementu nośnego oczekiwanych przez serwer.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-188">That indicates the server expects a bearer token.</span></span>

## <a name="register-a-user"></a><span data-ttu-id="9e2cf-189">Rejestrowanie użytkownika</span><span class="sxs-lookup"><span data-stu-id="9e2cf-189">Register a User</span></span>

<span data-ttu-id="9e2cf-190">W **zarejestrować** części aplikacji, wprowadź adres e-mail i hasło, a następnie kliknij przycisk **zarejestrować** przycisku.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-190">In the **Register** section of the app, enter an email and password, and click the **Register** button.</span></span>

<span data-ttu-id="9e2cf-191">Nie trzeba używać prawidłowy adres e-mail dla tego przykładu, ale potwierdzenie adresu, rzeczywistych aplikacji.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-191">You don't need to use a valid email address for this sample, but a real app would confirm the address.</span></span> <span data-ttu-id="9e2cf-192">(Zobacz [tworzenie bezpiecznej aplikacji sieci web ASP.NET MVC 5 z logowaniem, adres e-mail potwierdzenia i resetowaniem hasła](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md).) Hasła należy użyć ciągu "Password1!", z wielkiej litery, małe litery, liczby i znaków innych niż alfanumeryczne.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-192">(See [Create a secure ASP.NET MVC 5 web app with log in, email confirmation and password reset](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md).) For the password, use something like "Password1!", with an upper case letter, lower case letter, number, and non-alpha-numeric character.</span></span> <span data-ttu-id="9e2cf-193">W celu uproszczenia aplikacji pozostawiono I walidacji po stronie klienta, dzięki czemu w przypadku problemu z formatem hasła, otrzymasz błąd 400 (nieprawidłowe żądanie).</span><span class="sxs-lookup"><span data-stu-id="9e2cf-193">To keep the app simple, I left out client-side validation, so if there is a problem with the password format, you'll get a 400 (Bad Request) error.</span></span>

[![](individual-accounts-in-web-api/_static/image8.png)](individual-accounts-in-web-api/_static/image7.png)

<span data-ttu-id="9e2cf-194">**Zarejestrować** przycisk wysyła żądanie POST do ~/api/Account/Register /.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-194">The **Register** button sends a POST request to ~/api/Account/Register/.</span></span> <span data-ttu-id="9e2cf-195">Treść żądania jest obiekt JSON, który zawiera nazwę i hasło.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-195">The request body is a JSON object that holds the name and password.</span></span> <span data-ttu-id="9e2cf-196">Poniżej przedstawiono kod JavaScript, który wysyła żądanie:</span><span class="sxs-lookup"><span data-stu-id="9e2cf-196">Here is the JavaScript code that sends the request:</span></span>

[!code-javascript[Main](individual-accounts-in-web-api/samples/sample4.js)]

<span data-ttu-id="9e2cf-197">Żądania HTTP:</span><span class="sxs-lookup"><span data-stu-id="9e2cf-197">HTTP request:</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample5.cmd?highlight=5,10)]

<span data-ttu-id="9e2cf-198">Odpowiedź HTTP:</span><span class="sxs-lookup"><span data-stu-id="9e2cf-198">HTTP response:</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample6.cmd)]

<span data-ttu-id="9e2cf-199">To żądanie jest obsługiwane przez `AccountController` klasy.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-199">This request is handled by the `AccountController` class.</span></span> <span data-ttu-id="9e2cf-200">Wewnętrznie `AccountController` używa produktu ASP.NET Identity do zarządzania bazą danych członkostwa.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-200">Internally, `AccountController` uses ASP.NET Identity to manage the membership database.</span></span>

<span data-ttu-id="9e2cf-201">Jeśli lokalne uruchamianie aplikacji w programie Visual Studio konta użytkowników są przechowywane w LocalDB, w tabeli AspNetUsers.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-201">If you run the app locally from Visual Studio, user accounts are stored in LocalDB, in the AspNetUsers table.</span></span> <span data-ttu-id="9e2cf-202">Aby wyświetlić tabele w programie Visual Studio, kliknij **widoku** menu, wybierz opcję **Eksploratora serwera**, następnie rozwiń **połączeń danych**.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-202">To view the tables in Visual Studio, click the **View** menu, select **Server Explorer**, then expand **Data Connections**.</span></span>

![](individual-accounts-in-web-api/_static/image9.png)

## <a name="get-an-access-token"></a><span data-ttu-id="9e2cf-203">Uzyskiwanie tokenu dostępu</span><span class="sxs-lookup"><span data-stu-id="9e2cf-203">Get an Access Token</span></span>

<span data-ttu-id="9e2cf-204">Do tej pory firma Microsoft nie wykonano żadnych OAuth, ale teraz zobaczymy, serwer autoryzacji OAuth w działaniu, gdy żąda tokenu dostępu.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-204">So far we have not done any OAuth, but now we'll see the OAuth authorization server in action, when we request an access token.</span></span> <span data-ttu-id="9e2cf-205">W **logowanie** obszaru przykładowej aplikacji, wprowadź adres e-mail i hasło i kliknij przycisk **logowanie**.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-205">In the **Log In** area of the sample app, enter the email and password and click **Log In**.</span></span>

[![](individual-accounts-in-web-api/_static/image11.png)](individual-accounts-in-web-api/_static/image10.png)

<span data-ttu-id="9e2cf-206">**Logowanie** przycisk wysyła żądanie do punktu końcowego tokenu.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-206">The **Log In** button sends a request to the token endpoint.</span></span> <span data-ttu-id="9e2cf-207">Treść żądania zawiera następujące dane zakodowane jako adres url formularza:</span><span class="sxs-lookup"><span data-stu-id="9e2cf-207">The body of the request contains the following form-url-encoded data:</span></span>

- <span data-ttu-id="9e2cf-208">Przyznaj\_typu: "password"</span><span class="sxs-lookup"><span data-stu-id="9e2cf-208">grant\_type: "password"</span></span>
- <span data-ttu-id="9e2cf-209">Nazwa użytkownika: &lt;adres e-mail użytkownika&gt;</span><span class="sxs-lookup"><span data-stu-id="9e2cf-209">username: &lt;the user's email&gt;</span></span>
- <span data-ttu-id="9e2cf-210">hasło: &lt;hasła&gt;</span><span class="sxs-lookup"><span data-stu-id="9e2cf-210">password: &lt;password&gt;</span></span>

<span data-ttu-id="9e2cf-211">Poniżej przedstawiono kod JavaScript, który wysyła żądanie AJAX:</span><span class="sxs-lookup"><span data-stu-id="9e2cf-211">Here is the JavaScript code that sends the AJAX request:</span></span>

[!code-javascript[Main](individual-accounts-in-web-api/samples/sample7.js?highlight=14)]

<span data-ttu-id="9e2cf-212">Jeśli żądanie zakończy się powodzeniem, serwer autoryzacji zwraca token dostępu w treści odpowiedzi.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-212">If the request succeeds, the authorization server returns an access token in the response body.</span></span> <span data-ttu-id="9e2cf-213">Zwróć uwagę, czy token są przechowywane w pamięci masowej sesji, do użycia w przyszłości podczas wysyłania żądań do interfejsu API.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-213">Notice that we store the token in session storage, to use later when sending requests to the API.</span></span> <span data-ttu-id="9e2cf-214">Inaczej niż w przypadku niektórych metod uwierzytelniania (np. na podstawie plików cookie uwierzytelniania) przeglądarka nie będzie automatycznie zawierać token dostępu w kolejnych żądań.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-214">Unlike some forms of authentication (such as cookie-based authentication), the browser will not automatically include the access token in subsequent requests.</span></span> <span data-ttu-id="9e2cf-215">Aplikacja musi zrobić jawnie.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-215">The application must do so explicitly.</span></span> <span data-ttu-id="9e2cf-216">Który jest to przydatne, ponieważ ogranicza [CSRF luk w zabezpieczeniach](preventing-cross-site-request-forgery-csrf-attacks.md).</span><span class="sxs-lookup"><span data-stu-id="9e2cf-216">That's a good thing, because it limits [CSRF vulnerabilities](preventing-cross-site-request-forgery-csrf-attacks.md).</span></span>

<span data-ttu-id="9e2cf-217">Żądania HTTP:</span><span class="sxs-lookup"><span data-stu-id="9e2cf-217">HTTP request:</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample8.cmd?highlight=5,10)]

<span data-ttu-id="9e2cf-218">Aby zobaczyć, czy żądanie zawiera poświadczenia użytkownika.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-218">You can see that the request contains the user's credentials.</span></span> <span data-ttu-id="9e2cf-219">Możesz *musi* używać protokołu HTTPS w celu zapewnienia zabezpieczeń warstwy transportu.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-219">You *must* use HTTPS to provide transport layer security.</span></span>

<span data-ttu-id="9e2cf-220">Odpowiedź HTTP:</span><span class="sxs-lookup"><span data-stu-id="9e2cf-220">HTTP response:</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample9.cmd?highlight=8)]

<span data-ttu-id="9e2cf-221">Aby zwiększyć czytelność I wcięty za pomocą pliku JSON i obcięte tokenu dostępu, który jest bardzo długa.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-221">For readability, I indented the JSON and truncated the access token, which is a quite long.</span></span>

<span data-ttu-id="9e2cf-222">`access_token`, `token_type`, I `expires_in` właściwości są definiowane przez specyfikację OAuth2. Inne właściwości (`userName`, `.issued`, i `.expires`) są przeznaczone tylko dla celów informacyjnych.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-222">The `access_token`, `token_type`, and `expires_in` properties are defined by the OAuth2 spec. The other properties (`userName`, `.issued`, and `.expires`) are just for informational purposes.</span></span> <span data-ttu-id="9e2cf-223">Można znaleźć kod, który dodaje te dodatkowe właściwości w `TokenEndpoint` metody w pliku /Providers/ApplicationOAuthProvider.cs.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-223">You can find the code that adds those additional properties in the `TokenEndpoint` method, in the /Providers/ApplicationOAuthProvider.cs file.</span></span>

## <a name="send-an-authenticated-request"></a><span data-ttu-id="9e2cf-224">Wyślij żądanie uwierzytelnionego</span><span class="sxs-lookup"><span data-stu-id="9e2cf-224">Send an Authenticated Request</span></span>

<span data-ttu-id="9e2cf-225">Skoro mamy już token elementu nośnego, firma Microsoft może wprowadzać uwierzytelnionego żądania interfejsu API.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-225">Now that we have a bearer token, we can make an authenticated request to the API.</span></span> <span data-ttu-id="9e2cf-226">Odbywa się przez ustawienie nagłówek autoryzacji w żądaniu.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-226">This is done by setting the Authorization header in the request.</span></span> <span data-ttu-id="9e2cf-227">Kliknij przycisk **Wywołaj interfejs API** przycisk ponownie, aby to zobaczyć.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-227">Click the **Call API** button again to see this.</span></span>

[![](individual-accounts-in-web-api/_static/image13.png)](individual-accounts-in-web-api/_static/image12.png)

<span data-ttu-id="9e2cf-228">Żądania HTTP:</span><span class="sxs-lookup"><span data-stu-id="9e2cf-228">HTTP request:</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample10.cmd?highlight=5)]

<span data-ttu-id="9e2cf-229">Odpowiedź HTTP:</span><span class="sxs-lookup"><span data-stu-id="9e2cf-229">HTTP response:</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample11.cmd)]

## <a name="log-out"></a><span data-ttu-id="9e2cf-230">Wyloguj</span><span class="sxs-lookup"><span data-stu-id="9e2cf-230">Log Out</span></span>

<span data-ttu-id="9e2cf-231">Ponieważ przeglądarki nie buforuje poświadczeń lub tokenu dostępu, wylogowanie jest po prostu kwestią "podczas zapominania konta" token, usuwając go z sesji magazynu:</span><span class="sxs-lookup"><span data-stu-id="9e2cf-231">Because the browser does not cache the credentials or the access token, logging out is simply a matter of "forgetting" the token, by removing it from session storage:</span></span>

[!code-javascript[Main](individual-accounts-in-web-api/samples/sample12.js)]

## <a name="understanding-the-individual-accounts-project-template"></a><span data-ttu-id="9e2cf-232">Opis szablonu projektu indywidualnych kont</span><span class="sxs-lookup"><span data-stu-id="9e2cf-232">Understanding the Individual Accounts Project Template</span></span>

<span data-ttu-id="9e2cf-233">Po wybraniu **indywidualnych kont** w szablonie projektu aplikacji sieci Web ASP.NET, projekt obejmuje:</span><span class="sxs-lookup"><span data-stu-id="9e2cf-233">When you select **Individual Accounts** in the ASP.NET Web Application project template, the project includes:</span></span>

- <span data-ttu-id="9e2cf-234">OAuth2 serwera autoryzacji.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-234">An OAuth2 authorization server.</span></span>
- <span data-ttu-id="9e2cf-235">Punkt końcowy interfejsu API sieci Web do zarządzania kontami użytkowników</span><span class="sxs-lookup"><span data-stu-id="9e2cf-235">A Web API endpoint for managing user accounts</span></span>
- <span data-ttu-id="9e2cf-236">Modelu platformy EF do przechowywania kont użytkowników.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-236">An EF model for storing user accounts.</span></span>

<span data-ttu-id="9e2cf-237">Poniżej przedstawiono klasy głównej aplikacji, które implementują te funkcje:</span><span class="sxs-lookup"><span data-stu-id="9e2cf-237">Here are the main application classes that implement these features:</span></span>

- <span data-ttu-id="9e2cf-238">`AccountController`.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-238">`AccountController`.</span></span> <span data-ttu-id="9e2cf-239">Udostępnia punkt końcowy interfejsu API sieci Web do zarządzania kontami użytkowników.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-239">Provides a Web API endpoint for managing user accounts.</span></span> <span data-ttu-id="9e2cf-240">`Register` Akcja jest jedyną, która była używana w tym samouczku.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-240">The `Register` action is the only one that we used in this tutorial.</span></span> <span data-ttu-id="9e2cf-241">Inne metody w klasie obsługuje resetowania haseł, społecznościowych nazw logowania i inne funkcje.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-241">Other methods on the class support password reset, social logins, and other functionality.</span></span>
- <span data-ttu-id="9e2cf-242">`ApplicationUser`, zdefiniowane w /Models/IdentityModels.cs.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-242">`ApplicationUser`, defined in /Models/IdentityModels.cs.</span></span> <span data-ttu-id="9e2cf-243">Ta klasa jest modelu platformy EF dla kont użytkowników w bazie danych członkostwa.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-243">This class is the EF model for user accounts in the membership database.</span></span>
- <span data-ttu-id="9e2cf-244">`ApplicationUserManager`, zdefiniowane w App\_Start/IdentityConfig.cs ta klasa jest pochodną [Menedżera UserManager](https://msdn.microsoft.com/library/dn613290.aspx) i wykonuje operacje na kontach użytkowników, takich jak tworzenie nowego użytkownika, weryfikowanie, hasła i tak dalej i automatycznie będzie się powtarzać zmiany w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-244">`ApplicationUserManager`, defined in /App\_Start/IdentityConfig.cs This class derives from [UserManager](https://msdn.microsoft.com/library/dn613290.aspx) and performs operations on user accounts, such as creating a new user, verifying passwords, and so forth, and automatically persists changes to the database.</span></span>
- <span data-ttu-id="9e2cf-245">`ApplicationOAuthProvider`.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-245">`ApplicationOAuthProvider`.</span></span> <span data-ttu-id="9e2cf-246">Ten obiekt podłącza się do oprogramowania pośredniczącego OWIN i przetwarza zdarzenia wygenerowane przez oprogramowanie pośredniczące.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-246">This object plugs into the OWIN middleware, and processes events raised by the middleware.</span></span> <span data-ttu-id="9e2cf-247">Pochodzi od klasy [OAuthAuthorizationServerProvider](https://msdn.microsoft.com/library/microsoft.owin.security.oauth.oauthauthorizationserverprovider.aspx).</span><span class="sxs-lookup"><span data-stu-id="9e2cf-247">It derives from [OAuthAuthorizationServerProvider](https://msdn.microsoft.com/library/microsoft.owin.security.oauth.oauthauthorizationserverprovider.aspx).</span></span>

![](individual-accounts-in-web-api/_static/image14.png)

### <a name="configuring-the-authorization-server"></a><span data-ttu-id="9e2cf-248">Konfigurowanie serwera autoryzacji</span><span class="sxs-lookup"><span data-stu-id="9e2cf-248">Configuring the Authorization Server</span></span>

<span data-ttu-id="9e2cf-249">W StartupAuth.cs poniższy kod służy do konfigurowania OAuth2 serwera autoryzacji.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-249">In StartupAuth.cs, the following code configures the OAuth2 authorization server.</span></span>

[!code-csharp[Main](individual-accounts-in-web-api/samples/sample13.cs)]

<span data-ttu-id="9e2cf-250">`TokenEndpointPath` Właściwość jest ścieżka adresu URL punktu końcowego serwera autoryzacji.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-250">The `TokenEndpointPath` property is the URL path to the authorization server endpoint.</span></span> <span data-ttu-id="9e2cf-251">To adres URL tej aplikacji używa w celu uzyskania tokenów elementu nośnego.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-251">That's the URL that app uses to get the bearer tokens.</span></span>

<span data-ttu-id="9e2cf-252">`Provider` Właściwość określa dostawcę, który zapewnia Ci dostęp do oprogramowania pośredniczącego OWIN i przetwarza zdarzeń zgłaszanych przez oprogramowanie pośredniczące.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-252">The `Provider` property specifies a provider that plugs into the OWIN middleware, and processes events raised by the middleware.</span></span>

<span data-ttu-id="9e2cf-253">Poniżej przedstawiono podstawowy przepływ, gdy aplikacja chce uzyskać token:</span><span class="sxs-lookup"><span data-stu-id="9e2cf-253">Here is the basic flow when the app wants to get a token:</span></span>

1. <span data-ttu-id="9e2cf-254">Aby uzyskać token dostępu, aplikacja wysyła żądanie do ~ / Token.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-254">To get an access token, the app sends a request to ~/Token.</span></span>
2. <span data-ttu-id="9e2cf-255">Wywołuje oprogramowanie pośredniczące uwierzytelniania OAuth `GrantResourceOwnerCredentials` dla dostawcy.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-255">The OAuth middleware calls `GrantResourceOwnerCredentials` on the provider.</span></span>
3. <span data-ttu-id="9e2cf-256">Wywołania dostawcy `ApplicationUserManager` do sprawdzania poprawności poświadczeń i tworzyć tożsamość oświadczeń.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-256">The provider calls the `ApplicationUserManager` to validate the credentials and create a claims identity.</span></span>
4. <span data-ttu-id="9e2cf-257">Jeśli się to powiedzie, Dostawca tworzy bilet uwierzytelniania, który jest używany w celu wygenerowania tokenu.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-257">If that succeeds, the provider creates an authentication ticket, which is used to generate the token.</span></span>

[![](individual-accounts-in-web-api/_static/image16.png)](individual-accounts-in-web-api/_static/image15.png)

<span data-ttu-id="9e2cf-258">Oprogramowanie pośredniczące uwierzytelniania OAuth nie wiedzieli cokolwiek o kont użytkowników.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-258">The OAuth middleware doesn't know anything about the user accounts.</span></span> <span data-ttu-id="9e2cf-259">Dostawca komunikuje się między oprogramowanie pośredniczące i tożsamości ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-259">The provider communicates between the middleware and ASP.NET Identity.</span></span> <span data-ttu-id="9e2cf-260">Aby uzyskać więcej informacji na temat wdrażania serwera autoryzacji, zobacz [OWIN OAuth 2.0 autoryzacji serwera](../../../aspnet/overview/owin-and-katana/owin-oauth-20-authorization-server.md).</span><span class="sxs-lookup"><span data-stu-id="9e2cf-260">For more information about implementing the authorization server, see [OWIN OAuth 2.0 Authorization Server](../../../aspnet/overview/owin-and-katana/owin-oauth-20-authorization-server.md).</span></span>

### <a name="configuring-web-api-to-use-bearer-tokens"></a><span data-ttu-id="9e2cf-261">Konfigurowanie interfejsu API sieci Web za pomocą tokenów Bearer</span><span class="sxs-lookup"><span data-stu-id="9e2cf-261">Configuring Web API to use Bearer Tokens</span></span>

<span data-ttu-id="9e2cf-262">W `WebApiConfig.Register` metody, poniższy kod ustawia uwierzytelniania dla potok składnika Web API:</span><span class="sxs-lookup"><span data-stu-id="9e2cf-262">In the `WebApiConfig.Register` method, the following code sets up authentication for the Web API pipeline:</span></span>

[!code-csharp[Main](individual-accounts-in-web-api/samples/sample14.cs)]

<span data-ttu-id="9e2cf-263">**HostAuthenticationFilter** klasa umożliwia uwierzytelnianie za pomocą tokenów elementu nośnego.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-263">The **HostAuthenticationFilter** class enables authentication using bearer tokens.</span></span>

<span data-ttu-id="9e2cf-264">**SuppressDefaultHostAuthentication** metoda informuje interfejsu API sieci Web, aby zignorować wszelkie uwierzytelniania, który znajduje się przed żądanie osiąga potok składnika Web API, usług IIS lub oprogramowania pośredniczącego OWIN.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-264">The **SuppressDefaultHostAuthentication** method tells Web API to ignore any authentication that happens before the request reaches the Web API pipeline, either by IIS or by OWIN middleware.</span></span> <span data-ttu-id="9e2cf-265">Dzięki temu będziemy ograniczać interfejsu API sieci Web do uwierzytelniania tylko za pomocą tokenów elementu nośnego.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-265">That way, we can restrict Web API to authenticate only using bearer tokens.</span></span>

> [!NOTE]
> <span data-ttu-id="9e2cf-266">W szczególności MVC części aplikacji może użyć uwierzytelniania formularzy, w której są przechowywane poświadczenia w pliku cookie.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-266">In particular, the MVC portion of your app might use forms authentication, which stores credentials in a cookie.</span></span> <span data-ttu-id="9e2cf-267">Na podstawie plików cookie uwierzytelniania wymagane jest użycie tokenów zabezpieczających przed sfałszowaniem, aby zapobiec atakom CSRF.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-267">Cookie-based authentication requires the use of anti-forgery tokens, to prevent CSRF attacks.</span></span> <span data-ttu-id="9e2cf-268">To problemem w przypadku internetowych interfejsów API, ponieważ nie istnieje żadne wygodny sposób dla interfejsu API sieci web wysyła do klienta, token zabezpieczający przed sfałszowaniem.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-268">That's a problem for web APIs, because there is no convenient way for the web API to send the anti-forgery token to the client.</span></span> <span data-ttu-id="9e2cf-269">(Aby uzyskać więcej ogólnych informacji na ten problem, zobacz [zapobieganie atakom CSRF w interfejsie API sieci Web](preventing-cross-site-request-forgery-csrf-attacks.md).) Wywoływanie **SuppressDefaultHostAuthentication** gwarantuje, że interfejs API sieci Web nie jest narażony na ataki CSRF z poświadczeniami przechowywanymi w plikach cookie.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-269">(For more background on this issue, see [Preventing CSRF Attacks in Web API](preventing-cross-site-request-forgery-csrf-attacks.md).) Calling **SuppressDefaultHostAuthentication** ensures that Web API is not vulnerable to CSRF attacks from credentials stored in cookies.</span></span>


<span data-ttu-id="9e2cf-270">Gdy klient żąda zasobu chronionego, Oto, co się dzieje w potok składnika Web API:</span><span class="sxs-lookup"><span data-stu-id="9e2cf-270">When the client requests a protected resource, here is what happens in the Web API pipeline:</span></span>

1. <span data-ttu-id="9e2cf-271">**HostAuthentication** filtr wywołuje oprogramowanie pośredniczące uwierzytelniania OAuth, można zweryfikować tokenu.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-271">The **HostAuthentication** filter calls the OAuth middleware to validate the token.</span></span>
2. <span data-ttu-id="9e2cf-272">Oprogramowanie pośredniczące konwertuje token tożsamości oświadczeń.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-272">The middleware converts the token into a claims identity.</span></span>
3. <span data-ttu-id="9e2cf-273">W tym momencie żądania jest *uwierzytelniony* , ale nie *autoryzacji*.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-273">At this point, the request is *authenticated* but not *authorized*.</span></span>
4. <span data-ttu-id="9e2cf-274">Filtr autoryzacji sprawdza, czy tożsamość oświadczeń.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-274">The authorization filter examines the claims identity.</span></span> <span data-ttu-id="9e2cf-275">Jeśli oświadczenia autoryzacji użytkownika dla tego zasobu, żądanie jest autoryzowane.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-275">If the claims authorize the user for that resource, the request is authorized.</span></span> <span data-ttu-id="9e2cf-276">Domyślnie **[Authorize]** atrybut będzie autoryzować każde żądanie, które jest uwierzytelniony.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-276">By default, the **[Authorize]** attribute will authorize any request that is authenticated.</span></span> <span data-ttu-id="9e2cf-277">Jednak można autoryzować według roli lub inne oświadczenia.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-277">However, you can authorize by role or by other claims.</span></span> <span data-ttu-id="9e2cf-278">Aby uzyskać więcej informacji, zobacz [uwierzytelnianie i autoryzacja w interfejsie API sieci Web](authentication-and-authorization-in-aspnet-web-api.md).</span><span class="sxs-lookup"><span data-stu-id="9e2cf-278">For more information, see [Authentication and Authorization in Web API](authentication-and-authorization-in-aspnet-web-api.md).</span></span>
5. <span data-ttu-id="9e2cf-279">Jeśli powyższe czynności zakończą się powodzeniem, ten kontroler zwraca chronionego zasobu.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-279">If the previous steps are successful, the controller returns the protected resource.</span></span> <span data-ttu-id="9e2cf-280">W przeciwnym razie klient odbiera (błąd nieupoważnionego dostępu 401).</span><span class="sxs-lookup"><span data-stu-id="9e2cf-280">Otherwise, the client receives a 401 (Unauthorized) error.</span></span>

[![](individual-accounts-in-web-api/_static/image18.png)](individual-accounts-in-web-api/_static/image17.png)

## <a name="additional-resources"></a><span data-ttu-id="9e2cf-281">Dodatkowe zasoby</span><span class="sxs-lookup"><span data-stu-id="9e2cf-281">Additional Resources</span></span>

- [<span data-ttu-id="9e2cf-282">ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="9e2cf-282">ASP.NET Identity</span></span>](../../../identity/index.md)
- <span data-ttu-id="9e2cf-283">[Omówienie funkcji zabezpieczeń w szablonie SPA w wersji RC VS2013](https://blogs.msdn.com/b/webdev/archive/2013/09/20/understanding-security-features-in-spa-template.aspx).</span><span class="sxs-lookup"><span data-stu-id="9e2cf-283">[Understanding Security Features in the SPA Template for VS2013 RC](https://blogs.msdn.com/b/webdev/archive/2013/09/20/understanding-security-features-in-spa-template.aspx).</span></span> <span data-ttu-id="9e2cf-284">MSDN wpis w blogu przez Hongye Sun.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-284">MSDN blog post by Hongye Sun.</span></span>
- <span data-ttu-id="9e2cf-285">[Analiza sieci Web interfejsu API poszczególnych kont szablonu — część 2: Konta lokalne](http://leastprivilege.com/2013/11/26/dissecting-the-web-api-individual-accounts-templatepart-2-local-accounts/).</span><span class="sxs-lookup"><span data-stu-id="9e2cf-285">[Dissecting the Web API Individual Accounts Template–Part 2: Local Accounts](http://leastprivilege.com/2013/11/26/dissecting-the-web-api-individual-accounts-templatepart-2-local-accounts/).</span></span> <span data-ttu-id="9e2cf-286">Wpis na blogu autorstwa Dominick Baier.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-286">Blog post by Dominick Baier.</span></span>
- <span data-ttu-id="9e2cf-287">[Hostowanie uwierzytelniania i internetowego interfejsu API z OWIN](http://brockallen.com/2013/10/27/host-authentication-and-web-api-with-owin-and-active-vs-passive-authentication-middleware/).</span><span class="sxs-lookup"><span data-stu-id="9e2cf-287">[Host authentication and Web API with OWIN](http://brockallen.com/2013/10/27/host-authentication-and-web-api-with-owin-and-active-vs-passive-authentication-middleware/).</span></span> <span data-ttu-id="9e2cf-288">Dobry opis `SuppressDefaultHostAuthentication` i `HostAuthenticationFilter` przez firmy Brock Allen.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-288">A good explanation of `SuppressDefaultHostAuthentication` and `HostAuthenticationFilter` by Brock Allen.</span></span>
- <span data-ttu-id="9e2cf-289">[Dostosowywanie informacje o profilu w produkcie ASP.NET Identity w szablonach VS 2013](https://blogs.msdn.com/b/webdev/archive/2013/10/16/customizing-profile-information-in-asp-net-identity-in-vs-2013-templates.aspx).</span><span class="sxs-lookup"><span data-stu-id="9e2cf-289">[Customizing profile information in ASP.NET Identity in VS 2013 templates](https://blogs.msdn.com/b/webdev/archive/2013/10/16/customizing-profile-information-in-asp-net-identity-in-vs-2013-templates.aspx).</span></span> <span data-ttu-id="9e2cf-290">Wpis na blogu MSDN, autorem jest Pranav Rastogi.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-290">MSDN blog post by Pranav Rastogi.</span></span>
- <span data-ttu-id="9e2cf-291">[Na żądanie Zarządzanie okresem istnienia dla klasy interfejs UserManager w produkcie ASP.NET Identity](https://blogs.msdn.com/b/webdev/archive/2014/02/12/per-request-lifetime-management-for-usermanager-class-in-asp-net-identity.aspx).</span><span class="sxs-lookup"><span data-stu-id="9e2cf-291">[Per request lifetime management for UserManager class in ASP.NET Identity](https://blogs.msdn.com/b/webdev/archive/2014/02/12/per-request-lifetime-management-for-usermanager-class-in-asp-net-identity.aspx).</span></span> <span data-ttu-id="9e2cf-292">Wpis na blogu MSDN autorstwa Suhas Joshi z wyjaśnieniem dobre `UserManager` klasy.</span><span class="sxs-lookup"><span data-stu-id="9e2cf-292">MSDN blog post by Suhas Joshi, with a good explanation of the `UserManager` class.</span></span>
