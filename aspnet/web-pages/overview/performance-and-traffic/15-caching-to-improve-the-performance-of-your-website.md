---
uid: web-pages/overview/performance-and-traffic/15-caching-to-improve-the-performance-of-your-website
title: Buforowanie danych w witrynie ASP.NET Web Pages (Razor) w celu zapewnienia lepszej wydajności | Microsoft Docs
author: Rick-Anderson
description: Aby przyspieszyć swoją witrynę sieci Web, możesz ją przechowywać w pamięci podręcznej — czyli na podstawie danych, które zwykle zajmują dużo czasu na pobranie lub przetworzenie...
ms.author: riande
ms.date: 02/14/2014
ms.assetid: 961e525b-7700-469e-8a68-d7010b6fb68c
msc.legacyurl: /web-pages/overview/performance-and-traffic/15-caching-to-improve-the-performance-of-your-website
msc.type: authoredcontent
ms.openlocfilehash: 01796d3ca699a6af5d9162b22a926551435c2040
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 03/06/2020
ms.locfileid: "78641520"
---
# <a name="caching-data-in-an-aspnet-web-pages-razor-site-for-better-performance"></a><span data-ttu-id="b9a97-103">Buforowanie danych w witrynie ASP.NET Web Pages (Razor) w celu zapewnienia lepszej wydajności</span><span class="sxs-lookup"><span data-stu-id="b9a97-103">Caching Data in an ASP.NET Web Pages (Razor) Site for Better Performance</span></span>

<span data-ttu-id="b9a97-104">Autor [FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="b9a97-104">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

> <span data-ttu-id="b9a97-105">W tym artykule wyjaśniono, jak używać pomocnika do buforowania informacji w celu zwiększenia wydajności w witrynie internetowej ASP.NET Web Pages (Razor).</span><span class="sxs-lookup"><span data-stu-id="b9a97-105">This article explains how to use a helper to cache information for faster performance in an ASP.NET Web Pages (Razor) website.</span></span> <span data-ttu-id="b9a97-106">Aby przyspieszyć swoją witrynę sieci Web, Wystarczy przechowywać &#8212; ją w pamięci podręcznej &#8212; , co oznacza, że dane są zwykle czasochłonne w celu pobrania lub przetworzenia, a które nie zmieniają się często.</span><span class="sxs-lookup"><span data-stu-id="b9a97-106">You can speed up your website by having it store &#8212; that is, cache &#8212; the results of data that ordinarily would take considerable time to retrieve or process and that does not change often.</span></span>
> 
> <span data-ttu-id="b9a97-107">**Dowiesz się:**</span><span class="sxs-lookup"><span data-stu-id="b9a97-107">**What you'll learn:**</span></span> 
> 
> - <span data-ttu-id="b9a97-108">Jak używać buforowania, aby zwiększyć czas odpowiedzi witryny sieci Web.</span><span class="sxs-lookup"><span data-stu-id="b9a97-108">How to use caching to improve the responsiveness of your website.</span></span>
> 
> <span data-ttu-id="b9a97-109">Są to funkcje ASP.NET wprowadzone w artykule:</span><span class="sxs-lookup"><span data-stu-id="b9a97-109">These are the ASP.NET features introduced in the article:</span></span>
> 
> - <span data-ttu-id="b9a97-110">Pomocnik `WebCache`.</span><span class="sxs-lookup"><span data-stu-id="b9a97-110">The `WebCache` helper.</span></span>
>   
> 
> ## <a name="software-versions-used-in-the-tutorial"></a><span data-ttu-id="b9a97-111">Wersje oprogramowania używane w samouczku</span><span class="sxs-lookup"><span data-stu-id="b9a97-111">Software versions used in the tutorial</span></span>
> 
> 
> - <span data-ttu-id="b9a97-112">ASP.NET strony sieci Web (Razor) 3</span><span class="sxs-lookup"><span data-stu-id="b9a97-112">ASP.NET Web Pages (Razor) 3</span></span>
>   
> 
> <span data-ttu-id="b9a97-113">Ten samouczek działa również z ASP.NET Web Pages 2.</span><span class="sxs-lookup"><span data-stu-id="b9a97-113">This tutorial also works with ASP.NET Web Pages 2.</span></span>

<span data-ttu-id="b9a97-114">Za każdym razem, gdy ktoś żąda strony z witryny, serwer sieci Web musi wykonać pewne czynności w celu spełnienia żądania.</span><span class="sxs-lookup"><span data-stu-id="b9a97-114">Every time someone requests a page from your site, the web server has to do some work in order to fulfill the request.</span></span> <span data-ttu-id="b9a97-115">W przypadku niektórych stron serwer może potrzebować wykonać zadania, które pomogą (w sposób porównawczy), takie jak pobieranie danych z bazy danych.</span><span class="sxs-lookup"><span data-stu-id="b9a97-115">For some of your pages, the server might have to perform tasks that take a (comparatively) long time, such as retrieving data from a database.</span></span> <span data-ttu-id="b9a97-116">Nawet jeśli te zadania nie zajmują dużo czasu, w przypadku, gdy witryna zajmuje dużo ruchu, cała seria indywidualnych żądań, które powodują, że serwer sieci Web do wykonywania skomplikowanych lub wolnych zadań może dodawać do dużo pracy.</span><span class="sxs-lookup"><span data-stu-id="b9a97-116">Even if these tasks don't take long in absolute terms, if your site experiences a lot of traffic, a whole series of individual requests that cause the web server to perform the complicated or slow task can add up to a lot of work.</span></span> <span data-ttu-id="b9a97-117">Może to ostatecznie mieć wpływ na wydajność lokacji.</span><span class="sxs-lookup"><span data-stu-id="b9a97-117">This can ultimately affect the performance of the site.</span></span>

<span data-ttu-id="b9a97-118">Jednym ze sposobów na zwiększenie wydajności witryny sieci Web w takich okolicznościach jest buforowanie danych.</span><span class="sxs-lookup"><span data-stu-id="b9a97-118">One way to improve the performance of your website in circumstances like this is to cache data.</span></span> <span data-ttu-id="b9a97-119">Jeśli witryna uzyskuje powtórzone żądania dla tych samych informacji, a informacje nie muszą być modyfikowane dla każdej osoby i nie są zależne od czasu, a nie do ponownego pobrania lub ponownej obliczeń, można pobrać dane jeden raz, a następnie zapisać wyniki.</span><span class="sxs-lookup"><span data-stu-id="b9a97-119">If your site gets repeated requests for the same information, and the information does not need to be modified for each person, and it's not time sensitive, instead of re-fetching or recalculating it, you can fetch the data once and then store the results.</span></span> <span data-ttu-id="b9a97-120">Następnym razem, gdy żądanie dotyczy tych informacji, wystarczy pobrać je z pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="b9a97-120">The next time a request comes in for that information, you just get it out of the cache.</span></span>

<span data-ttu-id="b9a97-121">Ogólnie rzecz biorąc, informacje o pamięci podręcznej, które nie zmieniają się często.</span><span class="sxs-lookup"><span data-stu-id="b9a97-121">In general, you cache information that doesn't change frequently.</span></span> <span data-ttu-id="b9a97-122">Gdy umieszczasz informacje w pamięci podręcznej, są one przechowywane w pamięci na serwerze sieci Web.</span><span class="sxs-lookup"><span data-stu-id="b9a97-122">When you put information in the cache, it's stored in memory on the web server.</span></span> <span data-ttu-id="b9a97-123">Możesz określić, jak długo powinna być buforowana, od sekund do dni.</span><span class="sxs-lookup"><span data-stu-id="b9a97-123">You can specify how long it should be cached, from seconds to days.</span></span> <span data-ttu-id="b9a97-124">Po upływie okresu buforowania informacje są automatycznie usuwane z pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="b9a97-124">When the caching period expires, the information is automatically removed from the cache.</span></span>

> [!NOTE]
> <span data-ttu-id="b9a97-125">Wpisy w pamięci podręcznej mogą zostać usunięte ze względu na to, że wygasły.</span><span class="sxs-lookup"><span data-stu-id="b9a97-125">Entries in the cache might be removed for reasons other than that they've expired.</span></span> <span data-ttu-id="b9a97-126">Na przykład serwer sieci Web może tymczasowo uruchamiać małą ilość pamięci, a jednym ze sposobów odzyskiwania pamięci jest wyrzucanie wpisów z pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="b9a97-126">For example, the web server might temporarily run low on memory, and one way it can reclaim memory is by throwing entries out of the cache.</span></span> <span data-ttu-id="b9a97-127">Jak widać, nawet jeśli informacje są umieszczane w pamięci podręcznej, należy upewnić się, że są nadal dostępne, gdy ich potrzebujesz.</span><span class="sxs-lookup"><span data-stu-id="b9a97-127">As you'll see, even if you've put information into the cache, you have to check to be sure it's still there when you need it.</span></span>

<span data-ttu-id="b9a97-128">Wyobraź sobie, że witryna sieci Web zawiera stronę wyświetlającą bieżącą temperaturę i prognozę pogody.</span><span class="sxs-lookup"><span data-stu-id="b9a97-128">Imagine your website has a page that displays the current temperature and weather forecast.</span></span> <span data-ttu-id="b9a97-129">Aby uzyskać informacje o tym typie, można wysłać żądanie do usługi zewnętrznej.</span><span class="sxs-lookup"><span data-stu-id="b9a97-129">To get this type of information, you might send a request to an external service.</span></span> <span data-ttu-id="b9a97-130">Ponieważ te informacje nie zmieniają się znacznie (na przykład w okresie dwóch godzin), ponieważ wywołania zewnętrzne wymagają czasu i przepustowości, jest to dobry kandydat do buforowania.</span><span class="sxs-lookup"><span data-stu-id="b9a97-130">Since this information doesn't change much (within a two-hour time period, for example) and since external calls require time and bandwidth, it's a good candidate for caching.</span></span>

## <a name="adding-caching-to-a-page"></a><span data-ttu-id="b9a97-131">Dodawanie buforowania do strony</span><span class="sxs-lookup"><span data-stu-id="b9a97-131">Adding Caching to a Page</span></span>

<span data-ttu-id="b9a97-132">ASP.NET zawiera pomocnika `WebCache`, który ułatwia dodawanie buforowania do lokacji i Dodawanie danych do pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="b9a97-132">ASP.NET includes a `WebCache` helper that makes it easy to add caching to your site and add data to the cache.</span></span> <span data-ttu-id="b9a97-133">W tej procedurze utworzysz stronę, która przechowuje w pamięci podręcznej bieżącą godzinę.</span><span class="sxs-lookup"><span data-stu-id="b9a97-133">In this procedure, you'll create a page that caches the current time.</span></span> <span data-ttu-id="b9a97-134">To nie jest rzeczywisty przykład, ponieważ bieżący czas to coś, co często zmienia się, a co nie jest skomplikowane do obliczenia.</span><span class="sxs-lookup"><span data-stu-id="b9a97-134">This isn't a real-world example, since the current time is something that does change often, and that moreover isn't complex to calculate.</span></span> <span data-ttu-id="b9a97-135">Jednak jest dobrym sposobem zilustrowania buforowania w działaniu.</span><span class="sxs-lookup"><span data-stu-id="b9a97-135">However, it's a good way to illustrate caching in action.</span></span>

1. <span data-ttu-id="b9a97-136">Dodaj nową stronę o nazwie *webcache. cshtml* do witryny sieci Web.</span><span class="sxs-lookup"><span data-stu-id="b9a97-136">Add a new page named *WebCache.cshtml* to the website.</span></span>
2. <span data-ttu-id="b9a97-137">Dodaj następujący kod i znaczniki do strony:</span><span class="sxs-lookup"><span data-stu-id="b9a97-137">Add the following code and markup to the page:</span></span>

    [!code-cshtml[Main](15-caching-to-improve-the-performance-of-your-website/samples/sample1.cshtml)]

    <span data-ttu-id="b9a97-138">Podczas buforowania danych należy umieścić je w pamięci podręcznej przy użyciu nazwy, która jest unikatowa w całej witrynie sieci Web.</span><span class="sxs-lookup"><span data-stu-id="b9a97-138">When you cache data, you put it into the cache using a name this is unique across the website.</span></span> <span data-ttu-id="b9a97-139">W takim przypadku należy użyć wpisu pamięci podręcznej o nazwie `CachedTime`.</span><span class="sxs-lookup"><span data-stu-id="b9a97-139">In this case, you'll use a cache entry named `CachedTime`.</span></span> <span data-ttu-id="b9a97-140">Jest to `cacheItemKey` pokazano w przykładzie kodu.</span><span class="sxs-lookup"><span data-stu-id="b9a97-140">This is the `cacheItemKey` shown in the code example.</span></span>

    <span data-ttu-id="b9a97-141">Kod najpierw odczytuje wpis pamięci podręcznej `CachedTime`.</span><span class="sxs-lookup"><span data-stu-id="b9a97-141">The code first reads the `CachedTime` cache entry.</span></span> <span data-ttu-id="b9a97-142">Jeśli zwracana jest wartość (to oznacza, że jeśli wpis pamięci podręcznej nie ma wartości null), kod ustawia wartość zmiennej czasowej na dane pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="b9a97-142">If a value is returned (that is, if the cache entry isn't null), the code just sets the value of the time variable to the cache data.</span></span>

    <span data-ttu-id="b9a97-143">Jeśli jednak wpis pamięci podręcznej nie istnieje (oznacza to, że ma wartość null), kod ustawia wartość czasu, dodaje ją do pamięci podręcznej i ustawia wartość wygaśnięcia na jedną minutę.</span><span class="sxs-lookup"><span data-stu-id="b9a97-143">However, if the cache entry doesn't exist (that is, it's null), the code sets the time value, adds it to the cache, and sets an expiration value to one minute.</span></span> <span data-ttu-id="b9a97-144">Po upływie jednej minuty wpis pamięci podręcznej zostanie odrzucony.</span><span class="sxs-lookup"><span data-stu-id="b9a97-144">After one minute, the cache entry is discarded.</span></span> <span data-ttu-id="b9a97-145">(Domyślna wartość wygaśnięcia dla elementu w pamięci podręcznej to 20 minut). Polecenie `WebCache.Set(cacheItemKey, time, 1, false)` pokazuje, jak dodać bieżącą wartość czasu do pamięci podręcznej i ustawić jej wygaśnięcie na 1 minutę.</span><span class="sxs-lookup"><span data-stu-id="b9a97-145">(The default expiration value for an item in the cache is 20 minutes.) The command `WebCache.Set(cacheItemKey, time, 1, false)` shows how to add the current time value to the cache and set its expiration to 1 minute.</span></span> <span data-ttu-id="b9a97-146">Ustawienie parametru *slidingExpiration* na `false` oznacza, że czas wygaśnięcia nie jest odnawiany przy każdym żądaniu żądania.</span><span class="sxs-lookup"><span data-stu-id="b9a97-146">Setting the *slidingExpiration* parameter to `false` means the expiration time is not renewed each time it is requested.</span></span> <span data-ttu-id="b9a97-147">Po jego pierwotnym dodaniu do pamięci podręcznej wygaśnie dokładnie 1 minutę.</span><span class="sxs-lookup"><span data-stu-id="b9a97-147">It will expire exactly 1 minute after it was originally added to the cache.</span></span> <span data-ttu-id="b9a97-148">Jeśli ta wartość zostanie ustawiona na `true` czas wygaśnięcia 1 minuty zostanie zresetowany za każdym razem, gdy wartość zostanie zażądana z pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="b9a97-148">If you set this value to `true` the 1 minute expiration time is reset each time the value is requested from the cache.</span></span>

    <span data-ttu-id="b9a97-149">Ten kod ilustruje wzorzec, który powinien być zawsze używany podczas buforowania danych.</span><span class="sxs-lookup"><span data-stu-id="b9a97-149">This code illustrates the pattern you should always use when you cache data.</span></span> <span data-ttu-id="b9a97-150">Przed uzyskaniem czegoś z pamięci podręcznej należy zawsze najpierw sprawdzić, czy metoda `WebCache.Get` zwróciła wartość null.</span><span class="sxs-lookup"><span data-stu-id="b9a97-150">Before you get something out of the cache, always check first whether the `WebCache.Get` method has returned null.</span></span> <span data-ttu-id="b9a97-151">Należy pamiętać, że wpis pamięci podręcznej mógł wygasnąć lub mógł zostać usunięty z jakiegoś innego powodu, więc każdy podaną pozycję nigdy nie będzie w pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="b9a97-151">Remember that the cache entry might have expired or might have been removed for some other reason, so any given entry is never guaranteed to be in the cache.</span></span>
3. <span data-ttu-id="b9a97-152">Uruchom w przeglądarce element *webcache. cshtml* .</span><span class="sxs-lookup"><span data-stu-id="b9a97-152">Run *WebCache.cshtml* in a browser.</span></span> <span data-ttu-id="b9a97-153">(Upewnij się, że strona została wybrana w obszarze roboczym **pliki** przed jej uruchomieniem). Podczas pierwszego żądania strony dane czasu nie znajdują się w pamięci podręcznej, a kod musi dodać wartość czasu do pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="b9a97-153">(Make sure the page is selected in the **Files** workspace before you run it.) The first time you request the page, the time data isn't in the cache, and the code has to add the time value to the cache.</span></span>

    ![pamięć podręczna 1](15-caching-to-improve-the-performance-of-your-website/_static/image1.jpg)
4. <span data-ttu-id="b9a97-155">Odśwież w przeglądarce *webcache. cshtml* .</span><span class="sxs-lookup"><span data-stu-id="b9a97-155">Refresh *WebCache.cshtml* in the browser.</span></span> <span data-ttu-id="b9a97-156">Tym razem dane czasu są w pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="b9a97-156">This time, the time data is in the cache.</span></span> <span data-ttu-id="b9a97-157">Zauważ, że czas nie został zmieniony od czasu ostatniego wyświetlenia strony.</span><span class="sxs-lookup"><span data-stu-id="b9a97-157">Notice that the time hasn't changed since the last time you viewed the page.</span></span>

    ![pamięć podręczna 2](15-caching-to-improve-the-performance-of-your-website/_static/image2.jpg)
5. <span data-ttu-id="b9a97-159">Odczekaj jedną minutę, aby opróżnić pamięć podręczną, a następnie Odśwież stronę.</span><span class="sxs-lookup"><span data-stu-id="b9a97-159">Wait one minute for the cache to be emptied, and then refresh the page.</span></span> <span data-ttu-id="b9a97-160">Strona ponownie wskazuje, że dane czasu nie zostały odnalezione w pamięci podręcznej, a zaktualizowany czas został dodany do pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="b9a97-160">The page again indicates that the time data wasn't found in the cache, and the updated time is added to the cache.</span></span>

<a id="Additional_Resources"></a>
## <a name="additional-resources"></a><span data-ttu-id="b9a97-161">Dodatkowe materiały</span><span class="sxs-lookup"><span data-stu-id="b9a97-161">Additional Resources</span></span>

- [<span data-ttu-id="b9a97-162">Wyświetlanie danych na wykresie</span><span class="sxs-lookup"><span data-stu-id="b9a97-162">Displaying Data in a Chart</span></span>](https://go.microsoft.com/fwlink/?LinkId=202895)
- <span data-ttu-id="b9a97-163">[Dokumentacja interfejsu API webcache](https://msdn.microsoft.com/library/system.web.helpers.webcache(v=vs.99).aspx) (MSDN)</span><span class="sxs-lookup"><span data-stu-id="b9a97-163">[WebCache API reference](https://msdn.microsoft.com/library/system.web.helpers.webcache(v=vs.99).aspx) (MSDN)</span></span>
