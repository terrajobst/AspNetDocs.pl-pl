---
uid: identity/overview/getting-started/developing-aspnet-apps-with-windows-azure-active-directory
title: Opracowywanie aplikacji ASP.NET przy użyciu Azure Active Directory-ASP.NET 4. x
author: Rick-Anderson
description: Microsoft ASP.NET narzędzia dla Azure Active Directory ułatwiają uwierzytelnianie aplikacji sieci Web hostowanych na platformie Azure. Możesz użyć usługi Azure wstępnego...
ms.author: riande
ms.date: 08/14/2014
ms.assetid: 457d7eaf-ee76-4ceb-9082-c7c1721435ad
ms.custom: seoapril2019
msc.legacyurl: /identity/overview/getting-started/developing-aspnet-apps-with-windows-azure-active-directory
msc.type: authoredcontent
ms.openlocfilehash: 28425ea8d1312dfc6e14df9677396f2cbcf6f16d
ms.sourcegitcommit: 7709c0a091b8d55b7b33bad8849f7b66b23c3d72
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 02/19/2020
ms.locfileid: "77456728"
---
# <a name="developing-aspnet-apps-with-azure-active-directory"></a><span data-ttu-id="34186-104">Tworzenie aplikacji ASP.NET z wykorzystaniem usługi Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="34186-104">Developing ASP.NET Apps with Azure Active Directory</span></span>

<span data-ttu-id="34186-105">Autor [Rick Anderson](https://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="34186-105">by [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

<span data-ttu-id="34186-106">Microsoft ASP.NET narzędzia dla Azure Active Directory upraszczają Włączanie uwierzytelniania dla aplikacji sieci Web hostowanych na [platformie Azure](https://www.windowsazure.com/home/features/web-sites/).</span><span class="sxs-lookup"><span data-stu-id="34186-106">Microsoft ASP.NET tools for Azure Active Directory simplifies enabling authentication for web apps hosted on [Azure](https://www.windowsazure.com/home/features/web-sites/).</span></span> <span data-ttu-id="34186-107">Za pomocą uwierzytelniania platformy Azure można uwierzytelniać użytkowników pakietu Office 365 w organizacji, konta firmowe synchronizowane z lokalnymi Active Directory lub użytkownikami utworzonymi w niestandardowej domenie Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="34186-107">You can use Azure Authentication to authenticate Office 365 users from your organization, corporate accounts synced from your on-premise Active Directory or users created in your own custom Azure Active Directory domain.</span></span> <span data-ttu-id="34186-108">Włączenie uwierzytelniania systemu Windows Azure umożliwia skonfigurowanie aplikacji do uwierzytelniania użytkowników przy użyciu jednej dzierżawy [Azure Active Directory](https://docs.microsoft.com/azure/active-directory/) .</span><span class="sxs-lookup"><span data-stu-id="34186-108">Enabling Windows Azure Authentication configures your application to authenticate users using a single [Azure Active Directory](https://docs.microsoft.com/azure/active-directory/) tenant.</span></span>

<span data-ttu-id="34186-109">W tym samouczku pokazano, jak utworzyć aplikację ASP.NET, która jest skonfigurowana do logowania za pomocą usługi [Azure Active Directory](https://msdn.microsoft.com/library/azure/mt168838.aspx) (Azure AD).</span><span class="sxs-lookup"><span data-stu-id="34186-109">This tutorial will show you how to create an ASP.NET application that is configured for sign-on with [Azure Active Directory](https://msdn.microsoft.com/library/azure/mt168838.aspx) (Azure AD).</span></span> <span data-ttu-id="34186-110">Dowiesz się również, jak wywoływać interfejs API programu Graph, aby uzyskać informacje o aktualnie zalogowanym użytkowniku oraz o sposobie wdrażania aplikacji na platformie Azure.</span><span class="sxs-lookup"><span data-stu-id="34186-110">You will also learn how to call the Graph API to get information about the currently signed-in user and how to deploy the application to Azure.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="34186-111">Wymagania wstępne</span><span class="sxs-lookup"><span data-stu-id="34186-111">Prerequisites</span></span>

1. <span data-ttu-id="34186-112">[Visual Studio Express 2013 dla sieci Web](https://my.visualstudio.com/Downloads?q=visual%20studio%202013#d-2013-express) lub [Visual Studio 2013](https://my.visualstudio.com/Downloads?q=visual%20studio%202013).</span><span class="sxs-lookup"><span data-stu-id="34186-112">[Visual Studio Express 2013 for Web](https://my.visualstudio.com/Downloads?q=visual%20studio%202013#d-2013-express) or [Visual Studio 2013](https://my.visualstudio.com/Downloads?q=visual%20studio%202013).</span></span>
2. <span data-ttu-id="34186-113">[Visual Studio 2013 Update 4](https://www.microsoft.com/download/details.aspx?id=44921) — wymagana jest aktualizacja Update 3 lub nowsza.</span><span class="sxs-lookup"><span data-stu-id="34186-113">[Visual Studio 2013 Update 4](https://www.microsoft.com/download/details.aspx?id=44921) - Update 3 or higher is required.</span></span>
3. <span data-ttu-id="34186-114">Konto platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="34186-114">An Azure account.</span></span> <span data-ttu-id="34186-115">[Kliknij tutaj](https://azure.microsoft.com/pricing/free-trial/) , aby uzyskać bezpłatną wersję próbną, jeśli jeszcze nie masz konta.</span><span class="sxs-lookup"><span data-stu-id="34186-115">[Click here](https://azure.microsoft.com/pricing/free-trial/) for a free trial if you do not already have an account.</span></span>

## <a name="add-a-global-administrator-to-your-active-directory"></a><span data-ttu-id="34186-116">Dodawanie administratora globalnego do Active Directory</span><span class="sxs-lookup"><span data-stu-id="34186-116">Add a Global Administrator to your Active Directory</span></span>

1. <span data-ttu-id="34186-117">Zaloguj się do [Portal zarządzania platformy Azure](https://manage.windowsazure.com/).</span><span class="sxs-lookup"><span data-stu-id="34186-117">Sign in to the [Azure Management Portal](https://manage.windowsazure.com/).</span></span>
2. <span data-ttu-id="34186-118">Wszystkie konta platformy Azure zawierają **katalog domyślny** — kliknij go, a następnie kliknij kartę **Users (Użytkownicy** ) w górnej części strony (zobacz poniższy obraz).</span><span class="sxs-lookup"><span data-stu-id="34186-118">All Azure accounts contain a **Default Directory** -- click on it, then click the **Users** tab at the top of the page (see image below).</span></span>
3. <span data-ttu-id="34186-119">Kliknij pozycję Dodaj użytkownika.</span><span class="sxs-lookup"><span data-stu-id="34186-119">Click Add User.</span></span>
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image1.png)
4. <span data-ttu-id="34186-120">Utwórz nowego użytkownika z rolą **administratora globalnego** .</span><span class="sxs-lookup"><span data-stu-id="34186-120">Create a new user with the **Global Administrator** role.</span></span> <span data-ttu-id="34186-121">Kliknij pozycję **Użytkownicy** w górnym menu, a następnie kliknij przycisk **Dodaj użytkownika** na pasku poleceń.</span><span class="sxs-lookup"><span data-stu-id="34186-121">Click **Users** from the top menu, and then click the **Add User** button on the command bar.</span></span>
5. <span data-ttu-id="34186-122">W oknie dialogowym **Dodawanie użytkownika** wprowadź nazwę nowego użytkownika, a następnie kliknij strzałkę w prawo.</span><span class="sxs-lookup"><span data-stu-id="34186-122">In the **Add User** dialog, enter a name for the new user and then click the right arrow.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image2.png)
6. <span data-ttu-id="34186-123">Wprowadź nazwę użytkownika i Ustaw rolę na **administratora globalnego**.</span><span class="sxs-lookup"><span data-stu-id="34186-123">Enter the user name and set the role to **Global Administrator**.</span></span> <span data-ttu-id="34186-124">Administratorzy globalni wymagają alternatywnego adresu e-mail na potrzeby odzyskiwania hasła.</span><span class="sxs-lookup"><span data-stu-id="34186-124">Global administrators require an alternate email address for password recovery purposes.</span></span> <span data-ttu-id="34186-125">Po zakończeniu kliknij strzałkę w prawo.</span><span class="sxs-lookup"><span data-stu-id="34186-125">After you're finished, click the right arrow.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image3.png)
7. <span data-ttu-id="34186-126">Na następnej stronie okna dialogowego kliknij pozycję **Utwórz**.</span><span class="sxs-lookup"><span data-stu-id="34186-126">On the next page of the dialog, click **Create**.</span></span> <span data-ttu-id="34186-127">Dla nowego użytkownika zostanie utworzone hasło tymczasowe, które zostanie wyświetlone w oknie dialogowym.</span><span class="sxs-lookup"><span data-stu-id="34186-127">A temporary password will be created for the new user and displayed in the dialog.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image4.png)

   <span data-ttu-id="34186-128">Zapisz hasło, musisz zmienić hasło po pierwszym zalogowaniu się.</span><span class="sxs-lookup"><span data-stu-id="34186-128">Save the password, you will be required to change the password after the first log in.</span></span> <span data-ttu-id="34186-129">Na poniższej ilustracji przedstawiono nowe konto administratora.</span><span class="sxs-lookup"><span data-stu-id="34186-129">The following image shows the new admin account.</span></span> <span data-ttu-id="34186-130">Musisz użyć Azure Active Directory, aby zalogować się do aplikacji, a nie konto Microsoft również na tej stronie.</span><span class="sxs-lookup"><span data-stu-id="34186-130">You must use the Azure Active Directory to log into your app, not the Microsoft account also shown on this page.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image5.png)

## <a name="create-an-aspnet-application"></a><span data-ttu-id="34186-131">Tworzenie aplikacji ASP.NET</span><span class="sxs-lookup"><span data-stu-id="34186-131">Create an ASP.NET Application</span></span>

<span data-ttu-id="34186-132">Poniższe kroki używają [Visual Studio Express 2013 dla sieci Web](https://www.microsoft.com/download/details.aspx?id=40747)i wymagają [aktualizacji Visual Studio 2013 Update 3](https://www.microsoft.com/download/details.aspx?id=43721).</span><span class="sxs-lookup"><span data-stu-id="34186-132">The following steps use [Visual Studio Express 2013 for Web](https://www.microsoft.com/download/details.aspx?id=40747), and requires [Visual Studio 2013 Update 3](https://www.microsoft.com/download/details.aspx?id=43721).</span></span>

1. <span data-ttu-id="34186-133">W programie Visual Studio kliknij polecenie **plik** , a następnie pozycję **Nowy projekt**.</span><span class="sxs-lookup"><span data-stu-id="34186-133">In Visual Studio, click **File** and then **New Project**.</span></span> <span data-ttu-id="34186-134">W oknie dialogowym **Nowy projekt** wybierz projekt Visual C# Web Project z menu po lewej stronie, a następnie kliknij przycisk **OK**.</span><span class="sxs-lookup"><span data-stu-id="34186-134">On the **New Project** dialog, select the Visual C# Web project from the left menu and click **OK**.</span></span> <span data-ttu-id="34186-135">Można również usunąć zaznaczenie pola wyboru **dodaj Application Insights do projektu** , jeśli nie chcesz, aby funkcja aplikacji była jeszcze niedostępna.</span><span class="sxs-lookup"><span data-stu-id="34186-135">You may also want to uncheck the **Add Application Insights to Project** if you don't want the functionality for your application.</span></span>
2. <span data-ttu-id="34186-136">W oknie dialogowym **Nowy projekt ASP.NET** wybierz pozycję **MVC**, a następnie kliknij pozycję **Zmień uwierzytelnianie**.</span><span class="sxs-lookup"><span data-stu-id="34186-136">In the **New ASP.NET Project** dialog, select **MVC**, and then click **Change Authentication**.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image6.png)
3. <span data-ttu-id="34186-137">W oknie dialogowym **Zmienianie uwierzytelniania** wybierz pozycję **konta organizacyjne**.</span><span class="sxs-lookup"><span data-stu-id="34186-137">On the **Change Authentication** dialog, select **Organizational Accounts**.</span></span> <span data-ttu-id="34186-138">Przy użyciu tych opcji można automatycznie zarejestrować aplikację w usłudze Azure AD, a także automatycznie skonfigurować aplikację do integracji z usługą Azure AD.</span><span class="sxs-lookup"><span data-stu-id="34186-138">These options can be used to automatically register your application with Azure AD as well as automatically configure your application to integrate with Azure AD.</span></span> <span data-ttu-id="34186-139">Nie trzeba używać okna dialogowego **Zmienianie uwierzytelniania** w celu zarejestrowania i skonfigurowania aplikacji, ale jest to znacznie prostsze.</span><span class="sxs-lookup"><span data-stu-id="34186-139">You don't have to use the **Change Authentication** dialog to register and configure your application, but it makes it much easier.</span></span> <span data-ttu-id="34186-140">Jeśli na przykład używasz programu Visual Studio 2012, możesz nadal ręcznie zarejestrować aplikację w usłudze Azure portal zarządzania i zaktualizować jej konfigurację, aby zintegrować ją z usługą Azure AD.</span><span class="sxs-lookup"><span data-stu-id="34186-140">If you are using Visual Studio 2012 for example, you can still manually register the application in the Azure Management Portal and update its configuration to integrate with Azure AD.</span></span>
   <span data-ttu-id="34186-141">Z menu rozwijanego wybierz kolejno pozycje **organizacja** i logowanie jednokrotne **, Odczytaj dane katalogu**.</span><span class="sxs-lookup"><span data-stu-id="34186-141">In the drop-down menus, select **Cloud - Single Organization** and **Single Sign On, Read directory data**.</span></span> <span data-ttu-id="34186-142">Wprowadź domenę dla katalogu usługi Azure AD, na przykład (w poniższych obrazach) *aricka0yahoo.onmicrosoft.com*, a następnie kliknij przycisk **OK**.</span><span class="sxs-lookup"><span data-stu-id="34186-142">Enter the domain for your Azure AD directory, for example (in the images below) *aricka0yahoo.onmicrosoft.com*, and then click **OK**.</span></span> <span data-ttu-id="34186-143">Możesz uzyskać nazwę domeny z karty domeny dla katalogu domyślnego w witrynie Azure Portal (Zobacz następny obraz w dół).</span><span class="sxs-lookup"><span data-stu-id="34186-143">You can get the domain name from the Domains tab for the Default Directory on the azure portal (see the next image down).</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image7.png)

   <span data-ttu-id="34186-144">Na poniższej ilustracji przedstawiono nazwę domeny z Azure Portal.</span><span class="sxs-lookup"><span data-stu-id="34186-144">The following image shows the domain name from the Azure portal.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image8.png)

    > [!NOTE]
    > <span data-ttu-id="34186-145">Opcjonalnie możesz skonfigurować identyfikator URI aplikacji, który zostanie zarejestrowany w usłudze Azure AD, klikając pozycję **więcej opcji**.</span><span class="sxs-lookup"><span data-stu-id="34186-145">You can optionally configure the Application ID URI that will be registered in Azure AD by clicking **More Options**.</span></span> <span data-ttu-id="34186-146">Identyfikator URI aplikacji jest unikatowym identyfikatorem dla aplikacji, która jest zarejestrowana w usłudze Azure AD i używana przez aplikację do identyfikacji w przypadku komunikacji z usługą Azure AD.</span><span class="sxs-lookup"><span data-stu-id="34186-146">The App ID URI is the unique identifier for an application, which is registered in Azure AD and used by the application to identify itself when communicating with Azure AD.</span></span> <span data-ttu-id="34186-147">Aby uzyskać więcej informacji o IDENTYFIKATORze URI aplikacji i innych właściwościach zarejestrowanych aplikacji, zobacz [ten temat](https://msdn.microsoft.com/library/azure/dn499820.aspx#BKMK_Registering).</span><span class="sxs-lookup"><span data-stu-id="34186-147">For more information about the App ID URI and other properties of registered applications, see [this topic](https://msdn.microsoft.com/library/azure/dn499820.aspx#BKMK_Registering).</span></span> <span data-ttu-id="34186-148">Klikając pole wyboru poniżej pola Identyfikator URI aplikacji, możesz również zastąpić istniejącą rejestrację w usłudze Azure AD, która korzysta z tego samego identyfikatora URI aplikacji.</span><span class="sxs-lookup"><span data-stu-id="34186-148">By clicking the checkbox below the App ID URI field, you can also choose to overwrite an existing registration in Azure AD that uses the same App ID URI.</span></span>
4. <span data-ttu-id="34186-149">Po kliknięciu przycisku **OK**zostanie wyświetlone okno dialogowe logowania i będzie konieczne zalogowanie się przy użyciu konta administratora globalnego (nie konto Microsoft skojarzonego z subskrypcją).</span><span class="sxs-lookup"><span data-stu-id="34186-149">After clicking **OK**, a sign-in dialog will appear, and you'll need to sign in using a Global Administrator account (not the Microsoft account associated with your subscription).</span></span> <span data-ttu-id="34186-150">Jeśli nowe konto administratora zostało wcześniej utworzone, należy zmienić hasło, a następnie ponownie zalogować się przy użyciu nowego hasła.</span><span class="sxs-lookup"><span data-stu-id="34186-150">If you created a new Administrator account earlier, you'll be required to change the password and then sign in again using the new password.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image9.png)
5. <span data-ttu-id="34186-151">Po pomyślnym uwierzytelnieniu w oknie dialogowym **Nowy projekt ASP.NET** zostanie wyświetlona opcja uwierzytelniania (**organizacja** ) i katalog, w którym zostanie zarejestrowana nowa aplikacja (*aricka0yahoo.onmicrosoft.com* na poniższej ilustracji).</span><span class="sxs-lookup"><span data-stu-id="34186-151">After you've successfully authenticated, the **New ASP.NET Project** dialog will show your authentication choice (**Organizational** ) and the directory where the new application will be registered (*aricka0yahoo.onmicrosoft.com* in the image below).</span></span> <span data-ttu-id="34186-152">Poniżej tych informacji zaznacz pole wyboru etykieta **hosta w chmurze**.</span><span class="sxs-lookup"><span data-stu-id="34186-152">Below this information, select the checkbox labeled **Host in the cloud**.</span></span> <span data-ttu-id="34186-153">Jeśli to pole wyboru jest zaznaczone, projekt zostanie zainicjowany jako aplikacja internetowa platformy Azure i będzie można go później łatwo opublikować.</span><span class="sxs-lookup"><span data-stu-id="34186-153">If this checkbox is selected, the project will be provisioned as an Azure web app and will be enabled for easy publishing later.</span></span> <span data-ttu-id="34186-154">Kliknij przycisk **OK**.</span><span class="sxs-lookup"><span data-stu-id="34186-154">Click **OK**.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image10.png)
6. <span data-ttu-id="34186-155">Zostanie wyświetlone okno dialogowe **Konfigurowanie witryny sieci Web platformy Azure** z automatycznie wygenerowaną nazwą i regionem witryny.</span><span class="sxs-lookup"><span data-stu-id="34186-155">The **Configure Azure Website** dialog will appear, using an auto-generated site name and region.</span></span> <span data-ttu-id="34186-156">Zwróć uwagę na to, że konto, na którym się zalogowano, znajduje się w oknie dialogowym.</span><span class="sxs-lookup"><span data-stu-id="34186-156">Also note the account you're currently signed into in the dialog.</span></span> <span data-ttu-id="34186-157">Aby upewnić się, że to konto jest dołączone do subskrypcji platformy Azure, zwykle jest to konto Microsoft.</span><span class="sxs-lookup"><span data-stu-id="34186-157">You want to make sure that this account is the one that your Azure subscription is attached to, typically a Microsoft account.</span></span>

    > [!NOTE]
    > <span data-ttu-id="34186-158">Ten projekt wymaga bazy danych.</span><span class="sxs-lookup"><span data-stu-id="34186-158">This project requires a database.</span></span> <span data-ttu-id="34186-159">Musisz wybrać jedną z istniejących baz danych lub utworzyć nową.</span><span class="sxs-lookup"><span data-stu-id="34186-159">You need to select one of your existing databases, or create a new one.</span></span> <span data-ttu-id="34186-160">Baza danych jest wymagana, ponieważ projekt używa już lokalnego pliku bazy danych do przechowywania niewielkiej ilości danych konfiguracji uwierzytelniania.</span><span class="sxs-lookup"><span data-stu-id="34186-160">A database is required because the project already uses a local database file to store a small amount of authentication configuration data.</span></span> <span data-ttu-id="34186-161">Podczas wdrażania aplikacji w witrynie sieci Web platformy Azure ta baza danych nie jest spakowana we wdrożeniu, dlatego należy wybrać jedną z dostępnych w chmurze.</span><span class="sxs-lookup"><span data-stu-id="34186-161">When you deploy the application to an Azure Website, this database isn't packaged with the deployment, so you need to choose one that's accessible in the cloud.</span></span> <span data-ttu-id="34186-162">Kliknij przycisk **OK**.</span><span class="sxs-lookup"><span data-stu-id="34186-162">Click **OK**.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image11.png)
7. <span data-ttu-id="34186-163">Projekt zostanie utworzony, a opcje uwierzytelniania i opcje aplikacji sieci Web zostaną automatycznie skonfigurowane przy użyciu projektu.</span><span class="sxs-lookup"><span data-stu-id="34186-163">The project will be created, and your authentication options and web app options will be automatically configured with the project.</span></span> <span data-ttu-id="34186-164">Po zakończeniu tego procesu Uruchom projekt lokalnie, naciskając klawisz **^ F5**.</span><span class="sxs-lookup"><span data-stu-id="34186-164">Once this process has completed, run the project locally by pressing **^F5**.</span></span> <span data-ttu-id="34186-165">Konieczne będzie zalogowanie się przy użyciu konta organizacyjnego.</span><span class="sxs-lookup"><span data-stu-id="34186-165">You will be required to sign in using your organizational account.</span></span> <span data-ttu-id="34186-166">Podaj nazwę użytkownika i hasło dla utworzonego wcześniej konta, a następnie kliknij przycisk **Zaloguj**.</span><span class="sxs-lookup"><span data-stu-id="34186-166">Provide the username and password for the account you created earlier and click **Sign in**.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image12.png)
8. <span data-ttu-id="34186-167">Po pomyślnym zalogowaniu się w witrynie ASP.NET zostanie wyświetlona nazwa użytkownika w prawym górnym rogu strony.</span><span class="sxs-lookup"><span data-stu-id="34186-167">After successful sign in, the ASP.NET site will show that you've authenticated by displaying the username in the top right corner of the page.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image13.png)

   <span data-ttu-id="34186-168">Jeśli wystąpi błąd: wartość nie może mieć wartości null ani być pusta.</span><span class="sxs-lookup"><span data-stu-id="34186-168">If you get the error: Value cannot be null or empty.</span></span> <span data-ttu-id="34186-169">Nazwa parametru: linkText ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image14.png)</span><span class="sxs-lookup"><span data-stu-id="34186-169">Parameter name: linkText ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image14.png)</span></span>

   <span data-ttu-id="34186-170">Zapoznaj się z sekcją [debugowanie](#dbg) na końcu tego samouczka.</span><span class="sxs-lookup"><span data-stu-id="34186-170">see the [debug](#dbg) section at the end of the tutorial.</span></span>

## <a name="basics-of-the-graph-api"></a><span data-ttu-id="34186-171">Podstawy interfejs API programu Graph</span><span class="sxs-lookup"><span data-stu-id="34186-171">Basics of the Graph API</span></span>

<span data-ttu-id="34186-172">[Interfejs API programu Graph](https://msdn.microsoft.com/library/azure/hh974476.aspx) jest interfejs programistyczny używany do wykonywania CRUD i innych operacji na obiektach w katalogu usługi Azure AD.</span><span class="sxs-lookup"><span data-stu-id="34186-172">[The Graph API](https://msdn.microsoft.com/library/azure/hh974476.aspx) is the programmatic interface used to perform CRUD and other operations on objects in your Azure AD directory.</span></span> <span data-ttu-id="34186-173">W przypadku wybrania opcji konta organizacyjnego do uwierzytelniania podczas tworzenia nowego projektu w Visual Studio 2013 aplikacja zostanie już skonfigurowana do wywoływania interfejs API programu Graph.</span><span class="sxs-lookup"><span data-stu-id="34186-173">If you select an Organizational Account option for authentication when creating a new project in Visual Studio 2013, your application will already be configured to call the Graph API.</span></span> <span data-ttu-id="34186-174">W tej sekcji krótko opisano, jak działa interfejs API programu Graph.</span><span class="sxs-lookup"><span data-stu-id="34186-174">This section briefly shows you how the Graph API works.</span></span>

1. <span data-ttu-id="34186-175">W uruchomionej aplikacji kliknij nazwę zalogowanego użytkownika w prawym górnym rogu strony.</span><span class="sxs-lookup"><span data-stu-id="34186-175">In your running application, click on the name of the signed-in user at the top right of the page.</span></span> <span data-ttu-id="34186-176">Spowoduje to przejście do strony profilu użytkownika, która jest akcją na kontrolerze głównym.</span><span class="sxs-lookup"><span data-stu-id="34186-176">This will take you to the User Profile page, which is an action on the Home Controller.</span></span> <span data-ttu-id="34186-177">Należy zauważyć, że tabela zawiera informacje o użytkowniku utworzone wcześniej.</span><span class="sxs-lookup"><span data-stu-id="34186-177">You'll notice that the table contains user information about the administrator account you created earlier.</span></span> <span data-ttu-id="34186-178">Te informacje są przechowywane w katalogu, a interfejs API programu Graph jest wywoływana, aby pobrać te informacje podczas ładowania strony.</span><span class="sxs-lookup"><span data-stu-id="34186-178">This information is stored in your directory, and the Graph API is called to retrieve this information when the page loads.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image15.png)
2. <span data-ttu-id="34186-179">Wróć do programu Visual Studio i rozwiń folder **controllers** , a następnie otwórz plik **HomeController.cs** .</span><span class="sxs-lookup"><span data-stu-id="34186-179">Go back to Visual Studio and expand the **Controllers** folder and then open the **HomeController.cs** file.</span></span> <span data-ttu-id="34186-180">Zobaczysz akcję **USERPROFILE ()** , która zawiera kod umożliwiający pobranie tokenu, a następnie wywołaj interfejs API programu Graph.</span><span class="sxs-lookup"><span data-stu-id="34186-180">You'll see a **UserProfile()** action that contains code to retrieve a token and then call the Graph API.</span></span> <span data-ttu-id="34186-181">Ten kod jest zduplikowany poniżej:</span><span class="sxs-lookup"><span data-stu-id="34186-181">This code is duplicated below:</span></span>

    [!code-csharp[Main](developing-aspnet-apps-with-windows-azure-active-directory/samples/sample1.cs?highlight=22)]

    <span data-ttu-id="34186-182">Aby wywołać interfejs API programu Graph, musisz najpierw pobrać token.</span><span class="sxs-lookup"><span data-stu-id="34186-182">To call the Graph API, you first need to retrieve a token.</span></span> <span data-ttu-id="34186-183">Po pobraniu tokenu jego wartość ciągu musi być dołączona do nagłówka autoryzacji dla wszystkich kolejnych żądań do interfejs API programu Graph.</span><span class="sxs-lookup"><span data-stu-id="34186-183">When the token is retrieved, its string value must be appended in the Authorization header for all subsequent requests to the Graph API.</span></span> <span data-ttu-id="34186-184">Większość powyższych kodów obsługuje szczegóły uwierzytelniania w usłudze Azure AD w celu uzyskania tokenu, przy użyciu tokenu do wywołania interfejs API programu Graph, a następnie przekształcenia odpowiedzi w taki sposób, aby mogła być wyświetlana w widoku.</span><span class="sxs-lookup"><span data-stu-id="34186-184">Most of the code above handles the details of authenticating to Azure AD to get a token, using the token to make a call to the Graph API, and then transforming the response so that it can be presented in the View.</span></span>

    <span data-ttu-id="34186-185">Najbardziej istotną częścią dyskusji jest następujący wyróżniony wiersz: `UserProfile profile = JsonConvert.DeserializeObject<UserProfile>(responseString);`.</span><span class="sxs-lookup"><span data-stu-id="34186-185">The most relevant portion for discussion is the following highlighted line: `UserProfile profile = JsonConvert.DeserializeObject<UserProfile>(responseString);`.</span></span> <span data-ttu-id="34186-186">Ten wiersz reprezentuje nazwę użytkownika, który został przeszeregowany z odpowiedzi JSON i jest prezentowany w widoku.</span><span class="sxs-lookup"><span data-stu-id="34186-186">This line represents the name of the user, which has been deserialized from the JSON response and is presented in the View.</span></span>

    <span data-ttu-id="34186-187">Możesz wywoływać interfejs API programu Graph przy użyciu HttpClient i obsłużyć dane pierwotne, ale łatwiejszym sposobem jest użycie [biblioteki klienta programu Graph, która jest dostępna za pośrednictwem narzędzia NuGet](http://www.nuget.org/packages/Microsoft.Azure.ActiveDirectory.GraphClient/).</span><span class="sxs-lookup"><span data-stu-id="34186-187">You can call the Graph API using HttpClient and handle the raw data yourself, but an easier way is to use the [Graph Client Library which is available via NuGet](http://www.nuget.org/packages/Microsoft.Azure.ActiveDirectory.GraphClient/).</span></span> <span data-ttu-id="34186-188">Biblioteka klienta obsługuje nieprzetworzone żądania HTTP i transformację zwracanych danych, a znacznie ułatwia pracę z interfejs API programu Graph w środowisku .NET.</span><span class="sxs-lookup"><span data-stu-id="34186-188">The Client Library handles the raw HTTP requests and the transformation of the returned data for you, and makes it much easier to work with the Graph API in a .NET environment.</span></span> <span data-ttu-id="34186-189">Zobacz przykłady kodu powiązanego interfejs API programu Graph w witrynie [GitHub.](https://github.com/AzureADSamples)</span><span class="sxs-lookup"><span data-stu-id="34186-189">See the related Graph API code samples on [GitHub.](https://github.com/AzureADSamples)</span></span>

## <a name="deploy-the-application-to-azure"></a><span data-ttu-id="34186-190">Wdrażanie aplikacji na platformie Azure</span><span class="sxs-lookup"><span data-stu-id="34186-190">Deploy the Application to Azure</span></span>

<span data-ttu-id="34186-191">Poniższe kroki pokazują, jak wdrożyć aplikację na platformie Azure.</span><span class="sxs-lookup"><span data-stu-id="34186-191">The following steps will show you how to deploy the application to Azure.</span></span> <span data-ttu-id="34186-192">We wcześniejszych krokach został połączony nowy projekt z aplikacją sieci Web na platformie Azure, dzięki czemu można go opublikować w zaledwie kilku krokach.</span><span class="sxs-lookup"><span data-stu-id="34186-192">In the earlier steps, you connected your new project with a web app on Azure, so it's ready to be published in just a few steps.</span></span>

1. <span data-ttu-id="34186-193">W programie Visual Studio kliknij prawym przyciskiem myszy projekt i wybierz polecenie **Publikuj**.</span><span class="sxs-lookup"><span data-stu-id="34186-193">In Visual Studio, right-click on the project and select **Publish**.</span></span> <span data-ttu-id="34186-194">Zostanie wyświetlone okno dialogowe **Publikowanie w sieci Web** z każdym skonfigurowanym już ustawieniem.</span><span class="sxs-lookup"><span data-stu-id="34186-194">The **Publish Web** dialog will appear with each setting already configured.</span></span> <span data-ttu-id="34186-195">Kliknij przycisk **dalej** , aby przejść do strony **ustawień** .</span><span class="sxs-lookup"><span data-stu-id="34186-195">Click on the **Next** button to go to the **Settings** page.</span></span> <span data-ttu-id="34186-196">Może zostać wyświetlony monit o uwierzytelnienie; Upewnij się, że uwierzytelniasz się przy użyciu konta subskrypcji platformy Azure (zwykle konto Microsoft), a nie konta organizacji utworzonego wcześniej.</span><span class="sxs-lookup"><span data-stu-id="34186-196">You may be prompted to authenticate; make sure you authenticate using your Azure subscription account (typically a Microsoft account) and not the organizational account you created earlier.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image16.png)
2. <span data-ttu-id="34186-197">Zaznacz opcję **Włącz uwierzytelnianie organizacyjne** .</span><span class="sxs-lookup"><span data-stu-id="34186-197">Check the **Enable Organizational Authentication** option.</span></span> <span data-ttu-id="34186-198">W polu **domena** wprowadź domenę dla katalogu.</span><span class="sxs-lookup"><span data-stu-id="34186-198">In the **Domain** field, enter the domain for your directory.</span></span> <span data-ttu-id="34186-199">Z listy rozwijanej **poziom dostępu** wybierz pozycję Logowanie jednokrotne **, Odczytaj dane katalogu**.</span><span class="sxs-lookup"><span data-stu-id="34186-199">From the **Access Level** drop-down, select **Single Sign On, Read directory data**.</span></span> <span data-ttu-id="34186-200">Zobaczysz, że poprzednia baza danych została już wypełniona w sekcji **bazy danych** .</span><span class="sxs-lookup"><span data-stu-id="34186-200">You'll notice that the previous database you used is already populated in the **Databases** section.</span></span> <span data-ttu-id="34186-201">Kliknij przycisk **Opublikuj**.</span><span class="sxs-lookup"><span data-stu-id="34186-201">Click **Publish**.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image17.png)
3. <span data-ttu-id="34186-202">Program Visual Studio rozpocznie wdrażanie witryny sieci Web, a następnie zostanie wyświetlone nowe okno przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="34186-202">Visual Studio will begin deploying your website, and then a new browser window will appear.</span></span> <span data-ttu-id="34186-203">Może zostać wyświetlony monit o ponowne uwierzytelnienie w katalogu.</span><span class="sxs-lookup"><span data-stu-id="34186-203">You may be prompted to authenticate to your directory once again.</span></span> <span data-ttu-id="34186-204">Po uwierzytelnieniu nastąpi przekierowanie do nowo opublikowanej witryny sieci Web na platformie Azure.</span><span class="sxs-lookup"><span data-stu-id="34186-204">Once you've authenticated, you'll be redirected to your newly published website on Azure.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image18.png)

<a id="dbg"></a>
## <a name="debugging-the-app"></a><span data-ttu-id="34186-205">Debugowanie aplikacji</span><span class="sxs-lookup"><span data-stu-id="34186-205">Debugging the app</span></span>

<span data-ttu-id="34186-206">Jeśli zostanie wyświetlony następujący błąd: wartość nie może mieć wartości null ani być pusta.</span><span class="sxs-lookup"><span data-stu-id="34186-206">If you get the following error: Value cannot be null or empty.</span></span> <span data-ttu-id="34186-207">Nazwa parametru: linkText</span><span class="sxs-lookup"><span data-stu-id="34186-207">Parameter name: linkText</span></span>

![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image19.png)

<span data-ttu-id="34186-208">Zastąp kod w pliku *Views\Shared\\_LoginPartial. cshtml* następującym:</span><span class="sxs-lookup"><span data-stu-id="34186-208">Replace the code in the *Views\Shared\\_LoginPartial.cshtml* file with the following:</span></span>

[!code-cshtml[Main](developing-aspnet-apps-with-windows-azure-active-directory/samples/sample2.cshtml?highlight=1-8,15-16)]

<span data-ttu-id="34186-209">Po uruchomieniu aplikacji, Jeśli zalogowany użytkownik pokazuje "użytkownika o wartości null", Wyloguj się i zaloguj się ponownie przy użyciu utworzonego wcześniej konta Active Directory.</span><span class="sxs-lookup"><span data-stu-id="34186-209">After running the app, if the logged in user shows "Null User", sign out, and sign back in with the Active Directory account you created earlier.</span></span>

<span data-ttu-id="34186-210">Doskonałym samouczkiem, które należy wykonać, jest Rick Rainey [szczegółowe: Azure Websites i uwierzytelnianie organizacyjne przy użyciu usługi Azure AD](http://rickrainey.com/2014/08/19/deep-dive-azure-websites-and-organizational-authentication-using-azure-ad/).</span><span class="sxs-lookup"><span data-stu-id="34186-210">An excellent tutorial to follow is Rick Rainey's [Deep Dive: Azure Websites and Organizational Authentication using Azure AD](http://rickrainey.com/2014/08/19/deep-dive-azure-websites-and-organizational-authentication-using-azure-ad/).</span></span>

## <a name="more-information"></a><span data-ttu-id="34186-211">Więcej informacji</span><span class="sxs-lookup"><span data-stu-id="34186-211">More Information</span></span>

- [<span data-ttu-id="34186-212">Głębokie szczegółowe: usługi Azure Websites i uwierzytelnianie organizacyjne przy użyciu usługi Azure AD</span><span class="sxs-lookup"><span data-stu-id="34186-212">Deep Dive: Azure Websites and Organizational Authentication using Azure AD</span></span>](http://rickrainey.com/2014/08/19/deep-dive-azure-websites-and-organizational-authentication-using-azure-ad/)
- [<span data-ttu-id="34186-213">Omówienie usługi Azure AD interfejs API programu Graph</span><span class="sxs-lookup"><span data-stu-id="34186-213">Azure AD Graph API Overview</span></span>](https://msdn.microsoft.com/library/azure/hh974476.aspx)
- [<span data-ttu-id="34186-214">Scenariusze uwierzytelniania w usłudze Azure AD</span><span class="sxs-lookup"><span data-stu-id="34186-214">Authentication Scenarios in Azure AD</span></span>](https://msdn.microsoft.com/library/azure/dn499820.aspx)
- [<span data-ttu-id="34186-215">Przykłady kodu usługi Azure AD w witrynie GitHub</span><span class="sxs-lookup"><span data-stu-id="34186-215">Azure AD Code Samples on GitHub</span></span>](https://github.com/AzureADSamples)
