---
uid: identity/overview/migrations/migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity
title: Migrowanie danych uniwersalnego dostawcy dotyczących członkostwa i profilów użytkowników do produktu ASP.NET Identity (C#) — ASP.NET 4.x
author: rustd
description: W tym samouczku opisano kroki, które są niezbędne przeprowadzić migrację użytkowników i dane roli i danych profilów użytkowników utworzone przy użyciu dostawców uniwersalnych z istniejącej aplikacji...
ms.author: riande
ms.date: 12/13/2013
ms.custom: seoapril2019
ms.assetid: 2e260430-d13c-4658-bd05-e256fc0d63b8
msc.legacyurl: /identity/overview/migrations/migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity
msc.type: authoredcontent
ms.openlocfilehash: de154dde122886976054159ad745982669ca9315
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 05/06/2019
ms.locfileid: "65121385"
---
# <a name="migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity-c"></a><span data-ttu-id="b7bbf-103">Migrowanie danych uniwersalnego dostawcy dotyczących członkostwa i profilów użytkowników do systemu ASP.NET Identity (C#)</span><span class="sxs-lookup"><span data-stu-id="b7bbf-103">Migrating Universal Provider Data for Membership and User Profiles to ASP.NET Identity (C#)</span></span>

<span data-ttu-id="b7bbf-104">przez [autorem jest Pranav Rastogi](https://github.com/rustd), [Rick Anderson]((https://twitter.com/RickAndMSFT)), [Robert McMurray](https://github.com/rmcmurray), [Suhas Joshi](https://github.com/suhasj)</span><span class="sxs-lookup"><span data-stu-id="b7bbf-104">by [Pranav Rastogi](https://github.com/rustd), [Rick Anderson]((https://twitter.com/RickAndMSFT)), [Robert McMurray](https://github.com/rmcmurray), [Suhas Joshi](https://github.com/suhasj)</span></span>

> <span data-ttu-id="b7bbf-105">W tym samouczku opisano kroki, które są niezbędne przeprowadzić migrację użytkowników i dane roli i danych profilów użytkowników utworzone przy użyciu dostawców uniwersalnych istniejącej aplikacji do modelu tożsamości ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-105">This tutorial describes the steps that are necessary to migrate user and role data and user profile data created using Universal Providers of an existing application to the ASP.NET Identity model.</span></span> <span data-ttu-id="b7bbf-106">Podejście wspomnianych tutaj, aby przeprowadzić migrację danych profilu użytkownika mogą być używane w aplikacji przy użyciu członkostwa SQL, jak również.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-106">The approach mentioned here to migrate user profile data can be used in an application with SQL membership as well.</span></span>

<span data-ttu-id="b7bbf-107">Wraz z wydaniem programu Visual Studio 2013, zespół programu ASP.NET wprowadzono nowy system tożsamości ASP.NET, i możesz dowiedzieć się więcej o tej wersji [tutaj](../../index.md).</span><span class="sxs-lookup"><span data-stu-id="b7bbf-107">With the release of Visual Studio 2013, the ASP.NET team introduced a new ASP.NET Identity system, and you can read more about that release [here](../../index.md).</span></span> <span data-ttu-id="b7bbf-108">Po tego artykułu, aby przeprowadzić migrację aplikacji sieci web z [członkostwa SQL do nowego systemu tożsamości](migrating-an-existing-website-from-sql-membership-to-aspnet-identity.md), w tym artykule przedstawiono kroki, aby migrować istniejące aplikacje, które należy wykonać model dostawców dla użytkownika i roli zarządzania do nowego modelu tożsamości.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-108">Following up on the article to migrate web applications from [SQL Membership to the new Identity system](migrating-an-existing-website-from-sql-membership-to-aspnet-identity.md), this article illustrates the steps to migrate existing applications that follow the Providers model for user and role management to the new Identity model.</span></span> <span data-ttu-id="b7bbf-109">Celem tego samouczka będą się głównie na temat migracji danych profilu użytkownika, aby bezproblemowo podłączyć ją do nowego systemu.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-109">The focus of this tutorial will be primarily on migrating the user profile data to seamlessly hook it into the new system.</span></span> <span data-ttu-id="b7bbf-110">Migrowanie informacji o użytkowniku i roli jest podobny do członkostwa SQL.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-110">Migrating user and role information is similar for SQL membership.</span></span> <span data-ttu-id="b7bbf-111">Podejście do migracji danych profilu może służyć w aplikacji za pomocą także członkostwa SQL.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-111">The approach followed to migrate profile data can be used in an application with SQL membership as well.</span></span>

<span data-ttu-id="b7bbf-112">Na przykład Zaczniemy z aplikacją sieci web utworzonych za pomocą programu Visual Studio 2012, który używa modelu dostawców.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-112">As an example, we will start with a web app created using Visual Studio 2012 which uses the Providers model.</span></span> <span data-ttu-id="b7bbf-113">Firma Microsoft będzie, a następnie dodać kod do zarządzania profilami, zarejestruj użytkownika, dodać dane profilowe dla użytkowników, migrować schemat bazy danych, a następnie zmień aplikacji do systemu tożsamości użytkownika i roli zarządzania.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-113">We'll then add code for profile management, register a user, add profile data for the users, migrate the database schema, and then change the application to use the Identity system for user and role management.</span></span> <span data-ttu-id="b7bbf-114">Jako test migracji użytkownicy utworzeni za pomocą dostawców uniwersalnych powinien móc zalogować się i nowych użytkowników powinny mieć możliwość rejestrowania.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-114">As a test of migration, users created using Universal Providers should be able to log in and new users should be able to register.</span></span>

> [!NOTE]
> <span data-ttu-id="b7bbf-115">Możesz znaleźć pełny przykład o [ https://github.com/suhasj/UniversalProviders-Identity-Migrations ](https://github.com/suhasj/UniversalProviders-Identity-Migrations).</span><span class="sxs-lookup"><span data-stu-id="b7bbf-115">You can find the complete sample at [https://github.com/suhasj/UniversalProviders-Identity-Migrations](https://github.com/suhasj/UniversalProviders-Identity-Migrations).</span></span>

## <a name="profile-data-migration-summary"></a><span data-ttu-id="b7bbf-116">Podsumowanie migracji danych profilu</span><span class="sxs-lookup"><span data-stu-id="b7bbf-116">Profile data migration summary</span></span>

<span data-ttu-id="b7bbf-117">Przed rozpoczęciem z migracje, Przyjrzyjmy się środowisko przechowywania danych profilu w dostawcy modelu.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-117">Before starting with the migrations, let us look at the experience of storing profile data in the Providers model.</span></span> <span data-ttu-id="b7bbf-118">Dane profilu dla aplikacji, które użytkownicy mogą być przechowywane na wiele sposobów, najczęściej występujące między nimi są przy użyciu dostawców wbudowanych profilu dostarczany wraz z dostawców uniwersalnych.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-118">Profile data for application users can be stored in multiple ways, the most common among them being using the inbuilt profile providers shipped along with the Universal Providers.</span></span> <span data-ttu-id="b7bbf-119">Obejmuje kroki</span><span class="sxs-lookup"><span data-stu-id="b7bbf-119">The steps would include</span></span>

1. <span data-ttu-id="b7bbf-120">Dodaj klasę, która ma właściwości, używany do przechowywania danych profilu.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-120">Add a class that has properties used to store Profile data.</span></span>
2. <span data-ttu-id="b7bbf-121">Dodaj klasę, która rozszerza "ProfileBase" i implementuje metody w celu uzyskania powyższe dane profilu dla użytkownika.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-121">Add a class that extends 'ProfileBase' and implements methods to get the above profile data for the user.</span></span>
3. <span data-ttu-id="b7bbf-122">Włącz przy użyciu domyślnych dostawców profilu w *web.config* plików i definiowania klasy zadeklarowanej w kroku 2 # ma być używany podczas uzyskiwania dostępu do informacji o profilu.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-122">Enable using default profile providers in the *web.config* file and define the class declared in step #2 to be used in accessing profile information.</span></span>

<span data-ttu-id="b7bbf-123">Informacje o profilu są przechowywane jako serializacji xml i danych binarnych w tabeli "Profile" w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-123">The profile information is stored as serialized xml and binary data in the 'Profiles' table in the database.</span></span>

<span data-ttu-id="b7bbf-124">Po przeprowadzeniu migracji aplikacji do korzystania z nowego systemu tożsamości ASP.NET, informacje o profilu jest przeprowadzona i przechowywane jako właściwości klasy użytkownika.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-124">After migrating the application to use the new ASP.NET Identity system, the profile information is deserialized and stored as properties on the user class.</span></span> <span data-ttu-id="b7bbf-125">Każda właściwość następnie mogą być mapowane na kolumny w tabeli użytkownika.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-125">Each property can then be mapped onto columns in the user table.</span></span> <span data-ttu-id="b7bbf-126">Korzyści, w tym miejscu jest, że właściwości mogą pracować na bezpośrednio przy użyciu klasy użytkownika oprócz nie ma potrzeby serializowania/deserializowania danych informacji czas podczas dostępu do niego.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-126">The advantage here is that the properties can be worked on directly using the user class in addition to not having to serialize/deserialize data information each time when accessing it.</span></span>

## <a name="getting-started"></a><span data-ttu-id="b7bbf-127">Wprowadzenie</span><span class="sxs-lookup"><span data-stu-id="b7bbf-127">Getting Started</span></span>

1. <span data-ttu-id="b7bbf-128">Utwórz nową aplikację ASP.NET 4.5 Web Forms w programie Visual Studio 2012.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-128">Create a new ASP.NET 4.5 Web Forms application in Visual Studio 2012.</span></span> <span data-ttu-id="b7bbf-129">Bieżąca przykładowa używa szablonu formularzy sieci Web, ale można również użyć aplikacji MVC.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-129">The current sample uses the Web Forms template, but you could use MVC Application as well.</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image1.jpg)
2. <span data-ttu-id="b7bbf-130">Utwórz nowy folder modeli, do przechowywania informacji o profilu</span><span class="sxs-lookup"><span data-stu-id="b7bbf-130">Create a new folder 'Models' to store profile information</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image1.png)
3. <span data-ttu-id="b7bbf-131">Na przykład przechowywać Daj nam daty urodzenia, Miasto, wysokość i wagi użytkownika w profilu.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-131">As an example, let us store the date of birth, city, height and weight of the user in profile.</span></span> <span data-ttu-id="b7bbf-132">Wysokość i wagi są przechowywane jako klasa niestandardowa o nazwie "PersonalStats".</span><span class="sxs-lookup"><span data-stu-id="b7bbf-132">The height and weight are stored as a custom class called 'PersonalStats'.</span></span> <span data-ttu-id="b7bbf-133">Do przechowywania i pobierania profilu, potrzebujemy klasę, która rozszerza "ProfileBase".</span><span class="sxs-lookup"><span data-stu-id="b7bbf-133">To store and retrieve the profile, we need a class that extends 'ProfileBase'.</span></span> <span data-ttu-id="b7bbf-134">Utwórz nową klasę "AppProfile", aby pobrać i zapisać informacje o profilu.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-134">Let's create a new class 'AppProfile' to get and store profile information.</span></span>

    [!code-csharp[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample1.cs)]
4. <span data-ttu-id="b7bbf-135">Włącz profil w *web.config* pliku.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-135">Enable profile in the *web.config* file.</span></span> <span data-ttu-id="b7bbf-136">Wprowadź nazwę klasy, która ma być używany do przechowywania/pobierania informacji o użytkowniku, utworzonego w kroku #3.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-136">Enter the class name to be used to store/retrieve user information created in step #3.</span></span>

    [!code-xml[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample2.xml)]
5. <span data-ttu-id="b7bbf-137">Dodaj strony formularzy sieci web w folderze "Konto", aby pobrać dane profilu użytkownika i zapisz go.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-137">Add a web forms page in 'Account' folder to get the profile data from the user and store it.</span></span> <span data-ttu-id="b7bbf-138">Kliknij prawym przyciskiem myszy projekt i wybierz pozycję "Dodaj nowy element".</span><span class="sxs-lookup"><span data-stu-id="b7bbf-138">Right click on project and select 'Add new Item'.</span></span> <span data-ttu-id="b7bbf-139">Dodawanie nowej strony formularzy sieci Web za pomocą strony wzorcowej "AddProfileData.aspx".</span><span class="sxs-lookup"><span data-stu-id="b7bbf-139">Add a new webforms page with master page 'AddProfileData.aspx'.</span></span> <span data-ttu-id="b7bbf-140">W sekcji "MainContent", należy skopiować następujące czynności:</span><span class="sxs-lookup"><span data-stu-id="b7bbf-140">Copy the following in the 'MainContent' section:</span></span>

    [!code-html[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample3.html)]

   <span data-ttu-id="b7bbf-141">Dodaj następujący kod w kodzie:</span><span class="sxs-lookup"><span data-stu-id="b7bbf-141">Add the following code in the code behind:</span></span>

    [!code-csharp[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample4.cs)]

   <span data-ttu-id="b7bbf-142">Dodaj przestrzeń nazw, w ramach której AppProfile klasa jest zdefiniowana, aby usunąć błędy kompilacji.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-142">Add the namespace under which AppProfile class is defined to remove the compilation errors.</span></span>
6. <span data-ttu-id="b7bbf-143">Uruchom aplikację i Utwórz nowego użytkownika przy użyciu nazwy użytkownika "**użytkownika olduser".**</span><span class="sxs-lookup"><span data-stu-id="b7bbf-143">Run the app and create a new user with username '**olduser'.**</span></span> <span data-ttu-id="b7bbf-144">Przejdź do strony "AddProfileData" i Dodaj informacje o profilu użytkownika.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-144">Navigate to the 'AddProfileData' page and add profile information for the user.</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image2.png)

<span data-ttu-id="b7bbf-145">Aby sprawdzić, czy dane są przechowywane jako serializacji xml w tabeli "Profile" w oknie Eksploratora serwera.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-145">You can verify that the data is stored as serialized xml in the 'Profiles' table using the Server Explorer window.</span></span> <span data-ttu-id="b7bbf-146">W programie Visual Studio z menu "Widok" Wybierz "Eksploratora serwera".</span><span class="sxs-lookup"><span data-stu-id="b7bbf-146">In Visual Studio, from 'View' menu, choose 'Server Explorer'.</span></span> <span data-ttu-id="b7bbf-147">Powinna istnieć połączenie danych dla bazy danych zdefiniowanych w *web.config* pliku.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-147">There should be a data connection for the database defined in the *web.config* file.</span></span> <span data-ttu-id="b7bbf-148">Kliknięcie na połączenie danych pokazuje pod różnych kategorii.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-148">Clicking on the data connection shows different sub categories.</span></span> <span data-ttu-id="b7bbf-149">Rozwiń węzeł "Tabele", aby pokazać różnych tabel w bazie danych, a następnie kliknij prawym przyciskiem "Profile" i wybierz pozycję "Pokaż dane tabeli" Aby wyświetlić dane profilu, przechowywane w tabeli profilów.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-149">Expand 'Tables' to show the different tables in your database, then right click on 'Profiles' and choose 'Show Table Data' to view the profile data stored in the Profiles table.</span></span>

![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image3.png)

![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image4.png)

## <a name="migrating-database-schema"></a><span data-ttu-id="b7bbf-150">Migrowanie schematu bazy danych</span><span class="sxs-lookup"><span data-stu-id="b7bbf-150">Migrating database schema</span></span>

<span data-ttu-id="b7bbf-151">Aby istniejącą bazę danych, pracy z systemem obsługi tożsamości, musimy zaktualizować schematu w bazie danych tożsamości do obsługi pól, zapoczątkowany w oryginalnej bazie danych.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-151">To make the existing database work with the Identity system, we need to update the schema in the Identity database to support the fields we added to the original database.</span></span> <span data-ttu-id="b7bbf-152">Można to zrobić za pomocą skryptów SQL, aby tworzyć nowe tabele i skopiować informacje o istniejącym.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-152">This can be done using SQL scripts to create new tables and copy the existing information.</span></span> <span data-ttu-id="b7bbf-153">W oknie "Eksploratora serwera" rozwiń "DefaultConnection" do wyświetlania w tabelach.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-153">In the 'Server Explorer' window, expand the 'DefaultConnection' to display the tables.</span></span> <span data-ttu-id="b7bbf-154">Kliknij prawym przyciskiem myszy tabele, a następnie wybierz pozycję "Nowe zapytanie"</span><span class="sxs-lookup"><span data-stu-id="b7bbf-154">Right click Tables and select 'New Query'</span></span>

![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image5.png)

<span data-ttu-id="b7bbf-155">Wklej skrypt SQL z [ https://raw.github.com/suhasj/UniversalProviders-Identity-Migrations/master/Migration.txt ](https://raw.github.com/suhasj/UniversalProviders-Identity-Migrations/master/Migration.txt) i uruchomimy ją.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-155">Paste the SQL script from [https://raw.github.com/suhasj/UniversalProviders-Identity-Migrations/master/Migration.txt](https://raw.github.com/suhasj/UniversalProviders-Identity-Migrations/master/Migration.txt) and run it.</span></span> <span data-ttu-id="b7bbf-156">"DefaultConnection" jest odświeżana, widać, są dodawane nowe tabele.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-156">If the 'DefaultConnection' is refreshed, we can see that the new tables are added.</span></span> <span data-ttu-id="b7bbf-157">Możesz sprawdzić danych używany wewnątrz tabel, aby zobaczyć, że dane zostały poddane migracji.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-157">You can check the data inside the tables to see that the information has been migrated.</span></span>

![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image6.png)

## <a name="migrating-the-application-to-use-aspnet-identity"></a><span data-ttu-id="b7bbf-158">Migrowanie aplikacji do korzystania z produktu ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="b7bbf-158">Migrating the application to use ASP.NET Identity</span></span>

1. <span data-ttu-id="b7bbf-159">Zainstaluj pakiety Nuget służące do produktu ASP.NET Identity:</span><span class="sxs-lookup"><span data-stu-id="b7bbf-159">Install the Nuget packages needed for ASP.NET Identity:</span></span>

    - <span data-ttu-id="b7bbf-160">Microsoft.AspNet.Identity.EntityFramework</span><span class="sxs-lookup"><span data-stu-id="b7bbf-160">Microsoft.AspNet.Identity.EntityFramework</span></span>
    - <span data-ttu-id="b7bbf-161">Microsoft.AspNet.Identity.Owin</span><span class="sxs-lookup"><span data-stu-id="b7bbf-161">Microsoft.AspNet.Identity.Owin</span></span>
    - <span data-ttu-id="b7bbf-162">Microsoft.Owin.Host.SystemWeb</span><span class="sxs-lookup"><span data-stu-id="b7bbf-162">Microsoft.Owin.Host.SystemWeb</span></span>
    - <span data-ttu-id="b7bbf-163">Microsoft.Owin.Security.Facebook</span><span class="sxs-lookup"><span data-stu-id="b7bbf-163">Microsoft.Owin.Security.Facebook</span></span>
    - <span data-ttu-id="b7bbf-164">Microsoft.Owin.Security.Google</span><span class="sxs-lookup"><span data-stu-id="b7bbf-164">Microsoft.Owin.Security.Google</span></span>
    - <span data-ttu-id="b7bbf-165">Microsoft.Owin.Security.MicrosoftAccount</span><span class="sxs-lookup"><span data-stu-id="b7bbf-165">Microsoft.Owin.Security.MicrosoftAccount</span></span>
    - <span data-ttu-id="b7bbf-166">Microsoft.Owin.Security.Twitter</span><span class="sxs-lookup"><span data-stu-id="b7bbf-166">Microsoft.Owin.Security.Twitter</span></span>

   <span data-ttu-id="b7bbf-167">Więcej informacji na temat zarządzania pakietami Nuget można znaleźć [tutaj](http://docs.nuget.org/docs/start-here/Managing-NuGet-Packages-Using-The-Dialog)</span><span class="sxs-lookup"><span data-stu-id="b7bbf-167">More information on managing Nuget packages can be found [here](http://docs.nuget.org/docs/start-here/Managing-NuGet-Packages-Using-The-Dialog)</span></span>
2. <span data-ttu-id="b7bbf-168">Aby pracować z istniejącymi danymi w tabeli, należy utworzyć klasy modelu, które mapowania tabel i obsługiwać je w systemie tożsamości.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-168">To work with existing data in the table, we need to create model classes which map back to the tables and hook them up in the Identity system.</span></span> <span data-ttu-id="b7bbf-169">W ramach umowy tożsamości klasy modelu albo powinny implementować interfejsy zdefiniowane w pliku dll Identity.Core lub rozszerzyć istniejącą implementację tych interfejsów, które są dostępne w Microsoft.AspNet.Identity.EntityFramework.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-169">As part of the Identity contract, the model classes should either implement the interfaces defined in the Identity.Core dll or can extend the existing implementation of these interfaces available in Microsoft.AspNet.Identity.EntityFramework.</span></span> <span data-ttu-id="b7bbf-170">Firma Microsoft będzie używać istniejących klas dla roli, danymi logowania użytkowników i oświadczeń użytkowników.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-170">We will be using the existing classes for role, user logins and user claims.</span></span> <span data-ttu-id="b7bbf-171">Należy użyć niestandardowych użytkownika w naszym przykładzie.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-171">We need to use a custom user for our sample.</span></span> <span data-ttu-id="b7bbf-172">Kliknij prawym przyciskiem myszy projekt i Utwórz nowy folder "IdentityModels".</span><span class="sxs-lookup"><span data-stu-id="b7bbf-172">Right click on the project and create new folder 'IdentityModels'.</span></span> <span data-ttu-id="b7bbf-173">Dodaj nową klasę "User", jak pokazano poniżej:</span><span class="sxs-lookup"><span data-stu-id="b7bbf-173">Add a new 'User' class as shown below:</span></span>

    [!code-csharp[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample5.cs)]

   <span data-ttu-id="b7bbf-174">Zauważ, że ProfileInfo teraz właściwość klasy użytkownika.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-174">Notice that the 'ProfileInfo' is now a property on the user class.</span></span> <span data-ttu-id="b7bbf-175">Dlatego możemy użyć klasy użytkownika bezpośrednio pracować z danymi profilu.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-175">Hence we can use the user class to directly work with profile data.</span></span>

<span data-ttu-id="b7bbf-176">Skopiuj pliki z **IdentityModels** i **IdentityAccount** foldery ze źródła pobierania ( [ https://github.com/suhasj/UniversalProviders-Identity-Migrations/tree/master/UniversalProviders-Identity-Migrations ](https://github.com/suhasj/UniversalProviders-Identity-Migrations/tree/master/UniversalProviders-Identity-Migrations) ).</span><span class="sxs-lookup"><span data-stu-id="b7bbf-176">Copy the files in the **IdentityModels** and **IdentityAccount** folders from the download source ( [https://github.com/suhasj/UniversalProviders-Identity-Migrations/tree/master/UniversalProviders-Identity-Migrations](https://github.com/suhasj/UniversalProviders-Identity-Migrations/tree/master/UniversalProviders-Identity-Migrations) ).</span></span> <span data-ttu-id="b7bbf-177">Muszą one być pozostałe klasy modelu i nowe strony, które są wymagane przez użytkownika i zarządzanie rolami przy użyciu interfejsów API tożsamości ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-177">These have the remaining model classes and the new pages needed for user and role management using the ASP.NET Identity APIs.</span></span> <span data-ttu-id="b7bbf-178">Metoda, używana jest podobny do członkostwa SQL oraz szczegółowy opis można znaleźć [tutaj](migrating-an-existing-website-from-sql-membership-to-aspnet-identity.md).</span><span class="sxs-lookup"><span data-stu-id="b7bbf-178">The approach used is similar to the SQL Membership and the detailed explanation can be found [here](migrating-an-existing-website-from-sql-membership-to-aspnet-identity.md).</span></span>

[!INCLUDE[](../../../includes/identity/alter-command-exception.md)]

## <a name="copying-profile-data-to-the-new-tables"></a><span data-ttu-id="b7bbf-179">Kopiowanie danych z profilu do nowych tabel</span><span class="sxs-lookup"><span data-stu-id="b7bbf-179">Copying Profile data to the new tables</span></span>

<span data-ttu-id="b7bbf-180">Jak wspomniano wcześniej, należy zdeserializować danych xml w tabelach profile i zapisz go w kolumnach tabeli AspNetUsers.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-180">As mentioned earlier, we need to deserialize the xml data in the Profiles tables and store it in the columns of the AspNetUsers table.</span></span> <span data-ttu-id="b7bbf-181">Nowe kolumny zostały utworzone w tabeli użytkowników w poprzednim kroku, więc wszystko, co zostało do wypełniania tych kolumn niezbędnych danych.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-181">The new columns were created in the users table in the previous step so all that is left is to populate those columns with the necessary data.</span></span> <span data-ttu-id="b7bbf-182">W tym celu użyjemy aplikację konsolową, która jest uruchamiane jeden raz, aby wypełnić nowo utworzonej kolumny w tabeli użytkowników.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-182">To do this, we will use a console application which is run once to populate the newly created columns in the users table.</span></span>

1. <span data-ttu-id="b7bbf-183">Utwórz nową aplikację konsoli w istniejącej rozwiązania.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-183">Create a new console application in the exiting solution.</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image2.jpg)
2. <span data-ttu-id="b7bbf-184">Zainstaluj najnowszą wersję pakietu programu Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-184">Install the latest version of the Entity Framework package.</span></span>
3. <span data-ttu-id="b7bbf-185">Dodaj aplikację sieci web utworzonego powyżej jako odwołanie do aplikacji konsoli.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-185">Add the web application created above as a reference to the console application.</span></span> <span data-ttu-id="b7bbf-186">Aby zrobić to kliknij prawym przyciskiem myszy projekt, a następnie "Dodaj odwołania do", następnie rozwiązania, następnie kliknij przyciskiem myszy projekt i kliknij przycisk OK.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-186">To do this right click on Project, then 'Add References', then Solution, then click on the project and click OK.</span></span>
4. <span data-ttu-id="b7bbf-187">Kopiuj poniższego kodu w klasie pliku Program.cs.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-187">Copy the below code in the Program.cs class.</span></span> <span data-ttu-id="b7bbf-188">Tę logikę odczytuje dane profilu dla każdego użytkownika, serializuje go jako obiekt "ProfileInfo" i zapisuje je w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-188">This logic reads profile data for each user, serializes it as 'ProfileInfo' object and stores it back to the database.</span></span>

    [!code-csharp[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample6.cs)]

   <span data-ttu-id="b7bbf-189">Niektóre modele są definiowane w folderze "IdentityModels" projektu aplikacji sieci web, więc należy dołączyć odpowiednie przestrzenie nazw.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-189">Some of the models used are defined in the 'IdentityModels' folder of the web application project, so you must include the corresponding namespaces.</span></span>
5. <span data-ttu-id="b7bbf-190">Powyższy kod działa na plik bazy danych w aplikacji\_folderu danych projektu aplikacji sieci web utworzony w poprzednich krokach.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-190">The above code works on the database file in the App\_Data folder of the web application project created in the previous steps.</span></span> <span data-ttu-id="b7bbf-191">Aby odwołać do tego, należy zaktualizować parametry połączenia w pliku app.config aplikacji konsolowej przy użyciu parametrów połączenia w pliku web.config aplikacji sieci web.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-191">To reference that, update the connection string in the app.config file of the console application with the connection string in the web.config of the web application.</span></span> <span data-ttu-id="b7bbf-192">Zapewniają również Pełna fizyczna ścieżka we właściwości "AttachDbFilename".</span><span class="sxs-lookup"><span data-stu-id="b7bbf-192">Also provide the complete physical path in the 'AttachDbFilename' property.</span></span>
6. <span data-ttu-id="b7bbf-193">Otwórz wiersz polecenia i przejdź do folderu bin powyżej aplikacji konsoli.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-193">Open a command prompt and navigate to the bin folder of the above console application.</span></span> <span data-ttu-id="b7bbf-194">Uruchom plik wykonywalny i przejrzyj dane wyjściowe dziennika, jak pokazano na poniższej ilustracji.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-194">Run the executable and review the log output as shown in the following image.</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image3.jpg)
7. <span data-ttu-id="b7bbf-195">Otwórz w tabeli "AspNetUsers" w Eksploratorze serwera i sprawdź dane w nowych kolumn, które posiadają właściwości.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-195">Open the 'AspNetUsers' table in the Server Explorer and verify the data in the new columns that hold the properties.</span></span> <span data-ttu-id="b7bbf-196">One powinny być aktualizowane przy użyciu wartości odpowiednich właściwości.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-196">They should be updated with the corresponding property values.</span></span>

## <a name="verify-functionality"></a><span data-ttu-id="b7bbf-197">Sprawdzenie działania</span><span class="sxs-lookup"><span data-stu-id="b7bbf-197">Verify functionality</span></span>

<span data-ttu-id="b7bbf-198">Użyj stron członkostwa nowo dodane, które są implementowane za pomocą tożsamości ASP.NET można zalogować użytkownika ze starej bazy danych.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-198">Use the newly added membership pages that are implemented using ASP.NET Identity to login a user from the old database.</span></span> <span data-ttu-id="b7bbf-199">Użytkownik powinien móc logować się przy użyciu tych samych poświadczeń.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-199">The user should be able to log in using the same credentials.</span></span> <span data-ttu-id="b7bbf-200">Wypróbuj inne funkcje, takie jak dodawanie uwierzytelniania OAuth, tworzenie nowego użytkownika, zmiana haseł, Dodawanie ról, dodawanie użytkowników do ról, itp.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-200">Try the other functionalities like adding OAuth, creating a new user, changing a password, adding roles, add users to roles, etc.</span></span>

<span data-ttu-id="b7bbf-201">Dane profilu dla użytkownika starych i nowych użytkowników, należy pobrać i przechowywane w tabeli użytkowników.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-201">The Profile data for the old user and the new users should be retrieved and stored in the users table.</span></span> <span data-ttu-id="b7bbf-202">Stary tabeli nie powinny istnieć odwołania.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-202">The old table should no longer be referenced.</span></span>

## <a name="conclusion"></a><span data-ttu-id="b7bbf-203">Wniosek</span><span class="sxs-lookup"><span data-stu-id="b7bbf-203">Conclusion</span></span>

<span data-ttu-id="b7bbf-204">Tego artykułu opisano proces migracji aplikacji sieci web, które są używane modelu Dostawca członkostwa do produktu ASP.NET Identity.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-204">The article described the process of migrating web applications that used the provider model for membership to ASP.NET Identity.</span></span> <span data-ttu-id="b7bbf-205">Tego artykułu opisano dodatkowo migrowanie danych profilu dla użytkowników być dołączane do systemu tożsamości.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-205">The article additionally outlined migrating profile data for users to be hooked into the Identity system.</span></span> <span data-ttu-id="b7bbf-206">Zostaw komentarz poniżej pytania i problemy występujące podczas migracji aplikacji.</span><span class="sxs-lookup"><span data-stu-id="b7bbf-206">Please leave comments below for questions and issues encountered when you migrate your app.</span></span>

<span data-ttu-id="b7bbf-207">*Dziękujemy za Rick Anderson i Robert McMurray przeglądania tego artykułu.*</span><span class="sxs-lookup"><span data-stu-id="b7bbf-207">*Thanks to Rick Anderson and Robert McMurray for reviewing the article.*</span></span>
