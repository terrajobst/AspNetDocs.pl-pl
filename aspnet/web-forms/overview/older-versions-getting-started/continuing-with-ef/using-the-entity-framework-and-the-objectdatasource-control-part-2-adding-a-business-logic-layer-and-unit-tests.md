---
uid: web-forms/overview/older-versions-getting-started/continuing-with-ef/using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests
title: 'Korzystanie z programu Entity Framework 4.0 i kontrolka ObjectDataSource, część 2: Dodawanie warstwy logiki biznesowej i testów jednostkowych | Dokumentacja firmy Microsoft'
author: tdykstra
description: W tej serii samouczków opiera się na aplikacji sieci web firmy Contoso University, utworzony przez wprowadzenie do serii samouczków Entity Framework 4.0. I...
ms.author: riande
ms.date: 01/26/2011
ms.assetid: efb0e677-10b8-48dc-93d3-9ba3902dd807
msc.legacyurl: /web-forms/overview/older-versions-getting-started/continuing-with-ef/using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests
msc.type: authoredcontent
ms.openlocfilehash: 6517f037a03bb520ee4f3b3185a255b0eaa9de9a
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 03/01/2019
ms.locfileid: "57067586"
---
<a name="using-the-entity-framework-40-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests"></a><span data-ttu-id="d432e-104">Korzystanie z programu Entity Framework 4.0 i kontrolka ObjectDataSource, część 2: dodawanie warstwy logiki biznesowej i testów jednostkowych</span><span class="sxs-lookup"><span data-stu-id="d432e-104">Using the Entity Framework 4.0 and the ObjectDataSource Control, Part 2: Adding a Business Logic Layer and Unit Tests</span></span>
====================
<span data-ttu-id="d432e-105">przez [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="d432e-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="d432e-106">W tej serii samouczków jest oparta na Contoso University aplikacji sieci web, który jest tworzony przez [rozpoczęcie korzystania z programu Entity Framework 4.0](https://asp.net/entity-framework/tutorials#Getting%20Started) serii samouczków.</span><span class="sxs-lookup"><span data-stu-id="d432e-106">This tutorial series builds on the Contoso University web application that is created by the [Getting Started with the Entity Framework 4.0](https://asp.net/entity-framework/tutorials#Getting%20Started) tutorial series.</span></span> <span data-ttu-id="d432e-107">Jeśli nie została ukończona wcześniej samouczki, jako punkt początkowy na potrzeby tego samouczka możesz [pobrać aplikację](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a) będzie utworzony.</span><span class="sxs-lookup"><span data-stu-id="d432e-107">If you didn't complete the earlier tutorials, as a starting point for this tutorial you can [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a) that you would have created.</span></span> <span data-ttu-id="d432e-108">Możesz również [pobrać aplikację](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) tworzone przez zakończenie serii samouczków.</span><span class="sxs-lookup"><span data-stu-id="d432e-108">You can also [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) that is created by the complete tutorial series.</span></span> <span data-ttu-id="d432e-109">Jeśli masz pytania dotyczące samouczków, możesz zamieścić je do [forum ASP.NET Entity Framework](https://forums.asp.net/1227.aspx).</span><span class="sxs-lookup"><span data-stu-id="d432e-109">If you have questions about the tutorials, you can post them to the [ASP.NET Entity Framework forum](https://forums.asp.net/1227.aspx).</span></span>


<span data-ttu-id="d432e-110">W poprzednim samouczku utworzono n warstwową aplikację internetową przy użyciu platformy Entity Framework i `ObjectDataSource` kontroli.</span><span class="sxs-lookup"><span data-stu-id="d432e-110">In the previous tutorial you created an n-tier web application using the Entity Framework and the `ObjectDataSource` control.</span></span> <span data-ttu-id="d432e-111">W tym samouczku pokazano, jak dodawać logikę biznesową, przy zachowaniu oddzielne warstwy logiki biznesowej (LOGIKI) i warstwy dostępu do danych (DAL) i przedstawia sposób tworzenia zautomatyzowanych testów jednostek dla LOGIKI.</span><span class="sxs-lookup"><span data-stu-id="d432e-111">This tutorial shows how to add business logic while keeping the business-logic layer (BLL) and the data-access layer (DAL) separate, and it shows how to create automated unit tests for the BLL.</span></span>

<span data-ttu-id="d432e-112">W tym samouczku wykonasz następujące zadania:</span><span class="sxs-lookup"><span data-stu-id="d432e-112">In this tutorial you'll complete the following tasks:</span></span>

- <span data-ttu-id="d432e-113">Utwórz interfejs repozytorium, która deklaruje metody dostępu do danych, których potrzebujesz.</span><span class="sxs-lookup"><span data-stu-id="d432e-113">Create a repository interface that declares the data-access methods you need.</span></span>
- <span data-ttu-id="d432e-114">Zaimplementuj interfejs repozytorium w klasie repozytorium.</span><span class="sxs-lookup"><span data-stu-id="d432e-114">Implement the repository interface in the repository class.</span></span>
- <span data-ttu-id="d432e-115">Utwórz klasę logikę biznesową, która wywołuje klasę repozytorium do wykonywania funkcji dostępu do danych.</span><span class="sxs-lookup"><span data-stu-id="d432e-115">Create a business-logic class that calls the repository class to perform data-access functions.</span></span>
- <span data-ttu-id="d432e-116">Połącz `ObjectDataSource` formantu do klasy logikę biznesową, zamiast klasę repozytorium.</span><span class="sxs-lookup"><span data-stu-id="d432e-116">Connect the `ObjectDataSource` control to the business-logic class instead of to the repository class.</span></span>
- <span data-ttu-id="d432e-117">Tworzenie projektu testu jednostkowego i klasa repozytorium, która korzysta z kolekcji w pamięci dla jego magazynu danych.</span><span class="sxs-lookup"><span data-stu-id="d432e-117">Create a unit-test project and a repository class that uses in-memory collections for its data store.</span></span>
- <span data-ttu-id="d432e-118">Tworzenie testu jednostkowego dla logiki biznesowej, które chcesz dodać do klasy logiki biznesowej, a następnie uruchom test i zobaczyć, jak to się nie powieść.</span><span class="sxs-lookup"><span data-stu-id="d432e-118">Create a unit test for business logic that you want to add to the business-logic class, then run the test and see it fail.</span></span>
- <span data-ttu-id="d432e-119">Implementują logikę biznesową w klasie logiki biznesowej, a następnie ponownie uruchom jednostki testowania i zobaczyć ją przekazać.</span><span class="sxs-lookup"><span data-stu-id="d432e-119">Implement the business logic in the business-logic class, then re-run the unit test and see it pass.</span></span>

<span data-ttu-id="d432e-120">Będziesz pracować *Departments.aspx* i *DepartmentsAdd.aspx* stron, które zostały utworzone w poprzednim samouczku.</span><span class="sxs-lookup"><span data-stu-id="d432e-120">You'll work with the *Departments.aspx* and *DepartmentsAdd.aspx* pages that you created in the previous tutorial.</span></span>

## <a name="creating-a-repository-interface"></a><span data-ttu-id="d432e-121">Tworzenie interfejsu repozytorium</span><span class="sxs-lookup"><span data-stu-id="d432e-121">Creating a Repository Interface</span></span>

<span data-ttu-id="d432e-122">Rozpocznie się przez utworzenie interfejsu repozytorium.</span><span class="sxs-lookup"><span data-stu-id="d432e-122">You'll begin by creating the repository interface.</span></span>

<span data-ttu-id="d432e-123">[![Image08](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image2.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="d432e-123">[![Image08](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image2.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image1.png)</span></span>

<span data-ttu-id="d432e-124">W *DAL* folderu, Utwórz nowy plik klasy, nadaj jej nazwę *ISchoolRepository.cs*i Zastąp istniejący kod następującym kodem:</span><span class="sxs-lookup"><span data-stu-id="d432e-124">In the *DAL* folder, create a new class file, name it *ISchoolRepository.cs*, and replace the existing code with the following code:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample1.cs)]

<span data-ttu-id="d432e-125">Interfejs definiuje jedną metodę dla każdej operacji CRUD (Tworzenie, odczytywanie, aktualizowanie, usuwanie) metody, które zostały utworzone w klasie repozytorium.</span><span class="sxs-lookup"><span data-stu-id="d432e-125">The interface defines one method for each of the CRUD (create, read, update, delete) methods that you created in the repository class.</span></span>

<span data-ttu-id="d432e-126">W `SchoolRepository` klasy w *SchoolRepository.cs*, wskazują, że ta klasa implementuje `ISchoolRepository` interfejsu:</span><span class="sxs-lookup"><span data-stu-id="d432e-126">In the `SchoolRepository` class in *SchoolRepository.cs*, indicate that this class implements the `ISchoolRepository` interface:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample2.cs)]

## <a name="creating-a-business-logic-class"></a><span data-ttu-id="d432e-127">Tworzenie klasy logiki biznesowej</span><span class="sxs-lookup"><span data-stu-id="d432e-127">Creating a Business-Logic Class</span></span>

<span data-ttu-id="d432e-128">Następnie utworzysz klasy logiki biznesowej.</span><span class="sxs-lookup"><span data-stu-id="d432e-128">Next, you'll create the business-logic class.</span></span> <span data-ttu-id="d432e-129">Można to zrobić, aby dodać logikę biznesową, która będzie wykonywana przez `ObjectDataSource` kontrolować, mimo że nie zrobimy to jeszcze.</span><span class="sxs-lookup"><span data-stu-id="d432e-129">You do this so that you can add business logic that will be executed by the `ObjectDataSource` control, although you will not do that yet.</span></span> <span data-ttu-id="d432e-130">Na razie nowa klasa logikę biznesową wykona tylko tych samych operacji CRUD, które obsługuje repozytorium.</span><span class="sxs-lookup"><span data-stu-id="d432e-130">For now, the new business-logic class will only perform the same CRUD operations that the repository does.</span></span>

<span data-ttu-id="d432e-131">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image4.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="d432e-131">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image4.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image3.png)</span></span>

<span data-ttu-id="d432e-132">Utwórz nowy folder i nadaj mu nazwę *LOGIKI*.</span><span class="sxs-lookup"><span data-stu-id="d432e-132">Create a new folder and name it *BLL*.</span></span> <span data-ttu-id="d432e-133">(W przypadku aplikacji rzeczywistych warstwy logiki biznesowej zazwyczaj będzie można zaimplementować jako bibliotekę klas — oddzielnego projektu — ale w celu uproszczenia w tym samouczku klasy LOGIKI będą znajdować się w folderze projektu.)</span><span class="sxs-lookup"><span data-stu-id="d432e-133">(In a real-world application, the business-logic layer would typically be implemented as a class library — a separate project — but to keep this tutorial simple, BLL classes will be kept in a project folder.)</span></span>

<span data-ttu-id="d432e-134">W *LOGIKI* folderu, Utwórz nowy plik klasy, nadaj jej nazwę *SchoolBL.cs*i Zastąp istniejący kod następującym kodem:</span><span class="sxs-lookup"><span data-stu-id="d432e-134">In the *BLL* folder, create a new class file, name it *SchoolBL.cs*, and replace the existing code with the following code:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample3.cs)]

<span data-ttu-id="d432e-135">Ten kod tworzy te same metody CRUD, które zostały użyte wcześniej w klasie repozytorium, ale zamiast bezpośrednio dostęp do metod programu Entity Framework, wywoływanych przez nią repozytorium metody klasy.</span><span class="sxs-lookup"><span data-stu-id="d432e-135">This code creates the same CRUD methods you saw earlier in the repository class, but instead of accessing the Entity Framework methods directly, it calls the repository class methods.</span></span>

<span data-ttu-id="d432e-136">Zmienna klasy, która zawiera odwołanie do klasy repozytorium jest zdefiniowany jako typ interfejsu i kod, który tworzy wystąpienie klasy repozytorium znajduje się w dwa konstruktory.</span><span class="sxs-lookup"><span data-stu-id="d432e-136">The class variable that holds a reference to the repository class is defined as an interface type, and the code that instantiates the repository class is contained in two constructors.</span></span> <span data-ttu-id="d432e-137">Konstruktora bez parametrów, które będą używane przez `ObjectDataSource` kontroli.</span><span class="sxs-lookup"><span data-stu-id="d432e-137">The parameterless constructor will be used by the `ObjectDataSource` control.</span></span> <span data-ttu-id="d432e-138">Tworzy wystąpienie `SchoolRepository` klasę, która została utworzona wcześniej.</span><span class="sxs-lookup"><span data-stu-id="d432e-138">It creates an instance of the `SchoolRepository` class that you created earlier.</span></span> <span data-ttu-id="d432e-139">Innego konstruktora umożliwia niezależnie od kodu, która tworzy wystąpienie klasy logikę biznesową, aby przekazać dowolny obiekt, który implementuje interfejs repozytorium.</span><span class="sxs-lookup"><span data-stu-id="d432e-139">The other constructor allows whatever code that instantiates the business-logic class to pass in any object that implements the repository interface.</span></span>

<span data-ttu-id="d432e-140">Metody CRUD, które wywołują, klasę repozytorium i dwa konstruktory umożliwiają korzystanie z klasy logika biznesowa z magazynem danych zaplecza, niezależnie od wybranej.</span><span class="sxs-lookup"><span data-stu-id="d432e-140">The CRUD methods that call the repository class and the two constructors make it possible to use the business-logic class with whatever back-end data store you choose.</span></span> <span data-ttu-id="d432e-141">Klasa logiki biznesowej nie musi wiedzieć, jak klasa, która je wywołuje będzie się powtarzał danych.</span><span class="sxs-lookup"><span data-stu-id="d432e-141">The business-logic class does not need to be aware of how the class that it's calling persists the data.</span></span> <span data-ttu-id="d432e-142">(Jest to często nazywane *nieznajomości trwałości*.) To ułatwia testy jednostkowe, połączyć ze klasy logikę biznesową do implementacji repozytorium, która używa coś prostego w pamięci `List` kolekcji do przechowywania danych.</span><span class="sxs-lookup"><span data-stu-id="d432e-142">(This is often called *persistence ignorance*.) This facilitates unit testing, because you can connect the business-logic class to a repository implementation that uses something as simple as in-memory `List` collections to store data.</span></span>

> [!NOTE]
> <span data-ttu-id="d432e-143">Technicznie rzecz biorąc, obiekty jednostki są nadal nie trwałości zakresu, ponieważ są one tworzone z klas dziedziczących z programu Entity Framework `EntityObject` klasy.</span><span class="sxs-lookup"><span data-stu-id="d432e-143">Technically, the entity objects are still not persistence-ignorant, because they're instantiated from classes that inherit from the Entity Framework's `EntityObject` class.</span></span> <span data-ttu-id="d432e-144">Nieznajomości pełną trwałości, można użyć *zwykłych starych obiektów CLR*, lub *POCOs*, zamiast obiektów, które dziedziczą z `EntityObject` klasy.</span><span class="sxs-lookup"><span data-stu-id="d432e-144">For complete persistence ignorance, you can use *plain old CLR objects*, or *POCOs*, in place of objects that inherit from the `EntityObject` class.</span></span> <span data-ttu-id="d432e-145">Za pomocą POCOs wykracza poza zakres tego samouczka.</span><span class="sxs-lookup"><span data-stu-id="d432e-145">Using POCOs is beyond the scope of this tutorial.</span></span> <span data-ttu-id="d432e-146">Aby uzyskać więcej informacji, zobacz [testowania i Entity Framework 4.0](https://msdn.microsoft.com/library/ff714955.aspx) w witrynie MSDN.)</span><span class="sxs-lookup"><span data-stu-id="d432e-146">For more information, see [Testability and Entity Framework 4.0](https://msdn.microsoft.com/library/ff714955.aspx) on the MSDN website.)</span></span>


<span data-ttu-id="d432e-147">Teraz możesz łączyć `ObjectDataSource` kontrolek z logiką biznesową klasy zamiast do repozytorium i sprawdź, czy wszystko działa tak jak poprzednio.</span><span class="sxs-lookup"><span data-stu-id="d432e-147">Now you can connect the `ObjectDataSource` controls to the business-logic class instead of to the repository and verify that everything works as it did before.</span></span>

<span data-ttu-id="d432e-148">W *Departments.aspx* i *DepartmentsAdd.aspx*, zmienić każde wystąpienie `TypeName="ContosoUniversity.DAL.SchoolRepository"` do `TypeName="ContosoUniversity.BLL.SchoolBL`".</span><span class="sxs-lookup"><span data-stu-id="d432e-148">In *Departments.aspx* and *DepartmentsAdd.aspx*, change each occurrence of `TypeName="ContosoUniversity.DAL.SchoolRepository"` to `TypeName="ContosoUniversity.BLL.SchoolBL`".</span></span> <span data-ttu-id="d432e-149">(Dostępne są cztery wystąpienia we wszystkich).</span><span class="sxs-lookup"><span data-stu-id="d432e-149">(There are four instances in all.)</span></span>

<span data-ttu-id="d432e-150">Uruchom *Departments.aspx* i *DepartmentsAdd.aspx* strony, aby zweryfikować, że nadal działają tak samo jak przed.</span><span class="sxs-lookup"><span data-stu-id="d432e-150">Run the *Departments.aspx* and *DepartmentsAdd.aspx* pages to verify that they still work as they did before.</span></span>

<span data-ttu-id="d432e-151">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image6.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="d432e-151">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image6.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image5.png)</span></span>

<span data-ttu-id="d432e-152">[![Image02](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image8.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="d432e-152">[![Image02](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image8.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image7.png)</span></span>

## <a name="creating-a-unit-test-project-and-repository-implementation"></a><span data-ttu-id="d432e-153">Tworzenie projektu testu jednostkowego i implementacji repozytorium</span><span class="sxs-lookup"><span data-stu-id="d432e-153">Creating a Unit-Test Project and Repository Implementation</span></span>

<span data-ttu-id="d432e-154">Dodaj nowy projekt do rozwiązania przy użyciu **projekt testowy** szablonu i nadaj mu nazwę `ContosoUniversity.Tests`.</span><span class="sxs-lookup"><span data-stu-id="d432e-154">Add a new project to the solution using the **Test Project** template, and name it `ContosoUniversity.Tests`.</span></span>

<span data-ttu-id="d432e-155">W projekcie testowym Dodaj odwołanie do `System.Data.Entity` i Dodaj odwołanie do `ContosoUniversity` projektu.</span><span class="sxs-lookup"><span data-stu-id="d432e-155">In the test project, add a reference to `System.Data.Entity` and add a project reference to the `ContosoUniversity` project.</span></span>

<span data-ttu-id="d432e-156">Można teraz utworzyć klasę repozytorium, które będzie używane z testami jednostkowymi.</span><span class="sxs-lookup"><span data-stu-id="d432e-156">You can now create the repository class that you'll use with unit tests.</span></span> <span data-ttu-id="d432e-157">Magazyn danych dla tego repozytorium będzie w klasie.</span><span class="sxs-lookup"><span data-stu-id="d432e-157">The data store for this repository will be within the class.</span></span>

<span data-ttu-id="d432e-158">[![Image12](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image10.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="d432e-158">[![Image12](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image10.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image9.png)</span></span>

<span data-ttu-id="d432e-159">W projekcie testowym, Utwórz nowy plik klasy, nadaj jej nazwę *MockSchoolRepository.cs*i Zastąp istniejący kod następującym kodem:</span><span class="sxs-lookup"><span data-stu-id="d432e-159">In the test project, create a new class file, name it *MockSchoolRepository.cs*, and replace the existing code with the following code:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample4.cs)]

<span data-ttu-id="d432e-160">Ta klasa repozytorium ma te same metody CRUD, która uzyskuje dostęp do programu Entity Framework bezpośrednio, ale pracują z `List` kolekcji w pamięci, a nie z bazą danych.</span><span class="sxs-lookup"><span data-stu-id="d432e-160">This repository class has the same CRUD methods as the one that accesses the Entity Framework directly, but they work with `List` collections in memory instead of with a database.</span></span> <span data-ttu-id="d432e-161">Ułatwia klasy testowej skonfigurować i zweryfikować testów jednostkowych dla klasy logiki biznesowej.</span><span class="sxs-lookup"><span data-stu-id="d432e-161">This makes it easier for a test class to set up and validate unit tests for the business-logic class.</span></span>

## <a name="creating-unit-tests"></a><span data-ttu-id="d432e-162">Tworzenie testów jednostkowych</span><span class="sxs-lookup"><span data-stu-id="d432e-162">Creating Unit Tests</span></span>

<span data-ttu-id="d432e-163">**Test** szablonu projektu utworzony klasę testu jednostkowego klasy zastępczej dla Ciebie i kolejnego zadania do modyfikowania tej klasy, dodając do niego metody testów jednostkowych dla logiki biznesowej, które chcesz dodać do klasy logiki biznesowej.</span><span class="sxs-lookup"><span data-stu-id="d432e-163">The **Test** project template created a stub unit test class for you, and your next task is to modify this class by adding unit test methods to it for business logic that you want to add to the business-logic class.</span></span>

<span data-ttu-id="d432e-164">[![Image13](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image12.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="d432e-164">[![Image13](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image12.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image11.png)</span></span>

<span data-ttu-id="d432e-165">Na uniwersytecie Contoso wszystkie poszczególne przez instruktorów, może być tylko administrator jednego działu, a następnie należy dodać logikę biznesową w celu wymuszają tę regułę.</span><span class="sxs-lookup"><span data-stu-id="d432e-165">At Contoso University, any individual instructor can only be the administrator of a single department, and you need to add business logic to enforce this rule.</span></span> <span data-ttu-id="d432e-166">Rozpoczniesz Dodawanie testów, a następnie uruchamiając testy, aby zobaczyć je zakończyć się niepowodzeniem.</span><span class="sxs-lookup"><span data-stu-id="d432e-166">You will start by adding tests and running the tests to see them fail.</span></span> <span data-ttu-id="d432e-167">Następnie dodaj kod i ponownie uruchom testy, oczekiwany będzie je przekazać.</span><span class="sxs-lookup"><span data-stu-id="d432e-167">You'll then add the code and rerun the tests, expecting to see them pass.</span></span>

<span data-ttu-id="d432e-168">Otwórz *UnitTest1.cs* pliku i Dodaj `using` instrukcji business Logic Apps i dostęp do danych warstw, które utworzono w projekcie ContosoUniversity:</span><span class="sxs-lookup"><span data-stu-id="d432e-168">Open the *UnitTest1.cs* file and add `using` statements for the business logic and data-access layers that you created in the ContosoUniversity project:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample5.cs)]

<span data-ttu-id="d432e-169">Zastąp `TestMethod1` metody za pomocą następujących metod:</span><span class="sxs-lookup"><span data-stu-id="d432e-169">Replace the `TestMethod1` method with the following methods:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample6.cs)]

<span data-ttu-id="d432e-170">`CreateSchoolBL` Metoda tworzy wystąpienie klasy repozytorium, utworzonej dla projektu, który następnie przekazuje do nowego wystąpienia klasy logikę biznesową testów jednostkowych.</span><span class="sxs-lookup"><span data-stu-id="d432e-170">The `CreateSchoolBL` method creates an instance of the repository class that you created for the unit test project, which it then passes to a new instance of the business-logic class.</span></span> <span data-ttu-id="d432e-171">Metody następnie używa klasy logikę biznesową, aby wstawić trzy działów, których można użyć metod testowych.</span><span class="sxs-lookup"><span data-stu-id="d432e-171">The method then uses the business-logic class to insert three departments that you can use in test methods.</span></span>

<span data-ttu-id="d432e-172">Metody testowe Sprawdź klasy logikę biznesową zgłasza wyjątek, jeśli ktoś inny wstawić nowy dział przy użyciu tego samego konta administratora jako istniejące dział lub ktoś próbuje zaktualizować administratora działu, ustawiając dla niej identyfikator osoby kto jest już administratorem innego działu.</span><span class="sxs-lookup"><span data-stu-id="d432e-172">The test methods verify that the business-logic class throws an exception if someone tries to insert a new department with the same administrator as an existing department, or if someone tries to update a department's administrator by setting it to the ID of a person who is already the administrator of another department.</span></span>

<span data-ttu-id="d432e-173">Klasy wyjątków nie utworzono jeszcze, dlatego ten kod nie zostanie skompilowany.</span><span class="sxs-lookup"><span data-stu-id="d432e-173">You haven't created the exception class yet, so this code will not compile.</span></span> <span data-ttu-id="d432e-174">Aby uzyskać go skompilować, kliknij prawym przyciskiem myszy `DuplicateAdministratorException` i wybierz **Generuj**, a następnie **klasy**.</span><span class="sxs-lookup"><span data-stu-id="d432e-174">To get it to compile, right-click `DuplicateAdministratorException` and select **Generate**, and then **Class**.</span></span>

<span data-ttu-id="d432e-175">[![Image14](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image14.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="d432e-175">[![Image14](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image14.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image13.png)</span></span>

<span data-ttu-id="d432e-176">To tworzy klasę w projekcie testowym, którego można usunąć po utworzeniu klasy wyjątku w głównym projektu.</span><span class="sxs-lookup"><span data-stu-id="d432e-176">This creates a class in the test project which you can delete after you've created the exception class in the main project.</span></span> <span data-ttu-id="d432e-177">i zaimplementować logikę biznesową.</span><span class="sxs-lookup"><span data-stu-id="d432e-177">and implemented the business logic.</span></span>

<span data-ttu-id="d432e-178">Uruchamianie projektu testowego.</span><span class="sxs-lookup"><span data-stu-id="d432e-178">Run the test project.</span></span> <span data-ttu-id="d432e-179">Zgodnie z oczekiwaniami, testy zostaną zakończone niepowodzeniem.</span><span class="sxs-lookup"><span data-stu-id="d432e-179">As expected, the tests fail.</span></span>

<span data-ttu-id="d432e-180">[![Image03](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image16.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="d432e-180">[![Image03](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image16.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image15.png)</span></span>

## <a name="adding-business-logic-to-make-a-test-pass"></a><span data-ttu-id="d432e-181">Dodawanie logiki biznesowej, aby przebieg testu</span><span class="sxs-lookup"><span data-stu-id="d432e-181">Adding Business Logic to Make a Test Pass</span></span>

<span data-ttu-id="d432e-182">Następnie będzie implementować logikę biznesową, która uniemożliwia ustawiony jako administrator działu osobę, która jest już administratorem innego działu.</span><span class="sxs-lookup"><span data-stu-id="d432e-182">Next, you'll implement the business logic that makes it impossible to set as the administrator of a department someone who is already administrator of another department.</span></span> <span data-ttu-id="d432e-183">Będzie zgłoszenie wyjątku z warstwy logiki biznesowej i przechwytywać go w warstwie prezentacji, jeśli użytkownik edytuje dział i klika **aktualizacji** po wybraniu osobą, która jest już administratorem.</span><span class="sxs-lookup"><span data-stu-id="d432e-183">You'll throw an exception from the business-logic layer, and then catch it in the presentation layer if a user edits a department and clicks **Update** after selecting someone who is already an administrator.</span></span> <span data-ttu-id="d432e-184">(Można również usunąć Instruktorzy z listy rozwijanej, którzy są już administratorami, zanim renderowania strony, ale w tym miejscu ma na celu pracy z warstwy logiki biznesowej).</span><span class="sxs-lookup"><span data-stu-id="d432e-184">(You could also remove instructors from the drop-down list who are already administrators before you render the page, but the purpose here is to work with the business-logic layer.)</span></span>

<span data-ttu-id="d432e-185">Rozpocznij od utworzenia klasy wyjątku, który będzie throw, gdy użytkownik próbuje się z administratorem działu więcej niż jeden pod kierunkiem instruktora.</span><span class="sxs-lookup"><span data-stu-id="d432e-185">Start by creating the exception class that you'll throw when a user tries to make an instructor the administrator of more than one department.</span></span> <span data-ttu-id="d432e-186">W głównym projektu Utwórz nowy plik klasy w *LOGIKI* folderu, nadaj jej nazwę *DuplicateAdministratorException.cs*i Zastąp istniejący kod następującym kodem:</span><span class="sxs-lookup"><span data-stu-id="d432e-186">In the main project, create a new class file in the *BLL* folder, name it *DuplicateAdministratorException.cs*, and replace the existing code with the following code:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample7.cs)]

<span data-ttu-id="d432e-187">Teraz usunąć tymczasowy *DuplicateAdministratorException.cs* pliku utworzonego w projekcie testowym wcześniej aby można było skompilować.</span><span class="sxs-lookup"><span data-stu-id="d432e-187">Now delete the temporary *DuplicateAdministratorException.cs* file that you created in the test project earlier in order to be able to compile.</span></span>

<span data-ttu-id="d432e-188">W głównym projektu, otwórz *SchoolBL.cs* pliku i dodaj następującą metodę, która zawiera logikę weryfikacji.</span><span class="sxs-lookup"><span data-stu-id="d432e-188">In the main project, open the *SchoolBL.cs* file and add the following method that contains the validation logic.</span></span> <span data-ttu-id="d432e-189">(Kod odwołuje się do metody, którą utworzysz później).</span><span class="sxs-lookup"><span data-stu-id="d432e-189">(The code refers to a method that you'll create later.)</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample8.cs)]

<span data-ttu-id="d432e-190">Wywołasz tę metodę podczas wstawiania lub aktualizowania `Department` jednostki w celu sprawdzenia, czy innego działu, ma już tego samego konta administratora.</span><span class="sxs-lookup"><span data-stu-id="d432e-190">You'll call this method when you're inserting or updating `Department` entities in order to check whether another department already has the same administrator.</span></span>

<span data-ttu-id="d432e-191">Kod wywołuje metodę wyszukiwania bazy danych dla `Department` jednostki, który ma taką samą `Administrator` wartości właściwości jako jednostki są wstawiane lub aktualizowane.</span><span class="sxs-lookup"><span data-stu-id="d432e-191">The code calls a method to search the database for a `Department` entity that has the same `Administrator` property value as the entity being inserted or updated.</span></span> <span data-ttu-id="d432e-192">Jeśli nie zostanie znalezione, kod zgłasza wyjątek.</span><span class="sxs-lookup"><span data-stu-id="d432e-192">If one is found, the code throws an exception.</span></span> <span data-ttu-id="d432e-193">Sprawdzanie poprawności nie jest wymagany w przypadku, jeśli nie ma jednostki są wstawiane lub aktualizowane `Administrator` wartość i żaden wyjątek jest generowany, jeśli metoda jest wywoływana podczas aktualizacji i `Department` znaleziono dopasowania jednostki `Department` jednostki aktualizowana.</span><span class="sxs-lookup"><span data-stu-id="d432e-193">No validation check is required if the entity being inserted or updated has no `Administrator` value, and no exception is thrown if the method is called during an update and the `Department` entity found matches the `Department` entity being updated.</span></span>

<span data-ttu-id="d432e-194">Wywołaj metodę nowe z `Insert` i `Update` metody:</span><span class="sxs-lookup"><span data-stu-id="d432e-194">Call the new method from the `Insert` and `Update` methods:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample9.cs)]

<span data-ttu-id="d432e-195">W *ISchoolRepository.cs*, dodaj następującą deklarację dla nowej metody dostępu do danych:</span><span class="sxs-lookup"><span data-stu-id="d432e-195">In *ISchoolRepository.cs*, add the following declaration for the new data-access method:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample10.cs)]

<span data-ttu-id="d432e-196">W *SchoolRepository.cs*, Dodaj następujący kod `using` instrukcji:</span><span class="sxs-lookup"><span data-stu-id="d432e-196">In *SchoolRepository.cs*, add the following `using` statement:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample11.cs)]

<span data-ttu-id="d432e-197">W *SchoolRepository.cs*, dodaj następującą nową metodę dostępu do danych:</span><span class="sxs-lookup"><span data-stu-id="d432e-197">In *SchoolRepository.cs*, add the following new data-access method:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample12.cs)]

<span data-ttu-id="d432e-198">Ten kod pobiera `Department` obiektów, które mają określoną administratora.</span><span class="sxs-lookup"><span data-stu-id="d432e-198">This code retrieves `Department` entities that have a specified administrator.</span></span> <span data-ttu-id="d432e-199">Tylko jednego działu powinien można znaleźć (jeśli istnieje).</span><span class="sxs-lookup"><span data-stu-id="d432e-199">Only one department should be found (if any).</span></span> <span data-ttu-id="d432e-200">Jednak ponieważ określono ograniczenia jest wbudowana w bazie danych, typ zwracany to kolekcja, w przypadku, gdy znajdują się wiele działów.</span><span class="sxs-lookup"><span data-stu-id="d432e-200">However, because no constraint is built into the database, the return type is a collection in case multiple departments are found.</span></span>

<span data-ttu-id="d432e-201">Domyślnie jeśli kontekst pobiera jednostki z bazy danych, go przechowuje informacje o ich w jego menedżera stanu obiektu.</span><span class="sxs-lookup"><span data-stu-id="d432e-201">By default, when the object context retrieves entities from the database, it keeps track of them in its object state manager.</span></span> <span data-ttu-id="d432e-202">`MergeOption.NoTracking` Parametr określa, że to śledzenie nie zostanie wykonane dla tego zapytania.</span><span class="sxs-lookup"><span data-stu-id="d432e-202">The `MergeOption.NoTracking` parameter specifies that this tracking will not be done for this query.</span></span> <span data-ttu-id="d432e-203">Jest to konieczne, ponieważ zapytanie może zwrócić dokładnie jednostki, który próbujesz zaktualizować, a użytkownik nie będzie mógł dołączyć do tej jednostki.</span><span class="sxs-lookup"><span data-stu-id="d432e-203">This is necessary because the query might return the exact entity that you're trying to update, and then you would not be able to attach that entity.</span></span> <span data-ttu-id="d432e-204">Na przykład, jeśli edytujesz dziale historii *Departments.aspx* strony i pozostaw bez zmian przez administratora, to zapytanie spowoduje zwrócenie działu historii.</span><span class="sxs-lookup"><span data-stu-id="d432e-204">For example, if you edit the History department in the *Departments.aspx* page and leave the administrator unchanged, this query will return the History department.</span></span> <span data-ttu-id="d432e-205">Jeśli `NoTracking` nie jest ustawiona, kontekst będzie już jednostki działu historii w jego menedżera stanu obiektów.</span><span class="sxs-lookup"><span data-stu-id="d432e-205">If `NoTracking` is not set, the object context would already have the History department entity in its object state manager.</span></span> <span data-ttu-id="d432e-206">Po dołączeniu jednostki działu historii, ponownie utworzona na podstawie stanu widoku kontekst zgłasza wyjątek, który jest wyświetlany komunikat, a następnie `"An object with the same key already exists in the ObjectStateManager. The ObjectStateManager cannot track multiple objects with the same key"`.</span><span class="sxs-lookup"><span data-stu-id="d432e-206">Then when you attach the History department entity that's re-created from view state, the object context would throw an exception that says `"An object with the same key already exists in the ObjectStateManager. The ObjectStateManager cannot track multiple objects with the same key"`.</span></span>

<span data-ttu-id="d432e-207">(Zamiast określania `MergeOption.NoTracking`, można utworzyć nowy kontekst obiektu tylko dla tego zapytania.</span><span class="sxs-lookup"><span data-stu-id="d432e-207">(As an alternative to specifying `MergeOption.NoTracking`, you could create a new object context just for this query.</span></span> <span data-ttu-id="d432e-208">Ponieważ nowy kontekst obiektu będzie mieć swój własny Menedżer stanu obiektu, nie będzie żadnych konfliktów podczas wywoływania `Attach` metody.</span><span class="sxs-lookup"><span data-stu-id="d432e-208">Because the new object context would have its own object state manager, there would be no conflict when you call the `Attach` method.</span></span> <span data-ttu-id="d432e-209">Nowy kontekst obiektu będzie Udostępnij połączenia metadanych i baza danych z oryginalnego kontekstu obiektu, aby spadek wydajności o tym alternatywnym podejściu będzie niewielki.</span><span class="sxs-lookup"><span data-stu-id="d432e-209">The new object context would share metadata and database connection with the original object context, so the performance penalty of this alternate approach would be minimal.</span></span> <span data-ttu-id="d432e-210">To podejście pokazano poniżej, jednak wprowadza `NoTracking` opcję znajdującą się przydatne w innych kontekstach.</span><span class="sxs-lookup"><span data-stu-id="d432e-210">The approach shown here, however, introduces the `NoTracking` option, which you'll find useful in other contexts.</span></span> <span data-ttu-id="d432e-211">`NoTracking` Opcji zostało omówione w dalszych samouczków w tej serii.)</span><span class="sxs-lookup"><span data-stu-id="d432e-211">The `NoTracking` option is discussed further in a later tutorial in this series.)</span></span>

<span data-ttu-id="d432e-212">W projekcie testowym Dodaj nową metodę dostępu do danych w celu *MockSchoolRepository.cs*:</span><span class="sxs-lookup"><span data-stu-id="d432e-212">In the test project, add the new data-access method to *MockSchoolRepository.cs*:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample13.cs)]

<span data-ttu-id="d432e-213">Ten kod używa LINQ do wykonania tych samych wybór danych, `ContosoUniversity` składnik LINQ to Entities dla korzysta z repozytorium projektu.</span><span class="sxs-lookup"><span data-stu-id="d432e-213">This code uses LINQ to perform the same data selection that the `ContosoUniversity` project repository uses LINQ to Entities for.</span></span>

<span data-ttu-id="d432e-214">Uruchom ponownie projekt testowy.</span><span class="sxs-lookup"><span data-stu-id="d432e-214">Run the test project again.</span></span> <span data-ttu-id="d432e-215">Teraz kod przechodzi testy.</span><span class="sxs-lookup"><span data-stu-id="d432e-215">This time the tests pass.</span></span>

<span data-ttu-id="d432e-216">[![Image04](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image18.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="d432e-216">[![Image04](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image18.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image17.png)</span></span>

## <a name="handling-objectdatasource-exceptions"></a><span data-ttu-id="d432e-217">Obsługa wyjątków ObjectDataSource</span><span class="sxs-lookup"><span data-stu-id="d432e-217">Handling ObjectDataSource Exceptions</span></span>

<span data-ttu-id="d432e-218">W `ContosoUniversity` projektu, uruchom *Departments.aspx* strony, a następnie spróbuj zmienić administratora dla działu do osoby, która jest już administratorem innego działu.</span><span class="sxs-lookup"><span data-stu-id="d432e-218">In the `ContosoUniversity` project, run the *Departments.aspx* page and try to change the administrator for a department to someone who is already administrator for another department.</span></span> <span data-ttu-id="d432e-219">(Należy pamiętać, że możesz edytować tylko działów dodanych w ramach tego samouczka, ponieważ baza danych zawiera wstępnie załadowane z nieprawidłowe dane). Otrzymasz następującą stronę błąd serwera:</span><span class="sxs-lookup"><span data-stu-id="d432e-219">(Remember that you can only edit departments that you added during this tutorial, because the database comes preloaded with invalid data.) You get the following server error page:</span></span>

<span data-ttu-id="d432e-220">[![Image05](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image20.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="d432e-220">[![Image05](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image20.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image19.png)</span></span>

<span data-ttu-id="d432e-221">Nie chcesz, aby użytkownikom na wyświetlanie tego rodzaju strony błędu, więc należy dodać kod obsługi błędów.</span><span class="sxs-lookup"><span data-stu-id="d432e-221">You don't want users to see this kind of error page, so you need to add error-handling code.</span></span> <span data-ttu-id="d432e-222">Otwórz *Departments.aspx* i określ program obsługi `OnUpdated` zdarzenia `DepartmentsObjectDataSource`.</span><span class="sxs-lookup"><span data-stu-id="d432e-222">Open *Departments.aspx* and specify a handler for the `OnUpdated` event of the `DepartmentsObjectDataSource`.</span></span> <span data-ttu-id="d432e-223">`ObjectDataSource` Tagu początkowego teraz przypomina poniższy przykład.</span><span class="sxs-lookup"><span data-stu-id="d432e-223">The `ObjectDataSource` opening tag now resembles the following example.</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample14.aspx)]

<span data-ttu-id="d432e-224">W *Departments.aspx.cs*, Dodaj następujący kod `using` instrukcji:</span><span class="sxs-lookup"><span data-stu-id="d432e-224">In *Departments.aspx.cs*, add the following `using` statement:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample15.cs)]

<span data-ttu-id="d432e-225">Dodaj następujący program obsługi dla `Updated` zdarzeń:</span><span class="sxs-lookup"><span data-stu-id="d432e-225">Add the following handler for the `Updated` event:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample16.cs)]

<span data-ttu-id="d432e-226">Jeśli `ObjectDataSource` kontroli wyłapuje wyjątek, gdy próbuje wykonać aktualizację, przekazuje wyjątek w argumencie zdarzeń (`e`) do tego programu obsługi.</span><span class="sxs-lookup"><span data-stu-id="d432e-226">If the `ObjectDataSource` control catches an exception when it tries to perform the update, it passes the exception in the event argument (`e`) to this handler.</span></span> <span data-ttu-id="d432e-227">Kod obsługi sprawdza, jeśli wyjątek jest wyjątkiem zduplikowanych administratora.</span><span class="sxs-lookup"><span data-stu-id="d432e-227">The code in the handler checks to see if the exception is the duplicate administrator exception.</span></span> <span data-ttu-id="d432e-228">Jeśli tak jest, kod tworzy formant modułu sprawdzania poprawności, który zawiera komunikat o błędzie `ValidationSummary` kontrolka do wyświetlenia.</span><span class="sxs-lookup"><span data-stu-id="d432e-228">If it is, the code creates a validator control that contains an error message for the `ValidationSummary` control to display.</span></span>

<span data-ttu-id="d432e-229">Uruchom stronę i próbować wykonać ktoś administrator dwóch działów ponownie.</span><span class="sxs-lookup"><span data-stu-id="d432e-229">Run the page and attempt to make someone the administrator of two departments again.</span></span> <span data-ttu-id="d432e-230">Tym razem `ValidationSummary` kontrolka wyświetla komunikat o błędzie.</span><span class="sxs-lookup"><span data-stu-id="d432e-230">This time the `ValidationSummary` control displays an error message.</span></span>

<span data-ttu-id="d432e-231">[![Image06](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image22.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="d432e-231">[![Image06](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image22.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image21.png)</span></span>

<span data-ttu-id="d432e-232">Wprowadzić zmiany podobne do *DepartmentsAdd.aspx* strony.</span><span class="sxs-lookup"><span data-stu-id="d432e-232">Make similar changes to the *DepartmentsAdd.aspx* page.</span></span> <span data-ttu-id="d432e-233">W *DepartmentsAdd.aspx*, określ program obsługi `OnInserted` zdarzenia `DepartmentsObjectDataSource`.</span><span class="sxs-lookup"><span data-stu-id="d432e-233">In *DepartmentsAdd.aspx*, specify a handler for the `OnInserted` event of the `DepartmentsObjectDataSource`.</span></span> <span data-ttu-id="d432e-234">Wynikowy kod znaczników będą podobne do następującego przykładu.</span><span class="sxs-lookup"><span data-stu-id="d432e-234">The resulting markup will resemble the following example.</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample17.aspx)]

<span data-ttu-id="d432e-235">W *DepartmentsAdd.aspx.cs*, dodania tego samego `using` instrukcji:</span><span class="sxs-lookup"><span data-stu-id="d432e-235">In *DepartmentsAdd.aspx.cs*, add the same `using` statement:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample18.cs)]

<span data-ttu-id="d432e-236">Dodaj następującą obsługę zdarzeń:</span><span class="sxs-lookup"><span data-stu-id="d432e-236">Add the following event handler:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample19.cs)]

<span data-ttu-id="d432e-237">Teraz możesz przetestować *DepartmentsAdd.aspx.cs* stronę, aby sprawdzić, czy również poprawnie obsługuje prób wprowadzenia jedna osoba administrator więcej niż jednego działu.</span><span class="sxs-lookup"><span data-stu-id="d432e-237">You can now test the *DepartmentsAdd.aspx.cs* page to verify that it also correctly handles attempts to make one person the administrator of more than one department.</span></span>

<span data-ttu-id="d432e-238">Na tym kończy się wprowadzenie do implementowania wzorca repozytorium dla przy użyciu `ObjectDataSource` kontrola przy użyciu platformy Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="d432e-238">This completes the introduction to implementing the repository pattern for using the `ObjectDataSource` control with the Entity Framework.</span></span> <span data-ttu-id="d432e-239">Aby uzyskać więcej informacji na temat wzorca repozytorium i testowania, zobacz oficjalny dokument dotyczący MSDN [testowania i Entity Framework 4.0](https://msdn.microsoft.com/library/ff714955.aspx).</span><span class="sxs-lookup"><span data-stu-id="d432e-239">For more information about the repository pattern and testability, see the MSDN whitepaper [Testability and Entity Framework 4.0](https://msdn.microsoft.com/library/ff714955.aspx).</span></span>

<span data-ttu-id="d432e-240">W tym samouczku poniższy pokazano, jak dodać sortowanie i filtrowanie funkcji do aplikacji.</span><span class="sxs-lookup"><span data-stu-id="d432e-240">In the following tutorial you'll see how to add sorting and filtering functionality to the application.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="d432e-241">[Poprzednie](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started.md)
> [dalej](using-the-entity-framework-and-the-objectdatasource-control-part-3-sorting-and-filtering.md)</span><span class="sxs-lookup"><span data-stu-id="d432e-241">[Previous](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started.md)
[Next](using-the-entity-framework-and-the-objectdatasource-control-part-3-sorting-and-filtering.md)</span></span>
