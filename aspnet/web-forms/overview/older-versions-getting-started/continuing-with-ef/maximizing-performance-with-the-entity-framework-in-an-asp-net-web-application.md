---
uid: web-forms/overview/older-versions-getting-started/continuing-with-ef/maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application
title: Maksymalizacja wydajności za pomocą Entity Framework 4,0 w aplikacji sieci Web ASP.NET 4 | Microsoft Docs
author: tdykstra
description: Ta seria samouczków jest oparta na aplikacji sieci Web firmy Contoso University, utworzonej przez Wprowadzenie z serią samouczków Entity Framework 4,0. I...
ms.author: riande
ms.date: 01/26/2011
ms.assetid: 4e43455e-dfa1-42db-83cb-c987703f04b5
msc.legacyurl: /web-forms/overview/older-versions-getting-started/continuing-with-ef/maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application
msc.type: authoredcontent
ms.openlocfilehash: 5630200a1ad1d30f6d89b38e15179f15b699fa9f
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 03/06/2020
ms.locfileid: "78545963"
---
# <a name="maximizing-performance-with-the-entity-framework-40-in-an-aspnet-4-web-application"></a><span data-ttu-id="f5941-104">Maksymalizowanie wydajności z Entity Framework 4,0 w aplikacji sieci Web ASP.NET 4</span><span class="sxs-lookup"><span data-stu-id="f5941-104">Maximizing Performance with the Entity Framework 4.0 in an ASP.NET 4 Web Application</span></span>

<span data-ttu-id="f5941-105">Autor [Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="f5941-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="f5941-106">Ta seria samouczków jest oparta na aplikacji sieci Web firmy Contoso University, utworzonej przez Wprowadzenie z serią samouczków [Entity Framework 4,0](https://asp.net/entity-framework/tutorials#Getting%20Started) .</span><span class="sxs-lookup"><span data-stu-id="f5941-106">This tutorial series builds on the Contoso University web application that is created by the [Getting Started with the Entity Framework 4.0](https://asp.net/entity-framework/tutorials#Getting%20Started) tutorial series.</span></span> <span data-ttu-id="f5941-107">Jeśli wcześniej samouczki nie zostały wykonane, jako punkt wyjścia dla tego samouczka możesz [pobrać utworzoną aplikację](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a) .</span><span class="sxs-lookup"><span data-stu-id="f5941-107">If you didn't complete the earlier tutorials, as a starting point for this tutorial you can [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a) that you would have created.</span></span> <span data-ttu-id="f5941-108">Możesz również [pobrać aplikację](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) utworzoną przez kompletną serię samouczków.</span><span class="sxs-lookup"><span data-stu-id="f5941-108">You can also [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) that is created by the complete tutorial series.</span></span> <span data-ttu-id="f5941-109">Jeśli masz pytania dotyczące samouczków, możesz je ogłosić na [forum ASP.NET Entity Framework](https://forums.asp.net/1227.aspx).</span><span class="sxs-lookup"><span data-stu-id="f5941-109">If you have questions about the tutorials, you can post them to the [ASP.NET Entity Framework forum](https://forums.asp.net/1227.aspx).</span></span>

<span data-ttu-id="f5941-110">W poprzednim samouczku przedstawiono sposób obsługi konfliktów współbieżności.</span><span class="sxs-lookup"><span data-stu-id="f5941-110">In the previous tutorial, you saw how to handle concurrency conflicts.</span></span> <span data-ttu-id="f5941-111">W tym samouczku przedstawiono opcje poprawy wydajności aplikacji sieci Web ASP.NET, która używa Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="f5941-111">This tutorial shows options for improving the performance of an ASP.NET web application that uses the Entity Framework.</span></span> <span data-ttu-id="f5941-112">Poznasz kilka metod maksymalizowania wydajności lub diagnozowania problemów z wydajnością.</span><span class="sxs-lookup"><span data-stu-id="f5941-112">You'll learn several methods for maximizing performance or for diagnosing performance problems.</span></span>

<span data-ttu-id="f5941-113">Informacje przedstawione w poniższych sekcjach mogą być przydatne w wielu różnych scenariuszach:</span><span class="sxs-lookup"><span data-stu-id="f5941-113">Information presented in the following sections is likely to be useful in a broad variety of scenarios:</span></span>

- <span data-ttu-id="f5941-114">Efektywnie Załaduj powiązane dane.</span><span class="sxs-lookup"><span data-stu-id="f5941-114">Efficiently load related data.</span></span>
- <span data-ttu-id="f5941-115">Zarządzanie stanem widoku.</span><span class="sxs-lookup"><span data-stu-id="f5941-115">Manage view state.</span></span>

<span data-ttu-id="f5941-116">Informacje przedstawione w poniższych sekcjach mogą być przydatne, jeśli masz pojedyncze zapytania, które przedstawiają problemy z wydajnością:</span><span class="sxs-lookup"><span data-stu-id="f5941-116">Information presented in the following sections might be useful if you have individual queries that present performance problems:</span></span>

- <span data-ttu-id="f5941-117">Użyj opcji scalania `NoTracking`.</span><span class="sxs-lookup"><span data-stu-id="f5941-117">Use the `NoTracking` merge option.</span></span>
- <span data-ttu-id="f5941-118">Wstępnie Kompiluj zapytania LINQ.</span><span class="sxs-lookup"><span data-stu-id="f5941-118">Pre-compile LINQ queries.</span></span>
- <span data-ttu-id="f5941-119">Zbadaj polecenia zapytania wysyłane do bazy danych.</span><span class="sxs-lookup"><span data-stu-id="f5941-119">Examine query commands sent to the database.</span></span>

<span data-ttu-id="f5941-120">Informacje przedstawione w poniższej sekcji są potencjalnie przydatne w przypadku aplikacji, które mają bardzo duże modele danych:</span><span class="sxs-lookup"><span data-stu-id="f5941-120">Information presented in the following section is potentially useful for applications that have extremely large data models:</span></span>

- <span data-ttu-id="f5941-121">Wstępnie Generuj widoki.</span><span class="sxs-lookup"><span data-stu-id="f5941-121">Pre-generate views.</span></span>

> [!NOTE]
> <span data-ttu-id="f5941-122">Wydajność aplikacji sieci Web ma wpływ wiele czynników, takich jak rozmiar danych żądań i odpowiedzi, szybkość zapytań bazy danych, liczba żądań, które serwer może umieścić w kolejce i jak szybko może je obsłużyć, a nawet ich wydajność używane biblioteki skryptów klienta.</span><span class="sxs-lookup"><span data-stu-id="f5941-122">Web application performance is affected by many factors, including things like the size of request and response data, the speed of database queries, how many requests the server can queue and how quickly it can service them, and even the efficiency of any client-script libraries you might be using.</span></span> <span data-ttu-id="f5941-123">Jeśli wydajność ma krytyczne znaczenie dla aplikacji lub jeśli test lub środowisko pokazuje, że wydajność aplikacji nie jest zadowalająca, należy postępować zgodnie z normalnym protokołem dostrajania wydajności.</span><span class="sxs-lookup"><span data-stu-id="f5941-123">If performance is critical in your application, or if testing or experience shows that application performance isn't satisfactory, you should follow normal protocol for performance tuning.</span></span> <span data-ttu-id="f5941-124">Mierz, aby określić, gdzie występują wąskie gardła wydajności, a następnie zaadresować obszary, które będą miały największy wpływ na ogólną wydajność aplikacji.</span><span class="sxs-lookup"><span data-stu-id="f5941-124">Measure to determine where performance bottlenecks are occurring, and then address the areas that will have the greatest impact on overall application performance.</span></span>
> 
> <span data-ttu-id="f5941-125">Ten temat koncentruje się głównie na sposobach, w których można poprawić wydajność w szczególności Entity Framework w ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="f5941-125">This topic focuses mainly on ways in which you can potentially improve the performance specifically of the Entity Framework in ASP.NET.</span></span> <span data-ttu-id="f5941-126">Sugestie w tym miejscu są przydatne w przypadku określenia, że dostęp do danych jest jednym z wąskich gardeł wydajności aplikacji.</span><span class="sxs-lookup"><span data-stu-id="f5941-126">The suggestions here are useful if you determine that data access is one of the performance bottlenecks in your application.</span></span> <span data-ttu-id="f5941-127">Bez względu na to, że metody wyjaśnione w tym miejscu nie powinny być uważane za &quot;najlepszych rozwiązań&quot; ogólnie — wiele z nich jest odpowiednie tylko w wyjątkowych sytuacjach lub w celu rozwiązania bardzo konkretnych rodzajów wąskich gardeł wydajności.</span><span class="sxs-lookup"><span data-stu-id="f5941-127">Except as noted, the methods explained here shouldn't be considered &quot;best practices&quot; in general — many of them are appropriate only in exceptional situations or to address very specific kinds of performance bottlenecks.</span></span>

<span data-ttu-id="f5941-128">Aby rozpocząć pracę z samouczkiem, uruchom program Visual Studio i Otwórz aplikację sieci Web Contoso University, z którą pracowałeś w poprzednim samouczku.</span><span class="sxs-lookup"><span data-stu-id="f5941-128">To start the tutorial, start Visual Studio and open the Contoso University web application that you were working with in the previous tutorial.</span></span>

## <a name="efficiently-loading-related-data"></a><span data-ttu-id="f5941-129">Wydajne ładowanie powiązanych danych</span><span class="sxs-lookup"><span data-stu-id="f5941-129">Efficiently Loading Related Data</span></span>

<span data-ttu-id="f5941-130">Istnieje kilka Entity Framework sposobów załadowania powiązanych danych do właściwości nawigacji jednostki:</span><span class="sxs-lookup"><span data-stu-id="f5941-130">There are several ways that the Entity Framework can load related data into the navigation properties of an entity:</span></span>

- <span data-ttu-id="f5941-131">*Ładowanie z opóźnieniem*.</span><span class="sxs-lookup"><span data-stu-id="f5941-131">*Lazy loading*.</span></span> <span data-ttu-id="f5941-132">Gdy obiekt jest najpierw odczytywany, powiązane dane nie są pobierane.</span><span class="sxs-lookup"><span data-stu-id="f5941-132">When the entity is first read, related data isn't retrieved.</span></span> <span data-ttu-id="f5941-133">Jednak przy pierwszej próbie uzyskania dostępu do właściwości nawigacji dane wymagane dla tej właściwości nawigacji są pobierane automatycznie.</span><span class="sxs-lookup"><span data-stu-id="f5941-133">However, the first time you attempt to access a navigation property, the data required for that navigation property is automatically retrieved.</span></span> <span data-ttu-id="f5941-134">Powoduje to, że wiele zapytań jest wysyłanych do bazy danych — jeden dla samej jednostki i po każdym każdej chwili, gdy powiązane dane dla jednostki muszą zostać pobrane.</span><span class="sxs-lookup"><span data-stu-id="f5941-134">This results in multiple queries sent to the database — one for the entity itself and one each time that related data for the entity must be retrieved.</span></span> 

    <span data-ttu-id="f5941-135">[![Image05](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image2.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="f5941-135">[![Image05](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image2.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image1.png)</span></span>

<span data-ttu-id="f5941-136">*Ładowanie eager*.</span><span class="sxs-lookup"><span data-stu-id="f5941-136">*Eager loading*.</span></span> <span data-ttu-id="f5941-137">Po odczytaniu jednostki są pobierane powiązane dane.</span><span class="sxs-lookup"><span data-stu-id="f5941-137">When the entity is read, related data is retrieved along with it.</span></span> <span data-ttu-id="f5941-138">Zwykle powoduje to pojedyncze zapytanie sprzężenia, które pobiera wszystkie dane, które są zbędne.</span><span class="sxs-lookup"><span data-stu-id="f5941-138">This typically results in a single join query that retrieves all of the data that's needed.</span></span> <span data-ttu-id="f5941-139">Należy określić eager ładowania przy użyciu metody `Include`, ponieważ zaobserwowano już w tych samouczkach.</span><span class="sxs-lookup"><span data-stu-id="f5941-139">You specify eager loading by using the `Include` method, as you've seen already in these tutorials.</span></span>

<span data-ttu-id="f5941-140">[![Image07](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image4.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="f5941-140">[![Image07](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image4.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image3.png)</span></span>

- <span data-ttu-id="f5941-141">*Jawne ładowanie*.</span><span class="sxs-lookup"><span data-stu-id="f5941-141">*Explicit loading*.</span></span> <span data-ttu-id="f5941-142">Jest to podobne do ładowania z opóźnieniem, z tą różnicą, że jawnie pobierasz powiązane dane w kodzie; nie odbywa się to automatycznie podczas uzyskiwania dostępu do właściwości nawigacji.</span><span class="sxs-lookup"><span data-stu-id="f5941-142">This is similar to lazy loading, except that you explicitly retrieve the related data in code; it doesn't happen automatically when you access a navigation property.</span></span> <span data-ttu-id="f5941-143">Powiązane dane można ładować ręcznie przy użyciu metody `Load` właściwości nawigacji dla kolekcji lub użyć metody `Load` właściwości Reference dla właściwości, które przechowują pojedynczy obiekt.</span><span class="sxs-lookup"><span data-stu-id="f5941-143">You load related data manually using the `Load` method of the navigation property for collections, or you use the `Load` method of the reference property for properties that hold a single object.</span></span> <span data-ttu-id="f5941-144">(Na przykład wywoływanie metody `PersonReference.Load` w celu załadowania właściwości nawigacji `Person` jednostki `Department`).</span><span class="sxs-lookup"><span data-stu-id="f5941-144">(For example, you call the `PersonReference.Load` method to load the `Person` navigation property of a `Department` entity.)</span></span>

    <span data-ttu-id="f5941-145">[![Image06](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image6.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="f5941-145">[![Image06](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image6.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image5.png)</span></span>

<span data-ttu-id="f5941-146">Ponieważ nie pobierają one natychmiast wartości właściwości, ładowanie z opóźnieniem i jawne ładowanie są również nazywane *opóźnionym ładowaniem*.</span><span class="sxs-lookup"><span data-stu-id="f5941-146">Because they don't immediately retrieve the property values, lazy loading and explicit loading are also both known as *deferred loading*.</span></span>

<span data-ttu-id="f5941-147">Ładowanie z opóźnieniem jest domyślnym zachowaniem dla kontekstu obiektu, który został wygenerowany przez projektanta.</span><span class="sxs-lookup"><span data-stu-id="f5941-147">Lazy loading is the default behavior for an object context that has been generated by the designer.</span></span> <span data-ttu-id="f5941-148">Jeśli otworzysz plik *SchoolModel.Designer.cs* , który definiuje klasę kontekstu obiektów, znajdziesz trzy metody konstruktora, a każda z nich zawiera następującą instrukcję:</span><span class="sxs-lookup"><span data-stu-id="f5941-148">If you open the *SchoolModel.Designer.cs* file that defines the object context class, you'll find three constructor methods, and each of them includes the following statement:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample1.cs)]

<span data-ttu-id="f5941-149">Ogólnie rzecz biorąc, Jeśli wiesz, że potrzebne są powiązane dane dla każdej pobranej jednostki, ładowanie eager oferuje najlepszą wydajność, ponieważ pojedyncze zapytanie wysyłane do bazy danych jest zwykle bardziej wydajne niż osobne zapytania dla każdej pobranej jednostki.</span><span class="sxs-lookup"><span data-stu-id="f5941-149">In general, if you know you need related data for every entity retrieved, eager loading offers the best performance, because a single query sent to the database is typically more efficient than separate queries for each entity retrieved.</span></span> <span data-ttu-id="f5941-150">Z drugiej strony, jeśli chcesz uzyskać dostęp do właściwości nawigacji jednostki tylko rzadko lub tylko dla małego zestawu jednostek, ładowanie z opóźnieniem lub jawne ładowanie może być bardziej wydajne, ponieważ ładowanie eager spowodowałoby pobranie większej ilości danych niż jest to potrzebne.</span><span class="sxs-lookup"><span data-stu-id="f5941-150">On the other hand, if you need to access an entity's navigation properties only infrequently or only for a small set of the entities, lazy loading or explicit loading may be more efficient, because eager loading would retrieve more data than you need.</span></span>

<span data-ttu-id="f5941-151">W aplikacji sieci Web ładowanie z opóźnieniem może mieć stosunkowo małą wartość, ponieważ akcje użytkownika, które wpływają na potrzebę pokrewnych danych, są wykonywane w przeglądarce, która nie ma połączenia z kontekstem obiektu, który renderuje stronę.</span><span class="sxs-lookup"><span data-stu-id="f5941-151">In a web application, lazy loading may be of relatively little value anyway, because user actions that affect the need for related data take place in the browser, which has no connection to the object context that rendered the page.</span></span> <span data-ttu-id="f5941-152">Z drugiej strony, gdy tworzysz powiązania kontrolki, zazwyczaj wiesz, jakie dane są potrzebne, i dlatego najlepiej jest wybrać eager ładowania lub odroczonego ładowania na podstawie tego, co jest odpowiednie w każdym scenariuszu.</span><span class="sxs-lookup"><span data-stu-id="f5941-152">On the other hand, when you databind a control, you typically know what data you need, and so it's generally best to choose eager loading or deferred loading based on what's appropriate in each scenario.</span></span>

<span data-ttu-id="f5941-153">Ponadto formant powiązany z danymi może używać obiektu jednostki po usunięciu kontekstu obiektu.</span><span class="sxs-lookup"><span data-stu-id="f5941-153">In addition, a databound control might use an entity object after the object context is disposed.</span></span> <span data-ttu-id="f5941-154">W takim przypadku próba załadowania właściwości nawigacji nie powiedzie się.</span><span class="sxs-lookup"><span data-stu-id="f5941-154">In that case, an attempt to lazy-load a navigation property would fail.</span></span> <span data-ttu-id="f5941-155">Wyświetlany komunikat o błędzie jest wyczyszczony: &quot;`The ObjectContext instance has been disposed and can no longer be used for operations that require a connection.`&quot;</span><span class="sxs-lookup"><span data-stu-id="f5941-155">The error message you receive is clear: &quot;`The ObjectContext instance has been disposed and can no longer be used for operations that require a connection.`&quot;</span></span>

<span data-ttu-id="f5941-156">Formant `EntityDataSource` domyślnie wyłącza ładowanie z opóźnieniem.</span><span class="sxs-lookup"><span data-stu-id="f5941-156">The `EntityDataSource` control disables lazy loading by default.</span></span> <span data-ttu-id="f5941-157">W przypadku kontrolki `ObjectDataSource` używanej w bieżącym samouczku (lub w przypadku uzyskania dostępu do kontekstu obiektów z kodu strony) istnieje kilka sposobów, aby ładowanie z opóźnieniem było domyślnie wyłączone.</span><span class="sxs-lookup"><span data-stu-id="f5941-157">For the `ObjectDataSource` control that you're using for the current tutorial (or if you access the object context from page code), there are several ways you can make lazy loading disabled by default.</span></span> <span data-ttu-id="f5941-158">Można ją wyłączyć podczas tworzenia wystąpienia kontekstu obiektu.</span><span class="sxs-lookup"><span data-stu-id="f5941-158">You can disable it when you instantiate an object context.</span></span> <span data-ttu-id="f5941-159">Na przykład można dodać następujący wiersz do metody konstruktora klasy `SchoolRepository`:</span><span class="sxs-lookup"><span data-stu-id="f5941-159">For example, you can add the following line to the constructor method of the `SchoolRepository` class:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample2.cs)]

<span data-ttu-id="f5941-160">W przypadku aplikacji firmy Contoso University, kontekst obiektu automatycznie wyłącza ładowanie z opóźnieniem, dzięki czemu ta właściwość nie będzie musiała być ustawiana za każdym razem, gdy zostanie utworzone wystąpienie kontekstu.</span><span class="sxs-lookup"><span data-stu-id="f5941-160">For the Contoso University application, you'll make the object context automatically disable lazy loading so that this property doesn't have to be set whenever a context is instantiated.</span></span>

<span data-ttu-id="f5941-161">Otwórz model danych *SchoolModel. edmx* , kliknij powierzchnię projektową, a następnie w okienku właściwości ustaw właściwość **włączony ładowanie z opóźnieniem** na `False`.</span><span class="sxs-lookup"><span data-stu-id="f5941-161">Open the *SchoolModel.edmx* data model, click the design surface, and then in the properties pane set the **Lazy Loading Enabled** property to `False`.</span></span> <span data-ttu-id="f5941-162">Zapisz i Zamknij model danych.</span><span class="sxs-lookup"><span data-stu-id="f5941-162">Save and close the data model.</span></span>

<span data-ttu-id="f5941-163">[![Image04](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image8.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="f5941-163">[![Image04](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image8.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image7.png)</span></span>

## <a name="managing-view-state"></a><span data-ttu-id="f5941-164">Zarządzanie stanem widoku</span><span class="sxs-lookup"><span data-stu-id="f5941-164">Managing View State</span></span>

<span data-ttu-id="f5941-165">W celu zapewnienia funkcjonalności aktualizacji Strona sieci Web ASP.NET musi przechowywać oryginalne wartości właściwości jednostki, gdy strona jest renderowana.</span><span class="sxs-lookup"><span data-stu-id="f5941-165">In order to provide update functionality, an ASP.NET web page must store the original property values of an entity when a page is rendered.</span></span> <span data-ttu-id="f5941-166">Podczas przetwarzania ogłaszania zwrotnego, formant może ponownie utworzyć oryginalny stan jednostki i wywołać metodę `Attach` jednostki przed zastosowaniem zmian i wywołaniem metody `SaveChanges`.</span><span class="sxs-lookup"><span data-stu-id="f5941-166">During postback processing the control can re-create the original state of the entity and call the entity's `Attach` method before applying changes and calling the `SaveChanges` method.</span></span> <span data-ttu-id="f5941-167">Domyślnie formanty danych formularzy sieci Web ASP.NET używają stanu widoku do przechowywania oryginalnych wartości.</span><span class="sxs-lookup"><span data-stu-id="f5941-167">By default, ASP.NET Web Forms data controls use view state to store the original values.</span></span> <span data-ttu-id="f5941-168">Jednak stan widoku może mieć wpływ na wydajność, ponieważ jest przechowywany w ukrytych polach, które mogą znacznie zwiększyć rozmiar strony wysyłanej do i z przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="f5941-168">However, view state can affect performance, because it's stored in hidden fields that can substantially increase the size of the page that's sent to and from the browser.</span></span>

<span data-ttu-id="f5941-169">Techniki zarządzania stanem widoku lub alternatywami, takimi jak stan sesji, nie są unikatowe dla Entity Framework, więc ten samouczek nie znajduje się w tym temacie szczegółowo.</span><span class="sxs-lookup"><span data-stu-id="f5941-169">Techniques for managing view state, or alternatives such as session state, aren't unique to the Entity Framework, so this tutorial doesn't go into this topic in detail.</span></span> <span data-ttu-id="f5941-170">Aby uzyskać więcej informacji, zobacz linki na końcu samouczka.</span><span class="sxs-lookup"><span data-stu-id="f5941-170">For more information see the links at the end of the tutorial.</span></span>

<span data-ttu-id="f5941-171">Jednak wersja 4 programu ASP.NET zapewnia nowy sposób pracy ze stanem widoku, który powinien mieć świadomość każdy ASP.NET dewelopera aplikacji formularzy sieci Web: Właściwość `ViewStateMode`.</span><span class="sxs-lookup"><span data-stu-id="f5941-171">However, version 4 of ASP.NET provides a new way of working with view state that every ASP.NET developer of Web Forms applications should be aware of: the `ViewStateMode` property.</span></span> <span data-ttu-id="f5941-172">Ta nowa właściwość może być ustawiona na poziomie strony lub kontrolki i umożliwia wyłączenie opcji wyświetlania stanu domyślnie dla strony i włączenie jej tylko dla formantów, które ich potrzebują.</span><span class="sxs-lookup"><span data-stu-id="f5941-172">This new property can be set at the page or control level, and it enables you to disable view state by default for a page and enable it only for controls that need it.</span></span>

<span data-ttu-id="f5941-173">W przypadku aplikacji, w których wydajność jest krytyczna, dobrym sposobem jest zawsze wyłączenie stanu widoku na poziomie strony i włączenie go tylko dla formantów, które go wymagają.</span><span class="sxs-lookup"><span data-stu-id="f5941-173">For applications where performance is critical, a good practice is to always disable view state at the page level and enable it only for controls that require it.</span></span> <span data-ttu-id="f5941-174">Nie można znacząco obniżyć rozmiaru stanu widoku na stronach uniwersytetów firmy Contoso przy użyciu tej metody, ale aby zobaczyć, jak to działa, należy to zrobić na stronie *Instruktorzy. aspx* .</span><span class="sxs-lookup"><span data-stu-id="f5941-174">The size of view state in the Contoso University pages wouldn't be substantially decreased by this method, but to see how it works, you'll do it for the *Instructors.aspx* page.</span></span> <span data-ttu-id="f5941-175">Ta strona zawiera wiele kontrolek, w tym kontrolkę `Label`, która ma wyłączony stan widoku.</span><span class="sxs-lookup"><span data-stu-id="f5941-175">That page contains many controls, including a `Label` control that has view state disabled.</span></span> <span data-ttu-id="f5941-176">Żadna z formantów na tej stronie nie musi mieć włączonego stanu widoku.</span><span class="sxs-lookup"><span data-stu-id="f5941-176">None of the controls on this page actually need to have view state enabled.</span></span> <span data-ttu-id="f5941-177">(Właściwość `DataKeyNames` kontrolki `GridView` określa stan, który musi być utrzymywany między ogłaszaniem zwrotnym, ale te wartości są przechowywane w stanie kontroli, który nie ma wpływ na Właściwość `ViewStateMode`).</span><span class="sxs-lookup"><span data-stu-id="f5941-177">(The `DataKeyNames` property of the `GridView` control specifies state that must be maintained between postbacks, but these values are kept in control state, which isn't affected by the `ViewStateMode` property.)</span></span>

<span data-ttu-id="f5941-178">Dyrektywa `Page` i znaczniki kontroli `Label` obecnie przypominają następujący przykład:</span><span class="sxs-lookup"><span data-stu-id="f5941-178">The `Page` directive and `Label` control markup currently resembles the following example:</span></span>

[!code-aspx[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample3.aspx)]

<span data-ttu-id="f5941-179">Wprowadź następujące zmiany:</span><span class="sxs-lookup"><span data-stu-id="f5941-179">Make the following changes:</span></span>

- <span data-ttu-id="f5941-180">Dodaj `ViewStateMode="Disabled"` do dyrektywy `Page`.</span><span class="sxs-lookup"><span data-stu-id="f5941-180">Add `ViewStateMode="Disabled"` to the `Page` directive.</span></span>
- <span data-ttu-id="f5941-181">Usuń `ViewStateMode="Disabled"` z kontrolki `Label`.</span><span class="sxs-lookup"><span data-stu-id="f5941-181">Remove `ViewStateMode="Disabled"` from the `Label` control.</span></span>

<span data-ttu-id="f5941-182">Znaczniki są teraz podobne do następujących:</span><span class="sxs-lookup"><span data-stu-id="f5941-182">The markup now resembles the following example:</span></span>

[!code-aspx[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample4.aspx)]

<span data-ttu-id="f5941-183">Stan widoku jest teraz wyłączony dla wszystkich kontrolek.</span><span class="sxs-lookup"><span data-stu-id="f5941-183">View state is now disabled for all controls.</span></span> <span data-ttu-id="f5941-184">Jeśli później dodasz kontrolkę, która musi korzystać z stanu widoku, wystarczy uwzględnić atrybut `ViewStateMode="Enabled"` dla tej kontrolki.</span><span class="sxs-lookup"><span data-stu-id="f5941-184">If you later add a control that does need to use view state, all you need to do is include the `ViewStateMode="Enabled"` attribute for that control.</span></span>

## <a name="using-the-notracking-merge-option"></a><span data-ttu-id="f5941-185">Korzystanie z opcji scalania NoTracking</span><span class="sxs-lookup"><span data-stu-id="f5941-185">Using The NoTracking Merge Option</span></span>

<span data-ttu-id="f5941-186">Gdy kontekst obiektu pobiera wiersze bazy danych i tworzy obiekty jednostek, które reprezentują je, domyślnie śledzi te obiekty jednostki za pomocą menedżera stanu obiektów.</span><span class="sxs-lookup"><span data-stu-id="f5941-186">When an object context retrieves database rows and creates entity objects that represent them, by default it also tracks those entity objects using its object state manager.</span></span> <span data-ttu-id="f5941-187">Te dane śledzenia pełnią rolę pamięci podręcznej i są używane podczas aktualizowania jednostki.</span><span class="sxs-lookup"><span data-stu-id="f5941-187">This tracking data acts as a cache and is used when you update an entity.</span></span> <span data-ttu-id="f5941-188">Ponieważ aplikacja sieci Web zwykle ma wystąpienia kontekstu obiektów krótkoterminowych, zapytania często zwracają dane, które nie muszą być śledzone, ponieważ kontekst obiektu, który odczytuje je, zostanie usunięty przed ponownym użyciem lub zaktualizowaniem.</span><span class="sxs-lookup"><span data-stu-id="f5941-188">Because a web application typically has short-lived object context instances, queries often return data that doesn't need to be tracked, because the object context that reads them will be disposed before any of the entities it reads are used again or updated.</span></span>

<span data-ttu-id="f5941-189">W Entity Framework można określić, czy kontekst obiektu śledzi obiekty jednostek przez ustawienie *opcji scalania*.</span><span class="sxs-lookup"><span data-stu-id="f5941-189">In the Entity Framework, you can specify whether the object context tracks entity objects by setting a *merge option*.</span></span> <span data-ttu-id="f5941-190">Można ustawić opcję scalania dla poszczególnych zapytań lub zestawów jednostek.</span><span class="sxs-lookup"><span data-stu-id="f5941-190">You can set the merge option for individual queries or for entity sets.</span></span> <span data-ttu-id="f5941-191">Jeśli ustawisz go dla zestawu jednostek, oznacza to, że jest ustawiana opcja scalania domyślnego dla wszystkich zapytań, które są tworzone dla danego zestawu jednostek.</span><span class="sxs-lookup"><span data-stu-id="f5941-191">If you set it for an entity set, that means that you're setting the default merge option for all queries that are created for that entity set.</span></span>

<span data-ttu-id="f5941-192">W przypadku aplikacji firmy Contoso University śledzenie nie jest konieczne dla żadnego z zestawów jednostek, do których uzyskuje się dostęp z repozytorium, więc możesz ustawić opcję scalania, aby `NoTracking` te zestawy jednostek podczas tworzenia wystąpienia kontekstu obiektu w klasie repozytorium.</span><span class="sxs-lookup"><span data-stu-id="f5941-192">For the Contoso University application, tracking isn't needed for any of the entity sets that you access from the repository, so you can set the merge option to `NoTracking` for those entity sets when you instantiate the object context in the repository class.</span></span> <span data-ttu-id="f5941-193">(Należy zauważyć, że w tym samouczku ustawienie opcji scalania nie będzie miało zauważalnego wpływu na wydajność aplikacji.</span><span class="sxs-lookup"><span data-stu-id="f5941-193">(Note that in this tutorial, setting the merge option won't have a noticeable effect on the application's performance.</span></span> <span data-ttu-id="f5941-194">Opcja `NoTracking` może spowodować zauważalne zwiększenie wydajności tylko w niektórych scenariuszach z dużą ilością danych.</span><span class="sxs-lookup"><span data-stu-id="f5941-194">The `NoTracking` option is likely to make an observable performance improvement only in certain high-data-volume scenarios.)</span></span>

<span data-ttu-id="f5941-195">W folderze DAL Otwórz plik *SchoolRepository.cs* i Dodaj metodę konstruktora, która ustawia opcję scalania dla zestawów jednostek, do których oduzyskuje się dostęp do repozytorium:</span><span class="sxs-lookup"><span data-stu-id="f5941-195">In the DAL folder, open the *SchoolRepository.cs* file and add a constructor method that sets the merge option for the entity sets that the repository accesses:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample5.cs)]

## <a name="pre-compiling-linq-queries"></a><span data-ttu-id="f5941-196">Wstępne Kompilowanie zapytań LINQ</span><span class="sxs-lookup"><span data-stu-id="f5941-196">Pre-Compiling LINQ Queries</span></span>

<span data-ttu-id="f5941-197">Gdy Entity Framework wykonuje zapytanie Entity SQL w trakcie okresu istnienia danego wystąpienia `ObjectContext`, trwa jakiś czas na skompilowanie zapytania.</span><span class="sxs-lookup"><span data-stu-id="f5941-197">The first time that the Entity Framework executes an Entity SQL query within the life of a given `ObjectContext` instance, it takes some time to compile the query.</span></span> <span data-ttu-id="f5941-198">Wynik kompilacji jest buforowany, co oznacza, że kolejne wykonania zapytania są znacznie szybsze.</span><span class="sxs-lookup"><span data-stu-id="f5941-198">The result of compilation is cached, which means that subsequent executions of the query are much quicker.</span></span> <span data-ttu-id="f5941-199">Zapytania LINQ obserwują podobny wzorzec, z tą różnicą, że niektóre prace wymagane do skompilowania zapytania są wykonywane za każdym razem, gdy zapytanie jest wykonywane.</span><span class="sxs-lookup"><span data-stu-id="f5941-199">LINQ queries follow a similar pattern, except that some of the work required to compile the query is done every time the query is executed.</span></span> <span data-ttu-id="f5941-200">Innymi słowy, w przypadku zapytań LINQ domyślnie nie wszystkie wyniki kompilacji są buforowane.</span><span class="sxs-lookup"><span data-stu-id="f5941-200">In other words, for LINQ queries, by default not all of the results of compilation are cached.</span></span>

<span data-ttu-id="f5941-201">Jeśli masz zapytanie LINQ, które ma być uruchamiane wielokrotnie w okresie istnienia kontekstu obiektu, możesz napisać kod, który powoduje, że wszystkie wyniki kompilacji mają być buforowane przy pierwszym uruchomieniu zapytania LINQ.</span><span class="sxs-lookup"><span data-stu-id="f5941-201">If you have a LINQ query that you expect to run repeatedly in the life of an object context, you can write code that causes all of the results of compilation to be cached the first time the LINQ query is run.</span></span>

<span data-ttu-id="f5941-202">Jako ilustracja, należy to zrobić dla dwóch metod `Get` w klasie `SchoolRepository`, z których jeden nie przyjmuje żadnych parametrów (Metoda `GetInstructorNames`) i że wymaga parametru (Metoda `GetDepartmentsByAdministrator`).</span><span class="sxs-lookup"><span data-stu-id="f5941-202">As an illustration, you'll do this for two `Get` methods in the `SchoolRepository` class, one of which doesn't take any parameters (the `GetInstructorNames` method), and one that does require a parameter (the `GetDepartmentsByAdministrator` method).</span></span> <span data-ttu-id="f5941-203">Te metody stają się teraz niepotrzebne do skompilowania, ponieważ nie są to zapytania LINQ:</span><span class="sxs-lookup"><span data-stu-id="f5941-203">These methods as they stand now actually don't need to be compiled because they aren't LINQ queries:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample6.cs)]

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample7.cs)]

<span data-ttu-id="f5941-204">Jednak dzięki temu można wypróbować skompilowane zapytania, tak jakby były zapisywane jako następujące zapytania LINQ:</span><span class="sxs-lookup"><span data-stu-id="f5941-204">However, so that you can try out compiled queries, you'll proceed as if these had been written as the following LINQ queries:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample8.cs)]

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample9.cs)]

<span data-ttu-id="f5941-205">Możesz zmienić kod w tych metodach, tak jak pokazano powyżej, i uruchomić aplikację, aby sprawdzić, czy działa przed kontynuowaniem.</span><span class="sxs-lookup"><span data-stu-id="f5941-205">You could change the code in these methods to what's shown above and run the application to verify that it works before continuing.</span></span> <span data-ttu-id="f5941-206">Ale poniższe instrukcje przeprowadzą bezpośrednio do tworzenia wstępnie skompilowanych wersji.</span><span class="sxs-lookup"><span data-stu-id="f5941-206">But the following instructions jump right into creating pre-compiled versions of them.</span></span>

<span data-ttu-id="f5941-207">Utwórz plik klasy w folderze *dal* , nadaj mu nazwę *SchoolEntities.cs*i Zastąp istniejący kod następującym kodem:</span><span class="sxs-lookup"><span data-stu-id="f5941-207">Create a class file in the *DAL* folder, name it *SchoolEntities.cs*, and replace the existing code with the following code:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample10.cs)]

<span data-ttu-id="f5941-208">Ten kod tworzy klasę częściową, która rozszerza automatycznie wygenerowaną klasę kontekstu obiektu.</span><span class="sxs-lookup"><span data-stu-id="f5941-208">This code creates a partial class that extends the automatically generated object context class.</span></span> <span data-ttu-id="f5941-209">Klasa częściowa obejmuje dwie skompilowane zapytania LINQ przy użyciu metody `Compile` klasy `CompiledQuery`.</span><span class="sxs-lookup"><span data-stu-id="f5941-209">The partial class includes two compiled LINQ queries using the `Compile` method of the `CompiledQuery` class.</span></span> <span data-ttu-id="f5941-210">Tworzy również metody, których można użyć do wywołania zapytań.</span><span class="sxs-lookup"><span data-stu-id="f5941-210">It also creates methods that you can use to call the queries.</span></span> <span data-ttu-id="f5941-211">Zapisz i Zamknij ten plik.</span><span class="sxs-lookup"><span data-stu-id="f5941-211">Save and close this file.</span></span>

<span data-ttu-id="f5941-212">Następnie w *SchoolRepository.cs*zmień istniejące `GetInstructorNames` i `GetDepartmentsByAdministrator` metod w klasie repozytorium, aby wywoływać skompilowane zapytania:</span><span class="sxs-lookup"><span data-stu-id="f5941-212">Next, in *SchoolRepository.cs*, change the existing `GetInstructorNames` and `GetDepartmentsByAdministrator` methods in the repository class so that they call the compiled queries:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample11.cs)]

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample12.cs)]

<span data-ttu-id="f5941-213">Uruchom stronę *działS. aspx* , aby upewnić się, że działa tak jak wcześniej.</span><span class="sxs-lookup"><span data-stu-id="f5941-213">Run the *Departments.aspx* page to verify that it works as it did before.</span></span> <span data-ttu-id="f5941-214">Metoda `GetInstructorNames` jest wywoływana w celu wypełnienia listy rozwijanej administratora, a metoda `GetDepartmentsByAdministrator` jest wywoływana po kliknięciu przycisku **Aktualizuj** w celu sprawdzenia, czy żaden instruktor nie jest administratorem więcej niż jednego działu.</span><span class="sxs-lookup"><span data-stu-id="f5941-214">The `GetInstructorNames` method is called in order to populate the administrator drop-down list, and the `GetDepartmentsByAdministrator` method is called when you click **Update** in order to verify that no instructor is an administrator of more than one department.</span></span>

<span data-ttu-id="f5941-215">[![Image03](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image10.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="f5941-215">[![Image03](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image10.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image9.png)</span></span>

<span data-ttu-id="f5941-216">Wstępnie skompilowano zapytania w aplikacji uniwersytetów firmy Contoso, aby zobaczyć, jak to zrobić, nie ponieważ mogłoby to mierzyć zwiększenie wydajności.</span><span class="sxs-lookup"><span data-stu-id="f5941-216">You've pre-compiled queries in the Contoso University application only to see how to do it, not because it would measurably improve performance.</span></span> <span data-ttu-id="f5941-217">Wstępne Kompilowanie zapytań LINQ dodaje poziom złożoności kodu, dlatego należy się upewnić, że jest to możliwe tylko dla zapytań, które reprezentują wąskie gardła wydajności w aplikacji.</span><span class="sxs-lookup"><span data-stu-id="f5941-217">Pre-compiling LINQ queries does add a level of complexity to your code, so make sure you do it only for queries that actually represent performance bottlenecks in your application.</span></span>

## <a name="examining-queries-sent-to-the-database"></a><span data-ttu-id="f5941-218">Badanie zapytań wysyłanych do bazy danych</span><span class="sxs-lookup"><span data-stu-id="f5941-218">Examining Queries Sent to the Database</span></span>

<span data-ttu-id="f5941-219">Podczas badania problemów z wydajnością czasami warto poznać dokładne polecenia SQL, które Entity Framework wysyła do bazy danych.</span><span class="sxs-lookup"><span data-stu-id="f5941-219">When you're investigating performance issues, sometimes it's helpful to know the exact SQL commands that the Entity Framework is sending to the database.</span></span> <span data-ttu-id="f5941-220">Jeśli pracujesz z obiektem `IQueryable`, jednym ze sposobów jest użycie metody `ToTraceString`.</span><span class="sxs-lookup"><span data-stu-id="f5941-220">If you're working with an `IQueryable` object, one way to do this is to use the `ToTraceString` method.</span></span>

<span data-ttu-id="f5941-221">W *SchoolRepository.cs*Zmień kod w metodzie `GetDepartmentsByName`, aby pasował do poniższego przykładu:</span><span class="sxs-lookup"><span data-stu-id="f5941-221">In *SchoolRepository.cs*, change the code in the `GetDepartmentsByName` method to match the following example:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample13.cs)]

<span data-ttu-id="f5941-222">Zmienna `departments` musi być rzutowana na typ `ObjectQuery` tylko ponieważ metoda `Where` na końcu poprzedniego wiersza tworzy obiekt `IQueryable`; bez metody `Where` rzutowanie nie będzie konieczne.</span><span class="sxs-lookup"><span data-stu-id="f5941-222">The `departments` variable must be cast to an `ObjectQuery` type only because the `Where` method at the end of the preceding line creates an `IQueryable` object; without the `Where` method, the cast would not be necessary.</span></span>

<span data-ttu-id="f5941-223">Ustaw punkt przerwania w wierszu `return`, a następnie Uruchom stronę *działS. aspx* w debugerze.</span><span class="sxs-lookup"><span data-stu-id="f5941-223">Set a breakpoint on the `return` line, and then run the *Departments.aspx* page in the debugger.</span></span> <span data-ttu-id="f5941-224">Po osiągnięciu punktu przerwania, należy przeanalizować zmienną `commandText` w oknie **zmiennych lokalnych** i użyć wizualizatora tekstu (Lupa w kolumnie **wartość** ), aby wyświetlić jej wartość w oknie **wizualizator tekstu** .</span><span class="sxs-lookup"><span data-stu-id="f5941-224">When you hit the breakpoint, examine the `commandText` variable in the **Locals** window and use the text visualizer (the magnifying glass in the **Value** column) to display its value in the **Text Visualizer** window.</span></span> <span data-ttu-id="f5941-225">Można zobaczyć całe polecenie SQL, które wynika z tego kodu:</span><span class="sxs-lookup"><span data-stu-id="f5941-225">You can see the entire SQL command that results from this code:</span></span>

<span data-ttu-id="f5941-226">[![Image08](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image12.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="f5941-226">[![Image08](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image12.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image11.png)</span></span>

<span data-ttu-id="f5941-227">Alternatywnie funkcja IntelliTrace w Visual Studio Ultimate zapewnia sposób wyświetlania poleceń SQL generowanych przez Entity Framework, które nie wymagają zmiany kodu lub nawet ustawienia punktu przerwania.</span><span class="sxs-lookup"><span data-stu-id="f5941-227">As an alternative, the IntelliTrace feature in Visual Studio Ultimate provides a way to view SQL commands generated by the Entity Framework that doesn't require you to change your code or even set a breakpoint.</span></span>

> [!NOTE]
> <span data-ttu-id="f5941-228">Poniższe procedury można wykonać tylko wtedy, gdy masz Visual Studio Ultimate.</span><span class="sxs-lookup"><span data-stu-id="f5941-228">You can perform the following procedures only if you have Visual Studio Ultimate.</span></span>

<span data-ttu-id="f5941-229">Przywróć oryginalny kod w metodzie `GetDepartmentsByName`, a następnie Uruchom stronę *działS. aspx* w debugerze.</span><span class="sxs-lookup"><span data-stu-id="f5941-229">Restore the original code in the `GetDepartmentsByName` method, and then run the *Departments.aspx* page in the debugger.</span></span>

<span data-ttu-id="f5941-230">W programie Visual Studio wybierz menu **Debuguj** , a następnie **IntelliTrace**, a następnie **IntelliTrace zdarzenia**.</span><span class="sxs-lookup"><span data-stu-id="f5941-230">In Visual Studio, select the **Debug** menu, then **IntelliTrace**, and then **IntelliTrace Events**.</span></span>

<span data-ttu-id="f5941-231">[![Image11](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image14.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="f5941-231">[![Image11](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image14.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image13.png)</span></span>

<span data-ttu-id="f5941-232">W oknie **IntelliTrace** kliknij pozycję **Przerwij wszystko**.</span><span class="sxs-lookup"><span data-stu-id="f5941-232">In the **IntelliTrace** window, click **Break All**.</span></span>

<span data-ttu-id="f5941-233">[![Image12](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image16.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="f5941-233">[![Image12](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image16.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image15.png)</span></span>

<span data-ttu-id="f5941-234">W oknie **IntelliTrace** zostanie wyświetlona lista ostatnich zdarzeń:</span><span class="sxs-lookup"><span data-stu-id="f5941-234">The **IntelliTrace** window displays a list of recent events:</span></span>

<span data-ttu-id="f5941-235">[![Image09](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image18.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="f5941-235">[![Image09](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image18.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image17.png)</span></span>

<span data-ttu-id="f5941-236">Kliknij linię **ADO.NET** .</span><span class="sxs-lookup"><span data-stu-id="f5941-236">Click the **ADO.NET** line.</span></span> <span data-ttu-id="f5941-237">Zostanie rozwinięte, aby wyświetlić tekst polecenia:</span><span class="sxs-lookup"><span data-stu-id="f5941-237">It expands to show you the command text:</span></span>

<span data-ttu-id="f5941-238">[![Image10](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image20.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="f5941-238">[![Image10](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image20.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image19.png)</span></span>

<span data-ttu-id="f5941-239">Cały ciąg tekstowy polecenia można skopiować do schowka z okna **zmiennych lokalnych** .</span><span class="sxs-lookup"><span data-stu-id="f5941-239">You can copy the entire command text string to the clipboard from the **Locals** window.</span></span>

<span data-ttu-id="f5941-240">Załóżmy, że pracujesz z bazą danych z większą liczbą tabel, relacji i kolumn niż prosta baza danych `School`.</span><span class="sxs-lookup"><span data-stu-id="f5941-240">Suppose you were working with a database with more tables, relationships, and columns than the simple `School` database.</span></span> <span data-ttu-id="f5941-241">Może się okazać, że zapytanie, które zbiera wszystkie potrzebne informacje w jednej instrukcji `Select` zawierającej wiele klauzul `Join`, jest zbyt skomplikowane, aby działała wydajnie.</span><span class="sxs-lookup"><span data-stu-id="f5941-241">You might find that a query that gathers all the information you need in a single `Select` statement containing multiple `Join` clauses becomes too complex to work efficiently.</span></span> <span data-ttu-id="f5941-242">W takim przypadku można przełączyć się z ładowania eager na jawne ładowanie, aby uprościć zapytanie.</span><span class="sxs-lookup"><span data-stu-id="f5941-242">In that case you can switch from eager loading to explicit loading to simplify the query.</span></span>

<span data-ttu-id="f5941-243">Na przykład spróbuj zmienić kod w metodzie `GetDepartmentsByName` w *SchoolRepository.cs*.</span><span class="sxs-lookup"><span data-stu-id="f5941-243">For example, try changing the code in the `GetDepartmentsByName` method in *SchoolRepository.cs*.</span></span> <span data-ttu-id="f5941-244">Obecnie w tej metodzie masz zapytanie obiektu, które ma `Include` metody dla właściwości nawigacji `Person` i `Courses`.</span><span class="sxs-lookup"><span data-stu-id="f5941-244">Currently in that method you have an object query that has `Include` methods for the `Person` and `Courses` navigation properties.</span></span> <span data-ttu-id="f5941-245">Zastąp instrukcję `return` kodem, który wykonuje jawne ładowanie, jak pokazano w następującym przykładzie:</span><span class="sxs-lookup"><span data-stu-id="f5941-245">Replace the `return` statement with code that performs explicit loading, as shown in the following example:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample14.cs)]

<span data-ttu-id="f5941-246">Uruchom stronę *działS. aspx* w debugerze i ponownie Sprawdź okno **IntelliTrace** , tak jak wcześniej.</span><span class="sxs-lookup"><span data-stu-id="f5941-246">Run the *Departments.aspx* page in the debugger and check the **IntelliTrace** window again as you did before.</span></span> <span data-ttu-id="f5941-247">Teraz, gdy wcześniej było jedno zapytanie, zobaczysz długą sekwencję.</span><span class="sxs-lookup"><span data-stu-id="f5941-247">Now, where there was a single query before, you see a long sequence of them.</span></span>

<span data-ttu-id="f5941-248">[![Image13](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image22.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="f5941-248">[![Image13](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image22.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image21.png)</span></span>

<span data-ttu-id="f5941-249">Kliknij pierwszy wiersz **ADO.NET** , aby zobaczyć, co się stało z zapytaniem złożonym wcześniej.</span><span class="sxs-lookup"><span data-stu-id="f5941-249">Click the first **ADO.NET** line to see what has happened to the complex query you viewed earlier.</span></span>

<span data-ttu-id="f5941-250">[![Image14](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image24.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="f5941-250">[![Image14](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image24.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image23.png)</span></span>

<span data-ttu-id="f5941-251">Zapytanie z działów stało się prostą `Select`ą kwerendą bez klauzuli `Join`, ale następuje oddzielne zapytania, które pobierają powiązane kursy i administratorów, przy użyciu zestawu dwóch zapytań dla każdego działu zwróconego przez oryginalne zapytanie.</span><span class="sxs-lookup"><span data-stu-id="f5941-251">The query from Departments has become a simple `Select` query with no `Join` clause, but it's followed by separate queries that retrieve related courses and an administrator, using a set of two queries for each department returned by the original query.</span></span>

> [!NOTE]
> <span data-ttu-id="f5941-252">W przypadku pozostawienia włączonego ładowania z opóźnieniem wzorzec widoczny w tym miejscu, z tym samym zapytaniem wielokrotnie, może wynikać z załadowania z opóźnieniem.</span><span class="sxs-lookup"><span data-stu-id="f5941-252">If you leave lazy loading enabled, the pattern you see here, with the same query repeated many times, might result from lazy loading.</span></span> <span data-ttu-id="f5941-253">Wzorzec, który zazwyczaj chcesz uniknąć, jest ładowaniem powiązanym z opóźnieniem dla każdego wiersza tabeli podstawowej.</span><span class="sxs-lookup"><span data-stu-id="f5941-253">A pattern that you typically want to avoid is lazy-loading related data for every row of the primary table.</span></span> <span data-ttu-id="f5941-254">O ile nie sprawdzono, że pojedyncze zapytanie sprzężenia jest zbyt złożone, aby było efektywne, zazwyczaj można poprawić wydajność w takich przypadkach, zmieniając zapytanie podstawowe w celu użycia ładowania eager.</span><span class="sxs-lookup"><span data-stu-id="f5941-254">Unless you've verified that a single join query is too complex to be efficient, you'd typically be able to improve performance in such cases by changing the primary query to use eager loading.</span></span>

## <a name="pre-generating-views"></a><span data-ttu-id="f5941-255">Wstępnie generowane widoki</span><span class="sxs-lookup"><span data-stu-id="f5941-255">Pre-Generating Views</span></span>

<span data-ttu-id="f5941-256">Gdy obiekt `ObjectContext` jest najpierw tworzony w nowej domenie aplikacji, Entity Framework generuje zestaw klas, które są używane w celu uzyskania dostępu do bazy danych.</span><span class="sxs-lookup"><span data-stu-id="f5941-256">When an `ObjectContext` object is first created in a new application domain, the Entity Framework generates a set of classes that it uses to access the database.</span></span> <span data-ttu-id="f5941-257">Klasy te są nazywane *widokami*, a jeśli masz bardzo duży model danych, generowanie tych widoków może opóźnić odpowiedź witryny sieci Web na pierwsze żądanie dla strony po zainicjowaniu nowej domeny aplikacji.</span><span class="sxs-lookup"><span data-stu-id="f5941-257">These classes are called *views*, and if you have a very large data model, generating these views can delay the web site's response to the first request for a page after a new application domain is initialized.</span></span> <span data-ttu-id="f5941-258">Możesz zmniejszyć to opóźnienie pierwszego żądania, tworząc widoki w czasie kompilacji, a nie w czasie wykonywania.</span><span class="sxs-lookup"><span data-stu-id="f5941-258">You can reduce this first-request delay by creating the views at compile time rather than at run time.</span></span>

> [!NOTE]
> <span data-ttu-id="f5941-259">Jeśli aplikacja nie ma bardzo dużego modelu danych lub jeśli ma duży model danych, ale nie ma żadnych problemów z wydajnością, które dotyczą tylko pierwszego żądania strony po odtworzeniu usług IIS, można pominąć tę sekcję.</span><span class="sxs-lookup"><span data-stu-id="f5941-259">If your application doesn't have an extremely large data model, or if it does have a large data model but you aren't concerned about a performance problem that affects only the very first page request after IIS is recycled, you can skip this section.</span></span> <span data-ttu-id="f5941-260">Tworzenie widoku nie odbywa się za każdym razem, gdy utworzysz wystąpienie `ObjectContext` obiektu, ponieważ widoki są buforowane w domenie aplikacji.</span><span class="sxs-lookup"><span data-stu-id="f5941-260">View creation doesn't happen every time you instantiate an `ObjectContext` object, because the views are cached in the application domain.</span></span> <span data-ttu-id="f5941-261">W związku z tym, o ile często nie odtwarzasz aplikacji w usługach IIS, bardzo kilka żądań stron będzie korzystać z wstępnie wygenerowanych widoków.</span><span class="sxs-lookup"><span data-stu-id="f5941-261">Therefore, unless you're frequently recycling your application in IIS, very few page requests would benefit from pre-generated views.</span></span>

<span data-ttu-id="f5941-262">Można wstępnie generować widoki przy użyciu narzędzia wiersza polecenia *EdmGen. exe* lub szablonu *zestawu narzędzi do przekształcania szablonu tekstu* (T4).</span><span class="sxs-lookup"><span data-stu-id="f5941-262">You can pre-generate views using the *EdmGen.exe* command-line tool or by using a *Text Template Transformation Toolkit* (T4) template.</span></span> <span data-ttu-id="f5941-263">W tym samouczku zostanie użyty szablon T4.</span><span class="sxs-lookup"><span data-stu-id="f5941-263">In this tutorial you'll use a T4 template.</span></span>

<span data-ttu-id="f5941-264">W folderze *dal* Dodaj plik za pomocą szablonu **szablonu tekstu** (znajduje się w węźle **Ogólne** na liście **zainstalowane szablony** ) i nadaj mu nazwę *SchoolModel.views.tt*.</span><span class="sxs-lookup"><span data-stu-id="f5941-264">In the *DAL* folder, add a file using the **Text Template** template (it's under the **General** node in the **Installed Templates** list), and name it *SchoolModel.Views.tt*.</span></span> <span data-ttu-id="f5941-265">Zastąp istniejący kod w pliku następującym kodem:</span><span class="sxs-lookup"><span data-stu-id="f5941-265">Replace the existing code in the file with the following code:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample15.cs)]

<span data-ttu-id="f5941-266">Ten kod generuje widoki dla pliku *. edmx* znajdującego się w tym samym folderze co szablon, który ma taką samą nazwę jak plik szablonu.</span><span class="sxs-lookup"><span data-stu-id="f5941-266">This code generates views for an *.edmx* file that's located in the same folder as the template and that has the same name as the template file.</span></span> <span data-ttu-id="f5941-267">Na przykład jeśli plik szablonu ma nazwę *SchoolModel.views.tt*, zostanie wyszukany plik modelu danych o nazwie *SchoolModel. edmx*.</span><span class="sxs-lookup"><span data-stu-id="f5941-267">For example, if your template file is named *SchoolModel.Views.tt*, it will look for a data model file named *SchoolModel.edmx*.</span></span>

<span data-ttu-id="f5941-268">Zapisz plik, a następnie kliknij prawym przyciskiem myszy plik w **Eksplorator rozwiązań** i wybierz polecenie **Uruchom narzędzie niestandardowe**.</span><span class="sxs-lookup"><span data-stu-id="f5941-268">Save the file, then right-click the file in **Solution Explorer** and select **Run Custom Tool**.</span></span>

<span data-ttu-id="f5941-269">[![Image02](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image26.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="f5941-269">[![Image02](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image26.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image25.png)</span></span>

<span data-ttu-id="f5941-270">Program Visual Studio generuje plik kodu, który tworzy widoki o nazwie *SchoolModel.views.cs* na podstawie szablonu.</span><span class="sxs-lookup"><span data-stu-id="f5941-270">Visual Studio generates a code file that creates the views, which is named *SchoolModel.Views.cs* based on the template.</span></span> <span data-ttu-id="f5941-271">(Być może zauważono, że plik kodu jest generowany nawet przed wybraniem opcji **Uruchom narzędzie niestandardowe**, gdy tylko zapiszesz plik szablonu).</span><span class="sxs-lookup"><span data-stu-id="f5941-271">(You might have noticed that the code file is generated even before you select **Run Custom Tool**, as soon as you save the template file.)</span></span>

<span data-ttu-id="f5941-272">[![Image01](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image28.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="f5941-272">[![Image01](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image28.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image27.png)</span></span>

<span data-ttu-id="f5941-273">Teraz można uruchomić aplikację i sprawdzić, czy działa ona tak jak wcześniej.</span><span class="sxs-lookup"><span data-stu-id="f5941-273">You can now run the application and verify that it works as it did before.</span></span>

<span data-ttu-id="f5941-274">Aby uzyskać więcej informacji dotyczących wstępnie wygenerowanych widoków, zobacz następujące zasoby:</span><span class="sxs-lookup"><span data-stu-id="f5941-274">For more information about pre-generated views, see the following resources:</span></span>

- <span data-ttu-id="f5941-275">[Instrukcje: wstępne Generowanie widoków w celu zwiększenia wydajności zapytań](https://msdn.microsoft.com/library/bb896240.aspx) w witrynie MSDN w sieci Web.</span><span class="sxs-lookup"><span data-stu-id="f5941-275">[How to: Pre-Generate Views to Improve Query Performance](https://msdn.microsoft.com/library/bb896240.aspx) on the MSDN web site.</span></span> <span data-ttu-id="f5941-276">Wyjaśnia, jak za pomocą narzędzia wiersza polecenia `EdmGen.exe` wstępnie generować widoki.</span><span class="sxs-lookup"><span data-stu-id="f5941-276">Explains how to use the `EdmGen.exe` command-line tool to pre-generate views.</span></span>
- <span data-ttu-id="f5941-277">[Izolowanie wydajności ze wstępnie skompilowanymi/wygenerowanymi widokami w Entity Framework 4](https://blogs.msdn.com/b/appfabriccat/archive/2010/08/06/isolating-performance-with-precompiled-pre-generated-views-in-the-entity-framework-4.aspx) w blogu zespołu ds. klientów systemu Windows Server AppFabric.</span><span class="sxs-lookup"><span data-stu-id="f5941-277">[Isolating Performance with Precompiled/Pre-generated Views in the Entity Framework 4](https://blogs.msdn.com/b/appfabriccat/archive/2010/08/06/isolating-performance-with-precompiled-pre-generated-views-in-the-entity-framework-4.aspx) on the Windows Server AppFabric Customer Advisory Team blog.</span></span>

<span data-ttu-id="f5941-278">To uzupełnia wprowadzenie do poprawy wydajności w aplikacji sieci Web ASP.NET, która używa Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="f5941-278">This completes the introduction to improving performance in an ASP.NET web application that uses the Entity Framework.</span></span> <span data-ttu-id="f5941-279">Więcej informacji można znaleźć w następujących zasobach:</span><span class="sxs-lookup"><span data-stu-id="f5941-279">For more information, see the following resources:</span></span>

- <span data-ttu-id="f5941-280">[Zagadnienia dotyczące wydajności (Entity Framework)](https://msdn.microsoft.com/library/cc853327.aspx) w witrynie MSDN w sieci Web.</span><span class="sxs-lookup"><span data-stu-id="f5941-280">[Performance Considerations (Entity Framework)](https://msdn.microsoft.com/library/cc853327.aspx) on the MSDN web site.</span></span>
- <span data-ttu-id="f5941-281">[Wpisy dotyczące wydajności w blogu zespołu Entity Framework](https://blogs.msdn.com/b/adonet/archive/tags/performance/).</span><span class="sxs-lookup"><span data-stu-id="f5941-281">[Performance-related posts on the Entity Framework Team blog](https://blogs.msdn.com/b/adonet/archive/tags/performance/).</span></span>
- <span data-ttu-id="f5941-282">[Opcje scalania EF i skompilowane zapytania](https://blogs.msdn.com/b/dsimmons/archive/2010/01/12/ef-merge-options-and-compiled-queries.aspx).</span><span class="sxs-lookup"><span data-stu-id="f5941-282">[EF Merge Options and Compiled Queries](https://blogs.msdn.com/b/dsimmons/archive/2010/01/12/ef-merge-options-and-compiled-queries.aspx).</span></span> <span data-ttu-id="f5941-283">Wpis w blogu, w którym objaśniono nieoczekiwane zachowania skompilowanych zapytań i opcji scalania, takich jak `NoTracking`.</span><span class="sxs-lookup"><span data-stu-id="f5941-283">Blog post that explains unexpected behaviors of compiled queries and merge options such as `NoTracking`.</span></span> <span data-ttu-id="f5941-284">Jeśli planujesz używać skompilowanych zapytań lub manipulujesz ustawieniami opcji scalania w aplikacji, przeczytaj ją jako pierwsze.</span><span class="sxs-lookup"><span data-stu-id="f5941-284">If you plan to use compiled queries or manipulate merge option settings in your application, read this first.</span></span>
- <span data-ttu-id="f5941-285">[Wpisy dotyczące Entity Framework w blogu zespołu ds. danych i modelowania klientów](https://blogs.msdn.com/b/dmcat/archive/tags/entity+framework/).</span><span class="sxs-lookup"><span data-stu-id="f5941-285">[Entity Framework-related posts in the Data and Modeling Customer Advisory Team blog](https://blogs.msdn.com/b/dmcat/archive/tags/entity+framework/).</span></span> <span data-ttu-id="f5941-286">Zawiera wpisy dotyczące skompilowanych zapytań i programu Visual Studio 2010 Profiler do odnajdywania problemów z wydajnością.</span><span class="sxs-lookup"><span data-stu-id="f5941-286">Includes posts on compiled queries and using the Visual Studio 2010 Profiler to discover performance issues.</span></span>
- <span data-ttu-id="f5941-287">[Entity Framework wątek forum z zaleceniami dotyczącymi poprawy wydajności wysoce złożonych zapytań](https://social.msdn.microsoft.com/Forums/adodotnetentityframework/thread/ffe8b2ab-c5b5-4331-8988-33a872d0b5f6).</span><span class="sxs-lookup"><span data-stu-id="f5941-287">[Entity Framework forum thread with advice on improving performance of highly complex queries](https://social.msdn.microsoft.com/Forums/adodotnetentityframework/thread/ffe8b2ab-c5b5-4331-8988-33a872d0b5f6).</span></span>
- <span data-ttu-id="f5941-288">[Zalecenia dotyczące zarządzania stanem ASP.NET](https://msdn.microsoft.com/library/z1hkazw7.aspx).</span><span class="sxs-lookup"><span data-stu-id="f5941-288">[ASP.NET State Management Recommendations](https://msdn.microsoft.com/library/z1hkazw7.aspx).</span></span>
- <span data-ttu-id="f5941-289">[Używanie Entity Framework i elementu ObjectDataSource: niestandardowe stronicowanie](http://geekswithblogs.net/Frez/articles/using-the-entity-framework-and-the-objectdatasource-custom-paging.aspx).</span><span class="sxs-lookup"><span data-stu-id="f5941-289">[Using the Entity Framework and the ObjectDataSource: Custom Paging](http://geekswithblogs.net/Frez/articles/using-the-entity-framework-and-the-objectdatasource-custom-paging.aspx).</span></span> <span data-ttu-id="f5941-290">Wpis w blogu, który kompiluje się w aplikacji ContosoUniversity utworzonej w tych samouczkach, aby wyjaśnić, jak zaimplementować stronicowanie na stronie *działS. aspx* .</span><span class="sxs-lookup"><span data-stu-id="f5941-290">Blog post that builds on the ContosoUniversity application created in these tutorials to explain how to implement paging in the *Departments.aspx* page.</span></span>

<span data-ttu-id="f5941-291">W następnym samouczku przedstawiono kilka ważnych ulepszeń Entity Framework, które są nowe w wersji 4.</span><span class="sxs-lookup"><span data-stu-id="f5941-291">The next tutorial reviews some of the important enhancements to the Entity Framework that are new in version 4.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="f5941-292">[Poprzednie](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application.md)
> [dalej](what-s-new-in-the-entity-framework-4.md)</span><span class="sxs-lookup"><span data-stu-id="f5941-292">[Previous](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application.md)
[Next](what-s-new-in-the-entity-framework-4.md)</span></span>
