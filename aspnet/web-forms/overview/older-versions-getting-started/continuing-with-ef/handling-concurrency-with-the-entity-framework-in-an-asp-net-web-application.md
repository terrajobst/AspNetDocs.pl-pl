---
uid: web-forms/overview/older-versions-getting-started/continuing-with-ef/handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application
title: Obsługa współbieżności przy użyciu programu Entity Framework 4.0 w aplikacji ASP.NET 4 Web | Dokumentacja firmy Microsoft
author: tdykstra
description: W tej serii samouczków opiera się na aplikacji sieci web firmy Contoso University, utworzony przez wprowadzenie do serii samouczków Entity Framework 4.0. I...
ms.author: riande
ms.date: 01/26/2011
ms.assetid: a5aa22a6-fb7f-4f41-9c7f-addda151940b
msc.legacyurl: /web-forms/overview/older-versions-getting-started/continuing-with-ef/handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application
msc.type: authoredcontent
ms.openlocfilehash: fc9ce539005bce1790c726dfb859305f4ff78a6b
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 04/17/2019
ms.locfileid: "59422567"
---
# <a name="handling-concurrency-with-the-entity-framework-40-in-an-aspnet-4-web-application"></a><span data-ttu-id="03877-104">Obsługa współbieżności przy użyciu programu Entity Framework 4.0 w aplikacji ASP.NET sieci Web 4</span><span class="sxs-lookup"><span data-stu-id="03877-104">Handling Concurrency with the Entity Framework 4.0 in an ASP.NET 4 Web Application</span></span>

<span data-ttu-id="03877-105">przez [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="03877-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="03877-106">W tej serii samouczków jest oparta na Contoso University aplikacji sieci web, który jest tworzony przez [rozpoczęcie korzystania z programu Entity Framework 4.0](https://asp.net/entity-framework/tutorials#Getting%20Started) serii samouczków.</span><span class="sxs-lookup"><span data-stu-id="03877-106">This tutorial series builds on the Contoso University web application that is created by the [Getting Started with the Entity Framework 4.0](https://asp.net/entity-framework/tutorials#Getting%20Started) tutorial series.</span></span> <span data-ttu-id="03877-107">Jeśli nie została ukończona wcześniej samouczki, jako punkt początkowy na potrzeby tego samouczka możesz [pobrać aplikację](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a) będzie utworzony.</span><span class="sxs-lookup"><span data-stu-id="03877-107">If you didn't complete the earlier tutorials, as a starting point for this tutorial you can [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a) that you would have created.</span></span> <span data-ttu-id="03877-108">Możesz również [pobrać aplikację](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) tworzone przez zakończenie serii samouczków.</span><span class="sxs-lookup"><span data-stu-id="03877-108">You can also [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) that is created by the complete tutorial series.</span></span> <span data-ttu-id="03877-109">Jeśli masz pytania dotyczące samouczków, możesz zamieścić je do [forum ASP.NET Entity Framework](https://forums.asp.net/1227.aspx).</span><span class="sxs-lookup"><span data-stu-id="03877-109">If you have questions about the tutorials, you can post them to the [ASP.NET Entity Framework forum](https://forums.asp.net/1227.aspx).</span></span>


<span data-ttu-id="03877-110">W poprzednim samouczku przedstawiono sposób sortowania i filtrowania danych przy użyciu `ObjectDataSource` kontroli i Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="03877-110">In the previous tutorial you learned how to sort and filter data using the `ObjectDataSource` control and the Entity Framework.</span></span> <span data-ttu-id="03877-111">Ten samouczek przedstawia opcje obsługi współbieżności w aplikacji sieci web ASP.NET, który używa programu Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="03877-111">This tutorial shows options for handling concurrency in an ASP.NET web application that uses the Entity Framework.</span></span> <span data-ttu-id="03877-112">Utworzysz nową stronę sieci web, przeznaczoną do aktualizowania przypisań office instruktora.</span><span class="sxs-lookup"><span data-stu-id="03877-112">You will create a new web page that's dedicated to updating instructor office assignments.</span></span> <span data-ttu-id="03877-113">Zajmiemy się problemy z współbieżności na tej stronie i na stronie działów, który został utworzony wcześniej.</span><span class="sxs-lookup"><span data-stu-id="03877-113">You'll handle concurrency issues in that page and in the Departments page that you created earlier.</span></span>

<span data-ttu-id="03877-114">[![Image06](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image2.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="03877-114">[![Image06](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image2.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image1.png)</span></span>

<span data-ttu-id="03877-115">[![Image01](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image4.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="03877-115">[![Image01](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image4.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image3.png)</span></span>

## <a name="concurrency-conflicts"></a><span data-ttu-id="03877-116">Konfliktów współbieżności</span><span class="sxs-lookup"><span data-stu-id="03877-116">Concurrency Conflicts</span></span>

<span data-ttu-id="03877-117">Występuje konflikt współbieżności, gdy jeden użytkownik edytuje rekord i inny użytkownik edytuje ten sam rekord, przed zapisaniem zmian pierwszego użytkownika do bazy danych.</span><span class="sxs-lookup"><span data-stu-id="03877-117">A concurrency conflict occurs when one user edits a record and another user edits the same record before the first user's change is written to the database.</span></span> <span data-ttu-id="03877-118">Jeśli nie skonfigurowano programu Entity Framework, aby wykryć takie konflikty, spojrzenia aktualizuje bazę danych ostatniego zastępuje zmiany wprowadzone przez użytkownika.</span><span class="sxs-lookup"><span data-stu-id="03877-118">If you don't set up the Entity Framework to detect such conflicts, whoever updates the database last overwrites the other user's changes.</span></span> <span data-ttu-id="03877-119">W wielu aplikacjach to zagrożenie jest dopuszczalne, a nie trzeba skonfigurować aplikację do obsługi konfliktów współbieżności możliwe.</span><span class="sxs-lookup"><span data-stu-id="03877-119">In many applications, this risk is acceptable, and you don't have to configure the application to handle possible concurrency conflicts.</span></span> <span data-ttu-id="03877-120">(Jeśli istnieją kilku użytkowników lub kilka aktualizacji lub nie jest tak naprawdę krytycznego, jeśli niektóre zmiany są zastępowane, koszt programowania współbieżność może przeważają korzyści.) Jeśli nie potrzebujesz już martwić się o konfliktów współbieżności, można pominąć ten samouczek; pozostałe dwie samouczków w serii nie należy polegać na coś, co tworzysz w tym obiekcie.</span><span class="sxs-lookup"><span data-stu-id="03877-120">(If there are few users, or few updates, or if isn't really critical if some changes are overwritten, the cost of programming for concurrency might outweigh the benefit.) If you don't need to worry about concurrency conflicts, you can skip this tutorial; the remaining two tutorials in the series don't depend on anything you build in this one.</span></span>

### <a name="pessimistic-concurrency-locking"></a><span data-ttu-id="03877-121">Współbieżność pesymistyczna (blokowanie)</span><span class="sxs-lookup"><span data-stu-id="03877-121">Pessimistic Concurrency (Locking)</span></span>

<span data-ttu-id="03877-122">Jeśli Twoja aplikacja wymaga uniknąć przypadkowej utraty danych w scenariuszach współbieżności, używają blokady bazy danych jest jednym ze sposobów, aby to zrobić.</span><span class="sxs-lookup"><span data-stu-id="03877-122">If your application does need to prevent accidental data loss in concurrency scenarios, one way to do that is to use database locks.</span></span> <span data-ttu-id="03877-123">Jest to nazywane *Współbieżność pesymistyczna*.</span><span class="sxs-lookup"><span data-stu-id="03877-123">This is called *pessimistic concurrency*.</span></span> <span data-ttu-id="03877-124">Na przykład przed przeczytaniem wiersz z bazy danych, możesz zażądać blokady dla tylko do odczytu lub uzyskać dostęp do aktualizacji.</span><span class="sxs-lookup"><span data-stu-id="03877-124">For example, before you read a row from a database, you request a lock for read-only or for update access.</span></span> <span data-ttu-id="03877-125">Jeśli zablokujesz wiersza dla dostępu do aktualizacji, inni użytkownicy nie mogą zablokować wiersza dla tylko do odczytu lub zaktualizować dostępu, ponieważ jaką uzyskują kopii danych, która jest w trakcie zmieniany.</span><span class="sxs-lookup"><span data-stu-id="03877-125">If you lock a row for update access, no other users are allowed to lock the row either for read-only or update access, because they would get a copy of data that's in the process of being changed.</span></span> <span data-ttu-id="03877-126">Jeśli zablokujesz wiersz, aby uzyskać dostęp tylko do odczytu, inne można również zablokować go uzyskać dostęp tylko do odczytu, ale nie dla aktualizacji.</span><span class="sxs-lookup"><span data-stu-id="03877-126">If you lock a row for read-only access, others can also lock it for read-only access but not for update.</span></span>

<span data-ttu-id="03877-127">Zarządzanie blokady ma pewne wady.</span><span class="sxs-lookup"><span data-stu-id="03877-127">Managing locks has some disadvantages.</span></span> <span data-ttu-id="03877-128">Może być skomplikowane, aby program.</span><span class="sxs-lookup"><span data-stu-id="03877-128">It can be complex to program.</span></span> <span data-ttu-id="03877-129">Wymaga znaczących bazy danych zarządzania zasobami, a jako liczbę użytkowników aplikacji może spowodować problemy z wydajnością zwiększa (czyli go nie jest dobrze skalowalna).</span><span class="sxs-lookup"><span data-stu-id="03877-129">It requires significant database management resources, and it can cause performance problems as the number of users of an application increases (that is, it doesn't scale well).</span></span> <span data-ttu-id="03877-130">Z tego względu nie wszystkie systemy zarządzania bazami danych obsługuje pesymistycznej współbieżności.</span><span class="sxs-lookup"><span data-stu-id="03877-130">For these reasons, not all database management systems support pessimistic concurrency.</span></span> <span data-ttu-id="03877-131">Entity Framework nie obsługuje wbudowanej go, a w tym samouczku nie pokazano, jak ją wdrożyć.</span><span class="sxs-lookup"><span data-stu-id="03877-131">The Entity Framework provides no built-in support for it, and this tutorial doesn't show you how to implement it.</span></span>

### <a name="optimistic-concurrency"></a><span data-ttu-id="03877-132">Optymistyczna współbieżność</span><span class="sxs-lookup"><span data-stu-id="03877-132">Optimistic Concurrency</span></span>

<span data-ttu-id="03877-133">Jest alternatywą do Współbieżność pesymistyczna *optymistycznej współbieżności*.</span><span class="sxs-lookup"><span data-stu-id="03877-133">The alternative to pessimistic concurrency is *optimistic concurrency*.</span></span> <span data-ttu-id="03877-134">Optymistyczna współbieżność oznacza, umożliwiając konfliktów współbieżności do wykonania, a następnie reagowaniu odpowiednio Jeśli tak jest.</span><span class="sxs-lookup"><span data-stu-id="03877-134">Optimistic concurrency means allowing concurrency conflicts to happen, and then reacting appropriately if they do.</span></span> <span data-ttu-id="03877-135">Na przykład Jan uruchamia *Department.aspx* strony, kliknięć **Edytuj** łączy dla działu historii, a także zmniejsza **budżetu** kwotę od 1,000,000.00 $ $ 125,000.00.</span><span class="sxs-lookup"><span data-stu-id="03877-135">For example, John runs the *Department.aspx* page, clicks the **Edit** link for the History department, and reduces the **Budget** amount from $1,000,000.00 to $125,000.00.</span></span> <span data-ttu-id="03877-136">(Jan zarządza dział konkurencyjnych i chce, aby zwolnić pieniądze własnej dział).</span><span class="sxs-lookup"><span data-stu-id="03877-136">(John administers a competing department and wants to free up money for his own department.)</span></span>

<span data-ttu-id="03877-137">[![Image07](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image6.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="03877-137">[![Image07](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image6.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image5.png)</span></span>

<span data-ttu-id="03877-138">Zanim Jan kliknie **aktualizacji**, Magdalena uruchamia tę samą stronę, kliknie **Edytuj** link dla działu historii, a następnie zmiany **Data rozpoczęcia** pola do 1/1/1/10/2011 1999.</span><span class="sxs-lookup"><span data-stu-id="03877-138">Before John clicks **Update**, Jane runs the same page, clicks the **Edit** link for the History department, and then changes the **Start Date** field from 1/10/2011 to 1/1/1999.</span></span> <span data-ttu-id="03877-139">(Magdalena zarządza dział historii i chce dać jej więcej związanych ze stażem pracy).</span><span class="sxs-lookup"><span data-stu-id="03877-139">(Jane administers the History department and wants to give it more seniority.)</span></span>

<span data-ttu-id="03877-140">[![Image08](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image8.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="03877-140">[![Image08](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image8.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image7.png)</span></span>

<span data-ttu-id="03877-141">John kliknie **aktualizacji** najpierw Magdalena klika **aktualizacji**.</span><span class="sxs-lookup"><span data-stu-id="03877-141">John clicks **Update** first, then Jane clicks **Update**.</span></span> <span data-ttu-id="03877-142">Wyświetla teraz przeglądarki Joanny **budżetu** jak $1,000,000.00, ale jest niepoprawna, ponieważ ilość zostało zmienione, Jan do 125,000.00 $.</span><span class="sxs-lookup"><span data-stu-id="03877-142">Jane's browser now lists the **Budget** amount as $1,000,000.00, but this is incorrect because the amount has been changed by John to $125,000.00.</span></span>

<span data-ttu-id="03877-143">Akcje, które można wykonać w tym scenariuszu między innymi następujące:</span><span class="sxs-lookup"><span data-stu-id="03877-143">Some of the actions you can take in this scenario include the following:</span></span>

- <span data-ttu-id="03877-144">Można zachować informacje o właściwości, które użytkownik zmodyfikował i aktualizować tylko odpowiednie kolumny w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="03877-144">You can keep track of which property a user has modified and update only the corresponding columns in the database.</span></span> <span data-ttu-id="03877-145">W przykładowym scenariuszu żadne dane nie zostałyby utracone, ponieważ inne właściwości zostały zaktualizowane przez dwóch użytkowników.</span><span class="sxs-lookup"><span data-stu-id="03877-145">In the example scenario, no data would be lost, because different properties were updated by the two users.</span></span> <span data-ttu-id="03877-146">Przy następnym przegląda ktoś z działu historii, zobaczy 1/1/1999 i 125,000.00 $.</span><span class="sxs-lookup"><span data-stu-id="03877-146">The next time someone browses the History department, they will see 1/1/1999 and $125,000.00.</span></span> 

    <span data-ttu-id="03877-147">Jest to domyślne zachowanie platformy Entity Framework, a jej znacznie zmniejszyć liczbę konfliktów, które może spowodować utratę danych.</span><span class="sxs-lookup"><span data-stu-id="03877-147">This is the default behavior in the Entity Framework, and it can substantially reduce the number of conflicts that could result in data loss.</span></span> <span data-ttu-id="03877-148">Jednak to zachowanie nie uniknąć utraty danych, jeśli konkurencyjnych zmiany zostały wprowadzone w tej samej właściwości jednostki.</span><span class="sxs-lookup"><span data-stu-id="03877-148">However, this behavior doesn't avoid data loss if competing changes are made to the same property of an entity.</span></span> <span data-ttu-id="03877-149">Ponadto to zachowanie nie zawsze jest możliwe; Kiedy mapujesz procedur składowanych dla typu jednostki wszystkich właściwości obiektu są aktualizowane, po dokonaniu zmiany do jednostki w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="03877-149">In addition, this behavior isn't always possible; when you map stored procedures to an entity type, all of an entity's properties are updated when any changes to the entity are made in the database.</span></span>
- <span data-ttu-id="03877-150">Można pozwolić, aby zmiana Joanny zastąpienie John's zmian.</span><span class="sxs-lookup"><span data-stu-id="03877-150">You can let Jane's change overwrite John's change.</span></span> <span data-ttu-id="03877-151">Po kliknięciu Magdalena **aktualizacji**, **budżetu** kwota powraca do 1,000,000.00 $.</span><span class="sxs-lookup"><span data-stu-id="03877-151">After Jane clicks **Update**, the **Budget** amount goes back to $1,000,000.00.</span></span> <span data-ttu-id="03877-152">Jest to nazywane *Wins klienta* lub *ostatnie w usłudze Wins* scenariusza.</span><span class="sxs-lookup"><span data-stu-id="03877-152">This is called a *Client Wins* or *Last in Wins* scenario.</span></span> <span data-ttu-id="03877-153">(Wartości klienta pierwszeństwo co znajduje się w magazynie danych.)</span><span class="sxs-lookup"><span data-stu-id="03877-153">(The client's values take precedence over what's in the data store.)</span></span>
- <span data-ttu-id="03877-154">Aby uniemożliwić zmiany Joanny aktualizowane w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="03877-154">You can prevent Jane's change from being updated in the database.</span></span> <span data-ttu-id="03877-155">Zazwyczaj będzie wyświetlony komunikat o błędzie, pokazywać bieżący stan danych i umożliwienia jej uzyskania ponownie wprowadzić swoje zmiany, jeśli chce nadal były.</span><span class="sxs-lookup"><span data-stu-id="03877-155">Typically, you would display an error message, show her the current state of the data, and allow her to reenter her changes if she still wants to make them.</span></span> <span data-ttu-id="03877-156">Można dodatkowo zautomatyzować ten proces, zapisując jej danych wejściowych i zapewniając jej możliwość Zastosuj je ponownie bez konieczności ponownego wprowadzania go.</span><span class="sxs-lookup"><span data-stu-id="03877-156">You could further automate the process by saving her input and giving her an opportunity to reapply it without having to reenter it.</span></span> <span data-ttu-id="03877-157">Jest to nazywane *Store Wins* scenariusza.</span><span class="sxs-lookup"><span data-stu-id="03877-157">This is called a *Store Wins* scenario.</span></span> <span data-ttu-id="03877-158">(Wartości magazynu danych pierwszeństwo wartości przesłany przez klienta.)</span><span class="sxs-lookup"><span data-stu-id="03877-158">(The data-store values take precedence over the values submitted by the client.)</span></span>

### <a name="detecting-concurrency-conflicts"></a><span data-ttu-id="03877-159">Wykrywanie konfliktów współbieżności</span><span class="sxs-lookup"><span data-stu-id="03877-159">Detecting Concurrency Conflicts</span></span>

<span data-ttu-id="03877-160">W ramach jednostki może rozwiązać konflikty, obsługując `OptimisticConcurrencyException` wyjątki, które zgłasza Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="03877-160">In the Entity Framework, you can resolve conflicts by handling `OptimisticConcurrencyException` exceptions that the Entity Framework throws.</span></span> <span data-ttu-id="03877-161">Aby wiedzieć, kiedy trzeba generować te wyjątki, platformy Entity Framework musi umożliwiać wykrywanie konfliktów.</span><span class="sxs-lookup"><span data-stu-id="03877-161">In order to know when to throw these exceptions, the Entity Framework must be able to detect conflicts.</span></span> <span data-ttu-id="03877-162">W związku z tym należy skonfigurować bazy danych oraz model danych odpowiednio.</span><span class="sxs-lookup"><span data-stu-id="03877-162">Therefore, you must configure the database and the data model appropriately.</span></span> <span data-ttu-id="03877-163">Niektóre opcje umożliwiające wykrywanie konfliktów są następujące:</span><span class="sxs-lookup"><span data-stu-id="03877-163">Some options for enabling conflict detection include the following:</span></span>

- <span data-ttu-id="03877-164">W bazie danych zawierają kolumny tabeli, który może służyć do określania, kiedy wiersz został zmieniony.</span><span class="sxs-lookup"><span data-stu-id="03877-164">In the database, include a table column that can be used to determine when a row has been changed.</span></span> <span data-ttu-id="03877-165">Następnie można skonfigurować programu Entity Framework, aby uwzględnić tej kolumny w `Where` klauzuli SQL `Update` lub `Delete` poleceń.</span><span class="sxs-lookup"><span data-stu-id="03877-165">You can then configure the Entity Framework to include that column in the `Where` clause of SQL `Update` or `Delete` commands.</span></span>

    <span data-ttu-id="03877-166">Jest celem `Timestamp` kolumny w `OfficeAssignment` tabeli.</span><span class="sxs-lookup"><span data-stu-id="03877-166">That's the purpose of the `Timestamp` column in the `OfficeAssignment` table.</span></span>

    <span data-ttu-id="03877-167">[![Image09](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image10.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="03877-167">[![Image09](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image10.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image9.png)</span></span>

    <span data-ttu-id="03877-168">Typ danych `Timestamp` kolumny jest również nazywany `Timestamp`.</span><span class="sxs-lookup"><span data-stu-id="03877-168">The data type of the `Timestamp` column is also called `Timestamp`.</span></span> <span data-ttu-id="03877-169">Jednak kolumna faktycznie nie zawiera wartości daty i godziny.</span><span class="sxs-lookup"><span data-stu-id="03877-169">However, the column doesn't actually contain a date or time value.</span></span> <span data-ttu-id="03877-170">Zamiast tego wartość numeru sekwencyjnego, który jest zwiększana za każdym razem, wiersz jest aktualizowany.</span><span class="sxs-lookup"><span data-stu-id="03877-170">Instead, the value is a sequential number that's incremented each time the row is updated.</span></span> <span data-ttu-id="03877-171">W `Update` lub `Delete` polecenia `Where` klauzula zawiera oryginalny `Timestamp` wartość.</span><span class="sxs-lookup"><span data-stu-id="03877-171">In an `Update` or `Delete` command, the `Where` clause includes the original `Timestamp` value.</span></span> <span data-ttu-id="03877-172">Jeśli aktualizacji wiersza został zmieniony przez innego użytkownika, wartość w `Timestamp` różni się od oryginalnej wartości, więc `Where` klauzula zwraca nie wiersza do zaktualizowania.</span><span class="sxs-lookup"><span data-stu-id="03877-172">If the row being updated has been changed by another user, the value in `Timestamp` is different than the original value, so the `Where` clause returns no row to update.</span></span> <span data-ttu-id="03877-173">Gdy Entity Framework wykryje, czy żadne wiersze nie zostały zaktualizowane przez bieżącą `Update` lub `Delete` polecenie (to znaczy, gdy liczba wierszy, których to dotyczy, jest równy zero), który interpretuje jako konflikt współbieżności.</span><span class="sxs-lookup"><span data-stu-id="03877-173">When the Entity Framework finds that no rows have been updated by the current `Update` or `Delete` command (that is, when the number of affected rows is zero), it interprets that as a concurrency conflict.</span></span>
- <span data-ttu-id="03877-174">Konfigurowanie programu Entity Framework, aby uwzględnić oryginalnych wartości każdej kolumny w tabeli w `Where` klauzuli `Update` i `Delete` poleceń.</span><span class="sxs-lookup"><span data-stu-id="03877-174">Configure the Entity Framework to include the original values of every column in the table in the `Where` clause of `Update` and `Delete` commands.</span></span>

    <span data-ttu-id="03877-175">Tak jak w pierwszej opcji, jeśli nic w wierszu zmieniła się od wiersza została najpierw przeczytać artykuł `Where` klauzuli nie zwraca wiersz, aby zaktualizować, której platformy Entity Framework interpretuje jako konflikt współbieżności.</span><span class="sxs-lookup"><span data-stu-id="03877-175">As in the first option, if anything in the row has changed since the row was first read, the `Where` clause won't return a row to update, which the Entity Framework interprets as a concurrency conflict.</span></span> <span data-ttu-id="03877-176">Ta metoda jest tak skuteczne, jak za pomocą `Timestamp` pola, ale może być mało wydajne.</span><span class="sxs-lookup"><span data-stu-id="03877-176">This method is as effective as using a `Timestamp` field, but can be inefficient.</span></span> <span data-ttu-id="03877-177">W przypadku tabel bazy danych, które mają wiele kolumn, może to skutkować bardzo dużych `Where` zdań, i w aplikacji sieci web go wymagać obsługi dużych ilości stanu.</span><span class="sxs-lookup"><span data-stu-id="03877-177">For database tables that have many columns, it can result in very large `Where` clauses, and in a web application it can require that you maintain large amounts of state.</span></span> <span data-ttu-id="03877-178">Obsługa dużych ilości stanu może wpłynąć na wydajność aplikacji ponieważ go wymaga zasobów serwera (na przykład stan sesji) albo muszą być zawarte w tej strony (na przykład stan widoku).</span><span class="sxs-lookup"><span data-stu-id="03877-178">Maintaining large amounts of state can affect application performance because it either requires server resources (for example, session state) or must be included in the web page itself (for example, view state).</span></span>

<span data-ttu-id="03877-179">W tym samouczku dodasz obsługę błędów dla konfliktów optymistycznej współbieżności dla jednostki, która nie ma właściwości śledzenia ( `Department` jednostek) i jednostki, która zawiera właściwości śledzenia ( `OfficeAssignment` jednostek).</span><span class="sxs-lookup"><span data-stu-id="03877-179">In this tutorial you will add error handling for optimistic concurrency conflicts for an entity that doesn't have a tracking property (the `Department` entity) and for an entity that does have a tracking property (the `OfficeAssignment` entity).</span></span>

## <a name="handling-optimistic-concurrency-without-a-tracking-property"></a><span data-ttu-id="03877-180">Obsługa optymistycznej współbieżności bez właściwości śledzenia</span><span class="sxs-lookup"><span data-stu-id="03877-180">Handling Optimistic Concurrency Without a Tracking Property</span></span>

<span data-ttu-id="03877-181">Na potrzeby optymistycznej współbieżności dla `Department` jednostki, która nie ma śledzenia (`Timestamp`) właściwość, zostaną wykonane następujące zadania:</span><span class="sxs-lookup"><span data-stu-id="03877-181">To implement optimistic concurrency for the `Department` entity, which doesn't have a tracking (`Timestamp`) property, you will complete the following tasks:</span></span>

- <span data-ttu-id="03877-182">Zmień model danych, aby włączyć śledzenie współbieżności `Department` jednostek.</span><span class="sxs-lookup"><span data-stu-id="03877-182">Change the data model to enable concurrency tracking for `Department` entities.</span></span>
- <span data-ttu-id="03877-183">W `SchoolRepository` klasy uchwyt wyjątki współbieżności w `SaveChanges` metody.</span><span class="sxs-lookup"><span data-stu-id="03877-183">In the `SchoolRepository` class, handle concurrency exceptions in the `SaveChanges` method.</span></span>
- <span data-ttu-id="03877-184">W *Departments.aspx* strony uchwytu wyjątki współbieżności, poprzez wyświetlenie komunikatu do użytkownika, ostrzeżenie, że próba zmiany zakończyły się niepowodzeniem.</span><span class="sxs-lookup"><span data-stu-id="03877-184">In the *Departments.aspx* page, handle concurrency exceptions by displaying a message to the user warning that the attempted changes were unsuccessful.</span></span> <span data-ttu-id="03877-185">Użytkownik może następnie wyświetlić bieżące wartości i ponów próbę zmiany, jeśli są one nadal potrzebne.</span><span class="sxs-lookup"><span data-stu-id="03877-185">The user can then see the current values and retry the changes if they are still needed.</span></span>

### <a name="enabling-concurrency-tracking-in-the-data-model"></a><span data-ttu-id="03877-186">Włączanie śledzenia w modelu danych współbieżności</span><span class="sxs-lookup"><span data-stu-id="03877-186">Enabling Concurrency Tracking in the Data Model</span></span>

<span data-ttu-id="03877-187">W programie Visual Studio Otwórz aplikację sieci web firmy Contoso University, która pracowano w poprzednim samouczku z tej serii.</span><span class="sxs-lookup"><span data-stu-id="03877-187">In Visual Studio, open the Contoso University web application that you were working with in the previous tutorial in this series.</span></span>

<span data-ttu-id="03877-188">Otwórz *SchoolModel.edmx*i w Projektancie modeli danych, kliknij prawym przyciskiem myszy `Name` właściwość `Department` jednostki, a następnie kliknij przycisk **właściwości**.</span><span class="sxs-lookup"><span data-stu-id="03877-188">Open *SchoolModel.edmx*, and in the data model designer, right-click the `Name` property in the `Department` entity and then click **Properties**.</span></span> <span data-ttu-id="03877-189">W **właściwości** oknie zmiany `ConcurrencyMode` właściwość `Fixed`.</span><span class="sxs-lookup"><span data-stu-id="03877-189">In the **Properties** window, change the `ConcurrencyMode` property to `Fixed`.</span></span>

<span data-ttu-id="03877-190">[![Image16](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image12.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="03877-190">[![Image16](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image12.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image11.png)</span></span>

<span data-ttu-id="03877-191">Zrób to samo dla innych właściwości skalarne bez klucza podstawowego (`Budget`, `StartDate`, i `Administrator`.) (Nie możesz tego zrobić dla właściwości nawigacji.) Określa, że zawsze, gdy platforma Entity Framework generuje `Update` lub `Delete` polecenie SQL aktualizujące `Department` jednostek w bazie danych, te kolumny (z oryginalnych wartości) musi być uwzględniona w `Where` klauzuli.</span><span class="sxs-lookup"><span data-stu-id="03877-191">Do the same for the other non-primary-key scalar properties (`Budget`, `StartDate`, and `Administrator`.) (You can't do this for navigation properties.) This specifies that whenever the Entity Framework generates a `Update` or `Delete` SQL command to update the `Department` entity in the database, these columns (with original values) must be included in the `Where` clause.</span></span> <span data-ttu-id="03877-192">Jeśli żaden wiersz nie zostanie znaleziony, kiedy `Update` lub `Delete` polecenie wykonuje, platformy Entity Framework spowoduje zgłoszenie wyjątku optymistycznej współbieżności.</span><span class="sxs-lookup"><span data-stu-id="03877-192">If no row is found when the `Update` or `Delete` command executes, the Entity Framework will throw an optimistic-concurrency exception.</span></span>

<span data-ttu-id="03877-193">Zapisz i zamknij modelu danych.</span><span class="sxs-lookup"><span data-stu-id="03877-193">Save and close the data model.</span></span>

### <a name="handling-concurrency-exceptions-in-the-dal"></a><span data-ttu-id="03877-194">Obsługa wyjątków współbieżności na warstwy DAL</span><span class="sxs-lookup"><span data-stu-id="03877-194">Handling Concurrency Exceptions in the DAL</span></span>

<span data-ttu-id="03877-195">Otwórz *SchoolRepository.cs* i dodaj następującą `using` poufności informacji dotyczące `System.Data` przestrzeni nazw:</span><span class="sxs-lookup"><span data-stu-id="03877-195">Open *SchoolRepository.cs* and add the following `using` statement for the `System.Data` namespace:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample1.cs)]

<span data-ttu-id="03877-196">Dodaj następujące nowe `SaveChanges` metody, która obsługuje wyjątki optymistycznej współbieżności:</span><span class="sxs-lookup"><span data-stu-id="03877-196">Add the following new `SaveChanges` method, which handles optimistic concurrency exceptions:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample2.cs)]

<span data-ttu-id="03877-197">Jeśli wystąpi błąd współbieżności, gdy ta metoda jest wywoływana, wartości właściwości obiektu w pamięci są zastępowane wartościami znajdujących się obecnie w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="03877-197">If a concurrency error occurs when this method is called, the property values of the entity in memory are replaced with the values currently in the database.</span></span> <span data-ttu-id="03877-198">Wyjątku współbieżności jest zgłaszany ponownie, tak aby można go obsłużyć, strony sieci web.</span><span class="sxs-lookup"><span data-stu-id="03877-198">The concurrency exception is rethrown so that the web page can handle it.</span></span>

<span data-ttu-id="03877-199">W `DeleteDepartment` i `UpdateDepartment` metod, Zastąp wywołanie istniejących `context.SaveChanges()` wywołaniem `SaveChanges()` aby wywołać nową metodę.</span><span class="sxs-lookup"><span data-stu-id="03877-199">In the `DeleteDepartment` and `UpdateDepartment` methods, replace the existing call to `context.SaveChanges()` with a call to `SaveChanges()` in order to invoke the new method.</span></span>

### <a name="handling-concurrency-exceptions-in-the-presentation-layer"></a><span data-ttu-id="03877-200">Obsługa wyjątków współbieżności w warstwie prezentacji</span><span class="sxs-lookup"><span data-stu-id="03877-200">Handling Concurrency Exceptions in the Presentation Layer</span></span>

<span data-ttu-id="03877-201">Otwórz *Departments.aspx* i Dodaj `OnDeleted="DepartmentsObjectDataSource_Deleted"` atrybutu `DepartmentsObjectDataSource` kontroli.</span><span class="sxs-lookup"><span data-stu-id="03877-201">Open *Departments.aspx* and add an `OnDeleted="DepartmentsObjectDataSource_Deleted"` attribute to the `DepartmentsObjectDataSource` control.</span></span> <span data-ttu-id="03877-202">Otwierający tag dla formantu będzie teraz wyglądać następująco.</span><span class="sxs-lookup"><span data-stu-id="03877-202">The opening tag for the control will now resemble the following example.</span></span>

[!code-aspx[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample3.aspx)]

<span data-ttu-id="03877-203">W `DepartmentsGridView` sterowania, wybierz opcję Wszystkie kolumny tabeli w `DataKeyNames` atrybutu, jak pokazano w poniższym przykładzie.</span><span class="sxs-lookup"><span data-stu-id="03877-203">In the `DepartmentsGridView` control, specify all of the table columns in the `DataKeyNames` attribute, as shown in the following example.</span></span> <span data-ttu-id="03877-204">Należy pamiętać, że spowoduje to utworzenie widoku bardzo dużych pól stanu który jest jednym z powodów dlaczego za pomocą pola śledzenia ogólnie jest preferowanym sposobem śledzenia konfliktów współbieżności.</span><span class="sxs-lookup"><span data-stu-id="03877-204">Note that this will create very large view state fields, which is one reason why using a tracking field is generally the preferred way to track concurrency conflicts.</span></span>

[!code-aspx[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample4.aspx)]

<span data-ttu-id="03877-205">Otwórz *Departments.aspx.cs* i dodaj następującą `using` poufności informacji dotyczące `System.Data` przestrzeni nazw:</span><span class="sxs-lookup"><span data-stu-id="03877-205">Open *Departments.aspx.cs* and add the following `using` statement for the `System.Data` namespace:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample5.cs)]

<span data-ttu-id="03877-206">Dodaj następującą nową metodę, która będzie wywoływać z poziomu kontroli źródła danych `Updated` i `Deleted` programy obsługi zdarzeń dla obsługi wyjątków współbieżności:</span><span class="sxs-lookup"><span data-stu-id="03877-206">Add the following new method, which you will call from the data source control's `Updated` and `Deleted` event handlers for handling concurrency exceptions:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample6.cs)]

<span data-ttu-id="03877-207">Ten kod sprawdza, czy typ wyjątku, a jeśli wyjątku współbieżności, ten kod tworzy dynamicznie `CustomValidator` formant, który z kolei wyświetla komunikat w `ValidationSummary` kontroli.</span><span class="sxs-lookup"><span data-stu-id="03877-207">This code checks the exception type, and if it's a concurrency exception, the code dynamically creates a `CustomValidator` control that in turn displays a message in the `ValidationSummary` control.</span></span>

<span data-ttu-id="03877-208">Wywołaj metodę nowe z `Updated` program obsługi zdarzeń, który dodano wcześniej.</span><span class="sxs-lookup"><span data-stu-id="03877-208">Call the new method from the `Updated` event handler that you added earlier.</span></span> <span data-ttu-id="03877-209">Ponadto, należy utworzyć nową `Deleted` obsługi zdarzeń, który wywołuje tej samej metody (ale nie robi nic innego):</span><span class="sxs-lookup"><span data-stu-id="03877-209">In addition, create a new `Deleted` event handler that calls the same method (but doesn't do anything else):</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample7.cs)]

### <a name="testing-optimistic-concurrency-in-the-departments-page"></a><span data-ttu-id="03877-210">Testowanie optymistycznej współbieżności na stronie działów</span><span class="sxs-lookup"><span data-stu-id="03877-210">Testing Optimistic Concurrency in the Departments Page</span></span>

<span data-ttu-id="03877-211">Uruchom *Departments.aspx* strony.</span><span class="sxs-lookup"><span data-stu-id="03877-211">Run the *Departments.aspx* page.</span></span>

<span data-ttu-id="03877-212">[![Image17](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image14.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="03877-212">[![Image17](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image14.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image13.png)</span></span>

<span data-ttu-id="03877-213">Kliknij przycisk **Edytuj** w wierszu i zmień wartość w **budżetu** kolumny.</span><span class="sxs-lookup"><span data-stu-id="03877-213">Click **Edit** in a row and change the value in the **Budget** column.</span></span> <span data-ttu-id="03877-214">(Należy pamiętać, że możesz edytować tylko rekordy utworzone na potrzeby tego samouczka, ponieważ istniejące `School` rekordów bazy danych zawiera niektóre nieprawidłowe dane.</span><span class="sxs-lookup"><span data-stu-id="03877-214">(Remember that you can only edit records that you've created for this tutorial, because the existing `School` database records contain some invalid data.</span></span> <span data-ttu-id="03877-215">Rekord dla działu ekonomii jest bezpieczne, aby eksperymentować z).</span><span class="sxs-lookup"><span data-stu-id="03877-215">The record for the Economics department is a safe one to experiment with.)</span></span>

<span data-ttu-id="03877-216">[![Image18](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image16.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="03877-216">[![Image18](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image16.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image15.png)</span></span>

<span data-ttu-id="03877-217">Otwórz nowe okno przeglądarki i uruchom ponownie strony (Kopiuj adres URL z pola adresu pierwsze okno przeglądarki, aby drugie okno przeglądarki).</span><span class="sxs-lookup"><span data-stu-id="03877-217">Open a new browser window and run the page again (copy the URL from the first browser window's address box to the second browser window).</span></span>

<span data-ttu-id="03877-218">[![Image17](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image18.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="03877-218">[![Image17](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image18.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image17.png)</span></span>

<span data-ttu-id="03877-219">Kliknij przycisk **Edytuj** w tym samym wierszu, możesz edytować wcześniej i zmień **budżetu** wartości na coś innego.</span><span class="sxs-lookup"><span data-stu-id="03877-219">Click **Edit** in the same row you edited earlier and change the **Budget** value to something different.</span></span>

<span data-ttu-id="03877-220">[![Image19](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image20.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="03877-220">[![Image19](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image20.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image19.png)</span></span>

<span data-ttu-id="03877-221">W drugim oknie przeglądarki, kliknij przycisk **aktualizacji**.</span><span class="sxs-lookup"><span data-stu-id="03877-221">In the second browser window, click **Update**.</span></span> <span data-ttu-id="03877-222">**Budżetu** kwota jest pomyślnie zmieniono na tę nową wartość.</span><span class="sxs-lookup"><span data-stu-id="03877-222">The **Budget** amount is successfully changed to this new value.</span></span>

<span data-ttu-id="03877-223">[![Image20](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image22.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="03877-223">[![Image20](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image22.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image21.png)</span></span>

<span data-ttu-id="03877-224">W pierwszym oknie przeglądarki, kliknij przycisk **aktualizacji**.</span><span class="sxs-lookup"><span data-stu-id="03877-224">In the first browser window, click **Update**.</span></span> <span data-ttu-id="03877-225">Aktualizacja nie powiodła się.</span><span class="sxs-lookup"><span data-stu-id="03877-225">The update fails.</span></span> <span data-ttu-id="03877-226">**Budżetu** kwota zostanie wyświetlony ponownie przy użyciu wartość ustawiona w drugim oknie przeglądarki, a następnie zostanie wyświetlony komunikat o błędzie.</span><span class="sxs-lookup"><span data-stu-id="03877-226">The **Budget** amount is redisplayed using the value you set in the second browser window, and you see an error message.</span></span>

<span data-ttu-id="03877-227">[![Image21](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image24.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="03877-227">[![Image21](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image24.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image23.png)</span></span>

## <a name="handling-optimistic-concurrency-using-a-tracking-property"></a><span data-ttu-id="03877-228">Obsługa optymistycznej współbieżności przy użyciu właściwości śledzenia</span><span class="sxs-lookup"><span data-stu-id="03877-228">Handling Optimistic Concurrency Using a Tracking Property</span></span>

<span data-ttu-id="03877-229">Aby obsłużyć optymistycznej współbieżności dla jednostki, która ma właściwości śledzenia, wykonasz następujące zadania:</span><span class="sxs-lookup"><span data-stu-id="03877-229">To handle optimistic concurrency for an entity that has a tracking property, you will complete the following tasks:</span></span>

- <span data-ttu-id="03877-230">Dodawaj procedury składowane do modelu danych, aby zarządzać `OfficeAssignment` jednostek.</span><span class="sxs-lookup"><span data-stu-id="03877-230">Add stored procedures to the data model to manage `OfficeAssignment` entities.</span></span> <span data-ttu-id="03877-231">(Właściwości śledzenia i procedur składowanych, które nie mają być używane razem; są one po prostu grupowane razem w tym miejscu do celów ilustracyjnych).</span><span class="sxs-lookup"><span data-stu-id="03877-231">(Tracking properties and stored procedures don't have to be used together; they're just grouped together here for illustration.)</span></span>
- <span data-ttu-id="03877-232">Dodaj metody CRUD warstwy DAL i LOGIKI dla `OfficeAssignment` jednostkami, w tym kod służący do obsługi wyjątków optymistycznej współbieżności w warstwy DAL.</span><span class="sxs-lookup"><span data-stu-id="03877-232">Add CRUD methods to the DAL and the BLL for `OfficeAssignment` entities, including code to handle optimistic concurrency exceptions in the DAL.</span></span>
- <span data-ttu-id="03877-233">Utwórz stronę sieci web pakietu office przypisania.</span><span class="sxs-lookup"><span data-stu-id="03877-233">Create an office-assignments web page.</span></span>
- <span data-ttu-id="03877-234">Przetestuj optymistycznej współbieżności w nową stronę sieci web.</span><span class="sxs-lookup"><span data-stu-id="03877-234">Test optimistic concurrency in the new web page.</span></span>

### <a name="adding-officeassignment-stored-procedures-to-the-data-model"></a><span data-ttu-id="03877-235">Dodawanie OfficeAssignment procedury składowane do modelu danych</span><span class="sxs-lookup"><span data-stu-id="03877-235">Adding OfficeAssignment Stored Procedures to the Data Model</span></span>

<span data-ttu-id="03877-236">Otwórz *SchoolModel.edmx* pliku w Projektancie modeli, kliknij prawym przyciskiem myszy powierzchnię projektu, a następnie kliknij przycisk **Model aktualizacji z bazy danych**.</span><span class="sxs-lookup"><span data-stu-id="03877-236">Open the *SchoolModel.edmx* file in the model designer, right-click the design surface, and click **Update Model from Database**.</span></span> <span data-ttu-id="03877-237">W **Dodaj** karcie **wybierz obiekty bazy danych** okna dialogowego rozwiń **procedur składowanych** i wybrać trzy `OfficeAssignment` procedur składowanych (zobacz Po zrzut ekranu), a następnie kliknij przycisk **Zakończ**.</span><span class="sxs-lookup"><span data-stu-id="03877-237">In the **Add** tab of the **Choose Your Database Objects** dialog box, expand **Stored Procedures** and select the three `OfficeAssignment` stored procedures (see the following screenshot), and then click **Finish**.</span></span> <span data-ttu-id="03877-238">(Tych procedur przechowywanych już w bazie danych podczas zostały pobrane lub utworzone za pomocą skryptu.)</span><span class="sxs-lookup"><span data-stu-id="03877-238">(These stored procedures were already in the database when you downloaded or created it using a script.)</span></span>

<span data-ttu-id="03877-239">[![Image02](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image26.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="03877-239">[![Image02](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image26.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image25.png)</span></span>

<span data-ttu-id="03877-240">Kliknij prawym przyciskiem myszy `OfficeAssignment` jednostki, a następnie wybierz pozycję **mapowanie procedur przechowywanych**.</span><span class="sxs-lookup"><span data-stu-id="03877-240">Right-click the `OfficeAssignment` entity and select **Stored Procedure Mapping**.</span></span>

<span data-ttu-id="03877-241">[![Image03](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image28.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="03877-241">[![Image03](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image28.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image27.png)</span></span>

<span data-ttu-id="03877-242">Ustaw **Wstaw**, **aktualizacji**, i **Usuń** funkcje do użycia, odpowiadające im procedur składowanych.</span><span class="sxs-lookup"><span data-stu-id="03877-242">Set the **Insert**, **Update**, and **Delete** functions to use their corresponding stored procedures.</span></span> <span data-ttu-id="03877-243">Dla `OrigTimestamp` parametru `Update` funkcji, należy ustawić **właściwość** do `Timestamp` i wybierz **Użyj oryginalnej wartości** opcji.</span><span class="sxs-lookup"><span data-stu-id="03877-243">For the `OrigTimestamp` parameter of the `Update` function, set the **Property** to `Timestamp` and select the **Use Original Value** option.</span></span>

<span data-ttu-id="03877-244">[![Image04](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image30.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="03877-244">[![Image04](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image30.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image29.png)</span></span>

<span data-ttu-id="03877-245">Kiedy wywołuje Entity Framework `UpdateOfficeAssignment` procedury składowanej, zostaną przetworzone oryginalnej wartości elementu `Timestamp` kolumny w `OrigTimestamp` parametru.</span><span class="sxs-lookup"><span data-stu-id="03877-245">When the Entity Framework calls the `UpdateOfficeAssignment` stored procedure, it will pass the original value of the `Timestamp` column in the `OrigTimestamp` parameter.</span></span> <span data-ttu-id="03877-246">Procedura składowana używa tego parametru w jego `Where` klauzuli:</span><span class="sxs-lookup"><span data-stu-id="03877-246">The stored procedure uses this parameter in its `Where` clause:</span></span>

[!code-sql[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample8.sql)]

<span data-ttu-id="03877-247">Procedura składowana zaznacza nowa wartość `Timestamp` kolumny po aktualizacji tak, aby zachować Entity Framework `OfficeAssignment` jednostki, który znajduje się w pamięci w synchronizacji z odpowiednim bazy danych.</span><span class="sxs-lookup"><span data-stu-id="03877-247">The stored procedure also selects the new value of the `Timestamp` column after the update so that the Entity Framework can keep the `OfficeAssignment` entity that's in memory in sync with the corresponding database row.</span></span>

<span data-ttu-id="03877-248">(Należy pamiętać, że procedura składowana usuwania przypisania pakietu office nie ma `OrigTimestamp` parametru.</span><span class="sxs-lookup"><span data-stu-id="03877-248">(Note that the stored procedure for deleting an office assignment doesn't have an `OrigTimestamp` parameter.</span></span> <span data-ttu-id="03877-249">W związku z tym Entity Framework nie może sprawdzić czy jednostki są takie same jak w przed jego usunięciem.)</span><span class="sxs-lookup"><span data-stu-id="03877-249">Because of this, the Entity Framework can't verify that an entity is unchanged before deleting it.)</span></span>

<span data-ttu-id="03877-250">Zapisz i zamknij modelu danych.</span><span class="sxs-lookup"><span data-stu-id="03877-250">Save and close the data model.</span></span>

### <a name="adding-officeassignment-methods-to-the-dal"></a><span data-ttu-id="03877-251">Dodawanie metod OfficeAssignment z warstwą dal</span><span class="sxs-lookup"><span data-stu-id="03877-251">Adding OfficeAssignment Methods to the DAL</span></span>

<span data-ttu-id="03877-252">Otwórz *ISchoolRepository.cs* i dodaj następujące metody CRUD `OfficeAssignment` zestaw jednostek:</span><span class="sxs-lookup"><span data-stu-id="03877-252">Open *ISchoolRepository.cs* and add the following CRUD methods for the `OfficeAssignment` entity set:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample9.cs)]

<span data-ttu-id="03877-253">Dodaj następujące metody nowe *SchoolRepository.cs*.</span><span class="sxs-lookup"><span data-stu-id="03877-253">Add the following new methods to *SchoolRepository.cs*.</span></span> <span data-ttu-id="03877-254">W `UpdateOfficeAssignment` metody, należy wywołać lokalnej `SaveChanges` zamiast metody `context.SaveChanges`.</span><span class="sxs-lookup"><span data-stu-id="03877-254">In the `UpdateOfficeAssignment` method, you call the local `SaveChanges` method instead of `context.SaveChanges`.</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample10.cs)]

<span data-ttu-id="03877-255">W projekcie test Otwórz *MockSchoolRepository.cs* i dodaj następującą `OfficeAssignment` zbierania i metody CRUD.</span><span class="sxs-lookup"><span data-stu-id="03877-255">In the test project, open *MockSchoolRepository.cs* and add the following `OfficeAssignment` collection and CRUD methods to it.</span></span> <span data-ttu-id="03877-256">(Makiety repozytorium musi implementować interfejs repozytorium lub nie będzie skompilować rozwiązanie.)</span><span class="sxs-lookup"><span data-stu-id="03877-256">(The mock repository must implement the repository interface, or the solution won't compile.)</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample11.cs)]

### <a name="adding-officeassignment-methods-to-the-bll"></a><span data-ttu-id="03877-257">Dodawanie metody OfficeAssignment LOGIKI</span><span class="sxs-lookup"><span data-stu-id="03877-257">Adding OfficeAssignment Methods to the BLL</span></span>

<span data-ttu-id="03877-258">W głównym projektu, otwórz *SchoolBL.cs* i dodaj następujące metody CRUD `OfficeAssignment` zestawu jednostek do niego:</span><span class="sxs-lookup"><span data-stu-id="03877-258">In the main project, open *SchoolBL.cs* and add the following CRUD methods for the `OfficeAssignment` entity set to it:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample12.cs)]

## <a name="creating-an-officeassignments-web-page"></a><span data-ttu-id="03877-259">Tworzenie strony sieci Web OfficeAssignments</span><span class="sxs-lookup"><span data-stu-id="03877-259">Creating an OfficeAssignments Web Page</span></span>

<span data-ttu-id="03877-260">Tworzenie nowej strony internetowej, która używa *Site.Master* strony wzorcowej i nadaj mu nazwę *OfficeAssignments.aspx*.</span><span class="sxs-lookup"><span data-stu-id="03877-260">Create a new web page that uses the *Site.Master* master page and name it *OfficeAssignments.aspx*.</span></span> <span data-ttu-id="03877-261">Dodaj następujący kod do `Content` formantu o nazwie `Content2`:</span><span class="sxs-lookup"><span data-stu-id="03877-261">Add the following markup to the `Content` control named `Content2`:</span></span>

[!code-aspx[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample13.aspx)]

<span data-ttu-id="03877-262">Należy zauważyć, że w `DataKeyNames` atrybutu znaczników Określa `Timestamp` właściwości, a także klucz rekordu (`InstructorID`).</span><span class="sxs-lookup"><span data-stu-id="03877-262">Notice that in the `DataKeyNames` attribute, the markup specifies the `Timestamp` property as well as the record key (`InstructorID`).</span></span> <span data-ttu-id="03877-263">Określanie właściwości w `DataKeyNames` atrybutu powoduje, że formant Aby zapisać je w stan formantu, (co przypomina, aby wyświetlić stan), aby oryginalne wartości są dostępne podczas przetwarzania zwrotu.</span><span class="sxs-lookup"><span data-stu-id="03877-263">Specifying properties in the `DataKeyNames` attribute causes the control to save them in control state (which is similar to view state) so that the original values are available during postback processing.</span></span>

<span data-ttu-id="03877-264">Jeśli nie został zapisany `Timestamp` wartości, platformy Entity Framework nie musi je `Where` klauzuli SQL `Update` polecenia.</span><span class="sxs-lookup"><span data-stu-id="03877-264">If you didn't save the `Timestamp` value, the Entity Framework would not have it for the `Where` clause of the SQL `Update` command.</span></span> <span data-ttu-id="03877-265">W związku z tym nic nie będzie można znaleźć do aktualizacji.</span><span class="sxs-lookup"><span data-stu-id="03877-265">Consequently nothing would be found to update.</span></span> <span data-ttu-id="03877-266">W rezultacie Entity Framework spowoduje zgłoszenie wyjątku optymistycznej współbieżności każdym razem, gdy `OfficeAssignment` jednostki są aktualizowane.</span><span class="sxs-lookup"><span data-stu-id="03877-266">As a result, the Entity Framework would throw an optimistic concurrency exception every time an `OfficeAssignment` entity is updated.</span></span>

<span data-ttu-id="03877-267">Otwórz *OfficeAssignments.aspx.cs* i dodaj następującą `using` poufności informacji dotyczące warstwy dostępu do danych:</span><span class="sxs-lookup"><span data-stu-id="03877-267">Open *OfficeAssignments.aspx.cs* and add the following `using` statement for the data access layer:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample14.cs)]

<span data-ttu-id="03877-268">Dodaj następujący kod `Page_Init` metody, która włącza funkcję danych dynamicznych.</span><span class="sxs-lookup"><span data-stu-id="03877-268">Add the following `Page_Init` method, which enables Dynamic Data functionality.</span></span> <span data-ttu-id="03877-269">Również dodać następujące Obsługa `ObjectDataSource` kontrolki `Updated` zdarzeń, aby sprawdzić błędy współbieżności:</span><span class="sxs-lookup"><span data-stu-id="03877-269">Also add the following handler for the `ObjectDataSource` control's `Updated` event in order to check for concurrency errors:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample15.cs)]

### <a name="testing-optimistic-concurrency-in-the-officeassignments-page"></a><span data-ttu-id="03877-270">Testowanie optymistycznej współbieżności na stronie OfficeAssignments</span><span class="sxs-lookup"><span data-stu-id="03877-270">Testing Optimistic Concurrency in the OfficeAssignments Page</span></span>

<span data-ttu-id="03877-271">Uruchom *OfficeAssignments.aspx* strony.</span><span class="sxs-lookup"><span data-stu-id="03877-271">Run the *OfficeAssignments.aspx* page.</span></span>

<span data-ttu-id="03877-272">[![Image10](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image32.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="03877-272">[![Image10](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image32.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image31.png)</span></span>

<span data-ttu-id="03877-273">Kliknij przycisk **Edytuj** w wierszu i zmień wartość w **lokalizacji** kolumny.</span><span class="sxs-lookup"><span data-stu-id="03877-273">Click **Edit** in a row and change the value in the **Location** column.</span></span>

<span data-ttu-id="03877-274">[![Image11](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image34.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image33.png)</span><span class="sxs-lookup"><span data-stu-id="03877-274">[![Image11](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image34.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image33.png)</span></span>

<span data-ttu-id="03877-275">Otwórz nowe okno przeglądarki i uruchom ponownie strony (Kopiuj adres URL w pierwszym oknie przeglądarki, aby drugie okno przeglądarki).</span><span class="sxs-lookup"><span data-stu-id="03877-275">Open a new browser window and run the page again (copy the URL from the first browser window to the second browser window).</span></span>

<span data-ttu-id="03877-276">[![Image10](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image36.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="03877-276">[![Image10](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image36.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image35.png)</span></span>

<span data-ttu-id="03877-277">Kliknij przycisk **Edytuj** w tym samym wierszu, możesz edytować wcześniej i zmień **lokalizacji** wartości na coś innego.</span><span class="sxs-lookup"><span data-stu-id="03877-277">Click **Edit** in the same row you edited earlier and change the **Location** value to something different.</span></span>

<span data-ttu-id="03877-278">[![Image12](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image38.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="03877-278">[![Image12](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image38.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image37.png)</span></span>

<span data-ttu-id="03877-279">W drugim oknie przeglądarki, kliknij przycisk **aktualizacji**.</span><span class="sxs-lookup"><span data-stu-id="03877-279">In the second browser window, click **Update**.</span></span>

<span data-ttu-id="03877-280">[![Image13](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image40.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image39.png)</span><span class="sxs-lookup"><span data-stu-id="03877-280">[![Image13](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image40.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image39.png)</span></span>

<span data-ttu-id="03877-281">Przejdź do pierwszego okna przeglądarki, a następnie kliknij przycisk **aktualizacji**.</span><span class="sxs-lookup"><span data-stu-id="03877-281">Switch to the first browser window and click **Update**.</span></span>

<span data-ttu-id="03877-282">[![Image15](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image42.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image41.png)</span><span class="sxs-lookup"><span data-stu-id="03877-282">[![Image15](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image42.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image41.png)</span></span>

<span data-ttu-id="03877-283">Zostanie wyświetlony komunikat o błędzie i **lokalizacji** wartość został zaktualizowany do wyświetlenia wartości został zmieniony w drugim oknie przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="03877-283">You see an error message and the **Location** value has been updated to show the value you changed it to in the second browser window.</span></span>

## <a name="handling-concurrency-with-the-entitydatasource-control"></a><span data-ttu-id="03877-284">Obsługa współbieżności przy użyciu kontrolki EntityDataSource</span><span class="sxs-lookup"><span data-stu-id="03877-284">Handling Concurrency with the EntityDataSource Control</span></span>

<span data-ttu-id="03877-285">`EntityDataSource` Kontroli zawiera wbudowaną logikę, która rozpoznaje ustawieniami współbieżności w modelu danych i obsługuje operacje aktualizowania i usuwania odpowiednio.</span><span class="sxs-lookup"><span data-stu-id="03877-285">The `EntityDataSource` control includes built-in logic that recognizes the concurrency settings in the data model and handles update and delete operations accordingly.</span></span> <span data-ttu-id="03877-286">Jednakże, podobnie jak w przypadku wszystkich wyjątków, musi obsługiwać `OptimisticConcurrencyException` wyjątki samodzielnie, aby zapewnić przyjazny dla użytkownika komunikat.</span><span class="sxs-lookup"><span data-stu-id="03877-286">However, as with all exceptions, you must handle `OptimisticConcurrencyException` exceptions yourself in order to provide a user-friendly error message.</span></span>

<span data-ttu-id="03877-287">Następnie należy skonfigurować *Courses.aspx* strony (wykonującemu `EntityDataSource` kontroli) zezwala na aktualizowanie i usuwanie operacji i wyświetlić komunikat o błędzie, jeśli wystąpi konflikt współbieżności.</span><span class="sxs-lookup"><span data-stu-id="03877-287">Next, you will configure the *Courses.aspx* page (which uses an `EntityDataSource` control) to allow update and delete operations and to display an error message if a concurrency conflict occurs.</span></span> <span data-ttu-id="03877-288">`Course` Jednostki nie istnieje współbieżności, śledzenia kolumn, dzięki czemu będą używać tej samej metody, która została zastosowana za pomocą `Department` jednostki: śledzenie wartości wszystkich właściwości klucza.</span><span class="sxs-lookup"><span data-stu-id="03877-288">The `Course` entity doesn't have a concurrency tracking column, so you will use the same method that you did with the `Department` entity: track the values of all non-key properties.</span></span>

<span data-ttu-id="03877-289">Otwórz *SchoolModel.edmx* pliku.</span><span class="sxs-lookup"><span data-stu-id="03877-289">Open the *SchoolModel.edmx* file.</span></span> <span data-ttu-id="03877-290">Dla właściwości-key `Course` jednostki (`Title`, `Credits`, i `DepartmentID`) ustaw **tryb współbieżności** właściwość `Fixed`.</span><span class="sxs-lookup"><span data-stu-id="03877-290">For the non-key properties of the `Course` entity (`Title`, `Credits`, and `DepartmentID`), set the **Concurrency Mode** property to `Fixed`.</span></span> <span data-ttu-id="03877-291">Następnie zapisz i zamknij modelu danych.</span><span class="sxs-lookup"><span data-stu-id="03877-291">Then save and close the data model.</span></span>

<span data-ttu-id="03877-292">Otwórz *Courses.aspx* strony, a następnie dokonaj następujących zmian:</span><span class="sxs-lookup"><span data-stu-id="03877-292">Open the *Courses.aspx* page and make the following changes:</span></span>

- <span data-ttu-id="03877-293">W `CoursesEntityDataSource` Dodaj `EnableUpdate="true"` i `EnableDelete="true"` atrybutów.</span><span class="sxs-lookup"><span data-stu-id="03877-293">In the `CoursesEntityDataSource` control, add `EnableUpdate="true"` and `EnableDelete="true"` attributes.</span></span> <span data-ttu-id="03877-294">Otwierający tag dla tej kontrolki teraz podobnego do następującego:</span><span class="sxs-lookup"><span data-stu-id="03877-294">The opening tag for that control now resembles the following example:</span></span>

    [!code-aspx[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample16.aspx)]
- <span data-ttu-id="03877-295">W `CoursesGridView` kontrolować, zmień `DataKeyNames` wartość do atrybutu `"CourseID,Title,Credits,DepartmentID"`.</span><span class="sxs-lookup"><span data-stu-id="03877-295">In the `CoursesGridView` control, change the `DataKeyNames` attribute value to `"CourseID,Title,Credits,DepartmentID"`.</span></span> <span data-ttu-id="03877-296">Następnie dodaj `CommandField` elementu `Columns` element, który pokazuje **Edytuj** i **Usuń** przycisków (`<asp:CommandField ShowEditButton="True" ShowDeleteButton="True" />`).</span><span class="sxs-lookup"><span data-stu-id="03877-296">Then add a `CommandField` element to the `Columns` element that shows **Edit** and **Delete** buttons (`<asp:CommandField ShowEditButton="True" ShowDeleteButton="True" />`).</span></span> <span data-ttu-id="03877-297">`GridView` Kontroli teraz podobnego do następującego:</span><span class="sxs-lookup"><span data-stu-id="03877-297">The `GridView` control now resembles the following example:</span></span>

    [!code-aspx[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample17.aspx)]

<span data-ttu-id="03877-298">Uruchom stronę i Utwórz sytuacji konflikt, jak poprzednio na stronie działów.</span><span class="sxs-lookup"><span data-stu-id="03877-298">Run the page and create a conflict situation as you did before in the Departments page.</span></span> <span data-ttu-id="03877-299">Uruchom stronę w dwa okna przeglądarki, kliknij przycisk **Edytuj** w tej samej linii każdego okna i wprowadzić różne zmiany w każdej z nich.</span><span class="sxs-lookup"><span data-stu-id="03877-299">Run the page in two browser windows, click **Edit** in the same line in each window, and make a different change in each one.</span></span> <span data-ttu-id="03877-300">Kliknij przycisk **aktualizacji** w jednym oknie, a następnie kliknij przycisk **aktualizacji** w innym oknie.</span><span class="sxs-lookup"><span data-stu-id="03877-300">Click **Update** in one window and then click **Update** in the other window.</span></span> <span data-ttu-id="03877-301">Po kliknięciu **aktualizacji** po raz drugi, zostanie wyświetlona strona błędu, będącą wynikiem współbieżności nieobsługiwany wyjątek.</span><span class="sxs-lookup"><span data-stu-id="03877-301">When you click **Update** the second time, you see the error page that results from an unhandled concurrency exception.</span></span>

<span data-ttu-id="03877-302">[![Image22](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image44.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image43.png)</span><span class="sxs-lookup"><span data-stu-id="03877-302">[![Image22](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image44.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image43.png)</span></span>

<span data-ttu-id="03877-303">Obsługa ten błąd wystąpił w sposób bardzo podobny do sposobu obsługi dla `ObjectDataSource` kontroli.</span><span class="sxs-lookup"><span data-stu-id="03877-303">You handle this error in a manner very similar to how you handled it for the `ObjectDataSource` control.</span></span> <span data-ttu-id="03877-304">Otwórz *Courses.aspx* strony, a następnie w `CoursesEntityDataSource` kontrolki, określa programy obsługi dla `Deleted` i `Updated` zdarzenia.</span><span class="sxs-lookup"><span data-stu-id="03877-304">Open the *Courses.aspx* page, and in the `CoursesEntityDataSource` control, specify handlers for the `Deleted` and `Updated` events.</span></span> <span data-ttu-id="03877-305">Otwierający tag formantu teraz podobnego do następującego:</span><span class="sxs-lookup"><span data-stu-id="03877-305">The opening tag of the control now resembles the following example:</span></span>

[!code-aspx[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample18.aspx)]

<span data-ttu-id="03877-306">Przed `CoursesGridView` sterowania, Dodaj następujący kod `ValidationSummary` sterowania:</span><span class="sxs-lookup"><span data-stu-id="03877-306">Before the `CoursesGridView` control, add the following `ValidationSummary` control:</span></span>

[!code-aspx[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample19.aspx)]

<span data-ttu-id="03877-307">W *Courses.aspx.cs*, Dodaj `using` poufności informacji dotyczące `System.Data` przestrzeni nazw, Dodaj metodę, która sprawdza współbieżności wyjątków i programy obsługi dla `EntityDataSource` kontrolki `Updated` i `Deleted`programów obsługi.</span><span class="sxs-lookup"><span data-stu-id="03877-307">In *Courses.aspx.cs*, add a `using` statement for the `System.Data` namespace, add a method that checks for concurrency exceptions, and add handlers for the `EntityDataSource` control's `Updated` and `Deleted` handlers.</span></span> <span data-ttu-id="03877-308">Ten kod będzie wyglądać następująco:</span><span class="sxs-lookup"><span data-stu-id="03877-308">The code will look like the following:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample20.cs)]

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample21.cs)]

<span data-ttu-id="03877-309">Jedyną różnicą między tym kodem i co zostało zrobione `ObjectDataSource` kontrolka jest w tym przypadku wyjątku współbieżności w `Exception` właściwości obiektu w argumenty zdarzenia, a nie w ten wyjątek `InnerException` właściwości.</span><span class="sxs-lookup"><span data-stu-id="03877-309">The only difference between this code and what you did for the `ObjectDataSource` control is that in this case the concurrency exception is in the `Exception` property of the event arguments object rather than in that exception's `InnerException` property.</span></span>

<span data-ttu-id="03877-310">Uruchom stronę i ponownie utwórz konfliktów współbieżności.</span><span class="sxs-lookup"><span data-stu-id="03877-310">Run the page and create a concurrency conflict again.</span></span> <span data-ttu-id="03877-311">Teraz, zobaczysz komunikat o błędzie:</span><span class="sxs-lookup"><span data-stu-id="03877-311">This time you see an error message:</span></span>

<span data-ttu-id="03877-312">[![Image23](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image46.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image45.png)</span><span class="sxs-lookup"><span data-stu-id="03877-312">[![Image23](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image46.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image45.png)</span></span>

<span data-ttu-id="03877-313">Na tym kończy się wprowadzenie do obsługi konfliktów współbieżności.</span><span class="sxs-lookup"><span data-stu-id="03877-313">This completes the introduction to handling concurrency conflicts.</span></span> <span data-ttu-id="03877-314">Następnym samouczku przedstawiono wskazówki dotyczące zwiększania wydajności w aplikacji sieci web, która używa programu Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="03877-314">The next tutorial will provide guidance on how to improve performance in a web application that uses the Entity Framework.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="03877-315">[Poprzednie](using-the-entity-framework-and-the-objectdatasource-control-part-3-sorting-and-filtering.md)
> [dalej](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application.md)</span><span class="sxs-lookup"><span data-stu-id="03877-315">[Previous](using-the-entity-framework-and-the-objectdatasource-control-part-3-sorting-and-filtering.md)
[Next](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application.md)</span></span>
