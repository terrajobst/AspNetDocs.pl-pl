---
uid: web-forms/overview/older-versions-getting-started/getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-4
title: Wprowadzenie z Entity Framework 4,0 Database First i ASP.NET 4 Web Forms — część 4 | Microsoft Docs
author: tdykstra
description: Przykładowa aplikacja internetowa Contoso University pokazuje, jak tworzyć aplikacje ASP.NET Web Forms przy użyciu Entity Framework. Przykładowa aplikacja to...
ms.author: riande
ms.date: 12/03/2010
ms.assetid: ceb9e60f-957c-4d25-9331-cc527de96a33
msc.legacyurl: /web-forms/overview/older-versions-getting-started/getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-4
msc.type: authoredcontent
ms.openlocfilehash: eb75a76038466bf30738387ed4739687de1df944
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 03/06/2020
ms.locfileid: "78638167"
---
# <a name="getting-started-with-entity-framework-40-database-first-and-aspnet-4-web-forms---part-4"></a><span data-ttu-id="e68c3-104">Wprowadzenie z Entity Framework 4,0 Database First i ASP.NET 4 Web Forms — część 4</span><span class="sxs-lookup"><span data-stu-id="e68c3-104">Getting Started with Entity Framework 4.0 Database First and ASP.NET 4 Web Forms - Part 4</span></span>

<span data-ttu-id="e68c3-105">Autor [Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="e68c3-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="e68c3-106">Przykładowa aplikacja internetowa Contoso University pokazuje, jak tworzyć aplikacje ASP.NET Web Forms przy użyciu Entity Framework 4,0 i programu Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="e68c3-106">The Contoso University sample web application demonstrates how to create ASP.NET Web Forms applications using the Entity Framework 4.0 and Visual Studio 2010.</span></span> <span data-ttu-id="e68c3-107">Aby uzyskać informacje na temat serii samouczków, zobacz [pierwszy samouczek w serii](the-entity-framework-and-aspnet-getting-started-part-1.md)</span><span class="sxs-lookup"><span data-stu-id="e68c3-107">For information about the tutorial series, see [the first tutorial in the series](the-entity-framework-and-aspnet-getting-started-part-1.md)</span></span>

## <a name="working-with-related-data"></a><span data-ttu-id="e68c3-108">Praca z danymi powiązanymi</span><span class="sxs-lookup"><span data-stu-id="e68c3-108">Working with Related Data</span></span>

<span data-ttu-id="e68c3-109">W poprzednim samouczku użyto kontrolki `EntityDataSource` do filtrowania, sortowania i grupowania danych.</span><span class="sxs-lookup"><span data-stu-id="e68c3-109">In the previous tutorial you used the `EntityDataSource` control to filter, sort, and group data.</span></span> <span data-ttu-id="e68c3-110">W tym samouczku zostaną wyświetlone i zaktualizowane powiązane dane.</span><span class="sxs-lookup"><span data-stu-id="e68c3-110">In this tutorial you'll display and update related data.</span></span>

<span data-ttu-id="e68c3-111">Utworzysz stronę instruktorów, która wyświetla listę instruktorów.</span><span class="sxs-lookup"><span data-stu-id="e68c3-111">You'll create the Instructors page that shows a list of instructors.</span></span> <span data-ttu-id="e68c3-112">Po wybraniu instruktora zostanie wyświetlona lista szkoleń szkoleniowych według tego instruktora.</span><span class="sxs-lookup"><span data-stu-id="e68c3-112">When you select an instructor, you see a list of courses taught by that instructor.</span></span> <span data-ttu-id="e68c3-113">Po wybraniu kursu zobaczysz szczegóły dotyczące kursu i listę studentów zarejestrowanych w kursie.</span><span class="sxs-lookup"><span data-stu-id="e68c3-113">When you select a course, you see details for the course and a list of students enrolled in the course.</span></span> <span data-ttu-id="e68c3-114">Można edytować nazwisko instruktora, datę zatrudnienia i przypisanie pakietu Office.</span><span class="sxs-lookup"><span data-stu-id="e68c3-114">You can edit the instructor name, hire date, and office assignment.</span></span> <span data-ttu-id="e68c3-115">Przypisanie pakietu Office to oddzielny zestaw jednostek, do którego uzyskujesz dostęp za pomocą właściwości nawigacji.</span><span class="sxs-lookup"><span data-stu-id="e68c3-115">The office assignment is a separate entity set that you access through a navigation property.</span></span>

<span data-ttu-id="e68c3-116">Dane główne można połączyć z danymi szczegółowymi w znacznikach lub w kodzie.</span><span class="sxs-lookup"><span data-stu-id="e68c3-116">You can link master data to detail data in markup or in code.</span></span> <span data-ttu-id="e68c3-117">W tej części samouczka będziesz używać obu tych metod.</span><span class="sxs-lookup"><span data-stu-id="e68c3-117">In this part of the tutorial, you'll use both methods.</span></span>

<span data-ttu-id="e68c3-118">[![Image01](the-entity-framework-and-aspnet-getting-started-part-4/_static/image2.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="e68c3-118">[![Image01](the-entity-framework-and-aspnet-getting-started-part-4/_static/image2.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image1.png)</span></span>

## <a name="displaying-and-updating-related-entities-in-a-gridview-control"></a><span data-ttu-id="e68c3-119">Wyświetlanie i aktualizowanie powiązanych jednostek w kontrolce GridView</span><span class="sxs-lookup"><span data-stu-id="e68c3-119">Displaying and Updating Related Entities in a GridView Control</span></span>

<span data-ttu-id="e68c3-120">Utwórz nową stronę sieci Web o nazwie *instruktors. aspx* , która korzysta ze strony wzorcowej *site. Master* , i Dodaj następujące znaczniki do kontrolki `Content` o nazwie `Content2`:</span><span class="sxs-lookup"><span data-stu-id="e68c3-120">Create a new web page named *Instructors.aspx* that uses the *Site.Master* master page, and add the following markup to the `Content` control named `Content2`:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample1.aspx)]

<span data-ttu-id="e68c3-121">Ten znacznik tworzy formant `EntityDataSource`, który wybiera instruktorów i włącza aktualizacje.</span><span class="sxs-lookup"><span data-stu-id="e68c3-121">This markup creates an `EntityDataSource` control that selects instructors and enables updates.</span></span> <span data-ttu-id="e68c3-122">Element `div` konfiguruje adiustację do renderowania po lewej stronie, aby można było dodać kolumnę po prawej stronie później.</span><span class="sxs-lookup"><span data-stu-id="e68c3-122">The `div` element configures markup to render on the left so that you can add a column on the right later.</span></span>

<span data-ttu-id="e68c3-123">Między znacznikiem `EntityDataSource` i zamykanym tagiem `</div>` Dodaj następujące znaczniki, które tworzą kontrolkę `GridView` i kontrolkę `Label`, która będzie używana dla komunikatów o błędach:</span><span class="sxs-lookup"><span data-stu-id="e68c3-123">Between the `EntityDataSource` markup and the closing `</div>` tag, add the following markup that creates a `GridView` control and a `Label` control that you'll use for error messages:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample2.aspx)]

<span data-ttu-id="e68c3-124">Ta kontrolka `GridView` umożliwia zaznaczanie wierszy, wyróżnianie zaznaczonego wiersza przy użyciu jasnego szarego koloru tła i określa programy obsługi (które utworzysz później) dla zdarzeń `SelectedIndexChanged` i `Updating`.</span><span class="sxs-lookup"><span data-stu-id="e68c3-124">This `GridView` control enables row selection, highlights the selected row with a light gray background color, and specifies handlers (which you'll create later) for the `SelectedIndexChanged` and `Updating` events.</span></span> <span data-ttu-id="e68c3-125">Określa również `PersonID` właściwości `DataKeyNames`, dzięki czemu wartość klucza wybranego wiersza może być przenoszona do innego formantu, który zostanie dodany później.</span><span class="sxs-lookup"><span data-stu-id="e68c3-125">It also specifies `PersonID` for the `DataKeyNames` property, so that the key value of the selected row can be passed to another control that you'll add later.</span></span>

<span data-ttu-id="e68c3-126">Ostatnia kolumna zawiera przypisanie pakietu Office instruktora, które jest przechowywane we właściwości nawigacji jednostki `Person`, ponieważ pochodzi ze skojarzonej jednostki.</span><span class="sxs-lookup"><span data-stu-id="e68c3-126">The last column contains the instructor's office assignment, which is stored in a navigation property of the `Person` entity because it comes from an associated entity.</span></span> <span data-ttu-id="e68c3-127">Należy zauważyć, że element `EditItemTemplate` określa `Eval` zamiast `Bind`, ponieważ kontrolka `GridView` nie może zostać powiązana bezpośrednio z właściwościami nawigacji, aby je zaktualizować.</span><span class="sxs-lookup"><span data-stu-id="e68c3-127">Notice that the `EditItemTemplate` element specifies `Eval` instead of `Bind`, because the `GridView` control cannot directly bind to navigation properties in order to update them.</span></span> <span data-ttu-id="e68c3-128">Aktualizujesz przypisanie pakietu Office w kodzie.</span><span class="sxs-lookup"><span data-stu-id="e68c3-128">You'll update the office assignment in code.</span></span> <span data-ttu-id="e68c3-129">W tym celu należy odwołać się do kontrolki `TextBox` i uzyskać i zapisać ją w zdarzeniu `Init` kontrolki `TextBox`.</span><span class="sxs-lookup"><span data-stu-id="e68c3-129">To do that, you'll need a reference to the `TextBox` control, and you'll get and save that in the `TextBox` control's `Init` event.</span></span>

<span data-ttu-id="e68c3-130">Kontrolka `GridView` jest formantem `Label` używanym do komunikatów o błędach.</span><span class="sxs-lookup"><span data-stu-id="e68c3-130">Following the `GridView` control is a `Label` control that's used for error messages.</span></span> <span data-ttu-id="e68c3-131">Właściwość `Visible` kontrolki jest `false`, a stan widoku jest wyłączony, dzięki czemu etykieta będzie wyświetlana tylko wtedy, gdy kod staje się widoczny w odpowiedzi na błąd.</span><span class="sxs-lookup"><span data-stu-id="e68c3-131">The control's `Visible` property is `false`, and view state is turned off, so that the label will appear only when code makes it visible in response to an error.</span></span>

<span data-ttu-id="e68c3-132">Otwórz plik *Instructors.aspx.cs* i Dodaj następującą instrukcję `using`:</span><span class="sxs-lookup"><span data-stu-id="e68c3-132">Open the *Instructors.aspx.cs* file and add the following `using` statement:</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample3.cs)]

<span data-ttu-id="e68c3-133">Dodaj pole klasy prywatnej bezpośrednio po deklaracji nazwy częściowej klasy, aby pomieścić odwołanie do pola tekstowego przypisania pakietu Office.</span><span class="sxs-lookup"><span data-stu-id="e68c3-133">Add a private class field immediately after the partial-class name declaration to hold a reference to the office assignment text box.</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample4.cs)]

<span data-ttu-id="e68c3-134">Dodaj element zastępczy dla programu obsługi zdarzeń `SelectedIndexChanged`, do którego kod zostanie dodany później.</span><span class="sxs-lookup"><span data-stu-id="e68c3-134">Add a stub for the `SelectedIndexChanged` event handler that you'll add code for later.</span></span> <span data-ttu-id="e68c3-135">Dodaj również procedurę obsługi dla zdarzenia `Init` kontrolki `TextBox` przypisania pakietu Office, aby można było zapisać odwołanie do kontrolki `TextBox`.</span><span class="sxs-lookup"><span data-stu-id="e68c3-135">Also add a handler for the office assignment `TextBox` control's `Init` event so that you can store a reference to the `TextBox` control.</span></span> <span data-ttu-id="e68c3-136">Użyjesz tego odwołania, aby pobrać wartość wprowadzoną przez użytkownika w celu zaktualizowania jednostki skojarzonej z właściwością nawigacji.</span><span class="sxs-lookup"><span data-stu-id="e68c3-136">You'll use this reference to get the value the user entered in order to update the entity associated with the navigation property.</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample5.cs)]

<span data-ttu-id="e68c3-137">Będziesz używać zdarzenia `Updating` kontrolki `GridView`, aby zaktualizować Właściwość `Location` skojarzonej jednostki `OfficeAssignment`.</span><span class="sxs-lookup"><span data-stu-id="e68c3-137">You'll use the `GridView` control's `Updating` event to update the `Location` property of the associated `OfficeAssignment` entity.</span></span> <span data-ttu-id="e68c3-138">Dodaj następującą procedurę obsługi dla zdarzenia `Updating`:</span><span class="sxs-lookup"><span data-stu-id="e68c3-138">Add the following handler for the `Updating` event:</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample6.cs)]

<span data-ttu-id="e68c3-139">Ten kod jest uruchamiany, gdy użytkownik kliknie przycisk **Aktualizuj** w wierszu `GridView`.</span><span class="sxs-lookup"><span data-stu-id="e68c3-139">This code is run when the user clicks **Update** in a `GridView` row.</span></span> <span data-ttu-id="e68c3-140">Kod używa LINQ to Entities do pobrania jednostki `OfficeAssignment` skojarzonej z bieżącą jednostką `Person` przy użyciu `PersonID` wybranego wiersza z argumentu zdarzenia.</span><span class="sxs-lookup"><span data-stu-id="e68c3-140">The code uses LINQ to Entities to retrieve the `OfficeAssignment` entity that's associated with the current `Person` entity, using the `PersonID` of the selected row from the event argument.</span></span>

<span data-ttu-id="e68c3-141">Następnie kod pobiera jedną z następujących akcji w zależności od wartości w kontrolce `InstructorOfficeTextBox`:</span><span class="sxs-lookup"><span data-stu-id="e68c3-141">The code then takes one of the following actions depending on the value in the `InstructorOfficeTextBox` control:</span></span>

- <span data-ttu-id="e68c3-142">Jeśli pole tekstowe ma wartość i nie ma `OfficeAssignment` jednostki do zaktualizowania, zostanie ona utworzona.</span><span class="sxs-lookup"><span data-stu-id="e68c3-142">If the text box has a value and there's no `OfficeAssignment` entity to update, it creates one.</span></span>
- <span data-ttu-id="e68c3-143">Jeśli pole tekstowe ma wartość i istnieje jednostka `OfficeAssignment`, aktualizuje wartość właściwości `Location`.</span><span class="sxs-lookup"><span data-stu-id="e68c3-143">If the text box has a value and there's an `OfficeAssignment` entity, it updates the `Location` property value.</span></span>
- <span data-ttu-id="e68c3-144">Jeśli pole tekstowe jest puste i istnieje jednostka `OfficeAssignment`, spowoduje to usunięcie jednostki.</span><span class="sxs-lookup"><span data-stu-id="e68c3-144">If the text box is empty and an `OfficeAssignment` entity exists, it deletes the entity.</span></span>

<span data-ttu-id="e68c3-145">Następnie zapisuje zmiany w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="e68c3-145">After this, it saves the changes to the database.</span></span> <span data-ttu-id="e68c3-146">Jeśli wystąpi wyjątek, zostanie wyświetlony komunikat o błędzie.</span><span class="sxs-lookup"><span data-stu-id="e68c3-146">If an exception occurs, it displays an error message.</span></span>

<span data-ttu-id="e68c3-147">Uruchom stronę.</span><span class="sxs-lookup"><span data-stu-id="e68c3-147">Run the page.</span></span>

<span data-ttu-id="e68c3-148">[![Image02](the-entity-framework-and-aspnet-getting-started-part-4/_static/image4.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="e68c3-148">[![Image02](the-entity-framework-and-aspnet-getting-started-part-4/_static/image4.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image3.png)</span></span>

<span data-ttu-id="e68c3-149">Kliknij przycisk **Edytuj** i wszystkie pola przejdź do pól tekstowych.</span><span class="sxs-lookup"><span data-stu-id="e68c3-149">Click **Edit** and all fields change to text boxes.</span></span>

<span data-ttu-id="e68c3-150">[![Image03](the-entity-framework-and-aspnet-getting-started-part-4/_static/image6.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="e68c3-150">[![Image03](the-entity-framework-and-aspnet-getting-started-part-4/_static/image6.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image5.png)</span></span>

<span data-ttu-id="e68c3-151">Zmień dowolne z tych wartości, w tym **przypisanie pakietu Office**.</span><span class="sxs-lookup"><span data-stu-id="e68c3-151">Change any of these values, including **Office Assignment**.</span></span> <span data-ttu-id="e68c3-152">Kliknij przycisk **Aktualizuj** , aby zobaczyć zmiany odzwierciedlone na liście.</span><span class="sxs-lookup"><span data-stu-id="e68c3-152">Click **Update** and you'll see the changes reflected in the list.</span></span>

## <a name="displaying-related-entities-in-a-separate-control"></a><span data-ttu-id="e68c3-153">Wyświetlanie powiązanych jednostek w oddzielnym formancie</span><span class="sxs-lookup"><span data-stu-id="e68c3-153">Displaying Related Entities in a Separate Control</span></span>

<span data-ttu-id="e68c3-154">Każdy instruktor może nauczyć jeden lub więcej kursów, dlatego dodasz kontrolkę `EntityDataSource` i kontrolkę `GridView`, aby wyświetlić listę kursów skojarzonych z tym instruktorem w `GridView` kontroli.</span><span class="sxs-lookup"><span data-stu-id="e68c3-154">Each instructor can teach one or more courses, so you'll add an `EntityDataSource` control and a `GridView` control to list the courses associated with whichever instructor is selected in the instructors `GridView` control.</span></span> <span data-ttu-id="e68c3-155">Aby utworzyć nagłówek i formant `EntityDataSource` dla jednostek kursów, Dodaj następujące znaczniki między formantem `Label` komunikatu o błędzie i zamykającym tagiem `</div>`:</span><span class="sxs-lookup"><span data-stu-id="e68c3-155">To create a heading and the `EntityDataSource` control for courses entities, add the following markup between the error message `Label` control and the closing `</div>` tag:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample7.aspx)]

<span data-ttu-id="e68c3-156">Parametr `Where` zawiera wartość `PersonID` instruktora, którego wiersz został wybrany w kontrolce `InstructorsGridView`.</span><span class="sxs-lookup"><span data-stu-id="e68c3-156">The `Where` parameter contains the value of the `PersonID` of the instructor whose row is selected in the `InstructorsGridView` control.</span></span> <span data-ttu-id="e68c3-157">Właściwość `Where` zawiera polecenie subselect, które pobiera wszystkie skojarzone jednostki `Person` z `People` właściwości nawigacji jednostki `Course` i wybiera jednostkę `Course` tylko wtedy, gdy jedna z skojarzonych jednostek `Person` zawiera wybraną wartość `PersonID`.</span><span class="sxs-lookup"><span data-stu-id="e68c3-157">The `Where` property contains a subselect command that gets all associated `Person` entities from a `Course` entity's `People` navigation property and selects the `Course` entity only if one of the associated `Person` entities contains the selected `PersonID` value.</span></span>

<span data-ttu-id="e68c3-158">Aby utworzyć kontrolkę `GridView`. Dodaj następujące znaczniki bezpośrednio po kontrolce `CoursesEntityDataSource` (przed tagiem zamykającym `</div>`):</span><span class="sxs-lookup"><span data-stu-id="e68c3-158">To create the `GridView` control., add the following markup immediately following the `CoursesEntityDataSource` control (before the closing `</div>` tag):</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample8.aspx)]

<span data-ttu-id="e68c3-159">Ponieważ żadne kursy nie będą wyświetlane w przypadku wybrania żadnego instruktora, zostanie uwzględniony element `EmptyDataTemplate`.</span><span class="sxs-lookup"><span data-stu-id="e68c3-159">Because no courses will be displayed if no instructor is selected, an `EmptyDataTemplate` element is included.</span></span>

<span data-ttu-id="e68c3-160">Uruchom stronę.</span><span class="sxs-lookup"><span data-stu-id="e68c3-160">Run the page.</span></span>

<span data-ttu-id="e68c3-161">[![Image04](the-entity-framework-and-aspnet-getting-started-part-4/_static/image8.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="e68c3-161">[![Image04](the-entity-framework-and-aspnet-getting-started-part-4/_static/image8.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image7.png)</span></span>

<span data-ttu-id="e68c3-162">Wybierz instruktora, do którego przypisano co najmniej jeden kurs, a kurs lub kursy pojawiają się na liście.</span><span class="sxs-lookup"><span data-stu-id="e68c3-162">Select an instructor who has one or more courses assigned, and the course or courses appear in the list.</span></span> <span data-ttu-id="e68c3-163">(Uwaga: Chociaż schemat bazy danych umożliwia używanie wielu kursów, w danych testowych dostarczonych z bazą danych żaden instruktor nie ma więcej niż jednego kursu.</span><span class="sxs-lookup"><span data-stu-id="e68c3-163">(Note: although the database schema allows multiple courses, in the test data supplied with the database no instructor actually has more than one course.</span></span> <span data-ttu-id="e68c3-164">Kursy do bazy danych można dodać samodzielnie przy użyciu okna **Eksplorator serwera** lub strony *CoursesAdd. aspx* , która zostanie dodana w kolejnym samouczku.)</span><span class="sxs-lookup"><span data-stu-id="e68c3-164">You can add courses to the database yourself using the **Server Explorer** window or the *CoursesAdd.aspx* page, which you'll add in a later tutorial.)</span></span>

<span data-ttu-id="e68c3-165">[![Image05](the-entity-framework-and-aspnet-getting-started-part-4/_static/image10.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="e68c3-165">[![Image05](the-entity-framework-and-aspnet-getting-started-part-4/_static/image10.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image9.png)</span></span>

<span data-ttu-id="e68c3-166">Kontrolka `CoursesGridView` zawiera tylko kilka pól kursów.</span><span class="sxs-lookup"><span data-stu-id="e68c3-166">The `CoursesGridView` control shows only a few course fields.</span></span> <span data-ttu-id="e68c3-167">Aby wyświetlić wszystkie szczegóły dotyczące kursu, użyjesz kontrolki `DetailsView` dla kursu, który wybierze użytkownik.</span><span class="sxs-lookup"><span data-stu-id="e68c3-167">To display all the details for a course, you'll use a `DetailsView` control for the course that the user selects.</span></span> <span data-ttu-id="e68c3-168">W przypadku *instruktorów. aspx*Dodaj następujące znaczniki po tagu zamykającym `</div>` (Upewnij się, że ten znacznik jest umieszczony **po** tagu zamykającego DIV, a nie przed nim):</span><span class="sxs-lookup"><span data-stu-id="e68c3-168">In *Instructors.aspx*, add the following markup after the closing `</div>` tag (make sure you place this markup **after** the closing div tag, not before it):</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample9.aspx)]

<span data-ttu-id="e68c3-169">Ten znacznik tworzy formant `EntityDataSource`, który jest powiązany z zestawem `Courses` Entity.</span><span class="sxs-lookup"><span data-stu-id="e68c3-169">This markup creates an `EntityDataSource` control that's bound to the `Courses` entity set.</span></span> <span data-ttu-id="e68c3-170">Właściwość `Where` wybiera kurs przy użyciu wartości `CourseID` wybranego wiersza w kontrolce `GridView` kursów.</span><span class="sxs-lookup"><span data-stu-id="e68c3-170">The `Where` property selects a course using the `CourseID` value of the selected row in the courses `GridView` control.</span></span> <span data-ttu-id="e68c3-171">Znacznik określa procedurę obsługi dla zdarzenia `Selected`, który będzie używany później do wyświetlania ocen uczniów, który jest niższym poziomem w hierarchii.</span><span class="sxs-lookup"><span data-stu-id="e68c3-171">The markup specifies a handler for the `Selected` event, which you'll use later for displaying student grades, which is another level lower in the hierarchy.</span></span>

<span data-ttu-id="e68c3-172">W *Instructors.aspx.cs*Utwórz następujące elementy zastępcze dla metody `CourseDetailsEntityDataSource_Selected`.</span><span class="sxs-lookup"><span data-stu-id="e68c3-172">In *Instructors.aspx.cs*, create the following stub for the `CourseDetailsEntityDataSource_Selected` method.</span></span> <span data-ttu-id="e68c3-173">(W dalszej części tego samouczka zostanie wypełniona ta procedura), która będzie potrzebna, aby strona została skompilowana i uruchomiona.</span><span class="sxs-lookup"><span data-stu-id="e68c3-173">(You'll fill this stub out later in the tutorial; for now, you need it so that the page will compile and run.)</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample10.cs)]

<span data-ttu-id="e68c3-174">Uruchom stronę.</span><span class="sxs-lookup"><span data-stu-id="e68c3-174">Run the page.</span></span>

<span data-ttu-id="e68c3-175">[![Image06](the-entity-framework-and-aspnet-getting-started-part-4/_static/image12.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="e68c3-175">[![Image06](the-entity-framework-and-aspnet-getting-started-part-4/_static/image12.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image11.png)</span></span>

<span data-ttu-id="e68c3-176">Początkowo nie ma szczegółowych informacji o kursie, ponieważ nie wybrano kursu.</span><span class="sxs-lookup"><span data-stu-id="e68c3-176">Initially there are no course details because no course is selected.</span></span> <span data-ttu-id="e68c3-177">Wybierz instruktora, który ma przypisany kurs, a następnie wybierz kurs, aby wyświetlić szczegóły.</span><span class="sxs-lookup"><span data-stu-id="e68c3-177">Select an instructor who has a course assigned, and then select a course to see the details.</span></span>

<span data-ttu-id="e68c3-178">[![Image07](the-entity-framework-and-aspnet-getting-started-part-4/_static/image14.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="e68c3-178">[![Image07](the-entity-framework-and-aspnet-getting-started-part-4/_static/image14.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image13.png)</span></span>

## <a name="using-the-entitydatasource-selected-event-to-display-related-data"></a><span data-ttu-id="e68c3-179">Wyświetlanie powiązanych danych przy użyciu zdarzenia EntityDataSource "selected"</span><span class="sxs-lookup"><span data-stu-id="e68c3-179">Using the EntityDataSource "Selected" Event to Display Related Data</span></span>

<span data-ttu-id="e68c3-180">Na koniec chcesz wyświetlić wszystkie zarejestrowane uczniowie i ich klasy dla wybranego kursu.</span><span class="sxs-lookup"><span data-stu-id="e68c3-180">Finally, you want to show all of the enrolled students and their grades for the selected course.</span></span> <span data-ttu-id="e68c3-181">W tym celu należy użyć zdarzenia `Selected` formantu `EntityDataSource` powiązanego z `DetailsView`em kursu.</span><span class="sxs-lookup"><span data-stu-id="e68c3-181">To do this, you'll use the `Selected` event of the `EntityDataSource` control bound to the course `DetailsView`.</span></span>

<span data-ttu-id="e68c3-182">W oknie *instruktors. aspx*Dodaj następujące znaczniki po kontrolce `DetailsView`:</span><span class="sxs-lookup"><span data-stu-id="e68c3-182">In *Instructors.aspx*, add the following markup after the `DetailsView` control:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample11.aspx)]

<span data-ttu-id="e68c3-183">Ten znacznik tworzy formant `ListView`, który wyświetla listę studentów i ich klasy dla wybranego kursu.</span><span class="sxs-lookup"><span data-stu-id="e68c3-183">This markup creates a `ListView` control that displays a list of students and their grades for the selected course.</span></span> <span data-ttu-id="e68c3-184">Nie określono źródła danych, ponieważ będziesz wiązać się z kontrolką w kodzie.</span><span class="sxs-lookup"><span data-stu-id="e68c3-184">No data source is specified because you'll databind the control in code.</span></span> <span data-ttu-id="e68c3-185">Element `EmptyDataTemplate` udostępnia komunikat, który będzie wyświetlany, gdy nie jest wybrany żaden kurs — w tym przypadku nie ma studentów do wyświetlenia.</span><span class="sxs-lookup"><span data-stu-id="e68c3-185">The `EmptyDataTemplate` element provides a message to display when no course is selected—in that case, there are no students to display.</span></span> <span data-ttu-id="e68c3-186">Element `LayoutTemplate` tworzy tabelę HTML do wyświetlania listy, a `ItemTemplate` określa kolumny do wyświetlenia.</span><span class="sxs-lookup"><span data-stu-id="e68c3-186">The `LayoutTemplate` element creates an HTML table to display the list, and the `ItemTemplate` specifies the columns to display.</span></span> <span data-ttu-id="e68c3-187">Identyfikator ucznia i jakość ucznia pochodzą z jednostki `StudentGrade`, a nazwa ucznia pochodzi z jednostki `Person`, która Entity Framework udostępniana w `Person` właściwości nawigacji jednostki `StudentGrade`.</span><span class="sxs-lookup"><span data-stu-id="e68c3-187">The student ID and the student grade are from the `StudentGrade` entity, and the student name is from the `Person` entity that the Entity Framework makes available in the `Person` navigation property of the `StudentGrade` entity.</span></span>

<span data-ttu-id="e68c3-188">W *Instructors.aspx.cs*Zastąp metodę `CourseDetailsEntityDataSource_Selected` użyto metod zastępczych, używając następującego kodu:</span><span class="sxs-lookup"><span data-stu-id="e68c3-188">In *Instructors.aspx.cs*, replace the stubbed-out `CourseDetailsEntityDataSource_Selected` method with the following code:</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample12.cs)]

<span data-ttu-id="e68c3-189">Argument zdarzenia dla tego zdarzenia zawiera wybrane dane w postaci kolekcji, które będą miały zero elementów, jeśli nic nie jest zaznaczone lub jeden element w przypadku wybrania jednostki `Course`.</span><span class="sxs-lookup"><span data-stu-id="e68c3-189">The event argument for this event provides the selected data in the form of a collection, which will have zero items if nothing is selected or one item if a `Course` entity is selected.</span></span> <span data-ttu-id="e68c3-190">Jeśli wybrano jednostkę `Course`, kod używa metody `First` do konwersji kolekcji na pojedynczy obiekt.</span><span class="sxs-lookup"><span data-stu-id="e68c3-190">If a `Course` entity is selected, the code uses the `First` method to convert the collection to a single object.</span></span> <span data-ttu-id="e68c3-191">Następnie pobiera `StudentGrade` jednostek z właściwości nawigacji, konwertuje je do kolekcji i wiąże formant `GradesListView` z kolekcją.</span><span class="sxs-lookup"><span data-stu-id="e68c3-191">It then gets `StudentGrade` entities from the navigation property, converts them to a collection, and binds the `GradesListView` control to the collection.</span></span>

<span data-ttu-id="e68c3-192">Jest to wystarczające do wyświetlania ocen, ale chcesz upewnić się, że komunikat w pustym szablonie danych jest wyświetlany podczas pierwszego wyświetlania strony i gdy nie wybrano kursu.</span><span class="sxs-lookup"><span data-stu-id="e68c3-192">This is sufficient to display grades, but you want to make sure that the message in the empty data template is displayed the first time the page is displayed and whenever a course is not selected.</span></span> <span data-ttu-id="e68c3-193">W tym celu należy utworzyć następującą metodę, która będzie wywoływana z dwóch miejsc:</span><span class="sxs-lookup"><span data-stu-id="e68c3-193">To do that, create the following method, which you'll call from two places:</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample13.cs)]

<span data-ttu-id="e68c3-194">Wywołaj tę nową metodę z metody `Page_Load`, aby wyświetlić pusty szablon danych podczas pierwszego wyświetlania strony.</span><span class="sxs-lookup"><span data-stu-id="e68c3-194">Call this new method from the `Page_Load` method to display the empty data template the first time the page is displayed.</span></span> <span data-ttu-id="e68c3-195">I Wywołaj ją z metody `InstructorsGridView_SelectedIndexChanged`, ponieważ to zdarzenie jest zgłaszane w przypadku wybrania instruktora, co oznacza, że nowe kursy są ładowane do kontrolki kursy `GridView` i żadna nie została jeszcze wybrana.</span><span class="sxs-lookup"><span data-stu-id="e68c3-195">And call it from the `InstructorsGridView_SelectedIndexChanged` method because that event is raised when an instructor is selected, which means new courses are loaded into the courses `GridView` control and none is selected yet.</span></span> <span data-ttu-id="e68c3-196">Oto dwa wywołania:</span><span class="sxs-lookup"><span data-stu-id="e68c3-196">Here are the two calls:</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample14.cs)]

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample15.cs)]

<span data-ttu-id="e68c3-197">Uruchom stronę.</span><span class="sxs-lookup"><span data-stu-id="e68c3-197">Run the page.</span></span>

<span data-ttu-id="e68c3-198">[![Image08](the-entity-framework-and-aspnet-getting-started-part-4/_static/image16.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="e68c3-198">[![Image08](the-entity-framework-and-aspnet-getting-started-part-4/_static/image16.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image15.png)</span></span>

<span data-ttu-id="e68c3-199">Wybierz instruktora, który ma przypisany kurs, a następnie wybierz kurs.</span><span class="sxs-lookup"><span data-stu-id="e68c3-199">Select an instructor that has a course assigned, and then select the course.</span></span>

<span data-ttu-id="e68c3-200">[![Image09](the-entity-framework-and-aspnet-getting-started-part-4/_static/image18.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="e68c3-200">[![Image09](the-entity-framework-and-aspnet-getting-started-part-4/_static/image18.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image17.png)</span></span>

<span data-ttu-id="e68c3-201">Widzisz teraz kilka sposobów pracy z powiązanymi danymi.</span><span class="sxs-lookup"><span data-stu-id="e68c3-201">You have now seen a few ways to work with related data.</span></span> <span data-ttu-id="e68c3-202">W poniższym samouczku dowiesz się, jak dodać relacje między istniejącymi jednostkami, jak usunąć relacje i jak dodać nową jednostkę, która ma relację z istniejącą jednostką.</span><span class="sxs-lookup"><span data-stu-id="e68c3-202">In the following tutorial, you'll learn how to add relationships between existing entities, how to remove relationships, and how to add a new entity that has a relationship to an existing entity.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="e68c3-203">[Poprzednie](the-entity-framework-and-aspnet-getting-started-part-3.md)
> [dalej](the-entity-framework-and-aspnet-getting-started-part-5.md)</span><span class="sxs-lookup"><span data-stu-id="e68c3-203">[Previous](the-entity-framework-and-aspnet-getting-started-part-3.md)
[Next](the-entity-framework-and-aspnet-getting-started-part-5.md)</span></span>
