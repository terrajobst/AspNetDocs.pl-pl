---
uid: web-forms/overview/older-versions-security/introduction/forms-authentication-configuration-and-advanced-topics-cs
title: Konfiguracja uwierzytelniania formularzy i Tematy zaawansowane (C#) | Dokumentacja firmy Microsoft
author: rick-anderson
description: W tym samouczku Zapoznamy zbadania różnych ustawień uwierzytelniania formularzy i dowiedzieć się, jak ich modyfikacji przez element formularzy. Wiąże się to szczegółowe...
ms.author: riande
ms.date: 01/14/2008
ms.assetid: b9c29865-a34e-48bb-92c0-c443a72cb860
msc.legacyurl: /web-forms/overview/older-versions-security/introduction/forms-authentication-configuration-and-advanced-topics-cs
msc.type: authoredcontent
ms.openlocfilehash: 33d9c90aa2798ec7a88acc8ff4e4062efc0701fc
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 03/01/2019
ms.locfileid: "57072467"
---
<a name="forms-authentication-configuration-and-advanced-topics-c"></a><span data-ttu-id="5afa5-104">Konfiguracja uwierzytelniania formularzy i tematy zaawansowane (C#)</span><span class="sxs-lookup"><span data-stu-id="5afa5-104">Forms Authentication Configuration and Advanced Topics (C#)</span></span>
====================
<span data-ttu-id="5afa5-105">przez [Bento Scott](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="5afa5-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="5afa5-106">[Pobierz program Code](http://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/ASPNET_Security_Tutorial_03_CS.zip) lub [Pobierz plik PDF](http://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/aspnet_tutorial03_AuthAdvanced_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="5afa5-106">[Download Code](http://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/ASPNET_Security_Tutorial_03_CS.zip) or [Download PDF](http://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/aspnet_tutorial03_AuthAdvanced_cs.pdf)</span></span>

> <span data-ttu-id="5afa5-107">W tym samouczku Zapoznamy zbadania różnych ustawień uwierzytelniania formularzy i dowiedzieć się, jak ich modyfikacji przez element formularzy.</span><span class="sxs-lookup"><span data-stu-id="5afa5-107">In this tutorial we will examine the various forms authentication settings and see how to modify them through the forms element.</span></span> <span data-ttu-id="5afa5-108">Wiąże się to szczegółowe omówienie na dostosowywanie biletu uwierzytelniania formularzy, wartość limitu czasu, za pomocą strony logowania za pomocą niestandardowego adresu URL (na przykład SignIn.aspx zamiast Login.aspx) i biletów uwierzytelniania formularzy cookieless.</span><span class="sxs-lookup"><span data-stu-id="5afa5-108">This will entail a detailed look at customizing the forms authentication ticket's timeout value, using a login page with a custom URL (like SignIn.aspx instead of Login.aspx), and cookieless forms authentication tickets.</span></span>


## <a name="introduction"></a><span data-ttu-id="5afa5-109">Wprowadzenie</span><span class="sxs-lookup"><span data-stu-id="5afa5-109">Introduction</span></span>

<span data-ttu-id="5afa5-110">W [poprzedniego samouczka](an-overview-of-forms-authentication-cs.md) przyjrzeliśmy się niezbędne w celu wykonania uwierzytelniania formularzy w aplikacji ASP.NET z Określanie ustawień konfiguracji w pliku Web.config, do tworzenia dziennika na stronie do wyświetlania różnych kroków zawartość dla użytkowników uwierzytelnionych i anonimowych.</span><span class="sxs-lookup"><span data-stu-id="5afa5-110">In the [previous tutorial](an-overview-of-forms-authentication-cs.md) we looked at the steps necessary for implementing forms authentication in an ASP.NET application, from specifying configuration settings in Web.config to creating a log in page to displaying different content for authenticated and anonymous users.</span></span> <span data-ttu-id="5afa5-111">Pamiętaj, że skonfigurowaliśmy witryny sieci Web, aby używać uwierzytelniania formularzy, ustawiając atrybut tryb &lt;uwierzytelniania&gt; element do formularzy.</span><span class="sxs-lookup"><span data-stu-id="5afa5-111">Recall that we configured the website to use forms authentication by setting the mode attribute of the &lt;authentication&gt; element to Forms.</span></span> <span data-ttu-id="5afa5-112">&lt;Uwierzytelniania&gt; elementu może opcjonalnie obejmować &lt;formularzy&gt; elementu podrzędnego, za pomocą których można określić pewną liczbę ustawień uwierzytelniania formularzy.</span><span class="sxs-lookup"><span data-stu-id="5afa5-112">The &lt;authentication&gt; element may optionally include a &lt;forms&gt; child element, through which an assortment of forms authentication settings may be specified.</span></span>

<span data-ttu-id="5afa5-113">W tym samouczku będziemy zbada różnych ustawień uwierzytelniania formularzy i zobacz, jak i zmodyfikuj je za pośrednictwem &lt;formularzy&gt; elementu.</span><span class="sxs-lookup"><span data-stu-id="5afa5-113">In this tutorial we will examine the various forms authentication settings and see how to modify them through the &lt;forms&gt; element.</span></span> <span data-ttu-id="5afa5-114">Wiąże się to szczegółowe omówienie na dostosowywanie biletu uwierzytelniania formularzy, wartość limitu czasu, za pomocą strony logowania za pomocą niestandardowego adresu URL (na przykład SignIn.aspx zamiast Login.aspx) i biletów uwierzytelniania formularzy cookieless.</span><span class="sxs-lookup"><span data-stu-id="5afa5-114">This will entail a detailed look at customizing the forms authentication ticket's timeout value, using a login page with a custom URL (like SignIn.aspx instead of Login.aspx), and cookieless forms authentication tickets.</span></span> <span data-ttu-id="5afa5-115">Firma Microsoft będzie również dokładniej sprawdzić korzeń biletu uwierzytelniania formularzy i zobacz środki ostrożności, potrzebnego ASP.NET, aby upewnić się, że dane biletu są chronione przed inspekcją i manipulowania.</span><span class="sxs-lookup"><span data-stu-id="5afa5-115">We will also examine the makeup of the forms authentication ticket more closely and see the precautions ASP.NET takes to ensure that the ticket's data is secure from inspection and tampering.</span></span> <span data-ttu-id="5afa5-116">Na koniec zostanie przedstawiony sposób przechowywania danych dodatkowych użytkowników w biletu uwierzytelniania formularzy oraz modelu te dane za pomocą niestandardowego obiektu jednostki.</span><span class="sxs-lookup"><span data-stu-id="5afa5-116">Finally, we will look at how to store extra user data in the forms authentication ticket and how to model this data through a custom principal object.</span></span>

## <a name="step-1-examining-the-ltformsgt-configuration-settings"></a><span data-ttu-id="5afa5-117">Krok 1. Badanie &lt;formularzy&gt; ustawień konfiguracji</span><span class="sxs-lookup"><span data-stu-id="5afa5-117">Step 1: Examining the &lt;forms&gt; Configuration Settings</span></span>

<span data-ttu-id="5afa5-118">System uwierzytelniania formularzy w programie ASP.NET udostępnia wiele ustawień konfiguracji, które można dostosować na podstawie aplikacji w aplikacji.</span><span class="sxs-lookup"><span data-stu-id="5afa5-118">The forms authentication system in ASP.NET offers a number of configuration settings that can be customized on an application-by-application basis.</span></span> <span data-ttu-id="5afa5-119">Obejmuje to ustawienia, takie jak: uwierzytelnianie formularzy okres istnienia biletu; jakiego rodzaju ochrony jest stosowany do biletu; w obszarze rodzaju uwierzytelniania cookieless warunki są używane bilety; Ścieżka do strony logowania; i inne informacje.</span><span class="sxs-lookup"><span data-stu-id="5afa5-119">This includes settings like: the lifetime of the forms authentication ticket; what sort of protection is applied to the ticket; under what conditions cookieless authentication tickets are used; the path to the login page; and other information.</span></span> <span data-ttu-id="5afa5-120">Aby zmodyfikować wartości domyślne, należy dodać [ &lt;formularzy&gt; elementu](https://msdn.microsoft.com/library/1d3t3c61.aspx) jako element podrzędny elementu [ &lt;uwierzytelniania&gt; elementu](https://msdn.microsoft.com/library/532aee0e.aspx), określając tych właściwości wartości, które chcesz dostosować jako atrybuty XML w następujący sposób:</span><span class="sxs-lookup"><span data-stu-id="5afa5-120">To modify the default values, add a [&lt;forms&gt; element](https://msdn.microsoft.com/library/1d3t3c61.aspx) as a child of the [&lt;authentication&gt; element](https://msdn.microsoft.com/library/532aee0e.aspx), specifying those property values you want to customize as XML attributes like so:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample1.xml)]

<span data-ttu-id="5afa5-121">Tabela 1 zawiera podsumowanie właściwości, które można dostosowywać za pomocą &lt;formularzy&gt; elementu.</span><span class="sxs-lookup"><span data-stu-id="5afa5-121">Table 1 summarizes the properties that can be customized through the &lt;forms&gt; element.</span></span> <span data-ttu-id="5afa5-122">Ponieważ plik Web.config jest plikiem XML, nazwy atrybutów w lewej kolumnie jest rozróżniana wielkość liter.</span><span class="sxs-lookup"><span data-stu-id="5afa5-122">Since Web.config is an XML file, the attribute names in the left column are case-sensitive.</span></span>


| <span data-ttu-id="5afa5-123"><strong>Atrybut</strong></span><span class="sxs-lookup"><span data-stu-id="5afa5-123"><strong>Attribute</strong></span></span> |                                                                                                                                                                                                                                     <span data-ttu-id="5afa5-124"><strong>Opis</strong></span><span class="sxs-lookup"><span data-stu-id="5afa5-124"><strong>Description</strong></span></span>                                                                                                                                                                                                                                      |
|----------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         <span data-ttu-id="5afa5-125">cookieless</span><span class="sxs-lookup"><span data-stu-id="5afa5-125">cookieless</span></span>         |                                                                                                                <span data-ttu-id="5afa5-126">Ten atrybut określa, pod jakimi warunkami biletu uwierzytelniania są przechowywane w pliku cookie i są osadzone w adresie URL.</span><span class="sxs-lookup"><span data-stu-id="5afa5-126">This attribute specifies under what conditions the authentication ticket is stored in a cookie versus being embedded in the URL.</span></span> <span data-ttu-id="5afa5-127">Dozwolone wartości to: UseCookies; UseUri; Autowykrywanie; i UseDeviceProfile (ustawienie domyślne).</span><span class="sxs-lookup"><span data-stu-id="5afa5-127">Allowable values are: UseCookies; UseUri; AutoDetect; and UseDeviceProfile (the default).</span></span> <span data-ttu-id="5afa5-128">Krok 2 sprawdza, czy to ustawienie, które bardziej szczegółowo.</span><span class="sxs-lookup"><span data-stu-id="5afa5-128">Step 2 examines this setting in more detail.</span></span>                                                                                                                |
|         <span data-ttu-id="5afa5-129">defaultUrl</span><span class="sxs-lookup"><span data-stu-id="5afa5-129">defaultUrl</span></span>         |                                                                                                                                                         <span data-ttu-id="5afa5-130">Wskazuje adres URL, do którego użytkownicy są przekierowywani do po zalogowaniu się na stronie logowania, jeśli nie ma RedirectUrl wartości określone w zmiennej querystring.</span><span class="sxs-lookup"><span data-stu-id="5afa5-130">Indicates the URL that users are redirected to after signing in from the login page if there is no RedirectUrl value specified in the querystring.</span></span> <span data-ttu-id="5afa5-131">Wartość domyślna to default.aspx.</span><span class="sxs-lookup"><span data-stu-id="5afa5-131">The default value is default.aspx.</span></span>                                                                                                                                                         |
|           <span data-ttu-id="5afa5-132">domena</span><span class="sxs-lookup"><span data-stu-id="5afa5-132">domain</span></span>           | <span data-ttu-id="5afa5-133">Korzystając z biletów uwierzytelniania na podstawie plików cookie, to ustawienie określa wartość domeny pliku cookie.</span><span class="sxs-lookup"><span data-stu-id="5afa5-133">When using cookie-based authentication tickets, this setting specifies the cookie's domain value.</span></span> <span data-ttu-id="5afa5-134">Wartość domyślna to ciąg pusty, co powoduje, że przeglądarka do korzystania z domeny, z którego został wydany (na przykład www.yourdomain.com).</span><span class="sxs-lookup"><span data-stu-id="5afa5-134">The default value is an empty string, which causes the browser to use the domain from which it was issued (such as www.yourdomain.com).</span></span> <span data-ttu-id="5afa5-135">W takim przypadku plik cookie zostanie <strong>nie</strong> wysłania w przypadku wprowadzania żądań poddomen, na przykład admin.yourdomain.com.</span><span class="sxs-lookup"><span data-stu-id="5afa5-135">In this case, the cookie will <strong>not</strong> be sent when making requests to subdomains, such as admin.yourdomain.com.</span></span> <span data-ttu-id="5afa5-136">Jeśli chcesz, aby plik cookie, które mają być przekazane do wszystkimi domenami podrzędnymi, należy dostosować atrybut domain ustawieniem dla niego yourdomain.com.</span><span class="sxs-lookup"><span data-stu-id="5afa5-136">If you want the cookie to be passed to all subdomains you need to customize the domain attribute setting it to yourdomain.com.</span></span> |
|  <span data-ttu-id="5afa5-137">enableCrossAppRedirects</span><span class="sxs-lookup"><span data-stu-id="5afa5-137">enableCrossAppRedirects</span></span>   |                                                                                                                                                                   <span data-ttu-id="5afa5-138">Wartość logiczna wskazująca, czy użytkownicy uwierzytelnieni są zapamiętywane, gdy przekierowywane do adresów URL w innych aplikacjach sieci web na tym samym serwerze.</span><span class="sxs-lookup"><span data-stu-id="5afa5-138">A Boolean value indicating whether authenticated users are remembered when redirected to URLs in other web applications on the same server.</span></span> <span data-ttu-id="5afa5-139">Wartością domyślną jest false.</span><span class="sxs-lookup"><span data-stu-id="5afa5-139">The default is false.</span></span>                                                                                                                                                                   |
|          <span data-ttu-id="5afa5-140">loginUrl</span><span class="sxs-lookup"><span data-stu-id="5afa5-140">loginUrl</span></span>          |                                                                                                                                                                                                                      <span data-ttu-id="5afa5-141">Adres URL strony logowania.</span><span class="sxs-lookup"><span data-stu-id="5afa5-141">The URL of the login page.</span></span> <span data-ttu-id="5afa5-142">Wartość domyślna to login.aspx.</span><span class="sxs-lookup"><span data-stu-id="5afa5-142">The default value is login.aspx.</span></span>                                                                                                                                                                                                                      |
|            <span data-ttu-id="5afa5-143">nazwa</span><span class="sxs-lookup"><span data-stu-id="5afa5-143">name</span></span>            |                                                                                                                                                                                                   <span data-ttu-id="5afa5-144">Korzystając z biletów na podstawie plików cookie uwierzytelniania, nazwa pliku cookie.</span><span class="sxs-lookup"><span data-stu-id="5afa5-144">When using cookie-based authentication tickets, the name of the cookie.</span></span> <span data-ttu-id="5afa5-145">Wartość domyślna to. ASPXAUTH.</span><span class="sxs-lookup"><span data-stu-id="5afa5-145">The default is .ASPXAUTH.</span></span>                                                                                                                                                                                                   |
|            <span data-ttu-id="5afa5-146">ścieżka</span><span class="sxs-lookup"><span data-stu-id="5afa5-146">path</span></span>            |                                                                             <span data-ttu-id="5afa5-147">Korzystając z biletów uwierzytelniania na podstawie plików cookie, to ustawienie określa atrybut ścieżki pliku cookie.</span><span class="sxs-lookup"><span data-stu-id="5afa5-147">When using cookie-based authentication tickets, this setting specifies the cookie's path attribute.</span></span> <span data-ttu-id="5afa5-148">Atrybut path umożliwia zatem programistą, aby ograniczyć zakres pliku cookie do hierarchii określonego katalogu.</span><span class="sxs-lookup"><span data-stu-id="5afa5-148">The path attribute enables a developer to limit the scope of a cookie to a particular directory hierarchy.</span></span> <span data-ttu-id="5afa5-149">Wartością domyślną jest /, która informuje przeglądarkę, aby wysłać plik cookie biletu uwierzytelniania na każde żądanie, wprowadzone do domeny.</span><span class="sxs-lookup"><span data-stu-id="5afa5-149">The default value is /, which informs the browser to send the authentication ticket cookie to any request made to the domain.</span></span>                                                                              |
|         <span data-ttu-id="5afa5-150">ochrona</span><span class="sxs-lookup"><span data-stu-id="5afa5-150">protection</span></span>         |                                                                                                                                            <span data-ttu-id="5afa5-151">Wskazuje, jakie metody są używane do ochrony biletu uwierzytelniania formularzy.</span><span class="sxs-lookup"><span data-stu-id="5afa5-151">Indicates what techniques are used to protect the forms authentication ticket.</span></span> <span data-ttu-id="5afa5-152">Dozwolone wartości to: Wszystkie (ustawienie domyślne); Szyfrowanie; None; i sprawdzania poprawności.</span><span class="sxs-lookup"><span data-stu-id="5afa5-152">The allowable values are: All (the default); Encryption; None; and Validation.</span></span> <span data-ttu-id="5afa5-153">Te ustawienia są szczegółowo omówione w kroku 3.</span><span class="sxs-lookup"><span data-stu-id="5afa5-153">These settings are discussed in detail in Step 3.</span></span>                                                                                                                                            |
|         <span data-ttu-id="5afa5-154">requireSSL</span><span class="sxs-lookup"><span data-stu-id="5afa5-154">requireSSL</span></span>         |                                                                                                                                                                                <span data-ttu-id="5afa5-155">Wartość logiczna wskazująca, czy połączenia SSL jest wymagany do przesyłania pliku cookie uwierzytelniania.</span><span class="sxs-lookup"><span data-stu-id="5afa5-155">A Boolean value that indicates whether an SSL connection is required to transmit the authentication cookie.</span></span> <span data-ttu-id="5afa5-156">Wartość domyślna to false.</span><span class="sxs-lookup"><span data-stu-id="5afa5-156">The default value is false.</span></span>                                                                                                                                                                                |
|     <span data-ttu-id="5afa5-157">slidingExpiration</span><span class="sxs-lookup"><span data-stu-id="5afa5-157">slidingExpiration</span></span>      |                                                                                                 <span data-ttu-id="5afa5-158">Wartość logiczna wskazująca, czy limit czasu uwierzytelniania pliku cookie jest resetowany każdorazowo użytkownik odwiedza witrynę podczas jednej sesji.</span><span class="sxs-lookup"><span data-stu-id="5afa5-158">A Boolean value that indicates whether the authentication cookie's timeout is reset each time the user visits the site during a single session.</span></span> <span data-ttu-id="5afa5-159">Wartość domyślna to true.</span><span class="sxs-lookup"><span data-stu-id="5afa5-159">The default value is true.</span></span> <span data-ttu-id="5afa5-160">Omówiono bardziej szczegółowo w Określanie zasad limitu czasu biletu uwierzytelniania biletu wartość limitu czasu sekcji.</span><span class="sxs-lookup"><span data-stu-id="5afa5-160">The authentication ticket timeout policy is discussed in more detail in the Specifying the Ticket's Timeout Value section.</span></span>                                                                                                 |
|          <span data-ttu-id="5afa5-161">limit czasu</span><span class="sxs-lookup"><span data-stu-id="5afa5-161">timeout</span></span>           |                                                                                                                               <span data-ttu-id="5afa5-162">Określa czas w minutach, po którym wygasa plik cookie biletu uwierzytelniania.</span><span class="sxs-lookup"><span data-stu-id="5afa5-162">Specifies the time, in minutes, after which the authentication ticket cookie expires.</span></span> <span data-ttu-id="5afa5-163">Wartość domyślna to 30.</span><span class="sxs-lookup"><span data-stu-id="5afa5-163">The default value is 30.</span></span> <span data-ttu-id="5afa5-164">Omówiono bardziej szczegółowo w Określanie zasad limitu czasu biletu uwierzytelniania biletu wartość limitu czasu sekcji.</span><span class="sxs-lookup"><span data-stu-id="5afa5-164">The authentication ticket timeout policy is discussed in more detail in the Specifying the Ticket's Timeout Value section.</span></span>                                                                                                                               |

<span data-ttu-id="5afa5-165">**Tabela 1**: Podsumowanie &lt;formularzy&gt; atrybuty elementu</span><span class="sxs-lookup"><span data-stu-id="5afa5-165">**Table 1**: A Summary of the &lt;forms&gt; Element's Attributes</span></span>

<span data-ttu-id="5afa5-166">W programie ASP.NET 2.0 i ponad wartość domyślną wartości uwierzytelniania formularzy są zakodowane w klasie FormsAuthenticationConfiguration w programie .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="5afa5-166">In ASP.NET 2.0 and beyond, the default forms authentication values are hard-coded in the FormsAuthenticationConfiguration class in the .NET Framework.</span></span> <span data-ttu-id="5afa5-167">Wszelkie modyfikacje musi zostać zastosowana na podstawie aplikacji w aplikacji w pliku Web.config.</span><span class="sxs-lookup"><span data-stu-id="5afa5-167">Any modifications must be applied on an application-by-application basis in the Web.config file.</span></span> <span data-ttu-id="5afa5-168">To różni się od ASP.NET 1.x, gdzie wartości domyślne uwierzytelniania formularzy były przechowywane w pliku machine.config (i w związku z tym może zostać zmodyfikowany za pomocą edycji pliku machine.config).</span><span class="sxs-lookup"><span data-stu-id="5afa5-168">This differs from ASP.NET 1.x, where the default forms authentication values were stored in the machine.config file (and could therefore be modified via editing machine.config).</span></span> <span data-ttu-id="5afa5-169">Na temat platformy ASP.NET 1.x, warto wspomnieć, szereg ustawień systemu uwierzytelniania formularzy mieć różne domyślne wartości w programie ASP.NET 2.0 i poza nim niż w programie ASP.NET: 1.x.</span><span class="sxs-lookup"><span data-stu-id="5afa5-169">While on the topic of ASP.NET 1.x, it is worthwhile to mention that a number of the forms authentication system settings have different default values in ASP.NET 2.0 and beyond than in ASP.NET 1.x.</span></span> <span data-ttu-id="5afa5-170">Jeśli migrujesz aplikacji ze środowiska ASP.NET 1.x, ważne jest pod uwagę te różnice.</span><span class="sxs-lookup"><span data-stu-id="5afa5-170">If you are migrating your application from an ASP.NET 1.x environment, it is important to be aware of these differences.</span></span> <span data-ttu-id="5afa5-171">Zapoznaj się z [ &lt;formularzy&gt; dokumentacji technicznej element](https://msdn.microsoft.com/library/1d3t3c61.aspx) listę różnic.</span><span class="sxs-lookup"><span data-stu-id="5afa5-171">Consult [the &lt;forms&gt; element technical documentation](https://msdn.microsoft.com/library/1d3t3c61.aspx) for a list of the differences.</span></span>

> [!NOTE]
> <span data-ttu-id="5afa5-172">Kilka ustawień uwierzytelniania formularzy, takie jak limit czasu, domeny i ścieżki, określ szczegóły wynikowego pliku cookie biletu uwierzytelniania formularzy.</span><span class="sxs-lookup"><span data-stu-id="5afa5-172">Several forms authentication settings, such as the timeout, domain, and path, specify details for the resulting forms authentication ticket cookie.</span></span> <span data-ttu-id="5afa5-173">Aby uzyskać więcej informacji na temat plików cookie, jak działają i ich właściwości, przeczytaj [w tym samouczku pliki cookie](http://www.quirksmode.org/js/cookies.html).</span><span class="sxs-lookup"><span data-stu-id="5afa5-173">For more information on cookies, how they work, and their various properties, read [this Cookies tutorial](http://www.quirksmode.org/js/cookies.html).</span></span>


### <a name="specifying-the-tickets-timeout-value"></a><span data-ttu-id="5afa5-174">Określając wartość limitu czasu biletu</span><span class="sxs-lookup"><span data-stu-id="5afa5-174">Specifying the Ticket's Timeout Value</span></span>

<span data-ttu-id="5afa5-175">Bilet uwierzytelniania formularzy jest token reprezentujący tożsamości.</span><span class="sxs-lookup"><span data-stu-id="5afa5-175">The forms authentication ticket is a token that represents an identity.</span></span> <span data-ttu-id="5afa5-176">Biletów uwierzytelniania na podstawie plików cookie token ten jest przechowywany w postaci pliku cookie i wysyłane do serwera sieci web na każde żądanie.</span><span class="sxs-lookup"><span data-stu-id="5afa5-176">With cookie-based authentication tickets, this token is held in the form of a cookie and sent to the web server on each request.</span></span> <span data-ttu-id="5afa5-177">Posiadanie tokenu, w zasadzie deklaruje, jestem *username*, już logowali się i jest używany, aby tożsamości użytkowników należy pamiętać, między odwiedzin strony.</span><span class="sxs-lookup"><span data-stu-id="5afa5-177">Possession of the token, in essence, declares, I am *username*, I have already logged in, and is used so that a user's identity can be remembered across page visits.</span></span>

<span data-ttu-id="5afa5-178">Bilet uwierzytelniania formularzy nie tylko obejmuje tożsamości użytkownika, ale zawiera również informacje, aby zapewnić integralność i bezpieczeństwo tokenu.</span><span class="sxs-lookup"><span data-stu-id="5afa5-178">The forms authentication ticket not only includes the user's identity, but also contains information to help ensure the integrity and security of the token.</span></span> <span data-ttu-id="5afa5-179">Nie chcemy przecież szkodliwa użytkownikowi można utworzyć token fałszywe lub zmodyfikować legit token w jakiś sposób underhanded.</span><span class="sxs-lookup"><span data-stu-id="5afa5-179">After all, we don't want a nefarious user to be able to create a counterfeit token, or to modify a legit token in some underhanded way.</span></span>

<span data-ttu-id="5afa5-180">Jest jeden bit takich informacji znajdujących się w bilecie *wygaśnięcia*, czyli Data i godzina--ticket nie jest już prawidłowy.</span><span class="sxs-lookup"><span data-stu-id="5afa5-180">One such bit of information included in the ticket is an *expiry*, which is the date and time the ticket is no longer valid.</span></span> <span data-ttu-id="5afa5-181">Każdorazowo FormsAuthenticationModule sprawdza bilet uwierzytelnienia gwarantuje, że wygaśnięcia biletu nie został jeszcze przekazany.</span><span class="sxs-lookup"><span data-stu-id="5afa5-181">Each time the FormsAuthenticationModule inspects an authentication ticket, it ensures that the ticket's expiry has not yet passed.</span></span> <span data-ttu-id="5afa5-182">Jeśli tak, pomija--ticket i identyfikuje użytkownika jako anonimowy.</span><span class="sxs-lookup"><span data-stu-id="5afa5-182">If it has, it disregards the ticket and identifies the user as being anonymous.</span></span> <span data-ttu-id="5afa5-183">To zabezpieczenie pomaga w ochronie przed atakami powtarzania.</span><span class="sxs-lookup"><span data-stu-id="5afa5-183">This safeguard helps protect against replay attacks.</span></span> <span data-ttu-id="5afa5-184">Bez wygaśnięcia, jeśli haker był w stanie wyświetlić swoje sesje hands on użytkownika prawidłowego biletu — prawdopodobnie fizyczny dostęp do komputera i zakorzenienia za pośrednictwem ich pliki cookie — można wysyłają żądania do serwera z tego biletu uwierzytelniania kradzieży i Uzyskaj wpis.</span><span class="sxs-lookup"><span data-stu-id="5afa5-184">Without an expiry, if a hacker was able to get her hands on a user's valid authentication ticket - perhaps by gaining physical access to their computer and rooting through their cookies - they could send a request to the server with this stolen authentication ticket and gain entry.</span></span> <span data-ttu-id="5afa5-185">Natomiast po upływie nie zapobiec temu scenariuszowi, ale ogranicza okna, w którym będzie możliwe takiego ataku.</span><span class="sxs-lookup"><span data-stu-id="5afa5-185">While the expiry doesn't prevent this scenario, it does limit the window during which such an attack can succeed.</span></span>

> [!NOTE]
> <span data-ttu-id="5afa5-186">Krok 3 szczegółów innych technik używane przez system uwierzytelniania formularzy do ochrony biletu uwierzytelniania.</span><span class="sxs-lookup"><span data-stu-id="5afa5-186">Step 3 details additional techniques used by the forms authentication system to protect the authentication ticket.</span></span>


<span data-ttu-id="5afa5-187">Podczas tworzenia biletu uwierzytelniania, systemem uwierzytelniania formularzy określa jego wygaśnięcia, sprawdzając ustawienia limitu czasu.</span><span class="sxs-lookup"><span data-stu-id="5afa5-187">When creating the authentication ticket, the forms authentication system determines its expiry by consulting the timeout setting.</span></span> <span data-ttu-id="5afa5-188">Jak wspomniano w tabeli 1, limit czasu ustawień domyślnych do 30 minut, co oznacza, że po utworzeniu biletu uwierzytelniania formularzy jej wygaśnięcia jest ustawiona na datę i godzinę w przyszłości 30 minut.</span><span class="sxs-lookup"><span data-stu-id="5afa5-188">As noted in Table 1, the timeout setting defaults to 30 minutes, meaning that when the forms authentication ticket is created its expiry is set to a date and time 30 minutes in the future.</span></span>

<span data-ttu-id="5afa5-189">Po upływie definiuje bezwzględny czas w przyszłości wygaśnięcia biletu uwierzytelniania formularzy.</span><span class="sxs-lookup"><span data-stu-id="5afa5-189">The expiry defines an absolute time in the future when the forms authentication ticket expires.</span></span> <span data-ttu-id="5afa5-190">Jednak zazwyczaj deweloperów do zaimplementowania wygaśnięcia przewijania, taki, który jest resetowany za każdym razem, gdy użytkownik powraca do lokacji.</span><span class="sxs-lookup"><span data-stu-id="5afa5-190">But usually developers want to implement a sliding expiry, one that is reset every time the user revisits the site.</span></span> <span data-ttu-id="5afa5-191">To zachowanie zależy od ustawień slidingExpiration.</span><span class="sxs-lookup"><span data-stu-id="5afa5-191">This behavior is determined by the slidingExpiration settings.</span></span> <span data-ttu-id="5afa5-192">Jeśli ma wartość true (domyślnie), każdorazowo FormsAuthenticationModule użytkownik zostanie uwierzytelniony, aktualizuje wygaśnięcia biletu.</span><span class="sxs-lookup"><span data-stu-id="5afa5-192">If set to true (the default), each time the FormsAuthenticationModule authenticates a user, it updates the ticket's expiry.</span></span> <span data-ttu-id="5afa5-193">Jeśli ma wartość false, po upływie nie zostaną zaktualizowane na każde żądanie, co powoduje--ticket wygaśnie dokładnie limitu czasu liczba minut po pełnej po raz pierwszy--ticket utworzony.</span><span class="sxs-lookup"><span data-stu-id="5afa5-193">If set to false, the expiry is not updated on each request, thereby causing the ticket to expire exactly timeout number of minutes past when the ticket was first created.</span></span>

> [!NOTE]
> <span data-ttu-id="5afa5-194">Po upływie przechowywane w biletu uwierzytelniania jest bezwzględna wartość daty i godziny, takich jak 2 sierpień 2008 11:34:00.</span><span class="sxs-lookup"><span data-stu-id="5afa5-194">The expiry stored in the authentication ticket is an absolute date and time value, like August 2, 2008 11:34 AM.</span></span> <span data-ttu-id="5afa5-195">Ponadto daty i godziny są względem czasu lokalnego serwera sieci web.</span><span class="sxs-lookup"><span data-stu-id="5afa5-195">Moreover, the date and time are relative to the web server's local time.</span></span> <span data-ttu-id="5afa5-196">Ta decyzja projektowa może mieć kilka interesujących efekty uboczne wokół czasu letniego (DST), czyli gdy zegary w Stanach Zjednoczonych zostaną przeniesione wyprzedzeniem godzinę (przy założeniu, że serwer sieci web jest hostowana w ustawieniach regionalnych, gdy zostanie wykryty czas letni).</span><span class="sxs-lookup"><span data-stu-id="5afa5-196">This design decision can have some interesting side effects around Daylight Saving Time (DST), which is when clocks in the United States are moved ahead one hour (assuming the web server is hosted in a locale where Daylight Saving Time is observed).</span></span> <span data-ttu-id="5afa5-197">Należy wziąć pod uwagę, co się stanie, witryny sieci Web programu ASP.NET o wygaśnięciu 30-minutowy w zbliżonym czasie, który rozpoczyna czasu letniego (czyli o 2:00).</span><span class="sxs-lookup"><span data-stu-id="5afa5-197">Consider what would happen for an ASP.NET website with a 30 minute expiry near the time that DST begins (which is at 2:00 AM).</span></span> <span data-ttu-id="5afa5-198">Załóżmy, że użytkownik loguje się do witryny 11 marca 2008 o 1:55.</span><span class="sxs-lookup"><span data-stu-id="5afa5-198">Imagine a visitor signs on to the site on March 11, 2008 at 1:55 AM.</span></span> <span data-ttu-id="5afa5-199">Spowoduje to wygenerowanie biletu uwierzytelniania formularzy, który upływa 11 marca 2008 o 2:25 (30 minut w przyszłości).</span><span class="sxs-lookup"><span data-stu-id="5afa5-199">This would generate a forms authentication ticket that expires at March 11, 2008 at 2:25 AM (30 minutes in the future).</span></span> <span data-ttu-id="5afa5-200">Jednak po 2:00 AM toczy się wokół, zegar przechodzi do 3:00 z powodu czasu letniego.</span><span class="sxs-lookup"><span data-stu-id="5afa5-200">However, once 2:00 AM rolls around, the clock jumps to 3:00 AM because of DST.</span></span> <span data-ttu-id="5afa5-201">Po użytkownik załadowaniu nowej strony sześciu minut po zalogowaniu się (na 3:01:00), FormsAuthenticationModule zauważa, że bilet wygasł i przekierowuje użytkownika do strony logowania.</span><span class="sxs-lookup"><span data-stu-id="5afa5-201">When the user loads a new page six minutes after signing in (at 3:01 AM), the FormsAuthenticationModule notes that the ticket has expired and redirects the user to the login page.</span></span> <span data-ttu-id="5afa5-202">Bardziej szczegółowe omówienie dotyczące tego i innych oddities limitu czasu biletu uwierzytelniania, jak również rozwiązania problemu, wybierz kopię Stefan Schackow *Professional programu ASP.NET 2.0 zabezpieczeń, członkostwo i zarządzanie rolami* (ISBN: 978-0-7645-9698-8).</span><span class="sxs-lookup"><span data-stu-id="5afa5-202">For a more thorough discussion on this and other authentication ticket timeout oddities, as well as workarounds, pick up a copy of Stefan Schackow's *Professional ASP.NET 2.0 Security, Membership, and Role Management* (ISBN: 978-0-7645-9698-8).</span></span>


<span data-ttu-id="5afa5-203">Rysunek 1 przedstawia przepływ pracy, gdy slidingExpiration będzie miał ustawioną na wartość false, a limit czasu jest ustawiona na 30.</span><span class="sxs-lookup"><span data-stu-id="5afa5-203">Figure 1 illustrates the workflow when slidingExpiration is set to false and timeout is set to 30.</span></span> <span data-ttu-id="5afa5-204">Należy pamiętać, że bilet uwierzytelniania, wygenerowany przy logowaniu zawiera datę wygaśnięcia, a ta wartość nie jest aktualizowana podczas kolejnych żądań.</span><span class="sxs-lookup"><span data-stu-id="5afa5-204">Note that the authentication ticket generated at login contains the expiration date, and this value is not updated on subsequent requests.</span></span> <span data-ttu-id="5afa5-205">Jeśli FormsAuthenticationModule wykryje, że bilet wygasł, odrzuci ją i traktuje żądania jako użytkownik anonimowy.</span><span class="sxs-lookup"><span data-stu-id="5afa5-205">If the FormsAuthenticationModule finds that the ticket has expired, it discards it and treats the request as anonymous.</span></span>


<span data-ttu-id="5afa5-206">[![Graficzna reprezentacja biletu uwierzytelniania formularzy, po upływie slidingExpiration ma wartość false](forms-authentication-configuration-and-advanced-topics-cs/_static/image2.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="5afa5-206">[![A Graphical Representation of the Forms Authentication Ticket's Expiry When slidingExpiration is false](forms-authentication-configuration-and-advanced-topics-cs/_static/image2.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image1.png)</span></span>

<span data-ttu-id="5afa5-207">**Rysunek 01**: Graficzna reprezentacja biletu uwierzytelniania formularzy, po upływie slidingExpiration ma wartość false ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](forms-authentication-configuration-and-advanced-topics-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="5afa5-207">**Figure 01**: A Graphical Representation of the Forms Authentication Ticket's Expiry When slidingExpiration is false([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image3.png))</span></span>


<span data-ttu-id="5afa5-208">Na rysunku 2 przedstawiono przepływ pracy, gdy slidingExpiration będzie miał ustawioną wartość PRAWDA, a limit czasu jest ustawiona na 30.</span><span class="sxs-lookup"><span data-stu-id="5afa5-208">Figure 2 shows the workflow when slidingExpiration is set to true and timeout is set to 30.</span></span> <span data-ttu-id="5afa5-209">Po odebraniu uwierzytelnionego żądania (z biletem wygasła) jej wygaśnięcia jest aktualizowany do limitu liczby minut w przyszłości.</span><span class="sxs-lookup"><span data-stu-id="5afa5-209">When an authenticated request is received (with a non-expired ticket) its expiry is updated to timeout number of minutes in the future.</span></span>


<span data-ttu-id="5afa5-210">[![Graficzna reprezentacja biletu uwierzytelniania formularzy po slidingExpiration ma wartość true](forms-authentication-configuration-and-advanced-topics-cs/_static/image5.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="5afa5-210">[![A Graphical Representation of the Forms Authentication Ticket's When slidingExpiration is true](forms-authentication-configuration-and-advanced-topics-cs/_static/image5.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image4.png)</span></span>

<span data-ttu-id="5afa5-211">**Rysunek 02**: Graficzna reprezentacja biletu uwierzytelniania formularzy po slidingExpiration ma wartość true ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](forms-authentication-configuration-and-advanced-topics-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="5afa5-211">**Figure 02**: A Graphical Representation of the Forms Authentication Ticket's When slidingExpiration is true  ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image6.png))</span></span>


<span data-ttu-id="5afa5-212">Korzystając z biletów na podstawie plików cookie uwierzytelniania (ustawienie domyślne), staje się tej dyskusji z nieco bardziej skomplikowane, ponieważ pliki cookie może też mieć własne expiries określony.</span><span class="sxs-lookup"><span data-stu-id="5afa5-212">When using cookie-based authentication tickets (the default), this discussion becomes a little more confusing because cookies can also have their own expiries specified.</span></span> <span data-ttu-id="5afa5-213">Plik cookie wygaśnięcia (lub ich brak) powoduje, że przeglądarka podczas należy zniszczyć plik cookie.</span><span class="sxs-lookup"><span data-stu-id="5afa5-213">A cookie's expiry (or lack thereof) instructs the browser when the cookie should be destroyed.</span></span> <span data-ttu-id="5afa5-214">Jeśli plik cookie nie ma wygaśnięcia, jest niszczony, podczas zamykania przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="5afa5-214">If the cookie lacks an expiry, it is destroyed when the browser shuts down.</span></span> <span data-ttu-id="5afa5-215">Jeśli występuje wygaśnięcia jednak plik cookie pozostają zapisane na komputerze użytkownika aż do daty i czas określony w wygaśnięcia został przekazany.</span><span class="sxs-lookup"><span data-stu-id="5afa5-215">If an expiry is present, however, the cookie remains stored on the user's computer until the date and time specified in the expiry has passed.</span></span> <span data-ttu-id="5afa5-216">Jeśli plik cookie zostanie zniszczony przez przeglądarkę, już nie są wysyłane do serwera sieci web.</span><span class="sxs-lookup"><span data-stu-id="5afa5-216">When a cookie is destroyed by the browser, it is no longer sent to the web server.</span></span> <span data-ttu-id="5afa5-217">W związku ze zniszczeniem plik cookie jest analogiczne do użytkownika wylogować się w witrynie.</span><span class="sxs-lookup"><span data-stu-id="5afa5-217">Therefore, the destruction of a cookie is analogous to the user logging out of the site.</span></span>

> [!NOTE]
> <span data-ttu-id="5afa5-218">Oczywiście użytkownik aktywnie usunąć pliki cookie przechowywane na swoim komputerze.</span><span class="sxs-lookup"><span data-stu-id="5afa5-218">Of course, a user may proactively remove any cookies stored on their computer.</span></span> <span data-ttu-id="5afa5-219">W programie Internet Explorer 7 będzie przejdź do lokalizacji narzędzia, opcje i kliknij przycisk Usuń w sekcji Historia przeglądania.</span><span class="sxs-lookup"><span data-stu-id="5afa5-219">In Internet Explorer 7, you would go to Tools, Options, and click the Delete button in the Browsing history section.</span></span> <span data-ttu-id="5afa5-220">W tym miejscu przycisk usuwania plików cookie.</span><span class="sxs-lookup"><span data-stu-id="5afa5-220">From there, click the Delete cookies button.</span></span>


<span data-ttu-id="5afa5-221">System uwierzytelniania formularzy tworzy oparte na sesji lub ważności na podstawie plików cookie w zależności od wartości przekazanej w celu *persistCookie* parametru.</span><span class="sxs-lookup"><span data-stu-id="5afa5-221">The forms authentication system creates session-based or expiry-based cookies depending on the value passed in to the *persistCookie* parameter.</span></span> <span data-ttu-id="5afa5-222">Odwołania, która metod GetAuthCookie, SetAuthCookie i RedirectFromLoginPage klasy uwierzytelniania formularzy w dwóch parametrów wejściowych: *username* i *persistCookie*.</span><span class="sxs-lookup"><span data-stu-id="5afa5-222">Recall that the FormsAuthentication class's GetAuthCookie, SetAuthCookie, and RedirectFromLoginPage methods take in two input parameters: *username* and *persistCookie*.</span></span> <span data-ttu-id="5afa5-223">Na stronie logowania, utworzonego w poprzednim samouczku uwzględnione Pamiętaj mnie pole wyboru, które ustalić, czy trwały plik cookie został utworzony.</span><span class="sxs-lookup"><span data-stu-id="5afa5-223">The login page we created in the preceding tutorial included a Remember me CheckBox, which determined whether a persistent cookie was created.</span></span> <span data-ttu-id="5afa5-224">Trwałe pliki cookie są oparte na wygaśnięcia; trwałe pliki cookie są oparte na sesji.</span><span class="sxs-lookup"><span data-stu-id="5afa5-224">Persistent cookies are expiry-based; non-persistent cookies are session-based.</span></span>

<span data-ttu-id="5afa5-225">Limit czasu i slidingExpiration omówione już takie same mają zastosowanie do obu plików cookie opartego na sesji i wygaśnięcia.</span><span class="sxs-lookup"><span data-stu-id="5afa5-225">The timeout and slidingExpiration concepts already discussed apply the same to both session- and expiry-based cookies.</span></span> <span data-ttu-id="5afa5-226">Istnieje tylko jedna różnica drobne podczas wykonywania: korzystając z slidingTimeout o wartości true ważności na podstawie plików cookie, plik cookie wygaśnięcia są aktualizowane tylko po ponad połowy określonego czasu upłynął.</span><span class="sxs-lookup"><span data-stu-id="5afa5-226">There is only one minor difference in execution: when using expiry-based cookies with slidingTimeout set to true, the cookie's expiry is only updated when more than half of the specified time has elapsed.</span></span>

<span data-ttu-id="5afa5-227">Zaktualizujmy zasad limitu czasu biletu uwierzytelniania naszej witryny sieci Web, więc biletów, limit czasu po godzinie (60 minut), za pomocą wygaśniecie.</span><span class="sxs-lookup"><span data-stu-id="5afa5-227">Let's update our website's authentication ticket timeout policies so that tickets timeout after one hour (60 minutes), using a sliding expiration.</span></span> <span data-ttu-id="5afa5-228">Wpływ tej zmiany, zaktualizuj plik Web.config, dodając &lt;formularzy&gt; elementu &lt;uwierzytelniania&gt; element następującym kodem:</span><span class="sxs-lookup"><span data-stu-id="5afa5-228">To effect this change, update the Web.config file, adding a &lt;forms&gt; element to the &lt;authentication&gt; element with the following markup:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample2.xml)]

### <a name="using-an-login-page-url-other-than-loginaspx"></a><span data-ttu-id="5afa5-229">Przy użyciu adresu URL strony logowania inne niż Login.aspx</span><span class="sxs-lookup"><span data-stu-id="5afa5-229">Using an Login Page URL Other than Login.aspx</span></span>

<span data-ttu-id="5afa5-230">Ponieważ FormsAuthenticationModule automatycznie przekierowuje nieautoryzowanych użytkowników do strony logowania, trzeba znać adres URL strony logowania.</span><span class="sxs-lookup"><span data-stu-id="5afa5-230">Since the FormsAuthenticationModule automatically redirects unauthorized users to the login page, it needs to know the login page's URL.</span></span> <span data-ttu-id="5afa5-231">Ten adres URL jest określony przez atrybut loginUrl w &lt;formularzy&gt; elementu i wartość domyślna to login.aspx.</span><span class="sxs-lookup"><span data-stu-id="5afa5-231">This URL is specified by the loginUrl attribute in the &lt;forms&gt; element and defaults to login.aspx.</span></span> <span data-ttu-id="5afa5-232">Jeśli są przenoszenie się za pośrednictwem istniejącej witryny sieci Web, może już istnieć strony logowania przy użyciu innego adresu URL, taki, który został już zakładek i indeksowany przez wyszukiwarki.</span><span class="sxs-lookup"><span data-stu-id="5afa5-232">If you are porting over an existing website, you may already have a login page with a different URL, one that has already been bookmarked and indexed by search engines.</span></span> <span data-ttu-id="5afa5-233">Zamiast zmienianie nazw istniejących strona logowania do strony login.aspx i istotne łącza i zakładki użytkowników, zamiast tego można zmodyfikować atrybutu loginUrl, aby wskazywały do strony logowania.</span><span class="sxs-lookup"><span data-stu-id="5afa5-233">Rather than renaming your existing login page to login.aspx and breaking links and users' bookmarks, you can instead modify the loginUrl attribute to point to your login page.</span></span>

<span data-ttu-id="5afa5-234">Na przykład, jeśli Twoja strona logowania nosiła nazwę SignIn.aspx i znajdują się w katalogu użytkowników, możesz punkt ustawienia konfiguracji loginUrl ~/Users/SignIn.aspx w następujący sposób:</span><span class="sxs-lookup"><span data-stu-id="5afa5-234">For example, if your login page was named SignIn.aspx and was located in the Users directory, you could point the loginUrl configuration setting to ~/Users/SignIn.aspx like so:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample3.xml)]

<span data-ttu-id="5afa5-235">Ponieważ już naszej bieżącej aplikacji o nazwie Login.aspx strony logowania, nie ma potrzeby określić niestandardową wartość w &lt;formularzy&gt; elementu.</span><span class="sxs-lookup"><span data-stu-id="5afa5-235">Since our current application already has a login page named Login.aspx, there's no need to specify a custom value in the &lt;forms&gt; element.</span></span>

## <a name="step-2-using-cookieless-forms-authentication-tickets"></a><span data-ttu-id="5afa5-236">Krok 2. Za pomocą Cookieless biletów uwierzytelniania formularzy</span><span class="sxs-lookup"><span data-stu-id="5afa5-236">Step 2: Using Cookieless Forms Authentication Tickets</span></span>

<span data-ttu-id="5afa5-237">Domyślnie system uwierzytelniania formularzy Określa, czy do przechowywania jego biletów uwierzytelniania w kolekcji plików cookie lub osadzeniu w adresie URL, w oparciu o agenta użytkownika w witrynie.</span><span class="sxs-lookup"><span data-stu-id="5afa5-237">By default the forms authentication system determines whether to store its authentication tickets in the cookies collection or embed them in the URL based on the user agent visiting the site.</span></span> <span data-ttu-id="5afa5-238">Wszystkie mainstream przeglądarek komputerowych, takich jak program Internet Explorer, Firefox, Opera i Safari, obsługa plików cookie, ale nie wszystkie urządzenia przenośne nie.</span><span class="sxs-lookup"><span data-stu-id="5afa5-238">All mainstream desktop browsers like Internet Explorer, Firefox, Opera, and Safari, support cookies, but not all mobile devices do.</span></span>

<span data-ttu-id="5afa5-239">Zasady plików cookie, używane przez system uwierzytelniania formularzy zależy od ustawienia cookieless w &lt;formularzy&gt; element, który można przypisać jedną z czterech wartości:</span><span class="sxs-lookup"><span data-stu-id="5afa5-239">The cookie policy used by the forms authentication system depends on the cookieless setting in the &lt;forms&gt; element, which can be assigned one of four values:</span></span>

- <span data-ttu-id="5afa5-240">UseCookies - Określa, że zawsze będzie służyć biletów uwierzytelniania na podstawie plików cookie.</span><span class="sxs-lookup"><span data-stu-id="5afa5-240">UseCookies - specifies that cookie-based authentication tickets will always be used.</span></span>
- <span data-ttu-id="5afa5-241">UseUri — wskazuje, że biletów na podstawie plików cookie uwierzytelniania nigdy nie będą używane.</span><span class="sxs-lookup"><span data-stu-id="5afa5-241">UseUri - indicates that cookie-based authentication tickets will never be used.</span></span>
- <span data-ttu-id="5afa5-242">Autowykrywanie — Jeśli profil urządzenia obsługuje pliki cookie, biletów uwierzytelniania na podstawie plików cookie nie są używane; Jeśli profil urządzenia obsługuje pliki cookie, mechanizm sondowania jest używany do określenia, czy pliki cookie są włączone.</span><span class="sxs-lookup"><span data-stu-id="5afa5-242">AutoDetect - if the device profile does not support cookies, cookie-based authentication tickets are not used; if the device profile supports cookies, a probing mechanism is used to determine if cookies are enabled.</span></span>
- <span data-ttu-id="5afa5-243">UseDeviceProfile — domyślnie; używa biletów uwierzytelniania na podstawie plików cookie tylko wtedy, gdy jest to obsługiwane przez profil urządzenia.</span><span class="sxs-lookup"><span data-stu-id="5afa5-243">UseDeviceProfile - the default; uses cookie-based authentication tickets only if the device profile supports cookies.</span></span> <span data-ttu-id="5afa5-244">Jest używany żaden mechanizm sondowania.</span><span class="sxs-lookup"><span data-stu-id="5afa5-244">No probing mechanism is used.</span></span>

<span data-ttu-id="5afa5-245">Zależą od ustawień Autowykrywanie i UseDeviceProfile *profilu urządzenia* w upewnieniu się, czy ma być używane uwierzytelnianie na podstawie plików cookie lub cookieless biletów.</span><span class="sxs-lookup"><span data-stu-id="5afa5-245">The AutoDetect and UseDeviceProfile settings rely on a *device profile* in ascertaining whether to use cookie-based or cookieless authentication tickets.</span></span> <span data-ttu-id="5afa5-246">Program ASP.NET obsługuje bazę danych z różnych urządzeń i ich możliwości, takie jak czy obsługują one plików cookie, jakie wersje języka JavaScript obsługują i tak dalej.</span><span class="sxs-lookup"><span data-stu-id="5afa5-246">ASP.NET maintains a database of various devices and their capabilities, such as whether they support cookies, what version of JavaScript they support, and so on.</span></span> <span data-ttu-id="5afa5-247">Każdorazowo urządzenia żądania strony sieci web z serwera sieci web wysyła wzdłuż *agenta użytkownika* nagłówka HTTP, który identyfikuje typ urządzenia.</span><span class="sxs-lookup"><span data-stu-id="5afa5-247">Each time a device requests a web page from a web server it sends along a *user-agent* HTTP header that identifies the device type.</span></span> <span data-ttu-id="5afa5-248">ASP.NET automatycznie dopasowuje ciąg agenta użytkownika podane odpowiedni profil określony w swojej bazie danych.</span><span class="sxs-lookup"><span data-stu-id="5afa5-248">ASP.NET automatically matches the supplied user-agent string with the corresponding profile specified in its database.</span></span>

> [!NOTE]
> <span data-ttu-id="5afa5-249">Tej bazy danych z możliwości urządzenia są przechowywane w wielu plikach XML stosować się do [schematu plik definicji przeglądarki](https://msdn.microsoft.com/library/ms228122.aspx).</span><span class="sxs-lookup"><span data-stu-id="5afa5-249">This database of device capabilities is stored in a number of XML files that adhere to the [Browser Definition File schema](https://msdn.microsoft.com/library/ms228122.aspx).</span></span> <span data-ttu-id="5afa5-250">Domyślne pliki profilu urządzenia znajdują się w lokalizacji % WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG\Browsers.</span><span class="sxs-lookup"><span data-stu-id="5afa5-250">The default device profile files are located in %WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG\Browsers.</span></span> <span data-ttu-id="5afa5-251">Można również dodać niestandardowe pliki do aplikacji App\_folderu przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="5afa5-251">You can also add custom files to your application's App\_Browsers folder.</span></span> <span data-ttu-id="5afa5-252">Aby uzyskać więcej informacji, zobacz [How to: Wykryj typy przeglądarki we wzorcu ASP.NET Web Pages](https://msdn.microsoft.com/library/3yekbd5b.aspx).</span><span class="sxs-lookup"><span data-stu-id="5afa5-252">For more information, see [How To: Detect Browser Types in ASP.NET Web Pages](https://msdn.microsoft.com/library/3yekbd5b.aspx).</span></span>


<span data-ttu-id="5afa5-253">Ustawieniem domyślnym jest UseDeviceProfile, biletów uwierzytelniania formularzy cookieless będzie używany, gdy witryna jest kontrolowane przez urządzenie, którego profil zgłasza, że nie obsługuje pliki cookie.</span><span class="sxs-lookup"><span data-stu-id="5afa5-253">Because the default setting is UseDeviceProfile, cookieless forms authentication tickets will be used when the site is visited by a device whose profile reports that it does not support cookies.</span></span>

### <a name="encoding-the-authentication-ticket-in-the-url"></a><span data-ttu-id="5afa5-254">Kodowanie biletu uwierzytelniania w adresie URL</span><span class="sxs-lookup"><span data-stu-id="5afa5-254">Encoding the Authentication Ticket in the URL</span></span>

<span data-ttu-id="5afa5-255">Pliki cookie to naturalne średni, w tym informacji z przeglądarki do wszystkich żądań do określonej witryny internetowej, dlatego domyślne ustawienia uwierzytelniania formularzy używanie plików cookie, jeśli urządzenie zaproszonych obsługuje je.</span><span class="sxs-lookup"><span data-stu-id="5afa5-255">Cookies are a natural medium for including information from the browser in each request to a particular website, which is why the default forms authentication settings use cookies if the visiting device supports them.</span></span> <span data-ttu-id="5afa5-256">Jeśli pliki cookie nie są obsługiwane, należy zastosować alternatywny sposób przekazywania bilet uwierzytelnienia od klienta do serwera.</span><span class="sxs-lookup"><span data-stu-id="5afa5-256">If cookies are not supported, an alternate means for passing the authentication ticket from the client to the server must be employed.</span></span> <span data-ttu-id="5afa5-257">Typowym obejściem używanymi w środowiskach cookieless polega na zakodowaniu dane pliku cookie w adresie URL.</span><span class="sxs-lookup"><span data-stu-id="5afa5-257">A common workaround used in cookieless environments is to encode the cookie data in the URL.</span></span>

<span data-ttu-id="5afa5-258">Najlepszym sposobem, aby zobaczyć, jak takie informacje mogą być osadzone w adresie URL jest, aby wymusić używanie biletów uwierzytelniania cookieless lokację.</span><span class="sxs-lookup"><span data-stu-id="5afa5-258">The best way to see how such information can be embedded within the URL is to force the site to use cookieless authentication tickets.</span></span> <span data-ttu-id="5afa5-259">Można to zrobić, ustawiając UseUri ustawienie konfiguracji cookieless:</span><span class="sxs-lookup"><span data-stu-id="5afa5-259">This can be accomplished by setting the cookieless configuration setting to UseUri:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample4.xml)]

<span data-ttu-id="5afa5-260">Po wprowadzeniu tej zmiany, odwiedź witrynę za pośrednictwem przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="5afa5-260">Once you have made this change, visit the site through a browser.</span></span> <span data-ttu-id="5afa5-261">Gdy użytkownik odwiedzi jako użytkownik anonimowy, adresy URL będzie wyglądać dokładnie tak, jak przed.</span><span class="sxs-lookup"><span data-stu-id="5afa5-261">When visiting as an anonymous user, the URLs will look exactly like they did before.</span></span> <span data-ttu-id="5afa5-262">Na przykład podczas odwiedzania strony Default.aspx paska adresu w przeglądarce pokazuje następującego adresu URL:</span><span class="sxs-lookup"><span data-stu-id="5afa5-262">For example, when visiting Default.aspx page my browser's address bar shows the following URL:</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/default.aspx`

<span data-ttu-id="5afa5-263">Jednak po zalogowaniu biletu uwierzytelniania formularzy jest osadzony w adresie URL.</span><span class="sxs-lookup"><span data-stu-id="5afa5-263">However, upon logging in, the forms authentication ticket is embedded into the URL.</span></span> <span data-ttu-id="5afa5-264">Na przykład po przechodząc do strony logowania i logując się jako Sam, czy jestem powrót do strony Default.aspx, ale adres URL jest w tej chwili:</span><span class="sxs-lookup"><span data-stu-id="5afa5-264">For example, after visiting the login page and logging in as Sam, I am returned to the Default.aspx page, but the URL this time is:</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/(F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2))/default.aspx`

<span data-ttu-id="5afa5-265">Bilet uwierzytelniania formularzy ma zostały osadzone w adresie URL.</span><span class="sxs-lookup"><span data-stu-id="5afa5-265">The forms authentication ticket has been embedded within the URL.</span></span> <span data-ttu-id="5afa5-266">Ciąg (F (jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv rfezq0gKadKX0YPZCkA2) reprezentuje dane biletu uwierzytelniania zakodowany w formacie szesnastkowy, a to te same dane, które są zazwyczaj przechowywane w pliku cookie.</span><span class="sxs-lookup"><span data-stu-id="5afa5-266">The string (F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2) represents the hex-encoded authentication ticket information, and is the same data that is usually stored within a cookie.</span></span>

<span data-ttu-id="5afa5-267">Aby biletów uwierzytelniania cookieless do pracy system zakodować wszystkie adresy URL na stronie obejmujący dane biletu uwierzytelniania, w przeciwnym razie biletu uwierzytelniania zostaną utracone po kliknięciu łącza przez użytkownika.</span><span class="sxs-lookup"><span data-stu-id="5afa5-267">In order for cookieless authentication tickets to work, the system must encode all URLs on the page to include the authentication ticket data, otherwise the authentication ticket will be lost when the user clicks on a link.</span></span> <span data-ttu-id="5afa5-268">Szczęście tę logikę osadzania odbywa się automatycznie.</span><span class="sxs-lookup"><span data-stu-id="5afa5-268">Thankfully, this embedding logic is performed automatically.</span></span> <span data-ttu-id="5afa5-269">Aby zademonstrować tę funkcję, otwórz strony Default.aspx, a następnie dodaj kontrolkę Hiperlinku ustawienie jego właściwości tekstu i NavigateUrl Link przetestuj i SomePage.aspx, odpowiednio.</span><span class="sxs-lookup"><span data-stu-id="5afa5-269">To demonstrate this functionality, open the Default.aspx page and add a HyperLink control, setting its Text and NavigateUrl properties to Test Link and SomePage.aspx, respectively.</span></span> <span data-ttu-id="5afa5-270">Nie ma znaczenia, czy tak naprawdę nie ma strony w projekcie o nazwie SomePage.aspx.</span><span class="sxs-lookup"><span data-stu-id="5afa5-270">It doesn't matter that there really isn't a page in our project named SomePage.aspx.</span></span>

<span data-ttu-id="5afa5-271">Zapisać zmiany na Default.aspx i można go znaleźć za pośrednictwem przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="5afa5-271">Save the changes to Default.aspx and then visit it through a browser.</span></span> <span data-ttu-id="5afa5-272">Zaloguj się do witryny, aby biletu uwierzytelniania formularzy jest osadzony w adresie URL.</span><span class="sxs-lookup"><span data-stu-id="5afa5-272">Log on to the site so that the forms authentication ticket is embedded in the URL.</span></span> <span data-ttu-id="5afa5-273">Następnie na Default.aspx, kliknij łącze Testuj łącze.</span><span class="sxs-lookup"><span data-stu-id="5afa5-273">Next, from Default.aspx, click the Test Link link.</span></span> <span data-ttu-id="5afa5-274">Co się stało?</span><span class="sxs-lookup"><span data-stu-id="5afa5-274">What happened?</span></span> <span data-ttu-id="5afa5-275">Jeśli istnieje żadnej strony o nazwie SomePage.aspx, następnie wystąpił błąd 404, ale to nie jest ważne, w tym miejscu.</span><span class="sxs-lookup"><span data-stu-id="5afa5-275">If no page named SomePage.aspx exists, then a 404 error occurred, but that's not what's important here.</span></span> <span data-ttu-id="5afa5-276">Zamiast tego należy skoncentrować się na pasku adresu w przeglądarce.</span><span class="sxs-lookup"><span data-stu-id="5afa5-276">Instead, focus on the Address bar in your browser.</span></span> <span data-ttu-id="5afa5-277">Należy pamiętać, że zawiera on biletu uwierzytelniania formularzy w adresie URL!</span><span class="sxs-lookup"><span data-stu-id="5afa5-277">Note that it includes the forms authentication ticket in the URL!</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/(F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2))/SomePage.aspx`

<span data-ttu-id="5afa5-278">SomePage.aspx adres URL linku został automatycznie przekonwertowany do adresu URL, który się biletu uwierzytelniania — my nie mamy do zapisania lizawki kodu!</span><span class="sxs-lookup"><span data-stu-id="5afa5-278">The URL SomePage.aspx in the link was automatically converted into a URL that included the authentication ticket - we didn't have to write a lick of code!</span></span> <span data-ttu-id="5afa5-279">Bilet uwierzytelniania formularzy automatycznie zostanie osadzony w adresie URL hiperłącza, które nie rozpoczynają się od `http://` lub `/`.</span><span class="sxs-lookup"><span data-stu-id="5afa5-279">The form authentication ticket will automatically be embedded in the URL for any hyperlinks that do not start with `http://` or `/`.</span></span> <span data-ttu-id="5afa5-280">Nie ma znaczenia, jeśli hiperlink, pojawi się w wywołaniu Response.Redirect, kontroli hiperłącze lub element kotwicy HTML (czyli `<a href="...">...</a>`).</span><span class="sxs-lookup"><span data-stu-id="5afa5-280">It doesn't matter if the hyperlink appears in a call to Response.Redirect, in a HyperLink control, or in an anchor HTML element (i.e., `<a href="...">...</a>`).</span></span> <span data-ttu-id="5afa5-281">Tak długo, jak adres URL jest podobny do `http://www.someserver.com/SomePage.aspx` lub `/SomePage.aspx`, biletu uwierzytelniania formularzy, zostanie osadzony w firmie Microsoft.</span><span class="sxs-lookup"><span data-stu-id="5afa5-281">As long as the URL isn't something like `http://www.someserver.com/SomePage.aspx` or `/SomePage.aspx`, the forms authentication ticket will be embedded for us.</span></span>

> [!NOTE]
> <span data-ttu-id="5afa5-282">Biletów uwierzytelniania formularzy cookieless stosować się do tych samych zasad limitu czasu jako biletów uwierzytelniania na podstawie plików cookie.</span><span class="sxs-lookup"><span data-stu-id="5afa5-282">Cookieless forms authentication tickets adhere to the same timeout policies as cookie-based authentication tickets.</span></span> <span data-ttu-id="5afa5-283">Jednak biletów uwierzytelniania cookieless są bardziej podatne na ataki, ponieważ biletu uwierzytelniania jest osadzony bezpośrednio w adresie URL.</span><span class="sxs-lookup"><span data-stu-id="5afa5-283">However, cookieless authentication tickets are more prone to replay attacks since the authentication ticket is embedded directly in the URL.</span></span> <span data-ttu-id="5afa5-284">Wyobraź sobie użytkownik odwiedza witrynę sieci Web, loguje się i następnie wklejenie adresu URL w wiadomości e-mail do współpracownika.</span><span class="sxs-lookup"><span data-stu-id="5afa5-284">Imagine a user who visits a website, logs in, and then pastes the URL in an email to a colleague.</span></span> <span data-ttu-id="5afa5-285">Jeśli współpracownik kliknie ten link przed wygaśnięciem, ich będą rejestrowane w jako użytkownik, który wysłano wiadomość e-mail!</span><span class="sxs-lookup"><span data-stu-id="5afa5-285">If the colleague clicks on that link before the expiry is reached, they will be logged in as the user who sent the email!</span></span>


## <a name="step-3-securing-the-authentication-ticket"></a><span data-ttu-id="5afa5-286">Krok 3. Zabezpieczanie biletu uwierzytelniania</span><span class="sxs-lookup"><span data-stu-id="5afa5-286">Step 3: Securing the Authentication Ticket</span></span>

<span data-ttu-id="5afa5-287">Bilet uwierzytelniania formularzy jest przesyłane przez sieć w pliku cookie lub osadzonego bezpośrednio w adresie URL.</span><span class="sxs-lookup"><span data-stu-id="5afa5-287">The forms authentication ticket is transmitted over the wire either in a cookie or embedded directly within the URL.</span></span> <span data-ttu-id="5afa5-288">Oprócz informacji o tożsamości biletu uwierzytelniania mogą również obejmować dane użytkownika (jak zobaczymy w kroku 4).</span><span class="sxs-lookup"><span data-stu-id="5afa5-288">In addition to identity information, the authentication ticket can also include user data (as we will see in Step 4).</span></span> <span data-ttu-id="5afa5-289">W związku z tym, ważne jest, że biletu dane są szyfrowane z wścibskimi Ty masz dostęp oraz (nawet co ważniejsze) czy systemem uwierzytelniania formularzy, co umożliwiłoby zagwarantowanie--ticket nie został zmodyfikowany z.</span><span class="sxs-lookup"><span data-stu-id="5afa5-289">Consequently, it is important that the ticket's data is encrypted from prying eyes and (even more importantly) that the forms authentication system can guarantee that the ticket was not tampered with.</span></span>

<span data-ttu-id="5afa5-290">Aby zapewnić prywatność danych biletu, systemem uwierzytelniania formularzy można zaszyfrować dane biletu.</span><span class="sxs-lookup"><span data-stu-id="5afa5-290">To ensure the privacy of the ticket's data, the forms authentication system can encrypt the ticket data.</span></span> <span data-ttu-id="5afa5-291">Nie można zaszyfrować dane biletu wysyła potencjalnie wrażliwe informacje przez sieć w postaci zwykłego tekstu.</span><span class="sxs-lookup"><span data-stu-id="5afa5-291">Failure to encrypt the ticket data sends potentially sensitive information over the wire in plain-text.</span></span>

<span data-ttu-id="5afa5-292">Zagwarantowanie autentyczności biletu, muszą się systemem uwierzytelniania formularzy *zweryfikować* --ticket.</span><span class="sxs-lookup"><span data-stu-id="5afa5-292">To guarantee a ticket's authenticity, the forms authentication system must *validate* the ticket.</span></span> <span data-ttu-id="5afa5-293">Sprawdzanie poprawności jest zagwarantowanie, że do określonego elementu danych nie został zmodyfikowany i odbywa się za pośrednictwem  *[komunikat o kod uwierzytelniania (MAC)](http://en.wikipedia.org/wiki/Message_authentication_code)*.</span><span class="sxs-lookup"><span data-stu-id="5afa5-293">Validation is the act of ensuring that a particular piece of data has not been modified, and is accomplished via a *[message authentication code (MAC)](http://en.wikipedia.org/wiki/Message_authentication_code)*.</span></span> <span data-ttu-id="5afa5-294">Mówiąc komputerów MAC jest mała ilość informacji, która identyfikuje dane, które musi zostać zweryfikowany (w tym przypadku--ticket).</span><span class="sxs-lookup"><span data-stu-id="5afa5-294">In a nutshell, the MAC is a small piece of information that identifies the data that needs to be validated (in this case, the ticket).</span></span> <span data-ttu-id="5afa5-295">W przypadku modyfikowania danych reprezentowanego przez MAC następnie komputerów MAC i dane będą niezgodny.</span><span class="sxs-lookup"><span data-stu-id="5afa5-295">If the data represented by the MAC is modified, then the MAC and the data will not match up.</span></span> <span data-ttu-id="5afa5-296">Ponadto jest praktyce twardych przez hakera modyfikować dane i wygenerować własną MAC z zmodyfikowanych danych.</span><span class="sxs-lookup"><span data-stu-id="5afa5-296">Moreover, it is computationally hard for a hacker to both modify the data and generate his own MAC to correspond with the modified data.</span></span>

<span data-ttu-id="5afa5-297">Podczas tworzenia (lub modyfikowania) bilet, a systemem uwierzytelniania formularzy tworzy komputera MAC i dołącza je do danych biletu.</span><span class="sxs-lookup"><span data-stu-id="5afa5-297">When creating (or modifying) a ticket, the forms authentication system creates a MAC and attaches it to the ticket's data.</span></span> <span data-ttu-id="5afa5-298">Po odebraniu kolejne żądanie systemem uwierzytelniania formularzy porównuje dane systemów MAC i biletu umożliwia sprawdzenie oryginalności dane biletu.</span><span class="sxs-lookup"><span data-stu-id="5afa5-298">When a subsequent request arrives, the forms authentication system compares the MAC and ticket data to validate the authenticity of the ticket data.</span></span> <span data-ttu-id="5afa5-299">Rysunek 3 ilustruje ten przepływ pracy w formie graficznej.</span><span class="sxs-lookup"><span data-stu-id="5afa5-299">Figure 3 illustrates this workflow graphically.</span></span>


<span data-ttu-id="5afa5-300">[![Autentyczności biletu jest zapewniony przez komputer MAC](forms-authentication-configuration-and-advanced-topics-cs/_static/image8.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="5afa5-300">[![The Ticket's Authenticity is Ensured through a MAC](forms-authentication-configuration-and-advanced-topics-cs/_static/image8.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image7.png)</span></span>

<span data-ttu-id="5afa5-301">**Rysunek 03**: Zapewniony autentyczności biletu do komputera MAC ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](forms-authentication-configuration-and-advanced-topics-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="5afa5-301">**Figure 03**: The Ticket's Authenticity is Ensured through a MAC ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image9.png))</span></span>


<span data-ttu-id="5afa5-302">Jakie środki zabezpieczeń są stosowane do biletu uwierzytelniania zależy od ustawienia ochrony w &lt;formularzy&gt; elementu.</span><span class="sxs-lookup"><span data-stu-id="5afa5-302">What security measures are applied to the authentication ticket depends on the protection setting in the &lt;forms&gt; element.</span></span> <span data-ttu-id="5afa5-303">Ustawienie ochrony może być przypisana do jednego z trzech następujących wartości:</span><span class="sxs-lookup"><span data-stu-id="5afa5-303">The protection setting may be assigned to one of the following three values:</span></span>

- <span data-ttu-id="5afa5-304">All - biletu jest zaszyfrowany i podpisany cyfrowo (ustawienie domyślne).</span><span class="sxs-lookup"><span data-stu-id="5afa5-304">All - the ticket is both encrypted and digitally signed (the default).</span></span>
- <span data-ttu-id="5afa5-305">Szyfrowanie — tylko szyfrowanie jest stosowane — MAC nie jest generowany.</span><span class="sxs-lookup"><span data-stu-id="5afa5-305">Encryption - only encryption is applied - no MAC is generated.</span></span>
- <span data-ttu-id="5afa5-306">Brak — biletu nie jest szyfrowany ani podpisany cyfrowo.</span><span class="sxs-lookup"><span data-stu-id="5afa5-306">None - the ticket is neither encrypted nor digitally signed.</span></span>
- <span data-ttu-id="5afa5-307">Sprawdzanie poprawności — MAC jest generowany, ale dane biletu jest przesyłane przez sieć w postaci zwykłego tekstu.</span><span class="sxs-lookup"><span data-stu-id="5afa5-307">Validation - a MAC is generated, but the ticket data is sent over the wire in plain-text.</span></span>

<span data-ttu-id="5afa5-308">Firma Microsoft zaleca użycie wszystkie ustawienia.</span><span class="sxs-lookup"><span data-stu-id="5afa5-308">Microsoft strongly recommends using the All setting.</span></span>

### <a name="setting-the-validation-and-decryption-keys"></a><span data-ttu-id="5afa5-309">Ustawienia weryfikacji i kluczy Odszyfrowujących</span><span class="sxs-lookup"><span data-stu-id="5afa5-309">Setting the Validation and Decryption Keys</span></span>

<span data-ttu-id="5afa5-310">Szyfrowanie i używane przez system uwierzytelniania formularzy, szyfrowanie i sprawdzanie poprawności biletu uwierzytelniania algorytmy wyznaczania wartości skrótu są dostosowywane za pośrednictwem [ &lt;machineKey&gt; elementu](https://msdn.microsoft.com/library/w8h3skw9.aspx) w pliku Web.config. Tabela 2 przedstawiono &lt;machineKey&gt; atrybuty elementu i jego możliwych wartości.</span><span class="sxs-lookup"><span data-stu-id="5afa5-310">The encryption and hashing algorithms used by the forms authentication system to encrypt and validate the authentication ticket are customizable through the [&lt;machineKey&gt; element](https://msdn.microsoft.com/library/w8h3skw9.aspx) in Web.config. Table 2 outlines the &lt;machineKey&gt; element's attributes and their possible values.</span></span>

| <span data-ttu-id="5afa5-311">**Atrybut**</span><span class="sxs-lookup"><span data-stu-id="5afa5-311">**Attribute**</span></span> | <span data-ttu-id="5afa5-312">**Opis**</span><span class="sxs-lookup"><span data-stu-id="5afa5-312">**Description**</span></span> |
| --- | --- |
| <span data-ttu-id="5afa5-313">odszyfrowywanie</span><span class="sxs-lookup"><span data-stu-id="5afa5-313">decryption</span></span> | <span data-ttu-id="5afa5-314">Określa algorytm używany do szyfrowania.</span><span class="sxs-lookup"><span data-stu-id="5afa5-314">Indicates the algorithm used for encryption.</span></span> <span data-ttu-id="5afa5-315">Ten atrybut może mieć jedną z następujących czterech wartości: - Auto - default; Określa algorytm, w zależności od długości atrybutu decryptionKey.</span><span class="sxs-lookup"><span data-stu-id="5afa5-315">This attribute can have one of the following four values: - Auto - the default; determines the algorithm based on the length of the decryptionKey attribute.</span></span> <span data-ttu-id="5afa5-316">-Używa AES - [Advanced Encryption Standard (AES)](http://en.wikipedia.org/wiki/Advanced_Encryption_Standard) algorytmu.</span><span class="sxs-lookup"><span data-stu-id="5afa5-316">- AES - uses the [Advanced Encryption Standard (AES)](http://en.wikipedia.org/wiki/Advanced_Encryption_Standard) algorithm.</span></span> <span data-ttu-id="5afa5-317">-Używa DES - [Data Encryption Standard (DES)](http://en.wikipedia.org/wiki/Data_Encryption_Standard) ten algorytm jest uznawany za słabe praktyce i nie powinna być używana.</span><span class="sxs-lookup"><span data-stu-id="5afa5-317">- DES - uses the [Data Encryption Standard (DES)](http://en.wikipedia.org/wiki/Data_Encryption_Standard) This algorithm is considered computationally weak and should not be used.</span></span> <span data-ttu-id="5afa5-318">Używa - 3DES - [Triple DES](http://en.wikipedia.org/wiki/Triple_DES) algorytmu, który polega na stosowaniu algorytm DES trzy razy.</span><span class="sxs-lookup"><span data-stu-id="5afa5-318">- 3DES - uses the [Triple DES](http://en.wikipedia.org/wiki/Triple_DES) algorithm, which works by applying the DES algorithm three times.</span></span> |
| <span data-ttu-id="5afa5-319">decryptionKey</span><span class="sxs-lookup"><span data-stu-id="5afa5-319">decryptionKey</span></span> | <span data-ttu-id="5afa5-320">Używane przez algorytm szyfrowania klucza tajnego.</span><span class="sxs-lookup"><span data-stu-id="5afa5-320">The secret key used by the encryption algorithm.</span></span> <span data-ttu-id="5afa5-321">Ta wartość musi być ciąg szesnastkowy odpowiednią długość (na podstawie wartości odszyfrowywanie), automatyczne generowanie lub jedną z tych wartości, dołączony, IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="5afa5-321">This value must either be a hexadecimal string of the appropriate length (based on the value in decryption), AutoGenerate, or either value appended with,IsolateApps.</span></span> <span data-ttu-id="5afa5-322">Dodawanie IsolateApps powoduje, że program ASP.NET do użycia unikatową wartość dla każdej aplikacji.</span><span class="sxs-lookup"><span data-stu-id="5afa5-322">Adding IsolateApps instructs ASP.NET to use a unique value for each application.</span></span> <span data-ttu-id="5afa5-323">Wartość domyślna to automatyczne generowanie, IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="5afa5-323">The default is AutoGenerate,IsolateApps.</span></span> |
| <span data-ttu-id="5afa5-324">weryfikacja</span><span class="sxs-lookup"><span data-stu-id="5afa5-324">validation</span></span> | <span data-ttu-id="5afa5-325">Określa algorytm używany do sprawdzania poprawności.</span><span class="sxs-lookup"><span data-stu-id="5afa5-325">Indicates the algorithm used for validation.</span></span> <span data-ttu-id="5afa5-326">Ten atrybut może mieć jedną z następujących czterech wartości: - AES - używa algorytmu Advanced Encryption Standard (AES).</span><span class="sxs-lookup"><span data-stu-id="5afa5-326">This attribute can have one of the following four values: - AES - uses the Advanced Encryption Standard (AES) algorithm.</span></span> <span data-ttu-id="5afa5-327">-Używa MD5 - [Message Digest 5 (MD5)](http://en.wikipedia.org/wiki/MD5) algorytmu.</span><span class="sxs-lookup"><span data-stu-id="5afa5-327">- MD5 - uses the [Message-Digest 5 (MD5)](http://en.wikipedia.org/wiki/MD5) algorithm.</span></span> <span data-ttu-id="5afa5-328">-Używa SHA1 - [SHA1](http://en.wikipedia.org/wiki/Sha1) algorytm (ustawienie domyślne).</span><span class="sxs-lookup"><span data-stu-id="5afa5-328">- SHA1 - uses the [SHA1](http://en.wikipedia.org/wiki/Sha1) algorithm (the default).</span></span> <span data-ttu-id="5afa5-329">-3DES - używa algorytmu Triple DES.</span><span class="sxs-lookup"><span data-stu-id="5afa5-329">- 3DES - uses the Triple DES algorithm.</span></span> |
| <span data-ttu-id="5afa5-330">validationKey</span><span class="sxs-lookup"><span data-stu-id="5afa5-330">validationKey</span></span> | <span data-ttu-id="5afa5-331">Klucz tajny, używane przez algorytm sprawdzania poprawności.</span><span class="sxs-lookup"><span data-stu-id="5afa5-331">The secret key used by the validation algorithm.</span></span> <span data-ttu-id="5afa5-332">Ta wartość musi być ciąg szesnastkowy odpowiednią długość (na podstawie wartości podczas sprawdzania poprawności), automatyczne generowanie lub jedną z tych wartości, dołączony, IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="5afa5-332">This value must either be a hexadecimal string of the appropriate length (based on the value in validation), AutoGenerate, or either value appended with,IsolateApps.</span></span> <span data-ttu-id="5afa5-333">Dodawanie IsolateApps powoduje, że program ASP.NET do użycia unikatową wartość dla każdej aplikacji.</span><span class="sxs-lookup"><span data-stu-id="5afa5-333">Adding IsolateApps instructs ASP.NET to use a unique value for each application.</span></span> <span data-ttu-id="5afa5-334">Wartość domyślna to automatyczne generowanie, IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="5afa5-334">The default is AutoGenerate,IsolateApps.</span></span> |

<span data-ttu-id="5afa5-335">**Tabela 2**: &lt;MachineKey&gt; atrybutów elementów</span><span class="sxs-lookup"><span data-stu-id="5afa5-335">**Table 2**: The &lt;machineKey&gt; Element Attributes</span></span>

<span data-ttu-id="5afa5-336">Dogłębną dyskusję te opcje szyfrowanie i sprawdzanie poprawności i profesjonalistów zalet i wad różnych algorytmów wykracza poza zakres tego samouczka.</span><span class="sxs-lookup"><span data-stu-id="5afa5-336">A thorough discussion of these encryption and validation options, and the pros and cons of the various algorithms, is beyond the scope of this tutorial.</span></span> <span data-ttu-id="5afa5-337">Dla szczegółowe Przyjrzyj się tych problemów oraz wskazówki dotyczące jakie algorytmy, szyfrowanie i sprawdzanie poprawności, aby użyć, jakie długości kluczy do użycia i jest to najlepszy sposób wygenerować klucze, zapoznaj się *Professional programu ASP.NET 2.0 zabezpieczeń, członkostwo i zarządzanie rolami* .</span><span class="sxs-lookup"><span data-stu-id="5afa5-337">For an in-depth look at these issues, including guidance on what encryption and validation algorithms to use, what key lengths to use, and how best to generate these keys, refer to *Professional ASP.NET 2.0 Security, Membership, and Role Management*.</span></span>

<span data-ttu-id="5afa5-338">Domyślnie klucze używane do szyfrowania i odszyfrowywania są generowane automatycznie dla każdej aplikacji, a te klucze są przechowywane w urzędu zabezpieczeń lokalnych (LSA).</span><span class="sxs-lookup"><span data-stu-id="5afa5-338">By default, the keys used for encryption and validation are generated automatically for each application, and these keys are stored in the Local Security Authority (LSA).</span></span> <span data-ttu-id="5afa5-339">Krótko mówiąc domyślne ustawienia gwarantuje unikatowe klucze w serwera sieci web serwera sieci web i aplikacji w aplikacji.</span><span class="sxs-lookup"><span data-stu-id="5afa5-339">In short, the default settings guarantee unique keys on a web server-by-web server and application-by-application basis.</span></span> <span data-ttu-id="5afa5-340">W związku z tym to domyślne zachowanie nie będzie działać w dwóch następujących scenariuszach:</span><span class="sxs-lookup"><span data-stu-id="5afa5-340">Consequently, this default behavior will not work for the two following scenarios:</span></span>

- <span data-ttu-id="5afa5-341">**Kolektywów serwerów sieci Web** — w [kolektywu serwerów sieci web](http://en.wikipedia.org/wiki/Web_farm) scenariusza i aplikacji sieci web jednym znajduje się na wielu serwerach sieci web na potrzeby skalowalności i nadmiarowości.</span><span class="sxs-lookup"><span data-stu-id="5afa5-341">**Web Farms** - in a [web farm](http://en.wikipedia.org/wiki/Web_farm) scenario, a single web application is hosted on multiple web servers for purposes of scalability and redundancy.</span></span> <span data-ttu-id="5afa5-342">Każdego żądania przychodzącego jest wysyłane do serwera w farmie, co oznacza, że przez cały okres istnienia sesji użytkownika, różne serwery może służyć do obsługi jego różnych żądań.</span><span class="sxs-lookup"><span data-stu-id="5afa5-342">Each incoming request is dispatched to a server in the farm, meaning that over the lifetime of a user's session, different servers may be used to handle his various requests.</span></span> <span data-ttu-id="5afa5-343">W związku z tym każdy serwer musi używać tych samych kluczy szyfrowania i odszyfrowywania, tak, aby utworzyć bilet uwierzytelniania formularzy, zaszyfrowane i zweryfikowane na jednym serwerze może być odszyfrowane i zweryfikowane na innym serwerze w farmie.</span><span class="sxs-lookup"><span data-stu-id="5afa5-343">Consequently, each server must use the same encryption and validation keys so that the forms authentication ticket created, encrypted, and validated on one server can be decrypted and validated on a different server in the farm.</span></span>
- <span data-ttu-id="5afa5-344">**Krzyżowe udostępnianie biletu aplikacji** — jednym serwerze sieci web mogą hostować wiele aplikacji programu ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="5afa5-344">**Cross Application Ticket Sharing** - a single web server may host multiple ASP.NET applications.</span></span> <span data-ttu-id="5afa5-345">Jeśli potrzebujesz tych różnych aplikacji do udostępniania biletu uwierzytelniania formularzy pojedynczego, konieczne jest aby dopasować swoje klucze szyfrowania i odszyfrowywania.</span><span class="sxs-lookup"><span data-stu-id="5afa5-345">If you need for these different applications to share a single forms authentication ticket, it is imperative that their encryption and validation keys match up.</span></span>

<span data-ttu-id="5afa5-346">Podczas pracy w ramach farmy sieci web, ustawienie lub udostępnianie biletów uwierzytelniania w aplikacjach na tym samym serwerze, należy skonfigurować &lt;machineKey&gt; elementu w aplikacjach, których dotyczy problem, aby ich decryptionKey i wartości validationKey zgodny.</span><span class="sxs-lookup"><span data-stu-id="5afa5-346">When working in a web farm setting or sharing authentication tickets across applications on the same server, you will need to configure the &lt;machineKey&gt; element in the affected applications so that their decryptionKey and validationKey values match up.</span></span>

<span data-ttu-id="5afa5-347">Gdy żaden z powyższych scenariuszy dotyczy naszą przykładową aplikacją, firma Microsoft nadal określić jawnego decryptionKey i wartości validationKey i zdefiniuj algorytmy, które ma być używany.</span><span class="sxs-lookup"><span data-stu-id="5afa5-347">While neither of the above scenarios applies to our sample application, we can still specify explicit decryptionKey and validationKey values and define the algorithms to be used.</span></span> <span data-ttu-id="5afa5-348">Dodaj &lt;machineKey&gt; ustawienie do pliku Web.config:</span><span class="sxs-lookup"><span data-stu-id="5afa5-348">Add a &lt;machineKey&gt; setting to the Web.config file:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample5.xml)]

<span data-ttu-id="5afa5-349">Aby uzyskać więcej informacji, zapoznaj się z [How to: Konfigurowanie elementu MachineKey w programie ASP.NET 2.0](https://msdn.microsoft.com/library/ms998288.aspx).</span><span class="sxs-lookup"><span data-stu-id="5afa5-349">For more information check out [How To: Configure MachineKey in ASP.NET 2.0](https://msdn.microsoft.com/library/ms998288.aspx).</span></span>

> [!NOTE]
> <span data-ttu-id="5afa5-350">Wartości decryptionKey i validationKey zostały pobrane z [Steve Gibson](http://www.grc.com/stevegibson.htm)firmy [strony sieci web doskonałe haseł](https://www.grc.com/passwords.htm), generująca 64 losowo wybranych znaków szesnastkowych na każdej wizyty strony.</span><span class="sxs-lookup"><span data-stu-id="5afa5-350">The decryptionKey and validationKey values were taken from [Steve Gibson](http://www.grc.com/stevegibson.htm)'s [Perfect Passwords web page](https://www.grc.com/passwords.htm), which generates 64 random hexadecimal characters on each page visit.</span></span> <span data-ttu-id="5afa5-351">Aby zmniejszyć prawdopodobieństwo te klucze, dzięki czemu swoją drogę do aplikacji produkcyjnych, zachęcamy do Zastąp powyższe klucze losowo generowany z nich ze strony doskonałe hasła.</span><span class="sxs-lookup"><span data-stu-id="5afa5-351">To lessen the likelihood of these keys making their way into your production applications, you are encouraged to replace the above keys with randomly generated ones from the Perfect Passwords page.</span></span>


## <a name="step-4-storing-additional-user-data-in-the-ticket"></a><span data-ttu-id="5afa5-352">Krok 4. Przechowywanie danych dodatkowych użytkowników w bilecie</span><span class="sxs-lookup"><span data-stu-id="5afa5-352">Step 4: Storing Additional User Data in the Ticket</span></span>

<span data-ttu-id="5afa5-353">Wiele aplikacji sieci web wyświetlić informacje o lub utworzyć wyświetlania strony na aktualnie zalogowanego użytkownika.</span><span class="sxs-lookup"><span data-stu-id="5afa5-353">Many web applications display information about or base the page's display on the currently logged on user.</span></span> <span data-ttu-id="5afa5-354">Na przykład strony sieci web może wyświetlać nazwę użytkownika i daty, których ona ostatniego zalogowania w prawym górnym rogu każdej strony.</span><span class="sxs-lookup"><span data-stu-id="5afa5-354">For example, a web page might show the user's name and the date she last logged on in the upper corner of every page.</span></span> <span data-ttu-id="5afa5-355">Bilet uwierzytelniania formularzy przechowuje nazwy użytkownika aktualnie zalogowanego użytkownika, ale w razie wszelkie inne informacje strony musi przejść w magazynie użytkownika — zwykle bazy danych — do wyszukiwania informacji nie są przechowywane w biletu uwierzytelniania.</span><span class="sxs-lookup"><span data-stu-id="5afa5-355">The forms authentication ticket stores the currently logged on user's username, but when any other information is needed, the page must go to the user store - typically a database - to lookup the information not stored in the authentication ticket.</span></span>

<span data-ttu-id="5afa5-356">Dodatkowe informacje dotyczące użytkownika z niewielkim fragmentem kodu można są przechowywane w biletu uwierzytelniania formularzy.</span><span class="sxs-lookup"><span data-stu-id="5afa5-356">With a little bit of code we can store additional user information in the forms authentication ticket.</span></span> <span data-ttu-id="5afa5-357">Takie dane mogą być wyrażone za pomocą [klasy FormsAuthenticationTicket](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.aspx)firmy [właściwość UserData](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.userdata.aspx).</span><span class="sxs-lookup"><span data-stu-id="5afa5-357">Such data can be expressed through the [FormsAuthenticationTicket class](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.aspx)'s [UserData property](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.userdata.aspx).</span></span> <span data-ttu-id="5afa5-358">To jest użytecznym miejscem do umieszczania małe ilości informacji o użytkowniku, które zazwyczaj są potrzebne.</span><span class="sxs-lookup"><span data-stu-id="5afa5-358">This is a useful place to put small amounts of information about the user that is commonly needed.</span></span> <span data-ttu-id="5afa5-359">Wartość określona w UserData właściwość wchodzi w skład bilecie pliku cookie uwierzytelniania i podobnie jak inne pola biletu, zostaje zaszyfrowany i zweryfikowane na podstawie konfiguracji systemu uwierzytelniania formularzy.</span><span class="sxs-lookup"><span data-stu-id="5afa5-359">The value specified in the UserData property is included as part of the authentication ticket cookie and, like the other ticket fields, is encrypted and validated based on the forms authentication system's configuration.</span></span> <span data-ttu-id="5afa5-360">Domyślnie UserData jest ciągiem pustym.</span><span class="sxs-lookup"><span data-stu-id="5afa5-360">By default, UserData is an empty string.</span></span>

<span data-ttu-id="5afa5-361">W celu przechowywania danych użytkownika w biletu uwierzytelniania, należy napisać fragmentem kodu na stronie logowania, który bierze informacje specyficzne dla użytkownika i zapisuje go w bilecie.</span><span class="sxs-lookup"><span data-stu-id="5afa5-361">In order to store user data in the authentication ticket, we need to write a bit of code in the login page that grabs the user-specific information and stores it in the ticket.</span></span> <span data-ttu-id="5afa5-362">Ponieważ UserData właściwość typu String, dane znajdujące się w niej muszą być prawidłowo serializowane jako ciąg.</span><span class="sxs-lookup"><span data-stu-id="5afa5-362">Since UserData is a property of type string, the data stored in it must be properly serialized as a string.</span></span> <span data-ttu-id="5afa5-363">Na przykład Wyobraź sobie, że nasz magazyn użytkownika zawarta każdy użytkownik daty urodzenia i nazwę pracodawcy, a Chcieliśmy, aby przechowywać wartości tych dwóch właściwości w biletu uwierzytelniania.</span><span class="sxs-lookup"><span data-stu-id="5afa5-363">For example, imagine that our user store included each user's date of birth and the name of their employer, and we wanted to store these two property values in the authentication ticket.</span></span> <span data-ttu-id="5afa5-364">Firma Microsoft można serializować te wartości na ciąg przez złączenie użytkownika daty urodzenia na ciąg przy użyciu potoku (|), a po niej nazwę pracodawcy.</span><span class="sxs-lookup"><span data-stu-id="5afa5-364">We could serialize these values into a string by concatenating the user's date of birth's string with a pipe ( | ), followed by the employer name.</span></span> <span data-ttu-id="5afa5-365">Dla wybranego użytkownika urodzonych 15 sierpnia 1974 r. działa dla Northwind Traders firma Microsoft przypisywanej właściwość UserData ciąg: 1974-08-15|Northwind Traders .</span><span class="sxs-lookup"><span data-stu-id="5afa5-365">For a user born on August 15, 1974 that works for Northwind Traders, we would assign the UserData property the string: 1974-08-15|Northwind Traders .</span></span>

<span data-ttu-id="5afa5-366">Zawsze, gdy będziemy musieli uzyskiwać dostęp do danych przechowywanych w--ticket, możemy to zrobić przez Przechwytywanie FormsAuthenticationTicket bieżącego żądania i deserializacja właściwości danych użytkownika.</span><span class="sxs-lookup"><span data-stu-id="5afa5-366">Whenever we need to access the data stored in the ticket, we can do so by grabbing the current request's FormsAuthenticationTicket and deserializing the UserData property.</span></span> <span data-ttu-id="5afa5-367">W przypadku daty urodzenia i pracodawca przykładowe nazwy firma Microsoft będzie podzielić ciąg UserData dwóch podciągów w oparciu o ogranicznika (|).</span><span class="sxs-lookup"><span data-stu-id="5afa5-367">In the case of the date of birth and employer name example, we would split the UserData string into two substrings based on the delimiter ( | ).</span></span>


<span data-ttu-id="5afa5-368">[![Dodatkowe informacje dotyczące użytkownika mogą być przechowywane w biletu uwierzytelniania](forms-authentication-configuration-and-advanced-topics-cs/_static/image11.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="5afa5-368">[![Additional User Information Can Be Stored in the Authentication Ticket](forms-authentication-configuration-and-advanced-topics-cs/_static/image11.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image10.png)</span></span>

<span data-ttu-id="5afa5-369">**Rysunek 04**: Dodatkowe użytkownika informacje mogą być przechowywane w biletu uwierzytelniania ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](forms-authentication-configuration-and-advanced-topics-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="5afa5-369">**Figure 04**: Additional User Information Can Be Stored in the Authentication Ticket ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image12.png))</span></span>


### <a name="writing-information-to-userdata"></a><span data-ttu-id="5afa5-370">Wpisywania informacji do danych użytkownika</span><span class="sxs-lookup"><span data-stu-id="5afa5-370">Writing Information to UserData</span></span>

<span data-ttu-id="5afa5-371">Niestety Dodawanie informacji o użytkowniku do biletu uwierzytelniania formularzy nie jest tak proste, jak można oczekiwać, że.</span><span class="sxs-lookup"><span data-stu-id="5afa5-371">Unfortunately, adding user-specific information to a forms authentication ticket is not as straightforward as one might expect.</span></span> <span data-ttu-id="5afa5-372">Właściwość UserData klasy FormsAuthenticationTicket jest tylko do odczytu i może zostać określony tylko za pośrednictwem FormsAuthenticationTicket konstruktora klasy.</span><span class="sxs-lookup"><span data-stu-id="5afa5-372">The UserData property of the FormsAuthenticationTicket class is read-only and can only be specified through the FormsAuthenticationTicket class constructor.</span></span> <span data-ttu-id="5afa5-373">Podczas określania właściwości UserData w konstruktorze, należy również podać--ticket przez inne wartości: nazwa, Data wystawienia, wygaśnięcia i tak dalej.</span><span class="sxs-lookup"><span data-stu-id="5afa5-373">When specifying the UserData property in the constructor, we also need to provide the ticket's other values: the username, the issue date, the expiration, and so on.</span></span> <span data-ttu-id="5afa5-374">Wtedy stworzyliśmy strony logowania w poprzednim samouczku to wszystkie obsłużono nam klasa uwierzytelniania formularzy.</span><span class="sxs-lookup"><span data-stu-id="5afa5-374">When we created the login page in the preceding tutorial, this was all handled for us by the FormsAuthentication class.</span></span> <span data-ttu-id="5afa5-375">Podczas dodawania danych użytkownika do FormsAuthenticationTicket, konieczne będzie napisać kod, aby replikować większość funkcjonalności już dostarczony przez klasę uwierzytelniania formularzy.</span><span class="sxs-lookup"><span data-stu-id="5afa5-375">When adding UserData to the FormsAuthenticationTicket, we will need to write code to replicate much of the functionality already provided by the FormsAuthentication class.</span></span>

<span data-ttu-id="5afa5-376">Przyjrzyjmy się niezbędny kod do pracy z danych użytkownika, aktualizując strony Login.aspx, aby rejestrować dodatkowe informacje na temat użytkownikowi biletu uwierzytelniania.</span><span class="sxs-lookup"><span data-stu-id="5afa5-376">Let's explore the necessary code for working with UserData by updating the Login.aspx page to record additional information about the user to the authentication ticket.</span></span> <span data-ttu-id="5afa5-377">Poudawać się, że nasz magazyn użytkownika zawiera informacje dotyczące firmy użytkownika działa w przypadku i stanowiska i chcemy przechwytywać te informacje w biletu uwierzytelniania.</span><span class="sxs-lookup"><span data-stu-id="5afa5-377">Pretend that our user store contains information about the company the user works for and their title, and that we want to capture this information in the authentication ticket.</span></span> <span data-ttu-id="5afa5-378">Program obsługi zdarzeń kliknięcie LoginButton strony Login.aspx należy zaktualizować tak, aby kod wyglądał następująco:</span><span class="sxs-lookup"><span data-stu-id="5afa5-378">Update the Login.aspx page's LoginButton Click event handler so that the code looks like the following:</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample6.cs)]

<span data-ttu-id="5afa5-379">Rozważmy kroki tego jednego wiersza kodu naraz.</span><span class="sxs-lookup"><span data-stu-id="5afa5-379">Let's step through this code one line at a time.</span></span> <span data-ttu-id="5afa5-380">Metoda rozpoczyna się przez definiowanie czterech tablic ciągów: Użytkownicy "," hasła "," NazwaFirmy "i" titleAtCompany.</span><span class="sxs-lookup"><span data-stu-id="5afa5-380">The method starts by defining four string arrays: users, passwords, companyName, and titleAtCompany.</span></span> <span data-ttu-id="5afa5-381">Te macierze zawierać nazwy użytkownika, hasła, nazwy firmy i tytuły dla kont użytkowników w systemie, dla których dostępne są trzy: Scott Jisun i Sam.</span><span class="sxs-lookup"><span data-stu-id="5afa5-381">These arrays hold the usernames, passwords, company names, and titles for the user accounts in the system, of which there are three: Scott, Jisun, and Sam.</span></span> <span data-ttu-id="5afa5-382">W rzeczywistej aplikacji te wartości będą badane w magazynie użytkownika, a nie zakodowane w kodzie źródłowym strony.</span><span class="sxs-lookup"><span data-stu-id="5afa5-382">In a real application, these values would be queried from the user store, not hard-coded in the page's source code.</span></span>

<span data-ttu-id="5afa5-383">W poprzednim samouczku Jeśli podane poświadczenia są prawidłowe po prostu dzwoniliśmy FormsAuthentication.RedirectFromLoginPage (UserName.Text, RememberMe.Checked), które wykonano następujące procedury:</span><span class="sxs-lookup"><span data-stu-id="5afa5-383">In the previous tutorial, if the supplied credentials were valid we simply called FormsAuthentication.RedirectFromLoginPage(UserName.Text, RememberMe.Checked), which performed the following steps:</span></span>

1. <span data-ttu-id="5afa5-384">Utworzony bilet uwierzytelniania formularzy</span><span class="sxs-lookup"><span data-stu-id="5afa5-384">Created the forms authentication ticket</span></span>
2. <span data-ttu-id="5afa5-385">Zapisano--ticket do odpowiedniego magazynu.</span><span class="sxs-lookup"><span data-stu-id="5afa5-385">Wrote the ticket to the appropriate store.</span></span> <span data-ttu-id="5afa5-386">W przypadku biletów uwierzytelniania na podstawie plików cookie kolekcji plików cookie w przeglądarce jest używany; bilety uwierzytelniania cookieless dane biletu jest serializowany do adresu URL</span><span class="sxs-lookup"><span data-stu-id="5afa5-386">For cookies-based authentication tickets, the browser's cookies collection is used; for cookieless authentication tickets, the ticket data is serialized into the URL</span></span>
3. <span data-ttu-id="5afa5-387">Przekierowanie użytkownika do odpowiedniej strony</span><span class="sxs-lookup"><span data-stu-id="5afa5-387">Redirected the user to the appropriate page</span></span>

<span data-ttu-id="5afa5-388">Te kroki są replikowane w powyższym kodzie.</span><span class="sxs-lookup"><span data-stu-id="5afa5-388">These steps are replicated in the code above.</span></span> <span data-ttu-id="5afa5-389">Po pierwsze ciąg, który ostatecznie będą przechowywane we właściwości UserData został utworzony przez połączenie nazwy firmy i tytuł rozdzielający dwie wartości przy użyciu znaku kreski pionowej (|).</span><span class="sxs-lookup"><span data-stu-id="5afa5-389">First, the string we will eventually store in the UserData property is formed by combining the company name and the title, delimiting the two values with a pipe character ( | ).</span></span>

<span data-ttu-id="5afa5-390">ciąg userDataString = ciąg. Concat (companyName [i], "|", titleAtCompany[i]);</span><span class="sxs-lookup"><span data-stu-id="5afa5-390">string userDataString = string.Concat(companyName[i], "|", titleAtCompany[i]);</span></span>

<span data-ttu-id="5afa5-391">Następnie FormsAuthentication.GetAuthCookie metoda jest wywoływana, co powoduje utworzenie biletu uwierzytelniania, są szyfrowane i zweryfikuje go zgodnie z ustawieniami konfiguracji i umieszcza je w obiekcie HttpCookie.</span><span class="sxs-lookup"><span data-stu-id="5afa5-391">Next, the FormsAuthentication.GetAuthCookie method is invoked, which creates the authentication ticket, encrypts and validates it according to the configuration settings, and places it in an HttpCookie object.</span></span>

<span data-ttu-id="5afa5-392">HttpCookie authCookie = FormsAuthentication.GetAuthCookie(UserName.Text, RememberMe.Checked);</span><span class="sxs-lookup"><span data-stu-id="5afa5-392">HttpCookie authCookie = FormsAuthentication.GetAuthCookie(UserName.Text, RememberMe.Checked);</span></span>

<span data-ttu-id="5afa5-393">Aby pracować z FormAuthenticationTicket osadzone w pliku cookie, należy wywołać klasy FormAuthentication [odszyfrować metoda](https://msdn.microsoft.com/library/system.web.security.formsauthentication.decrypt.aspx), przekazując wartość pliku cookie.</span><span class="sxs-lookup"><span data-stu-id="5afa5-393">In order to work with the FormAuthenticationTicket embedded within the cookie, we need to call the FormAuthentication class's [Decrypt method](https://msdn.microsoft.com/library/system.web.security.formsauthentication.decrypt.aspx), passing in the cookie value.</span></span>

<span data-ttu-id="5afa5-394">FormsAuthenticationTicket ticket = FormsAuthentication.Decrypt(authCookie.Value);</span><span class="sxs-lookup"><span data-stu-id="5afa5-394">FormsAuthenticationTicket ticket = FormsAuthentication.Decrypt(authCookie.Value);</span></span>

<span data-ttu-id="5afa5-395">Następnie tworzymy *nowe* FormsAuthenticationTicket wystąpienia na podstawie istniejących FormsAuthenticationTicket wartości.</span><span class="sxs-lookup"><span data-stu-id="5afa5-395">We then create a *new* FormsAuthenticationTicket instance based on the existing FormsAuthenticationTicket's values.</span></span> <span data-ttu-id="5afa5-396">Jednak ten nowy bilet zawiera informacje specyficzne dla użytkownika (userDataString).</span><span class="sxs-lookup"><span data-stu-id="5afa5-396">However, this new ticket includes the user-specific information (userDataString).</span></span>

<span data-ttu-id="5afa5-397">FormsAuthenticationTicket newTicket = nowe FormsAuthenticationTicket (biletu. Wersja, biletu. Nazwa, biletu. IssueDate, biletu. Wygaśnięcie, biletu. IsPersistent, userDataString);</span><span class="sxs-lookup"><span data-stu-id="5afa5-397">FormsAuthenticationTicket newTicket = new FormsAuthenticationTicket(ticket.Version, ticket.Name, ticket.IssueDate, ticket.Expiration, ticket.IsPersistent, userDataString);</span></span>

<span data-ttu-id="5afa5-398">Firma Microsoft następnie szyfrowania (i zweryfikować) nowe wystąpienie FormsAuthenticationTicket przez wywołanie metody [szyfrowania metoda](https://msdn.microsoft.com/library/system.web.security.formsauthentication.encrypt.aspx)i ponownie umieścić te dane zaszyfrowane (i zweryfikowane), w authCookie.</span><span class="sxs-lookup"><span data-stu-id="5afa5-398">We then encrypt (and validate) the new FormsAuthenticationTicket instance by calling the [Encrypt method](https://msdn.microsoft.com/library/system.web.security.formsauthentication.encrypt.aspx), and put this encrypted (and validated) data back into authCookie.</span></span>

<span data-ttu-id="5afa5-399">authCookie.Value = FormsAuthentication.Encrypt(newTicket);</span><span class="sxs-lookup"><span data-stu-id="5afa5-399">authCookie.Value = FormsAuthentication.Encrypt(newTicket);</span></span>

<span data-ttu-id="5afa5-400">Na koniec authCookie zostanie dodany do kolekcji Response.Cookies i GetRedirectUrl metoda jest wywoływana w celu określenia odpowiedniej strony, aby wysłać użytkownika.</span><span class="sxs-lookup"><span data-stu-id="5afa5-400">Finally, authCookie is added to the Response.Cookies collection and the GetRedirectUrl method is called to determine the appropriate page to send the user.</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample7.cs)]

<span data-ttu-id="5afa5-401">Wszystkie tego kodu jest potrzebna, ponieważ właściwość UserData jest tylko do odczytu, a klasa uwierzytelniania formularzy nie zapewnia żadnych metod do określania informacji danych użytkownika za pomocą jej metod GetAuthCookie, SetAuthCookie lub RedirectFromLoginPage.</span><span class="sxs-lookup"><span data-stu-id="5afa5-401">All of this code is needed because the UserData property is read-only and the FormsAuthentication class does not provide any methods for specifying UserData information in its GetAuthCookie, SetAuthCookie, or RedirectFromLoginPage methods.</span></span>

> [!NOTE]
> <span data-ttu-id="5afa5-402">Kod, który właśnie sprawdzane są przechowywane informacje specyficzne dla użytkownika w biletu uwierzytelniania na podstawie plików cookie.</span><span class="sxs-lookup"><span data-stu-id="5afa5-402">The code we just examined stores user-specific information in a cookies-based authentication ticket.</span></span> <span data-ttu-id="5afa5-403">Klasy odpowiedzialny za serializacji biletu uwierzytelniania formularzy do adresu URL są wewnętrzne programu .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="5afa5-403">The classes responsible for serializing the forms authentication ticket to the URL are internal to the .NET Framework.</span></span> <span data-ttu-id="5afa5-404">Długi tekst krótki, nie można zapisać danych użytkownika w biletu uwierzytelniania formularzy cookieless.</span><span class="sxs-lookup"><span data-stu-id="5afa5-404">Long story short, you cannot store user data in a cookieless forms authentication ticket.</span></span>


### <a name="accessing-the-userdata-information"></a><span data-ttu-id="5afa5-405">Uzyskiwanie informacji o danych użytkownika</span><span class="sxs-lookup"><span data-stu-id="5afa5-405">Accessing the UserData Information</span></span>

<span data-ttu-id="5afa5-406">W tym momencie nazwy firmy i tytuł każdego użytkownika są przechowywane w biletu uwierzytelniania formularzy UserData właściwości podczas logowania.</span><span class="sxs-lookup"><span data-stu-id="5afa5-406">At this point each user's company name and title is stored in the forms authentication ticket's UserData property when they log in.</span></span> <span data-ttu-id="5afa5-407">Te informacje są dostępne z biletu uwierzytelniania, na dowolnej stronie usługi bez konieczności podróży w magazynie użytkownika.</span><span class="sxs-lookup"><span data-stu-id="5afa5-407">This information can be accessed from the authentication ticket on any page without requiring a trip to the user store.</span></span> <span data-ttu-id="5afa5-408">Aby zilustrować, jak te informacje można pobrać z właściwości UserData, zaktualizujmy Default.aspx, dzięki czemu jego komunikat powitalny obejmuje nie tylko nazwę użytkownika, ale również firmy, które pracują w i stanowiska.</span><span class="sxs-lookup"><span data-stu-id="5afa5-408">To illustrate how this information can be retrieved from the UserData property, let's update Default.aspx so that its welcome message includes not only the user's name, but also the company they work for and their title.</span></span>

<span data-ttu-id="5afa5-409">Obecnie Default.aspx zawiera kontrolkę typu etykieta o nazwie WelcomeBackMessage AuthenticatedMessagePanel panelu.</span><span class="sxs-lookup"><span data-stu-id="5afa5-409">Currently, Default.aspx contains an AuthenticatedMessagePanel Panel with a Label control named WelcomeBackMessage.</span></span> <span data-ttu-id="5afa5-410">Ten Panel jest wyświetlana tylko do uwierzytelnionych użytkowników.</span><span class="sxs-lookup"><span data-stu-id="5afa5-410">This Panel is only displayed to authenticated users.</span></span> <span data-ttu-id="5afa5-411">Aktualizowanie kodu na stronie firmy Default.aspx\_obciążenia programu obsługi zdarzeń, tak że wygląda podobnie do poniższego:</span><span class="sxs-lookup"><span data-stu-id="5afa5-411">Update the code in Default.aspx's Page\_Load event handler so that it looks like the following:</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample8.cs)]

<span data-ttu-id="5afa5-412">Jeśli Request.IsAuthenticated ma wartość true, a następnie WelcomeBackMessage tekstu jest najpierw właściwością Witamy z powrotem *username*.</span><span class="sxs-lookup"><span data-stu-id="5afa5-412">If Request.IsAuthenticated is true, then the WelcomeBackMessage's Text property is first set to Welcome back, *username*.</span></span> <span data-ttu-id="5afa5-413">Następnie właściwość User.Identity jest rzutowany na obiekt FormsIdentity tak, aby firma Microsoft mogą uzyskiwać dostęp do podstawowych FormsAuthenticationTicket.</span><span class="sxs-lookup"><span data-stu-id="5afa5-413">Then, the User.Identity property is cast to a FormsIdentity object so that we can access the underlying FormsAuthenticationTicket.</span></span> <span data-ttu-id="5afa5-414">Gdy będziemy już mieć FormsAuthenticationTicket, firma Microsoft deserializuje właściwość UserData na nazwy firmy i tytuł.</span><span class="sxs-lookup"><span data-stu-id="5afa5-414">Once we have the FormsAuthenticationTicket, we deserialize the UserData property into the company name and title.</span></span> <span data-ttu-id="5afa5-415">Jest to realizowane przy dzieleniu ciągu na znaku kreski pionowej.</span><span class="sxs-lookup"><span data-stu-id="5afa5-415">This is accomplished by splitting the string on the pipe character.</span></span> <span data-ttu-id="5afa5-416">Nazwa firmy i tytuł są następnie wyświetlane w etykiecie WelcomeBackMessage.</span><span class="sxs-lookup"><span data-stu-id="5afa5-416">The company name and title are then displayed in the WelcomeBackMessage Label.</span></span>

<span data-ttu-id="5afa5-417">Rysunek 5. pokazuje zrzut ekranu przedstawiający tego ekranu w działaniu.</span><span class="sxs-lookup"><span data-stu-id="5afa5-417">Figure 5 shows a screenshot of this display in action.</span></span> <span data-ttu-id="5afa5-418">Logowanie trybie Scott wyświetla komunikat powitalny Wstecz, obejmującą Scotta firmy i tytuł.</span><span class="sxs-lookup"><span data-stu-id="5afa5-418">Logging in as Scott displays a welcome back message that includes Scott's company and title.</span></span>


<span data-ttu-id="5afa5-419">[![Firmy i tytuł aktualnie zalogowany na użytkownika są wyświetlane](forms-authentication-configuration-and-advanced-topics-cs/_static/image14.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="5afa5-419">[![The Currently Logged On User's Company and Title are Displayed](forms-authentication-configuration-and-advanced-topics-cs/_static/image14.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image13.png)</span></span>

<span data-ttu-id="5afa5-420">**Rysunek 05**: Firmy i tytuł aktualnie zalogowany na użytkownika są wyświetlane ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](forms-authentication-configuration-and-advanced-topics-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="5afa5-420">**Figure 05**: The Currently Logged On User's Company and Title are Displayed ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image15.png))</span></span>


> [!NOTE]
> <span data-ttu-id="5afa5-421">Właściwość UserData biletu uwierzytelniania służy jako pamięci podręcznej dla użytkownika.</span><span class="sxs-lookup"><span data-stu-id="5afa5-421">The authentication ticket's UserData property serves as a cache for the user store.</span></span> <span data-ttu-id="5afa5-422">Podobnie jak wszelkie pamięci podręcznej musi ona być aktualizowane po zmodyfikowaniu danych bazowych.</span><span class="sxs-lookup"><span data-stu-id="5afa5-422">Like any cache, it needs to be updated when the underlying data is modified.</span></span> <span data-ttu-id="5afa5-423">Na przykład jeśli strony sieci web, z którego użytkownicy mogą zaktualizować swój profil, pola pamięci podręcznej we właściwości danych użytkownika musi zostać odświeżona w celu odzwierciedlenia zmian wprowadzonych przez użytkownika.</span><span class="sxs-lookup"><span data-stu-id="5afa5-423">For example, if there is a web page from which users can update their profile, the fields cached in the UserData property must be refreshed to reflect the changes made by the user.</span></span>


## <a name="step-5-using-a-custom-principal"></a><span data-ttu-id="5afa5-424">Krok 5. Za pomocą jednostki niestandardowe</span><span class="sxs-lookup"><span data-stu-id="5afa5-424">Step 5: Using a Custom Principal</span></span>

<span data-ttu-id="5afa5-425">Na każde żądanie przychodzące FormsAuthenticationModule podejmuje próbę uwierzytelnienia użytkownika.</span><span class="sxs-lookup"><span data-stu-id="5afa5-425">On each incoming request the FormsAuthenticationModule attempts to authenticate the user.</span></span> <span data-ttu-id="5afa5-426">Jeśli bilet uwierzytelniania nie wygasł jest obecny, FormsAuthenticationModule przypisuje właściwość HttpContext.User nowy obiekt obiektów GenericPrincipal.</span><span class="sxs-lookup"><span data-stu-id="5afa5-426">If a non-expired authentication ticket is present, the FormsAuthenticationModule assigns the HttpContext.User property to a new GenericPrincipal object.</span></span> <span data-ttu-id="5afa5-427">Ten obiekt obiektów GenericPrincipal ma tożsamość typu FormsIdentity, który zawiera odwołanie do biletu uwierzytelniania formularzy.</span><span class="sxs-lookup"><span data-stu-id="5afa5-427">This GenericPrincipal object has an Identity of type FormsIdentity, which includes a reference to the forms authentication ticket.</span></span> <span data-ttu-id="5afa5-428">Klasa obiektów GenericPrincipal zawiera bez minimalne funkcje wymagane przez klasę, która implementuje IPrincipal — po prostu ma właściwość tożsamości i metodę IsInRole.</span><span class="sxs-lookup"><span data-stu-id="5afa5-428">The GenericPrincipal class contains the bare minimum functionality needed by a class that implements IPrincipal - it just has an Identity property and an IsInRole method.</span></span>

<span data-ttu-id="5afa5-429">Obiekt podmiotu zabezpieczeń ma dwa obowiązki: role, jakie użytkownik należy do wskazania i udostępniają informacje o tożsamości.</span><span class="sxs-lookup"><span data-stu-id="5afa5-429">The principal object has two responsibilities: to indicate what roles the user belongs to and to provide identity information.</span></span> <span data-ttu-id="5afa5-430">Jest to realizowane za pośrednictwem interfejsu IPrincipal IsInRole (*roleName*) metod i właściwości tożsamości, odpowiednio.</span><span class="sxs-lookup"><span data-stu-id="5afa5-430">This is accomplished through the IPrincipal interface's IsInRole(*roleName*) method and Identity property, respectively.</span></span> <span data-ttu-id="5afa5-431">Klasy obiektów GenericPrincipal umożliwia tablica ciągów nazw ról można określić za pośrednictwem jej konstruktora; jego IsInRole (*roleName*) metoda sprawdza tylko, czy aby sprawdzić, czy przekazany w *roleName* istnieje w tablicy ciągów.</span><span class="sxs-lookup"><span data-stu-id="5afa5-431">The GenericPrincipal class allows for a string array of role names to be specified via its constructor; its IsInRole(*roleName*) method merely checks to see if the passed in *roleName* exists within the string array.</span></span> <span data-ttu-id="5afa5-432">Gdy FormsAuthenticationModule tworzy obiektów GenericPrincipal, przekazuje on w pustą tablicę ciągów do obiektów GenericPrincipal konstruktora.</span><span class="sxs-lookup"><span data-stu-id="5afa5-432">When the FormsAuthenticationModule creates the GenericPrincipal, it passes in an empty string array to the GenericPrincipal's constructor.</span></span> <span data-ttu-id="5afa5-433">W związku z tym każde wywołanie IsInRole zawsze zwraca wartość false.</span><span class="sxs-lookup"><span data-stu-id="5afa5-433">Consequently, any call to IsInRole will always return false.</span></span>

<span data-ttu-id="5afa5-434">Klasy obiektów GenericPrincipal spełnia potrzeby w przypadku większości scenariuszy uwierzytelniania na podstawie formularzy, gdzie role nie są używane.</span><span class="sxs-lookup"><span data-stu-id="5afa5-434">The GenericPrincipal class meets the needs for most forms based authentication scenarios where roles are not used.</span></span> <span data-ttu-id="5afa5-435">W tych sytuacjach, gdy domyślna obsługa roli są niewystarczające lub gdy trzeba skojarzyć niestandardowy obiekt IIdentity z użytkownikiem, można utworzyć niestandardowy obiekt IPrincipal podczas przepływu pracy uwierzytelniania i przypisać ją do właściwości HttpContext.User.</span><span class="sxs-lookup"><span data-stu-id="5afa5-435">For those situations where the default role handling is insufficient or when you need to associate a custom IIdentity object with the user, you can create a custom IPrincipal object during the authentication workflow and assign it to the HttpContext.User property.</span></span>

> [!NOTE]
> <span data-ttu-id="5afa5-436">Jak widać w przyszłości samouczki, gdy ASP. Framework ról w sieci jest włączone tworzy niestandardowy obiekt jednostki typu [RolePrincipal](https://msdn.microsoft.com/library/system.web.security.roleprincipal.aspx) i zastępuje obiekt obiektów GenericPrincipal utworzone uwierzytelniania formularzy.</span><span class="sxs-lookup"><span data-stu-id="5afa5-436">As we will see in future tutorials, when ASP.NET's Roles framework is enabled it creates a custom principal object of type [RolePrincipal](https://msdn.microsoft.com/library/system.web.security.roleprincipal.aspx) and overwrites the forms authentication-created GenericPrincipal object.</span></span> <span data-ttu-id="5afa5-437">Dzieje się tak, aby dostosować metody IsInRole podmiotu zabezpieczeń do interfejsu z interfejsem API w ramach ról.</span><span class="sxs-lookup"><span data-stu-id="5afa5-437">It does this in order to customize the principal's IsInRole method to interface with the Roles framework's API.</span></span>


<span data-ttu-id="5afa5-438">Ponieważ firma Microsoft ma nie dotyczy osoby z rolami jeszcze, jedyny przypadek, które mamy do tworzenia jednostki niestandardowej w tym momencie mogłoby być skojarzyć niestandardowy obiekt IIdentity do jednostki.</span><span class="sxs-lookup"><span data-stu-id="5afa5-438">Since we have not concerned ourselves with roles yet, the only reason we would have for creating a custom principal at this juncture would be to associate a custom IIdentity object to the principal.</span></span> <span data-ttu-id="5afa5-439">W kroku 4 przyjrzeliśmy się przechowywanie dodatkowych informacji dotyczących użytkowników we właściwości UserData biletu uwierzytelniania, w szczególności, nazwy firmy użytkownika i stanowiska.</span><span class="sxs-lookup"><span data-stu-id="5afa5-439">In Step 4 we looked at storing additional user information in the authentication ticket's UserData property, in particular the user's company name and their title.</span></span> <span data-ttu-id="5afa5-440">Informacje UserData jest jednak tylko za pośrednictwem biletu uwierzytelniania i następnie tylko jako ciąg serializacji, co oznacza, że w dowolnym czasie chcemy, aby wyświetlić informacje o użytkownikach, przechowywane w bilecie należy przeanalizować właściwości UserData.</span><span class="sxs-lookup"><span data-stu-id="5afa5-440">However, the UserData information is only accessible through the authentication ticket and only then as a serialized string, meaning that anytime we want to view the user information stored in the ticket we need to parse the UserData property.</span></span>

<span data-ttu-id="5afa5-441">Firma Microsoft może poprawić środowisko programistyczne, tworząc klasę, która implementuje IIdentity i zawiera właściwości CompanyName i tytuł.</span><span class="sxs-lookup"><span data-stu-id="5afa5-441">We can improve the developer experience by creating a class that implements IIdentity and includes CompanyName and Title properties.</span></span> <span data-ttu-id="5afa5-442">Dzięki temu deweloper mają dostęp do aktualnie zalogowanego użytkownika, nazwę firmy i tytuł bezpośrednio za pomocą właściwości CompanyName i tytuł bez potrzebne wiedzieć, jak można przeanalizować właściwości UserData.</span><span class="sxs-lookup"><span data-stu-id="5afa5-442">That way, a developer can access the currently logged on user's company name and title directly through the CompanyName and Title properties without needed to know how to parse the UserData property.</span></span>

### <a name="creating-the-custom-identity-and-principal-classes"></a><span data-ttu-id="5afa5-443">Tworzenie niestandardowej tożsamości i główne klasy</span><span class="sxs-lookup"><span data-stu-id="5afa5-443">Creating the Custom Identity and Principal Classes</span></span>

<span data-ttu-id="5afa5-444">W tym samouczku utworzymy niestandardowe obiekty jednostki i tożsamości w aplikacji\_katalogu z kodem.</span><span class="sxs-lookup"><span data-stu-id="5afa5-444">For this tutorial, let's create the custom principal and identity objects in the App\_Code folder.</span></span> <span data-ttu-id="5afa5-445">Rozpocznij od dodania aplikacji\_folderu do projektu kodu — kliknij prawym przyciskiem myszy nazwę projektu w Eksploratorze rozwiązań, wybierz opcję Dodaj Folder programu ASP.NET i wybierz aplikację\_kodu.</span><span class="sxs-lookup"><span data-stu-id="5afa5-445">Start by adding an App\_Code folder to your project - right-click on the project name in Solution Explorer, select the Add ASP.NET Folder option, and choose App\_Code.</span></span> <span data-ttu-id="5afa5-446">Aplikacja\_kodu jest folderem specjalne platformy ASP.NET, zawierający klasy pliki specyficzne dla witryny sieci Web.</span><span class="sxs-lookup"><span data-stu-id="5afa5-446">The App\_Code folder is a special ASP.NET folder that holds class files specific to the website.</span></span>

> [!NOTE]
> <span data-ttu-id="5afa5-447">Aplikacja\_katalogu z kodem należy używać tylko, gdy zarządzania projektem za pomocą modelu projektu witryny sieci Web.</span><span class="sxs-lookup"><span data-stu-id="5afa5-447">The App\_Code folder should only be used when managing your project through the Website Project Model.</span></span> <span data-ttu-id="5afa5-448">Jeśli używasz [modelu projektu aplikacji sieci Web](https://msdn.microsoft.com/asp.net/Aa336618.aspx), tworzenie folderu standardowego i Dodaj klasy do tego.</span><span class="sxs-lookup"><span data-stu-id="5afa5-448">If you are using the [Web Application Project Model](https://msdn.microsoft.com/asp.net/Aa336618.aspx), create a standard folder and add the classes to that.</span></span> <span data-ttu-id="5afa5-449">Na przykład można dodać nowy folder o nazwie klasy, a istnieje umieść swój kod.</span><span class="sxs-lookup"><span data-stu-id="5afa5-449">For example, you could add a new folder named Classes, and place your code there.</span></span>


<span data-ttu-id="5afa5-450">Następnie dodaj dwa nowe pliki klasy aplikacji\_katalogu z kodem, jeden o nazwie CustomIdentity.cs i jedną o nazwie CustomPrincipal.cs.</span><span class="sxs-lookup"><span data-stu-id="5afa5-450">Next, add two new class files to the App\_Code folder, one named CustomIdentity.cs and one named CustomPrincipal.cs.</span></span>


<span data-ttu-id="5afa5-451">[![Dodawanie klasy CustomPrincipal i CustomIdentity do projektu](forms-authentication-configuration-and-advanced-topics-cs/_static/image17.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="5afa5-451">[![Add the CustomIdentity and CustomPrincipal Classes to Your Project](forms-authentication-configuration-and-advanced-topics-cs/_static/image17.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image16.png)</span></span>

<span data-ttu-id="5afa5-452">**Rysunek 06**: Dodawanie CustomIdentity i CustomPrincipal klas do projektu ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](forms-authentication-configuration-and-advanced-topics-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="5afa5-452">**Figure 06**: Add the CustomIdentity and CustomPrincipal Classes to Your Project ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image18.png))</span></span>


<span data-ttu-id="5afa5-453">Klasa CustomIdentity jest odpowiedzialny za implementującej interfejs IIdentity, który definiuje typ AuthenticationType, właściwości i nazwę właściwości.</span><span class="sxs-lookup"><span data-stu-id="5afa5-453">The CustomIdentity class is responsible for implementing the IIdentity interface, which defines the AuthenticationType, IsAuthenticated, and Name properties.</span></span> <span data-ttu-id="5afa5-454">Oprócz tych wymaganych właściwości przypadku interesuje NAS ujawnienia podstawowych biletu uwierzytelniania formularzy oraz właściwości dla użytkownika nazwa firmy i tytuł.</span><span class="sxs-lookup"><span data-stu-id="5afa5-454">In addition to those required properties, we are interested in exposing the underlying forms authentication ticket as well as properties for the user's company name and title.</span></span> <span data-ttu-id="5afa5-455">Wprowadź następujący kod do klasy CustomIdentity.</span><span class="sxs-lookup"><span data-stu-id="5afa5-455">Enter the following code into the CustomIdentity class.</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample9.cs)]

<span data-ttu-id="5afa5-456">Należy pamiętać, że klasa zawiera zmienną członkowską FormsAuthenticationTicket (\_ticket) i że należy podać te informacje z biletu za pośrednictwem konstruktora.</span><span class="sxs-lookup"><span data-stu-id="5afa5-456">Note that the class includes a FormsAuthenticationTicket member variable (\_ticket) and that this ticket information must be supplied through the constructor.</span></span> <span data-ttu-id="5afa5-457">Te dane biletu jest używany w zwracanie nazwy tożsamości; jego właściwość UserData jest analizowany do zwracania wartości dla właściwości Nazwa firmy i tytuł.</span><span class="sxs-lookup"><span data-stu-id="5afa5-457">This ticket data is used in returning the identity's Name; its UserData property is parsed to return the values for the CompanyName and Title properties.</span></span>

<span data-ttu-id="5afa5-458">Następnie należy utworzyć klasa CustomPrincipal.</span><span class="sxs-lookup"><span data-stu-id="5afa5-458">Next, create the CustomPrincipal class.</span></span> <span data-ttu-id="5afa5-459">Ponieważ firma Microsoft nie są związani z ról w tym momencie, klasa CustomPrincipal Konstruktor akceptuje tylko obiekt CustomIdentity; jego metoda IsInRole zawsze zwraca wartość false.</span><span class="sxs-lookup"><span data-stu-id="5afa5-459">Since we are not concerned with roles at this juncture, the CustomPrincipal class's constructor accepts only a CustomIdentity object; its IsInRole method always returns false.</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample10.cs)]

### <a name="assigning-a-customprincipal-object-to-the-incoming-requests-security-context"></a><span data-ttu-id="5afa5-460">Przypisywanie obiekcie CustomPrincipal kontekst zabezpieczeń żądania przychodzącego</span><span class="sxs-lookup"><span data-stu-id="5afa5-460">Assigning a CustomPrincipal Object to the Incoming Request's Security Context</span></span>

<span data-ttu-id="5afa5-461">W efekcie powstał klasę, która rozszerza domyślną specyfikację IIdentity właściwościami CompanyName i tytuł, a także klasę jednostki niestandardowej, która korzysta z tożsamości niestandardowej.</span><span class="sxs-lookup"><span data-stu-id="5afa5-461">We now have a class that extends the default IIdentity specification to include CompanyName and Title properties, as well as a custom principal class that uses the custom identity.</span></span> <span data-ttu-id="5afa5-462">Firma Microsoft jest gotowe, aby wejść do potoku platformy ASP.NET i przypisz naszych niestandardowy obiekt podmiotu zabezpieczeń kontekst zabezpieczeń żądania przychodzącego.</span><span class="sxs-lookup"><span data-stu-id="5afa5-462">We are ready to step into the ASP.NET pipeline and assign our custom principal object to the incoming request's security context.</span></span>

<span data-ttu-id="5afa5-463">Potoku platformy ASP.NET przyjmuje żądanie przychodzące i przetwarza je za pomocą kilku kroków.</span><span class="sxs-lookup"><span data-stu-id="5afa5-463">The ASP.NET pipeline takes an incoming request and processes it through a number of steps.</span></span> <span data-ttu-id="5afa5-464">W każdym kroku określonego zdarzenie jest zgłaszane, umożliwiając deweloperom akademickiej potoku platformy ASP.NET i zmodyfikować żądanie określonych momentach etapie jej cyklu życia.</span><span class="sxs-lookup"><span data-stu-id="5afa5-464">At each step, a particular event is raised, making it possible for developers to tap into the ASP.NET pipeline and modify the request at certain points in its lifecycle.</span></span> <span data-ttu-id="5afa5-465">FormsAuthenticationModule, na przykład czeka na platformę ASP.NET w celu podniesienia [zdarzeń AuthenticateRequest](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx), w tym momencie sprawdza ono przychodzące żądanie na bilet uwierzytelnienia.</span><span class="sxs-lookup"><span data-stu-id="5afa5-465">The FormsAuthenticationModule, for example, waits for ASP.NET to raise the [AuthenticateRequest event](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx), at which point it inspects the incoming request for an authentication ticket.</span></span> <span data-ttu-id="5afa5-466">Jeśli bilet uwierzytelnienia zostanie znaleziony, obiektów genericprincipal — jest tworzone i przypisywane do właściwości HttpContext.User.</span><span class="sxs-lookup"><span data-stu-id="5afa5-466">If an authentication ticket is found, a GenericPrincipal object is created and assigned to the HttpContext.User property.</span></span>

<span data-ttu-id="5afa5-467">Po wystąpieniu zdarzenia AuthenticateRequest potoku platformy ASP.NET zgłasza [zdarzeń PostAuthenticateRequest](https://msdn.microsoft.com/library/system.web.httpapplication.postauthenticaterequest.aspx), który jest, gdzie można zastąpić obiekt obiektów GenericPrincipal utworzony przez FormsAuthenticationModule z wystąpieniem klasy Nasze Obiekcie CustomPrincipal.</span><span class="sxs-lookup"><span data-stu-id="5afa5-467">After the AuthenticateRequest event, the ASP.NET pipeline raises the [PostAuthenticateRequest event](https://msdn.microsoft.com/library/system.web.httpapplication.postauthenticaterequest.aspx), which is where we can replace the GenericPrincipal object created by the FormsAuthenticationModule with an instance of our CustomPrincipal object.</span></span> <span data-ttu-id="5afa5-468">Rysunek 7 przedstawia ten przepływ pracy.</span><span class="sxs-lookup"><span data-stu-id="5afa5-468">Figure 7 depicts this workflow.</span></span>


<span data-ttu-id="5afa5-469">[![Genericprincipal — zastępuje CustomPrincipal w zdarzeniu PostAuthenticationRequest](forms-authentication-configuration-and-advanced-topics-cs/_static/image20.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="5afa5-469">[![The GenericPrincipal is Replaced by a CustomPrincipal in the PostAuthenticationRequest Event](forms-authentication-configuration-and-advanced-topics-cs/_static/image20.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image19.png)</span></span>

<span data-ttu-id="5afa5-470">**Rysunek 07**: Genericprincipal — zastępuje CustomPrincipal w zdarzeniu PostAuthenticationRequest ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](forms-authentication-configuration-and-advanced-topics-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="5afa5-470">**Figure 07**: The GenericPrincipal is Replaced by a CustomPrincipal in the PostAuthenticationRequest Event ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image21.png))</span></span>


<span data-ttu-id="5afa5-471">Aby można było wykonać kod w odpowiedzi na zdarzenie potoku platformy ASP.NET, możemy utworzyć programu obsługi zdarzeń odpowiednie w pliku Global.asax lub utworzyć własną moduł HTTP.</span><span class="sxs-lookup"><span data-stu-id="5afa5-471">In order to execute code in response to an ASP.NET pipeline event, we can either create the appropriate event handler in Global.asax or create our own HTTP Module.</span></span> <span data-ttu-id="5afa5-472">W tym samouczku utworzymy programu obsługi zdarzeń w pliku Global.asax.</span><span class="sxs-lookup"><span data-stu-id="5afa5-472">For this tutorial let's create the event handler in Global.asax.</span></span> <span data-ttu-id="5afa5-473">Rozpocznij, dodając Global.asax do swojej witryny sieci Web.</span><span class="sxs-lookup"><span data-stu-id="5afa5-473">Start by adding Global.asax to your website.</span></span> <span data-ttu-id="5afa5-474">Kliknij prawym przyciskiem myszy nazwę projektu w Eksploratorze rozwiązań i Dodaj element typu globalna klasa aplikacji o nazwie pliku Global.asax.</span><span class="sxs-lookup"><span data-stu-id="5afa5-474">Right-click on the project name in Solution Explorer and add an item of type Global Application Class named Global.asax.</span></span>


<span data-ttu-id="5afa5-475">[![Dodaj plik Global.asax do swojej witryny sieci Web](forms-authentication-configuration-and-advanced-topics-cs/_static/image23.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="5afa5-475">[![Add a Global.asax File to Your Website](forms-authentication-configuration-and-advanced-topics-cs/_static/image23.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image22.png)</span></span>

<span data-ttu-id="5afa5-476">**Rysunek 08**: Dodaj plik Global.asax do witryny sieci Web ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](forms-authentication-configuration-and-advanced-topics-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="5afa5-476">**Figure 08**: Add a Global.asax File to Your Website ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image24.png))</span></span>


<span data-ttu-id="5afa5-477">Domyślny szablon Global.asax zawiera procedury obsługi zdarzeń dla liczby zdarzenia potoku platformy ASP.NET, w tym rozpoczęcia, zakończenia i [zdarzenie błędu](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx), między innymi.</span><span class="sxs-lookup"><span data-stu-id="5afa5-477">The default Global.asax template includes event handlers for a number of the ASP.NET pipeline events, including the Start, End and [Error event](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx), among others.</span></span> <span data-ttu-id="5afa5-478">Możesz usunąć te procedury obsługi zdarzeń, jak firma Microsoft nie są potrzebne dla tej aplikacji.</span><span class="sxs-lookup"><span data-stu-id="5afa5-478">Feel free to remove these event handlers, as we do not need them for this application.</span></span> <span data-ttu-id="5afa5-479">Zdarzenie, które jesteśmy zainteresowani jest PostAuthenticateRequest.</span><span class="sxs-lookup"><span data-stu-id="5afa5-479">The event we are interested in is PostAuthenticateRequest.</span></span> <span data-ttu-id="5afa5-480">Zaktualizuj plik Global.asax, dzięki czemu jego znaczników wygląda podobnie do następującego:</span><span class="sxs-lookup"><span data-stu-id="5afa5-480">Update your Global.asax file so its markup looks similar to the following:</span></span>

[!code-aspx[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample11.aspx)]

<span data-ttu-id="5afa5-481">Aplikacja\_OnPostAuthenticateRequest metoda jest wykonywana każdorazowo, środowisko uruchomieniowe ASP.NET zgłasza zdarzenie PostAuthenticateRequest, które odbywa się raz na każde żądanie przychodzące strony.</span><span class="sxs-lookup"><span data-stu-id="5afa5-481">The Application\_OnPostAuthenticateRequest method executes each time the ASP.NET runtime raises the PostAuthenticateRequest event, which happens once on each incoming page request.</span></span> <span data-ttu-id="5afa5-482">Program obsługi zdarzeń uruchamia, sprawdzając, czy użytkownik jest uwierzytelniany i został uwierzytelniony przy użyciu uwierzytelniania formularzy.</span><span class="sxs-lookup"><span data-stu-id="5afa5-482">The event handler starts by checking to see if the user is authenticated and was authenticated via forms authentication.</span></span> <span data-ttu-id="5afa5-483">Jeśli tak, nowy obiekt CustomIdentity jest utworzony i przekazany bieżącego żądania biletu uwierzytelniania w jego konstruktorze.</span><span class="sxs-lookup"><span data-stu-id="5afa5-483">If so, a new CustomIdentity object is created and passed the current request's authentication ticket in its constructor.</span></span> <span data-ttu-id="5afa5-484">Poniżej obiekcie CustomPrincipal jest utworzony i przekazany obiekt CustomIdentity nowo utworzoną w jego konstruktorze.</span><span class="sxs-lookup"><span data-stu-id="5afa5-484">Following that, a CustomPrincipal object is created and passed the just-created CustomIdentity object in its constructor.</span></span> <span data-ttu-id="5afa5-485">Na koniec kontekstu zabezpieczeń bieżącego żądania jest przypisany do nowo utworzonego obiektu CustomPrincipal.</span><span class="sxs-lookup"><span data-stu-id="5afa5-485">Finally, the current request's security context is assigned to the newly created CustomPrincipal object.</span></span>

<span data-ttu-id="5afa5-486">Należy zwrócić uwagę na to, że ostatni krok — kojarzenie obiekcie CustomPrincipal z kontekst zabezpieczeń żądania - przypisuje nazwę główną dwie właściwości: HttpContext.User i SE vlastnost Thread.CurrentPrincipal.</span><span class="sxs-lookup"><span data-stu-id="5afa5-486">Note that the last step - associating the CustomPrincipal object with the request's security context - assigns the principal to two properties: HttpContext.User and Thread.CurrentPrincipal.</span></span> <span data-ttu-id="5afa5-487">Te dwa przypisania są niezbędne, ze względu na sposób, w których konteksty zabezpieczeń są obsługiwane w programie ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="5afa5-487">These two assignments are necessary because of the way security contexts are handled in ASP.NET.</span></span> <span data-ttu-id="5afa5-488">.NET Framework kojarzy kontekstu zabezpieczeń z każdego uruchomionego wątku; Ta informacja jest dostępna jako obiekt IPrincipal za pośrednictwem [obiektu wątku](https://msdn.microsoft.com/library/system.threading.thread.aspx)firmy [właściwość CurrentPrincipal](https://msdn.microsoft.com/library/system.threading.thread.currentcontext.aspx).</span><span class="sxs-lookup"><span data-stu-id="5afa5-488">The .NET Framework associates a security context with each running thread; this information is available as an IPrincipal object through the [Thread object](https://msdn.microsoft.com/library/system.threading.thread.aspx)'s [CurrentPrincipal property](https://msdn.microsoft.com/library/system.threading.thread.currentcontext.aspx).</span></span> <span data-ttu-id="5afa5-489">Co to jest skomplikowana to, że program ASP.NET ma swoje własne informacje kontekstu zabezpieczeń (HttpContext.User).</span><span class="sxs-lookup"><span data-stu-id="5afa5-489">What is a confusing is that ASP.NET has its own security context information (HttpContext.User).</span></span>

<span data-ttu-id="5afa5-490">W niektórych scenariuszach właściwość SE vlastnost Thread.CurrentPrincipal jest badany, określając kontekst zabezpieczeń; w innych scenariuszach HttpContext.User jest używany.</span><span class="sxs-lookup"><span data-stu-id="5afa5-490">In certain scenarios, the Thread.CurrentPrincipal property is examined when determining the security context; in other scenarios, HttpContext.User is used.</span></span> <span data-ttu-id="5afa5-491">Na przykład funkcje zabezpieczeń na platformie .NET, które umożliwiają deweloperom deklaratywne stanu co użytkownicy lub role można utworzyć wystąpienia klasy lub wywoływania metod określone (zobacz [Dodawanie reguły autoryzacji w celu biznesowych i danych za pomocą warstwy PrincipalPermissionAttributes](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)).</span><span class="sxs-lookup"><span data-stu-id="5afa5-491">For example, there are security features in .NET that allow developers to declaratively state what users or roles can instantiate a class or invoke specific methods (see [Adding Authorization Rules to Business and Data Layers Using PrincipalPermissionAttributes](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)).</span></span> <span data-ttu-id="5afa5-492">Obiekcie nadrzędnym tych technik deklaratywne określenia kontekstu zabezpieczeń, za pomocą właściwości SE vlastnost Thread.CurrentPrincipal.</span><span class="sxs-lookup"><span data-stu-id="5afa5-492">Underneath the covers, these declarative techniques determine the security context via the Thread.CurrentPrincipal property.</span></span>

<span data-ttu-id="5afa5-493">W innych scenariuszach właściwość HttpContext.User jest używana.</span><span class="sxs-lookup"><span data-stu-id="5afa5-493">In other scenarios, the HttpContext.User property is used.</span></span> <span data-ttu-id="5afa5-494">Na przykład w poprzednim samouczku użyliśmy tej właściwości do wyświetlenia nazwy użytkownika aktualnie zalogowanego użytkownika.</span><span class="sxs-lookup"><span data-stu-id="5afa5-494">For example, in the previous tutorial we used this property to display the currently logged on user's username.</span></span> <span data-ttu-id="5afa5-495">Wyraźnie widać następnie należy bezwzględnie czy informacje kontekstu zabezpieczeń we właściwościach SE vlastnost Thread.CurrentPrincipal i HttpContext.User dopasować.</span><span class="sxs-lookup"><span data-stu-id="5afa5-495">Clearly, then, it is imperative that the security context information in the Thread.CurrentPrincipal and HttpContext.User properties match up.</span></span>

<span data-ttu-id="5afa5-496">Środowisko uruchomieniowe ASP.NET automatycznie synchronizuje te wartości właściwości dla nas.</span><span class="sxs-lookup"><span data-stu-id="5afa5-496">The ASP.NET runtime automatically syncs these property values for us.</span></span> <span data-ttu-id="5afa5-497">Jednak ta synchronizacja jest wykonywana po wystąpieniu zdarzenia AuthenticateRequest, ale *przed* PostAuthenticateRequest zdarzenia.</span><span class="sxs-lookup"><span data-stu-id="5afa5-497">However, this synchronization occurs after the AuthenticateRequest event, but *before* the PostAuthenticateRequest event.</span></span> <span data-ttu-id="5afa5-498">W związku z tym podczas dodawania niestandardowej jednostki w zdarzeniu PostAuthenticateRequest musimy mieć pewność ręcznie przypisać SE vlastnost Thread.CurrentPrincipal — w przeciwnym razie SE vlastnost Thread.CurrentPrincipal i HttpContext.User zostaną zsynchronizowane. Zobacz [Context.User programu vs. SE vlastnost Thread.CurrentPrincipal](http://leastprivilege.com/2005/11/23/context-user-vs-thread-currentprincipal/) bardziej szczegółowe omówienie dotyczące tego problemu.</span><span class="sxs-lookup"><span data-stu-id="5afa5-498">Consequently, when adding a custom principal in the PostAuthenticateRequest event we need to be certain to manually assign the Thread.CurrentPrincipal or else Thread.CurrentPrincipal and HttpContext.User will be out of sync. See [Context.User vs. Thread.CurrentPrincipal](http://leastprivilege.com/2005/11/23/context-user-vs-thread-currentprincipal/) for a more detailed discussion on this issue.</span></span>

### <a name="accessing-the-companyname-and-title-properties"></a><span data-ttu-id="5afa5-499">Uzyskiwanie dostępu do CompanyName i właściwości tytułu</span><span class="sxs-lookup"><span data-stu-id="5afa5-499">Accessing the CompanyName and Title Properties</span></span>

<span data-ttu-id="5afa5-500">Zawsze, gdy żądanie dociera i jest wysyłane do aparatu programu ASP.NET, aplikację\_nastąpi OnPostAuthenticateRequest obsługi zdarzeń w pliku Global.asax.</span><span class="sxs-lookup"><span data-stu-id="5afa5-500">Whenever a request arrives and is dispatched to the ASP.NET engine, the Application\_OnPostAuthenticateRequest event handler in Global.asax will fire.</span></span> <span data-ttu-id="5afa5-501">Jeśli wniosek został pomyślnie uwierzytelniony przez FormsAuthenticationModule, program obsługi zdarzeń utworzy nowy obiekt CustomPrincipal obiektu CustomIdentity, w oparciu o biletu uwierzytelniania formularzy.</span><span class="sxs-lookup"><span data-stu-id="5afa5-501">If the request has been successfully authenticated by the FormsAuthenticationModule, the event handler will create a new CustomPrincipal object with a CustomIdentity object based on the forms authentication ticket.</span></span> <span data-ttu-id="5afa5-502">Tę logikę w miejscu uzyskiwanie dostępu do informacji na temat aktualnie zalogowanego użytkownika nazwy firmy i tytuł jest niezwykle proste.</span><span class="sxs-lookup"><span data-stu-id="5afa5-502">With this logic in place, accessing information about the currently logged on user's company name and title is incredibly straightforward.</span></span>

<span data-ttu-id="5afa5-503">Wróć do strony\_obciążenia obsługi zdarzeń w Default.aspx, gdzie w kroku 4 napisaliśmy kodu w celu pobrania biletu uwierzytelniania formularzy i przeanalizować właściwości danych użytkownika w celu wyświetlenia nazwy firmy i nazwa użytkownika.</span><span class="sxs-lookup"><span data-stu-id="5afa5-503">Return to the Page\_Load event handler in Default.aspx, where in Step 4 we wrote code to retrieve the form authentication ticket and parse the UserData property in order to display the user's company name and title.</span></span> <span data-ttu-id="5afa5-504">Z obiektami CustomPrincipal i CustomIdentity używany obecnie nie ma potrzeby można przeanalizować wartości z właściwości UserData biletu.</span><span class="sxs-lookup"><span data-stu-id="5afa5-504">With the CustomPrincipal and CustomIdentity objects in use now, there's no need to parse the values out of the ticket's UserData property.</span></span> <span data-ttu-id="5afa5-505">Zamiast tego po prostu pobrać odwołanie do obiektu CustomIdentity i użyj jego właściwości CompanyName i tytułu:</span><span class="sxs-lookup"><span data-stu-id="5afa5-505">Instead, simply get a reference to the CustomIdentity object and use its CompanyName and Title properties:</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample12.cs)]

## <a name="summary"></a><span data-ttu-id="5afa5-506">Podsumowanie</span><span class="sxs-lookup"><span data-stu-id="5afa5-506">Summary</span></span>

<span data-ttu-id="5afa5-507">W tym samouczku zbadaliśmy jak dostosować ustawienia systemu uwierzytelnianie formularzy przy użyciu pliku Web.config. Zobaczyliśmy, jak obsługiwany jest wygaśnięcia biletu uwierzytelniania i jak szyfrowanie i weryfikacja zabezpieczenia są używane do ochrony--ticket z inspekcji i modyfikacji.</span><span class="sxs-lookup"><span data-stu-id="5afa5-507">In this tutorial we examined how to customize the forms authentication system's settings via Web.config. We looked at how the authentication ticket's expiration is handled and how the encryption and validation safeguards are used to protect the ticket from inspection and modification.</span></span> <span data-ttu-id="5afa5-508">Na koniec opisano sposób używania właściwości UserData bilet uwierzytelniania do przechowywania dodatkowych informacji dotyczących użytkowników w bilecie sam i jak za pomocą niestandardowych obiektów podmiot zabezpieczeń i tożsamości ujawnić te informacje w sposób bardziej przyjazne dla deweloperów.</span><span class="sxs-lookup"><span data-stu-id="5afa5-508">Finally, we discussed using the authentication ticket's UserData property to store additional user information in the ticket itself, and how to use custom principal and identity objects to expose this information in a more developer-friendly manner.</span></span>

<span data-ttu-id="5afa5-509">W tym samouczku kończy się nasze badania uwierzytelniania formularzy w programie ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="5afa5-509">This tutorial concludes our examination of forms authentication in ASP.NET.</span></span> <span data-ttu-id="5afa5-510">Następny Samouczek rozpoczyna się nasza podróż w ramach członkostwa.</span><span class="sxs-lookup"><span data-stu-id="5afa5-510">The next tutorial starts our journey into the Membership framework.</span></span>

<span data-ttu-id="5afa5-511">Wszystkiego najlepszego programowania!</span><span class="sxs-lookup"><span data-stu-id="5afa5-511">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="5afa5-512">Dalsze informacje</span><span class="sxs-lookup"><span data-stu-id="5afa5-512">Further Reading</span></span>

<span data-ttu-id="5afa5-513">Więcej informacji na tematów omówionych w tym samouczku można znaleźć w następujących zasobach:</span><span class="sxs-lookup"><span data-stu-id="5afa5-513">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="5afa5-514">Analiza uwierzytelniania formularzy</span><span class="sxs-lookup"><span data-stu-id="5afa5-514">Dissecting Forms Authentication</span></span>](http://aspnet.4guysfromrolla.com/articles/072005-1.aspx)
- [<span data-ttu-id="5afa5-515">Wyjaśnienie: Uwierzytelnianie formularzy w programie ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="5afa5-515">Explained: Forms Authentication in ASP.NET 2.0</span></span>](https://msdn.microsoft.com/library/aa480476.aspx)
- [<span data-ttu-id="5afa5-516">Instrukcje: Ochrona uwierzytelniania formularzy w programie ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="5afa5-516">How To: Protect Forms Authentication in ASP.NET 2.0</span></span>](https://msdn.microsoft.com/library/ms998310.aspx)
- <span data-ttu-id="5afa5-517">[Profesjonalne platformy ASP.NET 2.0 zabezpieczeń, członkostwo i zarządzanie rolami](http://www.wrox.com/WileyCDA/WroxTitle/productCd-0764596985.html) (ISBN: 978-0-7645-9698-8)</span><span class="sxs-lookup"><span data-stu-id="5afa5-517">[Professional ASP.NET 2.0 Security, Membership, and Role Management](http://www.wrox.com/WileyCDA/WroxTitle/productCd-0764596985.html) (ISBN: 978-0-7645-9698-8)</span></span>
- [<span data-ttu-id="5afa5-518">Zabezpieczanie kontrolek logowania</span><span class="sxs-lookup"><span data-stu-id="5afa5-518">Securing Login Controls</span></span>](https://msdn.microsoft.com/library/ms178346.aspx)
- [<span data-ttu-id="5afa5-519">&lt;Uwierzytelniania&gt; — Element</span><span class="sxs-lookup"><span data-stu-id="5afa5-519">The &lt;authentication&gt; Element</span></span>](https://msdn.microsoft.com/library/532aee0e.aspx)
- [<span data-ttu-id="5afa5-520">&lt;Formularzy&gt; elementu &lt;uwierzytelniania&gt;</span><span class="sxs-lookup"><span data-stu-id="5afa5-520">The &lt;forms&gt; Element for &lt;authentication&gt;</span></span>](https://msdn.microsoft.com/library/1d3t3c61.aspx)
- [<span data-ttu-id="5afa5-521">&lt;MachineKey&gt; — Element</span><span class="sxs-lookup"><span data-stu-id="5afa5-521">The &lt;machineKey&gt; Element</span></span>](https://msdn.microsoft.com/library/w8h3skw9.aspx)
- [<span data-ttu-id="5afa5-522">Opis biletu uwierzytelniania formularzy i plików Cookie</span><span class="sxs-lookup"><span data-stu-id="5afa5-522">Understanding the Forms Authentication Ticket and Cookie</span></span>](https://support.microsoft.com/kb/910443)

### <a name="video-training-on-topics-contained-in-this-tutorial"></a><span data-ttu-id="5afa5-523">Szkolenie wideo na tematy zawarte w tym samouczku</span><span class="sxs-lookup"><span data-stu-id="5afa5-523">Video Training on Topics Contained in this Tutorial</span></span>

- [<span data-ttu-id="5afa5-524">Jak zmienić właściwości uwierzytelniania formularzy</span><span class="sxs-lookup"><span data-stu-id="5afa5-524">How to Change the Forms Authentication Properties</span></span>](../../../videos/authentication/how-to-change-the-forms-authentication-properties.md)
- [<span data-ttu-id="5afa5-525">Instrukcje instalacji i używania uwierzytelniania bez plików Cookie w aplikacji ASP.NET</span><span class="sxs-lookup"><span data-stu-id="5afa5-525">How to Setup and Use Cookie-less Authentication in an ASP.NET Application</span></span>](../../../videos/authentication/how-to-setup-and-use-cookie-less-authentication-in-an-aspnet-application.md)
- [<span data-ttu-id="5afa5-526">Relokacja logowania formularzy stron ASP</span><span class="sxs-lookup"><span data-stu-id="5afa5-526">ASP Forms Login Relocation</span></span>](../../../videos/authentication/asp-forms-login-relocation.md)
- [<span data-ttu-id="5afa5-527">Konfiguracja niestandardowa kluczy logowania formularzy</span><span class="sxs-lookup"><span data-stu-id="5afa5-527">Forms Login Custom Key Configuration</span></span>](../../../videos/authentication/forms-login-custom-key-configuration.md)
- [<span data-ttu-id="5afa5-528">Dodawanie niestandardowych danych do metody uwierzytelniania</span><span class="sxs-lookup"><span data-stu-id="5afa5-528">Add Custom Data to the Authentication Method</span></span>](../../../videos/authentication/add-custom-data-to-the-authentication-method.md)
- [<span data-ttu-id="5afa5-529">Używanie niestandardowych obiektów głównych</span><span class="sxs-lookup"><span data-stu-id="5afa5-529">Use Custom Principal Objects</span></span>](../../../videos/authentication/use-custom-principal-objects.md)

### <a name="about-the-author"></a><span data-ttu-id="5afa5-530">Informacje o autorze</span><span class="sxs-lookup"><span data-stu-id="5afa5-530">About the Author</span></span>

<span data-ttu-id="5afa5-531">Pracował nad Bento Scottem, autor wiele książek ASP/ASP.NET i założyciel 4GuysFromRolla.com, przy użyciu technologii Microsoft Web od 1998 r.</span><span class="sxs-lookup"><span data-stu-id="5afa5-531">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="5afa5-532">Scott działa jako niezależny Konsultant, trainer i składnika zapisywania.</span><span class="sxs-lookup"><span data-stu-id="5afa5-532">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="5afa5-533">Jego najnowszą książkę Stephena  *[Sams uczyć się ASP.NET 2.0 w ciągu 24 godzin](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span><span class="sxs-lookup"><span data-stu-id="5afa5-533">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="5afa5-534">Scott można z Tobą skontaktować w [ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com) lub za pośrednictwem jego blog znajduje się na [ http://ScottOnWriting.NET ](http://scottonwriting.net/).</span><span class="sxs-lookup"><span data-stu-id="5afa5-534">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="5afa5-535">Specjalne podziękowania dla</span><span class="sxs-lookup"><span data-stu-id="5afa5-535">Special Thanks To</span></span>

<span data-ttu-id="5afa5-536">W tej serii samouczków został zrecenzowany przez wielu recenzentów pomocne.</span><span class="sxs-lookup"><span data-stu-id="5afa5-536">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="5afa5-537">Weryfikacja potencjalnych klientów w ramach tego samouczka został Alicja Maziarz.</span><span class="sxs-lookup"><span data-stu-id="5afa5-537">Lead reviewer for this tutorial was Alicja Maziarz.</span></span> <span data-ttu-id="5afa5-538">Zainteresowani zapoznaniem Moje kolejnych artykułów MSDN?</span><span class="sxs-lookup"><span data-stu-id="5afa5-538">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="5afa5-539">Jeśli tak, Porzuć mnie linii w [ mitchell@4GuysFromRolla.com ](mailto:mitchell@4guysfromrolla.com).</span><span class="sxs-lookup"><span data-stu-id="5afa5-539">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4guysfromrolla.com).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="5afa5-540">[Poprzednie](an-overview-of-forms-authentication-cs.md)
> [dalej](security-basics-and-asp-net-support-vb.md)</span><span class="sxs-lookup"><span data-stu-id="5afa5-540">[Previous](an-overview-of-forms-authentication-cs.md)
[Next](security-basics-and-asp-net-support-vb.md)</span></span>
