---
uid: web-forms/overview/older-versions-security/membership/user-based-authorization-cs
title: Autoryzacja oparta na użytkownikach (C#) | Dokumentacja firmy Microsoft
author: rick-anderson
description: W tym samouczku przyjrzymy się ograniczenie dostępu do stron i ograniczenie funkcji na poziomie strony za pomocą różnych technik.
ms.author: riande
ms.date: 01/18/2008
ms.assetid: 3c815a9e-2296-4b9b-b945-776d54989daa
msc.legacyurl: /web-forms/overview/older-versions-security/membership/user-based-authorization-cs
msc.type: authoredcontent
ms.openlocfilehash: 3078c186431d7662d54bc7e05dde60124de1956d
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 05/06/2019
ms.locfileid: "65131869"
---
# <a name="user-based-authorization-c"></a><span data-ttu-id="ca3a9-103">Autoryzacja oparta na użytkownikach (C#)</span><span class="sxs-lookup"><span data-stu-id="ca3a9-103">User-Based Authorization (C#)</span></span>

<span data-ttu-id="ca3a9-104">przez [Bento Scott](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="ca3a9-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="ca3a9-105">[Pobierz program Code](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_07_CS.zip) lub [Pobierz plik PDF](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial07_UserAuth_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="ca3a9-105">[Download Code](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_07_CS.zip) or [Download PDF](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial07_UserAuth_cs.pdf)</span></span>

> <span data-ttu-id="ca3a9-106">W tym samouczku przyjrzymy się ograniczenie dostępu do stron i ograniczenie funkcji na poziomie strony za pomocą różnych technik.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-106">In this tutorial we will look at limiting access to pages and restricting page-level functionality through a variety of techniques.</span></span>

## <a name="introduction"></a><span data-ttu-id="ca3a9-107">Wprowadzenie</span><span class="sxs-lookup"><span data-stu-id="ca3a9-107">Introduction</span></span>

<span data-ttu-id="ca3a9-108">Większość aplikacji sieci web, które oferują kont użytkowników to zrobić w części w celu ograniczenia pewnych odwiedzających dostęp do niektórych stron w witrynie.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-108">Most web applications that offer user accounts do so in part to restrict certain visitors from accessing certain pages within the site.</span></span> <span data-ttu-id="ca3a9-109">W większości online messageboard witryn na przykład wszyscy użytkownicy — anonimowy i uwierzytelnionego — będą mogli wyświetlić wpisy messageboard jednak tylko uwierzytelnieni użytkownicy mogą odwiedzić stronę sieci web, aby utworzyć nowy wpis.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-109">In most online messageboard sites, for example, all users - anonymous and authenticated - are able to view the messageboard's posts, but only authenticated users can visit the web page to create a new post.</span></span> <span data-ttu-id="ca3a9-110">I może być stron administracyjnych dostępnych tylko dla określonego użytkownika (lub w określonej grupie użytkowników).</span><span class="sxs-lookup"><span data-stu-id="ca3a9-110">And there may be administrative pages that are only accessible to a particular user (or a particular set of users).</span></span> <span data-ttu-id="ca3a9-111">Ponadto funkcje na poziomie strony mogą różnić się na podstawie użytkownika przez użytkownika.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-111">Moreover, page-level functionality can differ on a user-by-user basis.</span></span> <span data-ttu-id="ca3a9-112">Podczas przeglądania listy wpisów, uwierzytelnionych użytkowników są wyświetlane interfejs dla każdego wpisu, klasyfikacja, ten interfejs nie jest dostępna anonimowych gościom.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-112">When viewing a list of posts, authenticated users are shown an interface for rating each post, whereas this interface is not available to anonymous visitors.</span></span>

<span data-ttu-id="ca3a9-113">Program ASP.NET ułatwia do zdefiniowania reguł autoryzacji opartej na użytkownika.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-113">ASP.NET makes it easy to define user-based authorization rules.</span></span> <span data-ttu-id="ca3a9-114">Za pomocą tylko znacznej liczby znaczników w `Web.config`, określonych stron sieci web lub katalogów całego można zablokować tak, aby tylko są one dostępne do określonej podgrupy użytkowników.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-114">With just a bit of markup in `Web.config`, specific web pages or entire directories can be locked down so that they are only accessible to a specified subset of users.</span></span> <span data-ttu-id="ca3a9-115">Funkcje na poziomie strony można włączyć lub wyłączyć zależnie od aktualnie zalogowanego użytkownika w sposób programowy i deklaratywnego.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-115">Page-level functionality can be turned on or off based on the currently logged in user through programmatic and declarative means.</span></span>

<span data-ttu-id="ca3a9-116">W tym samouczku przyjrzymy się ograniczenie dostępu do stron i ograniczenie funkcji na poziomie strony za pomocą różnych technik.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-116">In this tutorial we will look at limiting access to pages and restricting page-level functionality through a variety of techniques.</span></span> <span data-ttu-id="ca3a9-117">Zaczynajmy!</span><span class="sxs-lookup"><span data-stu-id="ca3a9-117">Let's get started!</span></span>

## <a name="a-look-at-the-url-authorization-workflow"></a><span data-ttu-id="ca3a9-118">Przyjrzeć się przepływu pracy autoryzacji adresów URL</span><span class="sxs-lookup"><span data-stu-id="ca3a9-118">A Look at the URL Authorization Workflow</span></span>

<span data-ttu-id="ca3a9-119">Zgodnie z opisem w [ *omówienie uwierzytelniania formularzy* ](../introduction/an-overview-of-forms-authentication-cs.md) samouczek, gdy środowisko uruchomieniowe ASP.NET przetwarza żądanie dla zasobu żądania ASP.NET zgłasza liczbę zdarzeń podczas ich cyklu życia.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-119">As discussed in the [*An Overview of Forms Authentication*](../introduction/an-overview-of-forms-authentication-cs.md) tutorial, when the ASP.NET runtime processes a request for an ASP.NET resource the request raises a number of events during its lifecycle.</span></span> <span data-ttu-id="ca3a9-120">*Moduły HTTP* są klasami zarządzanymi, którego kod jest wykonywany w odpowiedzi na konkretne zdarzenie w cyklu życia żądania.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-120">*HTTP Modules* are managed classes whose code is executed in response to a particular event in the request lifecycle.</span></span> <span data-ttu-id="ca3a9-121">ASP.NET jest dostarczany z liczbą moduły HTTP, który wykonywania podstawowych zadań w tle.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-121">ASP.NET ships with a number of HTTP Modules that perform essential tasks behind the scenes.</span></span>

<span data-ttu-id="ca3a9-122">Jest jeden taki moduł HTTP [ `FormsAuthenticationModule` ](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx).</span><span class="sxs-lookup"><span data-stu-id="ca3a9-122">One such HTTP Module is [`FormsAuthenticationModule`](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx).</span></span> <span data-ttu-id="ca3a9-123">Zgodnie z opisem w poprzednich samouczkach podstawową funkcją `FormsAuthenticationModule` ma na celu określenie tożsamość bieżącego żądania.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-123">As discussed in previous tutorials, the primary function of the `FormsAuthenticationModule` is to determine the identity of the current request.</span></span> <span data-ttu-id="ca3a9-124">Jest to realizowane przez sprawdzenie biletu uwierzytelniania formularzy, który znajduje się w pliku cookie albo osadzony w adresie URL.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-124">This is accomplished by inspecting the forms authentication ticket, which is either located in a cookie or embedded within the URL.</span></span> <span data-ttu-id="ca3a9-125">Ten identyfikator ma miejsce podczas [ `AuthenticateRequest` zdarzeń](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx).</span><span class="sxs-lookup"><span data-stu-id="ca3a9-125">This identification takes place during the [`AuthenticateRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx).</span></span>

<span data-ttu-id="ca3a9-126">Będzie wprowadzenie innego modułu HTTP ważne [ `UrlAuthorizationModule` ](https://msdn.microsoft.com/library/system.web.security.urlauthorizationmodule.aspx), który jest zgłaszany w odpowiedzi na [ `AuthorizeRequest` zdarzeń](https://msdn.microsoft.com/library/system.web.httpapplication.authorizerequest.aspx) (który stanie się po `AuthenticateRequest` zdarzeń).</span><span class="sxs-lookup"><span data-stu-id="ca3a9-126">Another important HTTP Module is the [`UrlAuthorizationModule`](https://msdn.microsoft.com/library/system.web.security.urlauthorizationmodule.aspx), which is raised in response to the [`AuthorizeRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.authorizerequest.aspx) (which happens after the `AuthenticateRequest` event).</span></span> <span data-ttu-id="ca3a9-127">`UrlAuthorizationModule` Sprawdza, czy konfiguracja znaczników w `Web.config` ustalenie, czy bieżąca tożsamość ma uprawnienia do określoną stronę.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-127">The `UrlAuthorizationModule` examines configuration markup in `Web.config` to determine whether the current identity has authority to visit the specified page.</span></span> <span data-ttu-id="ca3a9-128">Ten proces jest nazywany *Autoryzacja adresów URL*.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-128">This process is referred to as *URL authorization*.</span></span>

<span data-ttu-id="ca3a9-129">Zajmiemy się składnia dla reguły autoryzacji adresów URL w kroku 1, ale najpierw możemy przyjrzeć się co `UrlAuthorizationModule` jest w zależności od tego, czy żądanie jest autoryzowane.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-129">We'll examine the syntax for the URL authorization rules in Step 1, but first let's look at what the `UrlAuthorizationModule` does depending on whether the request is authorized or not.</span></span> <span data-ttu-id="ca3a9-130">Jeśli `UrlAuthorizationModule` Określa, czy żądanie jest autoryzowane, a następnie nic nie robi i żądanie jest kontynuowane przy użyciu jej cyklu projektowania.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-130">If the `UrlAuthorizationModule` determines that the request is authorized, then it does nothing, and the request continues through its lifecycle.</span></span> <span data-ttu-id="ca3a9-131">Jednak jeśli żądanie jest *nie* autoryzowany, a następnie `UrlAuthorizationModule` przerywa cyklu życia i powoduje, że `Response` obiekt do zwrotu [HTTP 401 nieautoryzowane](http://www.checkupdown.com/status/E401.html) stanu.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-131">However, if the request is *not* authorized, then the `UrlAuthorizationModule` aborts the lifecycle and instructs the `Response` object to return an [HTTP 401 Unauthorized](http://www.checkupdown.com/status/E401.html) status.</span></span> <span data-ttu-id="ca3a9-132">Podczas korzystania z uwierzytelniania formularzy ten stan HTTP 401 nigdy nie są zwracane do klienta, ponieważ jeśli `FormsAuthenticationModule` wykrywa HTTP 401, jest w stanie modyfikuje się [przekierowania 302 HTTP](http://www.checkupdown.com/status/E302.html) do strony logowania.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-132">When using forms authentication this HTTP 401 status is never returned to the client because if the `FormsAuthenticationModule` detects an HTTP 401 status is modifies it to an [HTTP 302 Redirect](http://www.checkupdown.com/status/E302.html) to the login page.</span></span>

<span data-ttu-id="ca3a9-133">Rysunek 1 przedstawia przepływ pracy potoku platformy ASP.NET `FormsAuthenticationModule`i `UrlAuthorizationModule` po nadejściu nieautoryzowanego żądania.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-133">Figure 1 illustrates the workflow of the ASP.NET pipeline, the `FormsAuthenticationModule`, and the `UrlAuthorizationModule` when an unauthorized request arrives.</span></span> <span data-ttu-id="ca3a9-134">W szczególności rysunek 1 pokazuje żądania anonimowe osoby odwiedzającej dla `ProtectedPage.aspx`, który jest strona, która nie zezwala na dostęp dla użytkowników anonimowych.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-134">In particular, Figure 1 shows a request by an anonymous visitor for `ProtectedPage.aspx`, which is a page that denies access to anonymous users.</span></span> <span data-ttu-id="ca3a9-135">Ponieważ użytkownik jest anonimowy, `UrlAuthorizationModule` anuluje żądanie i zwraca stan HTTP 401 nieautoryzowane.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-135">Since the visitor is anonymous, the `UrlAuthorizationModule` aborts the request and returns an HTTP 401 Unauthorized status.</span></span> <span data-ttu-id="ca3a9-136">`FormsAuthenticationModule` Następnie konwertuje stanu 401 na przekierowanie 302 strony logowania.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-136">The `FormsAuthenticationModule` then converts the 401 status into a 302 Redirect to login page.</span></span> <span data-ttu-id="ca3a9-137">Po uwierzytelnieniu użytkownika za pośrednictwem strony logowania, użytkownik jest przekierowywany do `ProtectedPage.aspx`.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-137">After the user is authenticated via the login page, he is redirected to `ProtectedPage.aspx`.</span></span> <span data-ttu-id="ca3a9-138">Tym razem `FormsAuthenticationModule` identyfikację użytkownika, w oparciu o jego biletu uwierzytelniania.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-138">This time the `FormsAuthenticationModule` identifies the user based on his authentication ticket.</span></span> <span data-ttu-id="ca3a9-139">Teraz, gdy użytkownik jest uwierzytelniony, `UrlAuthorizationModule` zezwala na dostęp do tej strony.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-139">Now that the visitor is authenticated, the `UrlAuthorizationModule` permits access to the page.</span></span>

<span data-ttu-id="ca3a9-140">[![Uwierzytelnianie formularzy i przepływu pracy autoryzacji adresów URL](user-based-authorization-cs/_static/image2.png)](user-based-authorization-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="ca3a9-140">[![The Forms Authentication and URL Authorization Workflow](user-based-authorization-cs/_static/image2.png)](user-based-authorization-cs/_static/image1.png)</span></span>

<span data-ttu-id="ca3a9-141">**Rysunek 1**: Uwierzytelnianie formularzy i przepływu pracy autoryzacji adresu URL ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](user-based-authorization-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="ca3a9-141">**Figure 1**: The Forms Authentication and URL Authorization Workflow  ([Click to view full-size image](user-based-authorization-cs/_static/image3.png))</span></span>

<span data-ttu-id="ca3a9-142">Rysunek 1 przedstawia interakcję, który występuje, gdy anonimowy użytkownik próbuje uzyskać dostęp do zasobu, który nie jest dostępne dla użytkowników anonimowych.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-142">Figure 1 depicts the interaction that occurs when an anonymous visitor attempts to access a resource that is not available to anonymous users.</span></span> <span data-ttu-id="ca3a9-143">W takim przypadku anonimowy użytkownik jest przekierowywany do strony logowania ze stroną którą użytkownik próbował można znaleźć określonej w zmiennej querystring.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-143">In such a case, the anonymous visitor is redirected to the login page with the page she attempted to visit specified in the querystring.</span></span> <span data-ttu-id="ca3a9-144">Po pomyślnym zalogowaniu się użytkownika użytkownik zostanie automatycznie przekierowany ponownie do zasobów, których ona początkowo próbował wyświetlić.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-144">Once the user has successfully logged on, she will be automatically redirected back to the resource she was initially attempting to view.</span></span>

<span data-ttu-id="ca3a9-145">Gdy użytkownik anonimowy nieautoryzowanego żądania, ten przepływ pracy jest proste, a następnie łatwo dla obiektu odwiedzającego zrozumieć, co się stało i dlaczego.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-145">When the unauthorized request is made by an anonymous user, this workflow is straightforward and is easy for the visitor to understand what has happened and why.</span></span> <span data-ttu-id="ca3a9-146">Jednak należy pamiętać, że `FormsAuthenticationModule` nastąpi przekierowanie *wszelkie* nieautoryzowany użytkownik do strony logowania, nawet wtedy, gdy żądanie jest wysyłane przez uwierzytelnionego użytkownika.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-146">But keep in mind that the `FormsAuthenticationModule` will redirect *any* unauthorized user to the login page, even if the request is made by an authenticated user.</span></span> <span data-ttu-id="ca3a9-147">Może to spowodować mylące środowisko użytkownika uwierzytelnionego użytkownika próba stronę, dla którego nie ma ona urzędu.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-147">This can result in a confusing user experience if an authenticated user attempts to visit a page for which she lacks authority.</span></span>

<span data-ttu-id="ca3a9-148">Wyobraź sobie, że naszej witryny sieci Web były jej reguł autoryzacji adresów URL skonfigurowany tak, aby strona ASP.NET `OnlyTito.aspx` było accessibly tylko Tito.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-148">Imagine that our website had its URL authorization rules configured such that the ASP.NET page `OnlyTito.aspx` was accessibly only to Tito.</span></span> <span data-ttu-id="ca3a9-149">Teraz Wyobraź sobie, że Sam odwiedza witryny, loguje się i następnie próbuje znaleźć `OnlyTito.aspx`.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-149">Now, imagine that Sam visits the site, logs on, and then attempts to visit `OnlyTito.aspx`.</span></span> <span data-ttu-id="ca3a9-150">`UrlAuthorizationModule` Spowoduje zatrzymanie cyklu życia żądania i zwraca stan HTTP 401 nieautoryzowane, który `FormsAuthenticationModule` wykryje i Sam przekierowanie do strony logowania.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-150">The `UrlAuthorizationModule` will halt the request lifecycle and return an HTTP 401 Unauthorized status, which the `FormsAuthenticationModule` will detect and then redirect Sam to the login page.</span></span> <span data-ttu-id="ca3a9-151">Ponieważ Sam zalogował się już, jednak marcela się zastanawiać, dlaczego została ona wysłana powrót do strony logowania.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-151">Since Sam has already logged in, though, she may wonder why she has been sent back to the login page.</span></span> <span data-ttu-id="ca3a9-152">Może ona przyczyny, że jej poświadczenia logowania zostały utracone jakiś sposób lub że ona wprowadzono nieprawidłowe poświadczenia.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-152">She might reason that her login credentials were lost somehow, or that she entered invalid credentials.</span></span> <span data-ttu-id="ca3a9-153">Jeśli Sam wraca swoje poświadczenia na stronie logowania będzie ona zalogowany (ponownie) i Przekierowanie do `OnlyTito.aspx`.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-153">If Sam reenters her credentials from the login page she will be logged on (again) and redirected to `OnlyTito.aspx`.</span></span> <span data-ttu-id="ca3a9-154">`UrlAuthorizationModule` Wykryje, że Sam nie mogą odwiedzić tę stronę i powróci ona do strony logowania.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-154">The `UrlAuthorizationModule` will detect that Sam cannot visit this page and she will be returned to the login page.</span></span>

<span data-ttu-id="ca3a9-155">Rysunek 2 przedstawia to mylące przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-155">Figure 2 depicts this confusing workflow.</span></span>

<span data-ttu-id="ca3a9-156">[![Domyślny przepływ pracy może prowadzić do mylące cyklu](user-based-authorization-cs/_static/image5.png)](user-based-authorization-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="ca3a9-156">[![The Default Workflow Can Lead to a Confusing Cycle](user-based-authorization-cs/_static/image5.png)](user-based-authorization-cs/_static/image4.png)</span></span>

<span data-ttu-id="ca3a9-157">**Rysunek 2**: Domyślny przepływ pracy może prowadzić do cyklu mylące ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](user-based-authorization-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="ca3a9-157">**Figure 2**: The Default Workflow Can Lead to a Confusing Cycle  ([Click to view full-size image](user-based-authorization-cs/_static/image6.png))</span></span>

<span data-ttu-id="ca3a9-158">Przepływ pracy, przedstawione na rysunku 2 można szybko befuddle nawet większość komputerów pomysłowy obiekt odwiedzający.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-158">The workflow illustrated in Figure 2 can quickly befuddle even the most computer savvy visitor.</span></span> <span data-ttu-id="ca3a9-159">Przedstawiony zostanie sposób, aby zapobiec takiej sytuacji mylące cyklu w kroku 2.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-159">We will look at ways to prevent this confusing cycle in Step 2.</span></span>

> [!NOTE]
> <span data-ttu-id="ca3a9-160">Aplikacja ASP.NET używa dwa mechanizmy, aby ustalić, czy bieżący użytkownik może uzyskać dostęp do określonej strony sieci web: Autoryzacja adresów URL i autoryzacji plików.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-160">ASP.NET uses two mechanisms to determine whether the current user can access a particular web page: URL authorization and file authorization.</span></span> <span data-ttu-id="ca3a9-161">Plik autoryzacji jest implementowany przez [ `FileAuthorizationModule` ](https://msdn.microsoft.com/library/system.web.security.fileauthorizationmodule.aspx), która określa urząd przez consulting żądane pliki listy ACL.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-161">File authorization is implemented by the [`FileAuthorizationModule`](https://msdn.microsoft.com/library/system.web.security.fileauthorizationmodule.aspx), which determines authority by consulting the requested file(s) ACLs.</span></span> <span data-ttu-id="ca3a9-162">Plik autoryzacji jest najczęściej używana z uwierzytelnianiem Windows, ponieważ listy ACL są uprawnienia, które są stosowane do kont Windows.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-162">File authorization is most commonly used with Windows authentication because ACLs are permissions that apply to Windows accounts.</span></span> <span data-ttu-id="ca3a9-163">Korzystając z uwierzytelniania formularzy, wszystkie żądania systemu na poziomie systemu operacyjnego i pliku są wykonywane przez tego samego konta Windows, niezależnie od użytkownika w witrynie.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-163">When using forms authentication, all operating system- and file system-level requests are executed by the same Windows account, regardless of the user visiting the site.</span></span> <span data-ttu-id="ca3a9-164">Ponieważ w tej serii samouczków skupia się na uwierzytelnianie formularzy, firma Microsoft będzie nie być Omawiając autoryzacji plików.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-164">Since this tutorial series focuses on forms authentication, we will not be discussing file authorization.</span></span>

### <a name="the-scope-of-url-authorization"></a><span data-ttu-id="ca3a9-165">Zakres Autoryzacja adresów URL</span><span class="sxs-lookup"><span data-stu-id="ca3a9-165">The Scope of URL Authorization</span></span>

<span data-ttu-id="ca3a9-166">`UrlAuthorizationModule` Jest zarządzanego kodu, który jest częścią środowiska uruchomieniowego programu ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-166">The `UrlAuthorizationModule` is managed code that is part of the ASP.NET runtime.</span></span> <span data-ttu-id="ca3a9-167">Przed firmy Microsoft w wersji 7 [Internet Information Services (IIS)](https://www.iis.net/) serwera sieci web wystąpił distinct barierę między potoku HTTP usług IIS i środowiska uruchomieniowego ASP.NET potoku.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-167">Prior to version 7 of Microsoft's [Internet Information Services (IIS)](https://www.iis.net/) web server, there was a distinct barrier between IIS's HTTP pipeline and the ASP.NET runtime's pipeline.</span></span> <span data-ttu-id="ca3a9-168">W skrócie, w usługach IIS 6 i starszych ASP. NET firmy `UrlAuthorizationModule` wykonywana tylko wtedy, gdy żądanie jest delegowane za pomocą programu IIS do środowiska uruchomieniowego programu ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-168">In short, in IIS 6 and earlier, ASP.NET's `UrlAuthorizationModule` only executes when a request is delegated from IIS to the ASP.NET runtime.</span></span> <span data-ttu-id="ca3a9-169">Domyślnie usługi IIS przetwarza zawartość statyczną, sam — jak strony HTML i CSS, JavaScript i plików obrazów — i tylko przekazuje żądania do obsługi platformy ASP.NET, gdy strona z rozszerzeniem `.aspx`, `.asmx`, lub `.ashx` żądania.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-169">By default, IIS processes static content itself - like HTML pages and CSS, JavaScript, and image files - and only hands off requests to the ASP.NET runtime when a page with an extension of `.aspx`, `.asmx`, or `.ashx` is requested.</span></span>

<span data-ttu-id="ca3a9-170">Usługi IIS 7, jednak umożliwia zintegrowanych usług IIS i platformy ASP.NET potoków.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-170">IIS 7, however, allows for integrated IIS and ASP.NET pipelines.</span></span> <span data-ttu-id="ca3a9-171">Przy użyciu kilku ustawień konfiguracji, można skonfigurować usługi IIS 7 do wywołania `UrlAuthorizationModule` dla *wszystkich* żądań, co oznacza, że reguły autoryzacji adresów URL mogą być definiowane dla plików dowolnego typu.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-171">With a few configuration settings you can setup IIS 7 to invoke the `UrlAuthorizationModule` for *all* requests, meaning that URL authorization rules can be defined for files of any type.</span></span> <span data-ttu-id="ca3a9-172">Ponadto usług IIS 7 zawiera swój własny aparat autoryzacji adresu URL.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-172">Additionally, IIS 7 includes its own URL authorization engine.</span></span> <span data-ttu-id="ca3a9-173">Aby uzyskać więcej informacji na temat Integracja platformy ASP.NET i IIS 7 natywnego adresu URL autoryzacji funkcji, zobacz [Autoryzacja adresów URL usług IIS7 opis](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/URL-Authorization/Understanding-IIS7-URL-Authorization).</span><span class="sxs-lookup"><span data-stu-id="ca3a9-173">For more information on ASP.NET integration and IIS 7's native URL authorization functionality, see [Understanding IIS7 URL Authorization](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/URL-Authorization/Understanding-IIS7-URL-Authorization).</span></span> <span data-ttu-id="ca3a9-174">Aby uzyskać więcej informacji na temat przyjrzeć Integracja platformy ASP.NET i IIS 7, wybierz kopię książki Shahram Khosravi *Professional usług IIS 7 i platformy ASP.NET-zintegrowane programowania* (ISBN: 978-0470152539).</span><span class="sxs-lookup"><span data-stu-id="ca3a9-174">For a more in-depth look at ASP.NET and IIS 7 integration, pick up a copy of Shahram Khosravi's book, *Professional IIS 7 and ASP.NET Integrated Programming* (ISBN: 978-0470152539).</span></span>

<span data-ttu-id="ca3a9-175">Mówiąc w wersjach wcześniejszych niż IIS 7, reguły autoryzacji adresów URL są stosowane tylko do zasobów, obsługiwane przez środowisko uruchomieniowe programu ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-175">In a nutshell, in versions prior to IIS 7, URL authorization rules are only applied to resources handled by the ASP.NET runtime.</span></span> <span data-ttu-id="ca3a9-176">Ale za pomocą usług IIS 7 można korzystać z natywnych funkcji autoryzacji adresu URL usług IIS ani integrowanie ASP. NET firmy `UrlAuthorizationModule` do potoku HTTP usług IIS, rozszerzając w ten sposób działania tej funkcji na wszystkich żądań.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-176">But with IIS 7 it is possible to use IIS's native URL authorization feature or to integrate ASP.NET's `UrlAuthorizationModule` into IIS's HTTP pipeline, thereby extending this functionality to all requests.</span></span>

> [!NOTE]
> <span data-ttu-id="ca3a9-177">Istnieją pewne różnice w sposób subtelne jeszcze ważne ASP. NET firmy `UrlAuthorizationModule` oraz funkcji autoryzacji adresów URL usług IIS 7 przetwarzanie reguł autoryzacji.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-177">There are some subtle yet important differences in how ASP.NET's `UrlAuthorizationModule` and IIS 7's URL authorization feature process the authorization rules.</span></span> <span data-ttu-id="ca3a9-178">W tym samouczku nie analizuje funkcji autoryzacji adresów URL usług IIS 7 lub różnice w sposób jej analizuje reguły autoryzacji w porównaniu do `UrlAuthorizationModule`.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-178">This tutorial does not examine IIS 7's URL authorization functionality or the differences in how it parses authorization rules compared to the `UrlAuthorizationModule`.</span></span> <span data-ttu-id="ca3a9-179">Więcej informacji na temat tych tematów, można znaleźć w dokumentacji usług IIS 7, MSDN lub na [www.iis.net](https://www.iis.net/).</span><span class="sxs-lookup"><span data-stu-id="ca3a9-179">For more information on these topics, refer to the IIS 7 documentation on MSDN or at [www.iis.net](https://www.iis.net/).</span></span>

## <a name="step-1-defining-url-authorization-rules-inwebconfig"></a><span data-ttu-id="ca3a9-180">Krok 1. Definiowanie reguł autoryzacji adresów URL w`Web.config`</span><span class="sxs-lookup"><span data-stu-id="ca3a9-180">Step 1: Defining URL Authorization Rules in`Web.config`</span></span>

<span data-ttu-id="ca3a9-181">`UrlAuthorizationModule` Określa, czy należy udzielić lub odmówić dostępu do żądanego zasobu dla określonej tożsamości, w oparciu o reguł autoryzacji adresów URL, które są zdefiniowane w konfiguracji aplikacji.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-181">The `UrlAuthorizationModule` determines whether to grant or deny access to a requested resource for a particular identity based on the URL authorization rules defined in the application's configuration.</span></span> <span data-ttu-id="ca3a9-182">Reguły autoryzacji są zapisane w [ `<authorization>` elementu](https://msdn.microsoft.com/library/8d82143t.aspx) w formie `<allow>` i `<deny>` elementów podrzędnych.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-182">The authorization rules are spelled out in the [`<authorization>` element](https://msdn.microsoft.com/library/8d82143t.aspx) in the form of `<allow>` and `<deny>` child elements.</span></span> <span data-ttu-id="ca3a9-183">Każdy `<allow>` i `<deny>` elementu podrzędnego można określić:</span><span class="sxs-lookup"><span data-stu-id="ca3a9-183">Each `<allow>` and `<deny>` child element can specify:</span></span>

- <span data-ttu-id="ca3a9-184">Określonego użytkownika</span><span class="sxs-lookup"><span data-stu-id="ca3a9-184">A particular user</span></span>
- <span data-ttu-id="ca3a9-185">Rozdzielana przecinkami lista użytkowników</span><span class="sxs-lookup"><span data-stu-id="ca3a9-185">A comma-delimited list of users</span></span>
- <span data-ttu-id="ca3a9-186">Wszyscy użytkownicy anonimowi wskazywane przez znak zapytania (?)</span><span class="sxs-lookup"><span data-stu-id="ca3a9-186">All anonymous users, denoted by a question mark (?)</span></span>
- <span data-ttu-id="ca3a9-187">Wszyscy użytkownicy, oznaczone gwiazdką (\*)</span><span class="sxs-lookup"><span data-stu-id="ca3a9-187">All users, denoted by an asterisk (\*)</span></span>

<span data-ttu-id="ca3a9-188">Następujący kod ilustruje sposób użycia reguł autoryzacji adresów URL umożliwiają użytkownikom Tito i Scotta i odmawiać go wszystkie pozostałe:</span><span class="sxs-lookup"><span data-stu-id="ca3a9-188">The following markup illustrates how to use the URL authorization rules to allow users Tito and Scott and deny all others:</span></span>

[!code-xml[Main](user-based-authorization-cs/samples/sample1.xml)]

<span data-ttu-id="ca3a9-189">`<allow>` Element definiuje, jakie użytkownicy mogą uzyskiwać — Tito i Scott — gdy `<deny>` elementu powoduje, że że *wszystkich* użytkownik nie będzie mógł.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-189">The `<allow>` element defines what users are permitted - Tito and Scott - while the `<deny>` element instructs that *all* users are denied.</span></span>

> [!NOTE]
> <span data-ttu-id="ca3a9-190">`<allow>` i `<deny>` elementy można również określić reguły autoryzacji dla ról.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-190">The `<allow>` and `<deny>` elements can also specify authorization rules for roles.</span></span> <span data-ttu-id="ca3a9-191">Będziemy sprawdzać autoryzacji opartej na rolach w przyszłości zapoznać się z samouczkiem.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-191">We will examine role-based authorization in a future tutorial.</span></span>

<span data-ttu-id="ca3a9-192">Następujące ustawienie udziela dostępu dla każdego z wyjątkiem Sam (w tym gości anonimowe):</span><span class="sxs-lookup"><span data-stu-id="ca3a9-192">The following setting grants access to anyone other than Sam (including anonymous visitors):</span></span>

[!code-xml[Main](user-based-authorization-cs/samples/sample2.xml)]

<span data-ttu-id="ca3a9-193">Aby zezwolić tylko uwierzytelnionym użytkownikom, użyj następującej konfiguracji, który nie zezwala na dostęp do wszystkich użytkowników anonimowych:</span><span class="sxs-lookup"><span data-stu-id="ca3a9-193">To allow only authenticated users, use the following configuration, which denies access to all anonymous users:</span></span>

[!code-xml[Main](user-based-authorization-cs/samples/sample3.xml)]

<span data-ttu-id="ca3a9-194">Reguły autoryzacji są zdefiniowane w ramach `<system.web>` element `Web.config` i mają zastosowanie do wszystkich zasobów platformy ASP.NET w aplikacji sieci web.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-194">The authorization rules are defined within the `<system.web>` element in `Web.config` and apply to all of the ASP.NET resources in the web application.</span></span> <span data-ttu-id="ca3a9-195">Często aplikacja ma reguły autoryzacji różne dla różnych sekcji.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-195">Oftentimes, an application has different authorization rules for different sections.</span></span> <span data-ttu-id="ca3a9-196">Na przykład w witrynie handlu elektronicznego, wszystkie osoby odwiedzające może przejrzeć produktów, zobacz recenzje produktów, wyszukać w katalogu i tak dalej.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-196">For example, at an eCommerce site, all visitors may peruse the products, see product reviews, search the catalog, and so on.</span></span> <span data-ttu-id="ca3a9-197">Jednak tylko uwierzytelnieni użytkownicy mogą nawiązać połączenia wyewidencjonowanie lub stron, aby zarządzać jednostkowego historii wysyłania.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-197">However, only authenticated users may reach the checkout or the pages to manage one's shipping history.</span></span> <span data-ttu-id="ca3a9-198">Ponadto może być porcje witryny tylko są dostępne dla wybieranych użytkowników, takich jak Administratorzy witryny.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-198">Moreover, there may be portions of the site that are only accessible by select users, such as site administrators.</span></span>

<span data-ttu-id="ca3a9-199">Program ASP.NET ułatwia do zdefiniowania reguł autoryzacji różne dla różnych plików i folderów w lokacji.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-199">ASP.NET makes it easy to define different authorization rules for different files and folders in the site.</span></span> <span data-ttu-id="ca3a9-200">Reguły autoryzacji, określone w folderze głównym `Web.config` pliku, Zastosuj do wszystkich zasobów platformy ASP.NET w witrynie.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-200">The authorization rules specified in the root folder's `Web.config` file apply to all ASP.NET resources in the site.</span></span> <span data-ttu-id="ca3a9-201">Jednak te domyślne ustawienia autoryzacji może być zastąpiona w przypadku określonego folderu, dodając `Web.config` z `<authorization>` sekcji.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-201">However, these default authorization settings can be overridden for a particular folder by adding a `Web.config` with an `<authorization>` section.</span></span>

<span data-ttu-id="ca3a9-202">Zaktualizujmy naszą witrynę sieci Web, tak aby tylko uwierzytelnieni użytkownicy mogą odwiedzać strony ASP.NET w `Membership` folderu.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-202">Let's update our website so that only authenticated users can visit the ASP.NET pages in the `Membership` folder.</span></span> <span data-ttu-id="ca3a9-203">W tym musimy dodać `Web.config` plik `Membership` folder i jego ustawienia autoryzacji, aby uniemożliwić użytkownikom anonimowym.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-203">To accomplish this we need to add a `Web.config` file to the `Membership` folder and set its authorization settings to deny anonymous users.</span></span> <span data-ttu-id="ca3a9-204">Kliknij prawym przyciskiem myszy `Membership` folder w Eksploratorze rozwiązań wybierz menu Dodaj nowy element z menu kontekstowego, a następnie dodaj nowy plik konfiguracji sieci Web o nazwie `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-204">Right-click the `Membership` folder in the Solution Explorer, choose the Add New Item menu from the context menu, and add a new Web Configuration File named `Web.config`.</span></span>

<span data-ttu-id="ca3a9-205">[![Dodaj plik Web.config w folderze członkostwa](user-based-authorization-cs/_static/image8.png)](user-based-authorization-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="ca3a9-205">[![Add a Web.config File to the Membership Folder](user-based-authorization-cs/_static/image8.png)](user-based-authorization-cs/_static/image7.png)</span></span>

<span data-ttu-id="ca3a9-206">**Rysunek 3**: Dodaj `Web.config` plik `Membership` Folder ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](user-based-authorization-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="ca3a9-206">**Figure 3**: Add a `Web.config` File to the `Membership` Folder  ([Click to view full-size image](user-based-authorization-cs/_static/image9.png))</span></span>

<span data-ttu-id="ca3a9-207">W tym momencie projekt może zawierać dwóch `Web.config` pliki: jeden w katalogu głównym, a drugi w `Membership` folderu.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-207">At this point your project should contain two `Web.config` files: one in the root directory and one in the `Membership` folder.</span></span>

<span data-ttu-id="ca3a9-208">[![Aplikacja powinna teraz zawierać dwóch plikach Web.config](user-based-authorization-cs/_static/image11.png)](user-based-authorization-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="ca3a9-208">[![Your Application Should Now Contain Two Web.config Files](user-based-authorization-cs/_static/image11.png)](user-based-authorization-cs/_static/image10.png)</span></span>

<span data-ttu-id="ca3a9-209">**Rysunek 4**: Usługi aplikacji powinny teraz zawierać dwa `Web.config` plików ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](user-based-authorization-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="ca3a9-209">**Figure 4**: Your Application Should Now Contain Two `Web.config` Files  ([Click to view full-size image](user-based-authorization-cs/_static/image12.png))</span></span>

<span data-ttu-id="ca3a9-210">Zaktualizuj plik konfiguracji w `Membership` folderu, tak że zabrania dostępu dla użytkowników anonimowych.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-210">Update the configuration file in the `Membership` folder so that it prohibits access to anonymous users.</span></span>

[!code-xml[Main](user-based-authorization-cs/samples/sample4.xml)]

<span data-ttu-id="ca3a9-211">To wszystko.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-211">That's all there is to it!</span></span>

<span data-ttu-id="ca3a9-212">W celu przetestowania tej zmiany, odwiedź stronę główną w przeglądarce i upewnij się, że zalogowano. Ponieważ domyślne zachowanie aplikacji ASP.NET jest umożliwienie wszystkich odwiedzających i firma Microsoft nie wprowadzać żadnych zmian autoryzacji katalog główny `Web.config` pliku, możemy znaleźć pliki w katalogu głównym jako użytkownik anonimowy.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-212">To test out this change, visit the homepage in a browser and make sure you are logged out. Since the default behavior of an ASP.NET application is to allow all visitors, and since we didn't make any authorization modifications to the root directory's `Web.config` file, we are able to visit the files in the root directory as an anonymous visitor.</span></span>

<span data-ttu-id="ca3a9-213">Kliknij link tworzenie kont użytkowników w lewej kolumnie.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-213">Click on the Creating User Accounts link found in the left column.</span></span> <span data-ttu-id="ca3a9-214">Spowoduje to przejście do `~/Membership/CreatingUserAccounts.aspx`.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-214">This will take you to the `~/Membership/CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="ca3a9-215">Ponieważ `Web.config` w pliku `Membership` folderu definiuje reguły autoryzacji, aby uniemożliwić dostęp anonimowy `UrlAuthorizationModule` anuluje żądanie i zwraca stan HTTP 401 nieautoryzowane.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-215">Since the `Web.config` file in the `Membership` folder defines authorization rules to prohibit anonymous access, the `UrlAuthorizationModule` aborts the request and returns an HTTP 401 Unauthorized status.</span></span> <span data-ttu-id="ca3a9-216">`FormsAuthenticationModule` Modyfikuje to 302 stan przekierowania przesyłania nam do strony logowania.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-216">The `FormsAuthenticationModule` modifies this to a 302 Redirect status, sending us to the login page.</span></span> <span data-ttu-id="ca3a9-217">Należy pamiętać, że strona możemy zostały próby uzyskania dostępu do (`CreatingUserAccounts.aspx`) jest przekazywana do strony logowania za pomocą `ReturnUrl` parametr querystring.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-217">Note that the page we were attempting to access (`CreatingUserAccounts.aspx`) is passed to the login page via the `ReturnUrl` querystring parameter.</span></span>

<span data-ttu-id="ca3a9-218">[![Ponieważ adres URL autoryzacji zasady Stanów Zjednoczonych zabraniają anonimowy dostęp firma Microsoft nastąpi przekierowanie do strony logowania](user-based-authorization-cs/_static/image14.png)](user-based-authorization-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="ca3a9-218">[![Since the URL Authorization Rules Prohibit Anonymous Access, We are Redirected to the Login Page](user-based-authorization-cs/_static/image14.png)](user-based-authorization-cs/_static/image13.png)</span></span>

<span data-ttu-id="ca3a9-219">**Rysunek 5**: Ponieważ adres URL autoryzacji zasady Stanów Zjednoczonych zabraniają anonimowy dostęp, firma Microsoft nastąpi przekierowanie do strony logowania ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](user-based-authorization-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="ca3a9-219">**Figure 5**: Since the URL Authorization Rules Prohibit Anonymous Access, We are Redirected to the Login Page  ([Click to view full-size image](user-based-authorization-cs/_static/image15.png))</span></span>

<span data-ttu-id="ca3a9-220">Po pomyślnym zalogowaniu możemy są przekierowywane do `CreatingUserAccounts.aspx` strony.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-220">Upon successfully logging in, we are redirected to the `CreatingUserAccounts.aspx` page.</span></span> <span data-ttu-id="ca3a9-221">Tym razem `UrlAuthorizationModule` zezwala na dostęp do tej strony, ponieważ firma Microsoft nie są już anonimowe.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-221">This time the `UrlAuthorizationModule` permits access to the page because we are no longer anonymous.</span></span>

### <a name="applying-url-authorization-rules-to-a-specific-location"></a><span data-ttu-id="ca3a9-222">Stosowanie reguł autoryzacji adresów URL do określonej lokalizacji</span><span class="sxs-lookup"><span data-stu-id="ca3a9-222">Applying URL Authorization Rules to a Specific Location</span></span>

<span data-ttu-id="ca3a9-223">Ustawienia autoryzacji zdefiniowane w `<system.web>` części `Web.config` mają zastosowanie do wszystkich zasobów platformy ASP.NET, w tym katalogu i jego podkatalogach (do momentu, w przeciwnym razie zastąpiona przez inną `Web.config` pliku).</span><span class="sxs-lookup"><span data-stu-id="ca3a9-223">The authorization settings defined in the `<system.web>` section of `Web.config` apply to all of the ASP.NET resources in that directory and its subdirectories (until otherwise overridden by another `Web.config` file).</span></span> <span data-ttu-id="ca3a9-224">W niektórych przypadkach jednak może chcemy wszystkich zasobów platformy ASP.NET w podanym katalogu konfiguracji określonego autoryzacji, z wyjątkiem jednego lub dwóch określonych stron.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-224">In some cases, though, we may want all ASP.NET resources in a given directory to have a particular authorization configuration except for one or two specific pages.</span></span> <span data-ttu-id="ca3a9-225">Można to osiągnąć przez dodanie `<location>` element `Web.config`, wskazując je do pliku, w której reguły autoryzacji różnią się i tam Definiowanie regułach autoryzacji unikatowy.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-225">This can be achieved by adding a `<location>` element in `Web.config`, pointing it to the file whose authorization rules differ, and defining its unique authorization rules therein.</span></span>

<span data-ttu-id="ca3a9-226">Aby zilustrować, za pomocą `<location>` elementu, aby zastąpić ustawienia konfiguracji dla określonego zasobu, możemy dostosować ustawienia autoryzacji, tak, aby odwiedzić tylko Tito `CreatingUserAccounts.aspx`.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-226">To illustrate using the `<location>` element to override the configuration settings for a specific resource, let's customize the authorization settings so that only Tito can visit `CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="ca3a9-227">Aby to zrobić, należy dodać `<location>` elementu `Membership` folderu `Web.config` pliku i zaktualizować jego znaczników wygląda podobnie do poniższego:</span><span class="sxs-lookup"><span data-stu-id="ca3a9-227">To accomplish this, add a `<location>` element to the `Membership` folder's `Web.config` file and update its markup so that it looks like the following:</span></span>

[!code-xml[Main](user-based-authorization-cs/samples/sample5.xml)]

<span data-ttu-id="ca3a9-228">`<authorization>` Element `<system.web>` definiuje reguły domyślny adres URL autoryzacji programu ASP.NET w `Membership` folderze i jego podfolderach.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-228">The `<authorization>` element in `<system.web>` defines the default URL authorization rules for ASP.NET resources in the `Membership` folder and its subfolders.</span></span> <span data-ttu-id="ca3a9-229">`<location>` Elementu pozwala zastąpić te reguły dla określonego zasobu.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-229">The `<location>` element allows us to override these rules for a particular resource.</span></span> <span data-ttu-id="ca3a9-230">W powyższym znaczników `<location>` odwołania do elementu `CreatingUserAccounts.aspx` strony i określa jej autoryzacji reguł pozwalać Tito, ale Odmów inne osoby.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-230">In the above markup the `<location>` element references the `CreatingUserAccounts.aspx` page and specifies its authorization rules such as to allow Tito, but deny everyone else.</span></span>

<span data-ttu-id="ca3a9-231">W celu przetestowania tej zmiany autoryzacji, należy uruchomić, odwiedzając witrynę sieci Web jako użytkownik anonimowy.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-231">To test out this authorization change, start by visiting the website as an anonymous user.</span></span> <span data-ttu-id="ca3a9-232">Jeśli użytkownik podejmie próbę stronę w `Membership` folderu, takich jak `UserBasedAuthorization.aspx`, `UrlAuthorizationModule` odmówi żądania i nastąpi przekierowanie do strony logowania.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-232">If you attempt to visit any page in the `Membership` folder, such as `UserBasedAuthorization.aspx`, the `UrlAuthorizationModule` will deny the request and you will be redirected to the login page.</span></span> <span data-ttu-id="ca3a9-233">Po zalogowaniu się jako powiedzieć, Scott, możesz odwiedzić stronę dowolnej stronie w `Membership` folderu *z wyjątkiem* dla `CreatingUserAccounts.aspx`.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-233">After logging in as, say, Scott, you can visit any page in the `Membership` folder *except* for `CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="ca3a9-234">Podjęto próbę odwiedź `CreatingUserAccounts.aspx` zalogować się jako każda osoba, ale Tito spowoduje podjęto próbę nieautoryzowanego dostępu, przekierowywanie do strony logowania.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-234">Attempting to visit `CreatingUserAccounts.aspx` logged on as anyone but Tito will result in an unauthorized access attempt, redirecting you back to the login page.</span></span>

> [!NOTE]
> <span data-ttu-id="ca3a9-235">`<location>` Element musi znajdować się poza konfiguracji `<system.web>` elementu.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-235">The `<location>` element must appear outside of the configuration's `<system.web>` element.</span></span> <span data-ttu-id="ca3a9-236">Należy użyć oddzielnego `<location>` elementu dla każdego zasobu, którego ustawienia autoryzacji, które chcesz zastąpić.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-236">You need to use a separate `<location>` element for each resource whose authorization settings you want to override.</span></span>

### <a name="a-look-at-how-theurlauthorizationmoduleuses-the-authorization-rules-to-grant-or-deny-access"></a><span data-ttu-id="ca3a9-237">Jak się`UrlAuthorizationModule`udzielić lub odmówić dostępu przy użyciu reguł autoryzacji</span><span class="sxs-lookup"><span data-stu-id="ca3a9-237">A Look at How the`UrlAuthorizationModule`Uses the Authorization Rules to Grant or Deny Access</span></span>

<span data-ttu-id="ca3a9-238">`UrlAuthorizationModule` Określa, czy do autoryzowania określonej tożsamości dla określonego adresu URL, analizując Autoryzacja adresów URL reguły pojedynczo, zaczynając od pierwszego i pracą z nimi drodze w dół.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-238">The `UrlAuthorizationModule` determines whether to authorize a particular identity for a particular URL by analyzing the URL authorization rules one at a time, starting from the first one and working its way down.</span></span> <span data-ttu-id="ca3a9-239">Gdy tylko zostanie znalezione dopasowanie, użytkownik jest udzielić lub odmówić dostępu, w zależności od jeśli dopasowanie został znaleziony w `<allow>` lub `<deny>` elementu.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-239">As soon as a match is found, the user is granted or denied access, depending on if the match was found in an `<allow>` or `<deny>` element.</span></span> <span data-ttu-id="ca3a9-240"><strong>Jeśli nie zostanie znalezione dopasowanie, użytkownik uzyskuje dostęp.</strong></span><span class="sxs-lookup"><span data-stu-id="ca3a9-240"><strong>If no match is found, the user is granted access.</strong></span></span> <span data-ttu-id="ca3a9-241">W związku z tym, jeśli chcesz ograniczyć dostęp, jest użycie `<deny>` element jako po ostatnim elemencie w konfiguracji autoryzacja adresu URL.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-241">Consequently, if you want to restrict access, it is imperative that you use a `<deny>` element as the last element in the URL authorization configuration.</span></span> <span data-ttu-id="ca3a9-242"><strong>Jeżeli pominięto</strong><strong>`<deny>`</strong><strong>elementu, wszyscy użytkownicy zostanie przyznany dostęp.</strong></span><span class="sxs-lookup"><span data-stu-id="ca3a9-242"><strong>If you omit a</strong><strong>`<deny>`</strong><strong>element, all users will be granted access.</strong></span></span>

<span data-ttu-id="ca3a9-243">Aby lepiej zrozumieć proces wykorzystywany przez `UrlAuthorizationModule` ustalenie urząd, rozważ przykład reguły autoryzacji adresów URL przyjrzeliśmy się wcześniej w tym kroku.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-243">To better understand the process used by the `UrlAuthorizationModule` to determine authority, consider the example URL authorization rules we looked at earlier in this step.</span></span> <span data-ttu-id="ca3a9-244">Pierwsza reguła jest `<allow>` element, który umożliwia dostęp do Tito i Scott.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-244">The first rule is an `<allow>` element that allows access to Tito and Scott.</span></span> <span data-ttu-id="ca3a9-245">To drugie zasady `<deny>` element, który nie zezwala na dostęp do wszystkich użytkowników.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-245">The second rules is a `<deny>` element that denies access to everyone.</span></span> <span data-ttu-id="ca3a9-246">Jeśli użytkownik anonimowy odwiedza, `UrlAuthorizationModule` rozpoczyna się, zadając jest anonimowa Scott lub Tito?</span><span class="sxs-lookup"><span data-stu-id="ca3a9-246">If an anonymous user visits, the `UrlAuthorizationModule` starts by asking, Is anonymous either Scott or Tito?</span></span> <span data-ttu-id="ca3a9-247">Odpowiedź na pytanie, jest oczywiście nie, więc rozpoczynające się od drugiej reguły.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-247">The answer, obviously, is No, so it proceeds to the second rule.</span></span> <span data-ttu-id="ca3a9-248">Jest anonimowa w zestawie wszyscy?</span><span class="sxs-lookup"><span data-stu-id="ca3a9-248">Is anonymous in the set of everybody?</span></span> <span data-ttu-id="ca3a9-249">Od czasu odpowiedzi w tym miejscu jest tak, `<deny>` reguły jest umieszczany w mocy i użytkownik jest przekierowywany do strony logowania.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-249">Since the answer here is Yes, the `<deny>` rule is put in effect and the visitor is redirected to the login page.</span></span> <span data-ttu-id="ca3a9-250">Podobnie, jeśli odwiedzania Jisun `UrlAuthorizationModule` rozpoczyna się, zadając Jisun jest Scott lub Tito?</span><span class="sxs-lookup"><span data-stu-id="ca3a9-250">Similarly, if Jisun is visiting, the `UrlAuthorizationModule` starts by asking, Is Jisun either Scott or Tito?</span></span> <span data-ttu-id="ca3a9-251">Ponieważ ona jest, `UrlAuthorizationModule` przechodzi na drugie pytanie jest Jisun w zestawie wszyscy?</span><span class="sxs-lookup"><span data-stu-id="ca3a9-251">Since she is not, the `UrlAuthorizationModule` proceeds to the second question, Is Jisun in the set of everybody?</span></span> <span data-ttu-id="ca3a9-252">Marcela jest tak, jest ona, odmowa dostępu.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-252">She is, so she, too, is denied access.</span></span> <span data-ttu-id="ca3a9-253">Ponadto jeśli Tito odwiedza, pierwsze pytanie powodowane `UrlAuthorizationModule` jest twierdząca odpowiedzi, więc Tito udzielany jest dostęp.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-253">Finally, if Tito visits, the first question posed by the `UrlAuthorizationModule` is an affirmative answer, so Tito is granted access.</span></span>

<span data-ttu-id="ca3a9-254">Ponieważ `UrlAuthorizationModule` reguły autoryzacji od góry do dołu zatrzymywanie u jakiegokolwiek dopasowania jest istotne dla bardziej szczegółowych reguł występować przed mniej konkretnych te procesy.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-254">Since the `UrlAuthorizationModule` processes the authorization rules from the top down, stopping at any match, it is important to have the more specific rules come before the less specific ones.</span></span> <span data-ttu-id="ca3a9-255">Oznacza to aby zdefiniować reguły autoryzacji, które może zabronić Jisun i użytkowników anonimowych, ale zezwala na wszystkie inne uwierzytelnionych użytkowników, można będzie rozpoczynać się najbardziej specyficzne reguły — jeden Jisun mogących mieć wpływ na — a następnie przejdź do reguły specyficzne dla języka less - tych, dzięki czemu wszystkie inne uwierzytelnieni użytkownicy, ale wszyscy użytkownicy anonimowi odmowy.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-255">That is, to define authorization rules that forbid Jisun and anonymous users, but allow all other authenticated users, you would start with the most specific rule - the one impacting Jisun - and then proceed to the less specific rules - those allowing all other authenticated users, but denying all anonymous users.</span></span> <span data-ttu-id="ca3a9-256">Następujące reguły autoryzacji adresów URL implementuje te zasady, najpierw odmawianie Jisun i następnie odmawiając każdy użytkownik anonimowy.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-256">The following URL authorization rules implements this policy by first denying Jisun, and then denying any anonymous user.</span></span> <span data-ttu-id="ca3a9-257">Każdy uwierzytelniony użytkownik innych niż Jisun zostanie przyznany dostęp ponieważ żadnej z tych metod `<deny>` instrukcji będą zgodne.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-257">Any authenticated user other than Jisun will be granted access because neither of these `<deny>` statements will match.</span></span>

[!code-xml[Main](user-based-authorization-cs/samples/sample6.xml)]

## <a name="step-2-fixing-the-workflow-for-unauthorized-authenticated-users"></a><span data-ttu-id="ca3a9-258">Krok 2. Naprawianie przepływu pracy dla nieautoryzowanych, uwierzytelnionych użytkowników</span><span class="sxs-lookup"><span data-stu-id="ca3a9-258">Step 2: Fixing the Workflow for Unauthorized, Authenticated Users</span></span>

<span data-ttu-id="ca3a9-259">Jak wspomniano wcześniej w tym samouczku w Przyjrzyj się w sekcji przepływu pracy autoryzacji adresów URL dowolnym techniczną nieautoryzowanego żądania, `UrlAuthorizationModule` anuluje żądanie i zwraca stan HTTP 401 nieautoryzowane.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-259">As we discussed earlier in this tutorial in the A Look at the URL Authorization Workflow section, anytime an unauthorized request transpires, the `UrlAuthorizationModule` aborts the request and returns an HTTP 401 Unauthorized status.</span></span> <span data-ttu-id="ca3a9-260">Tego stanu 401 jest modyfikowany przez `FormsAuthenticationModule` do 302 przekierowania stan, który wysyła użytkownika do strony logowania.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-260">This 401 status is modified by the `FormsAuthenticationModule` into a 302 Redirect status that sends the user to the login page.</span></span> <span data-ttu-id="ca3a9-261">Ten przepływ pracy jest wykonywana zgodnie z dowolnym nieautoryzowanego żądania, nawet wtedy, gdy użytkownik jest uwierzytelniony.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-261">This workflow occurs on any unauthorized request, even if the user is authenticated.</span></span>

<span data-ttu-id="ca3a9-262">Zwracanie uwierzytelnionego użytkownika do strony logowania jest prawdopodobne, należy go mylić je, ponieważ mają one już zarejestrowanych w systemie.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-262">Returning an authenticated user to the login page is likely to confuse them since they have already logged into the system.</span></span> <span data-ttu-id="ca3a9-263">Za pomocą trochę więcej pracy można ulepszyć ten przepływ pracy, przekierowując uwierzytelnionych użytkowników, którzy tworzą nieautoryzowanych żądań do strony, który objaśnia, że będą oni próbowali dostęp do strony.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-263">With a little bit of work we can improve this workflow by redirecting authenticated users who make unauthorized requests to a page that explains that they have attempted to access a restricted page.</span></span>

<span data-ttu-id="ca3a9-264">Rozpocznij od utworzenia nowej strony programu ASP.NET w folderze głównym aplikacji sieci web o nazwie `UnauthorizedAccess.aspx`; nie należy zapominać skojarzyć tę stronę przy użyciu `Site.master` strony wzorcowej.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-264">Start by creating a new ASP.NET page in the web application's root folder named `UnauthorizedAccess.aspx`; don't forget to associate this page with the `Site.master` master page.</span></span> <span data-ttu-id="ca3a9-265">Po utworzeniu tej strony, należy usunąć formant zawartości, który odwołuje się do `LoginContent` ContentPlaceHolder tak, aby domyślna zawartości strony wzorcowej będą wyświetlane.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-265">After creating this page, remove the Content control that references the `LoginContent` ContentPlaceHolder so that the master page's default content will be displayed.</span></span> <span data-ttu-id="ca3a9-266">Następnie dodaj komunikat wyjaśniający sytuacji, a mianowicie użytkownik próbował uzyskać dostęp do chronionego zasobu.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-266">Next, add a message that explains the situation, namely that the user attempted to access a protected resource.</span></span> <span data-ttu-id="ca3a9-267">Po dodaniu takiego komunikatu `UnauthorizedAccess.aspx` oznaczeniu deklaracyjnym strony powinien wyglądać podobnie do poniższego:</span><span class="sxs-lookup"><span data-stu-id="ca3a9-267">After adding such a message, the `UnauthorizedAccess.aspx` page's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](user-based-authorization-cs/samples/sample7.aspx)]

<span data-ttu-id="ca3a9-268">Teraz musisz zmienić przepływ pracy, dlatego, że jeśli nieautoryzowanego żądania odbywa się przez uwierzytelnionego użytkownika są wysyłane do `UnauthorizedAccess.aspx` strony, a nie na stronie logowania.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-268">We now need to alter the workflow so that if an unauthorized request is performed by an authenticated user they are sent to the `UnauthorizedAccess.aspx` page instead of the login page.</span></span> <span data-ttu-id="ca3a9-269">Logikę, która wykonuje przekierowanie nieautoryzowanych żądań do strony logowania jest ukryty w ramach prywatnej metody `FormsAuthenticationModule` klasy, dzięki czemu firma Microsoft nie można dostosować to zachowanie.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-269">The logic that redirects unauthorized requests to the login page is buried within a private method of the `FormsAuthenticationModule` class, so we cannot customize this behavior.</span></span> <span data-ttu-id="ca3a9-270">Co możemy zrobić, jednak jest dodać własną logikę do strony logowania, który przekierowuje użytkownika do `UnauthorizedAccess.aspx`, jeśli to konieczne.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-270">What we can do, however, is add our own logic to the login page that redirects the user to `UnauthorizedAccess.aspx`, if needed.</span></span>

<span data-ttu-id="ca3a9-271">Gdy `FormsAuthenticationModule` przekierowuje nieautoryzowane osoby odwiedzającej do strony logowania dołącza adres URL żądanego, nieautoryzowanego querystring o nazwie `ReturnUrl`.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-271">When the `FormsAuthenticationModule` redirects an unauthorized visitor to the login page it appends the requested, unauthorized URL to the querystring with the name `ReturnUrl`.</span></span> <span data-ttu-id="ca3a9-272">Na przykład, jeśli nieautoryzowany użytkownik próbował odwiedź `OnlyTito.aspx`, `FormsAuthenticationModule` będzie przekierowywać je do `Login.aspx?ReturnUrl=OnlyTito.aspx`.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-272">For example, if an unauthorized user attempted to visit `OnlyTito.aspx`, the `FormsAuthenticationModule` would redirect them to `Login.aspx?ReturnUrl=OnlyTito.aspx`.</span></span> <span data-ttu-id="ca3a9-273">W związku z tym jeśli strony logowania zostanie osiągnięty przez uwierzytelnionego użytkownika przy użyciu ciągu kwerendy, która obejmuje `ReturnUrl` parametru, a następnie możemy wiedzieć, czy ten nieuwierzytelniony użytkownik po prostu próbował odwiedzenia strony, użytkownik nie ma uprawnień do wyświetlenia.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-273">Therefore, if the login page is reached by an authenticated user with a querystring that includes the `ReturnUrl` parameter, then we know that this unauthenticated user just attempted to visit a page she is not authorized to view.</span></span> <span data-ttu-id="ca3a9-274">W takim przypadku chcemy przekierować jej `UnauthorizedAccess.aspx`.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-274">In such a case, we want to redirect her to `UnauthorizedAccess.aspx`.</span></span>

<span data-ttu-id="ca3a9-275">Aby to zrobić, Dodaj następujący kod do strony logowania `Page_Load` program obsługi zdarzeń:</span><span class="sxs-lookup"><span data-stu-id="ca3a9-275">To accomplish this, add the following code to the login page's `Page_Load` event handler:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample8.cs)]

<span data-ttu-id="ca3a9-276">Powyższy kod przekierowuje uwierzytelnionego, nieautoryzowanym użytkownikom `UnauthorizedAccess.aspx` strony.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-276">The above code redirects authenticated, unauthorized users to the `UnauthorizedAccess.aspx` page.</span></span> <span data-ttu-id="ca3a9-277">Aby wyświetlić tę logikę w działaniu, odwiedź witrynę jako użytkownik anonimowy i kliknij łącze tworzenie kont użytkowników w lewej kolumnie.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-277">To see this logic in action, visit the site as an anonymous visitor and click on the Creating User Accounts link in the left column.</span></span> <span data-ttu-id="ca3a9-278">Spowoduje to przejście do `~/Membership/CreatingUserAccounts.aspx` strony, która w kroku 1, firma Microsoft skonfigurowany wyłącznie w celu zezwolenia na dostęp do Tito.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-278">This will take you to the `~/Membership/CreatingUserAccounts.aspx` page, which in Step 1 we configured to only permit access to Tito.</span></span> <span data-ttu-id="ca3a9-279">Ponieważ użytkownicy anonimowi są niedozwolone, `FormsAuthenticationModule` przekierowuje nam powrót do strony logowania.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-279">Since anonymous users are prohibited, the `FormsAuthenticationModule` redirects us back to the login page.</span></span>

<span data-ttu-id="ca3a9-280">W tym momencie możemy anonimowe, więc `Request.IsAuthenticated` zwraca `false` i firma Microsoft nie nastąpi przekierowanie do `UnauthorizedAccess.aspx`.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-280">At this point we are anonymous, so `Request.IsAuthenticated` returns `false` and we are not redirected to `UnauthorizedAccess.aspx`.</span></span> <span data-ttu-id="ca3a9-281">Zamiast tego zostanie wyświetlona strona logowania.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-281">Instead, the login page is displayed.</span></span> <span data-ttu-id="ca3a9-282">Zaloguj się jako użytkownik inny niż Tito, takich jak Bruce.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-282">Log in as a user other than Tito, such as Bruce.</span></span> <span data-ttu-id="ca3a9-283">Po wprowadzeniu odpowiednimi poświadczeniami, logowania stronie przekierowuje nam z powrotem do `~/Membership/CreatingUserAccounts.aspx`.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-283">After entering the appropriate credentials, the login page redirects us back to `~/Membership/CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="ca3a9-284">Jednak ponieważ ta strona jest dostępna wyłącznie dla Tito, firma Microsoft jest brak autoryzacji do wyświetlania go i niezwłocznie powrót do strony logowania.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-284">However, since this page is only accessible to Tito, we are unauthorized to view it and are promptly returned to the login page.</span></span> <span data-ttu-id="ca3a9-285">Tym razem jednak `Request.IsAuthenticated` zwraca `true` (i `ReturnUrl` parametr querystring istnieje), dzięki czemu możemy są przekierowywane do `UnauthorizedAccess.aspx` strony.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-285">This time, however, `Request.IsAuthenticated` returns `true` (and the `ReturnUrl` querystring parameter exists), so we are redirected to the `UnauthorizedAccess.aspx` page.</span></span>

<span data-ttu-id="ca3a9-286">[![Uwierzytelniony, nieautoryzowani użytkownicy są przekierowywane do UnauthorizedAccess.aspx](user-based-authorization-cs/_static/image17.png)](user-based-authorization-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="ca3a9-286">[![Authenticated, Unauthorized Users are Redirected to UnauthorizedAccess.aspx](user-based-authorization-cs/_static/image17.png)](user-based-authorization-cs/_static/image16.png)</span></span>

<span data-ttu-id="ca3a9-287">**Rysunek 6**: Uwierzytelniony, nieautoryzowani użytkownicy są przekierowywane do `UnauthorizedAccess.aspx` ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](user-based-authorization-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="ca3a9-287">**Figure 6**: Authenticated, Unauthorized Users are Redirected to `UnauthorizedAccess.aspx` ([Click to view full-size image](user-based-authorization-cs/_static/image18.png))</span></span>

<span data-ttu-id="ca3a9-288">Ten przepływ dostosowane przedstawia bardziej rozsądne i proste środowisko użytkownika przez krótki circuiting cyklu przedstawiona na rysunku 2.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-288">This customized workflow presents a more sensible and straightforward user experience by short circuiting the cycle depicted in Figure 2.</span></span>

## <a name="step-3-limiting-functionality-based-on-the-currently-logged-in-user"></a><span data-ttu-id="ca3a9-289">Krok 3. Ograniczanie funkcji, w oparciu o aktualnie zalogowanego użytkownika</span><span class="sxs-lookup"><span data-stu-id="ca3a9-289">Step 3: Limiting Functionality Based on the Currently Logged In User</span></span>

<span data-ttu-id="ca3a9-290">Autoryzacja adresów URL ułatwia określenie reguł autoryzacji zdalnego.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-290">URL authorization makes it easy to specify coarse authorization rules.</span></span> <span data-ttu-id="ca3a9-291">Jak widzieliśmy w kroku 1, przy użyciu Autoryzacja adresów URL firma Microsoft może krótkiej formie stanu tożsamości, które są dozwolone, oraz te, które są zabronione możliwości wyświetlenia określonej strony lub wszystkich stron w folderze.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-291">As we saw in Step 1, with URL authorization we can succinctly state what identities are permitted and which ones are denied from viewing a particular page or all pages in a folder.</span></span> <span data-ttu-id="ca3a9-292">W niektórych scenariuszach jednak może chcemy zezwala wszystkim użytkownikom na stronę, ale ograniczenia funkcji strony, na podstawie użytkownika, odwiedzając go.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-292">In certain scenarios, however, we may want to allow all users to visit a page, but limit the page's functionality based on the user visiting it.</span></span>

<span data-ttu-id="ca3a9-293">Należy wziąć pod uwagę wielkość liter w witrynie sieci Web handlu elektronicznego, który umożliwia uwierzytelnionym Przejrzyj ich produktów.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-293">Consider the case of an eCommerce website that allows authenticated visitors to review their products.</span></span> <span data-ttu-id="ca3a9-294">Anonimowy użytkownik odwiedzi stronę produktu, widział tylko informacje o produkcie i może nie mieć możliwość przesyłali recenzje.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-294">When an anonymous user visits a product's page, they would see just the product information and would not be given the opportunity to leave a review.</span></span> <span data-ttu-id="ca3a9-295">Jednak uwierzytelnionego użytkownika, odwiedzając stronę tego samego widział recenzowania interfejsu.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-295">However, an authenticated user visiting the same page would see the reviewing interface.</span></span> <span data-ttu-id="ca3a9-296">Uwierzytelniony użytkownik nie ma jeszcze przejrzane tego produktu, interfejsu umożliwia im recenzje; w przeciwnym razie spowoduje to pokazanie ich ich wcześniej przesłanych przeglądu.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-296">If the authenticated user had not yet reviewed this product, the interface would enable them to submit a review; otherwise it would show them their previously-submitted review.</span></span> <span data-ttu-id="ca3a9-297">Aby móc w tym scenariuszu krok dalej, stronę produktu może zawiera dodatkowe informacje i oferują rozszerzone funkcje dla tych użytkowników, którzy pracują dla firmy handlu elektronicznego.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-297">To take this scenario a step further, the product page might show additional information and offer extended features for those users that work for the eCommerce company.</span></span> <span data-ttu-id="ca3a9-298">Na przykład stronę produktu może być lista spisu w magazynie i obejmują opcje, aby edytować opis po odwiedzeniu przez pracownika i cena produktu.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-298">For example, the product page might list the inventory in stock and include options to edit the product's price and description when visited by an employee.</span></span>

<span data-ttu-id="ca3a9-299">Takie zasady autoryzacji szczegółową można zaimplementować deklaratywne lub programowo (lub za pomocą kombinacji obu).</span><span class="sxs-lookup"><span data-stu-id="ca3a9-299">Such fine grain authorization rules can be implemented either declaratively or programmatically (or through some combination of the two).</span></span> <span data-ttu-id="ca3a9-300">W następnej sekcji Zobaczymy się, jak zaimplementować szczegółowej autoryzacji za pomocą kontrolki widoku logowania.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-300">In the next section we will see how to implement fine grain authorization via the LoginView control.</span></span> <span data-ttu-id="ca3a9-301">Poniżej omówimy techniki programistyczne.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-301">Following that, we will explore programmatic techniques.</span></span> <span data-ttu-id="ca3a9-302">Przed można przyjrzymy się stosowanie reguł autoryzacji szczegółową, jednak najpierw należy utworzyć stronę, na których funkcji zależy od użytkownika, odwiedzając go.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-302">Before we can look at applying fine grain authorization rules, however, we first need to create a page whose functionality depends on the user visiting it.</span></span>

<span data-ttu-id="ca3a9-303">Utwórzmy strona, która wyświetla listę plików w katalogu określonym w ramach GridView.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-303">Let's create a page that lists the files in a particular directory within a GridView.</span></span> <span data-ttu-id="ca3a9-304">Wraz z listą nazwę każdego pliku, rozmiar i inne informacje, widoku GridView będzie zawierać dwie kolumny LinkButtons: jeden pod tytułem widoku i jeden zatytułowanym Delete.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-304">Along with listing each file's name, size, and other information, the GridView will include two columns of LinkButtons: one titled View and one titled Delete.</span></span> <span data-ttu-id="ca3a9-305">Jeśli kliknięto element LinkButton widoku zostanie wyświetlona zawartość wybranego pliku; Usuń element LinkButton po kliknięciu pliku zostaną usunięte.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-305">If the View LinkButton is clicked, the contents of the selected file will be displayed; if the Delete LinkButton is clicked, the file will be deleted.</span></span> <span data-ttu-id="ca3a9-306">Początkowo Utwórzmy na tej stronie taki sposób, że jej widok funkcji i usuwania, jest dostępna dla wszystkich użytkowników.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-306">Let's initially create this page such that its view and delete functionality is available to all users.</span></span> <span data-ttu-id="ca3a9-307">W używanie kontrolki widoku logowania i programowo Ograniczanie funkcjonalności sekcje należy sprawdzić, jak włączyć lub wyłączyć te funkcje, na podstawie użytkownika, odwiedzając stronę.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-307">In the Using the LoginView Control and Programmatically Limiting Functionality sections we will see how to enable or disable these features based on the user visiting the page.</span></span>

> [!NOTE]
> <span data-ttu-id="ca3a9-308">Strony ASP.NET, który będziemy tworzyć używa kontrolki widoku siatki, aby wyświetlić listę plików.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-308">The ASP.NET page we are about to build uses a GridView control to display a list of files.</span></span> <span data-ttu-id="ca3a9-309">Ponieważ ten samouczek, który seria skupia się na uwierzytelnianie formularzy, autoryzacji, konta użytkowników i ról nie chcę poświęcać zbyt dużo czasu, omawiając przebiega w kontrolce GridView.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-309">Since this tutorial series focuses on forms authentication, authorization, user accounts, and roles, I do not want to spend too much time discussing the inner workings of the GridView control.</span></span> <span data-ttu-id="ca3a9-310">Chociaż ten samouczek zawiera określone instrukcje krok po kroku dotyczące konfigurowania tej strony, nie delve szczegóły Dlaczego wprowadzono niektórych opcji, lub w wyniku renderowania posiadane szczególne właściwości efektu.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-310">While this tutorial provides specific step-by-step instructions for setting up this page, it does not delve into the details of why certain choices were made, or what effect particular properties have on the rendered output.</span></span> <span data-ttu-id="ca3a9-311">Dla głębszego zbadania kontrolki GridView, zapoznaj się z moich *[Praca z danymi w programie ASP.NET 2.0](../../data-access/index.md)* serii samouczków.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-311">For a thorough examination of the GridView control, consult my *[Working with Data in ASP.NET 2.0](../../data-access/index.md)* tutorial series.</span></span>

<span data-ttu-id="ca3a9-312">Zacznij od otwarcia `UserBasedAuthorization.aspx` w pliku `Membership` folderu i dodaniu kontrolki widoku siatki do strony o nazwie `FilesGrid`.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-312">Start by opening the `UserBasedAuthorization.aspx` file in the `Membership` folder and adding a GridView control to the page named `FilesGrid`.</span></span> <span data-ttu-id="ca3a9-313">W widoku GridView tagu inteligentnego kliknij łącze Edytowanie kolumn, aby uruchomić okno dialogowe pól.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-313">From the GridView's Smart Tag, click the Edit Columns link to launch the Fields dialog box.</span></span> <span data-ttu-id="ca3a9-314">W tym miejscu należy usunąć zaznaczenie pola wyboru pól automatycznego generowania, w lewym dolnym rogu.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-314">From here, uncheck the Auto-generate fields checkbox in the lower left corner.</span></span> <span data-ttu-id="ca3a9-315">Następnie dodaj przycisk wyboru, przycisk Usuń i BoundFields dwa w lewym górnym rogu (przyciski Wybierz i usuwania można znaleźć w obszarze Typ CommandField).</span><span class="sxs-lookup"><span data-stu-id="ca3a9-315">Next, add a Select button, a Delete button, and two BoundFields from the upper left corner (the Select and Delete buttons can be found under the CommandField type).</span></span> <span data-ttu-id="ca3a9-316">Wybierz przycisk Ustaw `SelectText` właściwości widoku i elementu pierwszy BoundField `HeaderText` i `DataField` właściwości nazwy.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-316">Set the Select button's `SelectText` property to View and the first BoundField's `HeaderText` and `DataField` properties to Name.</span></span> <span data-ttu-id="ca3a9-317">Ustaw drugiego elementu BoundField `HeaderText` właściwość rozmiar w bajtach, jego `DataField` właściwości długości, jego `DataFormatString` właściwości {0:N0} i jego `HtmlEncode` wartość False dla właściwości.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-317">Set the second BoundField's `HeaderText` property to Size in Bytes, its `DataField` property to Length, its `DataFormatString` property to {0:N0} and its `HtmlEncode` property to False.</span></span>

<span data-ttu-id="ca3a9-318">Po skonfigurowaniu kolumn GridView, kliknij przycisk OK, aby zamknąć okno dialogowe pól.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-318">After configuring the GridView's columns, click OK to close the Fields dialog box.</span></span> <span data-ttu-id="ca3a9-319">W oknie właściwości ustaw GridView `DataKeyNames` właściwość `FullName`.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-319">From the Properties window, set the GridView's `DataKeyNames` property to `FullName`.</span></span> <span data-ttu-id="ca3a9-320">W tym momencie oznaczeniu deklaracyjnym GridView powinien wyglądać następująco:</span><span class="sxs-lookup"><span data-stu-id="ca3a9-320">At this point the GridView's declarative markup should look like the following:</span></span>

[!code-aspx[Main](user-based-authorization-cs/samples/sample9.aspx)]

<span data-ttu-id="ca3a9-321">Za pomocą znaczników GridView utworzone firma Microsoft przystąpić do pisania kodu, który pobierze pliki w określonym katalogu i wiązania ich z kontrolki GridView.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-321">With the GridView's markup created, we're ready to write the code that will retrieve the files in a particular directory and bind them to the GridView.</span></span> <span data-ttu-id="ca3a9-322">Dodaj następujący kod na stronę `Page_Load` program obsługi zdarzeń:</span><span class="sxs-lookup"><span data-stu-id="ca3a9-322">Add the following code to the page's `Page_Load` event handler:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample10.cs)]

<span data-ttu-id="ca3a9-323">Powyższy kod używa [ `DirectoryInfo` klasy](https://msdn.microsoft.com/library/system.io.directoryinfo.aspx) Aby uzyskać listę plików w folderze głównym.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-323">The above code uses the [`DirectoryInfo` class](https://msdn.microsoft.com/library/system.io.directoryinfo.aspx) to obtain a list of the files in the application's root folder.</span></span> <span data-ttu-id="ca3a9-324">[ `GetFiles()` Metoda](https://msdn.microsoft.com/library/system.io.directoryinfo.getfiles.aspx) zwraca wszystkie pliki w katalogu jako tablica [ `FileInfo` obiektów](https://msdn.microsoft.com/library/system.io.fileinfo.aspx), który następnie jest powiązany z kontrolki GridView.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-324">The [`GetFiles()` method](https://msdn.microsoft.com/library/system.io.directoryinfo.getfiles.aspx) returns all of the files in the directory as an array of [`FileInfo` objects](https://msdn.microsoft.com/library/system.io.fileinfo.aspx), which is then bound to the GridView.</span></span> <span data-ttu-id="ca3a9-325">`FileInfo` Obiekt ma pewną liczbę właściwości, takie jak `Name`, `Length`, i `IsReadOnly`, między innymi.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-325">The `FileInfo` object has an assortment of properties, such as `Name`, `Length`, and `IsReadOnly`, among others.</span></span> <span data-ttu-id="ca3a9-326">Jak widać w jego oznaczeniu deklaracyjnym widoku GridView po prostu wyświetla `Name` i `Length` właściwości.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-326">As you can see from its declarative markup, the GridView displays just the `Name` and `Length` properties.</span></span>

> [!NOTE]
> <span data-ttu-id="ca3a9-327">`DirectoryInfo` i `FileInfo` klasy znajdują się w [ `System.IO` przestrzeni nazw](https://msdn.microsoft.com/library/system.io.aspx).</span><span class="sxs-lookup"><span data-stu-id="ca3a9-327">The `DirectoryInfo` and `FileInfo` classes are found in the [`System.IO` namespace](https://msdn.microsoft.com/library/system.io.aspx).</span></span> <span data-ttu-id="ca3a9-328">W związku z tym, będzie muszą poprzedzony nazwy klas z ich nazwami przestrzeni nazw lub mają zaimportowane do pliku klasy przestrzeni nazw (za pośrednictwem `using System.IO`).</span><span class="sxs-lookup"><span data-stu-id="ca3a9-328">Therefore, you will either need to preface these class names with their namespace names or have the namespace imported into the class file (via `using System.IO`).</span></span>

<span data-ttu-id="ca3a9-329">Poświęć chwilę, aby odwiedzić tę stronę za pośrednictwem przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-329">Take a moment to visit this page through a browser.</span></span> <span data-ttu-id="ca3a9-330">Wyświetli listę plików znajdujących się w katalogu głównym aplikacji.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-330">It will display the list of files residing in the application's root directory.</span></span> <span data-ttu-id="ca3a9-331">Wyświetl lub usuń LinkButtons kliknięcie spowoduje odświeżenie strony, ale żadna akcja będzie być fakt, że zostały wykonane następujące kroki jeszcze do tworzenie obsługi zdarzeń wymagane.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-331">Clicking any of the View or Delete LinkButtons will cause a postback, but no action will occur because we've yet to create the necessary event handlers.</span></span>

<span data-ttu-id="ca3a9-332">[![Kontrolki GridView Wyświetla listę plików w katalogu głównym aplikacji sieci Web](user-based-authorization-cs/_static/image20.png)](user-based-authorization-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="ca3a9-332">[![The GridView Lists the Files in the Web Application's Root Directory](user-based-authorization-cs/_static/image20.png)](user-based-authorization-cs/_static/image19.png)</span></span>

<span data-ttu-id="ca3a9-333">**Rysunek 7**: Kontrolki GridView Wyświetla listę plików w katalogu głównym aplikacji sieci Web ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](user-based-authorization-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="ca3a9-333">**Figure 7**: The GridView Lists the Files in the Web Application's Root Directory  ([Click to view full-size image](user-based-authorization-cs/_static/image21.png))</span></span>

<span data-ttu-id="ca3a9-334">Potrzebujemy sposób, aby wyświetlić zawartość wybranego pliku.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-334">We need a means to display the contents of the selected file.</span></span> <span data-ttu-id="ca3a9-335">Wróć do programu Visual Studio i Dodaj pole tekstowe o nazwie `FileContents` powyżej widoku GridView.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-335">Return to Visual Studio and add a TextBox named `FileContents` above the GridView.</span></span> <span data-ttu-id="ca3a9-336">Ustaw jego `TextMode` właściwości `MultiLine` i jego `Columns` i `Rows` właściwości do 95% i 10, odpowiednio.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-336">Set its `TextMode` property to `MultiLine` and its `Columns` and `Rows` properties to 95% and 10, respectively.</span></span>

[!code-aspx[Main](user-based-authorization-cs/samples/sample11.aspx)]

<span data-ttu-id="ca3a9-337">Następnie należy utworzyć procedurę obsługi zdarzeń dla GridView [ `SelectedIndexChanged` zdarzeń](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.selectedindexchanged.aspx) i Dodaj następujący kod:</span><span class="sxs-lookup"><span data-stu-id="ca3a9-337">Next, create an event handler for the GridView's [`SelectedIndexChanged` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.selectedindexchanged.aspx) and add the following code:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample12.cs)]

<span data-ttu-id="ca3a9-338">Ten kod korzysta z GridView `SelectedValue` właściwości, aby określić nazwę cały plik wybranego pliku.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-338">This code uses the GridView's `SelectedValue` property to determine the full file name of the selected file.</span></span> <span data-ttu-id="ca3a9-339">Wewnętrznie `DataKeys` odwołuje się do kolekcji w celu uzyskania `SelectedValue`, więc konieczne jest ustawienie GridView `DataKeyNames` właściwość na nazwę, jak opisano wcześniej w tym kroku.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-339">Internally, the `DataKeys` collection is referenced in order to obtain the `SelectedValue`, so it is imperative that you set the GridView's `DataKeyNames` property to Name, as described earlier in this step.</span></span> <span data-ttu-id="ca3a9-340">[ `File` Klasy](https://msdn.microsoft.com/library/system.io.file.aspx) służy do odczytywania zawartość wybranego pliku w ciąg, który jest przypisywany do `FileContents` pola `Text` właściwości, w ten sposób wyświetlania zawartości wybranego pliku na stronie.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-340">The [`File` class](https://msdn.microsoft.com/library/system.io.file.aspx) is used to read the selected file's contents into a string, which is then assigned to the `FileContents` TextBox's `Text` property, thereby displaying the contents of the selected file on the page.</span></span>

<span data-ttu-id="ca3a9-341">[![Zawartość pliku wybrana są wyświetlane w polu tekstowym](user-based-authorization-cs/_static/image23.png)](user-based-authorization-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="ca3a9-341">[![The Selected File's Contents are Displayed in the TextBox](user-based-authorization-cs/_static/image23.png)](user-based-authorization-cs/_static/image22.png)</span></span>

<span data-ttu-id="ca3a9-342">**Rysunek 8**: Zawartość pliku wybrana są wyświetlane w polu tekstowym ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](user-based-authorization-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="ca3a9-342">**Figure 8**: The Selected File's Contents are Displayed in the TextBox  ([Click to view full-size image](user-based-authorization-cs/_static/image24.png))</span></span>

> [!NOTE]
> <span data-ttu-id="ca3a9-343">Jeśli wyświetlanie zawartości pliku, który zawiera kod znaczników HTML, a następnie ponów próbę przeglądanie lub usuwanie pliku, zostanie wyświetlony `HttpRequestValidationException` błędu.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-343">If you view the contents of a file that contains HTML markup, and then attempt to view or delete a file, you will receive an `HttpRequestValidationException` error.</span></span> <span data-ttu-id="ca3a9-344">Dzieje się tak, ponieważ na zwrot zawartość pole tekstowe są wysyłane z powrotem do serwera sieci web.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-344">This occurs because on postback the TextBox's contents are sent back to the web server.</span></span> <span data-ttu-id="ca3a9-345">Domyślnie program ASP.NET zgłasza `HttpRequestValidationException` błąd zawsze wtedy, gdy potencjalnie niebezpieczną treść zwrotu, takie jak kod znaczników HTML, zostanie wykryta.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-345">By default, ASP.NET raises an `HttpRequestValidationException` error whenever potentially dangerous postback content, such as HTML markup, is detected.</span></span> <span data-ttu-id="ca3a9-346">Aby wyłączyć ten błąd występuje, wyłącz weryfikację żądań dla strony, dodając `ValidateRequest="false"` do `@Page` dyrektywy.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-346">To disable this error from occurring, turn off request validation for the page by adding `ValidateRequest="false"` to the `@Page` directive.</span></span> <span data-ttu-id="ca3a9-347">Aby uzyskać więcej informacji o zaletach weryfikacji żądania jako oraz jakie środki ostrożności należy wykonać, gdy wyłączenie go, przeczytaj [żądanie weryfikacji — zapobieganie atakom skryptów](https://asp.net/learn/whitepapers/request-validation/).</span><span class="sxs-lookup"><span data-stu-id="ca3a9-347">For more information on the benefits of request validation as well as what precautions you should take when disabling it, read [Request Validation - Preventing Script Attacks](https://asp.net/learn/whitepapers/request-validation/).</span></span>

<span data-ttu-id="ca3a9-348">Na koniec należy dodać program obsługi zdarzeń, używając następującego kodu dla GridView [ `RowDeleting` zdarzeń](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rowdeleting.aspx):</span><span class="sxs-lookup"><span data-stu-id="ca3a9-348">Finally, add an event handler with the following code for the GridView's [`RowDeleting` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rowdeleting.aspx):</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample13.cs)]

<span data-ttu-id="ca3a9-349">Kod po prostu Wyświetla pełną nazwę pliku do usunięcia w `FileContents` TextBox *bez* faktycznego usuwania pliku.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-349">The code simply displays the full name of the file to delete in the `FileContents` TextBox *without* actually deleting the file.</span></span>

<span data-ttu-id="ca3a9-350">[![Kliknięcie przycisku Usuń nie rzeczywistego usunięcia pliku](user-based-authorization-cs/_static/image26.png)](user-based-authorization-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="ca3a9-350">[![Clicking the Delete Button Does Not Actually Delete the File](user-based-authorization-cs/_static/image26.png)](user-based-authorization-cs/_static/image25.png)</span></span>

<span data-ttu-id="ca3a9-351">**Rysunek 9**: Klikając polecenie Usuń przycisk rzeczywistości nie usuwa plik ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](user-based-authorization-cs/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="ca3a9-351">**Figure 9**: Clicking the Delete Button Does Not Actually Delete the File  ([Click to view full-size image](user-based-authorization-cs/_static/image27.png))</span></span>

<span data-ttu-id="ca3a9-352">W kroku 1 skonfigurowaliśmy reguł autoryzacji adresów URL, aby uniemożliwić użytkownikom anonimowym wyświetlania stron w `Membership` folderu.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-352">In Step 1 we configured the URL authorization rules to prohibit anonymous users from viewing the pages in the `Membership` folder.</span></span> <span data-ttu-id="ca3a9-353">Aby lepiej następującej liczby etapów stwierdzono szczegółową uwierzytelniania, użytkowników anonimowych odwiedzić zezwolimy na `UserBasedAuthorization.aspx` strony, ale z ograniczoną funkcjonalnością.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-353">In order to better exhibit fine grain authentication, let's allow anonymous users to visit the `UserBasedAuthorization.aspx` page, but with limited functionality.</span></span> <span data-ttu-id="ca3a9-354">Aby otworzyć tę stronę można uzyskać dostęp przez wszystkich użytkowników, Dodaj następujący kod `<location>` elementu `Web.config` w pliku `Membership` folderu:</span><span class="sxs-lookup"><span data-stu-id="ca3a9-354">To open this page up to be accessed by all users, add the following `<location>` element to the `Web.config` file in the `Membership` folder:</span></span>

[!code-xml[Main](user-based-authorization-cs/samples/sample14.xml)]

<span data-ttu-id="ca3a9-355">Po dodaniu `<location>` elementu, testowanie nowych reguł autoryzacji adresów URL, logując się poza lokacji.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-355">After adding this `<location>` element, test the new URL authorization rules by logging out of the site.</span></span> <span data-ttu-id="ca3a9-356">Jako użytkownik anonimowy użytkownik powinny zostać dopuszczone do odwiedzenia `UserBasedAuthorization.aspx` strony.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-356">As an anonymous user you should be permitted to visit the `UserBasedAuthorization.aspx` page.</span></span>

<span data-ttu-id="ca3a9-357">Obecnie żadnych uwierzytelnieni lub anonimowi użytkownik może odwiedzić `UserBasedAuthorization.aspx` strony i wyświetlania lub usuwania plików.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-357">Currently, any authenticated or anonymous user can visit the `UserBasedAuthorization.aspx` page and view or delete files.</span></span> <span data-ttu-id="ca3a9-358">Załóżmy, że tak, aby tylko uwierzytelnieni użytkownicy mogą wyświetlać zawartość pliku i tylko Tito można usunąć pliku.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-358">Let's make it so that only authenticated users can view contents of a file and only Tito can delete a file.</span></span> <span data-ttu-id="ca3a9-359">Deklaratywne, programowo lub za pomocą kombinacji obu tych metod można zastosować takich szczegółową reguł autoryzacji.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-359">Such fine grain authorization rules can be applied declaratively, programmatically, or through a combination of both methods.</span></span> <span data-ttu-id="ca3a9-360">Użyjmy podejścia deklaratywnego, aby ograniczyć, kto może wyświetlać zawartość pliku; użyjemy programowe podejście do limit, który można usunąć pliku.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-360">Let's use the declarative approach to limit who can view the contents of a file; we'll use the programmatic approach to limit who can delete a file.</span></span>

### <a name="using-the-loginview-control"></a><span data-ttu-id="ca3a9-361">Za pomocą kontrolki widoku logowania</span><span class="sxs-lookup"><span data-stu-id="ca3a9-361">Using the LoginView Control</span></span>

<span data-ttu-id="ca3a9-362">Jak widzieliśmy w poprzednich samouczkach kontrolki widoku logowania jest przydatny do wyświetlania różne interfejsy dla użytkowników uwierzytelnionych i anonimowych i zapewnia prosty sposób, aby ukryć funkcjonalność, która nie jest dostępna dla użytkowników anonimowych.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-362">As we've seen in past tutorials, the LoginView control is useful for displaying different interfaces for authenticated and anonymous users, and offers an easy way to hide functionality that is not accessible to anonymous users.</span></span> <span data-ttu-id="ca3a9-363">Ponieważ użytkownicy anonimowi nie mogą wyświetlić lub usunąć pliki, musimy pokazanie `FileContents` pole tekstowe, gdy strona jest kontrolowane przez uwierzytelnionego użytkownika.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-363">Since anonymous users cannot view or delete files, we only need to show the `FileContents` TextBox when the page is visited by an authenticated user.</span></span> <span data-ttu-id="ca3a9-364">Aby to osiągnąć, należy dodać kontrolki widoku logowania do strony, nadaj jej nazwę `LoginViewForFileContentsTextBox`i Przenieś `FileContents` pole tekstowe w oznaczeniu deklaracyjnym do kontrolki widoku logowania `LoggedInTemplate`.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-364">To achieve this, add a LoginView control to the page, name it `LoginViewForFileContentsTextBox`, and move the `FileContents` TextBox's declarative markup into the LoginView control's `LoggedInTemplate`.</span></span>

[!code-aspx[Main](user-based-authorization-cs/samples/sample15.aspx)]

<span data-ttu-id="ca3a9-365">Kontrolki sieci Web w szablonach widoku logowania nie są już dostępne bezpośrednio z kodem klasę.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-365">The Web controls in the LoginView's templates are no longer directly accessible from the code-behind class.</span></span> <span data-ttu-id="ca3a9-366">Na przykład `FilesGrid` GridView `SelectedIndexChanged` i `RowDeleting` procedury obsługi zdarzeń obecnie odwoływać się do `FileContents` Formant TextBox z kodu, takich jak:</span><span class="sxs-lookup"><span data-stu-id="ca3a9-366">For example, the `FilesGrid` GridView's `SelectedIndexChanged` and `RowDeleting` event handlers currently reference the `FileContents` TextBox control with code like:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample16.cs)]

<span data-ttu-id="ca3a9-367">Jednak ten kod nie jest już prawidłowy.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-367">However, this code is no longer valid.</span></span> <span data-ttu-id="ca3a9-368">Przenosząc `FileContents` pole tekstowe do `LoggedInTemplate` pole tekstowe nie są bezpośrednio dostępne.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-368">By moving the `FileContents` TextBox into the `LoggedInTemplate` the TextBox cannot be directly accessed.</span></span> <span data-ttu-id="ca3a9-369">Zamiast tego trzeba użyć `FindControl("controlId")` metodę, aby programowo odwoływać się do kontrolki.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-369">Instead, we must use the `FindControl("controlId")` method to programmatically reference the control.</span></span> <span data-ttu-id="ca3a9-370">Aktualizacja `FilesGrid` procedury obsługi zdarzeń, aby odwoływać się do pola tekstowego w następujący sposób:</span><span class="sxs-lookup"><span data-stu-id="ca3a9-370">Update the `FilesGrid` event handlers to reference the TextBox like so:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample17.cs)]

<span data-ttu-id="ca3a9-371">Po przeniesieniu pole tekstowe do widoku logowania `LoggedInTemplate` i aktualizowania kodu strony z odwołaniem do pola tekstowego przy użyciu `FindControl("controlId")` wzorca, odwiedź stronę jako użytkownik anonimowy.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-371">After moving the TextBox to the LoginView's `LoggedInTemplate` and updating the page's code to reference the TextBox using the `FindControl("controlId")` pattern, visit the page as an anonymous user.</span></span> <span data-ttu-id="ca3a9-372">Jak pokazano na rysunku nr 10, `FileContents` nie jest wyświetlane pole tekstowe.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-372">As Figure 10 shows, the `FileContents` TextBox is not displayed.</span></span> <span data-ttu-id="ca3a9-373">Element LinkButton widok nadal jest wyświetlany.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-373">However, the View LinkButton is still displayed.</span></span>

<span data-ttu-id="ca3a9-374">[![Kontrolki widoku logowania renderuje tylko pole tekstowe FileContents dla uwierzytelnionych użytkowników](user-based-authorization-cs/_static/image29.png)](user-based-authorization-cs/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="ca3a9-374">[![The LoginView Control Only Renders the FileContents TextBox for Authenticated Users](user-based-authorization-cs/_static/image29.png)](user-based-authorization-cs/_static/image28.png)</span></span>

<span data-ttu-id="ca3a9-375">**Na rysunku nr 10**: Widoku logowania kontrolka renderuje tylko `FileContents` pole tekstowe dla użytkowników uwierzytelnionych ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](user-based-authorization-cs/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="ca3a9-375">**Figure 10**: The LoginView Control Only Renders the `FileContents` TextBox for Authenticated Users  ([Click to view full-size image](user-based-authorization-cs/_static/image30.png))</span></span>

<span data-ttu-id="ca3a9-376">Jednym ze sposobów, aby ukryć przycisk Widok dla użytkowników anonimowych to aby przekonwertować pola GridView TemplateField.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-376">One way to hide the View button for anonymous users is to convert the GridView field into a TemplateField.</span></span> <span data-ttu-id="ca3a9-377">Spowoduje to wygenerowanie szablonu, który zawiera oznaczeniu deklaracyjnym LinkButton widoku.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-377">This will generate a template that contains the declarative markup for the View LinkButton.</span></span> <span data-ttu-id="ca3a9-378">Firma Microsoft może dodać kontrolki widoku logowania TemplateField i umieścić element LinkButton w widoku logowania `LoggedInTemplate`, a tym samym ukrywanie przycisku Widok od odwiedzających anonimowe.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-378">We can then add a LoginView control to the TemplateField and place the LinkButton within the LoginView's `LoggedInTemplate`, thereby hiding the View button from anonymous visitors.</span></span> <span data-ttu-id="ca3a9-379">Aby to zrobić, kliknij link Edytuj kolumny z GridView tagu inteligentnego, aby uruchomić okno dialogowe pól.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-379">To accomplish this, click on the Edit Columns link from the GridView's Smart Tag to launch the Fields dialog box.</span></span> <span data-ttu-id="ca3a9-380">Następnie kliknij przycisk Wybierz z listy w lewym dolnym rogu, a następnie kliknij przycisk Convert to pole do łącza TemplateField.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-380">Next, select the Select button from the list in the lower left corner and then click the Convert this field to a TemplateField link.</span></span> <span data-ttu-id="ca3a9-381">Ten sposób zmodyfikuje oznaczeniu deklaracyjnym pole od:</span><span class="sxs-lookup"><span data-stu-id="ca3a9-381">Doing so will modify the field's declarative markup from:</span></span>

[!code-aspx[Main](user-based-authorization-cs/samples/sample18.aspx)]

 <span data-ttu-id="ca3a9-382">Do:</span><span class="sxs-lookup"><span data-stu-id="ca3a9-382">To:</span></span> 

[!code-aspx[Main](user-based-authorization-cs/samples/sample19.aspx)]

<span data-ttu-id="ca3a9-383">W tym momencie możemy dodać widoku logowania do TemplateField.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-383">At this point, we can add a LoginView to the TemplateField.</span></span> <span data-ttu-id="ca3a9-384">Następujący kod przedstawia element LinkButton widok tylko do uwierzytelnionych użytkowników.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-384">The following markup displays the View LinkButton only for authenticated users.</span></span>

[!code-aspx[Main](user-based-authorization-cs/samples/sample20.aspx)]

<span data-ttu-id="ca3a9-385">Na ilustracji 11 pokazano, w rezultacie nie jest że dość jako widok kolumny jest nadal wyświetlany, mimo że LinkButtons widok, w kolumnie są ukryte.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-385">As Figure 11 shows, the end result is not that pretty as the View column is still displayed even though the View LinkButtons within the column are hidden.</span></span> <span data-ttu-id="ca3a9-386">Omówimy sposób ukrywania całą kolumnę GridView (i nie tylko element LinkButton) w następnej sekcji.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-386">We will look at how to hide the entire GridView column (and not just the LinkButton) in the next section.</span></span>

<span data-ttu-id="ca3a9-387">[![Kontrolki widoku logowania ukrywa LinkButtons widoku dla użytkowników anonimowych](user-based-authorization-cs/_static/image32.png)](user-based-authorization-cs/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="ca3a9-387">[![The LoginView Control Hides the View LinkButtons for Anonymous Visitors](user-based-authorization-cs/_static/image32.png)](user-based-authorization-cs/_static/image31.png)</span></span>

<span data-ttu-id="ca3a9-388">**Rysunek 11**: Kontrolki widoku logowania ukrywa LinkButtons widoku dla użytkowników anonimowych ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](user-based-authorization-cs/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="ca3a9-388">**Figure 11**: The LoginView Control Hides the View LinkButtons for Anonymous Visitors  ([Click to view full-size image](user-based-authorization-cs/_static/image33.png))</span></span>

### <a name="programmatically-limiting-functionality"></a><span data-ttu-id="ca3a9-389">Programowe ograniczanie funkcji</span><span class="sxs-lookup"><span data-stu-id="ca3a9-389">Programmatically Limiting Functionality</span></span>

<span data-ttu-id="ca3a9-390">W niektórych sytuacjach deklaratywne technik są niewystarczające do ograniczania funkcjonalności do strony.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-390">In some circumstances, declarative techniques are insufficient for limiting functionality to a page.</span></span> <span data-ttu-id="ca3a9-391">Na przykład dostępność niektórych funkcji strony może być zależny od kryteriów powyżej, czy użytkownik, odwiedzając stronę jest anonimowa lub uwierzytelniony.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-391">For example, the availability of certain page functionality may be dependent on criteria beyond whether the user visiting the page is anonymous or authenticated.</span></span> <span data-ttu-id="ca3a9-392">W takich przypadkach różne elementy interfejsu użytkownika, można wyświetlić lub ukryte w sposób programowy.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-392">In such cases, the various user interface elements can be displayed or hidden through programmatic means.</span></span>

<span data-ttu-id="ca3a9-393">Aby programowo ograniczenie funkcjonalności, należy wykonać dwa zadania:</span><span class="sxs-lookup"><span data-stu-id="ca3a9-393">In order to limit the functionality programmatically, we need to perform two tasks:</span></span>

1. <span data-ttu-id="ca3a9-394">Określić, czy użytkownik, odwiedzając stronę mogą uzyskiwać dostęp do funkcji, a</span><span class="sxs-lookup"><span data-stu-id="ca3a9-394">Determine whether the user visiting the page can access the functionality, and</span></span>
2. <span data-ttu-id="ca3a9-395">Programowego modyfikowania interfejsu użytkownika, w oparciu o tego, czy użytkownik ma dostęp do funkcji w danym.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-395">Programmatically modify the user interface based on whether the user has access to the functionality in question.</span></span>

<span data-ttu-id="ca3a9-396">Aby zademonstrować aplikację te dwa zadania, zezwolimy tylko na Tito usunąć pliki z kontrolki GridView.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-396">To demonstrate the application of these two tasks, let's only allow Tito to delete files from the GridView.</span></span> <span data-ttu-id="ca3a9-397">Nasze pierwsze zadanie następnie ma na celu określenie, czy jest ono Tito, odwiedzając stronę.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-397">Our first task, then, is to determine whether it is Tito visiting the page.</span></span> <span data-ttu-id="ca3a9-398">Po określeniu, musimy ukryć (lub pokazuj) prvku GridView Usuń kolumnę.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-398">Once that has been determined, we need to hide (or show) the GridView's Delete column.</span></span> <span data-ttu-id="ca3a9-399">Kolumny w widoku GridView są dostępne za pośrednictwem jego `Columns` właściwości kolumny jest renderowana tylko, jeśli jego `Visible` właściwość jest ustawiona na `true` (ustawienie domyślne).</span><span class="sxs-lookup"><span data-stu-id="ca3a9-399">The GridView's columns are accessible through its `Columns` property; a column is only rendered if its `Visible` property is set to `true` (the default).</span></span>

<span data-ttu-id="ca3a9-400">Dodaj następujący kod do `Page_Load` program obsługi zdarzeń przed wiązanie danych do kontrolki GridView:</span><span class="sxs-lookup"><span data-stu-id="ca3a9-400">Add the following code to the `Page_Load` event handler prior to binding the data to the GridView:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample21.cs)]

<span data-ttu-id="ca3a9-401">Tak jak Omówiliśmy to w [ *omówienie uwierzytelniania formularzy* ](../introduction/an-overview-of-forms-authentication-cs.md) samouczku `User.Identity.Name` zwraca nazwę tożsamości.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-401">As we discussed in the [*An Overview of Forms Authentication*](../introduction/an-overview-of-forms-authentication-cs.md) tutorial, `User.Identity.Name` returns the identity's name.</span></span> <span data-ttu-id="ca3a9-402">Odpowiada to nazwa użytkownika wprowadzona w formancie logowania.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-402">This corresponds to the username entered in the Login control.</span></span> <span data-ttu-id="ca3a9-403">Jeśli jest Tito, odwiedzając strony, druga kolumna w widoku GridView `Visible` właściwość jest ustawiona na `true`; w przeciwnym razie jest równa `false`.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-403">If it is Tito visiting the page, the GridView's second column's `Visible` property is set to `true`; otherwise, it is set to `false`.</span></span> <span data-ttu-id="ca3a9-404">Wynikiem jest, że gdy ktoś inny niż Tito odwiedzin strony innego użytkownika uwierzytelnionego lub użytkownik anonimowy kolumny usuwania nie są odtwarzane (patrz rysunek 12); Jednak gdy Tito odwiedzających stronę, Usuń kolumnę jest obecny (zobacz rysunek 13).</span><span class="sxs-lookup"><span data-stu-id="ca3a9-404">The net result is that when someone other than Tito visits the page, either another authenticated user or an anonymous user, the Delete column is not rendered (see Figure 12); however, when Tito visits the page, the Delete column is present (see Figure 13).</span></span>

<span data-ttu-id="ca3a9-405">[![Usuń kolumnę jest nie renderowane podczas odwiedzone przez kogoś innego niż Tito (na przykład Bruce)](user-based-authorization-cs/_static/image35.png)](user-based-authorization-cs/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="ca3a9-405">[![The Delete Column is Not Rendered When Visited By Someone Other Than Tito (Such as Bruce)](user-based-authorization-cs/_static/image35.png)](user-based-authorization-cs/_static/image34.png)</span></span>

<span data-ttu-id="ca3a9-406">**Rysunek 12**: Usuń kolumnę jest nie renderowane podczas odwiedzone przez kogoś innego niż Tito (na przykład Bruce) ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](user-based-authorization-cs/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="ca3a9-406">**Figure 12**: The Delete Column is Not Rendered When Visited By Someone Other Than Tito (Such as Bruce)  ([Click to view full-size image](user-based-authorization-cs/_static/image36.png))</span></span>

<span data-ttu-id="ca3a9-407">[![Usuń kolumnę nie jest renderowany Tito](user-based-authorization-cs/_static/image38.png)](user-based-authorization-cs/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="ca3a9-407">[![The Delete Column is Rendered for Tito](user-based-authorization-cs/_static/image38.png)](user-based-authorization-cs/_static/image37.png)</span></span>

<span data-ttu-id="ca3a9-408">**Rysunek 13**: Usuń kolumnę nie jest renderowany Tito ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](user-based-authorization-cs/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="ca3a9-408">**Figure 13**: The Delete Column is Rendered for Tito  ([Click to view full-size image](user-based-authorization-cs/_static/image39.png))</span></span>

## <a name="step-4-applying-authorization-rules-to-classes-and-methods"></a><span data-ttu-id="ca3a9-409">Krok 4. Stosowanie reguł autoryzacji do metod i klas</span><span class="sxs-lookup"><span data-stu-id="ca3a9-409">Step 4: Applying Authorization Rules to Classes and Methods</span></span>

<span data-ttu-id="ca3a9-410">W kroku 3 możemy niedozwolone, użytkowników anonimowych, wyświetlanie zawartość pliku i będzie to zabronione wszystkich użytkowników, z wyjątkiem Tito usuwania plików.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-410">In Step 3 we disallowed anonymous users from viewing a file's contents and prohibited all users but Tito from deleting files.</span></span> <span data-ttu-id="ca3a9-411">To było wykonywane przez ukrycie elementów interfejsu użytkownika skojarzonego dla nieautoryzowanych użytkowników zewnętrznych za pomocą technik deklaracyjne i programowe.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-411">This was accomplished by hiding the associated user interface elements for unauthorized visitors through declarative and programmatic techniques.</span></span> <span data-ttu-id="ca3a9-412">W naszym przykładzie prostego prawidłowo ukrywanie elementów interfejsu użytkownika zostało utrudnione, ale co bardziej złożonych witryn w przypadku, gdy może istnieć wiele różnych sposobów, aby wykonać te same funkcje?</span><span class="sxs-lookup"><span data-stu-id="ca3a9-412">For our simple example, properly hiding the user interface elements was straightforward, but what about more complex sites where there may be many different ways to perform the same functionality?</span></span> <span data-ttu-id="ca3a9-413">Ograniczanie funkcjonalność dla nieautoryzowanych użytkowników, co się stanie, firma Microsoft nie pamięta ukryć lub Wyłącz wszystkie elementy interfejsu użytkownika dotyczy?</span><span class="sxs-lookup"><span data-stu-id="ca3a9-413">In limiting that functionality to unauthorized users, what happens if we forget to hide or disable all of the applicable user interface elements?</span></span>

<span data-ttu-id="ca3a9-414">Prosty sposób, aby upewnić się, że do określonego elementu funkcje nie są dostępne przez nieautoryzowanego użytkownika jest do dekorowania tej klasy lub metody za pomocą [ `PrincipalPermission` atrybutu](https://msdn.microsoft.com/library/system.security.permissions.principalpermissionattribute.aspx).</span><span class="sxs-lookup"><span data-stu-id="ca3a9-414">An easy way to ensure that a particular piece of functionality cannot be accessed by an unauthorized user is to decorate that class or method with the [`PrincipalPermission` attribute](https://msdn.microsoft.com/library/system.security.permissions.principalpermissionattribute.aspx).</span></span> <span data-ttu-id="ca3a9-415">Gdy środowisko uruchomieniowe platformy .NET używa klasy lub wykonuje jeden z jego metod, sprawdza, sprawdź, czy bieżący kontekst zabezpieczeń ma uprawnienia do używania klasy lub wykonać metodę.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-415">When the .NET runtime uses a class or executes one of its methods, it checks to ensure that the current security context has permission to use the class or execute the method.</span></span> <span data-ttu-id="ca3a9-416">`PrincipalPermission` Atrybutu zapewnia mechanizm, za pomocą którego możemy zdefiniować te reguły.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-416">The `PrincipalPermission` attribute provides a mechanism through which we can define these rules.</span></span>

<span data-ttu-id="ca3a9-417">Zobaczmy, jak działają przy użyciu `PrincipalPermission` atrybutu GridView `SelectedIndexChanged` i `RowDeleting` programów obsługi zdarzeń do Stanów Zjednoczonych zabraniają wykonywania przez użytkowników anonimowych, jak i użytkowników innych niż Tito, odpowiednio.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-417">Let's demonstrate using the `PrincipalPermission` attribute on the GridView's `SelectedIndexChanged` and `RowDeleting` event handlers to prohibit execution by anonymous users and users other than Tito, respectively.</span></span> <span data-ttu-id="ca3a9-418">To wszystko, co należy zrobić, Dodaj odpowiedni atrybut na jego podstawie Każda definicja funkcji:</span><span class="sxs-lookup"><span data-stu-id="ca3a9-418">All we need to do is add the appropriate attribute atop each function definition:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample22.cs)]

<span data-ttu-id="ca3a9-419">Atrybut `SelectedIndexChanged` określają procedury obsługi zdarzeń, które tylko uwierzytelnionym użytkownikom można wykonać obsługi zdarzeń, gdzie jako atrybut na `RowDeleting` program obsługi zdarzeń ogranicza wykonanie Tito.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-419">The attribute for the `SelectedIndexChanged` event handler dictates that only authenticated users can execute the event handler, where as the attribute on the `RowDeleting` event handler limits the execution to Tito.</span></span>

<span data-ttu-id="ca3a9-420">Jeśli jakiś sposób, próbuje wykonać użytkownik inny niż Tito `RowDeleting` programu obsługi zdarzeń lub bez uwierzytelnienia użytkownik podejmuje próbę wykonania `SelectedIndexChanged` programu obsługi zdarzeń środowiska uruchomieniowego .NET zgłosi `SecurityException`.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-420">If, somehow, a user other than Tito attempts to execute the `RowDeleting` event handler or a non-authenticated user attempts to execute the `SelectedIndexChanged` event handler, the .NET runtime will raise a `SecurityException`.</span></span>

<span data-ttu-id="ca3a9-421">[![Jeśli kontekst zabezpieczeń nie ma autoryzacji do wykonania metody, jest zgłaszany securityexception —](user-based-authorization-cs/_static/image41.png)](user-based-authorization-cs/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="ca3a9-421">[![If the Security Context is not Authorized to Execute the Method, a SecurityException is Thrown](user-based-authorization-cs/_static/image41.png)](user-based-authorization-cs/_static/image40.png)</span></span>

<span data-ttu-id="ca3a9-422">**Rysunek 14**: Jeśli kontekst zabezpieczeń nie ma autoryzacji do wykonania metody `SecurityException` zgłaszany ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](user-based-authorization-cs/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="ca3a9-422">**Figure 14**: If the Security Context is not Authorized to Execute the Method, a `SecurityException` is Thrown  ([Click to view full-size image](user-based-authorization-cs/_static/image42.png))</span></span>

> [!NOTE]
> <span data-ttu-id="ca3a9-423">Aby zezwolić na wiele konteksty zabezpieczeń dostępu do klasy lub metody, dekoracji klasy lub metody za pomocą `PrincipalPermission` atrybutu dla każdego kontekstu zabezpieczeń.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-423">To allow multiple security contexts to access a class or method, decorate the class or method with a `PrincipalPermission` attribute for each security context.</span></span> <span data-ttu-id="ca3a9-424">Oznacza to umożliwiające Tito i Bruce do wykonania `RowDeleting` procedura obsługi zdarzeń, Dodaj *dwóch* `PrincipalPermission` atrybuty:</span><span class="sxs-lookup"><span data-stu-id="ca3a9-424">That is, to allow both Tito and Bruce to execute the `RowDeleting` event handler, add *two* `PrincipalPermission` attributes:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample23.cs)]

<span data-ttu-id="ca3a9-425">Oprócz stron ASP.NET wiele aplikacji ma architekturę, która obejmuje różne warstwy, takie jak logiki biznesowej i warstwy dostępu do danych.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-425">In addition to ASP.NET pages, many applications also have an architecture that includes various layers, such as Business Logic and Data Access Layers.</span></span> <span data-ttu-id="ca3a9-426">Te warstwy są zwykle implementowane jako bibliotek klas i oferują klasy i metody służące do wykonywania funkcji powiązanych logiki i danych biznesowych.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-426">These layers are typically implemented as Class Libraries and offer classes and methods for performing business logic- and data-related functionality.</span></span> <span data-ttu-id="ca3a9-427">`PrincipalPermission` Atrybut jest przydatne w przypadku stosowania reguł autoryzacji do tych warstw.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-427">The `PrincipalPermission` attribute is useful for applying authorization rules to these layers.</span></span>

<span data-ttu-id="ca3a9-428">Aby uzyskać więcej informacji na temat korzystania z `PrincipalPermission` atrybutu, aby zdefiniować reguły autoryzacji dla klasy i metody, zobacz [Scott Guthrie](https://weblogs.asp.net/scottgu/)firmy wpis w blogu [Dodawanie reguły autoryzacji w celu biznesowych i danych zapomocąwarstwy`PrincipalPermissionAttributes` ](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx).</span><span class="sxs-lookup"><span data-stu-id="ca3a9-428">For more information on using the `PrincipalPermission` attribute to define authorization rules on classes and methods, refer to [Scott Guthrie](https://weblogs.asp.net/scottgu/)'s blog entry [Adding Authorization Rules to Business and Data Layers Using `PrincipalPermissionAttributes`](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx).</span></span>

## <a name="summary"></a><span data-ttu-id="ca3a9-429">Podsumowanie</span><span class="sxs-lookup"><span data-stu-id="ca3a9-429">Summary</span></span>

<span data-ttu-id="ca3a9-430">W tym samouczku zobaczyliśmy, jak zastosować reguły autoryzacji na podstawie użytkownika.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-430">In this tutorial we looked at how to apply user-based authorization rules.</span></span> <span data-ttu-id="ca3a9-431">Zaczęliśmy od przyjrzeć się ASP. Struktura autoryzacji adresu URL w sieci.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-431">We started with a look at ASP.NET's URL authorization framework.</span></span> <span data-ttu-id="ca3a9-432">Dla każdego żądania, aparatu ASP.NET firmy `UrlAuthorizationModule` sprawdza reguł autoryzacji adresów URL, które są zdefiniowane w konfiguracji aplikacji w celu ustalenia, czy tożsamość jest autoryzowany do uzyskania dostępu do żądanego zasobu.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-432">On each request, the ASP.NET engine's `UrlAuthorizationModule` inspects the URL authorization rules defined in the application's configuration to determine whether the identity is authorized to access the requested resource.</span></span> <span data-ttu-id="ca3a9-433">Krótko mówiąc Autoryzacja adresów URL można łatwo określić reguły autoryzacji dla określonej strony lub dla wszystkich stron w określonym katalogu.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-433">In short, URL authorization makes it easy to specify authorization rules for a specific page or for all pages in a particular directory.</span></span>

<span data-ttu-id="ca3a9-434">Struktura adresu URL autoryzacji stosuje reguły autoryzacji na podstawie strony strona.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-434">The URL authorization framework applies authorization rules on a page-by-page basis.</span></span> <span data-ttu-id="ca3a9-435">Za pomocą Autoryzacja adresów URL żądania tożsamości jest autoryzowany dostęp do określonego zasobu lub nie.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-435">With URL authorization, either the requesting identity is authorized to access a particular resource or not.</span></span> <span data-ttu-id="ca3a9-436">Wiele scenariuszy, jednak wymagają więcej reguł autoryzacji szczegółową.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-436">Many scenarios, however, call for more fine grain authorization rules.</span></span> <span data-ttu-id="ca3a9-437">Zamiast definiować, kto może uzyskać dostęp do strony, firma Microsoft może być konieczne umożliwi wszystkim dostępu do strony, ale wyświetlanie różnych danych lub oferują różne funkcje, w zależności od użytkownika, odwiedzając stronę.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-437">Rather than defining who is permitted to access a page, we may need to let everyone access a page, but to show different data or offer different functionality depending on the user visiting the page.</span></span> <span data-ttu-id="ca3a9-438">Uwierzytelnianie na poziomie strony zazwyczaj polega na ukrywanie elementów interfejsu użytkownika, aby uniemożliwić dostęp do funkcji zabronionych przez nieautoryzowanych użytkowników.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-438">Page-level authorization usually involves hiding specific user interface elements in order to prevent unauthorized users from accessing prohibited functionality.</span></span> <span data-ttu-id="ca3a9-439">Ponadto istnieje możliwość ograniczania dostępu do klas i wykonania jego metod dla niektórych użytkowników za pomocą atrybutów.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-439">Additionally, it is possible to use attributes to restrict access to classes and execution of its methods for certain users.</span></span>

<span data-ttu-id="ca3a9-440">Wszystkiego najlepszego programowania!</span><span class="sxs-lookup"><span data-stu-id="ca3a9-440">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="ca3a9-441">Dalsze informacje</span><span class="sxs-lookup"><span data-stu-id="ca3a9-441">Further Reading</span></span>

<span data-ttu-id="ca3a9-442">Więcej informacji na tematów omówionych w tym samouczku można znaleźć w następujących zasobach:</span><span class="sxs-lookup"><span data-stu-id="ca3a9-442">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="ca3a9-443">Dodawanie reguły autoryzacji w celu biznesowej i warstwy danych przy użyciu `PrincipalPermissionAttributes`</span><span class="sxs-lookup"><span data-stu-id="ca3a9-443">Adding Authorization Rules to Business and Data Layers Using `PrincipalPermissionAttributes`</span></span>](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)
- [<span data-ttu-id="ca3a9-444">Autoryzacja w programie ASP.NET</span><span class="sxs-lookup"><span data-stu-id="ca3a9-444">ASP.NET Authorization</span></span>](https://msdn.microsoft.com/library/wce3kxhd.aspx)
- [<span data-ttu-id="ca3a9-445">Zmian między wersjami usług IIS 6 i zabezpieczeń usług IIS7</span><span class="sxs-lookup"><span data-stu-id="ca3a9-445">Changes Between IIS6 and IIS7 Security</span></span>](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/Changes-between-IIS6-and-IIS7-Security)
- [<span data-ttu-id="ca3a9-446">Konfigurowanie określonych plików i podkatalogów</span><span class="sxs-lookup"><span data-stu-id="ca3a9-446">Configuring Specific Files and Subdirectories</span></span>](https://msdn.microsoft.com/library/6hbkh9s7.aspx)
- [<span data-ttu-id="ca3a9-447">Ograniczanie funkcji modyfikacji danych na podstawie użytkownika</span><span class="sxs-lookup"><span data-stu-id="ca3a9-447">Limiting Data Modification Functionality Based on the User</span></span>](../../data-access/editing-inserting-and-deleting-data/limiting-data-modification-functionality-based-on-the-user-cs.md)
- [<span data-ttu-id="ca3a9-448">Przewodniki Szybki Start kontrolki widoku logowania</span><span class="sxs-lookup"><span data-stu-id="ca3a9-448">LoginView Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/login/loginview.aspx)
- [<span data-ttu-id="ca3a9-449">Informacje o autoryzacji adresów URL usług IIS7</span><span class="sxs-lookup"><span data-stu-id="ca3a9-449">Understanding IIS7 URL Authorization</span></span>](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/URL-Authorization/Understanding-IIS7-URL-Authorization)
- [<span data-ttu-id="ca3a9-450">`UrlAuthorizationModule` Dokumentacja techniczna</span><span class="sxs-lookup"><span data-stu-id="ca3a9-450">`UrlAuthorizationModule` Technical Documentation</span></span>](https://msdn.microsoft.com/library/system.web.security.urlauthorizationmodule.aspx)
- [<span data-ttu-id="ca3a9-451">Praca z danymi w programie ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="ca3a9-451">Working with Data in ASP.NET 2.0</span></span>](../../data-access/index.md)

### <a name="about-the-author"></a><span data-ttu-id="ca3a9-452">Informacje o autorze</span><span class="sxs-lookup"><span data-stu-id="ca3a9-452">About the Author</span></span>

<span data-ttu-id="ca3a9-453">Pracował nad Bento Scottem, autor wiele książek ASP/ASP.NET i założyciel 4GuysFromRolla.com, przy użyciu technologii Microsoft Web od 1998 r.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-453">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="ca3a9-454">Scott działa jako niezależny Konsultant, trainer i składnika zapisywania.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-454">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="ca3a9-455">Jego najnowszą książkę Stephena  *[Sams uczyć się ASP.NET 2.0 w ciągu 24 godzin](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-455">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="ca3a9-456">Scott można z Tobą skontaktować w [ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com) lub za pośrednictwem jego blog znajduje się na [ http://ScottOnWriting.NET ](http://scottonwriting.net/).</span><span class="sxs-lookup"><span data-stu-id="ca3a9-456">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="ca3a9-457">Specjalne podziękowania dla</span><span class="sxs-lookup"><span data-stu-id="ca3a9-457">Special Thanks To</span></span>

<span data-ttu-id="ca3a9-458">W tej serii samouczków został zrecenzowany przez wielu recenzentów pomocne.</span><span class="sxs-lookup"><span data-stu-id="ca3a9-458">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="ca3a9-459">Zainteresowani zapoznaniem Moje kolejnych artykułów MSDN?</span><span class="sxs-lookup"><span data-stu-id="ca3a9-459">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="ca3a9-460">Jeśli tak, Porzuć mnie linii w [ mitchell@4GuysFromRolla.com ](mailto:mitchell@4GuysFromRolla.com).</span><span class="sxs-lookup"><span data-stu-id="ca3a9-460">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="ca3a9-461">[Poprzednie](validating-user-credentials-against-the-membership-user-store-cs.md)
> [dalej](storing-additional-user-information-cs.md)</span><span class="sxs-lookup"><span data-stu-id="ca3a9-461">[Previous](validating-user-credentials-against-the-membership-user-store-cs.md)
[Next](storing-additional-user-information-cs.md)</span></span>
