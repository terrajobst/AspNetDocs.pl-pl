---
uid: web-forms/overview/deployment/advanced-enterprise-web-deployment/taking-web-applications-offline-with-web-deploy
title: Tworzenie aplikacji sieci Web w trybie Offline za pomocą sieci Web wdrażanie | Dokumentacja firmy Microsoft
author: jrjlee
description: W tym temacie opisano sposób wykonania aplikacji sieci web w trybie offline na czas trwania zautomatyzowanego wdrażania z użyciem alert Wdr sieci Web usług Internet Information Services (IIS)...
ms.author: riande
ms.date: 05/04/2012
ms.assetid: 3e9f6e7d-8967-4586-94d5-d3a122f12529
msc.legacyurl: /web-forms/overview/deployment/advanced-enterprise-web-deployment/taking-web-applications-offline-with-web-deploy
msc.type: authoredcontent
ms.openlocfilehash: ba54454bcb6f5e4ceb269b128a6b72a4b75f64be
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 05/06/2019
ms.locfileid: "65131407"
---
# <a name="taking-web-applications-offline-with-web-deploy"></a><span data-ttu-id="9feea-103">Przełączanie aplikacji internetowych w tryb offline za pomocą narzędzia Web Deploy</span><span class="sxs-lookup"><span data-stu-id="9feea-103">Taking Web Applications Offline with Web Deploy</span></span>

<span data-ttu-id="9feea-104">przez [Jason Lee](https://github.com/jrjlee)</span><span class="sxs-lookup"><span data-stu-id="9feea-104">by [Jason Lee](https://github.com/jrjlee)</span></span>

[<span data-ttu-id="9feea-105">Pobierz plik PDF</span><span class="sxs-lookup"><span data-stu-id="9feea-105">Download PDF</span></span>](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> <span data-ttu-id="9feea-106">W tym temacie opisano sposób wykonania aplikacji sieci web w trybie offline na czas trwania automatycznego wdrażania przy użyciu narzędzia wdrażania usług Internet Information Services (IIS) w sieci Web (Web Deploy).</span><span class="sxs-lookup"><span data-stu-id="9feea-106">This topic describes how to take a web application offline for the duration of an automated deployment using the Internet Information Services (IIS) Web Deployment Tool (Web Deploy).</span></span> <span data-ttu-id="9feea-107">Użytkownicy, którzy przejdź do aplikacji sieci web są przekierowywane do *aplikacji\_offline.htm* pliku do czasu ukończenia wdrożenia.</span><span class="sxs-lookup"><span data-stu-id="9feea-107">Users who browse to the web application are redirected to an *App\_offline.htm* file until the deployment is complete.</span></span>

<span data-ttu-id="9feea-108">Ten temat jest częścią serii samouczków na podstawie wymagania dotyczące wdrażania enterprise fikcyjnej firmy o nazwie firmy Fabrikam, Inc. Przykładowe rozwiązanie korzysta z tej serii samouczków&#x2014; [rozwiązania Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;do reprezentowania aplikacji sieci web przy użyciu realistycznej stopień złożoności, łącznie z aplikacją ASP.NET MVC 3 komunikacji Windows Usługa Foundation (WCF), a projekt bazy danych.</span><span class="sxs-lookup"><span data-stu-id="9feea-108">This topic forms part of a series of tutorials based around the enterprise deployment requirements of a fictional company named Fabrikam, Inc. This tutorial series uses a sample solution&#x2014;the [Contact Manager solution](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;to represent a web application with a realistic level of complexity, including an ASP.NET MVC 3 application, a Windows Communication Foundation (WCF) service, and a database project.</span></span>

<span data-ttu-id="9feea-109">Metody wdrażania w ramach tego samouczka opiera się na podejście pliku projektu Podziel opisane w [objaśnienie pliku projektu](../web-deployment-in-the-enterprise/understanding-the-project-file.md), w którym proces kompilacji jest kontrolowana przez dwa pliki projektu&#x2014;jeden zawierający Tworzenie instrukcji, które mają zastosowanie do każdego środowiska docelowego i jeden zawierający ustawienia specyficzne dla środowiska kompilacji i wdrażania.</span><span class="sxs-lookup"><span data-stu-id="9feea-109">The deployment method at the heart of these tutorials is based on the split project file approach described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md), in which the build process is controlled by two project files&#x2014;one containing build instructions that apply to every destination environment, and one containing environment-specific build and deployment settings.</span></span> <span data-ttu-id="9feea-110">W czasie kompilacji pliku projektu specyficznymi dla środowiska jest scalana w pliku projektu niezależnego od środowiska w celu utworzenia kompletny zestaw instrukcji kompilacji.</span><span class="sxs-lookup"><span data-stu-id="9feea-110">At build time, the environment-specific project file is merged into the environment-agnostic project file to form a complete set of build instructions.</span></span>

## <a name="task-overview"></a><span data-ttu-id="9feea-111">Omówienie zadań</span><span class="sxs-lookup"><span data-stu-id="9feea-111">Task Overview</span></span>

<span data-ttu-id="9feea-112">W wielu scenariuszach należy wykonać aplikację sieci web w trybie offline, podczas wprowadzania zmian do powiązanych składników, takich jak bazy danych lub usługi sieci web.</span><span class="sxs-lookup"><span data-stu-id="9feea-112">In a lot of scenarios, you'll want to take a web application offline while you make changes to related components, like databases or web services.</span></span> <span data-ttu-id="9feea-113">Zazwyczaj w usługach IIS i platformy ASP.NET, można to zrobić, umieszczając plik o nazwie *aplikacji\_offline.htm* w folderze głównym aplikacji witryny sieci Web lub sieci web usług IIS.</span><span class="sxs-lookup"><span data-stu-id="9feea-113">Typically, in IIS and ASP.NET, you accomplish this by placing a file named *App\_offline.htm* in the root folder of the IIS website or web application.</span></span> <span data-ttu-id="9feea-114">*Aplikacji\_offline.htm* plików to standardowy plik HTML i zwykle będzie zawierać prosty komunikat wniosku użytkownika, że witryna jest tymczasowo niedostępna z powodu konserwacji.</span><span class="sxs-lookup"><span data-stu-id="9feea-114">The *App\_offline.htm* file is a standard HTML file and will usually contain a simple message advising the user that the site is temporarily unavailable due to maintenance.</span></span> <span data-ttu-id="9feea-115">Gdy *aplikacji\_offline.htm* plik istnieje w folderze głównym witryny sieci Web, usługi IIS przekierują automatycznie wszystkich żądań do pliku.</span><span class="sxs-lookup"><span data-stu-id="9feea-115">While the *App\_offline.htm* file exists in the root folder of the website, IIS will automatically redirect any requests to the file.</span></span> <span data-ttu-id="9feea-116">Po wprowadzeniu wszystkich potrzebnych aktualizacji, Usuń *aplikacji\_offline.htm* plików i witryny sieci Web zostanie wznowione w zwykły sposób obsługiwania żądań.</span><span class="sxs-lookup"><span data-stu-id="9feea-116">When you've finished making updates, you remove the *App\_offline.htm* file and the website resumes serving requests as usual.</span></span>

<span data-ttu-id="9feea-117">Korzystając z narzędzia Web Deploy do przeprowadzania wdrożeń zautomatyzowanych lub pojedynczy krok do środowiska docelowego, możesz chcieć dołączyć Dodawanie i usuwanie *aplikacji\_offline.htm* pliku w procesie wdrażania.</span><span class="sxs-lookup"><span data-stu-id="9feea-117">When you use Web Deploy to perform automated or single-step deployments to a target environment, you may want to incorporate adding and removing the *App\_offline.htm* file into your deployment process.</span></span> <span data-ttu-id="9feea-118">Aby to zrobić, należy wykonać te zadania wysokiego poziomu:</span><span class="sxs-lookup"><span data-stu-id="9feea-118">To do this, you'll need to complete these high-level tasks:</span></span>

- <span data-ttu-id="9feea-119">W pliku projektu aparatu Microsoft Build Engine (MSBuild) służące do kontrolowania procesu wdrażania, Utwórz obiekt docelowy programu MSBuild, która kopiuje *aplikacji\_offline.htm* pliku na serwer docelowy, zanim wszystkie zadania wdrażania Rozpocznij.</span><span class="sxs-lookup"><span data-stu-id="9feea-119">In the Microsoft Build Engine (MSBuild) project file that you use to control the deployment process, create an MSBuild target that copies an *App\_offline.htm* file to the destination server before any deployment tasks begin.</span></span>
- <span data-ttu-id="9feea-120">Dodaj inny docelowy programu MSBuild, który usuwa *aplikacji\_offline.htm* plików z serwera docelowego po ukończeniu wszystkich zadań wdrażania.</span><span class="sxs-lookup"><span data-stu-id="9feea-120">Add another MSBuild target that removes the *App\_offline.htm* file from the destination server when all deployment tasks are complete.</span></span>
- <span data-ttu-id="9feea-121">W projekcie aplikacji sieci web, należy utworzyć *. wpp.targets* pliku, który zapewnia, że *aplikacji\_offline.htm* plik zostanie dodany do pakietu wdrożeniowego, gdy narzędzie Web Deploy jest wywoływany.</span><span class="sxs-lookup"><span data-stu-id="9feea-121">In the web application project, create a *.wpp.targets* file that ensures that an *App\_offline.htm* file is added to the deployment package when Web Deploy is invoked.</span></span>

<span data-ttu-id="9feea-122">W tym temacie pokazują sposób wykonania tych procedur.</span><span class="sxs-lookup"><span data-stu-id="9feea-122">This topic will show you how to perform these procedures.</span></span> <span data-ttu-id="9feea-123">Zadania i wskazówki, w tym temacie założono, że utworzono już rozwiązanie, które zawiera co najmniej jeden projekt aplikacji sieci web i użyć pliku niestandardowego projektu do kontrolowania procesu wdrażania zgodnie z opisem w [wdrażanie w Internecie w Enterprise](../web-deployment-in-the-enterprise/web-deployment-in-the-enterprise.md).</span><span class="sxs-lookup"><span data-stu-id="9feea-123">The tasks and walkthroughs in this topic assume that you've already created a solution that contains at least one web application project, and that you use a custom project file to control the deployment process as described in [Web Deployment in the Enterprise](../web-deployment-in-the-enterprise/web-deployment-in-the-enterprise.md).</span></span> <span data-ttu-id="9feea-124">Alternatywnie, można użyć [Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) przykładowe rozwiązanie, aby pracować z przykładami w tym temacie.</span><span class="sxs-lookup"><span data-stu-id="9feea-124">Alternatively, you can use the [Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) sample solution to follow the examples in the topic.</span></span>

## <a name="adding-an-appoffline-file-to-a-web-application-project"></a><span data-ttu-id="9feea-125">Dodawanie aplikacji\_pliku projektu aplikacji sieci Web w trybie Offline</span><span class="sxs-lookup"><span data-stu-id="9feea-125">Adding an App\_Offline File to a Web Application Project</span></span>

<span data-ttu-id="9feea-126">Pierwsze zadanie, które należy wykonać, jest dodanie *aplikacji\_offline* plik do projektu aplikacji sieci web:</span><span class="sxs-lookup"><span data-stu-id="9feea-126">The first task you need to complete is to add an *App\_offline* file to your web application project:</span></span>

- <span data-ttu-id="9feea-127">Aby zapobiec pliku nie zakłócają proces programowania (nie chcesz aplikacja ma być trwale w trybie offline), należy wywołać go coś innego niż *aplikacji\_offline.htm*.</span><span class="sxs-lookup"><span data-stu-id="9feea-127">To prevent the file from interfering with the development process (you don't want your application to be permanently offline), you should call it something other than *App\_offline.htm*.</span></span> <span data-ttu-id="9feea-128">Na przykład nazwać plik *aplikacji\_offline template.htm*.</span><span class="sxs-lookup"><span data-stu-id="9feea-128">For example, you could name the file *App\_offline-template.htm*.</span></span>
- <span data-ttu-id="9feea-129">Aby zapobiec są wdrażane jako plik — jest, należy ustawić akcji kompilacji **Brak**.</span><span class="sxs-lookup"><span data-stu-id="9feea-129">To prevent the file from being deployed as-is, you should set the build action to **None**.</span></span>

<span data-ttu-id="9feea-130">**Aby dodać aplikację\_pliku projektu aplikacji sieci web w trybie offline**</span><span class="sxs-lookup"><span data-stu-id="9feea-130">**To add an App\_offline file to a web application project**</span></span>

1. <span data-ttu-id="9feea-131">Otwórz swoje rozwiązanie w programie Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="9feea-131">Open your solution in Visual Studio 2010.</span></span>
2. <span data-ttu-id="9feea-132">W **Eksploratora rozwiązań** okna, kliknij prawym przyciskiem myszy projekt aplikacji sieci web, wskaż opcję **Dodaj**, a następnie kliknij przycisk **nowy element**.</span><span class="sxs-lookup"><span data-stu-id="9feea-132">In the **Solution Explorer** window, right-click your web application project, point to **Add**, and then click **New Item**.</span></span>
3. <span data-ttu-id="9feea-133">W **Dodaj nowy element** okno dialogowe, wybierz opcję **strony HTML**.</span><span class="sxs-lookup"><span data-stu-id="9feea-133">In the **Add New Item** dialog box, select **HTML Page**.</span></span>
4. <span data-ttu-id="9feea-134">W **nazwa** wpisz **aplikacji\_offline template.htm**, a następnie kliknij przycisk **Dodaj**.</span><span class="sxs-lookup"><span data-stu-id="9feea-134">In the **Name** box, type **App\_offline-template.htm**, and then click **Add**.</span></span>

    ![](taking-web-applications-offline-with-web-deploy/_static/image1.png)
5. <span data-ttu-id="9feea-135">Dodaj kilka prostych HTML, aby zawiadomić użytkowników o tym, że aplikacja jest niedostępna, a następnie zapisz plik.</span><span class="sxs-lookup"><span data-stu-id="9feea-135">Add some simple HTML to inform users that the application is unavailable, and then save the file.</span></span> <span data-ttu-id="9feea-136">Nie ma żadnych znaczników po stronie serwera (na przykład wszystkie znaczniki, które mają prefiks "asp:").</span><span class="sxs-lookup"><span data-stu-id="9feea-136">Do not include any server-side tags (for example, any tags that are prefixed with "asp:").</span></span> 

    ![](taking-web-applications-offline-with-web-deploy/_static/image2.png)
6. <span data-ttu-id="9feea-137">W **Eksploratora rozwiązań** , kliknij prawym przyciskiem myszy nowy plik, a następnie kliknij przycisk **właściwości**.</span><span class="sxs-lookup"><span data-stu-id="9feea-137">In the **Solution Explorer** window, right-click the new file, and then click **Properties**.</span></span>
7. <span data-ttu-id="9feea-138">W **właściwości** okna w **Build Action** wiersz, wybierz opcję **Brak**.</span><span class="sxs-lookup"><span data-stu-id="9feea-138">In the **Properties** window, in the **Build Action** row, select **None**.</span></span>

    ![](taking-web-applications-offline-with-web-deploy/_static/image3.png)

## <a name="deploying-and-deleting-an-appoffline-file"></a><span data-ttu-id="9feea-139">Wdrażanie i usuwania aplikacji\_pliku w trybie Offline</span><span class="sxs-lookup"><span data-stu-id="9feea-139">Deploying and Deleting an App\_Offline File</span></span>

<span data-ttu-id="9feea-140">Następnym krokiem jest do modyfikowania logika wdrożenia, aby skopiować plik na serwer docelowy, na początku procesu wdrażania i usunąć go na końcu.</span><span class="sxs-lookup"><span data-stu-id="9feea-140">The next step is to modify your deployment logic to copy the file to the destination server at the start of the deployment process and remove it at the end.</span></span>

> [!NOTE]
> <span data-ttu-id="9feea-141">Następna procedura zakłada, że używasz niestandardowego pliku projektu MSBuild kontrolować proces wdrażania, zgodnie z opisem w [objaśnienie pliku projektu](../web-deployment-in-the-enterprise/understanding-the-project-file.md).</span><span class="sxs-lookup"><span data-stu-id="9feea-141">The next procedure assumes that you're using a custom MSBuild project file to control your deployment process, as described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md).</span></span> <span data-ttu-id="9feea-142">Jeśli jest wdrażany bezpośrednio z programu Visual Studio, należy użyć innego podejścia.</span><span class="sxs-lookup"><span data-stu-id="9feea-142">If you're deploying direct from Visual Studio, you'll need to use a different approach.</span></span> <span data-ttu-id="9feea-143">Jedno takie podejście w tym artykule opisano Sayed Ibrahim Hashimi [jak wykonać Twojej aplikacji w trybie Offline podczas publikowania w sieci Web](http://sedodream.com/2012/01/08/HowToTakeYourWebAppOfflineDuringPublishing.aspx).</span><span class="sxs-lookup"><span data-stu-id="9feea-143">Sayed Ibrahim Hashimi describes one such approach in [How to Take Your Web App Offline During Publishing](http://sedodream.com/2012/01/08/HowToTakeYourWebAppOfflineDuringPublishing.aspx).</span></span>

<span data-ttu-id="9feea-144">Aby wdrożyć *aplikacji\_w trybie offline* pliku do docelowej witryny usług IIS, należy wywołać za pomocą MSDeploy.exe [narzędzia Web Deploy **contentPath** dostawcy](https://technet.microsoft.com/library/dd569034(WS.10).aspx).</span><span class="sxs-lookup"><span data-stu-id="9feea-144">To deploy an *App\_offline* file to a destination IIS website, you need to invoke MSDeploy.exe using the [Web Deploy **contentPath** provider](https://technet.microsoft.com/library/dd569034(WS.10).aspx).</span></span> <span data-ttu-id="9feea-145">**ContentPath** dostawca obsługuje zarówno ścieżki fizycznej katalogu i ścieżek witryny sieci Web lub aplikację usług IIS, co staje się on idealnym wyborem w przypadku synchronizacji plików między folderem projektu programu Visual Studio i aplikacji sieci web usług IIS.</span><span class="sxs-lookup"><span data-stu-id="9feea-145">The **contentPath** provider supports both physical directory paths and IIS website or application paths, which makes it the ideal choice for synchronizing a file between a Visual Studio project folder and an IIS web application.</span></span> <span data-ttu-id="9feea-146">Aby wdrożyć plik, polecenie MSDeploy powinien wyglądać następująco:</span><span class="sxs-lookup"><span data-stu-id="9feea-146">To deploy the file, your MSDeploy command should resemble this:</span></span>

[!code-console[Main](taking-web-applications-offline-with-web-deploy/samples/sample1.cmd)]

<span data-ttu-id="9feea-147">Aby usunąć plik z lokacji docelowej na końcu procesu wdrażania, polecenie MSDeploy powinien wyglądać następująco:</span><span class="sxs-lookup"><span data-stu-id="9feea-147">To remove the file from the destination site at the end of the deployment process, your MSDeploy command should resemble this:</span></span>

[!code-console[Main](taking-web-applications-offline-with-web-deploy/samples/sample2.cmd)]

<span data-ttu-id="9feea-148">Aby zautomatyzować te polecenia jako część procesu kompilacji i wdrożenia, należy zintegrować niestandardowego pliku projektu MSBuild.</span><span class="sxs-lookup"><span data-stu-id="9feea-148">To automate these commands as part of a build and deployment process, you need to integrate them into your custom MSBuild project file.</span></span> <span data-ttu-id="9feea-149">W następnej procedurze opisano jak to zrobić.</span><span class="sxs-lookup"><span data-stu-id="9feea-149">The next procedure describes how to do this.</span></span>

<span data-ttu-id="9feea-150">**Wdrażanie i usuwanie aplikacji\_pliku w trybie offline**</span><span class="sxs-lookup"><span data-stu-id="9feea-150">**To deploy and delete an App\_offline file**</span></span>

1. <span data-ttu-id="9feea-151">W programie Visual Studio 2010 należy otworzyć plik projektu MSBuild, który kontroluje proces wdrażania.</span><span class="sxs-lookup"><span data-stu-id="9feea-151">In Visual Studio 2010, open the MSBuild project file that controls your deployment process.</span></span> <span data-ttu-id="9feea-152">W [Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) przykładowe rozwiązanie to *Publish.proj* pliku.</span><span class="sxs-lookup"><span data-stu-id="9feea-152">In the [Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) sample solution, this is the *Publish.proj* file.</span></span>
2. <span data-ttu-id="9feea-153">W katalogu głównym **projektu** elementu, Utwórz nową **PropertyGroup** elementu do przechowywania zmiennych dotyczących *aplikacji\_offline* wdrożenia:</span><span class="sxs-lookup"><span data-stu-id="9feea-153">In the root **Project** element, create a new **PropertyGroup** element to store variables for the *App\_offline* deployment:</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample3.xml)]
3. <span data-ttu-id="9feea-154">**SourceRoot** właściwość jest zdefiniowana w innym miejscu w *Publish.proj* pliku.</span><span class="sxs-lookup"><span data-stu-id="9feea-154">The **SourceRoot** property is defined elsewhere in the *Publish.proj* file.</span></span> <span data-ttu-id="9feea-155">Oznacza to lokalizacja folderu głównego elementu zawartość źródłową względem bieżącej ścieżki&#x2014;innymi słowy, powiązane z lokalizacją *Publish.proj* pliku.</span><span class="sxs-lookup"><span data-stu-id="9feea-155">It indicates the location of the root folder for the source content relative to the current path&#x2014;in other words, relative to the location of the *Publish.proj* file.</span></span>
4. <span data-ttu-id="9feea-156">**ContentPath** dostawca nie będzie akceptować względnych ścieżek plików, więc należy uzyskać ścieżkę bezwzględną do pliku źródłowego, przed jego wdrożeniem.</span><span class="sxs-lookup"><span data-stu-id="9feea-156">The **contentPath** provider will not accept relative file paths, so you need to get an absolute path to your source file before you can deploy it.</span></span> <span data-ttu-id="9feea-157">Możesz użyć [converttoabsolutepath —](https://msdn.microsoft.com/library/bb882668.aspx) zadanie, aby to zrobić.</span><span class="sxs-lookup"><span data-stu-id="9feea-157">You can use the [ConvertToAbsolutePath](https://msdn.microsoft.com/library/bb882668.aspx) task to do this.</span></span>
5. <span data-ttu-id="9feea-158">Dodaj nową **docelowej** elementu o nazwie **GetAppOfflineAbsolutePath**.</span><span class="sxs-lookup"><span data-stu-id="9feea-158">Add a new **Target** element named **GetAppOfflineAbsolutePath**.</span></span> <span data-ttu-id="9feea-159">Ten element docelowy, użyj **converttoabsolutepath —** zadania, aby uzyskać ścieżkę bezwzględną do *aplikacji\_w trybie offline do szablonu* pliku w folderze projektu.</span><span class="sxs-lookup"><span data-stu-id="9feea-159">Within this target, use the **ConvertToAbsolutePath** task to get an absolute path to the *App\_offline-template* file in your project folder.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample4.xml)]
6. <span data-ttu-id="9feea-160">Ten element docelowy ma ścieżkę względną do *aplikacji\_w trybie offline do szablonu* pliku w folderze projektu i zapisuje go do nowej właściwości jako bezwzględną ścieżkę do pliku.</span><span class="sxs-lookup"><span data-stu-id="9feea-160">This target takes the relative path to the *App\_offline-template* file in your project folder and saves it to a new property as an absolute file path.</span></span> <span data-ttu-id="9feea-161">**BeforeTargets** atrybut określa, że ten element docelowy w celu wykonania przed **DeployAppOffline** docelowych, które utworzysz w następnym kroku.</span><span class="sxs-lookup"><span data-stu-id="9feea-161">The **BeforeTargets** attribute specifies that you want this target to execute before the **DeployAppOffline** target, which you'll create in the next step.</span></span>
7. <span data-ttu-id="9feea-162">Dodaj nowy obiekt docelowy o nazwie **DeployAppOffline**.</span><span class="sxs-lookup"><span data-stu-id="9feea-162">Add a new target named **DeployAppOffline**.</span></span> <span data-ttu-id="9feea-163">W ramach tego obiektu docelowego, wywołaj polecenie MSDeploy.exe, która wdraża usługi *aplikacji\_w trybie offline* pliku do docelowego serwera sieci web.</span><span class="sxs-lookup"><span data-stu-id="9feea-163">Within this target, invoke the MSDeploy.exe command that deploys your *App\_offline* file to the destination web server.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample5.xml)]
8. <span data-ttu-id="9feea-164">W tym przykładzie **ContactManagerIisPath** właściwość jest zdefiniowana w innym miejscu w pliku projektu.</span><span class="sxs-lookup"><span data-stu-id="9feea-164">In this example, the **ContactManagerIisPath** property is defined elsewhere in the project file.</span></span> <span data-ttu-id="9feea-165">Jest to po prostu ścieżka aplikacji IIS, w postaci *[nazwa witryny sieci Web usług IIS] / [Nazwa aplikacji]* .</span><span class="sxs-lookup"><span data-stu-id="9feea-165">This is simply an IIS application path, in the form *[IIS Website Name]/[Application Name]*.</span></span> <span data-ttu-id="9feea-166">W tym warunku w elemencie docelowym umożliwia użytkownikom *aplikacji\_offline* wdrożenia lub wyłączyć, zmieniając wartość właściwości lub podając parametr wiersza polecenia.</span><span class="sxs-lookup"><span data-stu-id="9feea-166">Including a condition in the target enables users to switch the *App\_offline* deployment on or off by changing a property value or providing a command-line parameter.</span></span>
9. <span data-ttu-id="9feea-167">Dodaj nowy obiekt docelowy o nazwie **DeleteAppOffline**.</span><span class="sxs-lookup"><span data-stu-id="9feea-167">Add a new target named **DeleteAppOffline**.</span></span> <span data-ttu-id="9feea-168">W ramach tego obiektu docelowego, wywołaj polecenie MSDeploy.exe, które powoduje usunięcie Twojego *aplikacji\_w trybie offline* pliku docelowego serwera sieci web.</span><span class="sxs-lookup"><span data-stu-id="9feea-168">Within this target, invoke the MSDeploy.exe command that removes your *App\_offline* file from the destination web server.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample6.xml)]
10. <span data-ttu-id="9feea-169">Ostatnim zadaniem jest wywołania te nowe obiekty docelowe w odpowiednich punktach podczas wykonywania pliku projektu.</span><span class="sxs-lookup"><span data-stu-id="9feea-169">The final task is to invoke these new targets at appropriate points during the execution of your project file.</span></span> <span data-ttu-id="9feea-170">Można to zrobić na różne sposoby.</span><span class="sxs-lookup"><span data-stu-id="9feea-170">You can do this in various ways.</span></span> <span data-ttu-id="9feea-171">Na przykład w *Publish.proj* pliku **FullPublishDependsOn** właściwość określa listę elementów docelowych, które muszą być wykonywane w kolejności, kiedy **FullPublish** domyślne docelowy jest wywoływana.</span><span class="sxs-lookup"><span data-stu-id="9feea-171">For example, in the *Publish.proj* file, the **FullPublishDependsOn** property specifies a list of targets that must be executed in order when the **FullPublish** default target is invoked.</span></span>
11. <span data-ttu-id="9feea-172">Modyfikowanie pliku projektu MSBuild do wywołania **DeployAppOffline** i **DeleteAppOffline** obiekty docelowe w odpowiednich miejscach w procesie publikowania.</span><span class="sxs-lookup"><span data-stu-id="9feea-172">Modify your MSBuild project file to invoke the **DeployAppOffline** and **DeleteAppOffline** targets at appropriate points in the publishing process.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample7.xml)]

<span data-ttu-id="9feea-173">Po uruchomieniu niestandardowego pliku projektu MSBuild *aplikacji\_offline* plik zostanie wdrożony na serwerze, natychmiast po pomyślnej kompilacji.</span><span class="sxs-lookup"><span data-stu-id="9feea-173">When you run your custom MSBuild project file, the *App\_offline* file will be deployed to the server immediately after a successful build.</span></span> <span data-ttu-id="9feea-174">Następnie będzie można usunąć z serwera po zakończeniu wszystkich zadań wdrażania.</span><span class="sxs-lookup"><span data-stu-id="9feea-174">It will then be deleted from the server once all the deployment tasks are complete.</span></span>

## <a name="adding-an-appoffline-file-to-deployment-packages"></a><span data-ttu-id="9feea-175">Dodawanie aplikacji\_pliku w trybie Offline do pakietów wdrożeniowych</span><span class="sxs-lookup"><span data-stu-id="9feea-175">Adding an App\_Offline File to Deployment Packages</span></span>

<span data-ttu-id="9feea-176">W zależności od tego, jak można skonfigurować wdrożenie, istniejących zawartości w lokalizacji docelowej usługi IIS aplikacji sieci web&#x2014;takich jak *aplikacji\_offline.htm* pliku&#x2014;mogą zostać usunięte automatycznie, gdy wdrożysz internetowy pakiet do miejsca docelowego.</span><span class="sxs-lookup"><span data-stu-id="9feea-176">Depending on how you configure your deployment, any existing content at the destination IIS web application&#x2014;like the *App\_offline.htm* file&#x2014;may be deleted automatically when you deploy a web package to the destination.</span></span> <span data-ttu-id="9feea-177">Aby upewnić się, że *aplikacji\_offline.htm* plik pozostaje w miejscu w czasie trwania operacji wdrożenia, musisz uwzględnić plik w obrębie samego pakietu wdrożeniowego sieci web, dodatkowo wdrażanie pliku bezpośrednio na początku proces wdrażania.</span><span class="sxs-lookup"><span data-stu-id="9feea-177">To ensure that the *App\_offline.htm* file remains in place for the duration of the deployment, you need to include the file within the web deployment package itself in addition to deploying the file directly at the start of the deployment process.</span></span>

- <span data-ttu-id="9feea-178">Jeśli wykonano poprzednich zadań w tym temacie, będziesz dodano *aplikacji\_offline.htm* plik do projektu aplikacji sieci web w ramach innej nazwy pliku (użyliśmy *aplikacji\_ w trybie offline template.htm*) i będzie mieć Ustaw akcję kompilacji **Brak**.</span><span class="sxs-lookup"><span data-stu-id="9feea-178">If you've followed the previous tasks in this topic, you'll have added the *App\_offline.htm* file to your web application project under a different filename (we used *App\_offline-template.htm*) and you'll have set the build action to **None**.</span></span> <span data-ttu-id="9feea-179">Zmiany te są konieczne, aby zapobiec plik z nie zakłócają programowanie i debugowanie.</span><span class="sxs-lookup"><span data-stu-id="9feea-179">These changes are necessary to prevent the file from interfering with development and debugging.</span></span> <span data-ttu-id="9feea-180">Dlatego należy dostosować proces pakowania, aby upewnić się, że *aplikacji\_offline.htm* plik jest uwzględniony w pakiecie wdrożeniowym sieci web.</span><span class="sxs-lookup"><span data-stu-id="9feea-180">As a result, you need to customize the packaging process to ensure that the *App\_offline.htm* file is included in the web deployment package.</span></span>

<span data-ttu-id="9feea-181">Web potok publikowania (WPP) używa listy elementów o nazwie **FilesForPackagingFromProject** umożliwia tworzenie listy plików, które powinny być uwzględnione w pakiecie wdrożeniowym sieci web.</span><span class="sxs-lookup"><span data-stu-id="9feea-181">The Web Publishing Pipeline (WPP) uses an item list named **FilesForPackagingFromProject** to build a list of files that should be included in the web deployment package.</span></span> <span data-ttu-id="9feea-182">Zawartość sieci web pakiety można dostosować, dodając własne elementy do tej listy.</span><span class="sxs-lookup"><span data-stu-id="9feea-182">You can customize the contents of your web packages by adding your own items to this list.</span></span> <span data-ttu-id="9feea-183">Aby to zrobić, należy wykonać następujące czynności wysokiego poziomu:</span><span class="sxs-lookup"><span data-stu-id="9feea-183">To do this, you need to complete these high-level steps:</span></span>

1. <span data-ttu-id="9feea-184">Tworzenie niestandardowego projektu pliku o nazwie *.wpp.targets [Nazwa projektu]* w tym samym folderze co plik projektu.</span><span class="sxs-lookup"><span data-stu-id="9feea-184">Create a custom project file named *[project name].wpp.targets* in the same folder as your project file.</span></span>

    > [!NOTE]
    > <span data-ttu-id="9feea-185">*. Wpp.targets* plik ma znaleźć się w tym samym folderze co plik projektu aplikacji sieci web&#x2014;na przykład *ContactManager.Mvc.csproj*&#x2014;, a nie w tym samym folderze co niestandardowe pliki projektu, których używasz do kontrolowania procesu kompilacji i wdrażania.</span><span class="sxs-lookup"><span data-stu-id="9feea-185">The *.wpp.targets* file needs to go in the same folder as your web application project file&#x2014;for example, *ContactManager.Mvc.csproj*&#x2014;rather than in the same folder as any custom project files you use to control the build and deployment process.</span></span>
2. <span data-ttu-id="9feea-186">W *. wpp.targets* plików, Utwórz nowy obiekt docelowy programu MSBuild, który jest wykonywany *przed* **CopyAllFilesToSingleFolderForPackage** docelowej.</span><span class="sxs-lookup"><span data-stu-id="9feea-186">In the *.wpp.targets* file, create a new MSBuild target that executes *before* the **CopyAllFilesToSingleFolderForPackage** target.</span></span> <span data-ttu-id="9feea-187">Jest to element docelowy WPP, który tworzy listę rzeczy, które należy uwzględnić w pakiecie.</span><span class="sxs-lookup"><span data-stu-id="9feea-187">This is the WPP target that builds a list of things to include in the package.</span></span>
3. <span data-ttu-id="9feea-188">W nowej lokalizacji docelowej, należy utworzyć **ItemGroup** elementu.</span><span class="sxs-lookup"><span data-stu-id="9feea-188">In the new target, create an **ItemGroup** element.</span></span>
4. <span data-ttu-id="9feea-189">W **ItemGroup** elementu Dodawanie **FilesForPackagingFromProject** elementu, a następnie określ *aplikacji\_offline.htm* pliku.</span><span class="sxs-lookup"><span data-stu-id="9feea-189">In the **ItemGroup** element, add a **FilesForPackagingFromProject** item and specify the *App\_offline.htm* file.</span></span>

<span data-ttu-id="9feea-190">*. Wpp.targets* pliku powinna wyglądać następująco:</span><span class="sxs-lookup"><span data-stu-id="9feea-190">The *.wpp.targets* file should resemble this:</span></span>

[!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample8.xml)]

<span data-ttu-id="9feea-191">Oto kluczowe punkty Uwaga w tym przykładzie:</span><span class="sxs-lookup"><span data-stu-id="9feea-191">These are the key points of note in this example:</span></span>

- <span data-ttu-id="9feea-192">**BeforeTargets** atrybut wstawia ten element docelowy do WPP, określając, który ma być wykonany bezpośrednio przed **CopyAllFilesToSingleFolderForPackage** docelowej.</span><span class="sxs-lookup"><span data-stu-id="9feea-192">The **BeforeTargets** attribute inserts this target into the WPP by specifying that it should be executed immediately before the **CopyAllFilesToSingleFolderForPackage** target.</span></span>
- <span data-ttu-id="9feea-193">**FilesForPackagingFromProject** elementu używa **DestinationRelativePath** wartości metadanych można zmienić nazwy pliku z *aplikacji\_offline template.htm* Aby *aplikacji\_offline.htm* jest dodawany do listy.</span><span class="sxs-lookup"><span data-stu-id="9feea-193">The **FilesForPackagingFromProject** item uses the **DestinationRelativePath** metadata value to rename the file from *App\_offline-template.htm* to *App\_offline.htm* as it's added to the list.</span></span>

<span data-ttu-id="9feea-194">Następna procedura dowiesz się, jak dodać to *. wpp.targets* plik do projektu aplikacji sieci web.</span><span class="sxs-lookup"><span data-stu-id="9feea-194">The next procedure shows you how to add this *.wpp.targets* file to a web application project.</span></span>

<span data-ttu-id="9feea-195">**Aby dodać. wpp.targets pliku do pakietu wdrożeniowego sieci web**</span><span class="sxs-lookup"><span data-stu-id="9feea-195">**To add a .wpp.targets file to a web deployment package**</span></span>

1. <span data-ttu-id="9feea-196">Otwórz swoje rozwiązanie w programie Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="9feea-196">Open your solution in Visual Studio 2010.</span></span>
2. <span data-ttu-id="9feea-197">W **Eksploratora rozwiązań** okna, kliknij prawym przyciskiem myszy węzeł projektu aplikacji sieci web (na przykład **ContactManager.Mvc**), wskaż polecenie **Dodaj**, a następnie kliknij przycisk **Nowy element**.</span><span class="sxs-lookup"><span data-stu-id="9feea-197">In the **Solution Explorer** window, right-click your web application project node (for example, **ContactManager.Mvc**), point to **Add**, and then click **New Item**.</span></span>
3. <span data-ttu-id="9feea-198">W **Dodaj nowy element** okno dialogowe, wybierz opcję **pliku XML** szablonu.</span><span class="sxs-lookup"><span data-stu-id="9feea-198">In the **Add New Item** dialog box, select the **XML File** template.</span></span>
4. <span data-ttu-id="9feea-199">W **nazwa** wpisz *[Nazwa projektu]* **.wpp.targets** (na przykład **ContactManager.Mvc.wpp.targets**), a następnie kliknij przycisk **Dodaj**.</span><span class="sxs-lookup"><span data-stu-id="9feea-199">In the **Name** box, type *[project name]\*\*\*.wpp.targets*\* (for example, **ContactManager.Mvc.wpp.targets**), and then click **Add**.</span></span>

    ![](taking-web-applications-offline-with-web-deploy/_static/image4.png)

    > [!NOTE]
    > <span data-ttu-id="9feea-200">Jeśli dodasz nowy element do węzła głównego projektu, plik jest tworzony w tym samym folderze co plik projektu.</span><span class="sxs-lookup"><span data-stu-id="9feea-200">If you add a new item to the root node of a project, the file is created in the same folder as the project file.</span></span> <span data-ttu-id="9feea-201">Można to sprawdzić, otwierając folder w Eksploratorze Windows.</span><span class="sxs-lookup"><span data-stu-id="9feea-201">You can verify this by opening the folder in Windows Explorer.</span></span>
5. <span data-ttu-id="9feea-202">W pliku należy dodać znaczniki MSBuild opisanych powyżej.</span><span class="sxs-lookup"><span data-stu-id="9feea-202">In the file, add the MSBuild markup described previously.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample9.xml)]
6. <span data-ttu-id="9feea-203">Zapisz i Zamknij *.wpp.targets [Nazwa projektu]* pliku.</span><span class="sxs-lookup"><span data-stu-id="9feea-203">Save and close the *[project name].wpp.targets* file.</span></span>

<span data-ttu-id="9feea-204">Przy kolejnym uruchomieniu kompilowanie i tworzenie pakietu projektu aplikacji sieci web, potok WPP automatycznie wykryje *. wpp.targets* pliku.</span><span class="sxs-lookup"><span data-stu-id="9feea-204">The next time you build and package your web application project, the WPP will automatically detect the *.wpp.targets* file.</span></span> <span data-ttu-id="9feea-205">*Aplikacji\_offline template.htm* plik zostanie uwzględniony w wynikowej pakiecie wdrożeniowym sieci web jako *aplikacji\_offline.htm*.</span><span class="sxs-lookup"><span data-stu-id="9feea-205">The *App\_offline-template.htm* file will be included in the resulting web deployment package as *App\_offline.htm*.</span></span>

> [!NOTE]
> <span data-ttu-id="9feea-206">W przypadku niepowodzenia wdrożenia *aplikacji\_offline.htm* plik pozostanie w miejscu, a aplikacja będzie pozostawać w trybie offline.</span><span class="sxs-lookup"><span data-stu-id="9feea-206">If your deployment fails, the *App\_offline.htm* file will remain in place and your application will remain offline.</span></span> <span data-ttu-id="9feea-207">Jest to zazwyczaj żądane zachowanie.</span><span class="sxs-lookup"><span data-stu-id="9feea-207">This is typically the desired behavior.</span></span> <span data-ttu-id="9feea-208">Aby wyświetlić aplikację trybu online, możesz usunąć *aplikacji\_offline.htm* plików z serwera sieci web.</span><span class="sxs-lookup"><span data-stu-id="9feea-208">To bring your application back online, you can delete the *App\_offline.htm* file from your web server.</span></span> <span data-ttu-id="9feea-209">Alternatywnie, jeśli Usuń wszelkie błędy i uruchom pomyślne wdrożenie *aplikacji\_offline.htm* plik zostanie usunięty.</span><span class="sxs-lookup"><span data-stu-id="9feea-209">Alternatively, if you correct any errors and run a successful deployment, the *App\_offline.htm* file will be removed.</span></span>

## <a name="conclusion"></a><span data-ttu-id="9feea-210">Wniosek</span><span class="sxs-lookup"><span data-stu-id="9feea-210">Conclusion</span></span>

<span data-ttu-id="9feea-211">W tym temacie opisano sposób wykonania aplikacji sieci web w trybie offline na czas trwania rozmieszczania, poprzez publikowanie *aplikacji\_offline.htm* pliku na serwer docelowy, na początku procesu wdrażania i usuwanie na stronie Zakończenie.</span><span class="sxs-lookup"><span data-stu-id="9feea-211">This topic described how to take a web application offline for the duration of a deployment, by publishing an *App\_offline.htm* file to the destination server at the start of the deployment process and removing it at the end.</span></span> <span data-ttu-id="9feea-212">Również przedstawione instrukcje obejmują *aplikacji\_offline.htm* plików w pakiecie wdrożeniowym sieci web.</span><span class="sxs-lookup"><span data-stu-id="9feea-212">It also covered how to include an *App\_offline.htm* file in a web deployment package.</span></span>

## <a name="further-reading"></a><span data-ttu-id="9feea-213">Dalsze informacje</span><span class="sxs-lookup"><span data-stu-id="9feea-213">Further Reading</span></span>

<span data-ttu-id="9feea-214">Aby uzyskać więcej informacji na temat tworzenia pakietów i proces wdrażania, zobacz [budowanie i projektów aplikacji sieci Web pakietu](../web-deployment-in-the-enterprise/building-and-packaging-web-application-projects.md), [konfigurowania parametrów wdrożenia pakietu internetowego](../web-deployment-in-the-enterprise/configuring-parameters-for-web-package-deployment.md), i [ Wdrażanie pakietów internetowych](../web-deployment-in-the-enterprise/deploying-web-packages.md).</span><span class="sxs-lookup"><span data-stu-id="9feea-214">For more information on the packaging and deployment process, see [Building and Packaging Web Application Projects](../web-deployment-in-the-enterprise/building-and-packaging-web-application-projects.md), [Configuring Parameters for Web Package Deployment](../web-deployment-in-the-enterprise/configuring-parameters-for-web-package-deployment.md), and [Deploying Web Packages](../web-deployment-in-the-enterprise/deploying-web-packages.md).</span></span>

<span data-ttu-id="9feea-215">Jeśli publikowanie aplikacji sieci web bezpośrednio z programu Visual Studio, a nie przy użyciu metody pliku niestandardowego projektu MSBuild opisane w tych samouczkach, musisz użyć nieco innego podejścia do wykonania aplikacji w trybie offline podczas publikowania proces.</span><span class="sxs-lookup"><span data-stu-id="9feea-215">If you publish your web applications directly from Visual Studio, rather than using the custom MSBuild project file approach described in these tutorials, you'll need to use a slightly different approach to take your application offline during the publishing process.</span></span> <span data-ttu-id="9feea-216">Aby uzyskać więcej informacji, zobacz [sposób wykonania aplikacji sieci web w trybie offline podczas publikowania](https://go.microsoft.com/?linkid=9805135) (wpis na blogu).</span><span class="sxs-lookup"><span data-stu-id="9feea-216">For more information, see [How to take your web app offline during publishing](https://go.microsoft.com/?linkid=9805135) (blog post).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="9feea-217">[Poprzednie](excluding-files-and-folders-from-deployment.md)
> [dalej](running-windows-powershell-scripts-from-msbuild-project-files.md)</span><span class="sxs-lookup"><span data-stu-id="9feea-217">[Previous](excluding-files-and-folders-from-deployment.md)
[Next](running-windows-powershell-scripts-from-msbuild-project-files.md)</span></span>
