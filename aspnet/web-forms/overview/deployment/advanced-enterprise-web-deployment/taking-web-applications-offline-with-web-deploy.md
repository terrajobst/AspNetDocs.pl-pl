---
uid: web-forms/overview/deployment/advanced-enterprise-web-deployment/taking-web-applications-offline-with-web-deploy
title: Przełączanie aplikacji sieci Web w tryb offline za pomocą Web Deploy | Microsoft Docs
author: jrjlee
description: W tym temacie opisano, jak przełączyć aplikację sieci Web w tryb offline na czas wdrażania automatycznego przy Internet Information Services użyciu Depl (IIS) sieci Web...
ms.author: riande
ms.date: 05/04/2012
ms.assetid: 3e9f6e7d-8967-4586-94d5-d3a122f12529
msc.legacyurl: /web-forms/overview/deployment/advanced-enterprise-web-deployment/taking-web-applications-offline-with-web-deploy
msc.type: authoredcontent
ms.openlocfilehash: ba60664a0c3daa0650cd7e7cfc4ab9da08df3440
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 03/06/2020
ms.locfileid: "78526069"
---
# <a name="taking-web-applications-offline-with-web-deploy"></a><span data-ttu-id="380fc-103">Przełączanie aplikacji internetowych w tryb offline za pomocą narzędzia Web Deploy</span><span class="sxs-lookup"><span data-stu-id="380fc-103">Taking Web Applications Offline with Web Deploy</span></span>

<span data-ttu-id="380fc-104">Autor [Jason Lewandowski](https://github.com/jrjlee)</span><span class="sxs-lookup"><span data-stu-id="380fc-104">by [Jason Lee](https://github.com/jrjlee)</span></span>

[<span data-ttu-id="380fc-105">Pobierz plik PDF</span><span class="sxs-lookup"><span data-stu-id="380fc-105">Download PDF</span></span>](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> <span data-ttu-id="380fc-106">W tym temacie opisano, jak przełączyć aplikację sieci Web w tryb offline na czas wdrażania automatycznego przy użyciu Web Deploy narzędzia Web Deployment Internet Information Services (IIS).</span><span class="sxs-lookup"><span data-stu-id="380fc-106">This topic describes how to take a web application offline for the duration of an automated deployment using the Internet Information Services (IIS) Web Deployment Tool (Web Deploy).</span></span> <span data-ttu-id="380fc-107">Użytkownicy przeglądający aplikację sieci Web są przekierowywani do *aplikacji\_pliku offline. htm* do momentu ukończenia wdrożenia.</span><span class="sxs-lookup"><span data-stu-id="380fc-107">Users who browse to the web application are redirected to an *App\_offline.htm* file until the deployment is complete.</span></span>

<span data-ttu-id="380fc-108">Ten temat stanowi część szeregu samouczków opartych na wymaganiach dotyczących wdrażania w przedsiębiorstwie fikcyjnej firmy o nazwie Fabrikam, Inc. W tej serii samouczków jest stosowane&#x2014;przykładowe rozwiązanie&#x2014;do reprezentowania aplikacji sieci Web, [które ma](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)realistyczny poziom złożoności, w tym aplikacji ASP.NET MVC 3, usługi Windows Communication Foundation (WCF) i projektu bazy danych.</span><span class="sxs-lookup"><span data-stu-id="380fc-108">This topic forms part of a series of tutorials based around the enterprise deployment requirements of a fictional company named Fabrikam, Inc. This tutorial series uses a sample solution&#x2014;the [Contact Manager solution](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;to represent a web application with a realistic level of complexity, including an ASP.NET MVC 3 application, a Windows Communication Foundation (WCF) service, and a database project.</span></span>

<span data-ttu-id="380fc-109">Metoda wdrażania w tym samouczku jest oparta na rozłożeniu pliku projektu dzielonego opisanym w artykule [Omówienie pliku projektu](../web-deployment-in-the-enterprise/understanding-the-project-file.md), w którym proces kompilacji jest kontrolowany przez dwa pliki&#x2014;projektu, zawierający instrukcje kompilacji, które mają zastosowanie do każdego środowiska docelowego, oraz jeden zawierający ustawienia kompilacji i wdrożenia specyficznego dla środowiska.</span><span class="sxs-lookup"><span data-stu-id="380fc-109">The deployment method at the heart of these tutorials is based on the split project file approach described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md), in which the build process is controlled by two project files&#x2014;one containing build instructions that apply to every destination environment, and one containing environment-specific build and deployment settings.</span></span> <span data-ttu-id="380fc-110">W czasie kompilacji plik projektu specyficzny dla środowiska jest scalany z plikiem projektu Environment-niezależny od w celu utworzenia kompletnego zestawu instrukcji kompilacji.</span><span class="sxs-lookup"><span data-stu-id="380fc-110">At build time, the environment-specific project file is merged into the environment-agnostic project file to form a complete set of build instructions.</span></span>

## <a name="task-overview"></a><span data-ttu-id="380fc-111">Przegląd zadania</span><span class="sxs-lookup"><span data-stu-id="380fc-111">Task Overview</span></span>

<span data-ttu-id="380fc-112">W wielu scenariuszach warto przełączyć aplikację sieci Web w tryb offline podczas wprowadzania zmian w powiązanych składnikach, takich jak bazy danych lub usługi sieci Web.</span><span class="sxs-lookup"><span data-stu-id="380fc-112">In a lot of scenarios, you'll want to take a web application offline while you make changes to related components, like databases or web services.</span></span> <span data-ttu-id="380fc-113">Zazwyczaj w usługach IIS i ASP.NET można to zrobić, umieszczając plik o nazwie *App\_offline. htm* w folderze głównym witryny sieci Web lub aplikacji sieci Web usług IIS.</span><span class="sxs-lookup"><span data-stu-id="380fc-113">Typically, in IIS and ASP.NET, you accomplish this by placing a file named *App\_offline.htm* in the root folder of the IIS website or web application.</span></span> <span data-ttu-id="380fc-114">*Aplikacja\_w trybie offline. htm* jest standardowym plikiem HTML i zwykle zawiera prosty komunikat doradzający użytkownikowi, że lokacja jest tymczasowo niedostępna z powodu konserwacji.</span><span class="sxs-lookup"><span data-stu-id="380fc-114">The *App\_offline.htm* file is a standard HTML file and will usually contain a simple message advising the user that the site is temporarily unavailable due to maintenance.</span></span> <span data-ttu-id="380fc-115">Gdy *aplikacja\_plik w trybie offline. htm* istnieje w folderze głównym witryny sieci Web, usługi IIS automatycznie przekierują wszelkie żądania do pliku.</span><span class="sxs-lookup"><span data-stu-id="380fc-115">While the *App\_offline.htm* file exists in the root folder of the website, IIS will automatically redirect any requests to the file.</span></span> <span data-ttu-id="380fc-116">Po zakończeniu wprowadzania aktualizacji należy usunąć *aplikację\_pliku offline. htm* , a witryna sieci Web wznawia obsługę żądań w zwykły sposób.</span><span class="sxs-lookup"><span data-stu-id="380fc-116">When you've finished making updates, you remove the *App\_offline.htm* file and the website resumes serving requests as usual.</span></span>

<span data-ttu-id="380fc-117">W przypadku używania Web Deploy do wykonywania zautomatyzowanych lub jednoetapowych wdrożeń w środowisku docelowym warto dodać i usunąć *aplikację\_pliku offline. htm* do procesu wdrożenia.</span><span class="sxs-lookup"><span data-stu-id="380fc-117">When you use Web Deploy to perform automated or single-step deployments to a target environment, you may want to incorporate adding and removing the *App\_offline.htm* file into your deployment process.</span></span> <span data-ttu-id="380fc-118">W tym celu należy wykonać te zadania wysokiego poziomu:</span><span class="sxs-lookup"><span data-stu-id="380fc-118">To do this, you'll need to complete these high-level tasks:</span></span>

- <span data-ttu-id="380fc-119">W pliku projektu Microsoft Build Engine (MSBuild), który służy do kontrolowania procesu wdrażania, Utwórz obiekt docelowy programu MSBuild, który kopiuje *aplikację\_pliku offline. htm* na serwer docelowy przed rozpoczęciem wykonywania jakichkolwiek zadań wdrażania.</span><span class="sxs-lookup"><span data-stu-id="380fc-119">In the Microsoft Build Engine (MSBuild) project file that you use to control the deployment process, create an MSBuild target that copies an *App\_offline.htm* file to the destination server before any deployment tasks begin.</span></span>
- <span data-ttu-id="380fc-120">Dodaj inny obiekt docelowy MSBuild, który usuwa *aplikację\_pliku offline. htm* z serwera docelowego po zakończeniu wszystkich zadań wdrażania.</span><span class="sxs-lookup"><span data-stu-id="380fc-120">Add another MSBuild target that removes the *App\_offline.htm* file from the destination server when all deployment tasks are complete.</span></span>
- <span data-ttu-id="380fc-121">W projekcie aplikacji sieci Web Utwórz plik *. WPP. targets* , który zapewnia, że *aplikacja\_w trybie offline. htm* zostanie dodana do pakietu wdrożeniowego, gdy Web Deploy jest wywoływana.</span><span class="sxs-lookup"><span data-stu-id="380fc-121">In the web application project, create a *.wpp.targets* file that ensures that an *App\_offline.htm* file is added to the deployment package when Web Deploy is invoked.</span></span>

<span data-ttu-id="380fc-122">W tym temacie pokazano, jak wykonać te procedury.</span><span class="sxs-lookup"><span data-stu-id="380fc-122">This topic will show you how to perform these procedures.</span></span> <span data-ttu-id="380fc-123">W zadaniach i instruktażach w tym temacie przyjęto założenie, że utworzono już rozwiązanie, które zawiera co najmniej jeden projekt aplikacji sieci Web, i że można użyć niestandardowego pliku projektu w celu sterowania procesem wdrażania zgodnie z opisem w artykule [wdrażanie w przedsiębiorstwie w sieci Web](../web-deployment-in-the-enterprise/web-deployment-in-the-enterprise.md).</span><span class="sxs-lookup"><span data-stu-id="380fc-123">The tasks and walkthroughs in this topic assume that you've already created a solution that contains at least one web application project, and that you use a custom project file to control the deployment process as described in [Web Deployment in the Enterprise](../web-deployment-in-the-enterprise/web-deployment-in-the-enterprise.md).</span></span> <span data-ttu-id="380fc-124">Alternatywnie możesz użyć przykładowego rozwiązania [Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) , aby postępować zgodnie z przykładami w temacie.</span><span class="sxs-lookup"><span data-stu-id="380fc-124">Alternatively, you can use the [Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) sample solution to follow the examples in the topic.</span></span>

## <a name="adding-an-app_offline-file-to-a-web-application-project"></a><span data-ttu-id="380fc-125">Dodawanie aplikacji\_pliku offline do projektu aplikacji sieci Web</span><span class="sxs-lookup"><span data-stu-id="380fc-125">Adding an App\_Offline File to a Web Application Project</span></span>

<span data-ttu-id="380fc-126">Pierwsze zadanie, które należy wykonać, to dodanie *aplikacji\_pliku offline* do projektu aplikacji sieci Web:</span><span class="sxs-lookup"><span data-stu-id="380fc-126">The first task you need to complete is to add an *App\_offline* file to your web application project:</span></span>

- <span data-ttu-id="380fc-127">Aby zapobiec zakłócaniu działania pliku przez proces opracowywania (nie chcesz, aby aplikacja była trwale w trybie offline), należy wywołać ją coś innego niż *aplikacja\_offline. htm*.</span><span class="sxs-lookup"><span data-stu-id="380fc-127">To prevent the file from interfering with the development process (you don't want your application to be permanently offline), you should call it something other than *App\_offline.htm*.</span></span> <span data-ttu-id="380fc-128">Można na przykład nazwać *aplikację pliku\_offline-Template. htm*.</span><span class="sxs-lookup"><span data-stu-id="380fc-128">For example, you could name the file *App\_offline-template.htm*.</span></span>
- <span data-ttu-id="380fc-129">Aby zapobiec wdrażaniu pliku jako-is, należy ustawić akcję kompilacja na **Brak**.</span><span class="sxs-lookup"><span data-stu-id="380fc-129">To prevent the file from being deployed as-is, you should set the build action to **None**.</span></span>

<span data-ttu-id="380fc-130">**Aby dodać aplikację\_pliku offline do projektu aplikacji sieci Web**</span><span class="sxs-lookup"><span data-stu-id="380fc-130">**To add an App\_offline file to a web application project**</span></span>

1. <span data-ttu-id="380fc-131">Otwórz rozwiązanie w programie Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="380fc-131">Open your solution in Visual Studio 2010.</span></span>
2. <span data-ttu-id="380fc-132">W oknie **Eksplorator rozwiązań** kliknij prawym przyciskiem myszy projekt aplikacji sieci Web, wskaż polecenie **Dodaj**, a następnie kliknij pozycję **nowy element**.</span><span class="sxs-lookup"><span data-stu-id="380fc-132">In the **Solution Explorer** window, right-click your web application project, point to **Add**, and then click **New Item**.</span></span>
3. <span data-ttu-id="380fc-133">W oknie dialogowym **Dodaj nowy element** wybierz pozycję **strona HTML**.</span><span class="sxs-lookup"><span data-stu-id="380fc-133">In the **Add New Item** dialog box, select **HTML Page**.</span></span>
4. <span data-ttu-id="380fc-134">W polu **Nazwa** wpisz **App\_offline-Template. htm**, a następnie kliknij przycisk **Dodaj**.</span><span class="sxs-lookup"><span data-stu-id="380fc-134">In the **Name** box, type **App\_offline-template.htm**, and then click **Add**.</span></span>

    ![](taking-web-applications-offline-with-web-deploy/_static/image1.png)
5. <span data-ttu-id="380fc-135">Dodaj prosty kod HTML, aby poinformować użytkowników, że aplikacja jest niedostępna, a następnie Zapisz plik.</span><span class="sxs-lookup"><span data-stu-id="380fc-135">Add some simple HTML to inform users that the application is unavailable, and then save the file.</span></span> <span data-ttu-id="380fc-136">Nie dołączaj żadnych tagów po stronie serwera (na przykład żadnych tagów, które są poprzedzone prefiksem "ASP:").</span><span class="sxs-lookup"><span data-stu-id="380fc-136">Do not include any server-side tags (for example, any tags that are prefixed with "asp:").</span></span> 

    ![](taking-web-applications-offline-with-web-deploy/_static/image2.png)
6. <span data-ttu-id="380fc-137">W oknie **Eksplorator rozwiązań** kliknij prawym przyciskiem myszy nowy plik, a następnie kliknij polecenie **Właściwości**.</span><span class="sxs-lookup"><span data-stu-id="380fc-137">In the **Solution Explorer** window, right-click the new file, and then click **Properties**.</span></span>
7. <span data-ttu-id="380fc-138">W oknie **Właściwości** , w wierszu **akcji kompilacji** , wybierz **Brak**.</span><span class="sxs-lookup"><span data-stu-id="380fc-138">In the **Properties** window, in the **Build Action** row, select **None**.</span></span>

    ![](taking-web-applications-offline-with-web-deploy/_static/image3.png)

## <a name="deploying-and-deleting-an-app_offline-file"></a><span data-ttu-id="380fc-139">Wdrażanie i usuwanie aplikacji\_pliku offline</span><span class="sxs-lookup"><span data-stu-id="380fc-139">Deploying and Deleting an App\_Offline File</span></span>

<span data-ttu-id="380fc-140">Następnym krokiem jest zmodyfikowanie logiki wdrożenia w celu skopiowania pliku na serwer docelowy na początku procesu wdrażania i usunięcie go na końcu.</span><span class="sxs-lookup"><span data-stu-id="380fc-140">The next step is to modify your deployment logic to copy the file to the destination server at the start of the deployment process and remove it at the end.</span></span>

> [!NOTE]
> <span data-ttu-id="380fc-141">W następnej procedurze przyjęto założenie, że używasz niestandardowego pliku projektu MSBuild do kontrolowania procesu wdrażania, zgodnie z opisem w artykule [Omówienie pliku projektu](../web-deployment-in-the-enterprise/understanding-the-project-file.md).</span><span class="sxs-lookup"><span data-stu-id="380fc-141">The next procedure assumes that you're using a custom MSBuild project file to control your deployment process, as described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md).</span></span> <span data-ttu-id="380fc-142">Jeśli wdrażasz bezpośrednio z programu Visual Studio, musisz użyć innego podejścia.</span><span class="sxs-lookup"><span data-stu-id="380fc-142">If you're deploying direct from Visual Studio, you'll need to use a different approach.</span></span> <span data-ttu-id="380fc-143">Sayed Ibrahim Hashimi opisuje jedno z tych [metod w celu przełączenia aplikacji sieci Web w tryb offline podczas publikowania](http://sedodream.com/2012/01/08/HowToTakeYourWebAppOfflineDuringPublishing.aspx).</span><span class="sxs-lookup"><span data-stu-id="380fc-143">Sayed Ibrahim Hashimi describes one such approach in [How to Take Your Web App Offline During Publishing](http://sedodream.com/2012/01/08/HowToTakeYourWebAppOfflineDuringPublishing.aspx).</span></span>

<span data-ttu-id="380fc-144">Aby wdrożyć *aplikację\_pliku offline* w docelowej witrynie sieci Web usług IIS, należy wywołać program MSDeploy. exe przy użyciu [dostawcy Web Deploy **contentPath** ](https://technet.microsoft.com/library/dd569034(WS.10).aspx).</span><span class="sxs-lookup"><span data-stu-id="380fc-144">To deploy an *App\_offline* file to a destination IIS website, you need to invoke MSDeploy.exe using the [Web Deploy **contentPath** provider](https://technet.microsoft.com/library/dd569034(WS.10).aspx).</span></span> <span data-ttu-id="380fc-145">Dostawca **contentPath** obsługuje zarówno ścieżki katalogów fizycznych, jak i witryny sieci Web IIS lub ścieżki aplikacji, co sprawia, że jest idealnym wyborem w przypadku synchronizacji pliku między folderem projektu programu Visual Studio i aplikacją sieci Web usług IIS.</span><span class="sxs-lookup"><span data-stu-id="380fc-145">The **contentPath** provider supports both physical directory paths and IIS website or application paths, which makes it the ideal choice for synchronizing a file between a Visual Studio project folder and an IIS web application.</span></span> <span data-ttu-id="380fc-146">Aby wdrożyć plik, polecenie MSDeploy powinno wyglądać następująco:</span><span class="sxs-lookup"><span data-stu-id="380fc-146">To deploy the file, your MSDeploy command should resemble this:</span></span>

[!code-console[Main](taking-web-applications-offline-with-web-deploy/samples/sample1.cmd)]

<span data-ttu-id="380fc-147">Aby usunąć plik z lokacji docelowej na końcu procesu wdrażania, polecenie MSDeploy powinno wyglądać następująco:</span><span class="sxs-lookup"><span data-stu-id="380fc-147">To remove the file from the destination site at the end of the deployment process, your MSDeploy command should resemble this:</span></span>

[!code-console[Main](taking-web-applications-offline-with-web-deploy/samples/sample2.cmd)]

<span data-ttu-id="380fc-148">Aby zautomatyzować te polecenia w ramach procesu kompilowania i wdrażania, należy zintegrować je z niestandardowym plikiem projektu programu MSBuild.</span><span class="sxs-lookup"><span data-stu-id="380fc-148">To automate these commands as part of a build and deployment process, you need to integrate them into your custom MSBuild project file.</span></span> <span data-ttu-id="380fc-149">W następnej procedurze opisano, jak to zrobić.</span><span class="sxs-lookup"><span data-stu-id="380fc-149">The next procedure describes how to do this.</span></span>

<span data-ttu-id="380fc-150">**Aby wdrożyć i usunąć aplikację\_pliku offline**</span><span class="sxs-lookup"><span data-stu-id="380fc-150">**To deploy and delete an App\_offline file**</span></span>

1. <span data-ttu-id="380fc-151">W programie Visual Studio 2010 Otwórz plik projektu MSBuild, który kontroluje proces wdrożenia.</span><span class="sxs-lookup"><span data-stu-id="380fc-151">In Visual Studio 2010, open the MSBuild project file that controls your deployment process.</span></span> <span data-ttu-id="380fc-152">W przykładowym rozwiązaniu [Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) jest to plik *Publish. proj* .</span><span class="sxs-lookup"><span data-stu-id="380fc-152">In the [Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) sample solution, this is the *Publish.proj* file.</span></span>
2. <span data-ttu-id="380fc-153">W elemencie główny **projekt** Utwórz nowy element **Właściwości** , aby przechowywać zmienne dla *aplikacji\_wdrożenie w trybie offline* :</span><span class="sxs-lookup"><span data-stu-id="380fc-153">In the root **Project** element, create a new **PropertyGroup** element to store variables for the *App\_offline* deployment:</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample3.xml)]
3. <span data-ttu-id="380fc-154">Właściwość **SourceRoot** jest definiowana w innym miejscu w pliku *Publish. proj* .</span><span class="sxs-lookup"><span data-stu-id="380fc-154">The **SourceRoot** property is defined elsewhere in the *Publish.proj* file.</span></span> <span data-ttu-id="380fc-155">Wskazuje lokalizację folderu głównego dla zawartości źródłowej względem bieżącej ścieżki&#x2014;, w odniesieniu do lokalizacji pliku *Publish. proj* .</span><span class="sxs-lookup"><span data-stu-id="380fc-155">It indicates the location of the root folder for the source content relative to the current path&#x2014;in other words, relative to the location of the *Publish.proj* file.</span></span>
4. <span data-ttu-id="380fc-156">Dostawca **contentPath** nie akceptuje względnych ścieżek plików, dlatego przed wdrożeniem należy uzyskać ścieżkę bezwzględną do pliku źródłowego.</span><span class="sxs-lookup"><span data-stu-id="380fc-156">The **contentPath** provider will not accept relative file paths, so you need to get an absolute path to your source file before you can deploy it.</span></span> <span data-ttu-id="380fc-157">W tym celu można użyć zadania [ConvertToAbsolutePath —](https://msdn.microsoft.com/library/bb882668.aspx) .</span><span class="sxs-lookup"><span data-stu-id="380fc-157">You can use the [ConvertToAbsolutePath](https://msdn.microsoft.com/library/bb882668.aspx) task to do this.</span></span>
5. <span data-ttu-id="380fc-158">Dodaj nowy element **docelowy** o nazwie **GetAppOfflineAbsolutePath**.</span><span class="sxs-lookup"><span data-stu-id="380fc-158">Add a new **Target** element named **GetAppOfflineAbsolutePath**.</span></span> <span data-ttu-id="380fc-159">W tym elemencie docelowym Użyj zadania **ConvertToAbsolutePath —** , aby uzyskać bezwzględną ścieżkę do *aplikacji\_pliku szablonu offline* w folderze projektu.</span><span class="sxs-lookup"><span data-stu-id="380fc-159">Within this target, use the **ConvertToAbsolutePath** task to get an absolute path to the *App\_offline-template* file in your project folder.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample4.xml)]
6. <span data-ttu-id="380fc-160">Ten obiekt docelowy Pobiera ścieżkę względną do *aplikacji\_pliku szablonu offline* w folderze projektu i zapisuje ją na nowej właściwości jako bezwzględną ścieżkę do pliku.</span><span class="sxs-lookup"><span data-stu-id="380fc-160">This target takes the relative path to the *App\_offline-template* file in your project folder and saves it to a new property as an absolute file path.</span></span> <span data-ttu-id="380fc-161">Atrybut **BeforeTargets** określa, że ten element docelowy ma być wykonywany przed obiektem docelowym **DeployAppOffline** , który zostanie utworzony w następnym kroku.</span><span class="sxs-lookup"><span data-stu-id="380fc-161">The **BeforeTargets** attribute specifies that you want this target to execute before the **DeployAppOffline** target, which you'll create in the next step.</span></span>
7. <span data-ttu-id="380fc-162">Dodaj nowy element docelowy o nazwie **DeployAppOffline**.</span><span class="sxs-lookup"><span data-stu-id="380fc-162">Add a new target named **DeployAppOffline**.</span></span> <span data-ttu-id="380fc-163">W tym elemencie docelowym Wywołaj polecenie MSDeploy. exe, które wdraża *aplikację\_pliku offline* na docelowym serwerze sieci Web.</span><span class="sxs-lookup"><span data-stu-id="380fc-163">Within this target, invoke the MSDeploy.exe command that deploys your *App\_offline* file to the destination web server.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample5.xml)]
8. <span data-ttu-id="380fc-164">W tym przykładzie właściwość **ContactManagerIisPath** jest zdefiniowana w innym miejscu w pliku projektu.</span><span class="sxs-lookup"><span data-stu-id="380fc-164">In this example, the **ContactManagerIisPath** property is defined elsewhere in the project file.</span></span> <span data-ttu-id="380fc-165">Jest to po prostu ścieżka aplikacji IIS, w postaci *[nazwa witryny sieci Web usług IIS]/[nazwa aplikacji]* .</span><span class="sxs-lookup"><span data-stu-id="380fc-165">This is simply an IIS application path, in the form *[IIS Website Name]/[Application Name]*.</span></span> <span data-ttu-id="380fc-166">Dołączenie warunku do elementu docelowego umożliwia użytkownikom przełączanie *aplikacji\_wdrożenie w trybie offline* lub wyłączenie jej przez zmianę wartości właściwości lub podanie parametru wiersza polecenia.</span><span class="sxs-lookup"><span data-stu-id="380fc-166">Including a condition in the target enables users to switch the *App\_offline* deployment on or off by changing a property value or providing a command-line parameter.</span></span>
9. <span data-ttu-id="380fc-167">Dodaj nowy element docelowy o nazwie **DeleteAppOffline**.</span><span class="sxs-lookup"><span data-stu-id="380fc-167">Add a new target named **DeleteAppOffline**.</span></span> <span data-ttu-id="380fc-168">W tym elemencie docelowym Wywołaj polecenie MSDeploy. exe, które usuwa *aplikację\_pliku offline* z docelowego serwera sieci Web.</span><span class="sxs-lookup"><span data-stu-id="380fc-168">Within this target, invoke the MSDeploy.exe command that removes your *App\_offline* file from the destination web server.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample6.xml)]
10. <span data-ttu-id="380fc-169">Ostatnim zadaniem jest wywołanie tych nowych obiektów docelowych w odpowiednich punktach podczas wykonywania pliku projektu.</span><span class="sxs-lookup"><span data-stu-id="380fc-169">The final task is to invoke these new targets at appropriate points during the execution of your project file.</span></span> <span data-ttu-id="380fc-170">Można to zrobić na różne sposoby.</span><span class="sxs-lookup"><span data-stu-id="380fc-170">You can do this in various ways.</span></span> <span data-ttu-id="380fc-171">Na przykład w pliku *Publish. proj* Właściwość **FullPublishDependsOn** określa listę elementów docelowych, które muszą zostać wykonane w kolejności, gdy zostanie wywołana domyślna wartość docelowa **FullPublish** .</span><span class="sxs-lookup"><span data-stu-id="380fc-171">For example, in the *Publish.proj* file, the **FullPublishDependsOn** property specifies a list of targets that must be executed in order when the **FullPublish** default target is invoked.</span></span>
11. <span data-ttu-id="380fc-172">Zmodyfikuj plik projektu programu MSBuild, aby wywoływać elementy docelowe **DeployAppOffline** i **DeleteAppOffline** w odpowiednich punktach procesu publikowania.</span><span class="sxs-lookup"><span data-stu-id="380fc-172">Modify your MSBuild project file to invoke the **DeployAppOffline** and **DeleteAppOffline** targets at appropriate points in the publishing process.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample7.xml)]

<span data-ttu-id="380fc-173">Po uruchomieniu niestandardowego pliku projektu programu MSBuild *aplikacja\_pliku offline* zostanie wdrożona na serwerze bezpośrednio po pomyślnej kompilacji.</span><span class="sxs-lookup"><span data-stu-id="380fc-173">When you run your custom MSBuild project file, the *App\_offline* file will be deployed to the server immediately after a successful build.</span></span> <span data-ttu-id="380fc-174">Po zakończeniu wszystkich zadań wdrażania zostanie on usunięty z serwera.</span><span class="sxs-lookup"><span data-stu-id="380fc-174">It will then be deleted from the server once all the deployment tasks are complete.</span></span>

## <a name="adding-an-app_offline-file-to-deployment-packages"></a><span data-ttu-id="380fc-175">Dodawanie aplikacji\_pliku offline do pakietów wdrożeniowych</span><span class="sxs-lookup"><span data-stu-id="380fc-175">Adding an App\_Offline File to Deployment Packages</span></span>

<span data-ttu-id="380fc-176">W zależności od sposobu skonfigurowania wdrożenia każda istniejąca zawartość w docelowej aplikacji&#x2014;sieci Web usług IIS, taka jak *aplikacja\_pliku* &#x2014;offline. htm, może zostać usunięta automatycznie podczas wdrażania pakietu internetowego do miejsca docelowego.</span><span class="sxs-lookup"><span data-stu-id="380fc-176">Depending on how you configure your deployment, any existing content at the destination IIS web application&#x2014;like the *App\_offline.htm* file&#x2014;may be deleted automatically when you deploy a web package to the destination.</span></span> <span data-ttu-id="380fc-177">Aby upewnić się, że *aplikacja\_w trybie offline. htm* na czas wdrażania, należy dołączyć plik do samego pakietu wdrażania w sieci Web, a nie wdrożyć go bezpośrednio na początku procesu wdrażania.</span><span class="sxs-lookup"><span data-stu-id="380fc-177">To ensure that the *App\_offline.htm* file remains in place for the duration of the deployment, you need to include the file within the web deployment package itself in addition to deploying the file directly at the start of the deployment process.</span></span>

- <span data-ttu-id="380fc-178">Jeśli poprzednie zadania zostały wykonane w tym temacie, dodasz *aplikację\_pliku offline. htm* do projektu aplikacji sieci Web pod inną nazwą pliku (użyto *aplikacji\_offline-Template. htm*) i ustawisz akcję kompilacji na **none**.</span><span class="sxs-lookup"><span data-stu-id="380fc-178">If you've followed the previous tasks in this topic, you'll have added the *App\_offline.htm* file to your web application project under a different filename (we used *App\_offline-template.htm*) and you'll have set the build action to **None**.</span></span> <span data-ttu-id="380fc-179">Te zmiany są niezbędne, aby zapobiec zakłócaniu działania pliku podczas tworzenia i debugowania.</span><span class="sxs-lookup"><span data-stu-id="380fc-179">These changes are necessary to prevent the file from interfering with development and debugging.</span></span> <span data-ttu-id="380fc-180">W związku z tym należy dostosować proces tworzenia pakietów, aby upewnić się, że *aplikacja\_w trybie offline. htm* jest dołączona do pakietu wdrożeniowego sieci Web.</span><span class="sxs-lookup"><span data-stu-id="380fc-180">As a result, you need to customize the packaging process to ensure that the *App\_offline.htm* file is included in the web deployment package.</span></span>

<span data-ttu-id="380fc-181">Potok publikowania w sieci Web (WPP) używa listy elementów o nazwie **FilesForPackagingFromProject** w celu utworzenia listy plików, które powinny być dołączone do pakietu wdrożeniowego sieci Web.</span><span class="sxs-lookup"><span data-stu-id="380fc-181">The Web Publishing Pipeline (WPP) uses an item list named **FilesForPackagingFromProject** to build a list of files that should be included in the web deployment package.</span></span> <span data-ttu-id="380fc-182">Zawartość pakietów sieci Web można dostosować, dodając własne elementy do tej listy.</span><span class="sxs-lookup"><span data-stu-id="380fc-182">You can customize the contents of your web packages by adding your own items to this list.</span></span> <span data-ttu-id="380fc-183">W tym celu należy wykonać następujące czynności wysokiego poziomu:</span><span class="sxs-lookup"><span data-stu-id="380fc-183">To do this, you need to complete these high-level steps:</span></span>

1. <span data-ttu-id="380fc-184">Utwórz niestandardowy plik projektu o nazwie *[nazwa projektu]. WPP. targets* w tym samym folderze, w którym znajduje się plik projektu.</span><span class="sxs-lookup"><span data-stu-id="380fc-184">Create a custom project file named *[project name].wpp.targets* in the same folder as your project file.</span></span>

    > [!NOTE]
    > <span data-ttu-id="380fc-185">Plik *. WPP. targets* musi być w tym samym folderze, w którym znajduje się plik&#x2014;projektu aplikacji sieci Web, na przykład *ContactManager. MVC. csproj*&#x2014;, a nie w tym samym folderze, co pliki niestandardowego projektu używane do kontrolowania procesu kompilacji i wdrożenia.</span><span class="sxs-lookup"><span data-stu-id="380fc-185">The *.wpp.targets* file needs to go in the same folder as your web application project file&#x2014;for example, *ContactManager.Mvc.csproj*&#x2014;rather than in the same folder as any custom project files you use to control the build and deployment process.</span></span>
2. <span data-ttu-id="380fc-186">W pliku *. WPP. targets* Utwórz nowy obiekt docelowy MSBuild, który jest wykonywany *przed* elementem docelowym **CopyAllFilesToSingleFolderForPackage** .</span><span class="sxs-lookup"><span data-stu-id="380fc-186">In the *.wpp.targets* file, create a new MSBuild target that executes *before* the **CopyAllFilesToSingleFolderForPackage** target.</span></span> <span data-ttu-id="380fc-187">Jest to element docelowy WPP, który tworzy listę elementów do uwzględnienia w pakiecie.</span><span class="sxs-lookup"><span data-stu-id="380fc-187">This is the WPP target that builds a list of things to include in the package.</span></span>
3. <span data-ttu-id="380fc-188">W nowym miejscu docelowym Utwórz element **Item** .</span><span class="sxs-lookup"><span data-stu-id="380fc-188">In the new target, create an **ItemGroup** element.</span></span>
4. <span data-ttu-id="380fc-189">W elemencie **element** , Dodaj element **FilesForPackagingFromProject** i określ *aplikację\_pliku offline. htm* .</span><span class="sxs-lookup"><span data-stu-id="380fc-189">In the **ItemGroup** element, add a **FilesForPackagingFromProject** item and specify the *App\_offline.htm* file.</span></span>

<span data-ttu-id="380fc-190">Plik *. WPP. targets* powinien wyglądać następująco:</span><span class="sxs-lookup"><span data-stu-id="380fc-190">The *.wpp.targets* file should resemble this:</span></span>

[!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample8.xml)]

<span data-ttu-id="380fc-191">Oto kluczowe punkty uwagi w tym przykładzie:</span><span class="sxs-lookup"><span data-stu-id="380fc-191">These are the key points of note in this example:</span></span>

- <span data-ttu-id="380fc-192">Atrybut **BeforeTargets** wstawia ten cel do WPP, określając, że powinien być wykonany bezpośrednio przed elementem docelowym **CopyAllFilesToSingleFolderForPackage** .</span><span class="sxs-lookup"><span data-stu-id="380fc-192">The **BeforeTargets** attribute inserts this target into the WPP by specifying that it should be executed immediately before the **CopyAllFilesToSingleFolderForPackage** target.</span></span>
- <span data-ttu-id="380fc-193">Element **FilesForPackagingFromProject** używa wartości metadanych **DestinationRelativePath** , aby zmienić nazwę pliku z *aplikacji\_offline-template. htm* na *aplikację\_offline. htm* , gdy zostanie on dodany do listy.</span><span class="sxs-lookup"><span data-stu-id="380fc-193">The **FilesForPackagingFromProject** item uses the **DestinationRelativePath** metadata value to rename the file from *App\_offline-template.htm* to *App\_offline.htm* as it's added to the list.</span></span>

<span data-ttu-id="380fc-194">Następna procedura pokazuje, jak dodać plik *. WPP. targets* do projektu aplikacji sieci Web.</span><span class="sxs-lookup"><span data-stu-id="380fc-194">The next procedure shows you how to add this *.wpp.targets* file to a web application project.</span></span>

<span data-ttu-id="380fc-195">**Aby dodać plik. WPP. targets do pakietu wdrożeniowego sieci Web**</span><span class="sxs-lookup"><span data-stu-id="380fc-195">**To add a .wpp.targets file to a web deployment package**</span></span>

1. <span data-ttu-id="380fc-196">Otwórz rozwiązanie w programie Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="380fc-196">Open your solution in Visual Studio 2010.</span></span>
2. <span data-ttu-id="380fc-197">W oknie **Eksplorator rozwiązań** kliknij prawym przyciskiem myszy węzeł projektu aplikacji sieci Web (na przykład **ContactManager. MVC**), wskaż polecenie **Dodaj**, a następnie kliknij pozycję **nowy element**.</span><span class="sxs-lookup"><span data-stu-id="380fc-197">In the **Solution Explorer** window, right-click your web application project node (for example, **ContactManager.Mvc**), point to **Add**, and then click **New Item**.</span></span>
3. <span data-ttu-id="380fc-198">W oknie dialogowym **Dodaj nowy element** wybierz szablon **pliku XML** .</span><span class="sxs-lookup"><span data-stu-id="380fc-198">In the **Add New Item** dialog box, select the **XML File** template.</span></span>
4. <span data-ttu-id="380fc-199">W polu **Nazwa** wpisz *[nazwa projektu] \* \* *. WPP. targets** (na przykład **ContactManager. MVC. WPP. targets**), a następnie kliknij przycisk **Dodaj**.</span><span class="sxs-lookup"><span data-stu-id="380fc-199">In the **Name** box, type *[project name]\*\*\*.wpp.targets*\* (for example, **ContactManager.Mvc.wpp.targets**), and then click **Add**.</span></span>

    ![](taking-web-applications-offline-with-web-deploy/_static/image4.png)

    > [!NOTE]
    > <span data-ttu-id="380fc-200">W przypadku dodania nowego elementu do węzła głównego projektu, plik zostanie utworzony w tym samym folderze, w którym znajduje się plik projektu.</span><span class="sxs-lookup"><span data-stu-id="380fc-200">If you add a new item to the root node of a project, the file is created in the same folder as the project file.</span></span> <span data-ttu-id="380fc-201">Można to sprawdzić, otwierając folder w Eksploratorze Windows.</span><span class="sxs-lookup"><span data-stu-id="380fc-201">You can verify this by opening the folder in Windows Explorer.</span></span>
5. <span data-ttu-id="380fc-202">W pliku Dodaj opisane wcześniej znaczniki programu MSBuild.</span><span class="sxs-lookup"><span data-stu-id="380fc-202">In the file, add the MSBuild markup described previously.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample9.xml)]
6. <span data-ttu-id="380fc-203">Zapisz i zamknij plik *[nazwa projektu]. WPP. targets* .</span><span class="sxs-lookup"><span data-stu-id="380fc-203">Save and close the *[project name].wpp.targets* file.</span></span>

<span data-ttu-id="380fc-204">Podczas następnego kompilowania i pakowania projektu aplikacji sieci Web WPP automatycznie wykryje plik *. WPP. targets* .</span><span class="sxs-lookup"><span data-stu-id="380fc-204">The next time you build and package your web application project, the WPP will automatically detect the *.wpp.targets* file.</span></span> <span data-ttu-id="380fc-205">*Aplikacja\_offline-Template. htm* zostanie uwzględniona w utworzonym pakiecie wdrożeniowym sieci Web jako *aplikacja\_offline. htm*.</span><span class="sxs-lookup"><span data-stu-id="380fc-205">The *App\_offline-template.htm* file will be included in the resulting web deployment package as *App\_offline.htm*.</span></span>

> [!NOTE]
> <span data-ttu-id="380fc-206">Jeśli wdrożenie nie powiedzie się, *aplikacja\_plik w trybie offline. htm* pozostanie na miejscu, a aplikacja pozostanie w trybie offline.</span><span class="sxs-lookup"><span data-stu-id="380fc-206">If your deployment fails, the *App\_offline.htm* file will remain in place and your application will remain offline.</span></span> <span data-ttu-id="380fc-207">Jest to zwykle wymagane zachowanie.</span><span class="sxs-lookup"><span data-stu-id="380fc-207">This is typically the desired behavior.</span></span> <span data-ttu-id="380fc-208">Aby przywrócić aplikację do trybu online, możesz usunąć *aplikację\_pliku offline. htm* z serwera sieci Web.</span><span class="sxs-lookup"><span data-stu-id="380fc-208">To bring your application back online, you can delete the *App\_offline.htm* file from your web server.</span></span> <span data-ttu-id="380fc-209">Alternatywnie, jeśli poprawisz wszelkie błędy i uruchomisz pomyślne wdrożenie, *aplikacja\_pliku offline. htm* zostanie usunięta.</span><span class="sxs-lookup"><span data-stu-id="380fc-209">Alternatively, if you correct any errors and run a successful deployment, the *App\_offline.htm* file will be removed.</span></span>

## <a name="conclusion"></a><span data-ttu-id="380fc-210">Podsumowanie</span><span class="sxs-lookup"><span data-stu-id="380fc-210">Conclusion</span></span>

<span data-ttu-id="380fc-211">W tym temacie opisano, jak przełączyć aplikację sieci Web w tryb offline na czas trwania wdrożenia, publikując *aplikację\_pliku offline. htm* na serwerze docelowym na początku procesu wdrażania i usuwając ją na końcu.</span><span class="sxs-lookup"><span data-stu-id="380fc-211">This topic described how to take a web application offline for the duration of a deployment, by publishing an *App\_offline.htm* file to the destination server at the start of the deployment process and removing it at the end.</span></span> <span data-ttu-id="380fc-212">Uwzględniono również sposób dołączania *aplikacji\_pliku offline. htm* w pakiecie wdrożeniowym sieci Web.</span><span class="sxs-lookup"><span data-stu-id="380fc-212">It also covered how to include an *App\_offline.htm* file in a web deployment package.</span></span>

## <a name="further-reading"></a><span data-ttu-id="380fc-213">Dalsze informacje</span><span class="sxs-lookup"><span data-stu-id="380fc-213">Further Reading</span></span>

<span data-ttu-id="380fc-214">Aby uzyskać więcej informacji o procesie pakowania i wdrażania, zobacz [Kompilowanie i pakowanie projektów aplikacji sieci Web](../web-deployment-in-the-enterprise/building-and-packaging-web-application-projects.md), [Konfigurowanie parametrów wdrażania pakietów sieci Web](../web-deployment-in-the-enterprise/configuring-parameters-for-web-package-deployment.md)i [wdrażanie pakietów internetowych](../web-deployment-in-the-enterprise/deploying-web-packages.md).</span><span class="sxs-lookup"><span data-stu-id="380fc-214">For more information on the packaging and deployment process, see [Building and Packaging Web Application Projects](../web-deployment-in-the-enterprise/building-and-packaging-web-application-projects.md), [Configuring Parameters for Web Package Deployment](../web-deployment-in-the-enterprise/configuring-parameters-for-web-package-deployment.md), and [Deploying Web Packages](../web-deployment-in-the-enterprise/deploying-web-packages.md).</span></span>

<span data-ttu-id="380fc-215">W przypadku publikowania aplikacji sieci Web bezpośrednio z programu Visual Studio, zamiast korzystać z niestandardowego podejścia do pliku projektu MSBuild opisanego w tych samouczkach, należy użyć nieco innego podejścia do przełączenia aplikacji w tryb offline podczas publikowania podstawowych.</span><span class="sxs-lookup"><span data-stu-id="380fc-215">If you publish your web applications directly from Visual Studio, rather than using the custom MSBuild project file approach described in these tutorials, you'll need to use a slightly different approach to take your application offline during the publishing process.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="380fc-216">[Poprzednie](excluding-files-and-folders-from-deployment.md)
> [dalej](running-windows-powershell-scripts-from-msbuild-project-files.md)</span><span class="sxs-lookup"><span data-stu-id="380fc-216">[Previous](excluding-files-and-folders-from-deployment.md)
[Next](running-windows-powershell-scripts-from-msbuild-project-files.md)</span></span>
