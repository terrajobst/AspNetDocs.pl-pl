---
uid: web-forms/overview/performance-and-caching/using-asynchronous-methods-in-aspnet-45
title: Korzystanie z metod asynchronicznych w ASP.NET 4,5 | Microsoft Docs
author: Rick-Anderson
description: Ten samouczek zawiera informacje na temat tworzenia asynchronicznej aplikacji ASP.NET Web Forms przy użyciu Visual Studio Express 2012 dla sieci Web, która jest bezpłatna...
ms.author: riande
ms.date: 01/02/2019
ms.assetid: a585c9a2-7c8e-478b-9706-90f3739c50d1
msc.legacyurl: /web-forms/overview/performance-and-caching/using-asynchronous-methods-in-aspnet-45
msc.type: authoredcontent
ms.openlocfilehash: 7abc3d7acc60d7d868958f2a313bc408f96c95a4
ms.sourcegitcommit: 7709c0a091b8d55b7b33bad8849f7b66b23c3d72
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 02/19/2020
ms.locfileid: "77457573"
---
# <a name="using-asynchronous-methods-in-aspnet-45"></a><span data-ttu-id="44ac7-103">Używanie metod asynchronicznych na platformie ASP.NET 4.5</span><span class="sxs-lookup"><span data-stu-id="44ac7-103">Using Asynchronous Methods in ASP.NET 4.5</span></span>

<span data-ttu-id="44ac7-104">Autor [Rick Anderson](https://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="44ac7-104">by [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

> <span data-ttu-id="44ac7-105">Ten samouczek zawiera informacje na temat tworzenia aplikacji ASP.NET Web Forms asynchronicznie przy użyciu [Visual Studio Express 2012 dla sieci Web](https://www.microsoft.com/visualstudio/11), która jest bezpłatną wersją Microsoft Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="44ac7-105">This tutorial will teach you the basics of building an asynchronous ASP.NET Web Forms application using [Visual Studio Express 2012 for Web](https://www.microsoft.com/visualstudio/11), which is a free version of Microsoft Visual Studio.</span></span> <span data-ttu-id="44ac7-106">Możesz również użyć [programu Visual Studio 2012](https://www.microsoft.com/visualstudio/11).</span><span class="sxs-lookup"><span data-stu-id="44ac7-106">You can also use [Visual Studio 2012](https://www.microsoft.com/visualstudio/11).</span></span> <span data-ttu-id="44ac7-107">Poniższe sekcje zostały uwzględnione w tym samouczku.</span><span class="sxs-lookup"><span data-stu-id="44ac7-107">The following sections are included in this tutorial.</span></span>
> 
> - [<span data-ttu-id="44ac7-108">Jak żądania są przetwarzane przez pulę wątków</span><span class="sxs-lookup"><span data-stu-id="44ac7-108">How Requests Are Processed by the Thread Pool</span></span>](#HowRequestsProcessedByTP)
> - [<span data-ttu-id="44ac7-109">Wybieranie metod synchronicznych lub asynchronicznych</span><span class="sxs-lookup"><span data-stu-id="44ac7-109">Choosing Synchronous or Asynchronous Methods</span></span>](#ChoosingSyncVasync)
> - [<span data-ttu-id="44ac7-110">Przykładowa aplikacja</span><span class="sxs-lookup"><span data-stu-id="44ac7-110">The Sample Application</span></span>](#SampleApp)
> - [<span data-ttu-id="44ac7-111">Strona synchroniczna elementy Gizmo</span><span class="sxs-lookup"><span data-stu-id="44ac7-111">The Gizmos Synchronous Page</span></span>](#GizmosSynch)
> - [<span data-ttu-id="44ac7-112">Tworzenie asynchronicznej strony elementy Gizmo</span><span class="sxs-lookup"><span data-stu-id="44ac7-112">Creating an Asynchronous Gizmos Page</span></span>](#CreatingAsynchGizmos)
> - [<span data-ttu-id="44ac7-113">Wykonywanie wielu operacji równolegle</span><span class="sxs-lookup"><span data-stu-id="44ac7-113">Performing Multiple Operations in Parallel</span></span>](#Parallel)
> - [<span data-ttu-id="44ac7-114">Korzystanie z tokenu anulowania</span><span class="sxs-lookup"><span data-stu-id="44ac7-114">Using a Cancellation Token</span></span>](#CancelToken)
> - [<span data-ttu-id="44ac7-115">Konfiguracja serwera dla wywołań usługi sieci Web o wysokim poziomie współbieżności/dużych opóźnień</span><span class="sxs-lookup"><span data-stu-id="44ac7-115">Server Configuration for High Concurrency/High Latency Web Service Calls</span></span>](#ServerConfig)
> 
> <span data-ttu-id="44ac7-116">Pełny przykład jest dostępny dla tego samouczka w</span><span class="sxs-lookup"><span data-stu-id="44ac7-116">A complete sample is provided for this tutorial at</span></span>  
> <span data-ttu-id="44ac7-117">[https://github.com/RickAndMSFT/Async-ASP.NET/](https://github.com/RickAndMSFT/Async-ASP.NET/) w witrynie [GitHub](https://github.com/) .</span><span class="sxs-lookup"><span data-stu-id="44ac7-117">[https://github.com/RickAndMSFT/Async-ASP.NET/](https://github.com/RickAndMSFT/Async-ASP.NET/) on the [GitHub](https://github.com/) site.</span></span>

<span data-ttu-id="44ac7-118">ASP.NET 4,5 strony sieci Web w połączeniu z [platformą .net 4,5](https://msdn.microsoft.com/library/w0x726c2(VS.110).aspx) umożliwiają rejestrowanie metod asynchronicznych zwracających obiekt typu [zadanie](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx).</span><span class="sxs-lookup"><span data-stu-id="44ac7-118">ASP.NET 4.5 Web Pages in combination [.NET 4.5](https://msdn.microsoft.com/library/w0x726c2(VS.110).aspx) enables you to register asynchronous methods that return an object of type [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx).</span></span> <span data-ttu-id="44ac7-119">W .NET Framework 4 wprowadzono asynchroniczną koncepcję programistyczną, o której mowa jako [zadanie](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) i ASP.NET 4,5 obsługuje [zadanie](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx).</span><span class="sxs-lookup"><span data-stu-id="44ac7-119">The .NET Framework 4 introduced an asynchronous programming concept referred to as a [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) and ASP.NET 4.5 supports [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx).</span></span> <span data-ttu-id="44ac7-120">Zadania są reprezentowane przez typ **zadania** i powiązane typy w przestrzeni nazw [System. Threading. Tasks](https://msdn.microsoft.com/library/system.threading.tasks.aspx) .</span><span class="sxs-lookup"><span data-stu-id="44ac7-120">Tasks are represented by the **Task** type and related types in the [System.Threading.Tasks](https://msdn.microsoft.com/library/system.threading.tasks.aspx) namespace.</span></span> <span data-ttu-id="44ac7-121">.NET Framework 4,5 jest oparta na tej asynchronicznej obsłudze z słowami kluczowymi [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) i [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) , które współpracują z obiektami [zadań](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) znacznie mniej skomplikowane niż poprzednie podejście asynchroniczne.</span><span class="sxs-lookup"><span data-stu-id="44ac7-121">The .NET Framework 4.5 builds on this asynchronous support with the [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) and [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keywords that make working with [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) objects much less complex than previous asynchronous approaches.</span></span> <span data-ttu-id="44ac7-122">Słowo kluczowe [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) jest skrótową składnią wskazującą, że fragment kodu powinien asynchronicznie oczekiwać na inne fragmenty kodu.</span><span class="sxs-lookup"><span data-stu-id="44ac7-122">The [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) keyword is syntactical shorthand for indicating that a piece of code should asynchronously wait on some other piece of code.</span></span> <span data-ttu-id="44ac7-123">Słowo kluczowe [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) reprezentuje wskazówkę, której można użyć do oznaczenia metod jako metod asynchronicznych opartych na zadaniach.</span><span class="sxs-lookup"><span data-stu-id="44ac7-123">The [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keyword represents a hint that you can use to mark methods as task-based asynchronous methods.</span></span> <span data-ttu-id="44ac7-124">Połączenie obiektów **await**, **Async**i **Task** ułatwia pisanie kodu asynchronicznego w programie .NET 4,5.</span><span class="sxs-lookup"><span data-stu-id="44ac7-124">The combination of **await**, **async**, and the **Task** object makes it much easier for you to write asynchronous code in .NET 4.5.</span></span> <span data-ttu-id="44ac7-125">Nowy model metod asynchronicznych jest nazywany *wzorcem asynchronicznym opartym na zadaniach* (**TAP**).</span><span class="sxs-lookup"><span data-stu-id="44ac7-125">The new model for asynchronous methods is called the *Task-based Asynchronous Pattern* (**TAP**).</span></span> <span data-ttu-id="44ac7-126">W tym samouczku założono, że masz pewną wiedzę z funkcją asynchronicznego programowania przy użyciu słów kluczowych [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) i [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) oraz przestrzeni nazw [zadań](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) .</span><span class="sxs-lookup"><span data-stu-id="44ac7-126">This tutorial assumes you have some familiarity with asynchronous programing using [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) and [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keywords and the [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) namespace.</span></span>

<span data-ttu-id="44ac7-127">Aby uzyskać więcej informacji na temat używania [oczekujących](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) i [asynchronicznych](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) słów kluczowych oraz przestrzeni nazw [zadań](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) , zobacz następujące odwołania.</span><span class="sxs-lookup"><span data-stu-id="44ac7-127">For more information on the using [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) and [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keywords and the [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) namespace, see the following references.</span></span>

- [<span data-ttu-id="44ac7-128">Oficjalny dokument: asynchroniczności na platformie .NET</span><span class="sxs-lookup"><span data-stu-id="44ac7-128">Whitepaper: Asynchrony in .NET</span></span>](https://go.microsoft.com/fwlink/?LinkId=204844)
- [<span data-ttu-id="44ac7-129">Asynchroniczne/await — często zadawane pytania</span><span class="sxs-lookup"><span data-stu-id="44ac7-129">Async/Await FAQ</span></span>](https://blogs.msdn.com/b/pfxteam/archive/2012/04/12/10293335.aspx)
- [<span data-ttu-id="44ac7-130">Programowanie asynchroniczne programu Visual Studio</span><span class="sxs-lookup"><span data-stu-id="44ac7-130">Visual Studio Asynchronous Programming</span></span>](https://msdn.microsoft.com/vstudio/gg316360)

## <a id="HowRequestsProcessedByTP"></a><span data-ttu-id="44ac7-131">Jak żądania są przetwarzane przez pulę wątków</span><span class="sxs-lookup"><span data-stu-id="44ac7-131">How Requests Are Processed by the Thread Pool</span></span>

<span data-ttu-id="44ac7-132">Na serwerze sieci Web .NET Framework obsługuje pulę wątków, które są używane do obsługi żądań ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="44ac7-132">On the web server, the .NET Framework maintains a pool of threads that are used to service ASP.NET requests.</span></span> <span data-ttu-id="44ac7-133">Po nadejściu żądania wątek z puli jest wysyłany w celu przetworzenia tego żądania.</span><span class="sxs-lookup"><span data-stu-id="44ac7-133">When a request arrives, a thread from the pool is dispatched to process that request.</span></span> <span data-ttu-id="44ac7-134">Jeśli żądanie jest przetwarzane synchronicznie, wątek, który przetwarza żądanie, jest zajęty podczas przetwarzania żądania, a ten wątek nie może obsłużyć innego żądania.</span><span class="sxs-lookup"><span data-stu-id="44ac7-134">If the request is processed synchronously, the thread that processes the request is busy while the request is being processed, and that thread cannot service another request.</span></span>   
  
<span data-ttu-id="44ac7-135">Może to nie być problem, ponieważ pula wątków może być zbyt duża, aby pomieścić wiele zajętych wątków.</span><span class="sxs-lookup"><span data-stu-id="44ac7-135">This might not be a problem, because the thread pool can be made large enough to accommodate many busy threads.</span></span> <span data-ttu-id="44ac7-136">Liczba wątków w puli wątków jest jednak ograniczona (domyślna wartość maksymalna dla programu .NET 4,5 to 5 000).</span><span class="sxs-lookup"><span data-stu-id="44ac7-136">However, the number of threads in the thread pool is limited (the default maximum for .NET 4.5 is 5,000).</span></span> <span data-ttu-id="44ac7-137">W dużych aplikacjach z wysokim poziomem współbieżności długotrwałych żądań wszystkie dostępne wątki mogą być zajęte.</span><span class="sxs-lookup"><span data-stu-id="44ac7-137">In large applications with high concurrency of long-running requests, all available threads might be busy.</span></span> <span data-ttu-id="44ac7-138">Ten stan jest określany jako zablokowanie wątku.</span><span class="sxs-lookup"><span data-stu-id="44ac7-138">This condition is known as thread starvation.</span></span> <span data-ttu-id="44ac7-139">Po osiągnięciu tego warunku serwer sieci Web będzie kolejkować żądania.</span><span class="sxs-lookup"><span data-stu-id="44ac7-139">When this condition is reached, the web server queues requests.</span></span> <span data-ttu-id="44ac7-140">Jeśli kolejka żądań zostanie zapełniona, serwer sieci Web odrzuca żądania ze stanem HTTP 503 (serwer jest zbyt zajęty).</span><span class="sxs-lookup"><span data-stu-id="44ac7-140">If the request queue becomes full, the web server rejects requests with an HTTP 503 status (Server Too Busy).</span></span> <span data-ttu-id="44ac7-141">Pula wątków CLR ma ograniczenia dotyczące nowych iniekcji wątków.</span><span class="sxs-lookup"><span data-stu-id="44ac7-141">The CLR thread pool has limitations on new thread injections.</span></span> <span data-ttu-id="44ac7-142">Jeśli współbieżność odbywa się na rozerwanie (oznacza to, że witryna sieci Web może nagle uzyskać dużą liczbę żądań), a wszystkie dostępne wątki żądań są zajęte ze względu na wywołania zaplecza z dużym opóźnieniem, ograniczenie liczby iniekcji wątków może sprawiać, że aplikacja reaguje bardzo źle.</span><span class="sxs-lookup"><span data-stu-id="44ac7-142">If concurrency is bursty (that is, your web site can suddenly get a large number of requests) and all available request threads are busy because of backend calls with high latency, the limited thread injection rate can make your application respond very poorly.</span></span> <span data-ttu-id="44ac7-143">Ponadto każdy nowy wątek dodany do puli wątków ma narzuty (np. 1 MB pamięci stosu).</span><span class="sxs-lookup"><span data-stu-id="44ac7-143">Additionally, each new thread added to the thread pool has overhead (such as 1 MB of stack memory).</span></span> <span data-ttu-id="44ac7-144">Aplikacja internetowa korzystająca z metod synchronicznych do obsługi połączeń o dużym opóźnieniu, gdy pula wątków rośnie do wartości domyślnej programu .NET 4,5 w liczbie 5 000 wątków zużywa około 5 GB więcej pamięci niż aplikacja może korzystać z tych samych żądań metody asynchroniczne i tylko 50 wątków.</span><span class="sxs-lookup"><span data-stu-id="44ac7-144">A web application using synchronous methods to service high latency calls where the thread pool grows to the .NET 4.5 default maximum of 5, 000 threads would consume approximately 5 GB more memory than an application able the service the same requests using asynchronous methods and only 50 threads.</span></span> <span data-ttu-id="44ac7-145">Gdy wykonujesz zadania asynchroniczne, nie zawsze używasz wątku.</span><span class="sxs-lookup"><span data-stu-id="44ac7-145">When you're doing asynchronous work, you're not always using a thread.</span></span> <span data-ttu-id="44ac7-146">Na przykład po wprowadzeniu asynchronicznego żądania usługi sieci Web ASP.NET nie będzie używać żadnych wątków między wywołaniem metody **asynchronicznej** a **oczekującą**.</span><span class="sxs-lookup"><span data-stu-id="44ac7-146">For example, when you make an asynchronous web service request, ASP.NET will not be using any threads between the **async** method call and the **await**.</span></span> <span data-ttu-id="44ac7-147">Użycie puli wątków do obsługi żądań o dużym opóźnieniu może prowadzić do znacznego wykorzystania pamięci i niedostatecznego użycia sprzętu serwera.</span><span class="sxs-lookup"><span data-stu-id="44ac7-147">Using the thread pool to service requests with high latency can lead to a large memory footprint and poor utilization of the server hardware.</span></span>

## <a name="processing-asynchronous-requests"></a><span data-ttu-id="44ac7-148">Przetwarzanie żądań asynchronicznych</span><span class="sxs-lookup"><span data-stu-id="44ac7-148">Processing Asynchronous Requests</span></span>

<span data-ttu-id="44ac7-149">W aplikacjach sieci Web, które widzą dużą liczbę równoczesnych żądań podczas uruchamiania lub mają obciążenie pierścieniowe (w przypadku gwałtownego wydłużenia współbieżności), dzięki czemu wywołania usługi sieci Web asynchroniczne zwiększą czas odpowiedzi aplikacji.</span><span class="sxs-lookup"><span data-stu-id="44ac7-149">In web applications that see a large number of concurrent requests at start-up or has a bursty load (where concurrency increases suddenly), making web service calls asynchronous will increase the responsiveness of your application.</span></span> <span data-ttu-id="44ac7-150">Żądania asynchroniczne zajmują ten sam czas do przetworzenia w ramach żądania synchronicznego.</span><span class="sxs-lookup"><span data-stu-id="44ac7-150">An asynchronous request takes the same amount of time to process as a synchronous request.</span></span> <span data-ttu-id="44ac7-151">Na przykład, jeśli żądanie wykonuje wywołanie usługi sieci Web, które wymaga wykonania dwóch sekund, żądanie trwa dwa sekundy niezależnie od tego, czy jest wykonywane synchronicznie czy asynchronicznie.</span><span class="sxs-lookup"><span data-stu-id="44ac7-151">For example, if a request makes a web service call that requires two seconds to complete, the request takes two seconds whether it is performed synchronously or asynchronously.</span></span> <span data-ttu-id="44ac7-152">Jednak podczas wywołania asynchronicznego wątek nie jest blokowany przed odpowiedzią na inne żądania podczas oczekiwania na ukończenie pierwszego żądania.</span><span class="sxs-lookup"><span data-stu-id="44ac7-152">However, during an asynchronous call, a thread is not blocked from responding to other requests while it waits for the first request to complete.</span></span> <span data-ttu-id="44ac7-153">W związku z tym żądania asynchroniczne uniemożliwiają zwiększenie liczby kolejkowania żądań i puli wątków, gdy istnieje wiele współbieżnych żądań, które wywołują długotrwałe operacje.</span><span class="sxs-lookup"><span data-stu-id="44ac7-153">Therefore, asynchronous requests prevent request queuing and thread pool growth when there are many concurrent requests that invoke long-running operations.</span></span>

## <a id="ChoosingSyncVasync"></a><span data-ttu-id="44ac7-154">Wybieranie metod synchronicznych lub asynchronicznych</span><span class="sxs-lookup"><span data-stu-id="44ac7-154">Choosing Synchronous or Asynchronous Methods</span></span>

<span data-ttu-id="44ac7-155">Ta sekcja zawiera wskazówki dotyczące sytuacji, w których należy używać metod synchronicznych lub asynchronicznych.</span><span class="sxs-lookup"><span data-stu-id="44ac7-155">This section lists guidelines for when to use synchronous or asynchronous Methods.</span></span> <span data-ttu-id="44ac7-156">Są to jedynie wskazówki. osobno sprawdzaj poszczególne aplikacje, aby określić, czy metody asynchroniczne pomagają w wydajności.</span><span class="sxs-lookup"><span data-stu-id="44ac7-156">These are just guidelines; examine each application individually to determine whether asynchronous methods help with performance.</span></span>

<span data-ttu-id="44ac7-157">Ogólnie rzecz biorąc, należy użyć metod synchronicznych dla następujących warunków:</span><span class="sxs-lookup"><span data-stu-id="44ac7-157">In general, use synchronous methods for the following conditions:</span></span>

- <span data-ttu-id="44ac7-158">Operacje są proste lub krótkoterminowe.</span><span class="sxs-lookup"><span data-stu-id="44ac7-158">The operations are simple or short-running.</span></span>
- <span data-ttu-id="44ac7-159">Prostota jest bardziej ważna niż wydajność.</span><span class="sxs-lookup"><span data-stu-id="44ac7-159">Simplicity is more important than efficiency.</span></span>
- <span data-ttu-id="44ac7-160">Operacje są wykonywane głównie przez procesor CPU zamiast operacji, które obejmują rozbudowane obciążenie dysku lub sieci.</span><span class="sxs-lookup"><span data-stu-id="44ac7-160">The operations are primarily CPU operations instead of operations that involve extensive disk or network overhead.</span></span> <span data-ttu-id="44ac7-161">Korzystanie z metod asynchronicznych w operacjach powiązanych z PROCESORem nie zapewnia żadnych korzyści i daje większe obciążenie.</span><span class="sxs-lookup"><span data-stu-id="44ac7-161">Using asynchronous methods on CPU-bound operations provides no benefits and results in more overhead.</span></span>

<span data-ttu-id="44ac7-162">Ogólnie rzecz biorąc, należy używać metod asynchronicznych dla następujących warunków:</span><span class="sxs-lookup"><span data-stu-id="44ac7-162">In general, use asynchronous methods for the following conditions:</span></span>

- <span data-ttu-id="44ac7-163">Dzwonisz do usług, które mogą być używane za pośrednictwem metod asynchronicznych, i używasz platformy .NET w wersji 4,5 lub nowszej.</span><span class="sxs-lookup"><span data-stu-id="44ac7-163">You're calling services that can be consumed through asynchronous methods, and you're using .NET 4.5 or higher.</span></span>
- <span data-ttu-id="44ac7-164">Operacje są powiązane z siecią lub we/wy, a nie związane z PROCESORem.</span><span class="sxs-lookup"><span data-stu-id="44ac7-164">The operations are network-bound or I/O-bound instead of CPU-bound.</span></span>
- <span data-ttu-id="44ac7-165">Równoległość jest ważniejsze niż prostota kodu.</span><span class="sxs-lookup"><span data-stu-id="44ac7-165">Parallelism is more important than simplicity of code.</span></span>
- <span data-ttu-id="44ac7-166">Chcesz zapewnić mechanizm, który umożliwia użytkownikom anulowanie długotrwałego żądania.</span><span class="sxs-lookup"><span data-stu-id="44ac7-166">You want to provide a mechanism that lets users cancel a long-running request.</span></span>
- <span data-ttu-id="44ac7-167">Gdy korzyść przełączenia wątków powoduje obniżenie kosztów przełączenia kontekstu.</span><span class="sxs-lookup"><span data-stu-id="44ac7-167">When the benefit of switching threads outweighs the cost of the context switch.</span></span> <span data-ttu-id="44ac7-168">Ogólnie rzecz biorąc, należy wprowadzić metodę asynchroniczną, jeśli metoda synchroniczna blokuje wątek żądania ASP.NET podczas wykonywania zadań.</span><span class="sxs-lookup"><span data-stu-id="44ac7-168">In general, you should make a method asynchronous if the synchronous method blocks the ASP.NET request thread while doing no work.</span></span> <span data-ttu-id="44ac7-169">W wyniku wywołania asynchronicznego wątek żądania ASP.NET nie jest blokowany, nie działa podczas oczekiwania na ukończenie żądania usługi sieci Web.</span><span class="sxs-lookup"><span data-stu-id="44ac7-169">By making the call asynchronous, the ASP.NET request thread is not blocked doing no work while it waits for the web service request to complete.</span></span>
- <span data-ttu-id="44ac7-170">Testy pokazują, że operacje blokowania to wąskie gardła w wydajności lokacji i że usługi IIS mogą obsłużyć więcej żądań, używając metod asynchronicznych dla tych wywołań blokowania.</span><span class="sxs-lookup"><span data-stu-id="44ac7-170">Testing shows that the blocking operations are a bottleneck in site performance and that IIS can service more requests by using asynchronous methods for these blocking calls.</span></span>

  <span data-ttu-id="44ac7-171">Przykład do pobrania pokazuje, jak efektywnie używać metod asynchronicznych.</span><span class="sxs-lookup"><span data-stu-id="44ac7-171">The downloadable sample shows how to use asynchronous methods effectively.</span></span> <span data-ttu-id="44ac7-172">Dostarczony przykład został zaprojektowany w celu zapewnienia prostej demonstracji programowania asynchronicznego w ASP.NET 4,5.</span><span class="sxs-lookup"><span data-stu-id="44ac7-172">The sample provided was designed to provide a simple demonstration of asynchronous programming in ASP.NET 4.5.</span></span> <span data-ttu-id="44ac7-173">Przykład nie jest przeznaczony do architektury referencyjnej dla programowania asynchronicznego w ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="44ac7-173">The sample is not intended to be a reference architecture for asynchronous programming in ASP.NET.</span></span> <span data-ttu-id="44ac7-174">Przykładowy program wywołuje metody internetowego [interfejsu API ASP.NET](../../../web-api/index.md) , które z kolei powodują [zadanie Call. Opóźnij](https://msdn.microsoft.com/library/hh139096(VS.110).aspx) , aby symulować długotrwałe wywołania usługi sieci Web.</span><span class="sxs-lookup"><span data-stu-id="44ac7-174">The sample program calls [ASP.NET Web API](../../../web-api/index.md) methods which in turn call [Task.Delay](https://msdn.microsoft.com/library/hh139096(VS.110).aspx) to simulate long-running web service calls.</span></span> <span data-ttu-id="44ac7-175">Większość aplikacji produkcyjnych nie będzie pokazywała oczywistych korzyści związanych z korzystaniem z metod asynchronicznych.</span><span class="sxs-lookup"><span data-stu-id="44ac7-175">Most production applications will not show such obvious benefits to using asynchronous Methods.</span></span>   
  
<span data-ttu-id="44ac7-176">Niektóre aplikacje wymagają, aby wszystkie metody były asynchroniczne.</span><span class="sxs-lookup"><span data-stu-id="44ac7-176">Few applications require all methods to be asynchronous.</span></span> <span data-ttu-id="44ac7-177">Często konwersja kilku metod synchronicznych na metody asynchroniczne zapewnia optymalny wzrost wydajności dla wymaganej ilości pracy.</span><span class="sxs-lookup"><span data-stu-id="44ac7-177">Often, converting a few synchronous methods to asynchronous methods provides the best efficiency increase for the amount of work required.</span></span>

## <a id="SampleApp"></a><span data-ttu-id="44ac7-178">Przykładowa aplikacja</span><span class="sxs-lookup"><span data-stu-id="44ac7-178">The Sample Application</span></span>

<span data-ttu-id="44ac7-179">Przykładową aplikację można pobrać z [https://github.com/RickAndMSFT/Async-ASP.NET](https://github.com/RickAndMSFT/Async-ASP.NET) w witrynie [GitHub](https://github.com/) .</span><span class="sxs-lookup"><span data-stu-id="44ac7-179">You can download the sample application from [https://github.com/RickAndMSFT/Async-ASP.NET](https://github.com/RickAndMSFT/Async-ASP.NET) on the [GitHub](https://github.com/) site.</span></span> <span data-ttu-id="44ac7-180">Repozytorium składa się z trzech projektów:</span><span class="sxs-lookup"><span data-stu-id="44ac7-180">The repository consists of three projects:</span></span>

- <span data-ttu-id="44ac7-181">*WebAppAsync*: projekt formularzy sieci Web ASP.NET, który korzysta z usługi internetowego interfejsu API **WebAPIpwg** .</span><span class="sxs-lookup"><span data-stu-id="44ac7-181">*WebAppAsync*: The ASP.NET Web Forms project that consumes the Web API **WebAPIpwg** service.</span></span> <span data-ttu-id="44ac7-182">Większość kodu dla tego samouczka pochodzi z tego projektu.</span><span class="sxs-lookup"><span data-stu-id="44ac7-182">Most of the code for this tutorial is from the this project.</span></span>
- <span data-ttu-id="44ac7-183">*WebAPIpgw*: projekt interfejsu API sieci Web ASP.NET MVC 4, który implementuje kontrolery `Products, Gizmos and Widgets`.</span><span class="sxs-lookup"><span data-stu-id="44ac7-183">*WebAPIpgw*: The ASP.NET MVC 4 Web API project that implements the `Products, Gizmos and Widgets` controllers.</span></span> <span data-ttu-id="44ac7-184">Udostępnia dane dla projektu *WebAppAsync* i projektu *Mvc4Async* .</span><span class="sxs-lookup"><span data-stu-id="44ac7-184">It provides the data for the *WebAppAsync* project and the *Mvc4Async* project.</span></span>
- <span data-ttu-id="44ac7-185">*Mvc4Async*: projekt ASP.NET MVC 4, który zawiera kod używany w innym samouczku.</span><span class="sxs-lookup"><span data-stu-id="44ac7-185">*Mvc4Async*: The ASP.NET MVC 4 project that contains the code used in another tutorial.</span></span> <span data-ttu-id="44ac7-186">Powoduje to wywołanie interfejsu API sieci Web do usługi **WebAPIpwg** .</span><span class="sxs-lookup"><span data-stu-id="44ac7-186">It makes Web API calls to the **WebAPIpwg** service.</span></span>

## <a id="GizmosSynch"></a><span data-ttu-id="44ac7-187">Strona synchroniczna elementy Gizmo</span><span class="sxs-lookup"><span data-stu-id="44ac7-187">The Gizmos Synchronous Page</span></span>

 <span data-ttu-id="44ac7-188">Poniższy kod przedstawia metodę synchroniczną `Page_Load`, która jest używana do wyświetlania listy elementy Gizmo.</span><span class="sxs-lookup"><span data-stu-id="44ac7-188">The following code shows the `Page_Load` synchronous method that is used to display a list of gizmos.</span></span> <span data-ttu-id="44ac7-189">(W tym artykule Gizmo jest fikcyjnym urządzeniem mechanicznym).</span><span class="sxs-lookup"><span data-stu-id="44ac7-189">(For this article, a gizmo is a fictional mechanical device.)</span></span> 

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample1.cs)]

<span data-ttu-id="44ac7-190">Poniższy kod przedstawia metodę `GetGizmos` usługi Gizmo.</span><span class="sxs-lookup"><span data-stu-id="44ac7-190">The following code shows the `GetGizmos` method of the gizmo service.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample2.cs)]

<span data-ttu-id="44ac7-191">Metoda `GizmoService GetGizmos` przekazuje identyfikator URI do usługi HTTP Web API ASP.NET, która zwraca listę danych elementy Gizmo.</span><span class="sxs-lookup"><span data-stu-id="44ac7-191">The `GizmoService GetGizmos` method passes a URI to an ASP.NET Web API HTTP service which returns a list of gizmos data.</span></span> <span data-ttu-id="44ac7-192">Projekt *WebAPIpgw* zawiera implementację kontrolerów Web API `gizmos, widget` i `product`.</span><span class="sxs-lookup"><span data-stu-id="44ac7-192">The *WebAPIpgw* project contains the implementation of the Web API `gizmos, widget` and `product` controllers.</span></span>  
<span data-ttu-id="44ac7-193">Na poniższej ilustracji przedstawiono stronę elementy Gizmo z przykładowego projektu.</span><span class="sxs-lookup"><span data-stu-id="44ac7-193">The following image shows the gizmos page from the sample project.</span></span>

![Elementy Gizmo](using-asynchronous-methods-in-aspnet-45/_static/image1.png)

## <a id="CreatingAsynchGizmos"></a><span data-ttu-id="44ac7-195">Tworzenie asynchronicznej strony elementy Gizmo</span><span class="sxs-lookup"><span data-stu-id="44ac7-195">Creating an Asynchronous Gizmos Page</span></span>

<span data-ttu-id="44ac7-196">Przykład używa nowych słów kluczowych [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) i [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) (dostępnych w oprogramowaniu .NET 4,5 i Visual Studio 2012), aby umożliwić kompilatorowi odpowiadanie na zachowanie skomplikowanych transformacji niezbędnych do programowania asynchronicznego.</span><span class="sxs-lookup"><span data-stu-id="44ac7-196">The sample uses the new [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) and [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) keywords (available in .NET 4.5 and Visual Studio 2012) to let the compiler be responsible for maintaining the complicated transformations necessary for asynchronous programming.</span></span> <span data-ttu-id="44ac7-197">Kompilator pozwala pisać kod przy użyciu C#konstrukcji przepływu sterowania synchronicznego, a kompilator automatycznie stosuje przekształcenia wymagane do użycia wywołań zwrotnych w celu uniknięcia blokowania wątków.</span><span class="sxs-lookup"><span data-stu-id="44ac7-197">The compiler lets you write code using the C#'s synchronous control flow constructs and the compiler automatically applies the transformations necessary to use callbacks in order to avoid blocking threads.</span></span>

<span data-ttu-id="44ac7-198">Strony asynchroniczne ASP.NET muszą zawierać dyrektywę [Page](https://msdn.microsoft.com/library/ydy4x04a.aspx) z atrybutem `Async` ustawionym na wartość "true".</span><span class="sxs-lookup"><span data-stu-id="44ac7-198">ASP.NET asynchronous pages must include the [Page](https://msdn.microsoft.com/library/ydy4x04a.aspx) directive with the `Async` attribute set to "true".</span></span> <span data-ttu-id="44ac7-199">Poniższy kod przedstawia dyrektywę [Page](https://msdn.microsoft.com/library/ydy4x04a.aspx) z atrybutem `Async` ustawionym na wartość "true" dla strony *GizmosAsync. aspx* .</span><span class="sxs-lookup"><span data-stu-id="44ac7-199">The following code shows the [Page](https://msdn.microsoft.com/library/ydy4x04a.aspx) directive with the `Async` attribute set to "true" for the *GizmosAsync.aspx* page.</span></span>

[!code-aspx[Main](using-asynchronous-methods-in-aspnet-45/samples/sample3.aspx?highlight=1)]

<span data-ttu-id="44ac7-200">Poniższy kod przedstawia `Gizmos` metody `Page_Load` synchronicznej i strony asynchronicznej `GizmosAsync`.</span><span class="sxs-lookup"><span data-stu-id="44ac7-200">The following code shows the `Gizmos` synchronous `Page_Load` method and the `GizmosAsync` asynchronous page.</span></span> <span data-ttu-id="44ac7-201">Jeśli przeglądarka obsługuje [znacznik &lt;HTML 5&gt; element](http://www.w3.org/wiki/HTML/Elements/mark), zobaczysz zmiany w `GizmosAsync`.</span><span class="sxs-lookup"><span data-stu-id="44ac7-201">If your browser supports the [HTML 5 &lt;mark&gt; element](http://www.w3.org/wiki/HTML/Elements/mark), you'll see the changes in `GizmosAsync` in yellow highlight.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample4.cs)]

<span data-ttu-id="44ac7-202">Wersja asynchroniczna:</span><span class="sxs-lookup"><span data-stu-id="44ac7-202">The asynchronous version:</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample5.cs?highlight=3,6-7,9,11)]

 <span data-ttu-id="44ac7-203">Następujące zmiany zostały zastosowane, aby umożliwić asynchronicznej stronie `GizmosAsync`.</span><span class="sxs-lookup"><span data-stu-id="44ac7-203">The following changes were applied to allow the `GizmosAsync` page be asynchronous.</span></span>

- <span data-ttu-id="44ac7-204">Dyrektywa [Page](https://msdn.microsoft.com/library/ydy4x04a.aspx) musi mieć atrybut `Async` ustawiony na wartość "true".</span><span class="sxs-lookup"><span data-stu-id="44ac7-204">The [Page](https://msdn.microsoft.com/library/ydy4x04a.aspx) directive must have the `Async` attribute set to "true".</span></span>
- <span data-ttu-id="44ac7-205">Metoda `RegisterAsyncTask` służy do rejestrowania asynchronicznego zadania zawierającego kod, który jest uruchamiany asynchronicznie.</span><span class="sxs-lookup"><span data-stu-id="44ac7-205">The `RegisterAsyncTask` method is used to register an asynchronous task containing the code which runs asynchronously.</span></span>
- <span data-ttu-id="44ac7-206">Nowa metoda `GetGizmosSvcAsync` jest oznaczona za pomocą słowa kluczowego [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) , co informuje kompilator, aby generował wywołania zwrotne dla części treści i automatycznie utworzyć `Task`, który jest zwracany.</span><span class="sxs-lookup"><span data-stu-id="44ac7-206">The new `GetGizmosSvcAsync` method is marked with the [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keyword, which tells the compiler to generate callbacks for parts of the body and to automatically create a `Task` that is returned.</span></span>
- <span data-ttu-id="44ac7-207">&quot;asynchroniczne&quot; dołączone do nazwy metody asynchronicznej.</span><span class="sxs-lookup"><span data-stu-id="44ac7-207">&quot;Async&quot; was appended to the asynchronous method name.</span></span> <span data-ttu-id="44ac7-208">Dołączanie "Async" nie jest wymagane, ale jest konwencją podczas pisania metod asynchronicznych.</span><span class="sxs-lookup"><span data-stu-id="44ac7-208">Appending "Async" is not required but is the convention when writing asynchronous methods.</span></span>
- <span data-ttu-id="44ac7-209">Zwracany typ nowej metody `GetGizmosSvcAsync` jest `Task`.</span><span class="sxs-lookup"><span data-stu-id="44ac7-209">The return type of the new `GetGizmosSvcAsync` method is `Task`.</span></span> <span data-ttu-id="44ac7-210">Zwracany typ `Task` reprezentuje bieżącą czynność i zapewnia wywołujących metodę z dojściem, za pomocą którego czeka na zakończenie operacji asynchronicznej.</span><span class="sxs-lookup"><span data-stu-id="44ac7-210">The return type of `Task` represents ongoing work and provides callers of the method with a handle through which to wait for the asynchronous operation's completion.</span></span>
- <span data-ttu-id="44ac7-211">Słowo kluczowe [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) zostało zastosowane do wywołania usługi sieci Web.</span><span class="sxs-lookup"><span data-stu-id="44ac7-211">The [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) keyword was applied to the web service call.</span></span>
- <span data-ttu-id="44ac7-212">Wywołano interfejs API usługi asynchronicznej sieci Web (`GetGizmosAsync`).</span><span class="sxs-lookup"><span data-stu-id="44ac7-212">The asynchronous web service API was called (`GetGizmosAsync`).</span></span>

<span data-ttu-id="44ac7-213">Wewnątrz metody `GetGizmosSvcAsync` Metoda inna metoda asynchroniczna, `GetGizmosAsync` jest wywoływana.</span><span class="sxs-lookup"><span data-stu-id="44ac7-213">Inside of the `GetGizmosSvcAsync` method body another asynchronous method, `GetGizmosAsync` is called.</span></span> <span data-ttu-id="44ac7-214">`GetGizmosAsync` natychmiast zwraca `Task<List<Gizmo>>`, który ostatecznie zakończy się, gdy dane będą dostępne.</span><span class="sxs-lookup"><span data-stu-id="44ac7-214">`GetGizmosAsync` immediately returns a `Task<List<Gizmo>>` that will eventually complete when the data is available.</span></span> <span data-ttu-id="44ac7-215">Ponieważ nie chcesz niczego robić, dopóki nie masz danych Gizmo, kod oczekuje na zadanie (za pomocą słowa kluczowego **await** ).</span><span class="sxs-lookup"><span data-stu-id="44ac7-215">Because you don't want to do anything else until you have the gizmo data, the code awaits the task (using the **await** keyword).</span></span> <span data-ttu-id="44ac7-216">Słowa kluczowego **await** można używać tylko w metodach z adnotacją za pomocą słowa kluczowego **Async** .</span><span class="sxs-lookup"><span data-stu-id="44ac7-216">You can use the **await** keyword only in methods annotated with the **async** keyword.</span></span>

<span data-ttu-id="44ac7-217">Słowo kluczowe **await** nie blokuje wątku do momentu ukończenia zadania.</span><span class="sxs-lookup"><span data-stu-id="44ac7-217">The **await** keyword does not block the thread until the task is complete.</span></span> <span data-ttu-id="44ac7-218">Rejestruje resztę metody jako wywołanie zwrotne zadania i natychmiast zwraca wartość.</span><span class="sxs-lookup"><span data-stu-id="44ac7-218">It signs up the rest of the method as a callback on the task, and immediately returns.</span></span> <span data-ttu-id="44ac7-219">Gdy oczekujące zadanie zakończy się ostatecznie, wywoła to wywołanie zwrotne i w efekcie wznowi wykonywanie metody w prawidłowym miejscu.</span><span class="sxs-lookup"><span data-stu-id="44ac7-219">When the awaited task eventually completes, it will invoke that callback and thus resume the execution of the method right where it left off.</span></span> <span data-ttu-id="44ac7-220">Aby uzyskać więcej informacji o używaniu [oczekujących](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) i [asynchronicznych](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) słów kluczowych i przestrzeni nazw [zadań](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) , zobacz [odwołania asynchroniczne](https://docs.microsoft.com/dotnet/csharp/language-reference/keywords/async).</span><span class="sxs-lookup"><span data-stu-id="44ac7-220">For more information on using the [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) and [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keywords and the [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) namespace, see the [async references](https://docs.microsoft.com/dotnet/csharp/language-reference/keywords/async).</span></span>

<span data-ttu-id="44ac7-221">W poniższym kodzie przedstawiono metody `GetGizmos` i `GetGizmosAsync`.</span><span class="sxs-lookup"><span data-stu-id="44ac7-221">The following code shows the `GetGizmos` and `GetGizmosAsync` methods.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample6.cs)]

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample7.cs?highlight=1,4-8)]

 <span data-ttu-id="44ac7-222">Zmiany asynchroniczne są podobne do tych, które zostały wprowadzone do **GizmosAsync** powyżej.</span><span class="sxs-lookup"><span data-stu-id="44ac7-222">The asynchronous changes are similar to those made to the **GizmosAsync** above.</span></span> 

- <span data-ttu-id="44ac7-223">Sygnatura metody została oznaczona przy użyciu słowa kluczowego [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) , a zwracany typ został zmieniony na `Task<List<Gizmo>>`, a *Async* został dołączony do nazwy metody.</span><span class="sxs-lookup"><span data-stu-id="44ac7-223">The method signature was annotated with the [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keyword, the return type was changed to `Task<List<Gizmo>>`, and *Async* was appended to the method name.</span></span>
- <span data-ttu-id="44ac7-224">Klasa asynchroniczna [HttpClient](https://msdn.microsoft.com/library/system.net.http.httpclient(VS.110).aspx) jest używana zamiast synchronicznej klasy [WebClient](https://msdn.microsoft.com/library/system.net.webclient.aspx) .</span><span class="sxs-lookup"><span data-stu-id="44ac7-224">The asynchronous [HttpClient](https://msdn.microsoft.com/library/system.net.http.httpclient(VS.110).aspx) class is used instead of the synchronous [WebClient](https://msdn.microsoft.com/library/system.net.webclient.aspx) class.</span></span>
- <span data-ttu-id="44ac7-225">Słowo kluczowe [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) zostało zastosowane do metody asynchronicznej[GetAsync](https://msdn.microsoft.com/library/hh158944(VS.110).aspx) [HttpClient](https://msdn.microsoft.com/library/system.net.http.httpclient(VS.110).aspx).</span><span class="sxs-lookup"><span data-stu-id="44ac7-225">The [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) keyword was applied to the [HttpClient](https://msdn.microsoft.com/library/system.net.http.httpclient(VS.110).aspx)[GetAsync](https://msdn.microsoft.com/library/hh158944(VS.110).aspx) asynchronous method.</span></span>

<span data-ttu-id="44ac7-226">Na poniższej ilustracji przedstawiono widok Gizmo asynchronicznych.</span><span class="sxs-lookup"><span data-stu-id="44ac7-226">The following image shows the asynchronous gizmo view.</span></span>

![async](using-asynchronous-methods-in-aspnet-45/_static/image2.png)

<span data-ttu-id="44ac7-228">Prezentacja przeglądarek danych elementy Gizmo jest taka sama jak widok utworzony przez wywołanie synchroniczne.</span><span class="sxs-lookup"><span data-stu-id="44ac7-228">The browsers presentation of the gizmos data is identical to the view created by the synchronous call.</span></span> <span data-ttu-id="44ac7-229">Jedyną różnicą jest to, że wersja asynchroniczna może być bardziej wydajna w przypadku dużych obciążeń.</span><span class="sxs-lookup"><span data-stu-id="44ac7-229">The only difference is the asynchronous version may be more performant under heavy loads.</span></span>

## <a name="registerasynctask-notes"></a><span data-ttu-id="44ac7-230">RegisterAsyncTask uwagi</span><span class="sxs-lookup"><span data-stu-id="44ac7-230">RegisterAsyncTask Notes</span></span>

<span data-ttu-id="44ac7-231">Metody podłączane do `RegisterAsyncTask` będą uruchamiane natychmiast po [zdarzeniu PreRender](https://msdn.microsoft.com/library/ms178472.aspx).</span><span class="sxs-lookup"><span data-stu-id="44ac7-231">Methods hooked up with `RegisterAsyncTask` will run immediately after [PreRender](https://msdn.microsoft.com/library/ms178472.aspx).</span></span> <span data-ttu-id="44ac7-232">Można również używać asynchronicznych zdarzeń stron typu void, jak pokazano w poniższym kodzie:</span><span class="sxs-lookup"><span data-stu-id="44ac7-232">You can also use async void page events directly, as shown in the following code:</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample8.cs)]

<span data-ttu-id="44ac7-233">Minusem do asynchronicznych zdarzeń void polega na tym, że deweloperzy nie mają już pełnej kontroli nad wykonywaniem zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="44ac7-233">The downside to async void events is that developers no longer has full control over when events execute.</span></span> <span data-ttu-id="44ac7-234">Na przykład jeśli zarówno. aspx, jak i. Wzorce definiują zdarzenia `Page_Load` i jedno lub oba z nich są asynchroniczne, nie można zagwarantować kolejności wykonywania.</span><span class="sxs-lookup"><span data-stu-id="44ac7-234">For example, if both an .aspx and a .Master define `Page_Load` events and one or both of them are asynchronous, the order of execution can't be guaranteed.</span></span> <span data-ttu-id="44ac7-235">Ta sama kolejność indeterminiate dla programów obsługi niezdarzeń (takich jak `async void Button_Click`) ma zastosowanie.</span><span class="sxs-lookup"><span data-stu-id="44ac7-235">The same indeterminiate order for non event handlers (such as `async void Button_Click` ) applies.</span></span> <span data-ttu-id="44ac7-236">Dla większości deweloperów powinna być to akceptowalne, ale te, które wymagają pełnej kontroli nad kolejnością wykonywania, powinny używać tylko interfejsów API, takich jak `RegisterAsyncTask`, które używają metod, które zwracają obiekt zadania.</span><span class="sxs-lookup"><span data-stu-id="44ac7-236">For most developers this should be acceptable, but those who require full control over the order of execution should only use APIs like `RegisterAsyncTask` that consume methods which return a Task object.</span></span>

## <a id="Parallel"></a><span data-ttu-id="44ac7-237">Wykonywanie wielu operacji równolegle</span><span class="sxs-lookup"><span data-stu-id="44ac7-237">Performing Multiple Operations in Parallel</span></span>

<span data-ttu-id="44ac7-238">Metody asynchroniczne mają znaczną korzyść w porównaniu z metodami synchronicznymi, gdy akcja musi wykonywać kilka niezależnych operacji.</span><span class="sxs-lookup"><span data-stu-id="44ac7-238">Asynchronous Methods have a significant advantage over synchronous methods when an action must perform several independent operations.</span></span> <span data-ttu-id="44ac7-239">W podanym przykładzie Strona synchroniczna *PWG. aspx*(dla produktów, widżetów i elementy Gizmo) zawiera wyniki trzech wywołań usługi sieci Web w celu uzyskania listy produktów, widżetów i elementy Gizmo.</span><span class="sxs-lookup"><span data-stu-id="44ac7-239">In the sample provided, the synchronous page *PWG.aspx*(for Products, Widgets and Gizmos) displays the results of three web service calls to get a list of products, widgets, and gizmos.</span></span> <span data-ttu-id="44ac7-240">Projekt [interfejsu API sieci Web ASP.NET](../../../web-api/index.md) , który udostępnia te usługi, używa [zadania. opóźnienie](https://msdn.microsoft.com/library/hh139096(VS.110).aspx) do symulowania opóźnień lub wolnych połączeń sieciowych.</span><span class="sxs-lookup"><span data-stu-id="44ac7-240">The [ASP.NET Web API](../../../web-api/index.md) project that provides these services uses [Task.Delay](https://msdn.microsoft.com/library/hh139096(VS.110).aspx) to simulate latency or slow network calls.</span></span> <span data-ttu-id="44ac7-241">Gdy opóźnienie jest ustawione na 500 milisekund, asynchroniczna strona *PWGasync. aspx* zajmie nieco ponad 500 milisekund, gdy synchroniczna wersja `PWG` przekroczy 1 500 milisekund.</span><span class="sxs-lookup"><span data-stu-id="44ac7-241">When the delay is set to 500 milliseconds, the asynchronous *PWGasync.aspx* page takes a little over 500 milliseconds to complete while the synchronous `PWG` version takes over 1,500 milliseconds.</span></span> <span data-ttu-id="44ac7-242">Synchroniczna strona *PWG. aspx* jest pokazana w poniższym kodzie.</span><span class="sxs-lookup"><span data-stu-id="44ac7-242">The synchronous *PWG.aspx* page is shown in the following code.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample9.cs)]

<span data-ttu-id="44ac7-243">Poniżej przedstawiono kod asynchronicznej `PWGasync`.</span><span class="sxs-lookup"><span data-stu-id="44ac7-243">The asynchronous `PWGasync` code behind is shown below.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample10.cs?highlight=5,11,21)]

<span data-ttu-id="44ac7-244">Na poniższej ilustracji przedstawiono widok zwrócony z asynchronicznej strony *PWGasync. aspx* .</span><span class="sxs-lookup"><span data-stu-id="44ac7-244">The following image shows the view returned from the asynchronous *PWGasync.aspx* page.</span></span>

![](using-asynchronous-methods-in-aspnet-45/_static/image3.png)

## <a id="CancelToken"></a><span data-ttu-id="44ac7-245">Korzystanie z tokenu anulowania</span><span class="sxs-lookup"><span data-stu-id="44ac7-245">Using a Cancellation Token</span></span>

<span data-ttu-id="44ac7-246">Metody asynchroniczne zwracające `Task`są anulowane, które przyjmują parametr [CancellationToken](https://msdn.microsoft.com/library/system.threading.cancellationtoken(VS.110).aspx) , gdy jeden z nich jest dostarczany z atrybutem `AsyncTimeout` dyrektywy [Page](https://msdn.microsoft.com/library/ydy4x04a.aspx) .</span><span class="sxs-lookup"><span data-stu-id="44ac7-246">Asynchronous Methods returning `Task`are cancelable, that is they take a [CancellationToken](https://msdn.microsoft.com/library/system.threading.cancellationtoken(VS.110).aspx) parameter when one is provided with the `AsyncTimeout` attribute of the [Page](https://msdn.microsoft.com/library/ydy4x04a.aspx) directive.</span></span> <span data-ttu-id="44ac7-247">Poniższy kod przedstawia stronę *GizmosCancelAsync. aspx* z limitem czasu na sekundę.</span><span class="sxs-lookup"><span data-stu-id="44ac7-247">The following code shows the *GizmosCancelAsync.aspx* page with a timeout of on second.</span></span>

[!code-aspx[Main](using-asynchronous-methods-in-aspnet-45/samples/sample11.aspx?highlight=1)]

<span data-ttu-id="44ac7-248">Poniższy kod przedstawia plik *GizmosCancelAsync.aspx.cs* .</span><span class="sxs-lookup"><span data-stu-id="44ac7-248">The following code shows the *GizmosCancelAsync.aspx.cs* file.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample12.cs?highlight=6,9)]

<span data-ttu-id="44ac7-249">W podanej przykładowej aplikacji wybranie linku *GizmosCancelAsync* wywołuje stronę *GizmosCancelAsync. aspx* i pokazuje anulowanie (przez przekroczenie limitu czasu) wywołania asynchronicznego.</span><span class="sxs-lookup"><span data-stu-id="44ac7-249">In the sample application provided, selecting the *GizmosCancelAsync* link calls the *GizmosCancelAsync.aspx* page and demonstrates the cancellation (by timing out) of the asynchronous call.</span></span> <span data-ttu-id="44ac7-250">Ponieważ czas opóźnienia mieści się w zakresie losowym, może być konieczne odświeżenie strony kilka razy, aby wyświetlić komunikat o błędzie limitu czasu.</span><span class="sxs-lookup"><span data-stu-id="44ac7-250">Because the delay time is within a random range, you might need to refresh the page a couple times to get the time out error message.</span></span>

## <a id="ServerConfig"></a><span data-ttu-id="44ac7-251">Konfiguracja serwera dla wywołań usługi sieci Web o wysokim poziomie współbieżności/dużych opóźnień</span><span class="sxs-lookup"><span data-stu-id="44ac7-251">Server Configuration for High Concurrency/High Latency Web Service Calls</span></span>

<span data-ttu-id="44ac7-252">Aby zrealizować zalety asynchronicznej aplikacji sieci Web, może być konieczne wprowadzenie pewnych zmian w domyślnej konfiguracji serwera.</span><span class="sxs-lookup"><span data-stu-id="44ac7-252">To realize the benefits of an asynchronous web application, you might need to make some changes to the default server configuration.</span></span> <span data-ttu-id="44ac7-253">Podczas konfigurowania i obciążeniowania asynchronicznej aplikacji sieci Web należy pamiętać o następujących kwestiach.</span><span class="sxs-lookup"><span data-stu-id="44ac7-253">Keep the following in mind when configuring and stress testing your asynchronous web application.</span></span>

- <span data-ttu-id="44ac7-254">System Windows 7, Windows Vista, Window 8 i wszystkie klienckie systemy operacyjne Windows mają maksymalnie 10 współbieżnych żądań.</span><span class="sxs-lookup"><span data-stu-id="44ac7-254">Windows 7, Windows Vista, Window 8, and all Windows client operating systems have a maximum of 10 concurrent requests.</span></span> <span data-ttu-id="44ac7-255">Musisz mieć system operacyjny Windows Server, aby zobaczyć zalety metod asynchronicznych w ramach dużego obciążenia.</span><span class="sxs-lookup"><span data-stu-id="44ac7-255">You'll need a Windows Server operating system to see the benefits of asynchronous methods under high load.</span></span>
- <span data-ttu-id="44ac7-256">Zarejestruj platformę .NET 4,5 z usługami IIS z poziomu wiersza polecenia z podwyższonym poziomem uprawnień przy użyciu następującego polecenia:</span><span class="sxs-lookup"><span data-stu-id="44ac7-256">Register .NET 4.5 with IIS from an elevated command prompt using the following command:</span></span>  
  <span data-ttu-id="44ac7-257">%windir%\Microsoft.NET\Framework64 \v4.0.30319\aspnet\_regiis-i</span><span class="sxs-lookup"><span data-stu-id="44ac7-257">%windir%\Microsoft.NET\Framework64 \v4.0.30319\aspnet\_regiis -i</span></span>  
  <span data-ttu-id="44ac7-258">Zobacz [ASP.NET narzędzia rejestracji usług IIS (Aspnet\_regiis. exe)](https://msdn.microsoft.com/library/k6h9cz8h.aspx)</span><span class="sxs-lookup"><span data-stu-id="44ac7-258">See    [ASP.NET IIS Registration Tool (Aspnet\_regiis.exe)](https://msdn.microsoft.com/library/k6h9cz8h.aspx)</span></span>
- <span data-ttu-id="44ac7-259">Może być konieczne zwiększenie limitu kolejki [http. sys](https://www.iis.net/learn/get-started/introduction-to-iis/introduction-to-iis-architecture) z wartości domyślnej 1 000 do 5 000.</span><span class="sxs-lookup"><span data-stu-id="44ac7-259">You might need to increase the [HTTP.sys](https://www.iis.net/learn/get-started/introduction-to-iis/introduction-to-iis-architecture) queue limit from the default value of 1,000 to 5,000.</span></span> <span data-ttu-id="44ac7-260">Jeśli ustawienie jest zbyt niskie, mogą zostać wyświetlone żądania [http. sys](https://www.iis.net/learn/get-started/introduction-to-iis/introduction-to-iis-architecture) odrzucone ze stanem HTTP 503.</span><span class="sxs-lookup"><span data-stu-id="44ac7-260">If the setting is too low, you may see [HTTP.sys](https://www.iis.net/learn/get-started/introduction-to-iis/introduction-to-iis-architecture) reject requests with a HTTP 503 status.</span></span> <span data-ttu-id="44ac7-261">Aby zmienić limit kolejki HTTP. sys:</span><span class="sxs-lookup"><span data-stu-id="44ac7-261">To change the HTTP.sys queue limit:</span></span>

    - <span data-ttu-id="44ac7-262">Otwórz Menedżera usług IIS i przejdź do okienka pule aplikacji.</span><span class="sxs-lookup"><span data-stu-id="44ac7-262">Open IIS manager and navigate to the Application Pools pane.</span></span>
    - <span data-ttu-id="44ac7-263">Kliknij prawym przyciskiem myszy docelową pulę aplikacji i wybierz pozycję **Ustawienia zaawansowane**.</span><span class="sxs-lookup"><span data-stu-id="44ac7-263">Right click on the target application pool and select **Advanced Settings**.</span></span>  
        <span data-ttu-id="44ac7-264">![Advanced](using-asynchronous-methods-in-aspnet-45/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="44ac7-264">![advanced](using-asynchronous-methods-in-aspnet-45/_static/image4.png)</span></span>
    - <span data-ttu-id="44ac7-265">W oknie dialogowym **Ustawienia zaawansowane** Zmień *długość kolejki* z 1 000 na 5 000.</span><span class="sxs-lookup"><span data-stu-id="44ac7-265">In the **Advanced Settings** dialog box, change *Queue Length* from 1,000 to 5,000.</span></span>  
        <span data-ttu-id="44ac7-266">Długość kolejki ![](using-asynchronous-methods-in-aspnet-45/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="44ac7-266">![Queue length](using-asynchronous-methods-in-aspnet-45/_static/image5.png)</span></span>  
  
  <span data-ttu-id="44ac7-267">Zanotuj powyższe obrazy, a program .NET Framework jest wymieniony jako v 4.0, nawet jeśli Pula aplikacji korzysta z platformy .NET 4,5.</span><span class="sxs-lookup"><span data-stu-id="44ac7-267">Note in the images above, the .NET framework is listed as v4.0, even though the application pool is using .NET 4.5.</span></span> <span data-ttu-id="44ac7-268">Aby zrozumieć ten rozbieżność, zobacz następujące tematy:</span><span class="sxs-lookup"><span data-stu-id="44ac7-268">To understand this discrepancy, see the following:</span></span>

- [<span data-ttu-id="44ac7-269">Wersja .NET i wiele elementów docelowych — .NET 4,5 to uaktualnienie w miejscu do programu .NET 4,0</span><span class="sxs-lookup"><span data-stu-id="44ac7-269">.NET Versioning and Multi-Targeting - .NET 4.5 is an in-place upgrade to .NET 4.0</span></span>](http://www.hanselman.com/blog/NETVersioningAndMultiTargetingNET45IsAnInplaceUpgradeToNET40.aspx)
- [<span data-ttu-id="44ac7-270">Jak ustawić aplikację IIS lub puli aplikacji do korzystania z ASP.NET 3,5 zamiast 2,0</span><span class="sxs-lookup"><span data-stu-id="44ac7-270">How to set an IIS Application or AppPool to use ASP.NET 3.5 rather than 2.0</span></span>](http://www.hanselman.com/blog/HowToSetAnIISApplicationOrAppPoolToUseASPNET35RatherThan20.aspx)
- <span data-ttu-id="44ac7-271">[Wersje i zależności platformy .NET Framework](https://msdn.microsoft.com/library/bb822049(VS.110).aspx)</span><span class="sxs-lookup"><span data-stu-id="44ac7-271">[.NET Framework Versions and Dependencies](https://msdn.microsoft.com/library/bb822049(VS.110).aspx)</span></span>

- <span data-ttu-id="44ac7-272">Jeśli aplikacja korzysta z usług sieci Web lub System.NET do komunikowania się z zapleczem za pośrednictwem protokołu HTTP, może być konieczne zwiększenie elementu [connectionManagement/MaxConnection](https://msdn.microsoft.com/library/fb6y0fyc(VS.110).aspx) .</span><span class="sxs-lookup"><span data-stu-id="44ac7-272">If your application is using web services or System.NET to communicate with a backend over HTTP you may need to increase the [connectionManagement/maxconnection](https://msdn.microsoft.com/library/fb6y0fyc(VS.110).aspx) element.</span></span> <span data-ttu-id="44ac7-273">W przypadku aplikacji ASP.NET jest to ograniczone przez funkcję autokonfiguracji do 12 razy liczba procesorów.</span><span class="sxs-lookup"><span data-stu-id="44ac7-273">For ASP.NET applications, this is limited by the autoConfig feature to 12 times the number of CPUs.</span></span> <span data-ttu-id="44ac7-274">Oznacza to, że w ramach procesora można maksymalnie 12 \* 4 = 48 połączeń współbieżnych do punktu końcowego IP.</span><span class="sxs-lookup"><span data-stu-id="44ac7-274">That means that on a quad-proc, you can have at most 12 \* 4 = 48 concurrent connections to an IP end point.</span></span> <span data-ttu-id="44ac7-275">Ze względu na to, że jest to związane z [Autokonfiguracjami](https://msdn.microsoft.com/library/7w2sway1(VS.110).aspx), najprostszym sposobem zwiększenia `maxconnection` w aplikacji ASP.NET jest ustawienie `Application_Start` w pliku *Global. asax* [systemu .NET. ServicePointManager. DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit(VS.110).aspx) programowo.</span><span class="sxs-lookup"><span data-stu-id="44ac7-275">Because this is tied to [autoConfig](https://msdn.microsoft.com/library/7w2sway1(VS.110).aspx), the easiest way to increase `maxconnection` in an ASP.NET application is to set [System.Net.ServicePointManager.DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit(VS.110).aspx) programmatically in the from `Application_Start` method in the *global.asax* file.</span></span> <span data-ttu-id="44ac7-276">Zapoznaj się z przykładowym pobraniem.</span><span class="sxs-lookup"><span data-stu-id="44ac7-276">See the sample download for an example.</span></span>
- <span data-ttu-id="44ac7-277">W programie .NET 4,5 wartość domyślna 5000 dla [maxConcurrentRequestsPerCPU](https://blogs.msdn.com/tmarq/archive/2007/07/21/asp-net-thread-usage-on-iis-7-0-and-6-0.aspx) powinna być dobra.</span><span class="sxs-lookup"><span data-stu-id="44ac7-277">In .NET 4.5, the default of 5000 for [MaxConcurrentRequestsPerCPU](https://blogs.msdn.com/tmarq/archive/2007/07/21/asp-net-thread-usage-on-iis-7-0-and-6-0.aspx) should be fine.</span></span>

## <a name="contributors"></a><span data-ttu-id="44ac7-278">Współautorzy</span><span class="sxs-lookup"><span data-stu-id="44ac7-278">Contributors</span></span>

- [<span data-ttu-id="44ac7-279">Broderick opłat</span><span class="sxs-lookup"><span data-stu-id="44ac7-279">Levi Broderick</span></span>](http://stackoverflow.com/users/59641/levi)
- [<span data-ttu-id="44ac7-280">Dykstra Tomasz</span><span class="sxs-lookup"><span data-stu-id="44ac7-280">Tom Dykstra</span></span>](http://www.bing.com/search?q=site%3Aasp.net+%22Tom+Dykstra%22+-forums.asp.net&amp;qs=n&amp;form=QBRE&amp;pq=site%3Aasp.net+%22tom+dykstra%22+-forums.asp.net&amp;sc=8-42&amp;sp=-1&amp;sk=)
- [<span data-ttu-id="44ac7-281">Brad Wilson</span><span class="sxs-lookup"><span data-stu-id="44ac7-281">Brad Wilson</span></span>](http://bradwilson.typepad.com/)
- [<span data-ttu-id="44ac7-282">HongMei GE</span><span class="sxs-lookup"><span data-stu-id="44ac7-282">HongMei Ge</span></span>](https://blogs.msdn.com/b/hongmeig/)
