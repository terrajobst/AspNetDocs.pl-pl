---
uid: web-forms/overview/data-access/accessing-the-database-directly-from-an-aspnet-page/using-parameterized-queries-with-the-sqldatasource-cs
title: Używanie zapytań parametrycznych z kontrolki SqlDataSource (C#) | Microsoft Docs
author: rick-anderson
description: W tym samouczku będziemy nadal korzystać z kontrolki kontrolki SqlDataSource i dowiedzieć się, jak definiować zapytania parametryczne. Parametry można określić zarówno w dekla...
ms.author: riande
ms.date: 02/20/2007
ms.assetid: 9128aaac-afe2-449f-84b2-bb1d035083c4
msc.legacyurl: /web-forms/overview/data-access/accessing-the-database-directly-from-an-aspnet-page/using-parameterized-queries-with-the-sqldatasource-cs
msc.type: authoredcontent
ms.openlocfilehash: 241dc8c089d4faa9eb95a63684e8a56756bb302c
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 11/28/2019
ms.locfileid: "74611301"
---
# <a name="using-parameterized-queries-with-the-sqldatasource-c"></a><span data-ttu-id="c2d6b-104">Używanie zapytań sparametryzowanych z kontrolką SqlDataSource (C#)</span><span class="sxs-lookup"><span data-stu-id="c2d6b-104">Using Parameterized Queries with the SqlDataSource (C#)</span></span>

<span data-ttu-id="c2d6b-105">przez [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="c2d6b-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="c2d6b-106">[Pobierz przykładową aplikację](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_48_CS.exe) lub [Pobierz plik PDF](using-parameterized-queries-with-the-sqldatasource-cs/_static/datatutorial48cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="c2d6b-106">[Download Sample App](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_48_CS.exe) or [Download PDF](using-parameterized-queries-with-the-sqldatasource-cs/_static/datatutorial48cs1.pdf)</span></span>

> <span data-ttu-id="c2d6b-107">W tym samouczku będziemy nadal korzystać z kontrolki kontrolki SqlDataSource i dowiedzieć się, jak definiować zapytania parametryczne.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-107">In this tutorial, we continue our look at the SqlDataSource control and learn how to define parameterized queries.</span></span> <span data-ttu-id="c2d6b-108">Parametry można określać jednocześnie i programowo, a także pobierać z wielu lokalizacji, takich jak QueryString, stan sesji, inne kontrolki i inne.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-108">The parameters can be specified both declaratively and programmatically, and can be pulled from a number of locations such as the querystring, Session state, other controls, and more.</span></span>

## <a name="introduction"></a><span data-ttu-id="c2d6b-109">Wprowadzenie</span><span class="sxs-lookup"><span data-stu-id="c2d6b-109">Introduction</span></span>

<span data-ttu-id="c2d6b-110">W poprzednim samouczku pokazano, jak za pomocą formantu kontrolki SqlDataSource pobrać dane bezpośrednio z bazy danych.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-110">In the previous tutorial we saw how to use the SqlDataSource control to retrieve data directly from a database.</span></span> <span data-ttu-id="c2d6b-111">Korzystając z Kreatora konfiguracji źródła danych, możemy wybrać bazę danych, a następnie: wybrać kolumny do zwrócenia z tabeli lub widoku; Wprowadź niestandardową instrukcję SQL; lub użyj procedury składowanej.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-111">Using the Configure Data Source wizard, we could choose the database and then either: pick the columns to return from a table or view; enter a custom SQL statement; or use a stored procedure.</span></span> <span data-ttu-id="c2d6b-112">Bez względu na to, czy wybierasz kolumny z tabeli czy widoku, czy wprowadzasz niestandardową instrukcję SQL, właściwość kontrolki SqlDataSource formantu `SelectCommand` s ma przypisaną powstałą instrukcję ad hoc SQL `SELECT` i jest to instrukcja `SELECT` wykonywana po wywołaniu metody kontrolki SqlDataSource s `Select()` (programowo lub automatycznie z formantu sieci Web danych).</span><span class="sxs-lookup"><span data-stu-id="c2d6b-112">Whether selecting columns from a table or view or entering a custom SQL statement, the SqlDataSource control s `SelectCommand` property is assigned the resulting ad-hoc SQL `SELECT` statement and it is this `SELECT` statement that is executed when the SqlDataSource s `Select()` method is invoked (either programmatically or automatically from a data Web control).</span></span>

<span data-ttu-id="c2d6b-113">Instrukcje SQL `SELECT` używane w poprzednich pokazach z samouczkiem s nie zostały `WHERE` klauzule.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-113">The SQL `SELECT` statements used in the previous tutorial s demos lacked `WHERE` clauses.</span></span> <span data-ttu-id="c2d6b-114">W instrukcji `SELECT` klauzula `WHERE` może służyć do ograniczania zwracanych wyników.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-114">In a `SELECT` statement, the `WHERE` clause can be used to limit the results returned.</span></span> <span data-ttu-id="c2d6b-115">Aby na przykład wyświetlić nazwy produktów, które są droższe niż $50,00, możemy użyć następującej kwerendy:</span><span class="sxs-lookup"><span data-stu-id="c2d6b-115">For example, to display the names of products costing more than $50.00, we could use the following query:</span></span>

[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample1.sql)]

<span data-ttu-id="c2d6b-116">Zazwyczaj wartości używane w klauzuli `WHERE` są określane przez niektóre źródła zewnętrzne, takie jak wartość QueryString, zmienna sesji lub dane wejściowe użytkownika z kontrolki sieci Web na stronie.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-116">Typically, the values used in a `WHERE` clause are determine by some external source, such as a querystring value, a session variable, or user input from a Web control on the page.</span></span> <span data-ttu-id="c2d6b-117">W idealnym przypadku takie dane wejściowe są określane za pomocą *parametrów*.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-117">Ideally, such inputs are specified through the use of *parameters*.</span></span> <span data-ttu-id="c2d6b-118">W przypadku Microsoft SQL Server parametry są oznaczane przy użyciu `@parameterName`, jak w:</span><span class="sxs-lookup"><span data-stu-id="c2d6b-118">With Microsoft SQL Server, parameters are denoted using `@parameterName`, as in:</span></span>

[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample2.sql)]

<span data-ttu-id="c2d6b-119">Kontrolki SqlDataSource obsługuje zapytania parametryczne, zarówno dla instrukcji `SELECT`, jak i `INSERT`, `UPDATE`i `DELETE` instrukcji.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-119">The SqlDataSource supports parameterized queries, both for `SELECT` statements and `INSERT`, `UPDATE`, and `DELETE` statements.</span></span> <span data-ttu-id="c2d6b-120">Ponadto wartości parametrów mogą być automatycznie ściągane z różnych źródeł, elementu QueryString, stanu sesji, formantów na stronie itd. lub można je przypisać programowo.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-120">Moreover, the parameter values can be automatically pulled from a variety of sources the querystring, session state, controls on the page, and so on or can be assigned programmatically.</span></span> <span data-ttu-id="c2d6b-121">W ramach tego samouczka zobaczymy, jak definiować sparametryzowane zapytania, a także jak określać wartości parametrów zarówno deklaratywnie, jak i programowo.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-121">In this tutorial, we'll see how to define parameterized queries as well as how to specify the parameter values both declaratively and programmatically.</span></span>

> [!NOTE]
> <span data-ttu-id="c2d6b-122">W poprzednim samouczku porównano element ObjectDataSource, który był narzędziem wybranym dla pierwszych 46 samouczków z kontrolki SqlDataSource, i notuje podobieństwa koncepcyjne.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-122">In the previous tutorial we compared the ObjectDataSource which has been our tool of choice over the first 46 tutorials with the SqlDataSource, noting their conceptual similarities.</span></span> <span data-ttu-id="c2d6b-123">Te podobieństwa również przechodzą do parametrów.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-123">These similarities also extend to parameters.</span></span> <span data-ttu-id="c2d6b-124">Parametry ObjectDataSource s zamapowane na parametry wejściowe dla metod w warstwie logiki biznesowej.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-124">The ObjectDataSource s parameters mapped to the input parameters for the methods in the Business Logic Layer.</span></span> <span data-ttu-id="c2d6b-125">Za pomocą kontrolki SqlDataSource parametry są definiowane bezpośrednio w zapytaniu SQL.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-125">With the SqlDataSource, the parameters are defined directly within the SQL query.</span></span> <span data-ttu-id="c2d6b-126">Obie kontrolki mają kolekcje parametrów dla ich metod `Select()`, `Insert()`, `Update()`i `Delete()`, a obie te wartości parametrów są wypełniane ze wstępnie zdefiniowanych źródeł (wartości QueryString, zmienne sesji itd.) lub przypisane programowo.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-126">Both controls have collections of parameters for their `Select()`, `Insert()`, `Update()`, and `Delete()` methods, and both can have these parameter values populated from pre-defined sources (querystring values, session variables, and so on) or assigned programmatically.</span></span>

## <a name="creating-a-parameterized-query"></a><span data-ttu-id="c2d6b-127">Tworzenie zapytania parametrycznego</span><span class="sxs-lookup"><span data-stu-id="c2d6b-127">Creating a Parameterized Query</span></span>

<span data-ttu-id="c2d6b-128">Kreator konfiguracji źródła danych kontrolki SqlDataSource Control s oferuje trzy drogi do definiowania polecenia do wykonania w celu pobrania rekordów bazy danych:</span><span class="sxs-lookup"><span data-stu-id="c2d6b-128">The SqlDataSource control s Configure Data Source wizard offers three avenues for defining the command to execute to retrieve database records:</span></span>

- <span data-ttu-id="c2d6b-129">Przez wybranie kolumn z istniejącej tabeli lub widoku,</span><span class="sxs-lookup"><span data-stu-id="c2d6b-129">By picking the columns from an existing table or view,</span></span>
- <span data-ttu-id="c2d6b-130">Wprowadzając niestandardową instrukcję SQL lub</span><span class="sxs-lookup"><span data-stu-id="c2d6b-130">By entering a custom SQL statement, or</span></span>
- <span data-ttu-id="c2d6b-131">Przez wybranie procedury składowanej</span><span class="sxs-lookup"><span data-stu-id="c2d6b-131">By choosing a stored procedure</span></span>

<span data-ttu-id="c2d6b-132">Podczas wybierania kolumn z istniejącej tabeli lub widoku, parametry dla klauzuli `WHERE` muszą być określone za pomocą okna dialogowego Dodaj klauzulę `WHERE`.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-132">When picking columns from an existing table or view, the parameters for the `WHERE` clause must be specified through the Add `WHERE` Clause dialog box.</span></span> <span data-ttu-id="c2d6b-133">W przypadku tworzenia niestandardowej instrukcji SQL można jednak wprowadzić parametry bezpośrednio w klauzuli `WHERE` (przy użyciu `@parameterName` do określenia poszczególnych parametrów).</span><span class="sxs-lookup"><span data-stu-id="c2d6b-133">When creating a custom SQL statement, however, you can enter the parameters directly into the `WHERE` clause (using `@parameterName` to denote each parameter).</span></span> <span data-ttu-id="c2d6b-134">[Procedura składowana](http://www.awprofessional.com/articles/article.asp?p=25288&amp;rl=1) składa się z co najmniej jednej instrukcji SQL, a te instrukcje mogą być sparametryzowane.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-134">A [stored procedure](http://www.awprofessional.com/articles/article.asp?p=25288&amp;rl=1) consists of one or more SQL statements, and these statements can be parameterized.</span></span> <span data-ttu-id="c2d6b-135">Jednakże parametry używane w instrukcjach SQL muszą być przesyłane jako parametry wejściowe do procedury składowanej.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-135">The parameters used in the SQL statements, however, must be passed in as input parameters to the stored procedure.</span></span>

<span data-ttu-id="c2d6b-136">Ponieważ Tworzenie zapytania sparametryzowanego zależą od tego, jak kontrolki SqlDataSource `SelectCommand` jest określona, powiadom o wszystkich trzech podejściach.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-136">Since creating a parameterized query depends on how the SqlDataSource s `SelectCommand` is specified, let s take a look at all three approaches.</span></span> <span data-ttu-id="c2d6b-137">Aby rozpocząć, Otwórz stronę `ParameterizedQueries.aspx` w folderze `SqlDataSource`, przeciągnij kontrolkę kontrolki SqlDataSource z przybornika do projektanta i ustaw jej `ID` na `Products25BucksAndUnderDataSource`.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-137">To get started, open the `ParameterizedQueries.aspx` page in the `SqlDataSource` folder, drag a SqlDataSource control from the Toolbox onto the Designer, and set its `ID` to `Products25BucksAndUnderDataSource`.</span></span> <span data-ttu-id="c2d6b-138">Następnie kliknij link Konfiguruj źródło danych z tagu inteligentnego sterowanie s.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-138">Next, click the Configure Data Source link from the control s smart tag.</span></span> <span data-ttu-id="c2d6b-139">Wybierz bazę danych, która ma zostać użyta (`NORTHWINDConnectionString`), a następnie kliknij przycisk Dalej.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-139">Select the database to use (`NORTHWINDConnectionString`) and click Next.</span></span>

## <a name="step-1-adding-awhereclause-when-picking-the-columns-from-a-table-or-view"></a><span data-ttu-id="c2d6b-140">Krok 1. Dodawanie klauzuli`WHERE`podczas wybierania kolumn z tabeli lub widoku</span><span class="sxs-lookup"><span data-stu-id="c2d6b-140">Step 1: Adding a`WHERE`Clause When Picking the Columns from a Table or View</span></span>

<span data-ttu-id="c2d6b-141">Po wybraniu danych do zwrócenia z bazy danych za pomocą kontrolki kontrolki SqlDataSource Kreator konfiguracji źródła danych umożliwia nam wybranie kolumn do zwrócenia z istniejącej tabeli lub widoku (patrz rysunek 1).</span><span class="sxs-lookup"><span data-stu-id="c2d6b-141">When selecting the data to return from the database with the SqlDataSource control, the Configure Data Source wizard allows us to simply pick the columns to return from an existing table or view (see Figure 1).</span></span> <span data-ttu-id="c2d6b-142">Spowoduje to automatyczne utworzenie instrukcji SQL `SELECT`, która jest wysyłana do bazy danych po wywołaniu metody kontrolki SqlDataSource s `Select()`.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-142">Doing so automatically builds up a SQL `SELECT` statement, which is what is sent to the database when the SqlDataSource s `Select()` method is invoked.</span></span> <span data-ttu-id="c2d6b-143">Tak jak w poprzednim samouczku wybierz tabelę produkty z listy rozwijanej i Sprawdź kolumny `ProductID`, `ProductName`i `UnitPrice`.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-143">As we did in the previous tutorial, select the Products table from the drop-down list and check the `ProductID`, `ProductName`, and `UnitPrice` columns.</span></span>

<span data-ttu-id="c2d6b-144">[![wybrać kolumny do zwrócenia z tabeli lub widoku](using-parameterized-queries-with-the-sqldatasource-cs/_static/image1.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="c2d6b-144">[![Pick the Columns to Return from a Table or View](using-parameterized-queries-with-the-sqldatasource-cs/_static/image1.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image1.png)</span></span>

<span data-ttu-id="c2d6b-145">**Rysunek 1**. Wybieranie kolumn do zwrócenia z tabeli lub widoku ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](using-parameterized-queries-with-the-sqldatasource-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="c2d6b-145">**Figure 1**: Pick the Columns to Return from a Table or View ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image2.png))</span></span>

<span data-ttu-id="c2d6b-146">Aby uwzględnić w instrukcji `SELECT` klauzulę `WHERE`, kliknij przycisk `WHERE`, który powoduje wyświetlenie okna dialogowego Dodawanie klauzuli `WHERE` (patrz rysunek 2).</span><span class="sxs-lookup"><span data-stu-id="c2d6b-146">To include a `WHERE` clause in the `SELECT` statement, click the `WHERE` button, which brings up the Add `WHERE` Clause dialog box (see Figure 2).</span></span> <span data-ttu-id="c2d6b-147">Aby dodać parametr w celu ograniczenia wyników zwracanych przez zapytanie `SELECT`, najpierw wybierz kolumnę, według której chcesz filtrować dane.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-147">To add a parameter to limit the results returned by the `SELECT` query, first choose the column to filter the data by.</span></span> <span data-ttu-id="c2d6b-148">Następnie wybierz operator, który ma być używany do filtrowania (=, &lt;, &lt;=, &gt;itd.).</span><span class="sxs-lookup"><span data-stu-id="c2d6b-148">Next, choose the operator to use for filtering (=, &lt;, &lt;=, &gt;, and so on).</span></span> <span data-ttu-id="c2d6b-149">Na koniec wybierz źródło wartości parametru s, takie jak from QueryString lub Session State.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-149">Finally, choose the source of the parameter s value, such as from the querystring or session state.</span></span> <span data-ttu-id="c2d6b-150">Po skonfigurowaniu parametru kliknij przycisk Dodaj, aby uwzględnić go w kwerendzie `SELECT`.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-150">After configuring the parameter, click the Add button to include it in the `SELECT` query.</span></span>

<span data-ttu-id="c2d6b-151">Na potrzeby tego przykładu należy zwrócić te wyniki tylko wtedy, gdy wartość `UnitPrice` jest mniejsza lub równa $25,00.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-151">For this example, let s only return those results where the `UnitPrice` value is less than or equal to $25.00.</span></span> <span data-ttu-id="c2d6b-152">W związku z tym wybierz `UnitPrice` z listy rozwijanej kolumny i &lt;= z listy rozwijanej operator.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-152">Therefore, pick `UnitPrice` from the Column drop-down list and &lt;= from the Operator drop-down list.</span></span> <span data-ttu-id="c2d6b-153">W przypadku użycia zakodowanej wartości parametru (na przykład $25,00) lub, jeśli wartość parametru ma być określona programowo, wybierz opcję Brak z listy rozwijanej Źródło.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-153">When using a hard-coded parameter value (such as $25.00) or if the parameter value is to be specified programmatically, select None from the Source drop-down list.</span></span> <span data-ttu-id="c2d6b-154">Następnie wprowadź zakodowaną wartość parametru w polu tekstowym wartość 25,00 i Ukończ ten proces, klikając przycisk Dodaj.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-154">Next, enter the hard-coded parameter value in the Value textbox 25.00 and complete the process by clicking the Add button.</span></span>

<span data-ttu-id="c2d6b-155">[![ograniczyć wyniki zwracane z okna dialogowego Dodawanie klauzuli WHERE](using-parameterized-queries-with-the-sqldatasource-cs/_static/image2.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="c2d6b-155">[![Limit the Results Returned from the Add WHERE Clause Dialog Box](using-parameterized-queries-with-the-sqldatasource-cs/_static/image2.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image3.png)</span></span>

<span data-ttu-id="c2d6b-156">**Rysunek 2**. Ograniczanie wyników zwróconych z okna dialogowego Dodaj klauzulę `WHERE` ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](using-parameterized-queries-with-the-sqldatasource-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="c2d6b-156">**Figure 2**: Limit the Results Returned from the Add `WHERE` Clause Dialog Box ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image4.png))</span></span>

<span data-ttu-id="c2d6b-157">Po dodaniu parametru kliknij przycisk OK, aby powrócić do Kreatora konfiguracji źródła danych.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-157">After adding the parameter, click OK to return to the Configure Data Source wizard.</span></span> <span data-ttu-id="c2d6b-158">Instrukcja `SELECT` w dolnej części kreatora powinna teraz zawierać klauzulę `WHERE` z parametrem o nazwie `@UnitPrice`:</span><span class="sxs-lookup"><span data-stu-id="c2d6b-158">The `SELECT` statement at the bottom of the wizard should now include a `WHERE` clause with a parameter named `@UnitPrice`:</span></span>

[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample3.sql)]

> [!NOTE]
> <span data-ttu-id="c2d6b-159">Jeśli określisz wiele warunków w klauzuli `WHERE` z okna dialogowego Dodaj klauzulę `WHERE`, Kreator przyłączy je za pomocą operatora `AND`.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-159">If you specify multiple conditions in the `WHERE` clause from the Add `WHERE` Clause dialog box, the wizard joins them with the `AND` operator.</span></span> <span data-ttu-id="c2d6b-160">Jeśli konieczne jest uwzględnienie `OR` w klauzuli `WHERE` (na przykład `WHERE UnitPrice <= @UnitPrice OR Discontinued = 1`), należy utworzyć instrukcję `SELECT` za pomocą niestandardowego ekranu instrukcji SQL.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-160">If you need to include an `OR` in the `WHERE` clause (such as `WHERE UnitPrice <= @UnitPrice OR Discontinued = 1`) then you have to build the `SELECT` statement through the custom SQL statement screen.</span></span>

<span data-ttu-id="c2d6b-161">Ukończ Konfigurowanie kontrolki SqlDataSource (kliknij przycisk Dalej, następnie Zakończ), a następnie sprawdź znaczniki deklaratywne kontrolki SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-161">Complete configuring the SqlDataSource (click Next, then Finish) and then inspect the SqlDataSource s declarative markup.</span></span> <span data-ttu-id="c2d6b-162">Znacznik zawiera teraz kolekcję `<SelectParameters>`, która sprawdza źródła parametrów w `SelectCommand`.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-162">The markup now includes a `<SelectParameters>` collection, which spells out the sources for the parameters in the `SelectCommand`.</span></span>

[!code-aspx[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample4.aspx)]

<span data-ttu-id="c2d6b-163">Po wywołaniu metody kontrolki SqlDataSource s `Select()` wartość parametru `UnitPrice` (25,00) zostanie zastosowana do parametru `@UnitPrice` w `SelectCommand` przed wysłaniem do bazy danych.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-163">When the SqlDataSource s `Select()` method is invoked, the `UnitPrice` parameter value (25.00) is applied to the `@UnitPrice` parameter in the `SelectCommand` before being sent to the database.</span></span> <span data-ttu-id="c2d6b-164">Wynikiem jest to, że tylko produkty mniejsze niż lub równe $25,00 są zwracane z tabeli `Products`.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-164">The net result is that only those products less than or equal to $25.00 are returned from the `Products` table.</span></span> <span data-ttu-id="c2d6b-165">Aby to potwierdzić, Dodaj widok GridView do strony, powiąż go z tym źródłem danych, a następnie Wyświetl stronę za pomocą przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-165">To confirm this, add a GridView to the page, bind it to this data source, and then view the page through a browser.</span></span> <span data-ttu-id="c2d6b-166">Należy zobaczyć tylko te produkty, które są mniejsze lub równe $25,00, jak pokazano na rysunku 3.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-166">You should only see those products listed that are less than or equal to $25.00, as Figure 3 confirms.</span></span>

<span data-ttu-id="c2d6b-167">[![wyświetlane są tylko te produkty, które są mniejsze lub równe $25,00](using-parameterized-queries-with-the-sqldatasource-cs/_static/image3.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="c2d6b-167">[![Only Those Products Less Than or Equal to $25.00 are Displayed](using-parameterized-queries-with-the-sqldatasource-cs/_static/image3.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image5.png)</span></span>

<span data-ttu-id="c2d6b-168">**Rysunek 3**. wyświetlane są tylko te produkty, które są mniejsze lub równe $25,00 ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](using-parameterized-queries-with-the-sqldatasource-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="c2d6b-168">**Figure 3**: Only Those Products Less Than or Equal to $25.00 are Displayed ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image6.png))</span></span>

## <a name="step-2-adding-parameters-to-a-custom-sql-statement"></a><span data-ttu-id="c2d6b-169">Krok 2. Dodawanie parametrów do niestandardowej instrukcji SQL</span><span class="sxs-lookup"><span data-stu-id="c2d6b-169">Step 2: Adding Parameters to a Custom SQL Statement</span></span>

<span data-ttu-id="c2d6b-170">Podczas dodawania niestandardowej instrukcji SQL można wprowadzić klauzulę `WHERE` jawnie lub określić wartość w komórce filtru Konstruktor zapytań.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-170">When adding a custom SQL statement you can enter the `WHERE` clause explicitly or specify a value in the Filter cell of the Query Builder.</span></span> <span data-ttu-id="c2d6b-171">Aby to zademonstrować, należy wyświetlić tylko te produkty w widoku GridView, których ceny są mniejsze niż określony próg.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-171">To demonstrate this, let s display just those products in a GridView whose prices are less than a certain threshold.</span></span> <span data-ttu-id="c2d6b-172">Zacznij od dodania pola tekstowego do strony `ParameterizedQueries.aspx`, aby zebrać tę wartość progową od użytkownika.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-172">Start by adding a TextBox to the `ParameterizedQueries.aspx` page to collect this threshold value from the user.</span></span> <span data-ttu-id="c2d6b-173">Ustaw właściwość TextBox s `ID` na `MaxPrice`.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-173">Set the TextBox s `ID` property to `MaxPrice`.</span></span> <span data-ttu-id="c2d6b-174">Dodaj kontrolkę sieci Web przycisk i ustaw jej Właściwość `Text`, aby wyświetlić pasujące produkty.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-174">Add a Button Web control and set its `Text` property to Display Matching Products .</span></span>

<span data-ttu-id="c2d6b-175">Następnie przeciągnij widok GridView na stronę i z jego tagu inteligentnego wybierz, aby utworzyć nowy kontrolki SqlDataSource o nazwie `ProductsFilteredByPriceDataSource`.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-175">Next, drag a GridView onto the page and from its smart tag choose to create a new SqlDataSource named `ProductsFilteredByPriceDataSource`.</span></span> <span data-ttu-id="c2d6b-176">W Kreatorze konfiguracji źródła danych przejdź do ekranu Określ niestandardową instrukcję SQL lub procedurę składowaną (zobacz rysunek 4) i wprowadź następujące zapytanie:</span><span class="sxs-lookup"><span data-stu-id="c2d6b-176">From the Configure Data Source wizard, proceed to the Specify a custom SQL statement or stored procedure screen (see Figure 4) and enter the following query:</span></span>

[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample5.sql)]

<span data-ttu-id="c2d6b-177">Po wprowadzeniu zapytania (ręcznie lub za pomocą Konstruktor zapytań) kliknij przycisk Dalej.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-177">After entering the query (either manually or through the Query Builder), click Next.</span></span>

<span data-ttu-id="c2d6b-178">[![zwracać tylko produkty mniejsze niż lub równe wartości parametru](using-parameterized-queries-with-the-sqldatasource-cs/_static/image4.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="c2d6b-178">[![Return Only Those Products Less Than or Equal to a Parameter Value](using-parameterized-queries-with-the-sqldatasource-cs/_static/image4.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image7.png)</span></span>

<span data-ttu-id="c2d6b-179">**Rysunek 4**. Zwracanie tylko tych produktów, których wartość jest mniejsza lub równa wartości parametru ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](using-parameterized-queries-with-the-sqldatasource-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="c2d6b-179">**Figure 4**: Return Only Those Products Less Than or Equal to a Parameter Value ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image8.png))</span></span>

<span data-ttu-id="c2d6b-180">Ponieważ zapytanie zawiera parametry, następnym ekranem w kreatorze zostanie wyświetlony komunikat z prośbą o źródło wartości parametrów.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-180">Since the query includes parameters, the next screen in the wizard prompts us for the source of the parameters values.</span></span> <span data-ttu-id="c2d6b-181">Wybierz kontrolkę z listy rozwijanej Źródło parametru i `MaxPrice` (pole tekstowe kontrolka `ID` wartość) z listy rozwijanej ControlID.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-181">Choose Control from the Parameter source drop-down list and `MaxPrice` (the TextBox control s `ID` value) from the ControlID drop-down list.</span></span> <span data-ttu-id="c2d6b-182">Możesz również wprowadzić opcjonalną wartość domyślną, która ma być używana w przypadku, gdy użytkownik nie wprowadził tekstu do `MaxPrice` TextBox.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-182">You can also enter an optional default value to use in the case where the user has not entered any text into the `MaxPrice` TextBox.</span></span> <span data-ttu-id="c2d6b-183">W danym momencie nie należy wprowadzać wartości domyślnej.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-183">For the time being, do not enter a default value.</span></span>

<span data-ttu-id="c2d6b-184">[![właściwość Text pola tekstowego MaxPrice jest używana jako źródło parametru](using-parameterized-queries-with-the-sqldatasource-cs/_static/image5.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="c2d6b-184">[![The MaxPrice TextBox s Text Property is Used as the Parameter Source](using-parameterized-queries-with-the-sqldatasource-cs/_static/image5.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image9.png)</span></span>

<span data-ttu-id="c2d6b-185">**Rysunek 5**: Właściwość `MaxPrice` TextBox s `Text` jest używana jako źródło parametru ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](using-parameterized-queries-with-the-sqldatasource-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="c2d6b-185">**Figure 5**: The `MaxPrice` TextBox s `Text` Property is Used as the Parameter Source ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image10.png))</span></span>

<span data-ttu-id="c2d6b-186">Ukończ pracę Kreatora konfiguracji źródła danych, klikając przycisk Dalej, a następnie przycisk Zakończ.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-186">Complete the Configure Data Source wizard by clicking Next, then Finish.</span></span> <span data-ttu-id="c2d6b-187">Znaczniki deklaratywne dla elementu GridView, TextBox, Button i kontrolki SqlDataSource są następujące:</span><span class="sxs-lookup"><span data-stu-id="c2d6b-187">The declarative markup for the GridView, TextBox, Button, and SqlDataSource follows:</span></span>

[!code-aspx[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample6.aspx)]

<span data-ttu-id="c2d6b-188">Należy zauważyć, że parametr w sekcji kontrolki SqlDataSource `<SelectParameters>` jest `ControlParameter`, który zawiera dodatkowe właściwości, takie jak `ControlID` i `PropertyName`.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-188">Note that the parameter within the SqlDataSource s `<SelectParameters>` section is a `ControlParameter`, which includes additional properties like `ControlID` and `PropertyName`.</span></span> <span data-ttu-id="c2d6b-189">Po wywołaniu metody kontrolki SqlDataSource `Select()` s `ControlParameter` ponosi wartość z określonej właściwości kontrolki sieci Web i przypisze ją do odpowiedniego parametru w `SelectCommand`.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-189">When the SqlDataSource s `Select()` method is invoked, the `ControlParameter` grabs the value from the specified Web control property and assigns it to the corresponding parameter in the `SelectCommand`.</span></span> <span data-ttu-id="c2d6b-190">W tym przykładzie właściwość Text `MaxPrice` s jest używana jako wartość parametru `@MaxPrice`.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-190">In this example, the `MaxPrice` s Text property is used as the `@MaxPrice` parameter value.</span></span>

<span data-ttu-id="c2d6b-191">Poświęć minutę na wyświetlenie tej strony za pomocą przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-191">Take a minute to view this page through a browser.</span></span> <span data-ttu-id="c2d6b-192">Podczas pierwszego odwiedzania strony lub gdy pole tekstowe `MaxPrice` nie ma wartości, w widoku GridView nie są wyświetlane żadne rekordy.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-192">When first visiting the page or whenever the `MaxPrice` TextBox lacks a value no records are displayed in the GridView.</span></span>

<span data-ttu-id="c2d6b-193">[![żadne rekordy nie są wyświetlane, gdy pole tekstowe MaxPrice jest puste](using-parameterized-queries-with-the-sqldatasource-cs/_static/image6.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="c2d6b-193">[![No Records are Displayed When the MaxPrice TextBox is Empty](using-parameterized-queries-with-the-sqldatasource-cs/_static/image6.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image11.png)</span></span>

<span data-ttu-id="c2d6b-194">**Ilustracja 6**. nie są wyświetlane żadne rekordy, gdy pole tekstowe `MaxPrice` jest puste ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](using-parameterized-queries-with-the-sqldatasource-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="c2d6b-194">**Figure 6**: No Records are Displayed When the `MaxPrice` TextBox is Empty ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image12.png))</span></span>

<span data-ttu-id="c2d6b-195">Nie są wyświetlane żadne produkty, ponieważ domyślnie pusty ciąg dla wartości parametru jest konwertowany na wartość `NULL` bazy danych.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-195">The reason no products are shown is because, by default, an empty string for a parameter value is converted into a database `NULL` value.</span></span> <span data-ttu-id="c2d6b-196">Ponieważ porównanie `[UnitPrice] <= NULL` ma zawsze wartość false, nie są zwracane żadne wyniki.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-196">Since the comparison of `[UnitPrice] <= NULL` always evaluates as False, no results are returned.</span></span>

<span data-ttu-id="c2d6b-197">Wprowadź wartość w polu tekstowym, na przykład 5,00, a następnie kliknij przycisk Wyświetl pasujące produkty.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-197">Enter a value into the textbox, like 5.00, and click the Display Matching Products button.</span></span> <span data-ttu-id="c2d6b-198">Na stronie ogłaszania zwrotnego kontrolki SqlDataSource informuje widok GridView o zmianie jednego ze źródeł parametrów.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-198">On postback, the SqlDataSource informs the GridView that one of its parameter sources has changed.</span></span> <span data-ttu-id="c2d6b-199">W związku z tym, GridView ponownie wiąże się z kontrolki SqlDataSource, wyświetlając te produkty mniejsze lub równe $5,00.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-199">Consequently, the GridView rebinds to the SqlDataSource, displaying those products less than or equal to $5.00.</span></span>

<span data-ttu-id="c2d6b-200">[![są wyświetlane produkty mniejsze lub równe $5,00](using-parameterized-queries-with-the-sqldatasource-cs/_static/image7.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="c2d6b-200">[![Products Less Than or Equal to $5.00 are Displayed](using-parameterized-queries-with-the-sqldatasource-cs/_static/image7.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image13.png)</span></span>

<span data-ttu-id="c2d6b-201">**Rysunek 7**. wyświetlane są produkty mniejsze niż lub równe $5,00 ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](using-parameterized-queries-with-the-sqldatasource-cs/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="c2d6b-201">**Figure 7**: Products Less Than or Equal to $5.00 are Displayed ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image14.png))</span></span>

## <a name="initially-displaying-all-products"></a><span data-ttu-id="c2d6b-202">Początkowo wyświetlane są wszystkie produkty</span><span class="sxs-lookup"><span data-stu-id="c2d6b-202">Initially Displaying All Products</span></span>

<span data-ttu-id="c2d6b-203">Zamiast nie wyświetlać żadnych produktów podczas pierwszego ładowania strony, możemy chcieć wyświetlić *wszystkie* produkty.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-203">Rather than displaying no products when the page is first loaded, we may want to display *all* products.</span></span> <span data-ttu-id="c2d6b-204">Jednym ze sposobów wyświetlania listy wszystkich produktów za każdym razem, gdy `MaxPrice` pole jest puste, jest ustawienie wartości domyślnej parametru s na wartość wyjątkowo o wysokiej wartości, na przykład 1000000, ponieważ jest mało prawdopodobne, że firma Northwind Traders będzie miała spis, którego cena jednostkowa przekracza $1 000 000.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-204">One way to list all products whenever the `MaxPrice` TextBox is empty is to set the parameter s default value to some insanely high value, like 1000000, since it s unlikely that Northwind Traders will ever have inventory whose unit price exceeds $1,000,000.</span></span> <span data-ttu-id="c2d6b-205">Jednak takie podejście jest shortsighted i może nie zadziałać w innych sytuacjach.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-205">However, this approach is shortsighted and might not work in other situations.</span></span>

<span data-ttu-id="c2d6b-206">W poprzednich samouczkach — [Parametry deklaratywne](../basic-reporting/declarative-parameters-cs.md) i [wzorzec/szczegóły filtrowania przy użyciu DropDownList](../masterdetail/master-detail-filtering-with-a-dropdownlist-cs.md) z podobnym problemem.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-206">In previous tutorials - [Declarative Parameters](../basic-reporting/declarative-parameters-cs.md) and [Master/Detail Filtering With a DropDownList](../masterdetail/master-detail-filtering-with-a-dropdownlist-cs.md) we were faced with a similar problem.</span></span> <span data-ttu-id="c2d6b-207">Nasze rozwiązanie ma umieścić tę logikę w warstwie logiki biznesowej.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-207">Our solution there was to put this logic in the Business Logic Layer.</span></span> <span data-ttu-id="c2d6b-208">LOGIKI biznesowej zbadał wartość przychodzącą i, jeśli była `NULL` lub określona wartość zastrzeżona, wywołanie zostało przekazane do metody DAL, która zwróciła wszystkie rekordy.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-208">Specifically, the BLL examined the incoming value and, if it was `NULL` or some reserved value, the call was routed to the DAL method that returned all records.</span></span> <span data-ttu-id="c2d6b-209">Jeśli wartość przychodząca była normalną wartością filtrowania, nastąpiło wywołanie metody DAL, która wykonała instrukcję SQL, która używała sparametryzowanej klauzuli `WHERE` z podaną wartością.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-209">If the incoming value was a normal filtering value, a call was made to the DAL method that executed a SQL statement that used a parameterized `WHERE` clause with the supplied value.</span></span>

<span data-ttu-id="c2d6b-210">Niestety, pomijamy architekturę przy użyciu kontrolki SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-210">Unfortunately, we bypass the architecture when using the SqlDataSource.</span></span> <span data-ttu-id="c2d6b-211">Zamiast tego musimy dostosować instrukcję SQL, aby inteligentnie odfiltrować wszystkie rekordy, jeśli parametr `@MaximumPrice` jest `NULL` lub pewnej wartości zastrzeżonej.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-211">Instead, we need to customize the SQL statement to intelligently grab all records if the `@MaximumPrice` parameter is `NULL` or some reserved value.</span></span> <span data-ttu-id="c2d6b-212">Na potrzeby tego ćwiczenia poinformuj ich, że jeśli parametr `@MaximumPrice` jest równy `-1.0`, *wszystkie* rekordy zostaną zwrócone (`-1.0` działa jako wartość zastrzeżona, ponieważ żaden produkt nie może mieć ujemnej wartości `UnitPrice`).</span><span class="sxs-lookup"><span data-stu-id="c2d6b-212">For this exercise, let s have it so that if the `@MaximumPrice` parameter is equal to `-1.0`, then *all* of the records are to be returned (`-1.0` works as a reserved value since no product can have a negative `UnitPrice` value).</span></span> <span data-ttu-id="c2d6b-213">Aby to osiągnąć, można użyć następującej instrukcji SQL:</span><span class="sxs-lookup"><span data-stu-id="c2d6b-213">To accomplish this we can use the following SQL statement:</span></span>

[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample7.sql)]

<span data-ttu-id="c2d6b-214">Ta `WHERE` klauzula zwraca *wszystkie* rekordy, jeśli parametr `@MaximumPrice` jest równy `-1.0`.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-214">This `WHERE` clause returns *all* records if the `@MaximumPrice` parameter equals `-1.0`.</span></span> <span data-ttu-id="c2d6b-215">Jeśli wartość parametru nie jest `-1.0`, zwracane są tylko te produkty, których `UnitPrice` jest mniejsza niż lub równa wartości parametru `@MaximumPrice`.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-215">If the parameter value is not `-1.0`, only those products whose `UnitPrice` is less than or equal to the `@MaximumPrice` parameter value are returned.</span></span> <span data-ttu-id="c2d6b-216">Ustawiając wartość domyślną parametru `@MaximumPrice` na `-1.0`, podczas pierwszego ładowania strony (lub za każdym razem, gdy pole tekstowe `MaxPrice` jest puste), `@MaximumPrice` będzie mieć wartość `-1.0` i zostaną wyświetlone wszystkie produkty.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-216">By setting the default value of the `@MaximumPrice` parameter to `-1.0`, on the first page load (or whenever the `MaxPrice` TextBox is empty), `@MaximumPrice` will have a value of `-1.0` and all products will be displayed.</span></span>

<span data-ttu-id="c2d6b-217">[![teraz wszystkie produkty są wyświetlane, gdy pole tekstowe MaxPrice jest puste](using-parameterized-queries-with-the-sqldatasource-cs/_static/image8.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="c2d6b-217">[![Now All Products are Displayed When the MaxPrice TextBox is Empty](using-parameterized-queries-with-the-sqldatasource-cs/_static/image8.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image15.png)</span></span>

<span data-ttu-id="c2d6b-218">**Ilustracja 8**. teraz wszystkie produkty są wyświetlane, gdy pole tekstowe `MaxPrice` jest puste ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](using-parameterized-queries-with-the-sqldatasource-cs/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="c2d6b-218">**Figure 8**: Now All Products are Displayed When the `MaxPrice` TextBox is Empty ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image16.png))</span></span>

<span data-ttu-id="c2d6b-219">Istnieje kilka sposobów zaewidencjonowania tego podejścia.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-219">There are a couple of caveats to note with this approach.</span></span> <span data-ttu-id="c2d6b-220">Najpierw należy pamiętać, że typ danych parametru s jest wnioskowany przez użycie przez niego w zapytaniu SQL.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-220">First, realize that the parameter s data type is inferred by it s usage in the SQL query.</span></span> <span data-ttu-id="c2d6b-221">Jeśli zmienisz klauzulę `WHERE` z `@MaximumPrice = -1.0` na `@MaximumPrice = -1`, środowisko uruchomieniowe traktuje parametr jako liczbę całkowitą.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-221">If you change the `WHERE` clause from `@MaximumPrice = -1.0` to `@MaximumPrice = -1`, the runtime treats the parameter as an integer.</span></span> <span data-ttu-id="c2d6b-222">Jeśli następnie zostanie podjęta próba przypisania `MaxPrice` TextBox do wartości dziesiętnej (na przykład 5,00), wystąpi błąd, ponieważ nie można skonwertować 5,00 na liczbę całkowitą.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-222">If you then attempt to assign the `MaxPrice` TextBox to a decimal value (like 5.00 ), an error will occur because it cannot convert 5.00 to an integer.</span></span> <span data-ttu-id="c2d6b-223">Aby to naprawić, upewnij się, że używasz `@MaximumPrice = -1.0` w klauzuli `WHERE` lub jeszcze lepiej ustaw właściwość `Type` obiektu `ControlParameter` na wartość dziesiętną.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-223">To remedy this, either make sure that you use `@MaximumPrice = -1.0` in the `WHERE` clause or, better yet, set the `ControlParameter` object s `Type` property to Decimal .</span></span>

<span data-ttu-id="c2d6b-224">Po drugie, dodając `OR @MaximumPrice = -1.0` do klauzuli `WHERE`, aparat zapytań nie może użyć indeksu w `UnitPrice` (przy założeniu, że taki istnieje), co prowadzi do skanowania tabeli.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-224">Secondly, by adding the `OR @MaximumPrice = -1.0` to the `WHERE` clause, the query engine cannot use an index on `UnitPrice` (assuming one exists), thereby resulting in a table scan.</span></span> <span data-ttu-id="c2d6b-225">Może to mieć wpływ na wydajność, jeśli w tabeli `Products` istnieje wystarczająco duża liczba rekordów.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-225">This can impact performance if there are a sufficiently large number of records in the `Products` table.</span></span> <span data-ttu-id="c2d6b-226">Lepszym rozwiązaniem jest przeniesienie tej logiki do procedury składowanej, w której instrukcja `IF` może wykonać zapytanie `SELECT` z tabeli `Products` bez klauzuli `WHERE`, gdy wszystkie rekordy muszą zostać zwrócone lub jeden z klauzul `WHERE` zawiera tylko kryteria `UnitPrice`, aby można było użyć indeksu.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-226">A better approach would be to move this logic to a stored procedure where an `IF` statement would either perform a `SELECT` query from the `Products` table without a `WHERE` clause when all records need to be returned or one whose `WHERE` clause contains just the `UnitPrice` criteria, so that an index can be used.</span></span>

## <a name="step-3-creating-and-using-parameterized-stored-procedures"></a><span data-ttu-id="c2d6b-227">Krok 3. Tworzenie i używanie sparametryzowanych procedur składowanych</span><span class="sxs-lookup"><span data-stu-id="c2d6b-227">Step 3: Creating and Using Parameterized Stored Procedures</span></span>

<span data-ttu-id="c2d6b-228">Procedury składowane mogą zawierać zestaw parametrów wejściowych, które mogą być następnie używane w instrukcjach SQL zdefiniowanych w ramach procedury składowanej.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-228">Stored procedures can include a set of input parameters that can then be used in the SQL statement(s) defined within the stored procedure.</span></span> <span data-ttu-id="c2d6b-229">Podczas konfigurowania kontrolki SqlDataSource do używania procedury składowanej, która akceptuje parametry wejściowe, te wartości parametrów można określić przy użyciu tych samych technik jak w przypadku instrukcji SQL ad hoc.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-229">When configuring the SqlDataSource to use a stored procedure that accepts input parameters, these parameter values can be specified using the same techniques as with ad-hoc SQL statements.</span></span>

<span data-ttu-id="c2d6b-230">Aby zilustrować procedury składowane w kontrolki SqlDataSource, pozwól s utworzyć nową procedurę składowaną w bazie danych Northwind o nazwie `GetProductsByCategory`, która akceptuje parametr o nazwie `@CategoryID` i zwraca wszystkie kolumny produktów, których kolumna `CategoryID` pasuje do `@CategoryID`.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-230">To illustrate using stored procedures in the SqlDataSource, let s create a new stored procedure in the Northwind database named `GetProductsByCategory`, which accepts a parameter named `@CategoryID` and returns all of the columns of the products whose `CategoryID` column matches `@CategoryID`.</span></span> <span data-ttu-id="c2d6b-231">Aby utworzyć procedurę przechowywaną, przejdź do Eksplorator serwera i przechodzenie do szczegółów `NORTHWND.MDF` bazie danych.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-231">To create a stored procedure, go to the Server Explorer and drill down into the `NORTHWND.MDF` database.</span></span> <span data-ttu-id="c2d6b-232">(Jeśli nie widzisz Eksplorator serwera, przenieś je, przechodząc do menu Widok i wybierając opcję Eksplorator serwera).</span><span class="sxs-lookup"><span data-stu-id="c2d6b-232">(If you don t see the Server Explorer, bring it up by going to the View menu and selecting the Server Explorer option.)</span></span>

<span data-ttu-id="c2d6b-233">W bazie danych `NORTHWND.MDF` kliknij prawym przyciskiem myszy folder procedury składowane, wybierz polecenie Dodaj nową procedurę składowaną, a następnie wprowadź następującą składnię:</span><span class="sxs-lookup"><span data-stu-id="c2d6b-233">From the `NORTHWND.MDF` database, right-click on the Stored Procedures folder, choose Add New Stored Procedure, and enter the following syntax:</span></span>

[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample8.sql)]

<span data-ttu-id="c2d6b-234">Kliknij ikonę Zapisz (lub Ctrl + S), aby zapisać procedurę składowaną.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-234">Click the Save icon (or Ctrl+S) to save the stored procedure.</span></span> <span data-ttu-id="c2d6b-235">Procedurę składowaną można przetestować, klikając ją prawym przyciskiem myszy w folderze procedury składowane, a następnie wybierając polecenie wykonaj.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-235">You can test the stored procedure by right-clicking it from the Stored Procedures folder and choosing Execute.</span></span> <span data-ttu-id="c2d6b-236">Spowoduje to wyświetlenie monitu o podanie parametrów procedury składowanej s (`@CategoryID`w tym wystąpieniu), po upływie którego wyniki będą wyświetlane w oknie danych wyjściowych.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-236">This will prompt you for the stored procedure s parameters (`@CategoryID`, in this instance), after which the results will be displayed in the Output window.</span></span>

<span data-ttu-id="c2d6b-237">[![procedury składowanej GetProductsByCategory podczas wykonywania z @CategoryID 1](using-parameterized-queries-with-the-sqldatasource-cs/_static/image9.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="c2d6b-237">[![The GetProductsByCategory Stored Procedure when Executed with a @CategoryID of 1](using-parameterized-queries-with-the-sqldatasource-cs/_static/image9.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image17.png)</span></span>

<span data-ttu-id="c2d6b-238">**Rysunek 9**. `GetProductsByCategory` procedury składowanej w przypadku wykonywania z `@CategoryID` 1 ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](using-parameterized-queries-with-the-sqldatasource-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="c2d6b-238">**Figure 9**: The `GetProductsByCategory` Stored Procedure when Executed with a `@CategoryID` of 1 ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image18.png))</span></span>

<span data-ttu-id="c2d6b-239">Niech s Użyj tej procedury składowanej, aby wyświetlić wszystkie produkty w kategorii napoje w widoku GridView.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-239">Let s use this stored procedure to display all products in the Beverages category in a GridView.</span></span> <span data-ttu-id="c2d6b-240">Dodaj nowy element GridView do strony i powiąż go z nowym kontrolki SqlDataSource o nazwie `BeverageProductsDataSource`.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-240">Add a new GridView to the page and bind it to a new SqlDataSource named `BeverageProductsDataSource`.</span></span> <span data-ttu-id="c2d6b-241">Przejdź do ekranu Określ niestandardową instrukcję SQL lub procedurę składowaną, wybierz przycisk radiowy procedury składowanej i wybierz procedurę składowaną `GetProductsByCategory` z listy rozwijanej.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-241">Continue to the Specify a custom SQL statement or stored procedure screen, select the Stored procedure radio button, and pick the `GetProductsByCategory` stored procedure from the drop-down list.</span></span>

<span data-ttu-id="c2d6b-242">[![wybierz procedurę składowaną GetProductsByCategory z listy rozwijanej](using-parameterized-queries-with-the-sqldatasource-cs/_static/image10.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="c2d6b-242">[![Select the GetProductsByCategory Stored Procedure from the Drop-Down List](using-parameterized-queries-with-the-sqldatasource-cs/_static/image10.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image19.png)</span></span>

<span data-ttu-id="c2d6b-243">**Ilustracja 10**. Wybierz `GetProductsByCategory` procedurę składowaną z listy rozwijanej (kliknij,[Aby wyświetlić obraz o pełnym rozmiarze](using-parameterized-queries-with-the-sqldatasource-cs/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="c2d6b-243">**Figure 10**: Select the `GetProductsByCategory` Stored Procedure from the Drop-Down List ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image20.png))</span></span>

<span data-ttu-id="c2d6b-244">Ponieważ procedura składowana akceptuje parametr wejściowy (`@CategoryID`), kliknij przycisk Dalej monituje nas, aby określić źródło dla tej wartości parametru s.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-244">Since the stored procedure accepts an input parameter (`@CategoryID`), clicking Next prompts us to specify the source for this parameter s value.</span></span> <span data-ttu-id="c2d6b-245">Napoje `CategoryID` są 1, więc pozostaw listę rozwijaną Źródło parametru w polu brak i wprowadź wartość 1 w polu tekstowym DefaultValue.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-245">The Beverages `CategoryID` is 1, so leave the Parameter source drop-down list at None and enter 1 into the DefaultValue textbox.</span></span>

<span data-ttu-id="c2d6b-246">[![użyć zakodowanej wartości 1, aby zwrócić produkty z kategorii napoje](using-parameterized-queries-with-the-sqldatasource-cs/_static/image11.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="c2d6b-246">[![Use a Hard-Coded Value of 1 to Return the Products in the Beverages Category](using-parameterized-queries-with-the-sqldatasource-cs/_static/image11.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image21.png)</span></span>

<span data-ttu-id="c2d6b-247">**Rysunek 11**. Użyj zakodowanej wartości 1, aby zwrócić produkty z kategorii napoje ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](using-parameterized-queries-with-the-sqldatasource-cs/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="c2d6b-247">**Figure 11**: Use a Hard-Coded Value of 1 to Return the Products in the Beverages Category ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image22.png))</span></span>

<span data-ttu-id="c2d6b-248">Jak pokazano poniżej, w przypadku używania procedury składowanej, właściwość kontrolki SqlDataSource `SelectCommand` s jest ustawiana na nazwę procedury składowanej, a [właściwość`SelectCommandType`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.selectcommandtype.aspx) jest ustawiona na `StoredProcedure`, wskazując, że `SelectCommand` jest nazwą procedury składowanej, a nie instrukcją SQL ad hoc.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-248">As the following declarative markup shows, when using a stored procedure, the SqlDataSource s `SelectCommand` property is set to the name of the stored procedure and the [`SelectCommandType` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.selectcommandtype.aspx) is set to `StoredProcedure`, indicating that the `SelectCommand` is the name of a stored procedure rather than an ad-hoc SQL statement.</span></span>

[!code-aspx[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample9.aspx)]

<span data-ttu-id="c2d6b-249">Przetestuj stronę w przeglądarce.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-249">Test out the page in a browser.</span></span> <span data-ttu-id="c2d6b-250">Wyświetlane są tylko te produkty, które należą do kategorii napoje, chociaż *wszystkie* pola produktu są wyświetlane od momentu, gdy procedura składowana `GetProductsByCategory` zwraca wszystkie kolumny z tabeli `Products`.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-250">Only those products that belong to the Beverages category are displayed, although *all* of the product fields are displayed since the `GetProductsByCategory` stored procedure returns all of the columns from the `Products` table.</span></span> <span data-ttu-id="c2d6b-251">Możemy oczywiście ograniczyć lub dostosować pola wyświetlane w widoku GridView z okna dialogowego Edytowanie kolumn w widoku GridView.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-251">We could, of course, limit or customize the fields displayed in the GridView from the GridView s Edit Columns dialog box.</span></span>

<span data-ttu-id="c2d6b-252">[![wszystkie napoje są wyświetlane](using-parameterized-queries-with-the-sqldatasource-cs/_static/image12.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="c2d6b-252">[![All of the Beverages are Displayed](using-parameterized-queries-with-the-sqldatasource-cs/_static/image12.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image23.png)</span></span>

<span data-ttu-id="c2d6b-253">**Ilustracja 12**. wyświetlane są wszystkie napoje ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](using-parameterized-queries-with-the-sqldatasource-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="c2d6b-253">**Figure 12**: All of the Beverages are Displayed ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image24.png))</span></span>

## <a name="step-4-programmatically-invoking-a-sqldatasource-sselectstatement"></a><span data-ttu-id="c2d6b-254">Krok 4. programowe wywoływanie instrukcji kontrolki SqlDataSource s`Select()`</span><span class="sxs-lookup"><span data-stu-id="c2d6b-254">Step 4: Programmatically Invoking a SqlDataSource s`Select()`Statement</span></span>

<span data-ttu-id="c2d6b-255">Przykłady, które zostały zaobserwowane w poprzednim samouczku i tym samouczku, mają do tej pory powiązane kontrolki kontrolki SqlDataSource bezpośrednio z elementem GridView.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-255">The examples we ve seen in the previous tutorial and this tutorial so far have bound SqlDataSource controls directly to a GridView.</span></span> <span data-ttu-id="c2d6b-256">Dane kontrolne kontrolki SqlDataSource są jednak dostępne do programistycznego i wyliczane w kodzie.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-256">The SqlDataSource control s data, however, can be programmatically accessed and enumerated in code.</span></span> <span data-ttu-id="c2d6b-257">Może to być szczególnie przydatne, gdy trzeba wykonać zapytanie o dane, aby je sprawdzić, ale nie trzeba go wyświetlić.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-257">This can be particularly useful when you need to query data to inspect it, but don t need to display it.</span></span> <span data-ttu-id="c2d6b-258">Zamiast zapisywać cały standardowy kod ADO.NET w celu nawiązania połączenia z bazą danych, określić polecenie i pobrać wyniki, możesz pozwolić, aby kontrolki SqlDataSource obsłużyć ten kod monotonous.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-258">Rather than having to write all of the boilerplate ADO.NET code to connect to the database, specify the command, and retrieve the results, you can let the SqlDataSource handle this monotonous code.</span></span>

<span data-ttu-id="c2d6b-259">Aby w sposób programistyczny zilustrować pracę z danymi kontrolki SqlDataSource, Załóżmy, że szef przybrał żądanie utworzenia strony sieci Web, która wyświetla nazwę losowo wybranej kategorii i powiązane z nią produkty.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-259">To illustrate working with the SqlDataSource s data programmatically, imagine that your boss has approached you with a request to create a web page that displays the name of a randomly selected category and its associated products.</span></span> <span data-ttu-id="c2d6b-260">Oznacza to, że gdy użytkownik odwiedzi tę stronę, chcemy losowo wybrać kategorię z tabeli `Categories`, wyświetlić nazwę kategorii, a następnie wyświetlić listę produktów należących do tej kategorii.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-260">That is, when a user visits this page, we want to randomly choose a category from the `Categories` table, display the category name, and then list the products belonging to that category.</span></span>

<span data-ttu-id="c2d6b-261">Aby to osiągnąć, potrzebujemy dwóch kontrolki SqlDataSource formantów, aby pobrać losowo kategorię z tabeli `Categories` i drugą, aby uzyskać produkty kategorii.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-261">To accomplish this we need two SqlDataSource controls one to grab a random category from the `Categories` table and another to get the category s products.</span></span> <span data-ttu-id="c2d6b-262">Utworzymy kontrolki SqlDataSource, który pobiera losowy rekord kategorii w tym kroku. Krok 5 analizuje kontrolki SqlDataSource, który pobiera produkty kategorii.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-262">We'll build the SqlDataSource that retrieves a random category record in this step; Step 5 looks at crafting the SqlDataSource that retrieves the category s products.</span></span>

<span data-ttu-id="c2d6b-263">Zacznij od dodania kontrolki SqlDataSource do `ParameterizedQueries.aspx` i ustaw `ID` do `RandomCategoryDataSource`.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-263">Start by adding a SqlDataSource to `ParameterizedQueries.aspx` and set its `ID` to `RandomCategoryDataSource`.</span></span> <span data-ttu-id="c2d6b-264">Skonfiguruj ją tak, aby korzystała z następującej kwerendy SQL:</span><span class="sxs-lookup"><span data-stu-id="c2d6b-264">Configure it so that it uses the following SQL query:</span></span>

[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample10.sql)]

<span data-ttu-id="c2d6b-265">`ORDER BY NEWID()` zwraca rekordy posortowane w kolejności losowej (zobacz [używanie `NEWID()` do losowego sortowania rekordów](http://www.sqlteam.com/item.asp?ItemID=8747)).</span><span class="sxs-lookup"><span data-stu-id="c2d6b-265">`ORDER BY NEWID()` returns the records sorted in random order (see [Using `NEWID()` to Randomly Sort Records](http://www.sqlteam.com/item.asp?ItemID=8747)).</span></span> <span data-ttu-id="c2d6b-266">`SELECT TOP 1` zwraca pierwszy rekord z zestawu wyników.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-266">`SELECT TOP 1` returns the first record from the result set.</span></span> <span data-ttu-id="c2d6b-267">To zapytanie zwraca wartości kolumn `CategoryID` i `CategoryName` z pojedynczej, losowo wybranej kategorii.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-267">Put together, this query returns the `CategoryID` and `CategoryName` column values from a single, randomly selected category.</span></span>

<span data-ttu-id="c2d6b-268">Aby wyświetlić wartość `CategoryName` kategorii, Dodaj kontrolkę sieci Web etykieta do strony, ustaw jej Właściwość `ID` na `CategoryNameLabel`i wyczyść jej Właściwość `Text`.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-268">To display the category s `CategoryName` value, add a Label Web control to the page, set its `ID` property to `CategoryNameLabel`, and clear out its `Text` property.</span></span> <span data-ttu-id="c2d6b-269">Aby programowo pobrać dane z formantu kontrolki SqlDataSource, musimy wywołać jego metodę `Select()`.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-269">To programmatically retrieve the data from a SqlDataSource control, we need to invoke its `Select()` method.</span></span> <span data-ttu-id="c2d6b-270">[Metoda`Select()`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.select.aspx) oczekuje jednego parametru wejściowego typu [`DataSourceSelectArguments`](https://msdn.microsoft.com/library/system.web.ui.datasourceselectarguments.aspx), który określa sposób, w jaki dane powinny być wysyłane przed zwróceniem.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-270">The [`Select()` method](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.select.aspx) expects a single input parameter of type [`DataSourceSelectArguments`](https://msdn.microsoft.com/library/system.web.ui.datasourceselectarguments.aspx), which specifies how the data should be messaged before being returned.</span></span> <span data-ttu-id="c2d6b-271">Może to obejmować instrukcje sortowania i filtrowania danych oraz używane przez kontrolki sieci Web danych podczas sortowania lub stronicowania danych z formantu kontrolki SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-271">This can include instructions on sorting and filtering the data, and is used by the data Web controls when sorting or paging through the data from a SqlDataSource control.</span></span> <span data-ttu-id="c2d6b-272">W naszym przykładzie nie potrzebujemy, aby dane były modyfikowane przed zwróceniem i w związku z tym zostaną przekazane do obiektu `DataSourceSelectArguments.Empty`.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-272">For our example, though, we don t need the data to be modified before being returned, and therefore will pass in the `DataSourceSelectArguments.Empty` object.</span></span>

<span data-ttu-id="c2d6b-273">Metoda `Select()` zwraca obiekt implementujący `IEnumerable`.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-273">The `Select()` method returns an object that implements `IEnumerable`.</span></span> <span data-ttu-id="c2d6b-274">Dokładny zwracany typ zależy od wartości właściwości kontrolki SqlDataSource sterowania [`DataSourceMode`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.datasourcemode.aspx).</span><span class="sxs-lookup"><span data-stu-id="c2d6b-274">The precise type returned depends on the value of the SqlDataSource control s [`DataSourceMode` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.datasourcemode.aspx).</span></span> <span data-ttu-id="c2d6b-275">Zgodnie z opisem w poprzednim samouczku tę właściwość można ustawić na wartość `DataSet` lub `DataReader`.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-275">As discussed in the previous tutorial, this property can be set to a value of either `DataSet` or `DataReader`.</span></span> <span data-ttu-id="c2d6b-276">Jeśli zostanie ustawiona na `DataSet`, Metoda `Select()` zwróci obiekt [DataView](https://msdn.microsoft.com/library/01s96x0z.aspx) ; Jeśli zostanie ustawiona na `DataReader`, zwraca obiekt implementujący [`IDataReader`](https://msdn.microsoft.com/library/system.data.idatareader.aspx).</span><span class="sxs-lookup"><span data-stu-id="c2d6b-276">If set to `DataSet`, the `Select()` method returns a [DataView](https://msdn.microsoft.com/library/01s96x0z.aspx) object; if set to `DataReader`, it returns an object that implements [`IDataReader`](https://msdn.microsoft.com/library/system.data.idatareader.aspx).</span></span> <span data-ttu-id="c2d6b-277">Ponieważ `RandomCategoryDataSource` kontrolki SqlDataSource ma właściwość `DataSourceMode` ustawioną na `DataSet` (wartość domyślna), będziemy pracować z obiektem DataView.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-277">Since the `RandomCategoryDataSource` SqlDataSource has its `DataSourceMode` property set to `DataSet` (the default), we will be working with a DataView object.</span></span>

<span data-ttu-id="c2d6b-278">Poniższy kod ilustruje sposób pobierania rekordów z `RandomCategoryDataSource` kontrolki SqlDataSource jako widok DataView, jak również odczytywanie wartości kolumny `CategoryName` z pierwszego wiersza DataView:</span><span class="sxs-lookup"><span data-stu-id="c2d6b-278">The following code illustrates how to retrieve the records from the `RandomCategoryDataSource` SqlDataSource as a DataView as well as how to read the `CategoryName` column value from the first DataView row:</span></span>

[!code-csharp[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample11.cs)]

<span data-ttu-id="c2d6b-279">`randomCategoryView[0]` zwraca pierwszy `DataRowView` w elemencie DataView.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-279">`randomCategoryView[0]` returns the first `DataRowView` in the DataView.</span></span> <span data-ttu-id="c2d6b-280">`randomCategoryView[0]["CategoryName"]` zwraca wartość kolumny `CategoryName` w tym pierwszym wierszu.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-280">`randomCategoryView[0]["CategoryName"]` returns the value of the `CategoryName` column in this first row.</span></span> <span data-ttu-id="c2d6b-281">Należy zauważyć, że widok DataView jest luźno określony.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-281">Note that the DataView is loosely-typed.</span></span> <span data-ttu-id="c2d6b-282">Aby odwołać się do określonej wartości kolumny, musimy przekazać nazwę kolumny jako ciąg (w tym przypadku CategoryName).</span><span class="sxs-lookup"><span data-stu-id="c2d6b-282">To reference a particular column value we need to pass in the name of the column as a string ( CategoryName, in this case).</span></span> <span data-ttu-id="c2d6b-283">Rysunek 13 przedstawia komunikat wyświetlany w `CategoryNameLabel` podczas wyświetlania strony.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-283">Figure 13 shows the message displayed in the `CategoryNameLabel` when viewing the page.</span></span> <span data-ttu-id="c2d6b-284">Oczywiście rzeczywista nazwa kategorii jest losowo wybierana przez `RandomCategoryDataSource` kontrolki SqlDataSource na każdej odwiedziny na stronie (w tym zwroty ogłoszeń).</span><span class="sxs-lookup"><span data-stu-id="c2d6b-284">Of course, the actual category name displayed is randomly selected by the `RandomCategoryDataSource` SqlDataSource on each visit to the page (including postbacks).</span></span>

<span data-ttu-id="c2d6b-285">[![zostanie wyświetlona nazwa losowo wybranej kategorii s](using-parameterized-queries-with-the-sqldatasource-cs/_static/image13.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="c2d6b-285">[![The Randomly Selected Category s Name is Displayed](using-parameterized-queries-with-the-sqldatasource-cs/_static/image13.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image25.png)</span></span>

<span data-ttu-id="c2d6b-286">**Ilustracja 13**. wyświetlana jest losowo wybrana nazwa kategorii (kliknij,[Aby wyświetlić obraz w pełnym rozmiarze](using-parameterized-queries-with-the-sqldatasource-cs/_static/image26.png))</span><span class="sxs-lookup"><span data-stu-id="c2d6b-286">**Figure 13**: The Randomly Selected Category s Name is Displayed ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image26.png))</span></span>

> [!NOTE]
> <span data-ttu-id="c2d6b-287">Jeśli właściwość `DataSourceMode` sterowania kontrolki SqlDataSource została ustawiona na `DataReader`, wartość zwracana z metody `Select()` byłaby wymagana do rzutowania na `IDataReader`.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-287">If the SqlDataSource control s `DataSourceMode` property had been set to `DataReader`, the return value from the `Select()` method would have needed to be cast to `IDataReader`.</span></span> <span data-ttu-id="c2d6b-288">Aby odczytać wartość kolumny `CategoryName` z pierwszego wiersza, używamy kodu, takiego jak:</span><span class="sxs-lookup"><span data-stu-id="c2d6b-288">To read the `CategoryName` column value from the first row, we d use code like:</span></span>

[!code-csharp[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample12.cs)]

<span data-ttu-id="c2d6b-289">Po wybraniu kategorii kontrolki SqlDataSource losowo, możemy dodać widok GridView, który wyświetla listę produktów kategorii.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-289">With the SqlDataSource randomly selecting a category, we re ready to add the GridView that lists the category s products.</span></span>

> [!NOTE]
> <span data-ttu-id="c2d6b-290">Zamiast używać kontrolki sieci Web etykieta do wyświetlania nazwy kategorii, możemy dodać do strony element FormView lub DetailsView, a następnie powiązać go z kontrolki SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-290">Rather than using a Label Web control to display the category s name, we could have added a FormView or DetailsView to the page, binding it to the SqlDataSource.</span></span> <span data-ttu-id="c2d6b-291">Jednak korzystając z etykiety, można dowiedzieć się, jak programowo wywołać instrukcję kontrolki SqlDataSource s `Select()` i pracy z danymi uzyskanymi w kodzie.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-291">Using the Label, however, allowed us to explore how to programmatically invoke the SqlDataSource s `Select()` statement and work with its resulting data in code.</span></span>

## <a name="step-5-assigning-parameter-values-programmatically"></a><span data-ttu-id="c2d6b-292">Krok 5. programowe Przypisywanie wartości parametrów</span><span class="sxs-lookup"><span data-stu-id="c2d6b-292">Step 5: Assigning Parameter Values Programmatically</span></span>

<span data-ttu-id="c2d6b-293">We wszystkich przykładach, które zaobserwowano do tej pory w tym samouczku, użyto zakodowanej wartości parametru lub jednej z jednego ze wstępnie zdefiniowanych źródeł parametrów (wartości QueryString, kontrolki sieci Web na stronie itd.).</span><span class="sxs-lookup"><span data-stu-id="c2d6b-293">All of the examples we ve seen so far in this tutorial have used either a hard-coded parameter value or one taken from one of the pre-defined parameter sources (a querystring value, a Web control on the page, and so on).</span></span> <span data-ttu-id="c2d6b-294">Jednak parametry kontrolki SqlDataSource Control s można także skonfigurować programowo.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-294">However, the SqlDataSource control s parameters can also be set programmatically.</span></span> <span data-ttu-id="c2d6b-295">Aby ukończyć bieżący przykład, potrzebujemy elementu kontrolki SqlDataSource, który zwraca wszystkie produkty należące do określonej kategorii.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-295">To complete our current example, we need a SqlDataSource that returns all of the products belonging to a specified category.</span></span> <span data-ttu-id="c2d6b-296">Ta kontrolki SqlDataSource będzie miała parametr `CategoryID`, którego wartość musi być ustawiona na podstawie `CategoryID` wartości kolumny zwróconej przez `RandomCategoryDataSource` kontrolki SqlDataSource w obsłudze zdarzeń `Page_Load`.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-296">This SqlDataSource will have a `CategoryID` parameter whose value needs to be set based on the `CategoryID` column value returned by the `RandomCategoryDataSource` SqlDataSource in the `Page_Load` event handler.</span></span>

<span data-ttu-id="c2d6b-297">Zacznij od dodania widoku GridView do strony i powiąż go z nowym kontrolki SqlDataSource o nazwie `ProductsByCategoryDataSource`.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-297">Start by adding a GridView to the page and bind it to a new SqlDataSource named `ProductsByCategoryDataSource`.</span></span> <span data-ttu-id="c2d6b-298">Podobnie jak w kroku 3, skonfiguruj kontrolki SqlDataSource tak, aby wywoła procedurę składowaną `GetProductsByCategory`.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-298">Much like we did in Step 3, configure the SqlDataSource so that it invokes the `GetProductsByCategory` stored procedure.</span></span> <span data-ttu-id="c2d6b-299">Pozostaw listę rozwijaną Źródło parametru ustawioną na wartość None, ale nie wprowadzaj wartości domyślnej, ponieważ ta wartość domyślna zostanie ustawiona programowo.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-299">Leave the Parameter source drop-down list set to None, but do not enter a default value, as we will set this default value programmatically.</span></span>

<span data-ttu-id="c2d6b-300">[![nie określać wartości źródłowej lub domyślnej parametru](using-parameterized-queries-with-the-sqldatasource-cs/_static/image14.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="c2d6b-300">[![Do Not Specify a Parameter Source or Default Value](using-parameterized-queries-with-the-sqldatasource-cs/_static/image14.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image27.png)</span></span>

<span data-ttu-id="c2d6b-301">**Ilustracja 14**. nie określaj wartości źródłowej lub domyślnej parametru ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](using-parameterized-queries-with-the-sqldatasource-cs/_static/image28.png))</span><span class="sxs-lookup"><span data-stu-id="c2d6b-301">**Figure 14**: Do Not Specify a Parameter Source or Default Value ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image28.png))</span></span>

<span data-ttu-id="c2d6b-302">Po zakończeniu działania kreatora kontrolki SqlDataSource, powstające deklaratywne znaczniki powinny wyglądać podobnie do następujących:</span><span class="sxs-lookup"><span data-stu-id="c2d6b-302">After completing the SqlDataSource wizard, the resulting declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample13.aspx)]

<span data-ttu-id="c2d6b-303">`DefaultValue` parametru `CategoryID` można programowo przypisać do programu obsługi zdarzeń `Page_Load`:</span><span class="sxs-lookup"><span data-stu-id="c2d6b-303">We can assign the `DefaultValue` of the `CategoryID` parameter programmatically in the `Page_Load` event handler:</span></span>

[!code-csharp[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample14.cs)]

<span data-ttu-id="c2d6b-304">Dzięki temu, Strona zawiera widok GridView, który pokazuje produkty skojarzone z losowo wybraną kategorią.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-304">With this addition, the page includes a GridView that shows the products associated with the randomly selected category.</span></span>

<span data-ttu-id="c2d6b-305">[![nie określać wartości źródłowej lub domyślnej parametru](using-parameterized-queries-with-the-sqldatasource-cs/_static/image15.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="c2d6b-305">[![Do Not Specify a Parameter Source or Default Value](using-parameterized-queries-with-the-sqldatasource-cs/_static/image15.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image29.png)</span></span>

<span data-ttu-id="c2d6b-306">**Ilustracja 15**. nie określaj wartości źródłowej lub domyślnej parametru ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](using-parameterized-queries-with-the-sqldatasource-cs/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="c2d6b-306">**Figure 15**: Do Not Specify a Parameter Source or Default Value ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image30.png))</span></span>

## <a name="summary"></a><span data-ttu-id="c2d6b-307">Podsumowanie</span><span class="sxs-lookup"><span data-stu-id="c2d6b-307">Summary</span></span>

<span data-ttu-id="c2d6b-308">Kontrolki SqlDataSource umożliwia deweloperom stron Definiowanie zapytań parametrycznych, których wartości parametrów mogą być zakodowane na stałe, pobierane ze wstępnie zdefiniowanych źródeł parametrów lub przypisane programowo.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-308">The SqlDataSource enables page developers to define parameterized queries whose parameter values can be hard-coded, pulled from pre-defined parameter sources, or assigned programmatically.</span></span> <span data-ttu-id="c2d6b-309">W tym samouczku przedstawiono sposób tworzenia zapytania parametrycznego w Kreatorze konfiguracji źródła danych dla zapytań SQL ad hoc i procedur składowanych.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-309">In this tutorial we saw how to craft a parameterized query from the Configure Data Source wizard for both ad-hoc SQL queries and stored procedures.</span></span> <span data-ttu-id="c2d6b-310">Przeglądamy również przy użyciu zakodowanych źródeł parametrów, kontrolki sieci Web jako źródła parametrów i programowo określając wartość parametru.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-310">We also looked at using hard-coded parameter sources, a Web control as a parameter source, and programmatically specifying the parameter value.</span></span>

<span data-ttu-id="c2d6b-311">Podobnie jak w przypadku elementu ObjectDataSource, kontrolki SqlDataSource udostępnia również możliwości modyfikacji własnych danych.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-311">Like with the ObjectDataSource, the SqlDataSource also provides capabilities to modify its underlying data.</span></span> <span data-ttu-id="c2d6b-312">W następnym samouczku przedstawiono sposób definiowania instrukcji `INSERT`, `UPDATE`i `DELETE` z kontrolki SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-312">In the next tutorial we'll look at how to define `INSERT`, `UPDATE`, and `DELETE` statements with the SqlDataSource.</span></span> <span data-ttu-id="c2d6b-313">Po dodaniu tych instrukcji możemy użyć wbudowanego wstawiania, edytowania i usuwania funkcji, które są związane z kontrolkami GridView, DetailsView i FormView.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-313">Once these statements have been added, we can utilize the built-in inserting, editing, and deleting features inherent to the GridView, DetailsView, and FormView controls.</span></span>

<span data-ttu-id="c2d6b-314">Szczęśliwe programowanie!</span><span class="sxs-lookup"><span data-stu-id="c2d6b-314">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="c2d6b-315">Informacje o autorze</span><span class="sxs-lookup"><span data-stu-id="c2d6b-315">About the Author</span></span>

<span data-ttu-id="c2d6b-316">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor siedmiu grup ASP/ASP. NET Books i założyciel of [4GuysFromRolla.com](http://www.4guysfromrolla.com), pracował z technologiami sieci Web firmy Microsoft od czasu 1998.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-316">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="c2d6b-317">Scott działa jako niezależny konsultant, trainer i składnik zapisywania.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-317">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="c2d6b-318">Jego Najnowsza książka to [*Sams ASP.NET 2,0 w ciągu 24 godzin*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="c2d6b-318">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="c2d6b-319">Można go osiągnąć w [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="c2d6b-319">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="c2d6b-320">lub za pośrednictwem swojego blogu, który można znaleźć w [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="c2d6b-320">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="c2d6b-321">Specjalne podziękowania</span><span class="sxs-lookup"><span data-stu-id="c2d6b-321">Special Thanks To</span></span>

<span data-ttu-id="c2d6b-322">Ta seria samouczków została sprawdzona przez wielu przydatnych recenzentów.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-322">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="c2d6b-323">Recenzenci liderzy dla tego samouczka to Scott Clyde, Randell Schmidt i Krzysztof Pespisa.</span><span class="sxs-lookup"><span data-stu-id="c2d6b-323">Lead reviewers for this tutorial were Scott Clyde, Randell Schmidt, and Ken Pespisa.</span></span> <span data-ttu-id="c2d6b-324">Chcesz przeglądać moje nadchodzące artykuły MSDN?</span><span class="sxs-lookup"><span data-stu-id="c2d6b-324">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="c2d6b-325">Jeśli tak, upuść mi linię w [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="c2d6b-325">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="c2d6b-326">[Poprzednie](querying-data-with-the-sqldatasource-control-cs.md)
> [dalej](inserting-updating-and-deleting-data-with-the-sqldatasource-cs.md)</span><span class="sxs-lookup"><span data-stu-id="c2d6b-326">[Previous](querying-data-with-the-sqldatasource-control-cs.md)
[Next](inserting-updating-and-deleting-data-with-the-sqldatasource-cs.md)</span></span>
