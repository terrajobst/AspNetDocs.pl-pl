---
uid: web-forms/overview/data-access/paging-and-sorting/efficiently-paging-through-large-amounts-of-data-cs
title: Wydajne stronicowanie przy użyciu dużych ilości danychC#() | Microsoft Docs
author: rick-anderson
description: Domyślna opcja stronicowania kontrolki prezentacja danych jest nieodpowiednia podczas pracy z dużymi ilościami danych.
ms.author: riande
ms.date: 08/15/2006
ms.assetid: 59c01998-9326-4ecb-9392-cb9615962140
msc.legacyurl: /web-forms/overview/data-access/paging-and-sorting/efficiently-paging-through-large-amounts-of-data-cs
msc.type: authoredcontent
ms.openlocfilehash: a3e9562035cb24987b01fcdff5fbfb5fa8a1f894
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 11/28/2019
ms.locfileid: "74629752"
---
# <a name="efficiently-paging-through-large-amounts-of-data-c"></a><span data-ttu-id="f7408-103">Efektywne stronicowanie dużych ilości danych (C#)</span><span class="sxs-lookup"><span data-stu-id="f7408-103">Efficiently Paging Through Large Amounts of Data (C#)</span></span>

<span data-ttu-id="f7408-104">przez [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="f7408-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="f7408-105">[Pobierz przykładową aplikację](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_25_CS.exe) lub [Pobierz plik PDF](efficiently-paging-through-large-amounts-of-data-cs/_static/datatutorial25cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="f7408-105">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_25_CS.exe) or [Download PDF](efficiently-paging-through-large-amounts-of-data-cs/_static/datatutorial25cs1.pdf)</span></span>

> <span data-ttu-id="f7408-106">Domyślna opcja stronicowania kontrolki prezentacja danych jest nieodpowiednia podczas pracy z dużymi ilościami danych, ponieważ jej źródłowa kontrola źródła danych pobiera wszystkie rekordy, nawet gdy jest wyświetlany tylko podzestaw danych.</span><span class="sxs-lookup"><span data-stu-id="f7408-106">The default paging option of a data presentation control is unsuitable when working with large amounts of data, as its underlying data source control retrieves all records, even though only a subset of data is displayed.</span></span> <span data-ttu-id="f7408-107">W takim przypadku należy zmienić niestandardowe stronicowanie.</span><span class="sxs-lookup"><span data-stu-id="f7408-107">In such circumstances, we must turn to custom paging.</span></span>

## <a name="introduction"></a><span data-ttu-id="f7408-108">Wprowadzenie</span><span class="sxs-lookup"><span data-stu-id="f7408-108">Introduction</span></span>

<span data-ttu-id="f7408-109">Jak opisano w poprzednim samouczku, stronicowanie można zaimplementować na jeden z dwóch sposobów:</span><span class="sxs-lookup"><span data-stu-id="f7408-109">As we discussed in the preceding tutorial, paging can be implemented in one of two ways:</span></span>

- <span data-ttu-id="f7408-110">**Domyślne stronicowanie** można zaimplementować, zaznaczając opcję Włącz stronicowanie w tagu inteligentnym kontrolki sieci Web danych. Jednak za każdym razem, gdy oglądasz stronę danych, element ObjectDataSource pobiera *wszystkie* rekordy, nawet jeśli na stronie są wyświetlane tylko ich podzbiór.</span><span class="sxs-lookup"><span data-stu-id="f7408-110">**Default Paging** can be implemented by simply checking the Enable Paging option in the data Web control s smart tag; however, whenever viewing a page of data, the ObjectDataSource retrieves *all* of the records, even though only a subset of them are displayed in the page</span></span>
- <span data-ttu-id="f7408-111">**Niestandardowe stronicowanie** poprawia wydajność domyślnego stronicowania przez pobranie tylko tych rekordów z bazy danych, które mają być wyświetlane dla określonej strony danych żądanych przez użytkownika; Niemniej jednak stronicowanie niestandardowe obejmuje zwiększenie nakładu pracy niż domyślne stronicowanie</span><span class="sxs-lookup"><span data-stu-id="f7408-111">**Custom Paging** improves the performance of default paging by retrieving only those records from the database that need to be displayed for the particular page of data requested by the user; however, custom paging involves a bit more effort to implement than default paging</span></span>

<span data-ttu-id="f7408-112">Ze względu na prostotę implementacji wystarczy zaznaczyć pole wyboru i ponownie wykonać tę czynność.</span><span class="sxs-lookup"><span data-stu-id="f7408-112">Due to the ease of implementation just check a checkbox and you re done!</span></span> <span data-ttu-id="f7408-113">domyślne stronicowanie jest atrakcyjną opcją.</span><span class="sxs-lookup"><span data-stu-id="f7408-113">default paging is an attractive option.</span></span> <span data-ttu-id="f7408-114">Podejście na przyszłość przy pobieraniu wszystkich rekordów, chociaż sprawia, że jest to niewiarygodne rozwiązanie podczas stronicowania za pomocą wystarczająco dużych ilości danych lub dla witryn z wieloma współbieżnymi użytkownikami.</span><span class="sxs-lookup"><span data-stu-id="f7408-114">Its na�ve approach in retrieving all of the records, though, makes it an implausible choice when paging through sufficiently large amounts of data or for sites with many concurrent users.</span></span> <span data-ttu-id="f7408-115">W takiej sytuacji należy włączyć niestandardowe stronicowanie w celu zapewnienia systemu, który odpowiada.</span><span class="sxs-lookup"><span data-stu-id="f7408-115">In such circumstances, we must turn to custom paging in order to provide a responsive system.</span></span>

<span data-ttu-id="f7408-116">Wyzwanie niestandardowego stronicowania jest w stanie zapisać zapytanie, które zwraca dokładny zestaw rekordów wymaganych przez określoną stronę danych.</span><span class="sxs-lookup"><span data-stu-id="f7408-116">The challenge of custom paging is being able to write a query that returns the precise set of records needed for a particular page of data.</span></span> <span data-ttu-id="f7408-117">Na szczęście Microsoft SQL Server 2005 udostępnia nowe słowo kluczowe dla wyników rankingu, co pozwala nam napisać zapytanie, które może efektywnie pobrać odpowiedni podzbiór rekordów.</span><span class="sxs-lookup"><span data-stu-id="f7408-117">Fortunately, Microsoft SQL Server 2005 provides a new keyword for ranking results, which enables us to write a query that can efficiently retrieve the proper subset of records.</span></span> <span data-ttu-id="f7408-118">W tym samouczku dowiesz się, jak używać nowego słowa kluczowego SQL Server 2005 w celu zaimplementowania niestandardowego stronicowania w kontrolce GridView.</span><span class="sxs-lookup"><span data-stu-id="f7408-118">In this tutorial we'll see how to use this new SQL Server 2005 keyword to implement custom paging in a GridView control.</span></span> <span data-ttu-id="f7408-119">Interfejs użytkownika dla niestandardowego stronicowania jest identyczny z tym, że dla domyślnego stronicowania, krokowe przechodzenie z jednej strony do następnego przy użyciu stronicowania niestandardowego może mieć kilka zamówień o wielkości szybciej niż domyślne stronicowanie.</span><span class="sxs-lookup"><span data-stu-id="f7408-119">While the user interface for custom paging is identical to that for default paging, stepping from one page to the next using custom paging can be several orders of magnitude faster than default paging.</span></span>

> [!NOTE]
> <span data-ttu-id="f7408-120">Dokładny wpływ na wydajność wystawiony przez niestandardowe stronicowanie zależy od łącznej liczby rekordów, które są stronicowane, i obciążenia umieszczanego na serwerze bazy danych.</span><span class="sxs-lookup"><span data-stu-id="f7408-120">The exact performance gain exhibited by custom paging depends on the total number of records being paged through and the load being placed on the database server.</span></span> <span data-ttu-id="f7408-121">Na końcu tego samouczka Przyjrzyjmy się niektórym metrykom, które przedstawiają korzyści wynikające z wydajności uzyskanej za pomocą niestandardowego stronicowania.</span><span class="sxs-lookup"><span data-stu-id="f7408-121">At the end of this tutorial we'll look at some rough metrics that showcase the benefits in performance obtained through custom paging.</span></span>

## <a name="step-1-understanding-the-custom-paging-process"></a><span data-ttu-id="f7408-122">Krok 1: zrozumienie niestandardowego procesu stronicowania</span><span class="sxs-lookup"><span data-stu-id="f7408-122">Step 1: Understanding the Custom Paging Process</span></span>

<span data-ttu-id="f7408-123">Podczas stronicowania za pomocą danych dokładne rekordy wyświetlane na stronie są zależne od strony żądanych danych i liczby rekordów wyświetlanych na stronie.</span><span class="sxs-lookup"><span data-stu-id="f7408-123">When paging through data, the precise records displayed in a page depend upon the page of data being requested and the number of records displayed per page.</span></span> <span data-ttu-id="f7408-124">Załóżmy na przykład, że chcielibyśmy uzyskać stronę dotyczącą produktów 81, wyświetlając 10 produktów na stronę.</span><span class="sxs-lookup"><span data-stu-id="f7408-124">For example, imagine that we wanted to page through the 81 products, displaying 10 products per page.</span></span> <span data-ttu-id="f7408-125">Podczas wyświetlania pierwszej strony chcemy mieć produkty od 1 do 10. Gdy przeglądasz drugą stronę, chcemy w produktach 11 do 20 itd.</span><span class="sxs-lookup"><span data-stu-id="f7408-125">When viewing the first page, we d want products 1 through 10; when viewing the second page we d be interested in products 11 through 20, and so on.</span></span>

<span data-ttu-id="f7408-126">Istnieją trzy zmienne, które określają, jakie rekordy muszą zostać pobrane oraz jak ma być renderowany interfejs stronicowania:</span><span class="sxs-lookup"><span data-stu-id="f7408-126">There are three variables that dictate what records need to be retrieved and how the paging interface should be rendered:</span></span>

- <span data-ttu-id="f7408-127">**Początkowy indeks wiersza** indeks pierwszego wiersza na stronie danych do wyświetlenia; Ten indeks można obliczyć przez pomnożenie indeksu strony przez rekordy, które mają być wyświetlane na stronie i dodawane do nich.</span><span class="sxs-lookup"><span data-stu-id="f7408-127">**Start Row Index** the index of the first row in the page of data to display; this index can be calculated by multiplying the page index by the records to display per page and adding one.</span></span> <span data-ttu-id="f7408-128">Na przykład podczas stronicowania za pomocą rekordów 10 na pierwszej stronie (którego indeks strony ma wartość 0) indeks wierszy początkowych to 0 \* 10 + 1, lub 1; dla drugiej strony (którego indeks strony to 1) indeks wierszy początkowych to 1 \* 10 + 1 lub 11.</span><span class="sxs-lookup"><span data-stu-id="f7408-128">For example, when paging through records 10 at a time, for the first page (whose page index is 0), the Start Row Index is 0 \* 10 + 1, or 1; for the second page (whose page index is 1), the Start Row Index is 1 \* 10 + 1, or 11.</span></span>
- <span data-ttu-id="f7408-129">**Maksymalna liczba wierszy** , które mają być wyświetlane na stronie w maksymalnej liczbie rekordów.</span><span class="sxs-lookup"><span data-stu-id="f7408-129">**Maximum Rows** the maximum number of records to display per page.</span></span> <span data-ttu-id="f7408-130">Ta zmienna jest określana jako maksymalna liczba wierszy od ostatniej strony może być mniej rekordów zwracanych niż rozmiar strony.</span><span class="sxs-lookup"><span data-stu-id="f7408-130">This variable is referred to as maximum rows since for the last page there may be fewer records returned than the page size.</span></span> <span data-ttu-id="f7408-131">Na przykład podczas stronicowania przez 81 rekordów produktów na stronie dziewiąta i końcowa będzie mieć tylko jeden rekord.</span><span class="sxs-lookup"><span data-stu-id="f7408-131">For example, when paging through the 81 products 10 records per page, the ninth and final page will have just one record.</span></span> <span data-ttu-id="f7408-132">Żadna strona nie zawiera więcej rekordów niż wartość maksymalna liczba wierszy.</span><span class="sxs-lookup"><span data-stu-id="f7408-132">No page, though, will show more records than the Maximum Rows value.</span></span>
- <span data-ttu-id="f7408-133">**Całkowita liczba rekordów** , które łączą się ze stroną.</span><span class="sxs-lookup"><span data-stu-id="f7408-133">**Total Record Count** the total number of records being paged through.</span></span> <span data-ttu-id="f7408-134">Chociaż ta zmienna jest t jest niezbędna do określenia, które rekordy mają być pobierane dla danej strony, wymuszają interfejs stronicowania.</span><span class="sxs-lookup"><span data-stu-id="f7408-134">While this variable isn t needed to determine what records to retrieve for a given page, it does dictate the paging interface.</span></span> <span data-ttu-id="f7408-135">Na przykład jeśli na stronie są dostępne 81 produkty, interfejs stronicowania wie o wyświetlaniu dziewięciu numerów stron w interfejsie użytkownika stronicowania.</span><span class="sxs-lookup"><span data-stu-id="f7408-135">For example, if there are 81 products being paged through, the paging interface knows to display nine page numbers in the paging UI.</span></span>

<span data-ttu-id="f7408-136">Przy domyślnym stronicowaniu indeks wierszy początkowych jest obliczany jako iloczyn indeksu strony i rozmiaru strony plus jeden, natomiast Maksymalna liczba wierszy jest po prostu rozmiar strony.</span><span class="sxs-lookup"><span data-stu-id="f7408-136">With default paging, the Start Row Index is computed as the product of the page index and the page size plus one, whereas the Maximum Rows is simply the page size.</span></span> <span data-ttu-id="f7408-137">Ponieważ domyślne stronicowanie pobiera wszystkie rekordy z bazy danych podczas renderowania dowolnej strony danych, indeks dla każdego wiersza jest znany, co sprawia, że przejście do początku wiersza indeksu wierszy jest proste.</span><span class="sxs-lookup"><span data-stu-id="f7408-137">Since default paging retrieves all of the records from the database when rendering any page of data, the index for each row is known, thereby making moving to Start Row Index row a trivial task.</span></span> <span data-ttu-id="f7408-138">Ponadto całkowita liczba rekordów jest łatwo dostępna, ponieważ s po prostu liczbę rekordów w elemencie DataTable (lub dowolny obiekt jest używany do przechowywania wyników bazy danych).</span><span class="sxs-lookup"><span data-stu-id="f7408-138">Moreover, the Total Record Count is readily available, as it s simply the number of records in the DataTable (or whatever object is being used to hold the database results).</span></span>

<span data-ttu-id="f7408-139">W przypadku zmiennych początkowych indeks wiersza i Maksymalna liczba wierszy implementacja stronicowania niestandardowego musi zwracać tylko dokładny podzbiór rekordów, zaczynając od indeksu wierszy początkowych i maksymalnie maksymalną liczbę wierszy rekordów.</span><span class="sxs-lookup"><span data-stu-id="f7408-139">Given the Start Row Index and Maximum Rows variables, a custom paging implementation must only return the precise subset of records starting at the Start Row Index and up to Maximum Rows number of records after that.</span></span> <span data-ttu-id="f7408-140">Niestandardowe stronicowanie zawiera dwa wyzwania:</span><span class="sxs-lookup"><span data-stu-id="f7408-140">Custom paging provides two challenges:</span></span>

- <span data-ttu-id="f7408-141">Musimy mieć możliwość wydajnego kojarzenia indeksu wierszy z każdym wierszem na wszystkich danych, które są stronicowane w taki sposób, aby można było rozpocząć zwracanie rekordów w określonym indeksie początkowych wierszy.</span><span class="sxs-lookup"><span data-stu-id="f7408-141">We must be able to efficiently associate a row index with each row in the entire data being paged through so that we can start returning records at the specified Start Row Index</span></span>
- <span data-ttu-id="f7408-142">Musimy podać łączną liczbę rekordów na stronie</span><span class="sxs-lookup"><span data-stu-id="f7408-142">We need to provide the total number of records being paged through</span></span>

<span data-ttu-id="f7408-143">W dwóch następnych krokach sprawdzimy skrypt SQL potrzebny do odpowiedzi na te dwa wyzwania.</span><span class="sxs-lookup"><span data-stu-id="f7408-143">In the next two steps we'll examine the SQL script needed to respond to these two challenges.</span></span> <span data-ttu-id="f7408-144">Oprócz skryptu SQL należy również zaimplementować metody w DAL i LOGIKI biznesowej.</span><span class="sxs-lookup"><span data-stu-id="f7408-144">In addition to the SQL script, we'll also need to implement methods in the DAL and BLL.</span></span>

## <a name="step-2-returning-the-total-number-of-records-being-paged-through"></a><span data-ttu-id="f7408-145">Krok 2. Zwracanie łącznej liczby rekordów na stronie</span><span class="sxs-lookup"><span data-stu-id="f7408-145">Step 2: Returning the Total Number of Records Being Paged Through</span></span>

<span data-ttu-id="f7408-146">Zanim sprawdzimy, jak pobrać dokładny podzestaw rekordów dla wyświetlanej strony, poczekaj, jak zwrócić łączną liczbę rekordów na stronie.</span><span class="sxs-lookup"><span data-stu-id="f7408-146">Before we examine how to retrieve the precise subset of records for the page being displayed, let s first look at how to return the total number of records being paged through.</span></span> <span data-ttu-id="f7408-147">Te informacje są konieczne w celu poprawnego skonfigurowania interfejsu użytkownika stronicowania.</span><span class="sxs-lookup"><span data-stu-id="f7408-147">This information is needed in order to properly configure the paging user interface.</span></span> <span data-ttu-id="f7408-148">Łączną liczbę rekordów zwracanych przez określone zapytanie SQL można uzyskać za pomocą [funkcji agregującej`COUNT`](https://msdn.microsoft.com/library/ms175997.aspx).</span><span class="sxs-lookup"><span data-stu-id="f7408-148">The total number of records returned by a particular SQL query can be obtained by using the [`COUNT` aggregate function](https://msdn.microsoft.com/library/ms175997.aspx).</span></span> <span data-ttu-id="f7408-149">Na przykład aby określić łączną liczbę rekordów w tabeli `Products`, można użyć następującego zapytania:</span><span class="sxs-lookup"><span data-stu-id="f7408-149">For example, to determine the total number of records in the `Products` table, we can use the following query:</span></span>

[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample1.sql)]

<span data-ttu-id="f7408-150">Zezwól usłudze s na dodanie metody do DAL, która zwraca te informacje.</span><span class="sxs-lookup"><span data-stu-id="f7408-150">Let s add a method to our DAL that returns this information.</span></span> <span data-ttu-id="f7408-151">W szczególności utworzysz metodę DAL o nazwie `TotalNumberOfProducts()`, która wykonuje instrukcję `SELECT` wskazaną powyżej.</span><span class="sxs-lookup"><span data-stu-id="f7408-151">In particular, we'll create a DAL method called `TotalNumberOfProducts()` that executes the `SELECT` statement shown above.</span></span>

<span data-ttu-id="f7408-152">Zacznij od otwarcia pliku zestawu danych z `Northwind.xsd` określonym w folderze `App_Code/DAL`.</span><span class="sxs-lookup"><span data-stu-id="f7408-152">Start by opening the `Northwind.xsd` Typed DataSet file in the `App_Code/DAL` folder.</span></span> <span data-ttu-id="f7408-153">Następnie kliknij prawym przyciskiem myszy `ProductsTableAdapter` w projektancie, a następnie wybierz polecenie Dodaj zapytanie.</span><span class="sxs-lookup"><span data-stu-id="f7408-153">Next, right-click on the `ProductsTableAdapter` in the Designer and choose Add Query.</span></span> <span data-ttu-id="f7408-154">Jak widać w poprzednich samouczkach, umożliwimy nam Dodawanie nowej metody do DAL, która po wywołaniu spowoduje wykonanie określonej instrukcji SQL lub procedury składowanej.</span><span class="sxs-lookup"><span data-stu-id="f7408-154">As we ve seen in previous tutorials, this will allow us to add a new method to the DAL that, when invoked, will execute a particular SQL statement or stored procedure.</span></span> <span data-ttu-id="f7408-155">Podobnie jak w przypadku naszych metod TableAdapter w poprzednich samouczkach, aby to zrobić, należy użyć instrukcji SQL ad hoc.</span><span class="sxs-lookup"><span data-stu-id="f7408-155">As with our TableAdapter methods in previous tutorials, for this one opt to use an ad-hoc SQL statement.</span></span>

![Korzystanie z instrukcji SQL ad hoc](efficiently-paging-through-large-amounts-of-data-cs/_static/image1.png)

<span data-ttu-id="f7408-157">**Rysunek 1**. używanie instrukcji SQL ad hoc</span><span class="sxs-lookup"><span data-stu-id="f7408-157">**Figure 1**: Use an Ad-Hoc SQL Statement</span></span>

<span data-ttu-id="f7408-158">Na następnym ekranie możemy określić typ zapytania, który ma zostać utworzony.</span><span class="sxs-lookup"><span data-stu-id="f7408-158">On the next screen we can specify what type of query to create.</span></span> <span data-ttu-id="f7408-159">Ponieważ to zapytanie zwróci pojedynczą wartość skalarną, Łączna liczba rekordów w tabeli `Products` wybierz `SELECT`, która zwraca opcję "wartość odrębna".</span><span class="sxs-lookup"><span data-stu-id="f7408-159">Since this query will return a single, scalar value the total number of records in the `Products` table choose the `SELECT` which returns a singe value option.</span></span>

![Konfigurowanie zapytania do użycia instrukcji SELECT, która zwraca pojedynczą wartość](efficiently-paging-through-large-amounts-of-data-cs/_static/image2.png)

<span data-ttu-id="f7408-161">**Rysunek 2**. Konfigurowanie zapytania do użycia instrukcji SELECT, która zwraca pojedynczą wartość</span><span class="sxs-lookup"><span data-stu-id="f7408-161">**Figure 2**: Configure the Query to Use a SELECT Statement that Returns a Single Value</span></span>

<span data-ttu-id="f7408-162">Po wskazaniu typu zapytania, który ma być używany, musimy dalej określić zapytanie.</span><span class="sxs-lookup"><span data-stu-id="f7408-162">After indicating the type of query to use, we must next specify the query.</span></span>

![Użyj zapytania SELECT COUNT (\*) FROM Products](efficiently-paging-through-large-amounts-of-data-cs/_static/image3.png)

<span data-ttu-id="f7408-164">**Rysunek 3**. użycie zapytania SELECT COUNT (\*) from Products</span><span class="sxs-lookup"><span data-stu-id="f7408-164">**Figure 3**: Use the SELECT COUNT(\*) FROM Products Query</span></span>

<span data-ttu-id="f7408-165">Na koniec Określ nazwę metody.</span><span class="sxs-lookup"><span data-stu-id="f7408-165">Finally, specify the name for the method.</span></span> <span data-ttu-id="f7408-166">Jak wspomniano powyżej, użyj `TotalNumberOfProducts`.</span><span class="sxs-lookup"><span data-stu-id="f7408-166">As aforementioned, let s use `TotalNumberOfProducts`.</span></span>

![Nazwij metodę DAL TotalNumberOfProducts](efficiently-paging-through-large-amounts-of-data-cs/_static/image4.png)

<span data-ttu-id="f7408-168">**Rysunek 4**. Nazwa metody dal TotalNumberOfProducts</span><span class="sxs-lookup"><span data-stu-id="f7408-168">**Figure 4**: Name the DAL Method TotalNumberOfProducts</span></span>

<span data-ttu-id="f7408-169">Po kliknięciu przycisku Zakończ Kreator doda metodę `TotalNumberOfProducts` do DAL.</span><span class="sxs-lookup"><span data-stu-id="f7408-169">After clicking Finish, the wizard will add the `TotalNumberOfProducts` method to the DAL.</span></span> <span data-ttu-id="f7408-170">Metody skalarne zwracające w DAL zwracające Typy dopuszczające wartość null w przypadku, gdy wynik zapytania SQL jest `NULL`.</span><span class="sxs-lookup"><span data-stu-id="f7408-170">The scalar returning methods in the DAL return nullable types, in case the result from the SQL query is `NULL`.</span></span> <span data-ttu-id="f7408-171">Nasza kwerenda `COUNT`, jednak zawsze zwróci wartość nie`NULL`ną; niezależnie od tego Metoda DAL zwraca wartość null Integer.</span><span class="sxs-lookup"><span data-stu-id="f7408-171">Our `COUNT` query, however, will always return a non-`NULL` value; regardless, the DAL method returns a nullable integer.</span></span>

<span data-ttu-id="f7408-172">Oprócz metody DAL potrzebujemy również metody w LOGIKI biznesowej.</span><span class="sxs-lookup"><span data-stu-id="f7408-172">In addition to the DAL method, we also need a method in the BLL.</span></span> <span data-ttu-id="f7408-173">Otwórz plik klasy `ProductsBLL` i Dodaj metodę `TotalNumberOfProducts`, która po prostu wywołuje metodę `TotalNumberOfProducts` DAL s:</span><span class="sxs-lookup"><span data-stu-id="f7408-173">Open the `ProductsBLL` class file and add a `TotalNumberOfProducts` method that simply calls down to the DAL s `TotalNumberOfProducts` method:</span></span>

[!code-csharp[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample2.cs)]

<span data-ttu-id="f7408-174">Metoda DAL `TotalNumberOfProducts` zwraca wartość null Integer; Jednakże tworzymy metodę `ProductsBLL` klasy s `TotalNumberOfProducts`, tak aby zwracała standardową liczbę całkowitą.</span><span class="sxs-lookup"><span data-stu-id="f7408-174">The DAL s `TotalNumberOfProducts` method returns a nullable integer; however, we ve created the `ProductsBLL` class s `TotalNumberOfProducts` method so that it returns a standard integer.</span></span> <span data-ttu-id="f7408-175">W związku z tym musimy mieć metodę `ProductsBLL` klasy s `TotalNumberOfProducts` zwrócić część wartości null liczby całkowitej zwracanej przez metodę `TotalNumberOfProducts` DAL s.</span><span class="sxs-lookup"><span data-stu-id="f7408-175">Therefore, we need to have the `ProductsBLL` class s `TotalNumberOfProducts` method return the value portion of the nullable integer returned by the DAL s `TotalNumberOfProducts` method.</span></span> <span data-ttu-id="f7408-176">Wywołanie `GetValueOrDefault()` zwraca wartość null Integer (jeśli istnieje); Jeśli wartość null jest nie`null`, jednak zwraca domyślną wartość całkowitą 0.</span><span class="sxs-lookup"><span data-stu-id="f7408-176">The call to `GetValueOrDefault()` returns the value of the nullable integer, if it exists; if the nullable integer is `null`, however, it returns the default integer value, 0.</span></span>

## <a name="step-3-returning-the-precise-subset-of-records"></a><span data-ttu-id="f7408-177">Krok 3. Zwracanie dokładnego podzbioru rekordów</span><span class="sxs-lookup"><span data-stu-id="f7408-177">Step 3: Returning the Precise Subset of Records</span></span>

<span data-ttu-id="f7408-178">Następnym zadaniem jest utworzenie metod w DAL i LOGIKI biznesowej, które akceptują wcześniej wymienione zmienne początkowy indeks wiersza i Maksymalna liczba wierszy i zwracają odpowiednie rekordy.</span><span class="sxs-lookup"><span data-stu-id="f7408-178">Our next task is to create methods in the DAL and BLL that accept the Start Row Index and Maximum Rows variables discussed earlier and return the appropriate records.</span></span> <span data-ttu-id="f7408-179">Przed wykonaniem tej czynności poinformuj najpierw o wymaganym skrypcie SQL.</span><span class="sxs-lookup"><span data-stu-id="f7408-179">Before we do that, let s first look at the needed SQL script.</span></span> <span data-ttu-id="f7408-180">Wyzwaniem na bieżąco jest to, że musimy być w stanie efektywnie przypisywać indeks do każdego wiersza w całych wynikach, tak aby można było zwrócić tylko te rekordy, zaczynając od indeksu wierszy początkowych (oraz do maksymalnej liczby rekordów rekordów).</span><span class="sxs-lookup"><span data-stu-id="f7408-180">The challenge facing us is that we must be able to efficiently assign an index to each row in the entire results being paged through so that we can return just those records starting at the Start Row Index (and up to the Maximum Records number of records).</span></span>

<span data-ttu-id="f7408-181">Nie jest to wyzwanie, jeśli w tabeli bazy danych istnieje już kolumna, która służy jako indeks wiersza.</span><span class="sxs-lookup"><span data-stu-id="f7408-181">This is not a challenge if there is already a column in the database table that serves as a row index.</span></span> <span data-ttu-id="f7408-182">Na pierwszy rzut oka możemy wziąć pod uwagę, że `Products` tabeli `ProductID`, ponieważ pierwszy produkt ma `ProductID` 1, drugi a 2 itd.</span><span class="sxs-lookup"><span data-stu-id="f7408-182">At first glance we might think that the `Products` table s `ProductID` field would suffice, as the first product has `ProductID` of 1, the second a 2, and so on.</span></span> <span data-ttu-id="f7408-183">Jednak usunięcie produktu pozostawia przerwy w sekwencji, nullifying to podejście.</span><span class="sxs-lookup"><span data-stu-id="f7408-183">However, deleting a product leaves a gap in the sequence, nullifying this approach.</span></span>

<span data-ttu-id="f7408-184">Istnieją dwie ogólne techniki służące do wydajnego kojarzenia indeksu wierszy z danymi do stron przez, co pozwala na pobranie precyzyjnego podzestawu rekordów:</span><span class="sxs-lookup"><span data-stu-id="f7408-184">There are two general techniques used to efficiently associate a row index with the data to page through, thereby enabling the precise subset of records to be retrieved:</span></span>

- <span data-ttu-id="f7408-185">**Przy użyciu SQL Server 2005 s `ROW_NUMBER()` słowo kluczowe** new do SQL Server 2005, słowo kluczowe `ROW_NUMBER()` kojarzy klasyfikację z każdym zwróconym rekordem na podstawie pewnej kolejności.</span><span class="sxs-lookup"><span data-stu-id="f7408-185">**Using SQL Server 2005 s `ROW_NUMBER()` Keyword** new to SQL Server 2005, the `ROW_NUMBER()` keyword associates a ranking with each returned record based on some ordering.</span></span> <span data-ttu-id="f7408-186">Ta klasyfikacja może służyć jako indeks wierszy dla każdego wiersza.</span><span class="sxs-lookup"><span data-stu-id="f7408-186">This ranking can be used as a row index for each row.</span></span>
- <span data-ttu-id="f7408-187">**Używanie zmiennej tabeli i `SET ROWCOUNT`** Instrukcji SQL Server s [`SET ROWCOUNT`](https://msdn.microsoft.com/library/ms188774.aspx) można użyć, aby określić, ile razem rekordów ma przetwarzać zapytanie przed zakończeniem; [zmienne tabeli](http://www.sqlteam.com/item.asp?ItemID=9454) są lokalnymi zmiennymi T-SQL, które mogą przechowywać dane tabelaryczne, zbliżone do [tabel tymczasowych](http://www.sqlteam.com/item.asp?ItemID=2029).</span><span class="sxs-lookup"><span data-stu-id="f7408-187">**Using a Table Variable and `SET ROWCOUNT`** SQL Server s [`SET ROWCOUNT` statement](https://msdn.microsoft.com/library/ms188774.aspx) can be used to specify how many total records a query should process before terminating; [table variables](http://www.sqlteam.com/item.asp?ItemID=9454) are local T-SQL variables that can hold tabular data, akin to [temporary tables](http://www.sqlteam.com/item.asp?ItemID=2029).</span></span> <span data-ttu-id="f7408-188">Takie podejście działa równie dobrze w przypadku obu Microsoft SQL Server 2005 i SQL Server 2000 (natomiast podejście `ROW_NUMBER()` działa tylko z SQL Server 2005).</span><span class="sxs-lookup"><span data-stu-id="f7408-188">This approach works equally well with both Microsoft SQL Server 2005 and SQL Server 2000 (whereas the `ROW_NUMBER()` approach only works with SQL Server 2005).</span></span>  
  
  <span data-ttu-id="f7408-189">Dobrym pomysłem jest utworzenie zmiennej tabeli, która ma `IDENTITY` kolumny i kolumny dla kluczy podstawowych tabeli, których dane są stronicowane.</span><span class="sxs-lookup"><span data-stu-id="f7408-189">The idea here is to create a table variable that has an `IDENTITY` column and columns for the primary keys of the table whose data is being paged through.</span></span> <span data-ttu-id="f7408-190">Następnie zawartość tabeli, której dane są stronicowane, jest zrzucana do zmiennej tabeli, w związku z czym kojarzy sekwencyjny indeks wierszy (za pośrednictwem kolumny `IDENTITY`) dla każdego rekordu w tabeli.</span><span class="sxs-lookup"><span data-stu-id="f7408-190">Next, the contents of the table whose data is being paged through is dumped into the table variable, thereby associating a sequential row index (via the `IDENTITY` column) for each record in the table.</span></span> <span data-ttu-id="f7408-191">Po wypełnieniu zmiennej tabeli należy wykonać instrukcję `SELECT` na zmiennej tabeli, która jest dołączona do źródłowej tabeli, aby pobrać określone rekordy.</span><span class="sxs-lookup"><span data-stu-id="f7408-191">Once the table variable has been populated, a `SELECT` statement on the table variable, joined with the underlying table, can be executed to pull out the particular records.</span></span> <span data-ttu-id="f7408-192">Instrukcja `SET ROWCOUNT` służy do inteligentnego ograniczania liczby rekordów, które należy zrzucić do zmiennej tabeli.</span><span class="sxs-lookup"><span data-stu-id="f7408-192">The `SET ROWCOUNT` statement is used to intelligently limit the number of records that need to be dumped into the table variable.</span></span>  
  
  <span data-ttu-id="f7408-193">Ta metoda efektywności s jest oparta na żądanym numerze strony, ponieważ `SET ROWCOUNT` wartością jest przypisana wartość początkowego indeksu wierszy i Maksymalna liczba wierszy.</span><span class="sxs-lookup"><span data-stu-id="f7408-193">This approach s efficiency is based on the page number being requested, as the `SET ROWCOUNT` value is assigned the value of Start Row Index plus the Maximum Rows.</span></span> <span data-ttu-id="f7408-194">Podczas stronicowania za pomocą stron o niskich numerach, takich jak pierwsze kilka stron danych, to podejście jest bardzo wydajne.</span><span class="sxs-lookup"><span data-stu-id="f7408-194">When paging through low-numbered pages such as the first few pages of data this approach is very efficient.</span></span> <span data-ttu-id="f7408-195">Jednak podczas pobierania strony blisko końca wykazuje domyślną wydajność podobną do stronicowania.</span><span class="sxs-lookup"><span data-stu-id="f7408-195">However, it exhibits default paging-like performance when retrieving a page near the end.</span></span>

<span data-ttu-id="f7408-196">Ten samouczek implementuje niestandardowe stronicowanie za pomocą słowa kluczowego `ROW_NUMBER()`.</span><span class="sxs-lookup"><span data-stu-id="f7408-196">This tutorial implements custom paging using the `ROW_NUMBER()` keyword.</span></span> <span data-ttu-id="f7408-197">Aby uzyskać więcej informacji na temat używania zmiennej tabeli i techniki `SET ROWCOUNT`, zobacz [bardziej wydajną metodę stronicowania w dużych zestawach wyników](http://www.4guysfromrolla.com/webtech/042606-1.shtml).</span><span class="sxs-lookup"><span data-stu-id="f7408-197">For more information on using the table variable and `SET ROWCOUNT` technique, see [A More Efficient Method for Paging Through Large Result Sets](http://www.4guysfromrolla.com/webtech/042606-1.shtml).</span></span>

<span data-ttu-id="f7408-198">Słowo kluczowe `ROW_NUMBER()` skojarzono klasyfikację z każdym rekordem zwracanym w ramach określonej kolejności przy użyciu następującej składni:</span><span class="sxs-lookup"><span data-stu-id="f7408-198">The `ROW_NUMBER()` keyword associated a ranking with each record returned over a particular ordering using the following syntax:</span></span>

[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample3.sql)]

<span data-ttu-id="f7408-199">`ROW_NUMBER()` zwraca wartość liczbową, która określa rangę każdego rekordu w odniesieniu do wskazanej kolejności.</span><span class="sxs-lookup"><span data-stu-id="f7408-199">`ROW_NUMBER()` returns a numerical value that specifies the rank for each record with regards to the indicated ordering.</span></span> <span data-ttu-id="f7408-200">Na przykład, aby zobaczyć rangę dla każdego produktu, uporządkowaną od najtańszych do najmniejszych, możemy użyć następującej kwerendy:</span><span class="sxs-lookup"><span data-stu-id="f7408-200">For example, to see the rank for each product, ordered from the most expensive to the least, we could use the following query:</span></span>

[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample4.sql)]

<span data-ttu-id="f7408-201">Rysunek 5 przedstawia wyniki zapytania s w przypadku uruchomienia za pomocą okna zapytania w programie Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="f7408-201">Figure 5 shows this query s results when run through the query window in Visual Studio.</span></span> <span data-ttu-id="f7408-202">Należy zwrócić uwagę, że produkty są uporządkowane według ceny i rangi cenowej dla każdego wiersza.</span><span class="sxs-lookup"><span data-stu-id="f7408-202">Note that the products are ordered by price, along with a price rank for each row.</span></span>

![Ranga ceny jest uwzględniana dla każdego zwróconego rekordu](efficiently-paging-through-large-amounts-of-data-cs/_static/image5.png)

<span data-ttu-id="f7408-204">**Rysunek 5**. ranga ceny jest uwzględniana dla każdego zwróconego rekordu</span><span class="sxs-lookup"><span data-stu-id="f7408-204">**Figure 5**: The Price Rank is Included for Each Returned Record</span></span>

> [!NOTE]
> <span data-ttu-id="f7408-205">`ROW_NUMBER()` to tylko jedna z wielu nowych funkcji klasyfikacji dostępnych w SQL Server 2005.</span><span class="sxs-lookup"><span data-stu-id="f7408-205">`ROW_NUMBER()` is just one of the many new ranking functions available in SQL Server 2005.</span></span> <span data-ttu-id="f7408-206">Dokładniejsze Omówienie `ROW_NUMBER()`, wraz z innymi funkcjami rankingu, można znaleźć, [zwracając wyniki rankingu do Microsoft SQL Server 2005](http://www.4guysfromrolla.com/webtech/010406-1.shtml).</span><span class="sxs-lookup"><span data-stu-id="f7408-206">For a more thorough discussion of `ROW_NUMBER()`, along with the other ranking functions, read [Returning Ranked Results with Microsoft SQL Server 2005](http://www.4guysfromrolla.com/webtech/010406-1.shtml).</span></span>

<span data-ttu-id="f7408-207">Podczas klasyfikowania wyników według określonej `ORDER BY` kolumnie w klauzuli `OVER` (`UnitPrice`, w powyższym przykładzie), SQL Server musi sortować wyniki.</span><span class="sxs-lookup"><span data-stu-id="f7408-207">When ranking the results by the specified `ORDER BY` column in the `OVER` clause (`UnitPrice`, in the above example), SQL Server must sort the results.</span></span> <span data-ttu-id="f7408-208">Jest to szybka operacja, jeśli istnieje klastrowany indeks względem kolumn, w których wyniki są uporządkowane przez program, lub jeśli istnieje indeks obejmujący, ale może być bardziej kosztowny w inny sposób.</span><span class="sxs-lookup"><span data-stu-id="f7408-208">This is a quick operation if there is a clustered index over the column(s) the results are being ordered by, or if there is a covering index, but can be more costly otherwise.</span></span> <span data-ttu-id="f7408-209">Aby zwiększyć wydajność dla dostatecznie dużych zapytań, należy rozważyć dodanie indeksu nieklastrowanego dla kolumny, według której mają być uporządkowane wyniki.</span><span class="sxs-lookup"><span data-stu-id="f7408-209">To help improve performance for sufficiently large queries, consider adding a non-clustered index for the column by which the results are ordered by.</span></span> <span data-ttu-id="f7408-210">Zobacz [funkcje klasyfikacji i wydajność w SQL Server 2005](http://www.sql-server-performance.com/ak_ranking_functions.asp) , aby uzyskać bardziej szczegółowy opis zagadnień dotyczących wydajności.</span><span class="sxs-lookup"><span data-stu-id="f7408-210">See [Ranking Functions and Performance in SQL Server 2005](http://www.sql-server-performance.com/ak_ranking_functions.asp) for a more detailed look at the performance considerations.</span></span>

<span data-ttu-id="f7408-211">Informacji o klasyfikowaniu zwracanych przez `ROW_NUMBER()` nie można bezpośrednio użyć w klauzuli `WHERE`.</span><span class="sxs-lookup"><span data-stu-id="f7408-211">The ranking information returned by `ROW_NUMBER()` cannot directly be used in the `WHERE` clause.</span></span> <span data-ttu-id="f7408-212">Można jednak użyć tabeli pochodnej do zwrócenia wyniku `ROW_NUMBER()`, który następnie może być wyświetlany w klauzuli `WHERE`.</span><span class="sxs-lookup"><span data-stu-id="f7408-212">However, a derived table can be used to return the `ROW_NUMBER()` result, which can then appear in the `WHERE` clause.</span></span> <span data-ttu-id="f7408-213">Na przykład następujące zapytanie używa tabeli pochodnej do zwrócenia kolumn ProductName i CenaJednostkowa, wraz z wynikiem `ROW_NUMBER()`, a następnie używa klauzuli `WHERE` w celu zwrócenia tylko tych produktów, których ranga ceny wynosi od 11 do 20:</span><span class="sxs-lookup"><span data-stu-id="f7408-213">For example, the following query uses a derived table to return the ProductName and UnitPrice columns, along with the `ROW_NUMBER()` result, and then uses a `WHERE` clause to only return those products whose price rank is between 11 and 20:</span></span>

[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample5.sql)]

<span data-ttu-id="f7408-214">Przedłużenie tego pojęcia w ten sposób, możemy wykorzystać to podejście do pobrania określonej strony danych z uwzględnieniem żądanego indeksu wierszy początkowych i wartości maksymalnej liczby wierszy:</span><span class="sxs-lookup"><span data-stu-id="f7408-214">Extending this concept a bit further, we can utilize this approach to retrieve a specific page of data given the desired Start Row Index and Maximum Rows values:</span></span>

[!code-html[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample6.html)]

> [!NOTE]
> <span data-ttu-id="f7408-215">Ponieważ w tym samouczku zobaczymy, że *`StartRowIndex`* dostarczone przez element ObjectDataSource jest indeksowany, rozpoczynając od zera, podczas gdy wartość `ROW_NUMBER()` zwracana przez SQL Server 2005 jest indeksowana od 1.</span><span class="sxs-lookup"><span data-stu-id="f7408-215">As we will see later on in this tutorial, the *`StartRowIndex`* supplied by the ObjectDataSource is indexed starting at zero, whereas the `ROW_NUMBER()` value returned by SQL Server 2005 is indexed starting at 1.</span></span> <span data-ttu-id="f7408-216">W związku z tym, klauzula `WHERE` zwraca te rekordy, w których `PriceRank` jest ściśle większa niż *`StartRowIndex`* i mniejsze niż lub równe *`StartRowIndex`*  +  *`MaximumRows`* .</span><span class="sxs-lookup"><span data-stu-id="f7408-216">Therefore, the `WHERE` clause returns those records where `PriceRank` is strictly greater than *`StartRowIndex`* and less than or equal to *`StartRowIndex`* + *`MaximumRows`*.</span></span>

<span data-ttu-id="f7408-217">Teraz, gdy omówiono, jak `ROW_NUMBER()` można użyć do pobrania określonej strony danych, w której znajduje się indeks wierszy początkowych i wartości maksymalne wierszy, teraz musimy zaimplementować tę logikę jako metody w DAL i LOGIKI biznesowej.</span><span class="sxs-lookup"><span data-stu-id="f7408-217">Now that we ve discussed how `ROW_NUMBER()` can be used to retrieve a particular page of data given the Start Row Index and Maximum Rows values, we now need to implement this logic as methods in the DAL and BLL.</span></span>

<span data-ttu-id="f7408-218">Podczas tworzenia tego zapytania musimy określić kolejność, według której będą klasyfikowane wyniki. Posortuj produkty według ich nazwy w kolejności alfabetycznej.</span><span class="sxs-lookup"><span data-stu-id="f7408-218">When creating this query we must decide the ordering by which the results will be ranked; let s sort the products by their name in alphabetical order.</span></span> <span data-ttu-id="f7408-219">Oznacza to, że w przypadku niestandardowej implementacji stronicowania w tym samouczku nie będzie można utworzyć niestandardowego raportu stronicowanego niż można również posortować.</span><span class="sxs-lookup"><span data-stu-id="f7408-219">This means that with the custom paging implementation in this tutorial we will not be able to create a custom paged report than can also be sorted.</span></span> <span data-ttu-id="f7408-220">W następnym samouczku zobaczymy, jak można zapewnić takie funkcje.</span><span class="sxs-lookup"><span data-stu-id="f7408-220">In the next tutorial, though, we'll see how such functionality can be provided.</span></span>

<span data-ttu-id="f7408-221">W poprzedniej sekcji utworzyliśmy metodę DAL jako instrukcję ad-hoc języka SQL.</span><span class="sxs-lookup"><span data-stu-id="f7408-221">In the previous section we created the DAL method as an ad-hoc SQL statement.</span></span> <span data-ttu-id="f7408-222">Niestety, parser T-SQL w programie Visual Studio używany przez kreatora TableAdapter jest nietak podobny do składni `OVER` używanej przez funkcję `ROW_NUMBER()`.</span><span class="sxs-lookup"><span data-stu-id="f7408-222">Unfortunately, the T-SQL parser in Visual Studio used by the TableAdapter wizard doesn t like the `OVER` syntax used by the `ROW_NUMBER()` function.</span></span> <span data-ttu-id="f7408-223">W związku z tym należy utworzyć tę metodę DAL jako procedurę składowaną.</span><span class="sxs-lookup"><span data-stu-id="f7408-223">Therefore, we must create this DAL method as a stored procedure.</span></span> <span data-ttu-id="f7408-224">Wybierz Eksplorator serwera z menu Widok (lub naciśnij kombinację klawiszy CTRL + ALT + S) i rozwiń węzeł `NORTHWND.MDF`.</span><span class="sxs-lookup"><span data-stu-id="f7408-224">Select the Server Explorer from the View menu (or hit Ctrl+Alt+S) and expand the `NORTHWND.MDF` node.</span></span> <span data-ttu-id="f7408-225">Aby dodać nową procedurę składowaną, kliknij prawym przyciskiem myszy węzeł procedury składowane i wybierz polecenie Dodaj nową procedurę składowaną (zobacz rysunek 6).</span><span class="sxs-lookup"><span data-stu-id="f7408-225">To add a new stored procedure, right-click on the Stored Procedures node and choose Add a New Stored Procedure (see Figure 6).</span></span>

![Dodaj nową procedurę składowaną na potrzeby stronicowania za pomocą produktów](efficiently-paging-through-large-amounts-of-data-cs/_static/image6.png)

<span data-ttu-id="f7408-227">**Ilustracja 6**. Dodawanie nowej procedury składowanej w celu stronicowania za pomocą produktów</span><span class="sxs-lookup"><span data-stu-id="f7408-227">**Figure 6**: Add a New Stored Procedure for Paging Through the Products</span></span>

<span data-ttu-id="f7408-228">Ta procedura składowana powinna akceptować dwa parametry wejściowe liczby całkowitej — `@startRowIndex` i `@maximumRows` i korzystać z funkcji `ROW_NUMBER()` uporządkowanej według pola `ProductName`, zwracając tylko te wiersze, które są większe niż określona `@startRowIndex` i mniejsze niż lub równe `@startRowIndex` + `@maximumRow` s.</span><span class="sxs-lookup"><span data-stu-id="f7408-228">This stored procedure should accept two integer input parameters - `@startRowIndex` and `@maximumRows` and use the `ROW_NUMBER()` function ordered by the `ProductName` field, returning only those rows greater than the specified `@startRowIndex` and less than or equal to `@startRowIndex` + `@maximumRow` s.</span></span> <span data-ttu-id="f7408-229">Wprowadź następujący skrypt do nowej procedury składowanej, a następnie kliknij ikonę Zapisz, aby dodać procedurę przechowywaną do bazy danych.</span><span class="sxs-lookup"><span data-stu-id="f7408-229">Enter the following script into the new stored procedure and then click the Save icon to add the stored procedure to the database.</span></span>

[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample7.sql)]

<span data-ttu-id="f7408-230">Po utworzeniu procedury składowanej Poświęć chwilę na jej przetestowanie. Kliknij prawym przyciskiem myszy nazwę `GetProductsPaged` procedury składowanej w Eksplorator serwera i wybierz opcję Execute (wykonaj).</span><span class="sxs-lookup"><span data-stu-id="f7408-230">After creating the stored procedure, take a moment to test it out. Right-click on the `GetProductsPaged` stored procedure name in the Server Explorer and choose the Execute option.</span></span> <span data-ttu-id="f7408-231">Program Visual Studio wyświetli monit o podanie parametrów wejściowych, `@startRowIndex` i `@maximumRow` s (patrz rysunek 7).</span><span class="sxs-lookup"><span data-stu-id="f7408-231">Visual Studio will then prompt you for the input parameters, `@startRowIndex` and `@maximumRow` s (see Figure 7).</span></span> <span data-ttu-id="f7408-232">Spróbuj użyć różnych wartości i przeanalizować wyniki.</span><span class="sxs-lookup"><span data-stu-id="f7408-232">Try different values and examine the results.</span></span>

![Wprowadź wartość parametrów @startRowIndex i @maximumRows](efficiently-paging-through-large-amounts-of-data-cs/_static/image7.png)

<span data-ttu-id="f7408-234"><strong>Rysunek 7</strong>. wprowadzanie wartości @startRowIndex i @maximumRows parametrów</span><span class="sxs-lookup"><span data-stu-id="f7408-234"><strong>Figure 7</strong>: Enter a Value for the @startRowIndex and @maximumRows Parameters</span></span>

<span data-ttu-id="f7408-235">Po wybraniu tych wartości parametrów wejściowych w oknie danych wyjściowych zostaną wyświetlone wyniki.</span><span class="sxs-lookup"><span data-stu-id="f7408-235">After choosing these input parameters values, the Output window will show the results.</span></span> <span data-ttu-id="f7408-236">Rysunek 8 pokazuje wyniki podczas przekazywania 10 dla parametrów `@startRowIndex` i `@maximumRows`.</span><span class="sxs-lookup"><span data-stu-id="f7408-236">Figure 8 shows the results when passing in 10 for both the `@startRowIndex` and `@maximumRows` parameters.</span></span>

<span data-ttu-id="f7408-237">[![rekordy, które pojawią się na drugiej stronie danych są zwracane](efficiently-paging-through-large-amounts-of-data-cs/_static/image9.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="f7408-237">[![The Records That Would Appear in the Second Page of Data are Returned](efficiently-paging-through-large-amounts-of-data-cs/_static/image9.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image8.png)</span></span>

<span data-ttu-id="f7408-238">**Ilustracja 8**. zwracane są rekordy, które pojawią się na drugiej stronie danych ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](efficiently-paging-through-large-amounts-of-data-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="f7408-238">**Figure 8**: The Records That Would Appear in the Second Page of Data are Returned ([Click to view full-size image](efficiently-paging-through-large-amounts-of-data-cs/_static/image10.png))</span></span>

<span data-ttu-id="f7408-239">Po utworzeniu tej procedury składowanej zostanie ona ponownie gotowa do utworzenia metody `ProductsTableAdapter`.</span><span class="sxs-lookup"><span data-stu-id="f7408-239">With this stored procedure created, we re ready to create the `ProductsTableAdapter` method.</span></span> <span data-ttu-id="f7408-240">Otwórz zestaw danych o określonym `Northwind.xsd`, kliknij prawym przyciskiem myszy w `ProductsTableAdapter`, a następnie wybierz opcję Dodaj zapytanie.</span><span class="sxs-lookup"><span data-stu-id="f7408-240">Open the `Northwind.xsd` Typed DataSet, right-click in the `ProductsTableAdapter`, and choose the Add Query option.</span></span> <span data-ttu-id="f7408-241">Zamiast tworzyć zapytania przy użyciu instrukcji SQL ad hoc, utwórz ją za pomocą istniejącej procedury składowanej.</span><span class="sxs-lookup"><span data-stu-id="f7408-241">Instead of creating the query using an ad-hoc SQL statement, create it using an existing stored procedure.</span></span>

![Utwórz metodę DAL za pomocą istniejącej procedury składowanej](efficiently-paging-through-large-amounts-of-data-cs/_static/image11.png)

<span data-ttu-id="f7408-243">**Ilustracja 9**. Tworzenie metody dal za pomocą istniejącej procedury składowanej</span><span class="sxs-lookup"><span data-stu-id="f7408-243">**Figure 9**: Create the DAL Method Using an Existing Stored Procedure</span></span>

<span data-ttu-id="f7408-244">Następnie zostanie wyświetlony monit o wybranie procedury składowanej do wywołania.</span><span class="sxs-lookup"><span data-stu-id="f7408-244">Next, we are prompted to select the stored procedure to invoke.</span></span> <span data-ttu-id="f7408-245">Wybierz procedurę składowaną `GetProductsPaged` z listy rozwijanej.</span><span class="sxs-lookup"><span data-stu-id="f7408-245">Pick the `GetProductsPaged` stored procedure from the drop-down list.</span></span>

![Wybierz procedurę składowaną GetProductsPaged z listy rozwijanej](efficiently-paging-through-large-amounts-of-data-cs/_static/image12.png)

<span data-ttu-id="f7408-247">**Ilustracja 10**. Wybierz procedurę składowaną GetProductsPaged z listy rozwijanej</span><span class="sxs-lookup"><span data-stu-id="f7408-247">**Figure 10**: Choose the GetProductsPaged Stored Procedure from the Drop-Down List</span></span>

<span data-ttu-id="f7408-248">Na następnym ekranie pojawi się monit z pytaniem o rodzaj danych zwracanych przez procedurę składowaną: dane tabelaryczne, pojedynczą wartość lub brak wartości.</span><span class="sxs-lookup"><span data-stu-id="f7408-248">The next screen then asks you what kind of data is returned by the stored procedure: tabular data, a single value, or no value.</span></span> <span data-ttu-id="f7408-249">Ponieważ `GetProductsPaged` procedury składowanej może zwracać wiele rekordów, wskaż, że zwraca dane tabelaryczne.</span><span class="sxs-lookup"><span data-stu-id="f7408-249">Since the `GetProductsPaged` stored procedure can return multiple records, indicate that it returns tabular data.</span></span>

![Wskaż, że procedura składowana zwraca dane tabelaryczne](efficiently-paging-through-large-amounts-of-data-cs/_static/image13.png)

<span data-ttu-id="f7408-251">**Ilustracja 11**. wskazuje, że procedura składowana zwraca dane tabelaryczne</span><span class="sxs-lookup"><span data-stu-id="f7408-251">**Figure 11**: Indicate that the Stored Procedure Returns Tabular Data</span></span>

<span data-ttu-id="f7408-252">Na koniec wskaż nazwy metod, które chcesz utworzyć.</span><span class="sxs-lookup"><span data-stu-id="f7408-252">Finally, indicate the names of the methods you want to have created.</span></span> <span data-ttu-id="f7408-253">Tak jak w przypadku wcześniejszych samouczków, przejdź dalej i twórz metody przy użyciu wypełniania elementu DataTable i zwracają element DataTable.</span><span class="sxs-lookup"><span data-stu-id="f7408-253">As with our previous tutorials, go ahead and create methods using both the Fill a DataTable and Return a DataTable.</span></span> <span data-ttu-id="f7408-254">Nazwij pierwszą metodę `FillPaged` i drugi `GetProductsPaged`.</span><span class="sxs-lookup"><span data-stu-id="f7408-254">Name the first method `FillPaged` and the second `GetProductsPaged`.</span></span>

![Nazwij metody FillPaged i GetProductsPaged](efficiently-paging-through-large-amounts-of-data-cs/_static/image14.png)

<span data-ttu-id="f7408-256">**Ilustracja 12**. nazwy metod FillPaged i GetProductsPaged</span><span class="sxs-lookup"><span data-stu-id="f7408-256">**Figure 12**: Name the Methods FillPaged and GetProductsPaged</span></span>

<span data-ttu-id="f7408-257">Oprócz utworzenia metody DAL w celu zwrócenia określonej strony produktów, należy również podać takie funkcje w LOGIKI biznesowej.</span><span class="sxs-lookup"><span data-stu-id="f7408-257">In addition to created a DAL method to return a particular page of products, we also need to provide such functionality in the BLL.</span></span> <span data-ttu-id="f7408-258">Podobnie jak w przypadku metody DAL, Metoda GetProductsPaged LOGIKI biznesowej, musi akceptować dwie liczby całkowite, aby określić indeks wierszy początkowych i maksymalną liczbę wierszy, i musi zwrócić tylko te rekordy, które mieszczą się w określonym zakresie.</span><span class="sxs-lookup"><span data-stu-id="f7408-258">Like the DAL method, the BLL s GetProductsPaged method must accept two integer inputs for specifying the Start Row Index and Maximum Rows, and must return just those records that fall within the specified range.</span></span> <span data-ttu-id="f7408-259">Utwórz taką metodę LOGIKI biznesowej w klasie ProductsBLL, która powoduje jedynie wywołanie metody DAL s GetProductsPaged, na przykład:</span><span class="sxs-lookup"><span data-stu-id="f7408-259">Create such a BLL method in the ProductsBLL class that merely calls down into the DAL s GetProductsPaged method, like so:</span></span>

[!code-csharp[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample8.cs)]

<span data-ttu-id="f7408-260">Możesz użyć dowolnej nazwy dla parametrów danych wejściowych metody LOGIKI biznesowej, ale w miarę jak zobaczymy, że wybierzesz opcję użycia `startRowIndex` i `maximumRows` zapisuje z dodatkowej liczby pracy podczas konfigurowania elementu ObjectDataSource do korzystania z tej metody.</span><span class="sxs-lookup"><span data-stu-id="f7408-260">You can use any name for the BLL method s input parameters, but, as we will see shortly, choosing to use `startRowIndex` and `maximumRows` saves us from an extra bit of work when configuring an ObjectDataSource to use this method.</span></span>

## <a name="step-4-configuring-the-objectdatasource-to-use-custom-paging"></a><span data-ttu-id="f7408-261">Krok 4. Konfigurowanie elementu ObjectDataSource do używania niestandardowego stronicowania</span><span class="sxs-lookup"><span data-stu-id="f7408-261">Step 4: Configuring the ObjectDataSource to Use Custom Paging</span></span>

<span data-ttu-id="f7408-262">Przy użyciu metod LOGIKI biznesowej i DAL w celu uzyskania dostępu do określonego podzbioru rekordów jest gotowy do utworzenia kontrolki GridView, która umożliwia wykonywanie stron za pośrednictwem własnych rekordów.</span><span class="sxs-lookup"><span data-stu-id="f7408-262">With the BLL and DAL methods for accessing a particular subset of records complete, we re ready to create a GridView control that pages through its underlying records using custom paging.</span></span> <span data-ttu-id="f7408-263">Aby rozpocząć, Otwórz stronę `EfficientPaging.aspx` w folderze `PagingAndSorting`, Dodaj widok GridView do strony i skonfiguruj go tak, aby korzystał z nowej kontrolki ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="f7408-263">Start by opening the `EfficientPaging.aspx` page in the `PagingAndSorting` folder, add a GridView to the page, and configure it to use a new ObjectDataSource control.</span></span> <span data-ttu-id="f7408-264">We wcześniejszych samouczkach często mamy skonfigurowany element ObjectDataSource do korzystania z metody `GetProducts` `ProductsBLL` Class.</span><span class="sxs-lookup"><span data-stu-id="f7408-264">In our past tutorials, we often had the ObjectDataSource configured to use the `ProductsBLL` class s `GetProducts` method.</span></span> <span data-ttu-id="f7408-265">Tym razem zamiast tego chcemy użyć metody `GetProductsPaged`, ponieważ metoda `GetProducts` zwraca *wszystkie* produkty z bazy danych, a `GetProductsPaged` zwraca tylko określony podzbiór rekordów.</span><span class="sxs-lookup"><span data-stu-id="f7408-265">This time, however, we want to use the `GetProductsPaged` method instead, since the `GetProducts` method returns *all* of the products in the database whereas `GetProductsPaged` returns just a particular subset of records.</span></span>

![Skonfiguruj element ObjectDataSource do używania metody GetProductsPaged klasy ProductsBLL](efficiently-paging-through-large-amounts-of-data-cs/_static/image15.png)

<span data-ttu-id="f7408-267">**Ilustracja 13**. Konfigurowanie elementu ObjectDataSource do używania metody GetProductsPaged klasy ProductsBLL</span><span class="sxs-lookup"><span data-stu-id="f7408-267">**Figure 13**: Configure the ObjectDataSource to Use the ProductsBLL Class s GetProductsPaged Method</span></span>

<span data-ttu-id="f7408-268">Ponieważ ponownie utworzysz widok GridView tylko do odczytu, poświęć chwilę, aby ustawić listę rozwijaną metody na karcie Wstawianie, aktualizowanie i usuwanie do (brak).</span><span class="sxs-lookup"><span data-stu-id="f7408-268">Since we re creating a read-only GridView, take a moment to set the method drop-down list in the INSERT, UPDATE, and DELETE tabs to (None).</span></span>

<span data-ttu-id="f7408-269">Następnie Kreator ObjectDataSource monituje nas o źródła `GetProductsPaged` metody `startRowIndex` i `maximumRows` wartości parametrów wejściowych.</span><span class="sxs-lookup"><span data-stu-id="f7408-269">Next, the ObjectDataSource wizard prompts us for the sources of the `GetProductsPaged` method s `startRowIndex` and `maximumRows` input parameters values.</span></span> <span data-ttu-id="f7408-270">Te parametry wejściowe będą faktycznie ustawiane automatycznie przez GridView, więc po prostu pozostaw Źródło ustawioną na None i kliknij przycisk Zakończ.</span><span class="sxs-lookup"><span data-stu-id="f7408-270">These input parameters will actually be set by the GridView automatically, so simply leave the source set to None and click Finish.</span></span>

![Pozostaw źródła parametrów wejściowych jako brak](efficiently-paging-through-large-amounts-of-data-cs/_static/image16.png)

<span data-ttu-id="f7408-272">**Ilustracja 14**. pozostawienie źródła parametru wejściowego jako None</span><span class="sxs-lookup"><span data-stu-id="f7408-272">**Figure 14**: Leave the Input Parameter Sources as None</span></span>

<span data-ttu-id="f7408-273">Po ukończeniu działania kreatora ObjectDataSource, GridView będzie zawierać BoundField lub CheckBoxField dla każdego z pól danych produktu.</span><span class="sxs-lookup"><span data-stu-id="f7408-273">After completing the ObjectDataSource wizard, the GridView will contain a BoundField or CheckBoxField for each of the product data fields.</span></span> <span data-ttu-id="f7408-274">Możesz swobodnie dopasować wygląd widoku GridView w miarę dopasowania.</span><span class="sxs-lookup"><span data-stu-id="f7408-274">Feel free to tailor the GridView s appearance as you see fit.</span></span> <span data-ttu-id="f7408-275">Wybiorę opcję wyświetlania tylko `ProductName`, `CategoryName`, `SupplierName`, `QuantityPerUnit`i `UnitPrice` BoundFields.</span><span class="sxs-lookup"><span data-stu-id="f7408-275">I ve opted to display only the `ProductName`, `CategoryName`, `SupplierName`, `QuantityPerUnit`, and `UnitPrice` BoundFields.</span></span> <span data-ttu-id="f7408-276">Ponadto skonfiguruj widok GridView, aby obsługiwał stronicowanie, zaznaczając pole wyboru Włącz stronicowanie w jego tagu inteligentnym.</span><span class="sxs-lookup"><span data-stu-id="f7408-276">Also, configure the GridView to support paging by checking the Enable Paging checkbox in its smart tag.</span></span> <span data-ttu-id="f7408-277">Po wprowadzeniu tych zmian znaczniki deklaratywne GridView i ObjectDataSource powinny wyglądać podobnie do następujących:</span><span class="sxs-lookup"><span data-stu-id="f7408-277">After these changes, the GridView and ObjectDataSource declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample9.aspx)]

<span data-ttu-id="f7408-278">W przypadku odwiedzania strony za pomocą przeglądarki, w widoku GridView nie ma miejsca do znalezienia.</span><span class="sxs-lookup"><span data-stu-id="f7408-278">If you visit the page through a browser, however, the GridView is no where to be found.</span></span>

![Widok GridView nie jest wyświetlany](efficiently-paging-through-large-amounts-of-data-cs/_static/image17.png)

<span data-ttu-id="f7408-280">**Ilustracja 15**. widok GridView nie jest wyświetlany</span><span class="sxs-lookup"><span data-stu-id="f7408-280">**Figure 15**: The GridView is Not Displayed</span></span>

<span data-ttu-id="f7408-281">Brak elementu GridView, ponieważ element ObjectDataSource używa obecnie 0 jako wartości dla obu `startRowIndex` `GetProductsPaged` i `maximumRows` parametrów wejściowych.</span><span class="sxs-lookup"><span data-stu-id="f7408-281">The GridView is missing because the ObjectDataSource is currently using 0 as the values for both of the `GetProductsPaged` `startRowIndex` and `maximumRows` input parameters.</span></span> <span data-ttu-id="f7408-282">W związku z tym wyniki zapytania SQL nie zwracają żadnych rekordów i w związku z tym widok GridView nie jest wyświetlany.</span><span class="sxs-lookup"><span data-stu-id="f7408-282">Hence, the resulting SQL query is returning no records and therefore the GridView is not displayed.</span></span>

<span data-ttu-id="f7408-283">Aby to naprawić, należy skonfigurować element ObjectDataSource do używania niestandardowego stronicowania.</span><span class="sxs-lookup"><span data-stu-id="f7408-283">To remedy this, we need to configure the ObjectDataSource to use custom paging.</span></span> <span data-ttu-id="f7408-284">Można to zrobić w następujących krokach:</span><span class="sxs-lookup"><span data-stu-id="f7408-284">This can be accomplished in the following steps:</span></span>

1. <span data-ttu-id="f7408-285">**Ustaw właściwość `EnablePaging` ObjectDataSource s tak, aby `true`** wskazywała na element ObjectDataSource, który musi zostać przekazany do `SelectMethod` dwa dodatkowe parametry: jeden do określenia początkowy indeks wiersza ([`StartRowIndexParameterName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.startrowindexparametername.aspx)) i drugi, aby określić maksymalną liczbę wierszy ([`MaximumRowsParameterName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.maximumrowsparametername.aspx)).</span><span class="sxs-lookup"><span data-stu-id="f7408-285">**Set the ObjectDataSource s `EnablePaging` property to `true`** this indicates to the ObjectDataSource that it must pass to the `SelectMethod` two additional parameters: one to specify the Start Row Index ([`StartRowIndexParameterName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.startrowindexparametername.aspx)), and one to specify the Maximum Rows ([`MaximumRowsParameterName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.maximumrowsparametername.aspx)).</span></span>
2. <span data-ttu-id="f7408-286">**Ustaw właściwości `StartRowIndexParameterName` i `MaximumRowsParameterName` elementów ObjectDataSource odpowiednio** `StartRowIndexParameterName` i `MaximumRowsParameterName` właściwości wskazują nazwy parametrów wejściowych, które są przesyłane do `SelectMethod` do celów stronicowania niestandardowego.</span><span class="sxs-lookup"><span data-stu-id="f7408-286">**Set the ObjectDataSource s `StartRowIndexParameterName` and `MaximumRowsParameterName` Properties Accordingly** the `StartRowIndexParameterName` and `MaximumRowsParameterName` properties indicate the names of the input parameters passed into the `SelectMethod` for custom paging purposes.</span></span> <span data-ttu-id="f7408-287">Domyślnie te nazwy parametrów są `startIndexRow` i `maximumRows`, co oznacza, że podczas tworzenia metody `GetProductsPaged` w LOGIKI biznesowej użyto tych wartości parametrów wejściowych.</span><span class="sxs-lookup"><span data-stu-id="f7408-287">By default, these parameter names are `startIndexRow` and `maximumRows`, which is why, when creating the `GetProductsPaged` method in the BLL, I used these values for the input parameters.</span></span> <span data-ttu-id="f7408-288">W przypadku wybrania opcji używania innych nazw parametrów dla metody LOGIKI biznesowej s `GetProductsPaged`, takiej jak `startIndex` i `maxRows`, na przykład trzeba będzie odpowiednio ustawić właściwości ObjectDataSource s `StartRowIndexParameterName` i `MaximumRowsParameterName` (na przykład startIndex dla `StartRowIndexParameterName` i maxRows dla `MaximumRowsParameterName`).</span><span class="sxs-lookup"><span data-stu-id="f7408-288">If you chose to use different parameter names for the BLL s `GetProductsPaged` method such as `startIndex` and `maxRows`, for example you would need to set the ObjectDataSource s `StartRowIndexParameterName` and `MaximumRowsParameterName` properties accordingly (such as startIndex for `StartRowIndexParameterName` and maxRows for `MaximumRowsParameterName`).</span></span>
3. <span data-ttu-id="f7408-289">**Ustaw właściwość ObjectDataSource s [`SelectCountMethod`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.selectcountmethod(VS.80).aspx) na nazwę metody, która zwraca łączną liczbę rekordów, które są stronicowane za pośrednictwem (`TotalNumberOfProducts`)** , aby Metoda `TotalNumberOfProducts` `ProductsBLL` klasy s zwracała łączną liczbę rekordów, które są stronicowane za pomocą metody dal, która wykonuje kwerendę `SELECT COUNT(*) FROM Products`.</span><span class="sxs-lookup"><span data-stu-id="f7408-289">**Set the ObjectDataSource s [`SelectCountMethod` Property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.selectcountmethod(VS.80).aspx) to the Name of the Method that Returns the Total Number of Records Being Paged Through (`TotalNumberOfProducts`)** recall that the `ProductsBLL` class s `TotalNumberOfProducts` method returns the total number of records being paged through using a DAL method that executes a `SELECT COUNT(*) FROM Products` query.</span></span> <span data-ttu-id="f7408-290">Te informacje są konieczne przez element ObjectDataSource w celu poprawnego renderowania interfejsu stronicowania.</span><span class="sxs-lookup"><span data-stu-id="f7408-290">This information is needed by the ObjectDataSource in order to correctly render the paging interface.</span></span>
4. <span data-ttu-id="f7408-291">**Usuń `startRowIndex` i `maximumRows` `<asp:Parameter>` elementów z znacznika deklaracyjnego ObjectDataSource** podczas konfigurowania elementu ObjectDataSource za pośrednictwem kreatora, Visual Studio automatycznie dodaliśmy dwa elementy `<asp:Parameter>` dla parametrów wejściowych metody `GetProductsPaged`.</span><span class="sxs-lookup"><span data-stu-id="f7408-291">**Remove the `startRowIndex` and `maximumRows` `<asp:Parameter>` Elements from the ObjectDataSource s Declarative Markup** when configuring the ObjectDataSource through the wizard, Visual Studio automatically added two `<asp:Parameter>` elements for the `GetProductsPaged` method s input parameters.</span></span> <span data-ttu-id="f7408-292">Ustawienie `EnablePaging` na `true`powoduje automatyczne przekazanie tych parametrów; Jeśli pojawiają się one również we składni deklaratywnej, element ObjectDataSource podejmie próbę przekazania *czterech* parametrów do metody `GetProductsPaged` i dwóch parametrów do metody `TotalNumberOfProducts`.</span><span class="sxs-lookup"><span data-stu-id="f7408-292">By setting `EnablePaging` to `true`, these parameters will be passed automatically; if they also appear in the declarative syntax, the ObjectDataSource will attempt to pass *four* parameters to the `GetProductsPaged` method and two parameters to the `TotalNumberOfProducts` method.</span></span> <span data-ttu-id="f7408-293">Jeśli zapomnisz usunąć te `<asp:Parameter>` elementy, podczas odwiedzania strony przez przeglądarkę zostanie wyświetlony komunikat o błędzie: element *ObjectDataSource "ObjectDataSource1" nie może znaleźć niegenerycznej metody "TotalNumberOfProducts", która ma parametry: StartRowIndex, MaximumRows*.</span><span class="sxs-lookup"><span data-stu-id="f7408-293">If you forget to remove these `<asp:Parameter>` elements, when visiting the page through a browser you'll get an error message like: *ObjectDataSource 'ObjectDataSource1' could not find a non-generic method 'TotalNumberOfProducts' that has parameters: startRowIndex, maximumRows*.</span></span>

<span data-ttu-id="f7408-294">Po wprowadzeniu tych zmian składnia deklaracyjnego elementu ObjectDataSource powinna wyglądać następująco:</span><span class="sxs-lookup"><span data-stu-id="f7408-294">After making these changes, the ObjectDataSource s declarative syntax should look like the following:</span></span>

[!code-aspx[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample10.aspx)]

<span data-ttu-id="f7408-295">Należy zauważyć, że właściwości `EnablePaging` i `SelectCountMethod` zostały ustawione, a elementy `<asp:Parameter>` zostały usunięte.</span><span class="sxs-lookup"><span data-stu-id="f7408-295">Note that the `EnablePaging` and `SelectCountMethod` properties have been set and the `<asp:Parameter>` elements have been removed.</span></span> <span data-ttu-id="f7408-296">Rysunek 16 przedstawia zrzut ekranu okno Właściwości po wprowadzeniu tych zmian.</span><span class="sxs-lookup"><span data-stu-id="f7408-296">Figure 16 shows a screen shot of the Properties window after these changes have been made.</span></span>

![Aby użyć stronicowania niestandardowego, skonfiguruj kontrolkę ObjectDataSource](efficiently-paging-through-large-amounts-of-data-cs/_static/image18.png)

<span data-ttu-id="f7408-298">**Ilustracja 16**. Aby użyć stronicowania niestandardowego, skonfiguruj kontrolkę ObjectDataSource</span><span class="sxs-lookup"><span data-stu-id="f7408-298">**Figure 16**: To Use Custom Paging, Configure the ObjectDataSource Control</span></span>

<span data-ttu-id="f7408-299">Po wprowadzeniu tych zmian odwiedź tę stronę za pomocą przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="f7408-299">After making these changes, visit this page through a browser.</span></span> <span data-ttu-id="f7408-300">Powinny pojawić się na liście 10 produktów uporządkowane alfabetycznie.</span><span class="sxs-lookup"><span data-stu-id="f7408-300">You should see 10 products listed, ordered alphabetically.</span></span> <span data-ttu-id="f7408-301">Poświęć chwilę na przechodzenie między danymi pojedynczo.</span><span class="sxs-lookup"><span data-stu-id="f7408-301">Take a moment to step through the data one page at a time.</span></span> <span data-ttu-id="f7408-302">Chociaż nie ma różnic wizualnych od perspektywy użytkownika końcowego między domyślnym stronicowaniem a stronicowaniem niestandardowym, niestandardowe stronicowanie bardziej wydajne stron za pośrednictwem dużych ilości danych, ponieważ pobiera tylko te rekordy, które muszą być wyświetlane dla danej strony.</span><span class="sxs-lookup"><span data-stu-id="f7408-302">While there is no visual difference from the end user s perspective between default paging and custom paging, custom paging more efficiently pages through large amounts of data as it only retrieves those records that need to be displayed for a given page.</span></span>

<span data-ttu-id="f7408-303">[![dane uporządkowane według nazwy produktu, są stronicowane przy użyciu niestandardowego stronicowania](efficiently-paging-through-large-amounts-of-data-cs/_static/image20.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="f7408-303">[![The Data, Ordered by the Product s Name, is Paged Using Custom Paging](efficiently-paging-through-large-amounts-of-data-cs/_static/image20.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image19.png)</span></span>

<span data-ttu-id="f7408-304">**Ilustracja 17**. dane uporządkowane według nazwy produktu są stronicowane przy użyciu niestandardowego stronicowania ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](efficiently-paging-through-large-amounts-of-data-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="f7408-304">**Figure 17**: The Data, Ordered by the Product s Name, is Paged Using Custom Paging ([Click to view full-size image](efficiently-paging-through-large-amounts-of-data-cs/_static/image21.png))</span></span>

> [!NOTE]
> <span data-ttu-id="f7408-305">Dzięki stronicowaniu niestandardowym wartość liczby stron zwracana przez `SelectCountMethod` ObjectDataSource s jest przechowywana w stanie widoku GridView.</span><span class="sxs-lookup"><span data-stu-id="f7408-305">With custom paging, the page count value returned by the ObjectDataSource�s `SelectCountMethod` is stored in the GridView�s view state.</span></span> <span data-ttu-id="f7408-306">Inne zmienne GridView `PageIndex`, `EditIndex`, `SelectedIndex`, kolekcja `DataKeys` i tak dalej są przechowywane w *stanie kontroli*, który jest utrwalany niezależnie od wartości właściwości GridView-`EnableViewState`.</span><span class="sxs-lookup"><span data-stu-id="f7408-306">Other GridView variables the `PageIndex`, `EditIndex`, `SelectedIndex`, `DataKeys` collection, and so on are stored in *control state*, which is persisted regardless of the value of the GridView�s `EnableViewState` property.</span></span> <span data-ttu-id="f7408-307">Ponieważ wartość `PageCount` jest utrwalana w przypadku ogłaszania zwrotnego przy użyciu stanu widoku, podczas korzystania z interfejsu stronicowania, który zawiera link umożliwiający przejście do ostatniej strony, należy sprawdzić, czy stan widoku GridView jest włączony.</span><span class="sxs-lookup"><span data-stu-id="f7408-307">Since the `PageCount` value is persisted across postbacks using view state, when using a paging interface that includes a link to take you to the last page, it is imperative that the GridView�s view state be enabled.</span></span> <span data-ttu-id="f7408-308">(Jeśli interfejs stronicowania nie zawiera bezpośredniego linku do ostatniej strony, można wyłączyć stan widoku).</span><span class="sxs-lookup"><span data-stu-id="f7408-308">(If your paging interface does not include a direct link to the last page, then you may disable view state.)</span></span>

<span data-ttu-id="f7408-309">Kliknięcie linku Ostatnia strona powoduje ogłoszenie zwrotne, a następnie wyświetlenie widoku GridView w celu zaktualizowania jego właściwości `PageIndex`.</span><span class="sxs-lookup"><span data-stu-id="f7408-309">Clicking the last page link causes a postback and instructs the GridView to update its `PageIndex` property.</span></span> <span data-ttu-id="f7408-310">Jeśli zostanie kliknięty link Ostatnia strona, GridView przypisze jej Właściwość `PageIndex` do wartości mniejszej niż jej Właściwość `PageCount`.</span><span class="sxs-lookup"><span data-stu-id="f7408-310">If the last page link is clicked, the GridView assigns its `PageIndex` property to a value one less than its `PageCount` property.</span></span> <span data-ttu-id="f7408-311">Po wyłączeniu stanu widoku wartość `PageCount` zostanie utracona na stronach ogłaszania zwrotnego, a `PageIndex` w zamian zostanie przypisana wartość maksymalna liczba całkowita.</span><span class="sxs-lookup"><span data-stu-id="f7408-311">With view state disabled, the `PageCount` value is lost across postbacks and the `PageIndex` is assigned the maximum integer value instead.</span></span> <span data-ttu-id="f7408-312">Następnie GridView próbuje określić początkowy indeks wiersza, mnożąc `PageSize` i `PageCount` właściwości.</span><span class="sxs-lookup"><span data-stu-id="f7408-312">Next, the GridView attempts to determine the starting row index by multiplying the `PageSize` and `PageCount` properties.</span></span> <span data-ttu-id="f7408-313">Powoduje to `OverflowException`, ponieważ produkt przekracza maksymalny dozwolony rozmiar w postaci liczby całkowitej.</span><span class="sxs-lookup"><span data-stu-id="f7408-313">This results in an `OverflowException` since the product exceeds the maximum allowed integer size.</span></span>

## <a name="implement-custom-paging-and-sorting"></a><span data-ttu-id="f7408-314">Implementowanie niestandardowego stronicowania i sortowania</span><span class="sxs-lookup"><span data-stu-id="f7408-314">Implement Custom Paging and Sorting</span></span>

<span data-ttu-id="f7408-315">Nasza bieżąca implementacja stronicowania niestandardowego wymaga, aby kolejność, w której dane są stronicowane, była określana statycznie podczas tworzenia procedury składowanej `GetProductsPaged`.</span><span class="sxs-lookup"><span data-stu-id="f7408-315">Our current custom paging implementation requires that the order by which the data is paged through be specified statically when creating the `GetProductsPaged` stored procedure.</span></span> <span data-ttu-id="f7408-316">Jednak można zauważyć, że tag "GridView" w widoku inteligentnym zawiera pole wyboru Włącz sortowanie obok opcji Włącz stronicowanie.</span><span class="sxs-lookup"><span data-stu-id="f7408-316">However, you may have noted that the GridView s smart tag contains an Enable Sorting checkbox in addition to the Enable Paging option.</span></span> <span data-ttu-id="f7408-317">Niestety dodanie obsługi sortowania do widoku GridView przy użyciu bieżącej implementacji stronicowania niestandardowego spowoduje posortowanie rekordów tylko na aktualnie wyświetlanej stronie danych.</span><span class="sxs-lookup"><span data-stu-id="f7408-317">Unfortunately, adding sorting support to the GridView with our current custom paging implementation will only sort the records on the currently viewed page of data.</span></span> <span data-ttu-id="f7408-318">Na przykład w przypadku skonfigurowania widoku GridView do obsługi stronicowania, a następnie podczas wyświetlania pierwszej strony danych Sortuj według nazwy produktu w kolejności malejącej, spowoduje to odwrócenie kolejności produktów na stronie 1.</span><span class="sxs-lookup"><span data-stu-id="f7408-318">For example, if you configure the GridView to also support paging and then, when viewing the first page of data, sort by product name in descending order, it will reverse the order of the products on page 1.</span></span> <span data-ttu-id="f7408-319">Jak pokazano na rysunku 18, takie pokazuje Carnarvon Tigers jako pierwszy produkt podczas sortowania w odwrotnej kolejności alfabetycznej, która ignoruje 71 inne produkty, które są dostępne po Carnarvon Tigers, alfabetycznie; tylko rekordy na pierwszej stronie są brane pod uwagę podczas sortowania.</span><span class="sxs-lookup"><span data-stu-id="f7408-319">As Figure 18 shows, such shows Carnarvon Tigers as the first product when sorting in reverse alphabetical order, which ignores the 71 other products that come after Carnarvon Tigers, alphabetically; only those records on the first page are considered in the sorting.</span></span>

<span data-ttu-id="f7408-320">[posortowane są tylko dane wyświetlane na bieżącej stronie ![](efficiently-paging-through-large-amounts-of-data-cs/_static/image23.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="f7408-320">[![Only the Data Shown on the Current Page is Sorted](efficiently-paging-through-large-amounts-of-data-cs/_static/image23.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image22.png)</span></span>

<span data-ttu-id="f7408-321">**Ilustracja 18**. posortowane są tylko dane wyświetlane na bieżącej stronie ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](efficiently-paging-through-large-amounts-of-data-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="f7408-321">**Figure 18**: Only the Data Shown on the Current Page is Sorted ([Click to view full-size image](efficiently-paging-through-large-amounts-of-data-cs/_static/image24.png))</span></span>

<span data-ttu-id="f7408-322">Sortowanie ma zastosowanie tylko do bieżącej strony danych, ponieważ sortowanie jest wykonywane po pobraniu danych z metody LOGIKI biznesowej s `GetProductsPaged` i ta metoda zwraca tylko te rekordy dla określonej strony.</span><span class="sxs-lookup"><span data-stu-id="f7408-322">The sorting only applies to the current page of data because the sorting is occurring after the data has been retrieved from the BLL s `GetProductsPaged` method, and this method only returns those records for the specific page.</span></span> <span data-ttu-id="f7408-323">Aby poprawnie zaimplementować sortowanie, musimy przekazać wyrażenie sortowania do metody `GetProductsPaged`, tak aby dane mogły być odpowiednio klasyfikowane przed zwróceniem określonej strony danych.</span><span class="sxs-lookup"><span data-stu-id="f7408-323">To implement sorting correctly, we need to pass the sort expression to the `GetProductsPaged` method so that the data can be ranked appropriately before returning the specific page of data.</span></span> <span data-ttu-id="f7408-324">Zobaczymy, jak to zrobić w następnym samouczku.</span><span class="sxs-lookup"><span data-stu-id="f7408-324">We'll see how to accomplish this in our next tutorial.</span></span>

## <a name="implementing-custom-paging-and-deleting"></a><span data-ttu-id="f7408-325">Implementowanie niestandardowego stronicowania i usuwanie</span><span class="sxs-lookup"><span data-stu-id="f7408-325">Implementing Custom Paging and Deleting</span></span>

<span data-ttu-id="f7408-326">W przypadku włączenia funkcji usuwania w widoku GridView, którego dane są stronicowane przy użyciu niestandardowych technik stronicowania, podczas usuwania ostatniego rekordu z ostatniej strony, zobaczysz, że nie zostanie odpowiednio zmniejszony `PageIndex`GridView.</span><span class="sxs-lookup"><span data-stu-id="f7408-326">If you enabling deleting functionality in a GridView whose data is paged using custom paging techniques you will find that when deleting the last record from the last page, the GridView disappears rather than appropriately decrementing the GridView s `PageIndex`.</span></span> <span data-ttu-id="f7408-327">Aby odtworzyć tę usterkę, Włącz opcję usuwania dla właśnie utworzonego samouczka.</span><span class="sxs-lookup"><span data-stu-id="f7408-327">To reproduce this bug, enable deleting for the tutorial just we just created.</span></span> <span data-ttu-id="f7408-328">Przejdź do ostatniej strony (strona 9), w której powinien zostać wyświetlony pojedynczy produkt, ponieważ jest stronicowany przez 81 produktów, 10 produktów jednocześnie.</span><span class="sxs-lookup"><span data-stu-id="f7408-328">Go to the last page (page 9), where you should see a single product since we are paging through 81 products, 10 products at a time.</span></span> <span data-ttu-id="f7408-329">Usuń ten produkt.</span><span class="sxs-lookup"><span data-stu-id="f7408-329">Delete this product.</span></span>

<span data-ttu-id="f7408-330">Po usunięciu ostatniego produktu, widok GridView *powinien* automatycznie przechodzić do ósmej strony i takie funkcje są przedstawiane jako domyślne stronicowanie.</span><span class="sxs-lookup"><span data-stu-id="f7408-330">Upon deleting the last product, the GridView *should* automatically go to the eighth page, and such functionality is exhibited with default paging.</span></span> <span data-ttu-id="f7408-331">Po usunięciu niestandardowego stronicowania, gdy usuniesz ten ostatni produkt na ostatniej stronie, widok GridView po prostu znika z ekranu.</span><span class="sxs-lookup"><span data-stu-id="f7408-331">With custom paging, however, after deleting that last product on the last page, the GridView simply disappears from the screen altogether.</span></span> <span data-ttu-id="f7408-332">Dokładną przyczyną tego, że dzieje *się tak,* jest bit wykraczający poza zakres tego samouczka; Zobacz [Usuwanie ostatniego rekordu na ostatniej stronie z widoku GridView z niestandardowym stronicowaniem](http://scottonwriting.net/sowblog/posts/7326.aspx) , aby poznać szczegóły niskiego poziomu dotyczące źródła tego problemu.</span><span class="sxs-lookup"><span data-stu-id="f7408-332">The precise reason *why* this happens is a bit beyond the scope of this tutorial; see [Deleting the Last Record on the Last Page from a GridView with Custom Paging](http://scottonwriting.net/sowblog/posts/7326.aspx) for the low-level details as to the source of this problem.</span></span> <span data-ttu-id="f7408-333">Podsumowując to s z powodu następującej sekwencji kroków, które są wykonywane przez GridView po kliknięciu przycisku Usuń:</span><span class="sxs-lookup"><span data-stu-id="f7408-333">In summary it s due to the following sequence of steps that are performed by the GridView when the Delete button is clicked:</span></span>

1. <span data-ttu-id="f7408-334">Usuń rekord</span><span class="sxs-lookup"><span data-stu-id="f7408-334">Delete the record</span></span>
2. <span data-ttu-id="f7408-335">Pobierz odpowiednie rekordy do wyświetlenia dla określonych `PageIndex` i `PageSize`</span><span class="sxs-lookup"><span data-stu-id="f7408-335">Get the appropriate records to display for the specified `PageIndex` and `PageSize`</span></span>
3. <span data-ttu-id="f7408-336">Upewnij się, że `PageIndex` nie przekracza liczby stron danych w źródle danych. Jeśli tak, automatycznie Zmniejsz Właściwość `PageIndex` GridView</span><span class="sxs-lookup"><span data-stu-id="f7408-336">Check to ensure that the `PageIndex` does not exceed the number of pages of data in the data source; if it does, automatically decrement the GridView s `PageIndex` property</span></span>
4. <span data-ttu-id="f7408-337">Powiąż odpowiednią stronę danych z GridView przy użyciu rekordów uzyskanych w kroku 2</span><span class="sxs-lookup"><span data-stu-id="f7408-337">Bind the appropriate page of data to the GridView using the records obtained in Step 2</span></span>

<span data-ttu-id="f7408-338">Problem wynika z faktu, że w kroku 2 `PageIndex` używany podczas przechwyconia rekordów do wyświetlenia jest w dalszym ciągu `PageIndex` ostatniej strony, której jedyny rekord został właśnie usunięty.</span><span class="sxs-lookup"><span data-stu-id="f7408-338">The problem stems from the fact that in Step 2 the `PageIndex` used when grabbing the records to display is still the `PageIndex` of the last page whose sole record was just deleted.</span></span> <span data-ttu-id="f7408-339">W związku z tym w kroku 2 *żadne rekordy nie* są zwracane, ponieważ Ostatnia strona danych nie zawiera już żadnych rekordów.</span><span class="sxs-lookup"><span data-stu-id="f7408-339">Therefore, in Step 2, *no* records are returned since that last page of data no longer contains any records.</span></span> <span data-ttu-id="f7408-340">Następnie w kroku 3 widok GridView realizuje, że jego właściwość `PageIndex` jest większa niż łączna liczba stron w źródle danych (od momentu usunięcia ostatniego rekordu z ostatniej strony) i w związku z tym zmniejsza jego właściwość `PageIndex`.</span><span class="sxs-lookup"><span data-stu-id="f7408-340">Then, in Step 3, the GridView realizes that its `PageIndex` property is greater than the total number of pages in the data source (since we ve deleted the last record in the last page) and therefore decrements its `PageIndex` property.</span></span> <span data-ttu-id="f7408-341">W kroku 4 GridView próbuje powiązać się z danymi pobranymi w kroku 2. Jednakże w kroku 2 żadne rekordy nie zostały zwrócone, w związku z czym wynikiem jest pusty widok GridView.</span><span class="sxs-lookup"><span data-stu-id="f7408-341">In Step 4 the GridView attempts to bind itself to the data retrieved in Step 2; however, in Step 2 no records were returned, therefore resulting in an empty GridView.</span></span> <span data-ttu-id="f7408-342">W przypadku domyślnego stronicowania ten problem nie występuje, ponieważ w kroku 2 *wszystkie* rekordy są pobierane ze źródła danych.</span><span class="sxs-lookup"><span data-stu-id="f7408-342">With default paging, this problem doesn t surface because in Step 2 *all* records are retrieved from the data source.</span></span>

<span data-ttu-id="f7408-343">Aby rozwiązać ten problem, dostępne są dwie opcje.</span><span class="sxs-lookup"><span data-stu-id="f7408-343">To fix this we have two options.</span></span> <span data-ttu-id="f7408-344">Pierwszym z nich jest utworzenie procedury obsługi zdarzeń dla programu obsługi zdarzeń `RowDeleted` GridView, która określa, ile rekordów było wyświetlanych na stronie, która została właśnie usunięta.</span><span class="sxs-lookup"><span data-stu-id="f7408-344">The first is to create an event handler for the GridView s `RowDeleted` event handler that determines how many records were displayed in the page that was just deleted.</span></span> <span data-ttu-id="f7408-345">Jeśli istnieje tylko jeden rekord, usunięty rekord musi być ostatnim z nich i musimy zmniejszyć `PageIndex`GridView.</span><span class="sxs-lookup"><span data-stu-id="f7408-345">If there was only one record, then the record just deleted must have been the last one and we need to decrement the GridView s `PageIndex`.</span></span> <span data-ttu-id="f7408-346">Oczywiście chcemy tylko zaktualizować `PageIndex`, jeśli operacja usuwania zakończyła się pomyślnie, co można ustalić, upewniając się, że właściwość `e.Exception` jest `null`.</span><span class="sxs-lookup"><span data-stu-id="f7408-346">Of course, we only want to update the `PageIndex` if the delete operation was actually successful, which can be determined by ensuring that the `e.Exception` property is `null`.</span></span>

<span data-ttu-id="f7408-347">Takie podejście działa, ponieważ aktualizuje `PageIndex` po kroku 1, ale przed krok 2.</span><span class="sxs-lookup"><span data-stu-id="f7408-347">This approach works because it updates the `PageIndex` after Step 1 but before Step 2.</span></span> <span data-ttu-id="f7408-348">W związku z tym, w kroku 2, zwracany jest odpowiedni zestaw rekordów.</span><span class="sxs-lookup"><span data-stu-id="f7408-348">Therefore, in Step 2, the appropriate set of records is returned.</span></span> <span data-ttu-id="f7408-349">Aby to osiągnąć, użyj następującego kodu:</span><span class="sxs-lookup"><span data-stu-id="f7408-349">To accomplish this, use code like the following:</span></span>

[!code-csharp[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample11.cs)]

<span data-ttu-id="f7408-350">Alternatywnym obejściem jest utworzenie procedury obsługi zdarzeń dla zdarzenia ObjectDataSource s `RowDeleted` i ustawienie właściwości `AffectedRows` na wartość 1.</span><span class="sxs-lookup"><span data-stu-id="f7408-350">An alternative workaround is to create an event handler for the ObjectDataSource s `RowDeleted` event and to set the `AffectedRows` property to a value of 1.</span></span> <span data-ttu-id="f7408-351">Po usunięciu rekordu w kroku 1 (ale przed ponownym pobraniem danych w kroku 2) widok GridView aktualizuje swoją właściwość `PageIndex`, jeśli operacja ma wpływ na co najmniej jeden wiersz.</span><span class="sxs-lookup"><span data-stu-id="f7408-351">After deleting the record in Step 1 (but before re-retrieving the data in Step 2), the GridView updates its `PageIndex` property if one or more rows were affected by the operation.</span></span> <span data-ttu-id="f7408-352">Jednak Właściwość `AffectedRows` nie jest ustawiana przez element ObjectDataSource i w związku z tym ten krok zostanie pominięty.</span><span class="sxs-lookup"><span data-stu-id="f7408-352">However, the `AffectedRows` property is not set by the ObjectDataSource and therefore this step is omitted.</span></span> <span data-ttu-id="f7408-353">Jednym ze sposobów wykonania tego kroku jest ręczne ustawienie właściwości `AffectedRows`, jeśli operacja usuwania zostanie zakończona pomyślnie.</span><span class="sxs-lookup"><span data-stu-id="f7408-353">One way to have this step executed is to manually set the `AffectedRows` property if the delete operation completes successfully.</span></span> <span data-ttu-id="f7408-354">Można to zrobić przy użyciu kodu, takiego jak następujące:</span><span class="sxs-lookup"><span data-stu-id="f7408-354">This can be accomplished using code like the following:</span></span>

[!code-csharp[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample12.cs)]

<span data-ttu-id="f7408-355">Kod dla obu tych programów obsługi zdarzeń można znaleźć w klasie związanej z kodem `EfficientPaging.aspx` przykładu.</span><span class="sxs-lookup"><span data-stu-id="f7408-355">The code for both of these events handlers can be found in code-behind class of the `EfficientPaging.aspx` example.</span></span>

## <a name="comparing-the-performance-of-default-and-custom-paging"></a><span data-ttu-id="f7408-356">Porównywanie wydajności domyślnego i niestandardowego stronicowania</span><span class="sxs-lookup"><span data-stu-id="f7408-356">Comparing the Performance of Default and Custom Paging</span></span>

<span data-ttu-id="f7408-357">Ponieważ stronicowanie niestandardowe pobiera tylko niezbędne rekordy, natomiast domyślne stronicowanie zwraca *wszystkie* rekordy dla każdej przeglądanej strony, co oznacza, że niestandardowe stronicowanie jest bardziej wydajne niż domyślne stronicowanie.</span><span class="sxs-lookup"><span data-stu-id="f7408-357">Since custom paging only retrieves the needed records, whereas default paging returns *all* of the records for each page being viewed, it s clear that custom paging is more efficient than default paging.</span></span> <span data-ttu-id="f7408-358">Ale tylko wtedy, gdy jest to niestandardowe stronicowanie?</span><span class="sxs-lookup"><span data-stu-id="f7408-358">But just how much more efficient is custom paging?</span></span> <span data-ttu-id="f7408-359">Jakiego rodzaju zyski wydajności mogą być widoczne przez przechodzenie z domyślnego stronicowania do niestandardowego stronicowania?</span><span class="sxs-lookup"><span data-stu-id="f7408-359">What sort of performance gains can be seen by moving from default paging to custom paging?</span></span>

<span data-ttu-id="f7408-360">Niestety, żadna odpowiedź nie pasuje do żadnej z nich.</span><span class="sxs-lookup"><span data-stu-id="f7408-360">Unfortunately, there s no one size fits all answer here.</span></span> <span data-ttu-id="f7408-361">Wzrost wydajności zależy od wielu czynników, a najprawdopodobniej dwie to liczba rekordów, które są umieszczane w stronicowaniu, a obciążenie umieszczone na serwerze bazy danych i kanałach komunikacji między serwerem sieci Web a serwerem baz danych.</span><span class="sxs-lookup"><span data-stu-id="f7408-361">The performance gain depends on a number of factors, the most prominent two being the number of records being paged through and the load placed on the database server and communication channels between the web server and database server.</span></span> <span data-ttu-id="f7408-362">W przypadku małych tabel zawierających zaledwie kilka dziesiątych rekordów różnica wydajności może być niewielka.</span><span class="sxs-lookup"><span data-stu-id="f7408-362">For small tables with just a few dozen records, the performance difference may be negligible.</span></span> <span data-ttu-id="f7408-363">W przypadku dużych tabel, w przypadku tysięcy do setek tysięcy wierszy, różnica wydajności jest ostra.</span><span class="sxs-lookup"><span data-stu-id="f7408-363">For large tables, with thousands to hundreds of thousands of rows, though, the performance difference is acute.</span></span>

<span data-ttu-id="f7408-364">Artykuł kopalni, [niestandardowe stronicowanie w ASP.NET 2,0 z SQL Server 2005](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx), zawiera pewne testy wydajności, które zostały uruchomione, aby wyróżnić różnice wydajności między tymi dwiema technikami stronicowania podczas stronicowania za pomocą tabeli bazy danych z 50 000 rekordy.</span><span class="sxs-lookup"><span data-stu-id="f7408-364">An article of mine, [Custom Paging in ASP.NET 2.0 with SQL Server 2005](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx), contains some performance tests I ran to exhibit the differences in performance between these two paging techniques when paging through a database table with 50,000 records.</span></span> <span data-ttu-id="f7408-365">W tych testach przebadałem czas wykonywania zapytania na poziomie SQL Server (za pomocą [programu SQL Profiler](https://msdn.microsoft.com/library/ms173757.aspx)) i na stronie ASP.NET przy użyciu [funkcji śledzenia ASP.NET s](https://msdn.microsoft.com/library/y13fw6we.aspx).</span><span class="sxs-lookup"><span data-stu-id="f7408-365">In these tests I examined both the time to execute the query at the SQL Server level (using [SQL Profiler](https://msdn.microsoft.com/library/ms173757.aspx)) and at the ASP.NET page using [ASP.NET s tracing features](https://msdn.microsoft.com/library/y13fw6we.aspx).</span></span> <span data-ttu-id="f7408-366">Należy pamiętać, że te testy zostały uruchomione w moim pudełku deweloperskim z pojedynczym aktywnym użytkownikiem i dlatego są nienaukowe i nie są naśladować typowych wzorców obciążenia witryny sieci Web.</span><span class="sxs-lookup"><span data-stu-id="f7408-366">Keep in mind that these tests were run on my development box with a single active user, and therefore are unscientific and do not mimic typical website load patterns.</span></span> <span data-ttu-id="f7408-367">Niezależnie od tego wyniki ilustrują względne różnice w czasie wykonywania dla domyślnego i niestandardowego stronicowania podczas pracy z dostatecznie dużymi ilościami danych.</span><span class="sxs-lookup"><span data-stu-id="f7408-367">Regardless, the results illustrate the relative differences in execution time for default and custom paging when working with sufficiently large amounts of data.</span></span>

|  | <span data-ttu-id="f7408-368">**Średni czas trwania (s)**</span><span class="sxs-lookup"><span data-stu-id="f7408-368">**Avg. Duration (sec)**</span></span> | <span data-ttu-id="f7408-369">**Odczytywan**</span><span class="sxs-lookup"><span data-stu-id="f7408-369">**Reads**</span></span> |
| --- | --- | --- |
| <span data-ttu-id="f7408-370">**Domyślny Profiler SQL stronicowania**</span><span class="sxs-lookup"><span data-stu-id="f7408-370">**Default Paging SQL Profiler**</span></span> | <span data-ttu-id="f7408-371">1,411</span><span class="sxs-lookup"><span data-stu-id="f7408-371">1.411</span></span> | <span data-ttu-id="f7408-372">383</span><span class="sxs-lookup"><span data-stu-id="f7408-372">383</span></span> |
| <span data-ttu-id="f7408-373">**Profiler SQL stronicowania niestandardowego**</span><span class="sxs-lookup"><span data-stu-id="f7408-373">**Custom Paging SQL Profiler**</span></span> | <span data-ttu-id="f7408-374">0,002</span><span class="sxs-lookup"><span data-stu-id="f7408-374">0.002</span></span> | <span data-ttu-id="f7408-375">dnia</span><span class="sxs-lookup"><span data-stu-id="f7408-375">29</span></span> |
| <span data-ttu-id="f7408-376">**Domyślny ślad ASP.NET stronicowania**</span><span class="sxs-lookup"><span data-stu-id="f7408-376">**Default Paging ASP.NET Trace**</span></span> | <span data-ttu-id="f7408-377">2,379</span><span class="sxs-lookup"><span data-stu-id="f7408-377">2.379</span></span> | <span data-ttu-id="f7408-378">*NIE DOTYCZY*</span><span class="sxs-lookup"><span data-stu-id="f7408-378">*N/A*</span></span> |
| <span data-ttu-id="f7408-379">**Niestandardowe stronicowanie ASP.NET śledzenia**</span><span class="sxs-lookup"><span data-stu-id="f7408-379">**Custom Paging ASP.NET Trace**</span></span> | <span data-ttu-id="f7408-380">0,029</span><span class="sxs-lookup"><span data-stu-id="f7408-380">0.029</span></span> | <span data-ttu-id="f7408-381">*NIE DOTYCZY*</span><span class="sxs-lookup"><span data-stu-id="f7408-381">*N/A*</span></span> |

<span data-ttu-id="f7408-382">Jak widać, pobieranie określonej strony danych wymaga 354 mniej odczytów średnio i zakończonych w części czasu.</span><span class="sxs-lookup"><span data-stu-id="f7408-382">As you can see, retrieving a particular page of data required 354 less reads on average and completed in a fraction of the time.</span></span> <span data-ttu-id="f7408-383">Na stronie ASP.NET niestandardowa strona była w stanie renderować w pobliżu o 1/100% czasu, jaki zajęło<sup>Korzystanie z domyślnego</sup> stronicowania.</span><span class="sxs-lookup"><span data-stu-id="f7408-383">At the ASP.NET page, custom the page was able to render in close to 1/100<sup>th</sup> of the time it took when using default paging.</span></span> <span data-ttu-id="f7408-384">Zobacz [mój artykuł](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx) , aby uzyskać więcej informacji na temat tych wyników wraz z kodem i bazą danych, którą można pobrać, aby odtworzyć te testy w Twoim środowisku.</span><span class="sxs-lookup"><span data-stu-id="f7408-384">See [my article](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx) for more information on these results along with code and a database you can download to reproduce these tests in your own environment.</span></span>

## <a name="summary"></a><span data-ttu-id="f7408-385">Podsumowanie</span><span class="sxs-lookup"><span data-stu-id="f7408-385">Summary</span></span>

<span data-ttu-id="f7408-386">Domyślne stronicowanie to cinch do wdrożenia po prostu zaznacz pole wyboru Włącz stronicowanie w tagu inteligentnym formant sieci Web danych, ale taka prostota ma koszt wydajności.</span><span class="sxs-lookup"><span data-stu-id="f7408-386">Default paging is a cinch to implement just check the Enable Paging checkbox in the data Web control s smart tag but such simplicity comes at the cost of performance.</span></span> <span data-ttu-id="f7408-387">Za pomocą domyślnego stronicowania, gdy użytkownik zażąda dowolnej strony danych, *wszystkie* rekordy są zwracane, nawet jeśli można pokazać tylko niewielki ułamek.</span><span class="sxs-lookup"><span data-stu-id="f7408-387">With default paging, when a user requests any page of data *all* records are returned, even though only a tiny fraction of them may be shown.</span></span> <span data-ttu-id="f7408-388">Aby zwalczać ten koszt wydajności, element ObjectDataSource oferuje alternatywne niestandardowe stronicowanie opcji stronicowania.</span><span class="sxs-lookup"><span data-stu-id="f7408-388">To combat this performance overhead, the ObjectDataSource offers an alternative paging option custom paging.</span></span>

<span data-ttu-id="f7408-389">Chociaż niestandardowe stronicowanie zwiększa się w przypadku domyślnych problemów z wydajnością stronicowania, pobierając tylko te rekordy, które mają być wyświetlane, to nie jest więcej związane z implementacją niestandardowego stronicowania.</span><span class="sxs-lookup"><span data-stu-id="f7408-389">While custom paging improves upon default paging s performance issues by retrieving only those records that need to be displayed, it s more involved to implement custom paging.</span></span> <span data-ttu-id="f7408-390">Najpierw należy napisać zapytanie, które poprawnie (i efektywnie) uzyskuje dostęp do określonego podzestawu żądanych rekordów.</span><span class="sxs-lookup"><span data-stu-id="f7408-390">First, a query must be written that correctly (and efficiently) accesses the specific subset of records requested.</span></span> <span data-ttu-id="f7408-391">Można to zrobić na wiele sposobów. Ten samouczek został sprawdzony w tym samouczku, aby użyć SQL Server 2005 s nowej funkcji `ROW_NUMBER()` do określania rangi wyników, a następnie zwrócenia tylko tych wyników, których klasyfikacja mieści się w określonym zakresie.</span><span class="sxs-lookup"><span data-stu-id="f7408-391">This can be accomplished in a number of ways; the one we examined in this tutorial is to use SQL Server 2005 s new `ROW_NUMBER()` function to rank results, and then to return just those results whose ranking falls within a specified range.</span></span> <span data-ttu-id="f7408-392">Ponadto musimy dodać metodę, aby określić łączną liczbę rekordów, które są stronicowane.</span><span class="sxs-lookup"><span data-stu-id="f7408-392">Furthermore, we need to add a means to determine the total number of records being paged through.</span></span> <span data-ttu-id="f7408-393">Po utworzeniu tych metod DAL i LOGIKI biznesowej należy również skonfigurować element ObjectDataSource, aby można było określić, ile łącznych rekordów jest stronicowanych, i można prawidłowo przekazać indeks wierszy początkowych i wartości maksymalne wierszy do LOGIKI biznesowej.</span><span class="sxs-lookup"><span data-stu-id="f7408-393">After creating these DAL and BLL methods, we also need to configure the ObjectDataSource so that it can determine how many total records are being paged through and can correctly pass the Start Row Index and Maximum Rows values to the BLL.</span></span>

<span data-ttu-id="f7408-394">Podczas implementowania niestandardowego stronicowania jest wymagane wykonanie kilku kroków i nie jest niemal proste jako stronicowanie domyślne, niestandardowe stronicowanie jest konieczność podczas stronicowania za pomocą wystarczająco dużych ilości danych.</span><span class="sxs-lookup"><span data-stu-id="f7408-394">While implementing custom paging does require a number of steps and is not nearly as simple as default paging, custom paging is a necessity when paging through sufficiently large amounts of data.</span></span> <span data-ttu-id="f7408-395">W miarę jak pokazano, niestandardowe stronicowanie może wychodzić kilka sekund od czasu renderowania strony ASP.NET i zwiększyć obciążenie serwera bazy danych o jedną rudy większej liczby zamówień.</span><span class="sxs-lookup"><span data-stu-id="f7408-395">As the results examined showed, custom paging can shed seconds off of the ASP.NET page render time and can lighten the load on the database server by one ore more orders of magnitude.</span></span>

<span data-ttu-id="f7408-396">Szczęśliwe programowanie!</span><span class="sxs-lookup"><span data-stu-id="f7408-396">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="f7408-397">Informacje o autorze</span><span class="sxs-lookup"><span data-stu-id="f7408-397">About the Author</span></span>

<span data-ttu-id="f7408-398">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor siedmiu grup ASP/ASP. NET Books i założyciel of [4GuysFromRolla.com](http://www.4guysfromrolla.com), pracował z technologiami sieci Web firmy Microsoft od czasu 1998.</span><span class="sxs-lookup"><span data-stu-id="f7408-398">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="f7408-399">Scott działa jako niezależny konsultant, trainer i składnik zapisywania.</span><span class="sxs-lookup"><span data-stu-id="f7408-399">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="f7408-400">Jego Najnowsza książka to [*Sams ASP.NET 2,0 w ciągu 24 godzin*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="f7408-400">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="f7408-401">Można go osiągnąć w [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="f7408-401">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="f7408-402">lub za pośrednictwem swojego blogu, który można znaleźć w [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="f7408-402">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="f7408-403">[Poprzednie](paging-and-sorting-report-data-cs.md)
> [dalej](sorting-custom-paged-data-cs.md)</span><span class="sxs-lookup"><span data-stu-id="f7408-403">[Previous](paging-and-sorting-report-data-cs.md)
[Next](sorting-custom-paged-data-cs.md)</span></span>
