---
uid: web-forms/overview/data-access/paging-and-sorting/efficiently-paging-through-large-amounts-of-data-vb
title: Efektywne stronicowanie dużych ilości danych (VB) | Dokumentacja firmy Microsoft
author: rick-anderson
description: Domyślna opcja stronicowania kontrolki prezentacji danych jest nieodpowiednia, podczas pracy z dużymi ilościami danych, jako jego podstawowy pobierania kontroli źródła danych...
ms.author: riande
ms.date: 08/15/2006
ms.assetid: 3e20e64a-8808-4b49-88d6-014e2629d56f
msc.legacyurl: /web-forms/overview/data-access/paging-and-sorting/efficiently-paging-through-large-amounts-of-data-vb
msc.type: authoredcontent
ms.openlocfilehash: 5870b9ac2af7d9df927edd8230334dee4885c6a1
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 03/01/2019
ms.locfileid: "57075689"
---
<a name="efficiently-paging-through-large-amounts-of-data-vb"></a><span data-ttu-id="5a489-103">Efektywne stronicowanie dużych ilości danych (VB)</span><span class="sxs-lookup"><span data-stu-id="5a489-103">Efficiently Paging Through Large Amounts of Data (VB)</span></span>
====================
<span data-ttu-id="5a489-104">przez [Bento Scott](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="5a489-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="5a489-105">[Pobierz przykładową aplikację](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_25_VB.exe) lub [Pobierz plik PDF](efficiently-paging-through-large-amounts-of-data-vb/_static/datatutorial25vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="5a489-105">[Download Sample App](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_25_VB.exe) or [Download PDF](efficiently-paging-through-large-amounts-of-data-vb/_static/datatutorial25vb1.pdf)</span></span>

> <span data-ttu-id="5a489-106">Domyślna opcja stronicowania kontrolki prezentacji danych nie nadaje się podczas pracy z dużymi ilościami danych, zgodnie z jego podstawowej kontroli źródła danych pobiera wszystkie rekordy, mimo że jest wyświetlany tylko podzestaw danych.</span><span class="sxs-lookup"><span data-stu-id="5a489-106">The default paging option of a data presentation control is unsuitable when working with large amounts of data, as its underlying data source control retrieves all records, even though only a subset of data is displayed.</span></span> <span data-ttu-id="5a489-107">W takiej sytuacji firma Microsoft musi włączyć z niestandardowymi stronicowania.</span><span class="sxs-lookup"><span data-stu-id="5a489-107">In such circumstances, we must turn to custom paging.</span></span>


## <a name="introduction"></a><span data-ttu-id="5a489-108">Wprowadzenie</span><span class="sxs-lookup"><span data-stu-id="5a489-108">Introduction</span></span>

<span data-ttu-id="5a489-109">Tak jak Omówiliśmy to w poprzednim samouczku, można zaimplementować stronicowania w jeden z dwóch sposobów:</span><span class="sxs-lookup"><span data-stu-id="5a489-109">As we discussed in the preceding tutorial, paging can be implemented in one of two ways:</span></span>

- <span data-ttu-id="5a489-110">**Domyślne stronicowania** można zaimplementować po prostu, zaznaczając opcję włączenia stronicowania danych formantu sieci Web s tagów inteligentnych; jednak zawsze wtedy, gdy wyświetlania strony danych, pobiera kontrolki ObjectDataSource *wszystkich* rekordów, nawet Mimo że tylko część z nich są wyświetlane na stronie</span><span class="sxs-lookup"><span data-stu-id="5a489-110">**Default Paging** can be implemented by simply checking the Enable Paging option in the data Web control s smart tag; however, whenever viewing a page of data, the ObjectDataSource retrieves *all* of the records, even though only a subset of them are displayed in the page</span></span>
- <span data-ttu-id="5a489-111">**Niestandardowe stronicowania** poprawia wydajność domyślna stronicowania przez pobieranie tylko te rekordy z bazy danych, która należy do wyświetlenia określonej strony danych wymaganych przez użytkownika; jednak stronicowania niestandardowego wymaga nieco więcej pracy w celu zaimplementowania niż domyślna stronicowania</span><span class="sxs-lookup"><span data-stu-id="5a489-111">**Custom Paging** improves the performance of default paging by retrieving only those records from the database that need to be displayed for the particular page of data requested by the user; however, custom paging involves a bit more effort to implement than default paging</span></span>

<span data-ttu-id="5a489-112">Ze względu na łatwość implementacji wyboru tylko pola wyboru i ponownie gotowe!</span><span class="sxs-lookup"><span data-stu-id="5a489-112">Due to the ease of implementation just check a checkbox and you re done!</span></span> <span data-ttu-id="5a489-113">stronicowanie domyślny jest atrakcyjną opcję.</span><span class="sxs-lookup"><span data-stu-id="5a489-113">default paging is an attractive option.</span></span> <span data-ttu-id="5a489-114">Jej podejście ve na podczas pobierania wszystkich rekordów, jednak sprawia, że wybór nieprzekonywających podczas stronicowanie wystarczająco duże ilości danych lub dla witryn z wieloma równoczesnymi użytkownikami.</span><span class="sxs-lookup"><span data-stu-id="5a489-114">Its na�ve approach in retrieving all of the records, though, makes it an implausible choice when paging through sufficiently large amounts of data or for sites with many concurrent users.</span></span> <span data-ttu-id="5a489-115">W takiej sytuacji firma Microsoft należy go włączyć z niestandardowymi stronicowania w celu zapewnienia elastyczny system.</span><span class="sxs-lookup"><span data-stu-id="5a489-115">In such circumstances, we must turn to custom paging in order to provide a responsive system.</span></span>

<span data-ttu-id="5a489-116">Wyzwanie stronicowania niestandardowego jest możliwość Napisz zapytanie, które zwraca dokładny zestaw rekordów niezbędnych dla określonej strony danych.</span><span class="sxs-lookup"><span data-stu-id="5a489-116">The challenge of custom paging is being able to write a query that returns the precise set of records needed for a particular page of data.</span></span> <span data-ttu-id="5a489-117">Na szczęście usługa Microsoft SQL Server 2005 zapewnia nowe słowo kluczowe wyniki klasyfikacji, który pozwala nam napisać zapytanie, które pozwala na efektywne pobieranie odpowiednie podzestaw rekordów.</span><span class="sxs-lookup"><span data-stu-id="5a489-117">Fortunately, Microsoft SQL Server 2005 provides a new keyword for ranking results, which enables us to write a query that can efficiently retrieve the proper subset of records.</span></span> <span data-ttu-id="5a489-118">W tym samouczku Zobaczymy się, jak zaimplementować niestandardowy stronicowania w kontrolce GridView za pomocą tego nowego słowa kluczowego SQL Server 2005.</span><span class="sxs-lookup"><span data-stu-id="5a489-118">In this tutorial we'll see how to use this new SQL Server 2005 keyword to implement custom paging in a GridView control.</span></span> <span data-ttu-id="5a489-119">Interfejs użytkownika dla niestandardowych stronicowania jest identyczna jak domyślne stronicowanie, przechodzenie z jednej strony, aby dalej korzystać stronicowania niestandardowego może być wiele rzędów szybciej niż domyślna stronicowania.</span><span class="sxs-lookup"><span data-stu-id="5a489-119">While the user interface for custom paging is identical to that for default paging, stepping from one page to the next using custom paging can be several orders of magnitude faster than default paging.</span></span>

> [!NOTE]
> <span data-ttu-id="5a489-120">Przyrost wydajności dokładnie ujawnione przez niestandardowe stronicowania zależy od łączną liczbą rekordów są stronicowane za pośrednictwem i obciążenia są umieszczone na serwerze bazy danych.</span><span class="sxs-lookup"><span data-stu-id="5a489-120">The exact performance gain exhibited by custom paging depends on the total number of records being paged through and the load being placed on the database server.</span></span> <span data-ttu-id="5a489-121">Na końcu tego samouczka rozpatrzymy niektóre nierównej metryki, które pokazują korzyści w wydajności uzyskane za pośrednictwem stronicowania niestandardowego.</span><span class="sxs-lookup"><span data-stu-id="5a489-121">At the end of this tutorial we'll look at some rough metrics that showcase the benefits in performance obtained through custom paging.</span></span>


## <a name="step-1-understanding-the-custom-paging-process"></a><span data-ttu-id="5a489-122">Krok 1. Informacje o procesie niestandardowym stronicowania</span><span class="sxs-lookup"><span data-stu-id="5a489-122">Step 1: Understanding the Custom Paging Process</span></span>

<span data-ttu-id="5a489-123">Jeśli stronicowanie danych, wyświetlanych na stronie rekordów dokładne zależą strony są żądane dane i liczba rekordów wyświetlanych na stronie.</span><span class="sxs-lookup"><span data-stu-id="5a489-123">When paging through data, the precise records displayed in a page depend upon the page of data being requested and the number of records displayed per page.</span></span> <span data-ttu-id="5a489-124">Na przykład Wyobraź sobie, że Chcieliśmy stronie za pośrednictwem 81 produktów, wyświetlając 10 produktów na stronie.</span><span class="sxs-lookup"><span data-stu-id="5a489-124">For example, imagine that we wanted to page through the 81 products, displaying 10 products per page.</span></span> <span data-ttu-id="5a489-125">Podczas wyświetlania na pierwszej stronie, d chcemy produktów od 1 do 10; Podczas wyświetlania na drugiej stronie mamy d zainteresować 11 20 za pomocą produktów i tak dalej.</span><span class="sxs-lookup"><span data-stu-id="5a489-125">When viewing the first page, we d want products 1 through 10; when viewing the second page we d be interested in products 11 through 20, and so on.</span></span>

<span data-ttu-id="5a489-126">Istnieją trzy zmienne, które wymuszają rekordy muszą być pobierane i jak ma być renderowany interfejsu stronicowania:</span><span class="sxs-lookup"><span data-stu-id="5a489-126">There are three variables that dictate what records need to be retrieved and how the paging interface should be rendered:</span></span>

- <span data-ttu-id="5a489-127">**Rozpocznij indeks wiersza** indeksu pierwszego wiersza na stronie danych do wyświetlenia; może to indeks obliczane przez pomnożenie indeks strony przez rekordów do wyświetlenia na jednej stronie i dodanie jednego.</span><span class="sxs-lookup"><span data-stu-id="5a489-127">**Start Row Index** the index of the first row in the page of data to display; this index can be calculated by multiplying the page index by the records to display per page and adding one.</span></span> <span data-ttu-id="5a489-128">Na przykład, jeśli stronicowanie rekordów 10 w czasie, dla pierwszej strony (której indeks strony wynosi 0), indeks wiersza Start wynosi 0 \* 10 + 1 lub 1; dla drugiej strony (której indeks strony wynosi 1) indeks wiersza Start jest 1 \* 10 + 1 , lub 11.</span><span class="sxs-lookup"><span data-stu-id="5a489-128">For example, when paging through records 10 at a time, for the first page (whose page index is 0), the Start Row Index is 0 \* 10 + 1, or 1; for the second page (whose page index is 1), the Start Row Index is 1 \* 10 + 1, or 11.</span></span>
- <span data-ttu-id="5a489-129">**Maksymalna liczba wierszy** maksymalną liczbę rekordów do wyświetlenia na jednej stronie.</span><span class="sxs-lookup"><span data-stu-id="5a489-129">**Maximum Rows** the maximum number of records to display per page.</span></span> <span data-ttu-id="5a489-130">Ta zmienna jest określana jako maksymalna liczba wierszy, ponieważ dla ostatniej strony może być mniejszą liczbę rekordów zwrócił niż rozmiar strony.</span><span class="sxs-lookup"><span data-stu-id="5a489-130">This variable is referred to as maximum rows since for the last page there may be fewer records returned than the page size.</span></span> <span data-ttu-id="5a489-131">Na przykład stronicowanie 81 produktów 10 rekordy na każdej stronie, dziewiąty i ostatnia strona ma tylko jeden rekord.</span><span class="sxs-lookup"><span data-stu-id="5a489-131">For example, when paging through the 81 products 10 records per page, the ninth and final page will have just one record.</span></span> <span data-ttu-id="5a489-132">Brak strony wyświetli jednak więcej rekordów niż wartość maksymalna liczba wierszy.</span><span class="sxs-lookup"><span data-stu-id="5a489-132">No page, though, will show more records than the Maximum Rows value.</span></span>
- <span data-ttu-id="5a489-133">**Łączna liczba rekordów** całkowita liczba rekordów, które są stronicowane za pośrednictwem.</span><span class="sxs-lookup"><span data-stu-id="5a489-133">**Total Record Count** the total number of records being paged through.</span></span> <span data-ttu-id="5a489-134">Podczas tego t zmiennej nie jest potrzebne do określenia rekordów do pobrania dla danej strony, jego dyktowanie interfejsu stronicowania.</span><span class="sxs-lookup"><span data-stu-id="5a489-134">While this variable isn t needed to determine what records to retrieve for a given page, it does dictate the paging interface.</span></span> <span data-ttu-id="5a489-135">Na przykład w przypadku produktów 81 są stronicowane za pośrednictwem interfejsu stronicowania wie, do wyświetlenia dziewięć numery stron w interfejsie użytkownika stronicowania.</span><span class="sxs-lookup"><span data-stu-id="5a489-135">For example, if there are 81 products being paged through, the paging interface knows to display nine page numbers in the paging UI.</span></span>

<span data-ttu-id="5a489-136">Za pomocą stronicowania domyślny indeks wiersza Start jest obliczana jako iloczyn indeks strony i rozmiar strony, oraz jedną, maksymalna liczba wierszy jest po prostu rozmiaru strony.</span><span class="sxs-lookup"><span data-stu-id="5a489-136">With default paging, the Start Row Index is computed as the product of the page index and the page size plus one, whereas the Maximum Rows is simply the page size.</span></span> <span data-ttu-id="5a489-137">Ponieważ domyślne stronicowania pobiera wszystkie rekordy z bazy danych podczas renderowania dowolnej stronie danych i indeksów dla każdego wiersza jest znany, sprawiając, że przenoszenie do wiersza Rozpocznij indeks wiersza jest prostym zadaniem.</span><span class="sxs-lookup"><span data-stu-id="5a489-137">Since default paging retrieves all of the records from the database when rendering any page of data, the index for each row is known, thereby making moving to Start Row Index row a trivial task.</span></span> <span data-ttu-id="5a489-138">Ponadto, łączna liczba rekordów jest łatwo dostępne, ponieważ s po prostu liczbę rekordów w tabeli DataTable (lub dowolnego obiektu jest używana do przechowywania wyników bazy danych).</span><span class="sxs-lookup"><span data-stu-id="5a489-138">Moreover, the Total Record Count is readily available, as it s simply the number of records in the DataTable (or whatever object is being used to hold the database results).</span></span>

<span data-ttu-id="5a489-139">Biorąc pod uwagę zmienne Rozpocznij indeks wiersza i maksymalna liczba wierszy, implementacja niestandardowa stronicowania musi zwrócić tylko dokładne podzestaw rekordów uruchomienie na indeks wiersza Start wynosi maksymalna liczba wierszy liczba rekordów po tym.</span><span class="sxs-lookup"><span data-stu-id="5a489-139">Given the Start Row Index and Maximum Rows variables, a custom paging implementation must only return the precise subset of records starting at the Start Row Index and up to Maximum Rows number of records after that.</span></span> <span data-ttu-id="5a489-140">Niestandardowe stronicowania zapewnia wyzwanie z dwóch powodów:</span><span class="sxs-lookup"><span data-stu-id="5a489-140">Custom paging provides two challenges:</span></span>

- <span data-ttu-id="5a489-141">Firma Microsoft musi być w stanie efektywnie skojarzyć indeks wiersza z każdego wiersza w wszystkie dane są stronicowane za pośrednictwem, dzięki czemu możemy rozpocząć zwracanie rekordów dla podanego indeksu Uruchom wiersz</span><span class="sxs-lookup"><span data-stu-id="5a489-141">We must be able to efficiently associate a row index with each row in the entire data being paged through so that we can start returning records at the specified Start Row Index</span></span>
- <span data-ttu-id="5a489-142">Należy podać całkowita liczba rekordów, które są stronicowane za pośrednictwem</span><span class="sxs-lookup"><span data-stu-id="5a489-142">We need to provide the total number of records being paged through</span></span>

<span data-ttu-id="5a489-143">W dwóch następnych krokach zostaną omówione skrypt SQL niezbędne do odpowiadania na tych dwóch wyzwań.</span><span class="sxs-lookup"><span data-stu-id="5a489-143">In the next two steps we'll examine the SQL script needed to respond to these two challenges.</span></span> <span data-ttu-id="5a489-144">Oprócz skrypt SQL możemy również należy implementować metody DAL i LOGIKI.</span><span class="sxs-lookup"><span data-stu-id="5a489-144">In addition to the SQL script, we'll also need to implement methods in the DAL and BLL.</span></span>

## <a name="step-2-returning-the-total-number-of-records-being-paged-through"></a><span data-ttu-id="5a489-145">Krok 2. Zwracanie całkowita liczba rekordów, które są stronicowane za pośrednictwem</span><span class="sxs-lookup"><span data-stu-id="5a489-145">Step 2: Returning the Total Number of Records Being Paged Through</span></span>

<span data-ttu-id="5a489-146">Zanim omówiony sposób pobierania dokładne podzestaw rekordów dla strony są wyświetlane, chętnie s Pierwsze spojrzenie na sposób zwracania całkowita liczba rekordów, które są stronicowane za pośrednictwem.</span><span class="sxs-lookup"><span data-stu-id="5a489-146">Before we examine how to retrieve the precise subset of records for the page being displayed, let s first look at how to return the total number of records being paged through.</span></span> <span data-ttu-id="5a489-147">Te informacje są potrzebne, aby można było prawidłowo skonfigurować interfejs użytkownika stronicowania.</span><span class="sxs-lookup"><span data-stu-id="5a489-147">This information is needed in order to properly configure the paging user interface.</span></span> <span data-ttu-id="5a489-148">Całkowita liczba rekordów zwróconych przez zapytanie SQL w szczególności można uzyskać za pomocą [ `COUNT` funkcję agregacji](https://msdn.microsoft.com/library/ms175997.aspx).</span><span class="sxs-lookup"><span data-stu-id="5a489-148">The total number of records returned by a particular SQL query can be obtained by using the [`COUNT` aggregate function](https://msdn.microsoft.com/library/ms175997.aspx).</span></span> <span data-ttu-id="5a489-149">Na przykład, aby określić, całkowita liczba rekordów w `Products` tabeli, możemy użyć następującej kwerendy:</span><span class="sxs-lookup"><span data-stu-id="5a489-149">For example, to determine the total number of records in the `Products` table, we can use the following query:</span></span>


[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-vb/samples/sample1.sql)]

<span data-ttu-id="5a489-150">Pozwól s dodać metodę do naszych DAL, która zwraca te informacje.</span><span class="sxs-lookup"><span data-stu-id="5a489-150">Let s add a method to our DAL that returns this information.</span></span> <span data-ttu-id="5a489-151">W szczególności, utworzymy warstwę DAL metodę o nazwie `TotalNumberOfProducts()` , który jest wykonywany `SELECT` instrukcji przedstawionych powyżej.</span><span class="sxs-lookup"><span data-stu-id="5a489-151">In particular, we'll create a DAL method called `TotalNumberOfProducts()` that executes the `SELECT` statement shown above.</span></span>

<span data-ttu-id="5a489-152">Zacznij od otwarcia `Northwind.xsd` wpisane plik zestawu danych w `App_Code/DAL` folderu.</span><span class="sxs-lookup"><span data-stu-id="5a489-152">Start by opening the `Northwind.xsd` Typed DataSet file in the `App_Code/DAL` folder.</span></span> <span data-ttu-id="5a489-153">Następnie kliknij prawym przyciskiem myszy `ProductsTableAdapter` w Projektancie i wybierz polecenie Dodaj zapytanie.</span><span class="sxs-lookup"><span data-stu-id="5a489-153">Next, right-click on the `ProductsTableAdapter` in the Designer and choose Add Query.</span></span> <span data-ttu-id="5a489-154">Ponieważ ve w poprzednich samouczkach to umożliwi nam Dodaj nową metodę z warstwą dal, po wywołaniu, wykona określoną instrukcję SQL lub procedury składowanej.</span><span class="sxs-lookup"><span data-stu-id="5a489-154">As we ve seen in previous tutorials, this will allow us to add a new method to the DAL that, when invoked, will execute a particular SQL statement or stored procedure.</span></span> <span data-ttu-id="5a489-155">Podobnie jak w przypadku naszej metody TableAdapter w poprzednich samouczkach, ten jeden zdecydować się na używanie instrukcji SQL zapytań ad-hoc.</span><span class="sxs-lookup"><span data-stu-id="5a489-155">As with our TableAdapter methods in previous tutorials, for this one opt to use an ad-hoc SQL statement.</span></span>


![Używanie instrukcji SQL zapytań Ad-Hoc](efficiently-paging-through-large-amounts-of-data-vb/_static/image1.png)

<span data-ttu-id="5a489-157">**Rysunek 1**: Używanie instrukcji SQL zapytań Ad-Hoc</span><span class="sxs-lookup"><span data-stu-id="5a489-157">**Figure 1**: Use an Ad-Hoc SQL Statement</span></span>


<span data-ttu-id="5a489-158">Na następnym ekranie możemy określić, jakiego rodzaju zapytanie w celu utworzenia.</span><span class="sxs-lookup"><span data-stu-id="5a489-158">On the next screen we can specify what type of query to create.</span></span> <span data-ttu-id="5a489-159">Ponieważ to zapytanie będzie zwracać wartość pojedynczą, skalarną, całkowita liczba rekordów w `Products` wybierz tabelę `SELECT` zwraca opcję wartość wystąpieniu.</span><span class="sxs-lookup"><span data-stu-id="5a489-159">Since this query will return a single, scalar value the total number of records in the `Products` table choose the `SELECT` which returns a singe value option.</span></span>


![Konfigurowanie zapytania, aby użyć instrukcji SELECT, która zwraca pojedynczą wartość](efficiently-paging-through-large-amounts-of-data-vb/_static/image2.png)

<span data-ttu-id="5a489-161">**Rysunek 2**: Konfigurowanie zapytania, aby użyć instrukcji SELECT, która zwraca pojedynczą wartość</span><span class="sxs-lookup"><span data-stu-id="5a489-161">**Figure 2**: Configure the Query to Use a SELECT Statement that Returns a Single Value</span></span>


<span data-ttu-id="5a489-162">Po wskazujący typ zapytanie do użycia, możemy następnie określ zapytanie.</span><span class="sxs-lookup"><span data-stu-id="5a489-162">After indicating the type of query to use, we must next specify the query.</span></span>


![Użyj wybierz COUNT(\*) z kwerendy produktów](efficiently-paging-through-large-amounts-of-data-vb/_static/image3.png)

<span data-ttu-id="5a489-164">**Rysunek 3**: Użyj wybierz liczby (\*) FROM produktów zapytania</span><span class="sxs-lookup"><span data-stu-id="5a489-164">**Figure 3**: Use the SELECT COUNT(\*) FROM Products Query</span></span>


<span data-ttu-id="5a489-165">Na koniec należy określić nazwę metody.</span><span class="sxs-lookup"><span data-stu-id="5a489-165">Finally, specify the name for the method.</span></span> <span data-ttu-id="5a489-166">Jak wyżej, pozwól s Użyj `TotalNumberOfProducts`.</span><span class="sxs-lookup"><span data-stu-id="5a489-166">As aforementioned, let s use `TotalNumberOfProducts`.</span></span>


![Nadaj nazwę TotalNumberOfProducts DAL — metoda](efficiently-paging-through-large-amounts-of-data-vb/_static/image4.png)

<span data-ttu-id="5a489-168">**Rysunek 4**: Nadaj nazwę TotalNumberOfProducts DAL — metoda</span><span class="sxs-lookup"><span data-stu-id="5a489-168">**Figure 4**: Name the DAL Method TotalNumberOfProducts</span></span>


<span data-ttu-id="5a489-169">Po kliknięciu przycisku Zakończ, Kreator doda `TotalNumberOfProducts` metody z warstwą dal.</span><span class="sxs-lookup"><span data-stu-id="5a489-169">After clicking Finish, the wizard will add the `TotalNumberOfProducts` method to the DAL.</span></span> <span data-ttu-id="5a489-170">Skalarna zwracanych metody w warstwy DAL zwracają typy dopuszczające wartości null, w przypadku, gdy wynikiem zapytania SQL, który jest `NULL`.</span><span class="sxs-lookup"><span data-stu-id="5a489-170">The scalar returning methods in the DAL return nullable types, in case the result from the SQL query is `NULL`.</span></span> <span data-ttu-id="5a489-171">Nasze `COUNT` kwerendy, jednak zawsze zwróci innej niż`NULL` wartość; niezależnie od tego, metoda DAL zwraca liczbę całkowitą typu dopuszczającego wartość null.</span><span class="sxs-lookup"><span data-stu-id="5a489-171">Our `COUNT` query, however, will always return a non-`NULL` value; regardless, the DAL method returns a nullable integer.</span></span>

<span data-ttu-id="5a489-172">Oprócz metody DAL również należy do metody w LOGIKI.</span><span class="sxs-lookup"><span data-stu-id="5a489-172">In addition to the DAL method, we also need a method in the BLL.</span></span> <span data-ttu-id="5a489-173">Otwórz `ProductsBLL` klasy plików i Dodaj `TotalNumberOfProducts` metodę, która po prostu wywołuje Widok s DAL `TotalNumberOfProducts` metody:</span><span class="sxs-lookup"><span data-stu-id="5a489-173">Open the `ProductsBLL` class file and add a `TotalNumberOfProducts` method that simply calls down to the DAL s `TotalNumberOfProducts` method:</span></span>


[!code-vb[Main](efficiently-paging-through-large-amounts-of-data-vb/samples/sample2.vb)]

<span data-ttu-id="5a489-174">DAL s `TotalNumberOfProducts` metoda zwraca liczbę całkowitą typu dopuszczającego wartość null; Jednakże, firma Microsoft ve utworzone `ProductsBLL` klasy s `TotalNumberOfProducts` metodę, tak że zwraca standardowy liczbę całkowitą.</span><span class="sxs-lookup"><span data-stu-id="5a489-174">The DAL s `TotalNumberOfProducts` method returns a nullable integer; however, we ve created the `ProductsBLL` class s `TotalNumberOfProducts` method so that it returns a standard integer.</span></span> <span data-ttu-id="5a489-175">Dlatego musimy mieć `ProductsBLL` klasy s `TotalNumberOfProducts` część wartości liczby całkowitej dopuszczającego wartość null, zwracany przez DAL s zwracany przez metodę `TotalNumberOfProducts` metody.</span><span class="sxs-lookup"><span data-stu-id="5a489-175">Therefore, we need to have the `ProductsBLL` class s `TotalNumberOfProducts` method return the value portion of the nullable integer returned by the DAL s `TotalNumberOfProducts` method.</span></span> <span data-ttu-id="5a489-176">Wywołanie `GetValueOrDefault()` zwraca wartość całkowitą dopuszczającego wartość null, jeśli istnieje; Jeśli nullable liczba całkowita jest `null`, jednak funkcja zwraca wartość całkowitą domyślna to 0.</span><span class="sxs-lookup"><span data-stu-id="5a489-176">The call to `GetValueOrDefault()` returns the value of the nullable integer, if it exists; if the nullable integer is `null`, however, it returns the default integer value, 0.</span></span>

## <a name="step-3-returning-the-precise-subset-of-records"></a><span data-ttu-id="5a489-177">Krok 3. Zwracanie podzbioru dokładne rekordów</span><span class="sxs-lookup"><span data-stu-id="5a489-177">Step 3: Returning the Precise Subset of Records</span></span>

<span data-ttu-id="5a489-178">Naszym kolejnym krokiem jest utworzenie metody DAL i LOGIKI, które akceptują indeks wiersza Start, a maksymalna liczba wierszy zmienne omówionych powyżej i zwracają odpowiednie rekordy.</span><span class="sxs-lookup"><span data-stu-id="5a489-178">Our next task is to create methods in the DAL and BLL that accept the Start Row Index and Maximum Rows variables discussed earlier and return the appropriate records.</span></span> <span data-ttu-id="5a489-179">Zanim do tego, umożliwiają s najpierw Przyjrzyj się potrzebne skryptu SQL.</span><span class="sxs-lookup"><span data-stu-id="5a489-179">Before we do that, let s first look at the needed SQL script.</span></span> <span data-ttu-id="5a489-180">Żądanie połączonego z nami to, że firma Microsoft musi być w stanie efektywnie przypisać indeksu do każdego wiersza w całej wyniki są stronicowane za pośrednictwem tak, aby firma Microsoft może zwracać tylko te rekordy, uruchomienie na indeks wiersza Start (maksymalnie rekordów maksymalną liczbę rekordów).</span><span class="sxs-lookup"><span data-stu-id="5a489-180">The challenge facing us is that we must be able to efficiently assign an index to each row in the entire results being paged through so that we can return just those records starting at the Start Row Index (and up to the Maximum Records number of records).</span></span>

<span data-ttu-id="5a489-181">To nie jest trudne, jeśli istnieje już kolumna w tabeli bazy danych, która służy jako indeks wiersza.</span><span class="sxs-lookup"><span data-stu-id="5a489-181">This is not a challenge if there is already a column in the database table that serves as a row index.</span></span> <span data-ttu-id="5a489-182">Na pierwszy rzut oka może uważamy, że `Products` tabeli s `ProductID` pola będą wystarczające jako pierwszy produkt ma `ProductID` 1, drugi 2, i tak dalej.</span><span class="sxs-lookup"><span data-stu-id="5a489-182">At first glance we might think that the `Products` table s `ProductID` field would suffice, as the first product has `ProductID` of 1, the second a 2, and so on.</span></span> <span data-ttu-id="5a489-183">Jednak usunięcie produktu pozostawia przerwy w sekwencji, rozpoczynającą tego podejścia.</span><span class="sxs-lookup"><span data-stu-id="5a489-183">However, deleting a product leaves a gap in the sequence, nullifying this approach.</span></span>

<span data-ttu-id="5a489-184">Istnieją dwie techniki ogólne używane do wydajnego kojarzenia indeks wiersza z danymi do przeglądania, umożliwiając w ten sposób dokładne podzestaw rekordów do pobrania:</span><span class="sxs-lookup"><span data-stu-id="5a489-184">There are two general techniques used to efficiently associate a row index with the data to page through, thereby enabling the precise subset of records to be retrieved:</span></span>

- <span data-ttu-id="5a489-185">**Za pomocą programu SQL Server 2005 s `ROW_NUMBER()` — słowo kluczowe** jesteś nowym użytkownikiem programu SQL Server 2005, `ROW_NUMBER()` — słowo kluczowe kojarzy klasyfikacji z każdego rekordu zwrócone według kolejności.</span><span class="sxs-lookup"><span data-stu-id="5a489-185">**Using SQL Server 2005 s `ROW_NUMBER()` Keyword** new to SQL Server 2005, the `ROW_NUMBER()` keyword associates a ranking with each returned record based on some ordering.</span></span> <span data-ttu-id="5a489-186">Ta klasyfikacja może służyć jako indeks wiersza dla każdego wiersza.</span><span class="sxs-lookup"><span data-stu-id="5a489-186">This ranking can be used as a row index for each row.</span></span>
- <span data-ttu-id="5a489-187">**Za pomocą zmiennej tabeli i `SET ROWCOUNT`**  programu SQL Server [ `SET ROWCOUNT` instrukcji](https://msdn.microsoft.com/library/ms188774.aspx) może służyć do określenia, ile łącznie rekordów zapytanie ma być przetwarzana przed przerwaniem; [tabeli zmienne](http://www.sqlteam.com/item.asp?ItemID=9454) są zmienne lokalne języka T-SQL, które mogą zawierać dane tabelaryczne akin do [tabele tymczasowe](http://www.sqlteam.com/item.asp?ItemID=2029).</span><span class="sxs-lookup"><span data-stu-id="5a489-187">**Using a Table Variable and `SET ROWCOUNT`** SQL Server s [`SET ROWCOUNT` statement](https://msdn.microsoft.com/library/ms188774.aspx) can be used to specify how many total records a query should process before terminating; [table variables](http://www.sqlteam.com/item.asp?ItemID=9454) are local T-SQL variables that can hold tabular data, akin to [temporary tables](http://www.sqlteam.com/item.asp?ItemID=2029).</span></span> <span data-ttu-id="5a489-188">Ta metoda działa równie dobrze z programu Microsoft SQL Server 2005 i SQL Server 2000 (natomiast `ROW_NUMBER()` podejście działa tylko w przypadku programu SQL Server 2005).</span><span class="sxs-lookup"><span data-stu-id="5a489-188">This approach works equally well with both Microsoft SQL Server 2005 and SQL Server 2000 (whereas the `ROW_NUMBER()` approach only works with SQL Server 2005).</span></span>  
  
  <span data-ttu-id="5a489-189">W tym miejscu chodzi o to, aby utworzyć zmienną tabeli, która ma `IDENTITY` kolumny i kolumny kluczy podstawowych w tabeli, którego dane są są stronicowane za pośrednictwem.</span><span class="sxs-lookup"><span data-stu-id="5a489-189">The idea here is to create a table variable that has an `IDENTITY` column and columns for the primary keys of the table whose data is being paged through.</span></span> <span data-ttu-id="5a489-190">Następnie zawartość tabeli, którego dane są są stronicowane za pośrednictwem jest zrzucany do zmiennej tabeli, w tym samym kojarzenie indeks wiersza sekwencyjnego (za pośrednictwem `IDENTITY` kolumny) dla każdego rekordu w tabeli.</span><span class="sxs-lookup"><span data-stu-id="5a489-190">Next, the contents of the table whose data is being paged through is dumped into the table variable, thereby associating a sequential row index (via the `IDENTITY` column) for each record in the table.</span></span> <span data-ttu-id="5a489-191">Po wprowadzeniu zmiennej tabeli `SELECT` instrukcji w zmiennej tabeli łączone z tabeli podstawowej, mogą być wykonywane na nagraniach określonych rekordów.</span><span class="sxs-lookup"><span data-stu-id="5a489-191">Once the table variable has been populated, a `SELECT` statement on the table variable, joined with the underlying table, can be executed to pull out the particular records.</span></span> <span data-ttu-id="5a489-192">`SET ROWCOUNT` Instrukcja jest używane do inteligentnie Ogranicz liczbę rekordów, które trzeba można utworzyć zrzutu do zmiennej tabeli.</span><span class="sxs-lookup"><span data-stu-id="5a489-192">The `SET ROWCOUNT` statement is used to intelligently limit the number of records that need to be dumped into the table variable.</span></span>  
  
  <span data-ttu-id="5a489-193">Takie zwiększenie efektywności podejście s jest oparty na numer strony są żądane jako `SET ROWCOUNT` wartość jest przypisywana wartość Start indeks wiersza, a także maksymalna liczba wierszy.</span><span class="sxs-lookup"><span data-stu-id="5a489-193">This approach s efficiency is based on the page number being requested, as the `SET ROWCOUNT` value is assigned the value of Start Row Index plus the Maximum Rows.</span></span> <span data-ttu-id="5a489-194">Jeśli stronicowanie parzystym wierszom stron, takich jak pierwsze kilka stron danych to podejście jest bardzo wydajny.</span><span class="sxs-lookup"><span data-stu-id="5a489-194">When paging through low-numbered pages such as the first few pages of data this approach is very efficient.</span></span> <span data-ttu-id="5a489-195">Jednak wskazuje wydajności stronicowania przypominającej domyślne podczas pobierania strony blisko końca.</span><span class="sxs-lookup"><span data-stu-id="5a489-195">However, it exhibits default paging-like performance when retrieving a page near the end.</span></span>

<span data-ttu-id="5a489-196">W tym samouczku implementuje niestandardowe za pomocą stronicowania `ROW_NUMBER()` — słowo kluczowe.</span><span class="sxs-lookup"><span data-stu-id="5a489-196">This tutorial implements custom paging using the `ROW_NUMBER()` keyword.</span></span> <span data-ttu-id="5a489-197">Aby uzyskać więcej informacji na temat używania zmiennej tabeli i `SET ROWCOUNT` techniki, zobacz [więcej efektywną metodą stronicowanie za pośrednictwem dużych zestawów wyników](http://www.4guysfromrolla.com/webtech/042606-1.shtml).</span><span class="sxs-lookup"><span data-stu-id="5a489-197">For more information on using the table variable and `SET ROWCOUNT` technique, see [A More Efficient Method for Paging Through Large Result Sets](http://www.4guysfromrolla.com/webtech/042606-1.shtml).</span></span>

<span data-ttu-id="5a489-198">`ROW_NUMBER()` — Słowo kluczowe skojarzone klasyfikacji z każdego rekordu zwrócone w kolejności określonej przy użyciu następującej składni:</span><span class="sxs-lookup"><span data-stu-id="5a489-198">The `ROW_NUMBER()` keyword associated a ranking with each record returned over a particular ordering using the following syntax:</span></span>


[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-vb/samples/sample3.sql)]

<span data-ttu-id="5a489-199">`ROW_NUMBER()` Zwraca wartość liczbową, która określa rangę dla każdego rekordu w odniesieniu do wskazanej kolejności.</span><span class="sxs-lookup"><span data-stu-id="5a489-199">`ROW_NUMBER()` returns a numerical value that specifies the rank for each record with regards to the indicated ordering.</span></span> <span data-ttu-id="5a489-200">Na przykład aby zobaczyć rangi dla każdego produktu, uporządkowane od najbardziej kosztowne do najmniejszej, można Stosujemy następujące zapytanie:</span><span class="sxs-lookup"><span data-stu-id="5a489-200">For example, to see the rank for each product, ordered from the most expensive to the least, we could use the following query:</span></span>


[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-vb/samples/sample4.sql)]

<span data-ttu-id="5a489-201">Rysunek 5. Pokazuje to zapytanie s wyniki podczas uruchamiania w oknie zapytania w programie Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="5a489-201">Figure 5 shows this query s results when run through the query window in Visual Studio.</span></span> <span data-ttu-id="5a489-202">Należy pamiętać, że produkty są uporządkowane według ceny, wraz z rangę cena dla każdego wiersza.</span><span class="sxs-lookup"><span data-stu-id="5a489-202">Note that the products are ordered by price, along with a price rank for each row.</span></span>


![Ranga cena znajduje się dla każdego rekordu zwracane](efficiently-paging-through-large-amounts-of-data-vb/_static/image5.png)

<span data-ttu-id="5a489-204">**Rysunek 5**: Ranga cena znajduje się dla każdego rekordu zwracane</span><span class="sxs-lookup"><span data-stu-id="5a489-204">**Figure 5**: The Price Rank is Included for Each Returned Record</span></span>


> [!NOTE]
> <span data-ttu-id="5a489-205">`ROW_NUMBER()` jest tylko jeden z wielu nowych funkcji Klasyfikacja dostępnych w programie SQL Server 2005.</span><span class="sxs-lookup"><span data-stu-id="5a489-205">`ROW_NUMBER()` is just one of the many new ranking functions available in SQL Server 2005.</span></span> <span data-ttu-id="5a489-206">Aby uzyskać bardziej szczegółowe omówienie `ROW_NUMBER()`, wraz z innych funkcji Klasyfikacja, przeczytaj [zwracanie wyników randze spośród wszystkich dokumentów przy użyciu programu Microsoft SQL Server 2005](http://www.4guysfromrolla.com/webtech/010406-1.shtml).</span><span class="sxs-lookup"><span data-stu-id="5a489-206">For a more thorough discussion of `ROW_NUMBER()`, along with the other ranking functions, read [Returning Ranked Results with Microsoft SQL Server 2005](http://www.4guysfromrolla.com/webtech/010406-1.shtml).</span></span>


<span data-ttu-id="5a489-207">Gdy klasyfikacja wyniki wg określonego `ORDER BY` kolumny w `OVER` — klauzula (`UnitPrice`, w powyższym przykładzie), programu SQL Server należy sortować wyniki.</span><span class="sxs-lookup"><span data-stu-id="5a489-207">When ranking the results by the specified `ORDER BY` column in the `OVER` clause (`UnitPrice`, in the above example), SQL Server must sort the results.</span></span> <span data-ttu-id="5a489-208">To to szybka operacja, w przypadku indeksu klastrowanego za pośrednictwem kolumn na liście wyników są szeregowane, lub jeśli jest pokryciem indeksu, ale może być bardziej kosztowne inaczej.</span><span class="sxs-lookup"><span data-stu-id="5a489-208">This is a quick operation if there is a clustered index over the column(s) the results are being ordered by, or if there is a covering index, but can be more costly otherwise.</span></span> <span data-ttu-id="5a489-209">Aby poprawić wydajność zapytań wystarczająco duże, Rozważ dodanie indeksu nieklastrowanego dla kolumny, według której wyniki są uporządkowane według.</span><span class="sxs-lookup"><span data-stu-id="5a489-209">To help improve performance for sufficiently large queries, consider adding a non-clustered index for the column by which the results are ordered by.</span></span> <span data-ttu-id="5a489-210">Zobacz [funkcji Klasyfikacja i wydajności w programie SQL Server 2005](http://www.sql-server-performance.com/ak_ranking_functions.asp) uzyskać bardziej szczegółowy widok zagadnienia związane z wydajnością.</span><span class="sxs-lookup"><span data-stu-id="5a489-210">See [Ranking Functions and Performance in SQL Server 2005](http://www.sql-server-performance.com/ak_ranking_functions.asp) for a more detailed look at the performance considerations.</span></span>

<span data-ttu-id="5a489-211">Informacje o klasyfikacji, zwrócone przez `ROW_NUMBER()` nie może być używany bezpośrednio `WHERE` klauzuli.</span><span class="sxs-lookup"><span data-stu-id="5a489-211">The ranking information returned by `ROW_NUMBER()` cannot directly be used in the `WHERE` clause.</span></span> <span data-ttu-id="5a489-212">Jednak tabeli pochodnej może służyć do zwrócenia `ROW_NUMBER()` wynik, który następnie może występować w `WHERE` klauzuli.</span><span class="sxs-lookup"><span data-stu-id="5a489-212">However, a derived table can be used to return the `ROW_NUMBER()` result, which can then appear in the `WHERE` clause.</span></span> <span data-ttu-id="5a489-213">Na przykład, następujące zapytanie używa tabeli pochodnej do zwrócenia z właściwościami ProductName i UnitPrice kolumny, wraz z `ROW_NUMBER()` wyników, a następnie używa `WHERE` klauzulę, aby zwracać tylko te produkty której pozycję cena jest między 11 i 20:</span><span class="sxs-lookup"><span data-stu-id="5a489-213">For example, the following query uses a derived table to return the ProductName and UnitPrice columns, along with the `ROW_NUMBER()` result, and then uses a `WHERE` clause to only return those products whose price rank is between 11 and 20:</span></span>


[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-vb/samples/sample5.sql)]

<span data-ttu-id="5a489-214">Rozszerzanie nieco dodatkowo to pojęcie, firma Microsoft mogą korzystać z tego podejścia do pobrania określonej strony danych podane odpowiednie wartości Rozpocznij indeks wiersza i maksymalna liczba wierszy:</span><span class="sxs-lookup"><span data-stu-id="5a489-214">Extending this concept a bit further, we can utilize this approach to retrieve a specific page of data given the desired Start Row Index and Maximum Rows values:</span></span>


[!code-html[Main](efficiently-paging-through-large-amounts-of-data-vb/samples/sample6.html)]

> [!NOTE]
> <span data-ttu-id="5a489-215">Jak firma Microsoft zostanie wyświetlony później w tym samouczku *`StartRowIndex`* dostarczonych przez kontrolki ObjectDataSource są indeksowane począwszy od zera, natomiast `ROW_NUMBER()` wartości zwracanej przez program SQL Server 2005 są indeksowane począwszy od 1.</span><span class="sxs-lookup"><span data-stu-id="5a489-215">As we will see later on in this tutorial, the *`StartRowIndex`* supplied by the ObjectDataSource is indexed starting at zero, whereas the `ROW_NUMBER()` value returned by SQL Server 2005 is indexed starting at 1.</span></span> <span data-ttu-id="5a489-216">W związku z tym `WHERE` klauzula zwraca te rekordy, których `PriceRank` jest większa niż *`StartRowIndex`* i mniejsza niż lub równa *`StartRowIndex`*  +  *`MaximumRows`*.</span><span class="sxs-lookup"><span data-stu-id="5a489-216">Therefore, the `WHERE` clause returns those records where `PriceRank` is strictly greater than *`StartRowIndex`* and less than or equal to *`StartRowIndex`* + *`MaximumRows`*.</span></span>


<span data-ttu-id="5a489-217">Teraz tego możemy ve omówiono sposób `ROW_NUMBER()` mogą być używane do pobierania na danej stronie dane podane wartości Rozpocznij indeks wiersza i maksymalna liczba wierszy, teraz musisz zaimplementować tę logikę jako metody DAL i logiki warstwy Biznesowej.</span><span class="sxs-lookup"><span data-stu-id="5a489-217">Now that we ve discussed how `ROW_NUMBER()` can be used to retrieve a particular page of data given the Start Row Index and Maximum Rows values, we now need to implement this logic as methods in the DAL and BLL.</span></span>

<span data-ttu-id="5a489-218">Podczas tworzenia tego zapytania, że należy zdecydować, to porządkowanie za pomocą której wyniki zostanie wyznaczona ranga; Pozwól s posortować produkty według nazwy w kolejności alfabetycznej.</span><span class="sxs-lookup"><span data-stu-id="5a489-218">When creating this query we must decide the ordering by which the results will be ranked; let s sort the products by their name in alphabetical order.</span></span> <span data-ttu-id="5a489-219">Oznacza to, że za pomocą niestandardowych implementacji stronicowania, w tym samouczku firma Microsoft nie będzie można utworzyć raport niestandardowy stronicowane, niż można również sortować.</span><span class="sxs-lookup"><span data-stu-id="5a489-219">This means that with the custom paging implementation in this tutorial we will not be able to create a custom paged report than can also be sorted.</span></span> <span data-ttu-id="5a489-220">W następnym samouczku, zobaczymy, jak można podać takich funkcji.</span><span class="sxs-lookup"><span data-stu-id="5a489-220">In the next tutorial, though, we'll see how such functionality can be provided.</span></span>

<span data-ttu-id="5a489-221">W poprzedniej sekcji utworzyliśmy metoda DAL jako instrukcji SQL zapytań ad-hoc.</span><span class="sxs-lookup"><span data-stu-id="5a489-221">In the previous section we created the DAL method as an ad-hoc SQL statement.</span></span> <span data-ttu-id="5a489-222">Niestety, analizator składni języka T-SQL w programie Visual Studio używane przez t TableAdapter Kreator, takich jak `OVER` składnią używaną przez `ROW_NUMBER()` funkcji.</span><span class="sxs-lookup"><span data-stu-id="5a489-222">Unfortunately, the T-SQL parser in Visual Studio used by the TableAdapter wizard doesn t like the `OVER` syntax used by the `ROW_NUMBER()` function.</span></span> <span data-ttu-id="5a489-223">W związku z tym jako procedurę przechowywaną, firma Microsoft należy utworzyć w tej metody warstwy DAL.</span><span class="sxs-lookup"><span data-stu-id="5a489-223">Therefore, we must create this DAL method as a stored procedure.</span></span> <span data-ttu-id="5a489-224">Wybierz Server Explorer z menu Widok (lub trafień Ctrl + Alt + S) i rozwiń opcję `NORTHWND.MDF` węzła.</span><span class="sxs-lookup"><span data-stu-id="5a489-224">Select the Server Explorer from the View menu (or hit Ctrl+Alt+S) and expand the `NORTHWND.MDF` node.</span></span> <span data-ttu-id="5a489-225">Aby dodać nową procedurę składowaną, kliknij prawym przyciskiem myszy w węźle procedur składowanych, a następnie kliknij przycisk Dodaj nową procedurę przechowywaną (patrz rysunek 6).</span><span class="sxs-lookup"><span data-stu-id="5a489-225">To add a new stored procedure, right-click on the Stored Procedures node and choose Add a New Stored Procedure (see Figure 6).</span></span>


![Dodaj nową procedurę składowaną dla stronicować produktów](efficiently-paging-through-large-amounts-of-data-vb/_static/image6.png)

<span data-ttu-id="5a489-227">**Rysunek 6**: Dodaj nową procedurę składowaną dla stronicować produktów</span><span class="sxs-lookup"><span data-stu-id="5a489-227">**Figure 6**: Add a New Stored Procedure for Paging Through the Products</span></span>


<span data-ttu-id="5a489-228">Tę procedurę składowaną, należy zaakceptować dwóch parametrów wejściowych integer - `@startRowIndex` i `@maximumRows` i użyj `ROW_NUMBER()` funkcja uporządkowane według `ProductName` pola, zwracanie tylko tych wierszy, które jest większa niż określona `@startRowIndex` i mniejsza niż lub równa `@startRowIndex`  +  `@maximumRow` s.</span><span class="sxs-lookup"><span data-stu-id="5a489-228">This stored procedure should accept two integer input parameters - `@startRowIndex` and `@maximumRows` and use the `ROW_NUMBER()` function ordered by the `ProductName` field, returning only those rows greater than the specified `@startRowIndex` and less than or equal to `@startRowIndex` + `@maximumRow` s.</span></span> <span data-ttu-id="5a489-229">Wprowadź następujący skrypt do nowej procedury składowanej, a następnie kliknij przycisk Zapisz, aby dodać procedurę składowaną w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="5a489-229">Enter the following script into the new stored procedure and then click the Save icon to add the stored procedure to the database.</span></span>


[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-vb/samples/sample7.sql)]

<span data-ttu-id="5a489-230">Po utworzeniu procedury składowanej, Poświęć chwilę, aby przetestować działanie. Kliknij prawym przyciskiem myszy `GetProductsPaged` procedury składowanej nazwy w Eksploratorze serwera i wybierz opcję wykonania.</span><span class="sxs-lookup"><span data-stu-id="5a489-230">After creating the stored procedure, take a moment to test it out. Right-click on the `GetProductsPaged` stored procedure name in the Server Explorer and choose the Execute option.</span></span> <span data-ttu-id="5a489-231">Program Visual Studio wyświetlany jest monit dla parametrów wejściowych `@startRowIndex` i `@maximumRow` s (zobacz rysunek 7).</span><span class="sxs-lookup"><span data-stu-id="5a489-231">Visual Studio will then prompt you for the input parameters, `@startRowIndex` and `@maximumRow` s (see Figure 7).</span></span> <span data-ttu-id="5a489-232">Wypróbuj różne wartości i sprawdź wyniki.</span><span class="sxs-lookup"><span data-stu-id="5a489-232">Try different values and examine the results.</span></span>


![Wprowadź wartość w @startRowIndex i @maximumRows parametrów](efficiently-paging-through-large-amounts-of-data-vb/_static/image7.png)

<span data-ttu-id="5a489-234"><strong>Rysunek 7</strong>: Wprowadź wartość w @startRowIndex i @maximumRows parametrów</span><span class="sxs-lookup"><span data-stu-id="5a489-234"><strong>Figure 7</strong>: Enter a Value for the @startRowIndex and @maximumRows Parameters</span></span>


<span data-ttu-id="5a489-235">Po wybierając te wprowadzanie wartości parametrów, w oknie danych wyjściowych zostaną wyświetlone wyniki.</span><span class="sxs-lookup"><span data-stu-id="5a489-235">After choosing these input parameters values, the Output window will show the results.</span></span> <span data-ttu-id="5a489-236">Rysunek 8 przedstawia wyniki podczas przekazywania w 10 dla obu `@startRowIndex` i `@maximumRows` parametrów.</span><span class="sxs-lookup"><span data-stu-id="5a489-236">Figure 8 shows the results when passing in 10 for both the `@startRowIndex` and `@maximumRows` parameters.</span></span>


<span data-ttu-id="5a489-237">[![Zwracane są rekordy, zostanie wyświetlony w drugiej strony danych](efficiently-paging-through-large-amounts-of-data-vb/_static/image9.png)](efficiently-paging-through-large-amounts-of-data-vb/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="5a489-237">[![The Records That Would Appear in the Second Page of Data are Returned](efficiently-paging-through-large-amounts-of-data-vb/_static/image9.png)](efficiently-paging-through-large-amounts-of-data-vb/_static/image8.png)</span></span>

<span data-ttu-id="5a489-238">**Rysunek 8**: Zwracane są rekordy, zostanie wyświetlony w drugiej strony danych ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](efficiently-paging-through-large-amounts-of-data-vb/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="5a489-238">**Figure 8**: The Records That Would Appear in the Second Page of Data are Returned ([Click to view full-size image](efficiently-paging-through-large-amounts-of-data-vb/_static/image10.png))</span></span>


<span data-ttu-id="5a489-239">Dzięki temu przechowywane procedury tworzenia, możemy ponownie gotowe do utworzenia `ProductsTableAdapter` metody.</span><span class="sxs-lookup"><span data-stu-id="5a489-239">With this stored procedure created, we re ready to create the `ProductsTableAdapter` method.</span></span> <span data-ttu-id="5a489-240">Otwórz `Northwind.xsd` wpisana zestawu danych, kliknij prawym przyciskiem myszy w `ProductsTableAdapter`, a następnie wybierz opcję Dodaj zapytanie.</span><span class="sxs-lookup"><span data-stu-id="5a489-240">Open the `Northwind.xsd` Typed DataSet, right-click in the `ProductsTableAdapter`, and choose the Add Query option.</span></span> <span data-ttu-id="5a489-241">Zamiast tworzenia zapytania przy użyciu instrukcji SQL zapytań ad-hoc, utwórz ją za pomocą istniejącą procedurę składowaną.</span><span class="sxs-lookup"><span data-stu-id="5a489-241">Instead of creating the query using an ad-hoc SQL statement, create it using an existing stored procedure.</span></span>


![Utwórz metodę DAL przy użyciu istniejącą procedurę składowaną](efficiently-paging-through-large-amounts-of-data-vb/_static/image11.png)

<span data-ttu-id="5a489-243">**Rysunek 9**: Utwórz metodę DAL przy użyciu istniejącą procedurę składowaną</span><span class="sxs-lookup"><span data-stu-id="5a489-243">**Figure 9**: Create the DAL Method Using an Existing Stored Procedure</span></span>


<span data-ttu-id="5a489-244">Następnie możemy monit wybierz procedurę składowaną do wywołania.</span><span class="sxs-lookup"><span data-stu-id="5a489-244">Next, we are prompted to select the stored procedure to invoke.</span></span> <span data-ttu-id="5a489-245">Wybierz `GetProductsPaged` przechowywane procedury z listy rozwijanej.</span><span class="sxs-lookup"><span data-stu-id="5a489-245">Pick the `GetProductsPaged` stored procedure from the drop-down list.</span></span>


![Wybierz GetProductsPaged przechowywane procedury z listy rozwijanej](efficiently-paging-through-large-amounts-of-data-vb/_static/image12.png)

<span data-ttu-id="5a489-247">**Na rysunku nr 10**: Wybierz GetProductsPaged przechowywane procedury z listy rozwijanej</span><span class="sxs-lookup"><span data-stu-id="5a489-247">**Figure 10**: Choose the GetProductsPaged Stored Procedure from the Drop-Down List</span></span>


<span data-ttu-id="5a489-248">Następny ekran następnie zapyta, jakiego rodzaju dane zwracane przez procedurę składowaną: dane tabelaryczne, pojedynczej wartości lub brak wartości.</span><span class="sxs-lookup"><span data-stu-id="5a489-248">The next screen then asks you what kind of data is returned by the stored procedure: tabular data, a single value, or no value.</span></span> <span data-ttu-id="5a489-249">Ponieważ `GetProductsPaged` procedurę składowaną można zwrócić wiele rekordów, wskazują, że zwraca ona dane tabelaryczne.</span><span class="sxs-lookup"><span data-stu-id="5a489-249">Since the `GetProductsPaged` stored procedure can return multiple records, indicate that it returns tabular data.</span></span>


![Wskazuje, że procedura składowana ma zwracać dane tabelaryczne](efficiently-paging-through-large-amounts-of-data-vb/_static/image13.png)

<span data-ttu-id="5a489-251">**Rysunek 11**: Wskazuje, że procedura składowana ma zwracać dane tabelaryczne</span><span class="sxs-lookup"><span data-stu-id="5a489-251">**Figure 11**: Indicate that the Stored Procedure Returns Tabular Data</span></span>


<span data-ttu-id="5a489-252">Na koniec nazwiskami metod, które zostały utworzone.</span><span class="sxs-lookup"><span data-stu-id="5a489-252">Finally, indicate the names of the methods you want to have created.</span></span> <span data-ttu-id="5a489-253">Podobnie jak w przypadku naszej poprzednich samouczkach Przejdź dalej i tworzenie metod za pomocą obu wypełnienia DataTable i zwraca DataTable.</span><span class="sxs-lookup"><span data-stu-id="5a489-253">As with our previous tutorials, go ahead and create methods using both the Fill a DataTable and Return a DataTable.</span></span> <span data-ttu-id="5a489-254">Nazwa pierwszej metody `FillPaged` , a druga `GetProductsPaged`.</span><span class="sxs-lookup"><span data-stu-id="5a489-254">Name the first method `FillPaged` and the second `GetProductsPaged`.</span></span>


![Nazwa FillPaged metod i GetProductsPaged](efficiently-paging-through-large-amounts-of-data-vb/_static/image14.png)

<span data-ttu-id="5a489-256">**Rysunek 12**: Nazwa FillPaged metod i GetProductsPaged</span><span class="sxs-lookup"><span data-stu-id="5a489-256">**Figure 12**: Name the Methods FillPaged and GetProductsPaged</span></span>


<span data-ttu-id="5a489-257">Ponadto utworzyć metodę warstwy DAL do zwrócenia na danej stronie produktów, musimy również udostępniają takie funkcje, w LOGIKI.</span><span class="sxs-lookup"><span data-stu-id="5a489-257">In addition to created a DAL method to return a particular page of products, we also need to provide such functionality in the BLL.</span></span> <span data-ttu-id="5a489-258">Podobna do metody DAL s LOGIKI metoda GetProductsPaged musi zaakceptować dwie liczby całkowitej danych wejściowych, Rozpocznij indeks wiersza i maksymalna liczba wierszy, a musi zwracać tylko te rekordy, które mieszczą się w określonym zakresie.</span><span class="sxs-lookup"><span data-stu-id="5a489-258">Like the DAL method, the BLL s GetProductsPaged method must accept two integer inputs for specifying the Start Row Index and Maximum Rows, and must return just those records that fall within the specified range.</span></span> <span data-ttu-id="5a489-259">Utwórz metodę LOGIKI w klasie ProductsBLL, że jedynie wywołaniami dół s DAL GetProductsPaged metody, w następujący sposób:</span><span class="sxs-lookup"><span data-stu-id="5a489-259">Create such a BLL method in the ProductsBLL class that merely calls down into the DAL s GetProductsPaged method, like so:</span></span>


[!code-vb[Main](efficiently-paging-through-large-amounts-of-data-vb/samples/sample8.vb)]

<span data-ttu-id="5a489-260">Można użyć dowolnej nazwy parametrów wejściowych metody s LOGIKI, ale, jak firma Microsoft pojawi się wkrótce, wybór użycia `startRowIndex` i `maximumRows` oszczędza nam dodatkowy bit pracy podczas konfigurowania elementu ObjectDataSource do używania tej metody.</span><span class="sxs-lookup"><span data-stu-id="5a489-260">You can use any name for the BLL method s input parameters, but, as we will see shortly, choosing to use `startRowIndex` and `maximumRows` saves us from an extra bit of work when configuring an ObjectDataSource to use this method.</span></span>

## <a name="step-4-configuring-the-objectdatasource-to-use-custom-paging"></a><span data-ttu-id="5a489-261">Krok 4. Konfigurowanie kontrolki ObjectDataSource do użycia niestandardowego stronicowania</span><span class="sxs-lookup"><span data-stu-id="5a489-261">Step 4: Configuring the ObjectDataSource to Use Custom Paging</span></span>

<span data-ttu-id="5a489-262">Za pomocą metod LOGIKI i warstwy DAL do uzyskiwania dostępu do konkretnego podzbioru rekordy pełne możemy ponownie gotowe do utworzenia w kontrolce GridView kontrolować tej strony za pomocą jego rekordy przy użyciu niestandardowych stronicowania.</span><span class="sxs-lookup"><span data-stu-id="5a489-262">With the BLL and DAL methods for accessing a particular subset of records complete, we re ready to create a GridView control that pages through its underlying records using custom paging.</span></span> <span data-ttu-id="5a489-263">Zacznij od otwarcia `EfficientPaging.aspx` stronie `PagingAndSorting` folderu, na stronie Dodaj GridView i skonfigurować go do używania nowej kontrolki ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="5a489-263">Start by opening the `EfficientPaging.aspx` page in the `PagingAndSorting` folder, add a GridView to the page, and configure it to use a new ObjectDataSource control.</span></span> <span data-ttu-id="5a489-264">W przeszłości materiały szkoleniowe, mieliśmy często skonfigurowane do używania kontrolki ObjectDataSource `ProductsBLL` klasy s `GetProducts` metody.</span><span class="sxs-lookup"><span data-stu-id="5a489-264">In our past tutorials, we often had the ObjectDataSource configured to use the `ProductsBLL` class s `GetProducts` method.</span></span> <span data-ttu-id="5a489-265">Tym razem jednak chcemy do użycia `GetProductsPaged` metody zamiast tego należy od `GetProducts` metoda zwraca *wszystkich* produktów w bazie danych natomiast `GetProductsPaged` zwraca konkretnego podzestawu rekordów.</span><span class="sxs-lookup"><span data-stu-id="5a489-265">This time, however, we want to use the `GetProductsPaged` method instead, since the `GetProducts` method returns *all* of the products in the database whereas `GetProductsPaged` returns just a particular subset of records.</span></span>


![Konfigurowanie kontrolki ObjectDataSource przy użyciu metody GetProductsPaged ProductsBLL klasy s](efficiently-paging-through-large-amounts-of-data-vb/_static/image15.png)

<span data-ttu-id="5a489-267">**Rysunek 13**: Konfigurowanie kontrolki ObjectDataSource przy użyciu metody GetProductsPaged ProductsBLL klasy s</span><span class="sxs-lookup"><span data-stu-id="5a489-267">**Figure 13**: Configure the ObjectDataSource to Use the ProductsBLL Class s GetProductsPaged Method</span></span>


<span data-ttu-id="5a489-268">Ponieważ możemy ponownie tworzenie GridView tylko do odczytu Poświęć chwilę, aby ustawić listy rozwijanej metody INSERT, UPDATE i usuwanie kart (Brak).</span><span class="sxs-lookup"><span data-stu-id="5a489-268">Since we re creating a read-only GridView, take a moment to set the method drop-down list in the INSERT, UPDATE, and DELETE tabs to (None).</span></span>

<span data-ttu-id="5a489-269">Następnie Kreator ObjectDataSource nam monituje o podanie źródła `GetProductsPaged` metoda s `startRowIndex` i `maximumRows` wprowadzanie wartości parametrów.</span><span class="sxs-lookup"><span data-stu-id="5a489-269">Next, the ObjectDataSource wizard prompts us for the sources of the `GetProductsPaged` method s `startRowIndex` and `maximumRows` input parameters values.</span></span> <span data-ttu-id="5a489-270">Te parametry wejściowe zostaną rzeczywiście ustawione przez widoku GridView automatycznie więc po prostu pozostaw źródłowy zestaw None i kliknij przycisk Zakończ.</span><span class="sxs-lookup"><span data-stu-id="5a489-270">These input parameters will actually be set by the GridView automatically, so simply leave the source set to None and click Finish.</span></span>


![Pozostaw źródła parametr wejściowy, jak None](efficiently-paging-through-large-amounts-of-data-vb/_static/image16.png)

<span data-ttu-id="5a489-272">**Rysunek 14**: Pozostaw źródła parametr wejściowy, jak None</span><span class="sxs-lookup"><span data-stu-id="5a489-272">**Figure 14**: Leave the Input Parameter Sources as None</span></span>


<span data-ttu-id="5a489-273">Po zakończeniu pracy Kreatora ObjectDataSource widoku GridView będzie zawierać elementu BoundField lub CheckBoxField dla każdego pola danych produktu.</span><span class="sxs-lookup"><span data-stu-id="5a489-273">After completing the ObjectDataSource wizard, the GridView will contain a BoundField or CheckBoxField for each of the product data fields.</span></span> <span data-ttu-id="5a489-274">Możesz dostosować wygląd s GridView, zgodnie z potrzebami.</span><span class="sxs-lookup"><span data-stu-id="5a489-274">Feel free to tailor the GridView s appearance as you see fit.</span></span> <span data-ttu-id="5a489-275">Czy mogę ve zgody, aby wyświetlić tylko `ProductName`, `CategoryName`, `SupplierName`, `QuantityPerUnit`, i `UnitPrice` BoundFields.</span><span class="sxs-lookup"><span data-stu-id="5a489-275">I ve opted to display only the `ProductName`, `CategoryName`, `SupplierName`, `QuantityPerUnit`, and `UnitPrice` BoundFields.</span></span> <span data-ttu-id="5a489-276">Ponadto należy skonfigurować GridView do obsługi stronicowania, zaznaczając pole wyboru Włącz stronicowania w jego tagu inteligentnego.</span><span class="sxs-lookup"><span data-stu-id="5a489-276">Also, configure the GridView to support paging by checking the Enable Paging checkbox in its smart tag.</span></span> <span data-ttu-id="5a489-277">Po wprowadzeniu tych zmian oznaczeniu deklaracyjnym kontrolkami GridView i kontrolki ObjectDataSource powinien wyglądać podobnie do poniższej:</span><span class="sxs-lookup"><span data-stu-id="5a489-277">After these changes, the GridView and ObjectDataSource declarative markup should look similar to the following:</span></span>


[!code-aspx[Main](efficiently-paging-through-large-amounts-of-data-vb/samples/sample9.aspx)]

<span data-ttu-id="5a489-278">W przypadku odwiedzenia strony za pośrednictwem przeglądarki widoku GridView jest jednak którego ma zostać odnaleziona.</span><span class="sxs-lookup"><span data-stu-id="5a489-278">If you visit the page through a browser, however, the GridView is no where to be found.</span></span>


![Kontrolki GridView jest niewidoczne](efficiently-paging-through-large-amounts-of-data-vb/_static/image17.png)

<span data-ttu-id="5a489-280">**Rysunek 15**: Kontrolki GridView jest niewidoczne</span><span class="sxs-lookup"><span data-stu-id="5a489-280">**Figure 15**: The GridView is Not Displayed</span></span>


<span data-ttu-id="5a489-281">Kontrolki GridView brakuje ponieważ kontrolki ObjectDataSource jest obecnie używany przez 0 jako wartości dla obu `GetProductsPaged` `startRowIndex` i `maximumRows` parametrów wejściowych.</span><span class="sxs-lookup"><span data-stu-id="5a489-281">The GridView is missing because the ObjectDataSource is currently using 0 as the values for both of the `GetProductsPaged` `startRowIndex` and `maximumRows` input parameters.</span></span> <span data-ttu-id="5a489-282">W związku z tym wynikowe zapytanie SQL zwraca żadnych rekordów i w związku z tym nie jest wyświetlana widoku GridView.</span><span class="sxs-lookup"><span data-stu-id="5a489-282">Hence, the resulting SQL query is returning no records and therefore the GridView is not displayed.</span></span>

<span data-ttu-id="5a489-283">Aby rozwiązać ten problem, należy skonfigurować ObjectDataSource do użycia niestandardowego stronicowania.</span><span class="sxs-lookup"><span data-stu-id="5a489-283">To remedy this, we need to configure the ObjectDataSource to use custom paging.</span></span> <span data-ttu-id="5a489-284">Można to zrobić w poniższych krokach:</span><span class="sxs-lookup"><span data-stu-id="5a489-284">This can be accomplished in the following steps:</span></span>

1. <span data-ttu-id="5a489-285">**Ustaw ObjectDataSource s `EnablePaging` właściwości `true`**  wskazuje ObjectDataSource, jaki musi minąć do `SelectMethod` dwa dodatkowe parametry: umożliwiających określenie indeks wiersza Start ([ `StartRowIndexParameterName` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.startrowindexparametername.aspx)), a drugi do określenia maksymalna liczba wierszy ([`MaximumRowsParameterName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.maximumrowsparametername.aspx)).</span><span class="sxs-lookup"><span data-stu-id="5a489-285">**Set the ObjectDataSource s `EnablePaging` property to `true`** this indicates to the ObjectDataSource that it must pass to the `SelectMethod` two additional parameters: one to specify the Start Row Index ([`StartRowIndexParameterName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.startrowindexparametername.aspx)), and one to specify the Maximum Rows ([`MaximumRowsParameterName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.maximumrowsparametername.aspx)).</span></span>
2. <span data-ttu-id="5a489-286">**Ustaw ObjectDataSource s `StartRowIndexParameterName` i `MaximumRowsParameterName` odpowiednio do właściwości** `StartRowIndexParameterName` i `MaximumRowsParameterName` właściwości z nazwiskami parametry wejściowe przekazywane do `SelectMethod` potrzeby stronicowania niestandardowych.</span><span class="sxs-lookup"><span data-stu-id="5a489-286">**Set the ObjectDataSource s `StartRowIndexParameterName` and `MaximumRowsParameterName` Properties Accordingly** the `StartRowIndexParameterName` and `MaximumRowsParameterName` properties indicate the names of the input parameters passed into the `SelectMethod` for custom paging purposes.</span></span> <span data-ttu-id="5a489-287">Domyślnie, te nazwy parametru są `startIndexRow` i `maximumRows`, co jest dlaczego, tworząc `GetProductsPaged` metody w LOGIKI, I użyć tych wartości dla parametrów wejściowych.</span><span class="sxs-lookup"><span data-stu-id="5a489-287">By default, these parameter names are `startIndexRow` and `maximumRows`, which is why, when creating the `GetProductsPaged` method in the BLL, I used these values for the input parameters.</span></span> <span data-ttu-id="5a489-288">Jeśli została wybrana opcja używania nazwy różnych parametrów dla s LOGIKI `GetProductsPaged` metody takie jak `startIndex` i `maxRows`dla przykładu, należy ustawić ObjectDataSource s `StartRowIndexParameterName` i `MaximumRowsParameterName` właściwości odpowiednio (na przykład startIndex dla `StartRowIndexParameterName` i maksymalna liczba wierszy dla `MaximumRowsParameterName`).</span><span class="sxs-lookup"><span data-stu-id="5a489-288">If you chose to use different parameter names for the BLL s `GetProductsPaged` method such as `startIndex` and `maxRows`, for example you would need to set the ObjectDataSource s `StartRowIndexParameterName` and `MaximumRowsParameterName` properties accordingly (such as startIndex for `StartRowIndexParameterName` and maxRows for `MaximumRowsParameterName`).</span></span>
3. <span data-ttu-id="5a489-289">**Ustaw ObjectDataSource s [ `SelectCountMethod` właściwość](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.selectcountmethod(VS.80).aspx) na nazwę metody, która zwraca całkowita liczba z rekordów jest stronicowanej za pośrednictwem (`TotalNumberOfProducts`)** pamiętamy `ProductsBLL` klasy s `TotalNumberOfProducts`metoda zwróci wartość całkowita liczba rekordów, które są stronicowane za pomocą metody DAL, który jest wykonywany `SELECT COUNT(*) FROM Products` zapytania.</span><span class="sxs-lookup"><span data-stu-id="5a489-289">**Set the ObjectDataSource s [`SelectCountMethod` Property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.selectcountmethod(VS.80).aspx) to the Name of the Method that Returns the Total Number of Records Being Paged Through (`TotalNumberOfProducts`)** recall that the `ProductsBLL` class s `TotalNumberOfProducts` method returns the total number of records being paged through using a DAL method that executes a `SELECT COUNT(*) FROM Products` query.</span></span> <span data-ttu-id="5a489-290">Te informacje są potrzebne przez kontrolki ObjectDataSource celu została poprawnie renderowana interfejsu stronicowania.</span><span class="sxs-lookup"><span data-stu-id="5a489-290">This information is needed by the ObjectDataSource in order to correctly render the paging interface.</span></span>
4. <span data-ttu-id="5a489-291">**Usuń `startRowIndex` i `maximumRows` `<asp:Parameter>` elementów z kontrolki ObjectDataSource s w oznaczeniu deklaracyjnym** podczas konfigurowania elementu ObjectDataSource z kreatorem, Visual Studio automatycznie dodane dwa `<asp:Parameter>` elementów Aby uzyskać `GetProductsPaged` metoda s parametrów wejściowych.</span><span class="sxs-lookup"><span data-stu-id="5a489-291">**Remove the `startRowIndex` and `maximumRows` `<asp:Parameter>` Elements from the ObjectDataSource s Declarative Markup** when configuring the ObjectDataSource through the wizard, Visual Studio automatically added two `<asp:Parameter>` elements for the `GetProductsPaged` method s input parameters.</span></span> <span data-ttu-id="5a489-292">Ustawiając `EnablePaging` do `true`, te parametry zostaną automatycznie przekazane; Jeśli pojawiają się również w składni deklaratywnej, kontrolki ObjectDataSource spróbuje przekazać *cztery* parametry `GetProductsPaged` — metoda i dwa parametry `TotalNumberOfProducts` metody.</span><span class="sxs-lookup"><span data-stu-id="5a489-292">By setting `EnablePaging` to `true`, these parameters will be passed automatically; if they also appear in the declarative syntax, the ObjectDataSource will attempt to pass *four* parameters to the `GetProductsPaged` method and two parameters to the `TotalNumberOfProducts` method.</span></span> <span data-ttu-id="5a489-293">Jeśli nie pamiętasz usunąć te `<asp:Parameter>` elementów, podczas wyświetlania strony za pośrednictwem przeglądarki, otrzymasz komunikat o błędzie, takich jak: *Kontrolki ObjectDataSource "ObjectDataSource1" nie można odnaleźć metody nieogólnego TotalNumberOfProducts, który ma następujące parametry: startRowIndex, maximumRows*.</span><span class="sxs-lookup"><span data-stu-id="5a489-293">If you forget to remove these `<asp:Parameter>` elements, when visiting the page through a browser you'll get an error message like: *ObjectDataSource 'ObjectDataSource1' could not find a non-generic method 'TotalNumberOfProducts' that has parameters: startRowIndex, maximumRows*.</span></span>

<span data-ttu-id="5a489-294">Po wprowadzeniu tych zmian, składni deklaratywnej s ObjectDataSource powinien wyglądać następująco:</span><span class="sxs-lookup"><span data-stu-id="5a489-294">After making these changes, the ObjectDataSource s declarative syntax should look like the following:</span></span>


[!code-aspx[Main](efficiently-paging-through-large-amounts-of-data-vb/samples/sample10.aspx)]

<span data-ttu-id="5a489-295">Należy pamiętać, że `EnablePaging` i `SelectCountMethod` zostały ustawione właściwości i `<asp:Parameter>` elementy zostały usunięte.</span><span class="sxs-lookup"><span data-stu-id="5a489-295">Note that the `EnablePaging` and `SelectCountMethod` properties have been set and the `<asp:Parameter>` elements have been removed.</span></span> <span data-ttu-id="5a489-296">Rysunek 16 przedstawiono zrzut ekranu przedstawiający okno właściwości po tych zmian.</span><span class="sxs-lookup"><span data-stu-id="5a489-296">Figure 16 shows a screen shot of the Properties window after these changes have been made.</span></span>


![Aby użyć niestandardowego stronicowania, należy skonfigurować formantu ObjectDataSource](efficiently-paging-through-large-amounts-of-data-vb/_static/image18.png)

<span data-ttu-id="5a489-298">**Rysunek 16**: Aby użyć niestandardowego stronicowania, należy skonfigurować formantu ObjectDataSource</span><span class="sxs-lookup"><span data-stu-id="5a489-298">**Figure 16**: To Use Custom Paging, Configure the ObjectDataSource Control</span></span>


<span data-ttu-id="5a489-299">Po wprowadzeniu tych zmian, odwiedź tę stronę za pośrednictwem przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="5a489-299">After making these changes, visit this page through a browser.</span></span> <span data-ttu-id="5a489-300">Powinien zostać wyświetlony 10 z wymienionych poniżej produktów, uporządkowana w kolejności alfabetycznej.</span><span class="sxs-lookup"><span data-stu-id="5a489-300">You should see 10 products listed, ordered alphabetically.</span></span> <span data-ttu-id="5a489-301">Poświęć chwilę, aby przejść przez jedną stronę danych w czasie.</span><span class="sxs-lookup"><span data-stu-id="5a489-301">Take a moment to step through the data one page at a time.</span></span> <span data-ttu-id="5a489-302">W trakcie Brak visual różnicy z perspektywy użytkownika końcowego s stronicowania domyślne i niestandardowe stronicowania niestandardowe wydajniej stronicowania między stronami w ramach dużych ilości danych, ponieważ pobiera tylko te rekordy, które muszą być wyświetlany dla danej strony.</span><span class="sxs-lookup"><span data-stu-id="5a489-302">While there is no visual difference from the end user s perspective between default paging and custom paging, custom paging more efficiently pages through large amounts of data as it only retrieves those records that need to be displayed for a given page.</span></span>


<span data-ttu-id="5a489-303">[![Dane, Zamówione według produktu s nazwa, jest stronicowania niestandardowe stronicowanej przy użyciu](efficiently-paging-through-large-amounts-of-data-vb/_static/image20.png)](efficiently-paging-through-large-amounts-of-data-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="5a489-303">[![The Data, Ordered by the Product s Name, is Paged Using Custom Paging](efficiently-paging-through-large-amounts-of-data-vb/_static/image20.png)](efficiently-paging-through-large-amounts-of-data-vb/_static/image19.png)</span></span>

<span data-ttu-id="5a489-304">**Rysunek 17**: Dane, Zamówione według produktu s nazwa, jest stronicowania niestandardowe stronicowanej przy użyciu ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](efficiently-paging-through-large-amounts-of-data-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="5a489-304">**Figure 17**: The Data, Ordered by the Product s Name, is Paged Using Custom Paging ([Click to view full-size image](efficiently-paging-through-large-amounts-of-data-vb/_static/image21.png))</span></span>


> [!NOTE]
> <span data-ttu-id="5a489-305">Za pomocą niestandardowych stronicowania strony liczba wartości zwracanej przez ObjectDataSource s `SelectCountMethod` znajduje się w stanie widoku GridView s.</span><span class="sxs-lookup"><span data-stu-id="5a489-305">With custom paging, the page count value returned by the ObjectDataSource�s `SelectCountMethod` is stored in the GridView�s view state.</span></span> <span data-ttu-id="5a489-306">Inne zmienne GridView `PageIndex`, `EditIndex`, `SelectedIndex`, `DataKeys` kolekcji i tak dalej, które są przechowywane w *kontrolowany stan*, który jest trwały bez względu na wartość GridView s `EnableViewState` Właściwość.</span><span class="sxs-lookup"><span data-stu-id="5a489-306">Other GridView variables the `PageIndex`, `EditIndex`, `SelectedIndex`, `DataKeys` collection, and so on are stored in *control state*, which is persisted regardless of the value of the GridView�s `EnableViewState` property.</span></span> <span data-ttu-id="5a489-307">Ponieważ `PageCount` wartość jest utrwalony między ogłaszania zwrotnego za pomocą stan widoku, korzystając z interfejsu stronicowania, który zawiera link umożliwiający przejście do ostatniej strony, konieczne jest włączenie stan widoku GridView s.</span><span class="sxs-lookup"><span data-stu-id="5a489-307">Since the `PageCount` value is persisted across postbacks using view state, when using a paging interface that includes a link to take you to the last page, it is imperative that the GridView�s view state be enabled.</span></span> <span data-ttu-id="5a489-308">(Jeśli interfejsu stronicowania nie zawiera bezpośredni link do ostatniej strony, a następnie możesz wyłączyć wyświetlanie stanu.)</span><span class="sxs-lookup"><span data-stu-id="5a489-308">(If your paging interface does not include a direct link to the last page, then you may disable view state.)</span></span>


<span data-ttu-id="5a489-309">Klikając łącze do strony ostatnich powoduje odświeżenie strony i powoduje, że GridView, aby zaktualizować jego `PageIndex` właściwości.</span><span class="sxs-lookup"><span data-stu-id="5a489-309">Clicking the last page link causes a postback and instructs the GridView to update its `PageIndex` property.</span></span> <span data-ttu-id="5a489-310">Po kliknięciu łącze do strony ostatnich widoku GridView przypisuje jej `PageIndex` właściwość z wartością, jeden mniejsza od jego `PageCount` właściwości.</span><span class="sxs-lookup"><span data-stu-id="5a489-310">If the last page link is clicked, the GridView assigns its `PageIndex` property to a value one less than its `PageCount` property.</span></span> <span data-ttu-id="5a489-311">Widok stanu wyłączone `PageCount` wartości są tracone w ogłaszania zwrotnego i `PageIndex` zamiast tego przypisuje się wartość maksymalna liczba całkowita.</span><span class="sxs-lookup"><span data-stu-id="5a489-311">With view state disabled, the `PageCount` value is lost across postbacks and the `PageIndex` is assigned the maximum integer value instead.</span></span> <span data-ttu-id="5a489-312">Następnie próbuje określić początkowy indeks wiersza przez pomnożenie widoku GridView `PageSize` i `PageCount` właściwości.</span><span class="sxs-lookup"><span data-stu-id="5a489-312">Next, the GridView attempts to determine the starting row index by multiplying the `PageSize` and `PageCount` properties.</span></span> <span data-ttu-id="5a489-313">Skutkuje to `OverflowException` ponieważ produkt przekracza rozmiar maksymalny dozwolony liczby całkowitej.</span><span class="sxs-lookup"><span data-stu-id="5a489-313">This results in an `OverflowException` since the product exceeds the maximum allowed integer size.</span></span>

## <a name="implement-custom-paging-and-sorting"></a><span data-ttu-id="5a489-314">Implementowanie niestandardowego stronicowanie i sortowanie</span><span class="sxs-lookup"><span data-stu-id="5a489-314">Implement Custom Paging and Sorting</span></span>

<span data-ttu-id="5a489-315">Nasz bieżący implementację niestandardową stronicowania wymaga kolejności za pomocą którego dane są stronicowane za pośrednictwem statycznie podczas tworzenia `GetProductsPaged` procedury składowanej.</span><span class="sxs-lookup"><span data-stu-id="5a489-315">Our current custom paging implementation requires that the order by which the data is paged through be specified statically when creating the `GetProductsPaged` stored procedure.</span></span> <span data-ttu-id="5a489-316">Jednak użytkownik może zostały zanotowane czy tagu inteligentnego s GridView zawiera włączyć sortowanie pola wyboru oprócz opcję włączenia stronicowania.</span><span class="sxs-lookup"><span data-stu-id="5a489-316">However, you may have noted that the GridView s smart tag contains an Enable Sorting checkbox in addition to the Enable Paging option.</span></span> <span data-ttu-id="5a489-317">Niestety dodanie obsługi sortowania w kontrolce GridView o naszej bieżącej niestandardowych implementacji stronicowania tylko będzie posortować rekordy na aktualnie otwartą strony danych.</span><span class="sxs-lookup"><span data-stu-id="5a489-317">Unfortunately, adding sorting support to the GridView with our current custom paging implementation will only sort the records on the currently viewed page of data.</span></span> <span data-ttu-id="5a489-318">Na przykład jeśli konfigurujesz kontrolki GridView do obsługują także stronicowania, a następnie, podczas wyświetlania na pierwszej stronie danych, posortuj według nazwy produktu w kolejności malejącej, jej będzie odwrócić kolejność produktów na stronie 1.</span><span class="sxs-lookup"><span data-stu-id="5a489-318">For example, if you configure the GridView to also support paging and then, when viewing the first page of data, sort by product name in descending order, it will reverse the order of the products on page 1.</span></span> <span data-ttu-id="5a489-319">Jak pokazano na rysunku 18, takie miało tygrysy Carnarvon produktów pierwsze podczas sortowania w odwrotnej kolejności alfabetycznej, co powoduje ignorowanie 71 innych produktów, które pochodzą tygrysy Carnarvon alfabetycznie; tylko te rekordy, na pierwszej stronie zostaną uwzględnione podczas sortowania.</span><span class="sxs-lookup"><span data-stu-id="5a489-319">As Figure 18 shows, such shows Carnarvon Tigers as the first product when sorting in reverse alphabetical order, which ignores the 71 other products that come after Carnarvon Tigers, alphabetically; only those records on the first page are considered in the sorting.</span></span>


<span data-ttu-id="5a489-320">[![Tylko dane wyświetlane na bieżącej stronie jest sortowana](efficiently-paging-through-large-amounts-of-data-vb/_static/image23.png)](efficiently-paging-through-large-amounts-of-data-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="5a489-320">[![Only the Data Shown on the Current Page is Sorted](efficiently-paging-through-large-amounts-of-data-vb/_static/image23.png)](efficiently-paging-through-large-amounts-of-data-vb/_static/image22.png)</span></span>

<span data-ttu-id="5a489-321">**Rysunek 18**: Tylko dane wyświetlane na bieżącej stronie jest sortowana ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](efficiently-paging-through-large-amounts-of-data-vb/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="5a489-321">**Figure 18**: Only the Data Shown on the Current Page is Sorted ([Click to view full-size image](efficiently-paging-through-large-amounts-of-data-vb/_static/image24.png))</span></span>


<span data-ttu-id="5a489-322">Sortowanie ma zastosowanie tylko do bieżącej strony dane ponieważ sortowanie jest wykonywane po pobraniu danych z s LOGIKI `GetProductsPaged` metody, a metoda ta zwraca tylko te rekordy, w poszukiwaniu konkretnej strony.</span><span class="sxs-lookup"><span data-stu-id="5a489-322">The sorting only applies to the current page of data because the sorting is occurring after the data has been retrieved from the BLL s `GetProductsPaged` method, and this method only returns those records for the specific page.</span></span> <span data-ttu-id="5a489-323">Aby zaimplementować sortowanie poprawnie, musimy wyrażenie sortowania, aby przekazać `GetProductsPaged` metody, dzięki czemu dane można sklasyfikować odpowiednio przed zwróceniem określonej strony danych.</span><span class="sxs-lookup"><span data-stu-id="5a489-323">To implement sorting correctly, we need to pass the sort expression to the `GetProductsPaged` method so that the data can be ranked appropriately before returning the specific page of data.</span></span> <span data-ttu-id="5a489-324">Zobaczymy, jak to zrobić w naszym samouczku dalej.</span><span class="sxs-lookup"><span data-stu-id="5a489-324">We'll see how to accomplish this in our next tutorial.</span></span>

## <a name="implementing-custom-paging-and-deleting"></a><span data-ttu-id="5a489-325">Implementowanie niestandardowego stronicowanie i usuwanie</span><span class="sxs-lookup"><span data-stu-id="5a489-325">Implementing Custom Paging and Deleting</span></span>

<span data-ttu-id="5a489-326">Jeśli użytkownik włączenie funkcji usuwania w GridView, którego dane są stronicowane, przy użyciu niestandardowych metod stronicowania znajdziesz, które podczas usuwania ostatniego rekordu z ostatniej strony widoku GridView znika zamiast odpowiednio zmniejszanie GridView s `PageIndex`.</span><span class="sxs-lookup"><span data-stu-id="5a489-326">If you enabling deleting functionality in a GridView whose data is paged using custom paging techniques you will find that when deleting the last record from the last page, the GridView disappears rather than appropriately decrementing the GridView s `PageIndex`.</span></span> <span data-ttu-id="5a489-327">Aby odtworzyć tę usterkę, należy włączyć usuwanie samouczek, który właśnie został dopiero utworzony.</span><span class="sxs-lookup"><span data-stu-id="5a489-327">To reproduce this bug, enable deleting for the tutorial just we just created.</span></span> <span data-ttu-id="5a489-328">Przejdź do ostatniej strony (strona 9), gdzie powinien zostać wyświetlony jeden produkt, ponieważ firma Microsoft stronicowanie 81 produktów, 10 produktów naraz.</span><span class="sxs-lookup"><span data-stu-id="5a489-328">Go to the last page (page 9), where you should see a single product since we are paging through 81 products, 10 products at a time.</span></span> <span data-ttu-id="5a489-329">Usuń ten produkt.</span><span class="sxs-lookup"><span data-stu-id="5a489-329">Delete this product.</span></span>

<span data-ttu-id="5a489-330">Podczas usuwania ostatniego produktu widoku GridView *powinien* automatyczne przejście do strony ósmego i funkcjonalność wystawiony jest z domyślną stronicowania.</span><span class="sxs-lookup"><span data-stu-id="5a489-330">Upon deleting the last product, the GridView *should* automatically go to the eighth page, and such functionality is exhibited with default paging.</span></span> <span data-ttu-id="5a489-331">Za pomocą niestandardowych stronicowania, jednak po usunięciu ostatniego produktu na ostatniej stronie widoku GridView po prostu znika z ekranu całkowicie.</span><span class="sxs-lookup"><span data-stu-id="5a489-331">With custom paging, however, after deleting that last product on the last page, the GridView simply disappears from the screen altogether.</span></span> <span data-ttu-id="5a489-332">Dokładne przyczyny *Dlaczego* dzieje się to nieco poza zakres tego samouczka, zobacz [usuwanie ostatniego rekordu na ostatniej stronie z GridView za pomocą niestandardowego stronicowania](http://scottonwriting.net/sowblog/posts/7326.aspx) niskiego poziomu szczegółowe informacje dotyczące źródła Ten problem.</span><span class="sxs-lookup"><span data-stu-id="5a489-332">The precise reason *why* this happens is a bit beyond the scope of this tutorial; see [Deleting the Last Record on the Last Page from a GridView with Custom Paging](http://scottonwriting.net/sowblog/posts/7326.aspx) for the low-level details as to the source of this problem.</span></span> <span data-ttu-id="5a489-333">W podsumowaniu go s z powodu następującej sekwencji czynności, wykonywane przez widoku GridView po kliknięciu przycisku usuwania:</span><span class="sxs-lookup"><span data-stu-id="5a489-333">In summary it s due to the following sequence of steps that are performed by the GridView when the Delete button is clicked:</span></span>

1. <span data-ttu-id="5a489-334">Usuń rekord</span><span class="sxs-lookup"><span data-stu-id="5a489-334">Delete the record</span></span>
2. <span data-ttu-id="5a489-335">Uzyskaj odpowiednie rekordy do wyświetlenia dla określonego `PageIndex` i `PageSize`</span><span class="sxs-lookup"><span data-stu-id="5a489-335">Get the appropriate records to display for the specified `PageIndex` and `PageSize`</span></span>
3. <span data-ttu-id="5a489-336">Zaznacz, aby upewnić się, że `PageIndex` nie przekracza liczbę stron danych w źródle danych; jeśli go automatycznie dekrementacja GridView s `PageIndex` właściwości</span><span class="sxs-lookup"><span data-stu-id="5a489-336">Check to ensure that the `PageIndex` does not exceed the number of pages of data in the data source; if it does, automatically decrement the GridView s `PageIndex` property</span></span>
4. <span data-ttu-id="5a489-337">Powiązanie odpowiednie strony danych do kontrolki GridView przy użyciu rekordów uzyskany w kroku 2</span><span class="sxs-lookup"><span data-stu-id="5a489-337">Bind the appropriate page of data to the GridView using the records obtained in Step 2</span></span>

<span data-ttu-id="5a489-338">Ten problem wynika z faktu, że w kroku 2 `PageIndex` używana w przypadku rekordów, aby wyświetlić dane nadal `PageIndex` ostatniej strony, którego jedynym rekord właśnie został usunięty.</span><span class="sxs-lookup"><span data-stu-id="5a489-338">The problem stems from the fact that in Step 2 the `PageIndex` used when grabbing the records to display is still the `PageIndex` of the last page whose sole record was just deleted.</span></span> <span data-ttu-id="5a489-339">W związku z tym, w kroku 2 *nie* zwracane są rekordy, ponieważ w tej ostatniej strony danych nie zawiera już żadnych rekordów.</span><span class="sxs-lookup"><span data-stu-id="5a489-339">Therefore, in Step 2, *no* records are returned since that last page of data no longer contains any records.</span></span> <span data-ttu-id="5a489-340">Następnie, w kroku 3 widoku GridView zdaje sobie sprawę, że jego `PageIndex` właściwości jest większa niż łączna liczba stron w źródle danych (ponieważ możemy ve usunąć ostatni rekord w ostatniej strony) i w związku z tym zmniejsza jego `PageIndex` właściwości.</span><span class="sxs-lookup"><span data-stu-id="5a489-340">Then, in Step 3, the GridView realizes that its `PageIndex` property is greater than the total number of pages in the data source (since we ve deleted the last record in the last page) and therefore decrements its `PageIndex` property.</span></span> <span data-ttu-id="5a489-341">W kroku 4 próbuje się powiązać danych pobranych w kroku 2; widoku GridView Jednak w kroku 2 nie zwrócono żadnych rekordów, w związku z tym wynikiem pusty GridView.</span><span class="sxs-lookup"><span data-stu-id="5a489-341">In Step 4 the GridView attempts to bind itself to the data retrieved in Step 2; however, in Step 2 no records were returned, therefore resulting in an empty GridView.</span></span> <span data-ttu-id="5a489-342">Za pomocą stronicowania domyślnej ten problem t powierzchni, ponieważ w kroku 2 *wszystkich* pobierania rekordów ze źródła danych.</span><span class="sxs-lookup"><span data-stu-id="5a489-342">With default paging, this problem doesn t surface because in Step 2 *all* records are retrieved from the data source.</span></span>

<span data-ttu-id="5a489-343">Aby rozwiązać ten problem mamy dwie opcje.</span><span class="sxs-lookup"><span data-stu-id="5a489-343">To fix this we have two options.</span></span> <span data-ttu-id="5a489-344">Pierwsza to aby utworzyć program obsługi zdarzeń dla GridView s `RowDeleted` program obsługi zdarzeń, która określa liczbę rekordów były wyświetlane na stronie, który właśnie został usunięty.</span><span class="sxs-lookup"><span data-stu-id="5a489-344">The first is to create an event handler for the GridView s `RowDeleted` event handler that determines how many records were displayed in the page that was just deleted.</span></span> <span data-ttu-id="5a489-345">Jeśli było tylko do jednego rekordu, rekord, po prostu usunąć musi zostać ostatni z nich i musimy dekrementacja GridView s `PageIndex`.</span><span class="sxs-lookup"><span data-stu-id="5a489-345">If there was only one record, then the record just deleted must have been the last one and we need to decrement the GridView s `PageIndex`.</span></span> <span data-ttu-id="5a489-346">Oczywiście ma być uruchamiany tylko zaktualizować `PageIndex` Jeśli rzeczywiście powiodła operacji usuwania, które można określić poprzez zapewnienie, że `e.Exception` właściwość `null`.</span><span class="sxs-lookup"><span data-stu-id="5a489-346">Of course, we only want to update the `PageIndex` if the delete operation was actually successful, which can be determined by ensuring that the `e.Exception` property is `null`.</span></span>

<span data-ttu-id="5a489-347">Ta metoda działa, ponieważ powoduje zaktualizowanie `PageIndex` po kroku 1, ale przed krok 2.</span><span class="sxs-lookup"><span data-stu-id="5a489-347">This approach works because it updates the `PageIndex` after Step 1 but before Step 2.</span></span> <span data-ttu-id="5a489-348">W związku z tym w kroku 2, odpowiedni zestaw rekordów jest zwracana.</span><span class="sxs-lookup"><span data-stu-id="5a489-348">Therefore, in Step 2, the appropriate set of records is returned.</span></span> <span data-ttu-id="5a489-349">W tym celu należy użyć kodu, jak pokazano poniżej:</span><span class="sxs-lookup"><span data-stu-id="5a489-349">To accomplish this, use code like the following:</span></span>


[!code-vb[Main](efficiently-paging-through-large-amounts-of-data-vb/samples/sample11.vb)]

<span data-ttu-id="5a489-350">Jeszcze inne obejście polega na utworzeniu program obsługi zdarzeń dla ObjectDataSource s `RowDeleted` zdarzenia i ustawić `AffectedRows` właściwości na wartość 1.</span><span class="sxs-lookup"><span data-stu-id="5a489-350">An alternative workaround is to create an event handler for the ObjectDataSource s `RowDeleted` event and to set the `AffectedRows` property to a value of 1.</span></span> <span data-ttu-id="5a489-351">Po usunięciu rekordu w kroku 1 (ale przed ponownym podczas pobierania danych w kroku 2), aktualizuje widoku GridView jego `PageIndex` właściwość, jeśli co najmniej jeden wiersz wpłynęła na operację.</span><span class="sxs-lookup"><span data-stu-id="5a489-351">After deleting the record in Step 1 (but before re-retrieving the data in Step 2), the GridView updates its `PageIndex` property if one or more rows were affected by the operation.</span></span> <span data-ttu-id="5a489-352">Jednak `AffectedRows` nie ustawiono właściwości według kontrolki ObjectDataSource i w związku z tym ten krok zostanie pominięty.</span><span class="sxs-lookup"><span data-stu-id="5a489-352">However, the `AffectedRows` property is not set by the ObjectDataSource and therefore this step is omitted.</span></span> <span data-ttu-id="5a489-353">Jednym ze sposobów, aby ten krok wykonywany jest ręcznie ustawić `AffectedRows` właściwości po pomyślnym ukończeniu operacji usuwania.</span><span class="sxs-lookup"><span data-stu-id="5a489-353">One way to have this step executed is to manually set the `AffectedRows` property if the delete operation completes successfully.</span></span> <span data-ttu-id="5a489-354">Można to osiągnąć przy użyciu kodu, jak pokazano poniżej:</span><span class="sxs-lookup"><span data-stu-id="5a489-354">This can be accomplished using code like the following:</span></span>


[!code-vb[Main](efficiently-paging-through-large-amounts-of-data-vb/samples/sample12.vb)]

<span data-ttu-id="5a489-355">Kod dla obu tych programów obsługi zdarzeń, można znaleźć w klasie CodeBehind `EfficientPaging.aspx` przykład.</span><span class="sxs-lookup"><span data-stu-id="5a489-355">The code for both of these events handlers can be found in code-behind class of the `EfficientPaging.aspx` example.</span></span>

## <a name="comparing-the-performance-of-default-and-custom-paging"></a><span data-ttu-id="5a489-356">Porównywanie wydajności domyślne i niestandardowe stronicowania</span><span class="sxs-lookup"><span data-stu-id="5a489-356">Comparing the Performance of Default and Custom Paging</span></span>

<span data-ttu-id="5a489-357">Ponieważ stronicowania niestandardowego pobiera tylko wymagane rekordy, natomiast zwraca domyślne stronicowania *wszystkich* rekordy na każdej stronie, można wyświetlać go s Wyczyść, że stronicowania niestandardowego jest bardziej wydajne niż domyślna stronicowania.</span><span class="sxs-lookup"><span data-stu-id="5a489-357">Since custom paging only retrieves the needed records, whereas default paging returns *all* of the records for each page being viewed, it s clear that custom paging is more efficient than default paging.</span></span> <span data-ttu-id="5a489-358">Jednak samo jak znacznie bardziej efektywne jest stronicowania niestandardowego?</span><span class="sxs-lookup"><span data-stu-id="5a489-358">But just how much more efficient is custom paging?</span></span> <span data-ttu-id="5a489-359">Jakiego rodzaju wzrost wydajności są widoczne, przechodząc z domyślną stronicowania do niestandardowych stronicowania?</span><span class="sxs-lookup"><span data-stu-id="5a489-359">What sort of performance gains can be seen by moving from default paging to custom paging?</span></span>

<span data-ttu-id="5a489-360">Niestety, występują s rozmiar jednego, nie pasuje do wszystkich odpowiedzi w tym miejscu.</span><span class="sxs-lookup"><span data-stu-id="5a489-360">Unfortunately, there s no one size fits all answer here.</span></span> <span data-ttu-id="5a489-361">Przyrost wydajności zależy od wielu czynników, najbardziej znaczącym dwie liczby rekordów są stronicowane za pośrednictwem i obciążenia są umieszczane w kanały bazy danych serwera i komunikacji między serwerem sieci web a serwerem bazy danych.</span><span class="sxs-lookup"><span data-stu-id="5a489-361">The performance gain depends on a number of factors, the most prominent two being the number of records being paged through and the load placed on the database server and communication channels between the web server and database server.</span></span> <span data-ttu-id="5a489-362">Małe tabele z kilku rekordów kilkudziesięciu różnicę w wydajności może być niewielki.</span><span class="sxs-lookup"><span data-stu-id="5a489-362">For small tables with just a few dozen records, the performance difference may be negligible.</span></span> <span data-ttu-id="5a489-363">Dla dużych tabel z tysiącami do setek tysięcy wierszy jednak różnicę w wydajności jest istotnym.</span><span class="sxs-lookup"><span data-stu-id="5a489-363">For large tables, with thousands to hundreds of thousands of rows, though, the performance difference is acute.</span></span>

<span data-ttu-id="5a489-364">Artykuł min, [stronicowania niestandardowe w programie ASP.NET 2.0 przy użyciu programu SQL Server 2005](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx), zawiera pewne testy wydajności I zakończyło się różnice w wydajności między te dwie techniki stronicowania, gdy stronicowanie tabeli bazy danych przy użyciu następującej liczby etapów stwierdzono 50 000 rekordów.</span><span class="sxs-lookup"><span data-stu-id="5a489-364">An article of mine, [Custom Paging in ASP.NET 2.0 with SQL Server 2005](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx), contains some performance tests I ran to exhibit the differences in performance between these two paging techniques when paging through a database table with 50,000 records.</span></span> <span data-ttu-id="5a489-365">W tych testach I zbadać czasu można wykonać zapytania na poziomie serwera SQL (przy użyciu [SQL Profiler](https://msdn.microsoft.com/library/ms173757.aspx)) i na stronie ASP.NET za pomocą [s śledzenia programu ASP.NET](https://msdn.microsoft.com/library/y13fw6we.aspx).</span><span class="sxs-lookup"><span data-stu-id="5a489-365">In these tests I examined both the time to execute the query at the SQL Server level (using [SQL Profiler](https://msdn.microsoft.com/library/ms173757.aspx)) and at the ASP.NET page using [ASP.NET s tracing features](https://msdn.microsoft.com/library/y13fw6we.aspx).</span></span> <span data-ttu-id="5a489-366">Należy pamiętać, że te testy były uruchamiane na Moje pole rozwoju z żadnym użytkownikiem aktywne i w związku z tym są unscientific i nie imitują wzorców obciążenia typowe witryny sieci Web.</span><span class="sxs-lookup"><span data-stu-id="5a489-366">Keep in mind that these tests were run on my development box with a single active user, and therefore are unscientific and do not mimic typical website load patterns.</span></span> <span data-ttu-id="5a489-367">Niezależnie od tego wyniki pokazują względne różnice w czasie wykonywania dla domyślnych i niestandardowych stronicowania, pracując z wystarczająco dużą ilością danych.</span><span class="sxs-lookup"><span data-stu-id="5a489-367">Regardless, the results illustrate the relative differences in execution time for default and custom paging when working with sufficiently large amounts of data.</span></span>


|  | <span data-ttu-id="5a489-368">**Średni Czas trwania (s)**</span><span class="sxs-lookup"><span data-stu-id="5a489-368">**Avg. Duration (sec)**</span></span> | <span data-ttu-id="5a489-369">**Odczytuje**</span><span class="sxs-lookup"><span data-stu-id="5a489-369">**Reads**</span></span> |
| --- | --- | --- |
| <span data-ttu-id="5a489-370">**Domyślne stronicowania SQL Profiler**</span><span class="sxs-lookup"><span data-stu-id="5a489-370">**Default Paging SQL Profiler**</span></span> | <span data-ttu-id="5a489-371">1.411</span><span class="sxs-lookup"><span data-stu-id="5a489-371">1.411</span></span> | <span data-ttu-id="5a489-372">383</span><span class="sxs-lookup"><span data-stu-id="5a489-372">383</span></span> |
| <span data-ttu-id="5a489-373">**Niestandardowe stronicowania SQL Profiler**</span><span class="sxs-lookup"><span data-stu-id="5a489-373">**Custom Paging SQL Profiler**</span></span> | <span data-ttu-id="5a489-374">0.002</span><span class="sxs-lookup"><span data-stu-id="5a489-374">0.002</span></span> | <span data-ttu-id="5a489-375">29</span><span class="sxs-lookup"><span data-stu-id="5a489-375">29</span></span> |
| <span data-ttu-id="5a489-376">**Domyślne stronicowania danych śledzenia ASP.NET**</span><span class="sxs-lookup"><span data-stu-id="5a489-376">**Default Paging ASP.NET Trace**</span></span> | <span data-ttu-id="5a489-377">2.379</span><span class="sxs-lookup"><span data-stu-id="5a489-377">2.379</span></span> | <span data-ttu-id="5a489-378">*N/D*</span><span class="sxs-lookup"><span data-stu-id="5a489-378">*N/A*</span></span> |
| <span data-ttu-id="5a489-379">**Niestandardowe śledzenia ASP.NET stronicowania**</span><span class="sxs-lookup"><span data-stu-id="5a489-379">**Custom Paging ASP.NET Trace**</span></span> | <span data-ttu-id="5a489-380">0.029</span><span class="sxs-lookup"><span data-stu-id="5a489-380">0.029</span></span> | <span data-ttu-id="5a489-381">*N/D*</span><span class="sxs-lookup"><span data-stu-id="5a489-381">*N/A*</span></span> |


<span data-ttu-id="5a489-382">Jak widać, podczas pobierania określonej strony danych średnio wymagane 354 mniej operacji odczytu i ukończyć w zaledwie ułamku czasu.</span><span class="sxs-lookup"><span data-stu-id="5a489-382">As you can see, retrieving a particular page of data required 354 less reads on average and completed in a fraction of the time.</span></span> <span data-ttu-id="5a489-383">Na stronie ASP.NET niestandardowe strony był w stanie renderowane w pobliżu 1/100<sup>th</sup> czasu, jaki zajęło podczas korzystania z domyślnej stronicowania.</span><span class="sxs-lookup"><span data-stu-id="5a489-383">At the ASP.NET page, custom the page was able to render in close to 1/100<sup>th</sup> of the time it took when using default paging.</span></span> <span data-ttu-id="5a489-384">Zobacz [Moje artykułu](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx) Aby uzyskać więcej informacji na temat tych wyników, wraz z kodem i bazę danych można pobrać w celu odtworzenia te testy we własnym środowisku.</span><span class="sxs-lookup"><span data-stu-id="5a489-384">See [my article](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx) for more information on these results along with code and a database you can download to reproduce these tests in your own environment.</span></span>

## <a name="summary"></a><span data-ttu-id="5a489-385">Podsumowanie</span><span class="sxs-lookup"><span data-stu-id="5a489-385">Summary</span></span>

<span data-ttu-id="5a489-386">Stronicowanie domyślny jest proste wdrożenie po prostu wyboru pole wyboru Włącz stronicowania w danych w sieci Web kontroli s tagu, ale takie uproszczenia pochodzi kosztem wydajności.</span><span class="sxs-lookup"><span data-stu-id="5a489-386">Default paging is a cinch to implement just check the Enable Paging checkbox in the data Web control s smart tag but such simplicity comes at the cost of performance.</span></span> <span data-ttu-id="5a489-387">Za pomocą domyślnego stronicowania, gdy użytkownik zażąda dowolnej strony danych *wszystkich* zwracane są rekordy, nawet jeśli tylko niewielki ułamek z nich mogą być wyświetlane.</span><span class="sxs-lookup"><span data-stu-id="5a489-387">With default paging, when a user requests any page of data *all* records are returned, even though only a tiny fraction of them may be shown.</span></span> <span data-ttu-id="5a489-388">Aby walczyć z tym zmniejszenie wydajności kontrolki ObjectDataSource oferuje alternatywną stronicowania niestandardowych opcji stronicowania.</span><span class="sxs-lookup"><span data-stu-id="5a489-388">To combat this performance overhead, the ObjectDataSource offers an alternative paging option custom paging.</span></span>

<span data-ttu-id="5a489-389">Gdy stronicowania niestandardowego poprawia domyślnego stronicowania problemy z wydajnością s przez pobieranie tylko te rekordy, które muszą zostać wyświetlone, jego s więcej wysiłku zaimplementować niestandardowy stronicowania.</span><span class="sxs-lookup"><span data-stu-id="5a489-389">While custom paging improves upon default paging s performance issues by retrieving only those records that need to be displayed, it s more involved to implement custom paging.</span></span> <span data-ttu-id="5a489-390">Po pierwsze zapytanie musi być napisana, który prawidłowo (i efektywnie) uzyskuje dostęp do określony podzbiór żądanych rekordów.</span><span class="sxs-lookup"><span data-stu-id="5a489-390">First, a query must be written that correctly (and efficiently) accesses the specific subset of records requested.</span></span> <span data-ttu-id="5a489-391">Można to zrobić na wiele sposobów; jeden zbadaliśmy w ramach tego samouczka jest użycie programu SQL Server 2005 s nowego `ROW_NUMBER()` wyniki funkcji rangę, a następnie zwracać tylko te wyniki, których klasyfikacji mieści się w określonym zakresie.</span><span class="sxs-lookup"><span data-stu-id="5a489-391">This can be accomplished in a number of ways; the one we examined in this tutorial is to use SQL Server 2005 s new `ROW_NUMBER()` function to rank results, and then to return just those results whose ranking falls within a specified range.</span></span> <span data-ttu-id="5a489-392">Ponadto należy dodać środki do określenia całkowita liczba rekordów, które są stronicowane za pośrednictwem.</span><span class="sxs-lookup"><span data-stu-id="5a489-392">Furthermore, we need to add a means to determine the total number of records being paged through.</span></span> <span data-ttu-id="5a489-393">Po utworzeniu tych metod DAL i logiki warstwy Biznesowej, należy również skonfigurować kontrolki ObjectDataSource, dzięki czemu można określić, ile łącznie rekordów są są stronicowane za pośrednictwem i poprawnie można przekazać wartości Rozpocznij indeks wiersza i maksymalna liczba wierszy do LOGIKI.</span><span class="sxs-lookup"><span data-stu-id="5a489-393">After creating these DAL and BLL methods, we also need to configure the ObjectDataSource so that it can determine how many total records are being paged through and can correctly pass the Start Row Index and Maximum Rows values to the BLL.</span></span>

<span data-ttu-id="5a489-394">Implementowanie stronicowania niestandardowe wymagają wielu kroków i nie niemal sprowadza się stronicowania domyślne, stronicowania niestandardowego jest to konieczne, jeśli stronicowanie wystarczająco duże ilości danych.</span><span class="sxs-lookup"><span data-stu-id="5a489-394">While implementing custom paging does require a number of steps and is not nearly as simple as default paging, custom paging is a necessity when paging through sufficiently large amounts of data.</span></span> <span data-ttu-id="5a489-395">Jak wyniki badania stronicowania pokazały, że, niestandardowe można zmniejszenia sekund poza czas renderowania strony ASP.NET i rozjaśnić obciążenia na serwerze bazy danych przez jedną lub więcej rzędów.</span><span class="sxs-lookup"><span data-stu-id="5a489-395">As the results examined showed, custom paging can shed seconds off of the ASP.NET page render time and can lighten the load on the database server by one ore more orders of magnitude.</span></span>

<span data-ttu-id="5a489-396">Wszystkiego najlepszego programowania!</span><span class="sxs-lookup"><span data-stu-id="5a489-396">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="5a489-397">Informacje o autorze</span><span class="sxs-lookup"><span data-stu-id="5a489-397">About the Author</span></span>

<span data-ttu-id="5a489-398">[Scott Bento](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor siedem ASP/ASP.NET książek i założycielem [4GuysFromRolla.com](http://www.4guysfromrolla.com), pracował nad przy użyciu technologii Microsoft Web od 1998 r.</span><span class="sxs-lookup"><span data-stu-id="5a489-398">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="5a489-399">Scott działa jako niezależny Konsultant, trainer i składnika zapisywania.</span><span class="sxs-lookup"><span data-stu-id="5a489-399">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="5a489-400">Jego najnowszą książkę Stephena [ *Sams uczyć się ASP.NET 2.0 w ciągu 24 godzin*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="5a489-400">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="5a489-401">ADAM można z Tobą skontaktować w [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="5a489-401">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="5a489-402">lub za pośrednictwem jego blogu, który znajduje się w temacie [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="5a489-402">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="5a489-403">[Poprzednie](paging-and-sorting-report-data-vb.md)
> [dalej](sorting-custom-paged-data-vb.md)</span><span class="sxs-lookup"><span data-stu-id="5a489-403">[Previous](paging-and-sorting-report-data-vb.md)
[Next](sorting-custom-paged-data-vb.md)</span></span>
