---
uid: web-forms/overview/data-access/editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs
title: Obsługa wyjątków na poziomie LOGIKI biznesowej i DAL na stronie ASP.NET (C#) | Microsoft Docs
author: rick-anderson
description: W tym samouczku zobaczysz, jak wyświetlić przyjazny, informacyjny komunikat o błędzie, jeśli wystąpi wyjątek podczas operacji INSERT, Update lub DELETE...
ms.author: riande
ms.date: 07/17/2006
ms.assetid: 49d8a66c-3ea8-4087-839f-179d1d94512a
msc.legacyurl: /web-forms/overview/data-access/editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs
msc.type: authoredcontent
ms.openlocfilehash: 2b9cdb5af6f33171b191d5a80473c7796eb098d9
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 03/06/2020
ms.locfileid: "78608389"
---
# <a name="handling-bll--and-dal-level-exceptions-in-an-aspnet-page-c"></a><span data-ttu-id="50bcd-103">Obsługa wyjątków na poziomie warstwy logiki biznesowej i warstwy dostępu do danych na stronie platformy ASP.NET (C#)</span><span class="sxs-lookup"><span data-stu-id="50bcd-103">Handling BLL- and DAL-Level Exceptions in an ASP.NET Page (C#)</span></span>

<span data-ttu-id="50bcd-104">przez [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="50bcd-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="50bcd-105">[Pobierz przykładową aplikację](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_18_CS.exe) lub [Pobierz plik PDF](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/datatutorial18cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="50bcd-105">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_18_CS.exe) or [Download PDF](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/datatutorial18cs1.pdf)</span></span>

> <span data-ttu-id="50bcd-106">W tym samouczku zobaczysz, jak wyświetlić przyjazny, informacyjny komunikat o błędzie, jeśli wystąpi wyjątek podczas operacji wstawiania, aktualizowania lub usuwania formantu sieci Web danych ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="50bcd-106">In this tutorial we will see how to display a friendly, informative error message should an exception occur during an insert, update, or delete operation of an ASP.NET data Web control.</span></span>

## <a name="introduction"></a><span data-ttu-id="50bcd-107">Wprowadzenie</span><span class="sxs-lookup"><span data-stu-id="50bcd-107">Introduction</span></span>

<span data-ttu-id="50bcd-108">Praca z danymi z aplikacji sieci Web ASP.NET przy użyciu architektury aplikacji warstwowej obejmuje następujące trzy ogólne czynności:</span><span class="sxs-lookup"><span data-stu-id="50bcd-108">Working with data from an ASP.NET web application using a tiered application architecture involves the following three general steps:</span></span>

1. <span data-ttu-id="50bcd-109">Określ, która metoda warstwy logiki biznesowej ma być wywoływana i jakie wartości parametrów należy przekazać.</span><span class="sxs-lookup"><span data-stu-id="50bcd-109">Determine what method of the Business Logic Layer needs to be invoked and what parameter values to pass it.</span></span> <span data-ttu-id="50bcd-110">Wartości parametrów mogą być sztywno kodowane, przypisane programowo lub wprowadzane przez użytkownika.</span><span class="sxs-lookup"><span data-stu-id="50bcd-110">The parameter values can be hard coded, programmatically-assigned, or inputs entered by the user.</span></span>
2. <span data-ttu-id="50bcd-111">Wywołaj metodę.</span><span class="sxs-lookup"><span data-stu-id="50bcd-111">Invoke the method.</span></span>
3. <span data-ttu-id="50bcd-112">Przetwórz wyniki.</span><span class="sxs-lookup"><span data-stu-id="50bcd-112">Process the results.</span></span> <span data-ttu-id="50bcd-113">Podczas wywoływania metody LOGIKI biznesowej, która zwraca dane, może to oznaczać, że dane są powiązane z formantem sieci Web danych.</span><span class="sxs-lookup"><span data-stu-id="50bcd-113">When calling a BLL method that returns data, this may involve binding the data to a data Web control.</span></span> <span data-ttu-id="50bcd-114">W przypadku metod LOGIKI biznesowej, które modyfikują dane, może to obejmować wykonywanie niektórych akcji na podstawie zwracanej wartości lub bezpieczne obsługiwanie dowolnego wyjątku, który powstał w kroku 2.</span><span class="sxs-lookup"><span data-stu-id="50bcd-114">For BLL methods that modify data, this may include performing some action based on a return value or gracefully handling any exception that arose in Step 2.</span></span>

<span data-ttu-id="50bcd-115">Jak zostało to opisane w [poprzednim samouczku](examining-the-events-associated-with-inserting-updating-and-deleting-cs.md), zarówno element ObjectDataSource, jak i kontrolki sieci Web danych udostępniają punkty rozszerzalności dla kroków 1 i 3.</span><span class="sxs-lookup"><span data-stu-id="50bcd-115">As we saw in the [previous tutorial](examining-the-events-associated-with-inserting-updating-and-deleting-cs.md), both the ObjectDataSource and the data Web controls provide extensibility points for Steps 1 and 3.</span></span> <span data-ttu-id="50bcd-116">Widok GridView, na przykład, wyzwala zdarzenie `RowUpdating` przed przypisaniem wartości pól do kolekcji `UpdateParameters` elementu ObjectDataSource; `RowUpdated` zdarzenie jest wywoływane po zakończeniu operacji przez element ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="50bcd-116">The GridView, for example, fires its `RowUpdating` event prior to assigning its field values to its ObjectDataSource's `UpdateParameters` collection; its `RowUpdated` event is raised after the ObjectDataSource has completed the operation.</span></span>

<span data-ttu-id="50bcd-117">Zbadamy już zdarzenia wyzwalane w kroku 1 i dowiesz się, jak można je użyć do dostosowania parametrów wejściowych lub anulowania operacji.</span><span class="sxs-lookup"><span data-stu-id="50bcd-117">We've already examined the events that fire during Step 1 and have seen how they can be used to customize the input parameters or cancel the operation.</span></span> <span data-ttu-id="50bcd-118">W tym samouczku powrócimy do zdarzeń wyzwalanych po zakończeniu operacji.</span><span class="sxs-lookup"><span data-stu-id="50bcd-118">In this tutorial we'll turn our attention to the events that fire after the operation has completed.</span></span> <span data-ttu-id="50bcd-119">Korzystając z tych programów obsługi zdarzeń na poziomie, możemy między innymi ustalić, czy wystąpił wyjątek podczas operacji i obsłużyć go bezpiecznie, wyświetlając przyjazny, informacyjny komunikat o błędzie na ekranie zamiast domyślnego standardu ASP.NET Strona wyjątków.</span><span class="sxs-lookup"><span data-stu-id="50bcd-119">With these post-level event handlers we can, among other things, determine if an exception occurred during the operation and handle it gracefully, displaying a friendly, informative error message on the screen rather than defaulting to the standard ASP.NET exception page.</span></span>

<span data-ttu-id="50bcd-120">Aby zilustrować pracę z tymi zdarzeniami pocztowymi, Utwórzmy stronę, która wyświetla listę produktów w edytowalnym widoku GridView.</span><span class="sxs-lookup"><span data-stu-id="50bcd-120">To illustrate working with these post-level events, let's create a page that lists the products in an editable GridView.</span></span> <span data-ttu-id="50bcd-121">Podczas aktualizowania produktu, jeśli zostanie zgłoszony wyjątek, na stronie ASP.NET zostanie wyświetlony krótki komunikat powyżej widoku GridView wyjaśniającego, że wystąpił problem.</span><span class="sxs-lookup"><span data-stu-id="50bcd-121">When updating a product, if an exception is raised our ASP.NET page will display a short message above the GridView explaining that a problem has occurred.</span></span> <span data-ttu-id="50bcd-122">Zacznijmy!</span><span class="sxs-lookup"><span data-stu-id="50bcd-122">Let's get started!</span></span>

## <a name="step-1-creating-an-editable-gridview-of-products"></a><span data-ttu-id="50bcd-123">Krok 1. Tworzenie edytowalnego widoku GridView produktów</span><span class="sxs-lookup"><span data-stu-id="50bcd-123">Step 1: Creating an Editable GridView of Products</span></span>

<span data-ttu-id="50bcd-124">W poprzednim samouczku utworzyliśmy edytowalny widok GridView zawierający tylko dwa pola, `ProductName` i `UnitPrice`.</span><span class="sxs-lookup"><span data-stu-id="50bcd-124">In the previous tutorial we created an editable GridView with just two fields, `ProductName` and `UnitPrice`.</span></span> <span data-ttu-id="50bcd-125">Wymaga to utworzenia dodatkowego przeciążenia dla metody `UpdateProduct` klasy `ProductsBLL`, która akceptuje tylko trzy parametry wejściowe (Nazwa produktu, Cena jednostkowa i identyfikator), jako przeciwieństwo parametru dla każdego pola produktu.</span><span class="sxs-lookup"><span data-stu-id="50bcd-125">This required creating an additional overload for the `ProductsBLL` class's `UpdateProduct` method, one that only accepted three input parameters (the product's name, unit price, and ID) as opposed a parameter for each product field.</span></span> <span data-ttu-id="50bcd-126">Na potrzeby tego samouczka należy ponownie wykonać tę technikę, tworząc edytowalny widok GridView, który wyświetla nazwę produktu, ilość na jednostkę, cenę jednostkową i jednostki w magazynie, ale tylko umożliwia edytowanie nazwy, ceny jednostkowej i jednostek w magazynie.</span><span class="sxs-lookup"><span data-stu-id="50bcd-126">For this tutorial, let's practice this technique again, creating an editable GridView that displays the product's name, quantity per unit, unit price, and units in stock, but only allows the name, unit price, and units in stock to be edited.</span></span>

<span data-ttu-id="50bcd-127">Aby obsłużyć ten scenariusz, konieczne będzie inne Przeciążenie metody `UpdateProduct`, która akceptuje cztery parametry: nazwę produktu, cenę jednostkową, jednostki w magazynie i identyfikator.</span><span class="sxs-lookup"><span data-stu-id="50bcd-127">To accommodate this scenario we'll need another overload of the `UpdateProduct` method, one that accepts four parameters: the product's name, unit price, units in stock, and ID.</span></span> <span data-ttu-id="50bcd-128">Dodaj następującą metodę do klasy `ProductsBLL`:</span><span class="sxs-lookup"><span data-stu-id="50bcd-128">Add the following method to the `ProductsBLL` class:</span></span>

[!code-csharp[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/samples/sample1.cs)]

<span data-ttu-id="50bcd-129">Po ukończeniu tej metody wszystko jest gotowe do utworzenia strony ASP.NET, która umożliwia edytowanie tych czterech konkretnych pól produktu.</span><span class="sxs-lookup"><span data-stu-id="50bcd-129">With this method complete, we're ready to create the ASP.NET page that allows for editing these four particular product fields.</span></span> <span data-ttu-id="50bcd-130">Otwórz stronę `ErrorHandling.aspx` w folderze `EditInsertDelete` i Dodaj widok GridView do strony za pomocą narzędzia Projektant.</span><span class="sxs-lookup"><span data-stu-id="50bcd-130">Open the `ErrorHandling.aspx` page in the `EditInsertDelete` folder and add a GridView to the page through the Designer.</span></span> <span data-ttu-id="50bcd-131">Powiąż widok GridView z nowym elementem ObjectDataSource, mapując metodę `Select()` na metodę `GetProducts()` klasy `ProductsBLL` i metodę `Update()` do właśnie utworzonego przeciążenia `UpdateProduct`.</span><span class="sxs-lookup"><span data-stu-id="50bcd-131">Bind the GridView to a new ObjectDataSource, mapping the `Select()` method to the `ProductsBLL` class's `GetProducts()` method and the `Update()` method to the `UpdateProduct` overload just created.</span></span>

<span data-ttu-id="50bcd-132">[![użyć przeciążenia metody UpdateProduct, które akceptuje cztery parametry wejściowe](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image2.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="50bcd-132">[![Use the UpdateProduct Method Overload That Accepts Four Input Parameters](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image2.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image1.png)</span></span>

<span data-ttu-id="50bcd-133">**Rysunek 1**. Użyj przeciążenia metody `UpdateProduct`, która akceptuje cztery parametry wejściowe ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="50bcd-133">**Figure 1**: Use the `UpdateProduct` Method Overload That Accepts Four Input Parameters ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image3.png))</span></span>

<span data-ttu-id="50bcd-134">Spowoduje to utworzenie elementu ObjectDataSource z kolekcją `UpdateParameters` z czterema parametrami i elementem GridView zawierającym pole dla każdego pola produktu.</span><span class="sxs-lookup"><span data-stu-id="50bcd-134">This will create an ObjectDataSource with an `UpdateParameters` collection with four parameters and a GridView with a field for each of the product fields.</span></span> <span data-ttu-id="50bcd-135">Deklaratywne znaczniki elementu ObjectDataSource przypisuje Właściwość `OldValuesParameterFormatString` wartość `original_{0}`, co spowoduje wyjątek, ponieważ nasze klasy LOGIKI biznesowej nie oczekują parametru wejściowego o nazwie `original_productID` do przekazania.</span><span class="sxs-lookup"><span data-stu-id="50bcd-135">The ObjectDataSource's declarative markup assigns the `OldValuesParameterFormatString` property the value `original_{0}`, which will cause an exception since our BLL class's don't expect an input parameter named `original_productID` to be passed in.</span></span> <span data-ttu-id="50bcd-136">Nie zapomnij usunąć tego ustawienia całkowicie ze składni deklaratywnej (lub ustaw ją na wartość domyślną, `{0}`).</span><span class="sxs-lookup"><span data-stu-id="50bcd-136">Don't forget to remove this setting altogether from the declarative syntax (or set it to the default value, `{0}`).</span></span>

<span data-ttu-id="50bcd-137">Następnie dostosowanie widok GridView, aby uwzględnić tylko `ProductName`, `QuantityPerUnit`, `UnitPrice`i `UnitsInStock` BoundFields.</span><span class="sxs-lookup"><span data-stu-id="50bcd-137">Next, pare down the GridView to include only the `ProductName`, `QuantityPerUnit`, `UnitPrice`, and `UnitsInStock` BoundFields.</span></span> <span data-ttu-id="50bcd-138">Możesz również zastosować dowolne formatowanie na poziomie pola, które jest uznawane za niezbędne (na przykład zmiana właściwości `HeaderText`).</span><span class="sxs-lookup"><span data-stu-id="50bcd-138">Also feel free to apply any field-level formatting you deem necessary (such as changing the `HeaderText` properties).</span></span>

<span data-ttu-id="50bcd-139">W poprzednim samouczku przedstawiono sposób formatowania `UnitPrice` BoundField jako waluty zarówno w trybie tylko do odczytu, jak i w trybie edycji.</span><span class="sxs-lookup"><span data-stu-id="50bcd-139">In the previous tutorial we looked at how to format the `UnitPrice` BoundField as a currency both in read-only mode and edit mode.</span></span> <span data-ttu-id="50bcd-140">Zróbmy to teraz.</span><span class="sxs-lookup"><span data-stu-id="50bcd-140">Let's do the same here.</span></span> <span data-ttu-id="50bcd-141">Odwołaj to wymagające ustawienia właściwości `DataFormatString` BoundField na `{0:c}`, jej Właściwość `HtmlEncode` na `false`i `ApplyFormatInEditMode` do `true`, jak pokazano na rysunku 2.</span><span class="sxs-lookup"><span data-stu-id="50bcd-141">Recall that this required setting the BoundField's `DataFormatString` property to `{0:c}`, its `HtmlEncode` property to `false`, and its `ApplyFormatInEditMode` to `true`, as shown in Figure 2.</span></span>

<span data-ttu-id="50bcd-142">[![skonfigurować BoundField CenaJednostkowa do wyświetlania jako waluta](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image5.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="50bcd-142">[![Configure the UnitPrice BoundField to Display as a Currency](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image5.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image4.png)</span></span>

<span data-ttu-id="50bcd-143">**Rysunek 2**. Konfigurowanie `UnitPrice` BoundField do wyświetlania jako waluta ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="50bcd-143">**Figure 2**: Configure the `UnitPrice` BoundField to Display as a Currency ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image6.png))</span></span>

<span data-ttu-id="50bcd-144">Formatowanie `UnitPrice` jako waluty w interfejsie edycji wymaga utworzenia programu obsługi zdarzeń dla zdarzenia `RowUpdating` GridView, które analizuje ciąg w formacie waluty w wartości `decimal`.</span><span class="sxs-lookup"><span data-stu-id="50bcd-144">Formatting the `UnitPrice` as a currency in the editing interface requires creating an event handler for the GridView's `RowUpdating` event that parses the currency-formatted string into a `decimal` value.</span></span> <span data-ttu-id="50bcd-145">Należy odwołać się do procedury obsługi zdarzeń `RowUpdating` z ostatniego samouczka, aby upewnić się, że użytkownik podał `UnitPrice` wartość.</span><span class="sxs-lookup"><span data-stu-id="50bcd-145">Recall that the `RowUpdating` event handler from the last tutorial also checked to ensure that the user provided a `UnitPrice` value.</span></span> <span data-ttu-id="50bcd-146">Jednak w tym samouczku zezwolisz użytkownikowi na pominięcie ceny.</span><span class="sxs-lookup"><span data-stu-id="50bcd-146">However, for this tutorial let's allow the user to omit the price.</span></span>

[!code-csharp[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/samples/sample2.cs)]

<span data-ttu-id="50bcd-147">Nasz widok GridView zawiera `QuantityPerUnit` BoundField, ale ten BoundField powinien być tylko do wyświetlania i nie powinien być edytowalny przez użytkownika.</span><span class="sxs-lookup"><span data-stu-id="50bcd-147">Our GridView includes a `QuantityPerUnit` BoundField, but this BoundField should be only for display purposes and should not be editable by the user.</span></span> <span data-ttu-id="50bcd-148">Aby to rozmieścić, po prostu ustaw właściwość `ReadOnly` BoundFields ' na `true`.</span><span class="sxs-lookup"><span data-stu-id="50bcd-148">To arrange this, simply set the BoundFields' `ReadOnly` property to `true`.</span></span>

<span data-ttu-id="50bcd-149">[![QuantityPerUnit BoundField tylko do odczytu](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image8.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="50bcd-149">[![Make the QuantityPerUnit BoundField Read-Only](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image8.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image7.png)</span></span>

<span data-ttu-id="50bcd-150">**Rysunek 3**. uczyń `QuantityPerUnit` BoundField tylko do odczytu ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="50bcd-150">**Figure 3**: Make the `QuantityPerUnit` BoundField Read-Only ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image9.png))</span></span>

<span data-ttu-id="50bcd-151">Na koniec zaznacz pole wyboru Włącz edytowanie w tagu inteligentnym GridView.</span><span class="sxs-lookup"><span data-stu-id="50bcd-151">Finally, check the Enable Editing checkbox from the GridView's smart tag.</span></span> <span data-ttu-id="50bcd-152">Po wykonaniu tych kroków Projektant strony `ErrorHandling.aspx` powinien wyglądać podobnie do rysunku 4.</span><span class="sxs-lookup"><span data-stu-id="50bcd-152">After completing these steps the `ErrorHandling.aspx` page's Designer should look similar to Figure 4.</span></span>

<span data-ttu-id="50bcd-153">[![usunąć wszystkie oprócz wymaganych BoundFields i zaznacz pole wyboru Włącz edycję](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image11.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="50bcd-153">[![Remove All But the Needed BoundFields and Check the Enable Editing Checkbox](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image11.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image10.png)</span></span>

<span data-ttu-id="50bcd-154">**Ilustracja 4**. Usuń wszystkie oprócz wymaganych BoundFields i zaznacz pole wyboru Włącz edycję ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="50bcd-154">**Figure 4**: Remove All But the Needed BoundFields and Check the Enable Editing Checkbox ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image12.png))</span></span>

<span data-ttu-id="50bcd-155">W tym momencie mamy listę wszystkich pól `ProductName`, `QuantityPerUnit`, `UnitPrice`i `UnitsInStock` produktów. można jednak edytować tylko pola `ProductName`, `UnitPrice`i `UnitsInStock`.</span><span class="sxs-lookup"><span data-stu-id="50bcd-155">At this point we have a list of all of the products' `ProductName`, `QuantityPerUnit`, `UnitPrice`, and `UnitsInStock` fields; however, only the `ProductName`, `UnitPrice`, and `UnitsInStock` fields can be edited.</span></span>

<span data-ttu-id="50bcd-156">[![użytkownicy mogą teraz łatwo edytować nazwy produktów, ceny i jednostki w polach zasobów](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image14.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="50bcd-156">[![Users Can Now Easily Edit Products' Names, Prices, and Units In Stock Fields](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image14.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image13.png)</span></span>

<span data-ttu-id="50bcd-157">**Rysunek 5**. Użytkownicy mogą teraz łatwo edytować nazwy produktów, ceny i jednostki w polach podstawowych ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="50bcd-157">**Figure 5**: Users Can Now Easily Edit Products' Names, Prices, and Units In Stock Fields ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image15.png))</span></span>

## <a name="step-2-gracefully-handling-dal-level-exceptions"></a><span data-ttu-id="50bcd-158">Krok 2. bezpieczne obsługiwanie wyjątków na poziomie DAL</span><span class="sxs-lookup"><span data-stu-id="50bcd-158">Step 2: Gracefully Handling DAL-Level Exceptions</span></span>

<span data-ttu-id="50bcd-159">Mimo że ten edytowalny widok GridView działa bardzo dobrze, gdy użytkownicy wprowadzają wartości prawne dotyczące nazwy, ceny i jednostek edytowanego produktu, wprowadzenie niedozwolonych wartości spowoduje wyjątek.</span><span class="sxs-lookup"><span data-stu-id="50bcd-159">While our editable GridView works wonderfully when users enter legal values for the edited product's name, price, and units in stock, entering illegal values results in an exception.</span></span> <span data-ttu-id="50bcd-160">Na przykład pominięcie wartości `ProductName` powoduje zgłoszenie [NoNullAllowedException](https://msdn.microsoft.com/library/default.asp?url=/library/cpref/html/frlrfsystemdatanonullallowedexceptionclasstopic.asp) , ponieważ właściwość `ProductName` w klasie `ProductsRow` ma właściwość `AllowDBNull` ustawioną na `false`; Jeśli baza danych nie działa, podczas próby nawiązania połączenia z bazą danych `SqlException` zostanie wygenerowany przez TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="50bcd-160">For example, omitting the `ProductName` value causes a [NoNullAllowedException](https://msdn.microsoft.com/library/default.asp?url=/library/cpref/html/frlrfsystemdatanonullallowedexceptionclasstopic.asp) to be thrown since the `ProductName` property in the `ProductsRow` class has its `AllowDBNull` property set to `false`; if the database is down, a `SqlException` will be thrown by the TableAdapter when attempting to connect to the database.</span></span> <span data-ttu-id="50bcd-161">Bez podejmowania żadnych działań te wyjątki są bąbelkowe w warstwie dostępu do danych do warstwy logiki biznesowej, a następnie do strony ASP.NET, a wreszcie do środowiska uruchomieniowego ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="50bcd-161">Without taking any action, these exceptions bubble up from the Data Access Layer to the Business Logic Layer, then to the ASP.NET page, and finally to the ASP.NET runtime.</span></span>

<span data-ttu-id="50bcd-162">W zależności od sposobu skonfigurowania aplikacji sieci Web i bez względu na to, czy odwiedzasz aplikację z `localhost`, nieobsługiwany wyjątek może skutkować ogólną stroną serwera — błąd, szczegółowy raport o błędach lub stronę sieci Web przyjazną dla użytkownika.</span><span class="sxs-lookup"><span data-stu-id="50bcd-162">Depending on how your web application is configured and whether or not you're visiting the application from `localhost`, an unhandled exception can result in either a generic server-error page, a detailed error report, or a user-friendly web page.</span></span> <span data-ttu-id="50bcd-163">Zobacz [Obsługa błędów aplikacji sieci Web w ASP.NET](http://www.15seconds.com/issue/030102.htm) i [element customErrors](https://msdn.microsoft.com/library/h0hfz6fc(VS.80).aspx) , aby uzyskać więcej informacji na temat sposobu, w jaki środowisko uruchomieniowe ASP.NET reaguje na nieprzechwycony wyjątek.</span><span class="sxs-lookup"><span data-stu-id="50bcd-163">See [Web Application Error Handling in ASP.NET](http://www.15seconds.com/issue/030102.htm) and the [customErrors Element](https://msdn.microsoft.com/library/h0hfz6fc(VS.80).aspx) for more information on how the ASP.NET runtime responds to an uncaught exception.</span></span>

<span data-ttu-id="50bcd-164">Rysunek 6 przedstawia ekran napotkany podczas próby zaktualizowania produktu bez określania wartości `ProductName`.</span><span class="sxs-lookup"><span data-stu-id="50bcd-164">Figure 6 shows the screen encountered when attempting to update a product without specifying the `ProductName` value.</span></span> <span data-ttu-id="50bcd-165">Jest to domyślny szczegółowy raport o błędach wyświetlany podczas przechodzenia przez `localhost`.</span><span class="sxs-lookup"><span data-stu-id="50bcd-165">This is the default detailed error report displayed when coming through `localhost`.</span></span>

<span data-ttu-id="50bcd-166">[![pominięcie nazwy produktu spowoduje wyświetlenie szczegółów wyjątku](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image17.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="50bcd-166">[![Omitting the Product's Name Will Display Exception Details](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image17.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image16.png)</span></span>

<span data-ttu-id="50bcd-167">**Ilustracja 6**. pominięcie nazwy produktu spowoduje wyświetlenie szczegółów wyjątku ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="50bcd-167">**Figure 6**: Omitting the Product's Name Will Display Exception Details ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image18.png))</span></span>

<span data-ttu-id="50bcd-168">Te szczegóły wyjątku są przydatne podczas testowania aplikacji, ale użytkownik końcowy z takim ekranem w celu zaprezentowania wyjątku jest mniejszy niż idealny.</span><span class="sxs-lookup"><span data-stu-id="50bcd-168">While such exception details are helpful when testing an application, presenting an end user with such a screen in the face of an exception is less than ideal.</span></span> <span data-ttu-id="50bcd-169">Użytkownik końcowy prawdopodobnie nie wie, co to jest `NoNullAllowedException` lub dlaczego został on spowodowany.</span><span class="sxs-lookup"><span data-stu-id="50bcd-169">An end user likely doesn't know what a `NoNullAllowedException` is or why it was caused.</span></span> <span data-ttu-id="50bcd-170">Lepszym rozwiązaniem jest zaprezentowanie użytkownikowi informacji o bardziej przyjaznym dla użytkownika komunikacie wyjaśniającym, że wystąpiły problemy podczas próby zaktualizowania produktu.</span><span class="sxs-lookup"><span data-stu-id="50bcd-170">A better approach is to present the user with a more user-friendly message explaining that there were problems attempting to update the product.</span></span>

<span data-ttu-id="50bcd-171">Jeśli wystąpi wyjątek podczas wykonywania operacji, zdarzenia na poziomie źródłowym zarówno w elemencie ObjectDataSource, jak i w kontrolce sieci Web danych zapewniają metodę wykrywania i anulowania wyjątku z propagacji do środowiska uruchomieniowego ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="50bcd-171">If an exception occurs when performing the operation, the post-level events in both the ObjectDataSource and the data Web control provide a means to detect it and cancel the exception from bubbling up to the ASP.NET runtime.</span></span> <span data-ttu-id="50bcd-172">W naszym przykładzie utworzymy procedurę obsługi zdarzeń dla zdarzenia `RowUpdated` GridView, które określa, czy wyjątek został wywołany i, jeśli tak, wyświetla szczegóły wyjątku w kontrolce sieci Web etykieta.</span><span class="sxs-lookup"><span data-stu-id="50bcd-172">For our example, let's create an event handler for the GridView's `RowUpdated` event that determines if an exception has fired and, if so, displays the exception details in a Label Web control.</span></span>

<span data-ttu-id="50bcd-173">Zacznij od dodania etykiety do strony ASP.NET, ustawiając jej Właściwość `ID` na `ExceptionDetails` i czyszcząc jej Właściwość `Text`.</span><span class="sxs-lookup"><span data-stu-id="50bcd-173">Start by adding a Label to the ASP.NET page, setting its `ID` property to `ExceptionDetails` and clearing out its `Text` property.</span></span> <span data-ttu-id="50bcd-174">Aby narysować oczy użytkownika do tej wiadomości, ustaw jej Właściwość `CssClass` na `Warning`, która jest klasą CSS dodaną do pliku `Styles.css` w poprzednim samouczku.</span><span class="sxs-lookup"><span data-stu-id="50bcd-174">In order to draw the user's eye to this message, set its `CssClass` property to `Warning`, which is a CSS class we added to the `Styles.css` file in the previous tutorial.</span></span> <span data-ttu-id="50bcd-175">Odwołaj, że ta Klasa CSS powoduje, że tekst etykiety ma być wyświetlany w kolorze czerwonym, kursywą, pogrubieniu, bardzo dużą czcionką.</span><span class="sxs-lookup"><span data-stu-id="50bcd-175">Recall that this CSS class causes the Label's text to be displayed in a red, italic, bold, extra large font.</span></span>

<span data-ttu-id="50bcd-176">[![dodać kontrolkę sieci Web etykieta do strony](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image20.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="50bcd-176">[![Add a Label Web Control to the Page](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image20.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image19.png)</span></span>

<span data-ttu-id="50bcd-177">**Rysunek 7**. Dodawanie kontrolki sieci Web etykieta do strony ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="50bcd-177">**Figure 7**: Add a Label Web Control to the Page ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image21.png))</span></span>

<span data-ttu-id="50bcd-178">Ponieważ chcę, aby formant sieci Web etykiety był widoczny tylko natychmiast po wystąpieniu wyjątku, ustaw dla jego właściwości `Visible` wartość false w programie obsługi zdarzeń `Page_Load`:</span><span class="sxs-lookup"><span data-stu-id="50bcd-178">Since we want this Label Web control to be visible only immediately after an exception has occurred, set its `Visible` property to false in the `Page_Load` event handler:</span></span>

[!code-csharp[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/samples/sample3.cs)]

<span data-ttu-id="50bcd-179">Przy użyciu tego kodu na pierwszej stronie odwiedzasz i kolejne ogłaszanie zwrotne kontrolki `ExceptionDetails` będą miały Właściwość `Visible` ustawioną na `false`.</span><span class="sxs-lookup"><span data-stu-id="50bcd-179">With this code, on the first page visit and subsequent postbacks the `ExceptionDetails` control will have its `Visible` property set to `false`.</span></span> <span data-ttu-id="50bcd-180">W przypadku wyjątku na poziomie DAL lub LOGIKI biznesowej, który możemy wykryć w programie obsługi zdarzeń `RowUpdated` GridView, ustawimy Właściwość `Visible` kontrolki `ExceptionDetails` na true.</span><span class="sxs-lookup"><span data-stu-id="50bcd-180">In the face of a DAL- or BLL-level exception, which we can detect in the GridView's `RowUpdated` event handler, we will set the `ExceptionDetails` control's `Visible` property to true.</span></span> <span data-ttu-id="50bcd-181">Ponieważ procedury obsługi zdarzeń kontrolki sieci Web występują po obsłudze zdarzeń `Page_Load` w cyklu życia strony, etykieta zostanie wyświetlona.</span><span class="sxs-lookup"><span data-stu-id="50bcd-181">Since Web control event handlers occur after the `Page_Load` event handler in the page lifecycle, the Label will be shown.</span></span> <span data-ttu-id="50bcd-182">Jednak przy następnym ogłaszaniu zwrotnym `Page_Load` obsługi zdarzeń przywraca Właściwość `Visible` z powrotem do `false`, ukrywając ją z widoku ponownie.</span><span class="sxs-lookup"><span data-stu-id="50bcd-182">However, on the next postback, the `Page_Load` event handler will revert the `Visible` property back to `false`, hiding it from view again.</span></span>

> [!NOTE]
> <span data-ttu-id="50bcd-183">Alternatywnie możemy usunąć konieczność ustawienia właściwości `Visible` kontrolki `ExceptionDetails` w `Page_Load`, przypisując jej Właściwość `Visible` `false` we składni deklaratywnej i wyłączając jej stan widoku (ustawiając jej Właściwość `EnableViewState` na `false`).</span><span class="sxs-lookup"><span data-stu-id="50bcd-183">Alternatively, we could remove the necessity for setting the `ExceptionDetails` control's `Visible` property in `Page_Load` by assigning its `Visible` property `false` in the declarative syntax and disabling its view state (setting its `EnableViewState` property to `false`).</span></span> <span data-ttu-id="50bcd-184">Ta alternatywna metoda zostanie użyta w przyszłym samouczku.</span><span class="sxs-lookup"><span data-stu-id="50bcd-184">We'll use this alternative approach in a future tutorial.</span></span>

<span data-ttu-id="50bcd-185">Po dodaniu kontrolki etykieta następnym krokiem jest utworzenie programu obsługi zdarzeń dla zdarzenia `RowUpdated` GridView.</span><span class="sxs-lookup"><span data-stu-id="50bcd-185">With the Label control added, our next step is to create the event handler for the GridView's `RowUpdated` event.</span></span> <span data-ttu-id="50bcd-186">Wybierz widok GridView w projektancie, przejdź do okno Właściwości i kliknij ikonę błyskawicy, aby wyświetlić listę zdarzeń GridView.</span><span class="sxs-lookup"><span data-stu-id="50bcd-186">Select the GridView in the Designer, go to the Properties window, and click the lightning bolt icon, listing the GridView's events.</span></span> <span data-ttu-id="50bcd-187">Istnieje już wpis dla zdarzenia `RowUpdating` GridView, ponieważ utworzyliśmy procedurę obsługi zdarzeń dla tego zdarzenia wcześniej w tym samouczku.</span><span class="sxs-lookup"><span data-stu-id="50bcd-187">There should already be an entry there for the GridView's `RowUpdating` event, as we created an event handler for this event earlier in this tutorial.</span></span> <span data-ttu-id="50bcd-188">Utwórz również procedurę obsługi zdarzeń dla zdarzenia `RowUpdated`.</span><span class="sxs-lookup"><span data-stu-id="50bcd-188">Create an event handler for the `RowUpdated` event as well.</span></span>

![Utwórz procedurę obsługi zdarzeń dla zdarzenia RowUpdated GridView](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image22.png)

<span data-ttu-id="50bcd-190">**Ilustracja 8**. Tworzenie obsługi zdarzeń dla zdarzenia `RowUpdated` GridView</span><span class="sxs-lookup"><span data-stu-id="50bcd-190">**Figure 8**: Create an Event Handler for the GridView's `RowUpdated` Event</span></span>

> [!NOTE]
> <span data-ttu-id="50bcd-191">Obsługę zdarzeń można również utworzyć za pomocą listy rozwijanej w górnej części pliku klasy związanej z kodem.</span><span class="sxs-lookup"><span data-stu-id="50bcd-191">You can also create the event handler through the drop-down lists at the top of the code-behind class file.</span></span> <span data-ttu-id="50bcd-192">Z listy rozwijanej po lewej stronie `RowUpdated` i po prawej stronie wybierz pozycję GridView.</span><span class="sxs-lookup"><span data-stu-id="50bcd-192">Select the GridView from the drop-down list on the left and the `RowUpdated` event from the one on the right.</span></span>

<span data-ttu-id="50bcd-193">Utworzenie tego programu obsługi zdarzeń spowoduje dodanie następującego kodu do klasy związanej z kodem ASP.NET strony:</span><span class="sxs-lookup"><span data-stu-id="50bcd-193">Creating this event handler will add the following code to the ASP.NET page's code-behind class:</span></span>

[!code-csharp[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/samples/sample4.cs)]

<span data-ttu-id="50bcd-194">Drugi parametr wejściowy programu obsługi zdarzeń jest obiektem typu [GridViewUpdatedEventArgs](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewupdatedeventargs.aspx), który ma trzy właściwości istotne dla obsługi wyjątków:</span><span class="sxs-lookup"><span data-stu-id="50bcd-194">This event handler's second input parameter is an object of type [GridViewUpdatedEventArgs](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewupdatedeventargs.aspx), which has three properties of interest for handling exceptions:</span></span>

- <span data-ttu-id="50bcd-195">`Exception` odwołanie do zgłoszonego wyjątku; Jeśli żaden wyjątek nie został zgłoszony, ta właściwość będzie mieć wartość `null`</span><span class="sxs-lookup"><span data-stu-id="50bcd-195">`Exception` a reference to the thrown exception; if no exception has been thrown, this property will have a value of `null`</span></span>
- <span data-ttu-id="50bcd-196">`ExceptionHandled` wartość logiczna, która wskazuje, czy wyjątek został obsłużony w programie obsługi zdarzeń `RowUpdated`; Jeśli `false` (wartość domyślna), wyjątek jest ponownie zgłaszany, percolating do środowiska uruchomieniowego ASP.NET</span><span class="sxs-lookup"><span data-stu-id="50bcd-196">`ExceptionHandled` a Boolean value that indicates whether or not the exception was handled in the `RowUpdated` event handler; if `false` (the default), the exception is re-thrown, percolating up to the ASP.NET runtime</span></span>
- <span data-ttu-id="50bcd-197">`KeepInEditMode`, jeśli ustawiono, `true` edytowany wiersz GridView pozostaje w trybie edycji; Jeśli `false` (wartość domyślna), wiersz GridView wraca do swojego trybu tylko do odczytu</span><span class="sxs-lookup"><span data-stu-id="50bcd-197">`KeepInEditMode` if set to `true` the edited GridView row remains in edit mode; if `false` (the default), the GridView row reverts back to its read-only mode</span></span>

<span data-ttu-id="50bcd-198">Nasz kod, a następnie powinien sprawdzić, czy `Exception` nie jest `null`, co oznacza, że wyjątek został zgłoszony podczas wykonywania operacji.</span><span class="sxs-lookup"><span data-stu-id="50bcd-198">Our code, then, should check to see if `Exception` is not `null`, meaning that an exception was raised while performing the operation.</span></span> <span data-ttu-id="50bcd-199">W takim przypadku chcemy:</span><span class="sxs-lookup"><span data-stu-id="50bcd-199">If this is the case, we want to:</span></span>

- <span data-ttu-id="50bcd-200">Wyświetl przyjazny dla użytkownika komunikat w etykiecie `ExceptionDetails`</span><span class="sxs-lookup"><span data-stu-id="50bcd-200">Display a user-friendly message in the `ExceptionDetails` Label</span></span>
- <span data-ttu-id="50bcd-201">Wskaż, że wyjątek został obsłużony</span><span class="sxs-lookup"><span data-stu-id="50bcd-201">Indicate that the exception was handled</span></span>
- <span data-ttu-id="50bcd-202">Zachowaj wiersz GridView w trybie edycji</span><span class="sxs-lookup"><span data-stu-id="50bcd-202">Keep the GridView row in edit mode</span></span>

<span data-ttu-id="50bcd-203">Ten kod realizuje następujące cele:</span><span class="sxs-lookup"><span data-stu-id="50bcd-203">This following code accomplishes these objectives:</span></span>

[!code-csharp[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/samples/sample5.cs)]

<span data-ttu-id="50bcd-204">Ta procedura obsługi zdarzeń rozpoczyna się od sprawdzenia, czy `e.Exception` jest `null`.</span><span class="sxs-lookup"><span data-stu-id="50bcd-204">This event handler begins by checking to see if `e.Exception` is `null`.</span></span> <span data-ttu-id="50bcd-205">Jeśli tak nie jest, właściwość `Visible` `ExceptionDetails` etykiety jest ustawiona na `true` i jej Właściwość `Text` na "Wystąpił problem podczas aktualizowania produktu".</span><span class="sxs-lookup"><span data-stu-id="50bcd-205">If it's not, the `ExceptionDetails` Label's `Visible` property is set to `true` and its `Text` property to "There was a problem updating the product."</span></span> <span data-ttu-id="50bcd-206">Szczegóły faktycznego wyjątku, który został zgłoszony, znajdują się we właściwości `InnerException` obiektu `e.Exception`.</span><span class="sxs-lookup"><span data-stu-id="50bcd-206">The details of the actual exception that was thrown reside in the `e.Exception` object's `InnerException` property.</span></span> <span data-ttu-id="50bcd-207">Ten wyjątek wewnętrzny jest sprawdzany i, jeśli jest określonego typu, dodatkowy, przydatny komunikat jest dołączany do właściwości `Text` `ExceptionDetails` etykiety.</span><span class="sxs-lookup"><span data-stu-id="50bcd-207">This inner exception is examined and, if it is of a particular type, an additional, helpful message is appended to the `ExceptionDetails` Label's `Text` property.</span></span> <span data-ttu-id="50bcd-208">Na koniec właściwości `ExceptionHandled` i `KeepInEditMode` są ustawione na `true`.</span><span class="sxs-lookup"><span data-stu-id="50bcd-208">Lastly, the `ExceptionHandled` and `KeepInEditMode` properties are both set to `true`.</span></span>

<span data-ttu-id="50bcd-209">Rysunek 9 przedstawia zrzut ekranu na tej stronie podczas pomijania nazwy produktu. Rysunek 10 pokazuje wyniki podczas wprowadzania niedozwolonej wartości `UnitPrice` (-50).</span><span class="sxs-lookup"><span data-stu-id="50bcd-209">Figure 9 shows a screen shot of this page when omitting the name of the product; Figure 10 shows the results when entering an illegal `UnitPrice` value (-50).</span></span>

<span data-ttu-id="50bcd-210">[![ProductName BoundField musi zawierać wartość](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image24.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="50bcd-210">[![The ProductName BoundField Must Contain a Value](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image24.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image23.png)</span></span>

<span data-ttu-id="50bcd-211">**Rysunek 9**: BoundField `ProductName` musi zawierać wartość ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image25.png))</span><span class="sxs-lookup"><span data-stu-id="50bcd-211">**Figure 9**: The `ProductName` BoundField Must Contain a Value ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image25.png))</span></span>

<span data-ttu-id="50bcd-212">[![ujemne wartości CenaJednostkowa są niedozwolone](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image27.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image26.png)</span><span class="sxs-lookup"><span data-stu-id="50bcd-212">[![Negative UnitPrice Values are Not Allowed](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image27.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image26.png)</span></span>

<span data-ttu-id="50bcd-213">**Rysunek 10**. ujemne wartości `UnitPrice` są niedozwolone ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image28.png))</span><span class="sxs-lookup"><span data-stu-id="50bcd-213">**Figure 10**: Negative `UnitPrice` Values are Not Allowed ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image28.png))</span></span>

<span data-ttu-id="50bcd-214">Ustawiając właściwość `e.ExceptionHandled` na `true`, program obsługi zdarzeń `RowUpdated` wskazuje, że obsłużył wyjątek.</span><span class="sxs-lookup"><span data-stu-id="50bcd-214">By setting the `e.ExceptionHandled` property to `true`, the `RowUpdated` event handler has indicated that it has handled the exception.</span></span> <span data-ttu-id="50bcd-215">W związku z tym wyjątek nie zostanie propagowany do środowiska uruchomieniowego ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="50bcd-215">Therefore, the exception won't propagate up to the ASP.NET runtime.</span></span>

> [!NOTE]
> <span data-ttu-id="50bcd-216">Rysunki 9 i 10 przedstawiają płynny sposób obsługi wyjątków zgłoszonych z powodu nieprawidłowych danych wejściowych użytkownika.</span><span class="sxs-lookup"><span data-stu-id="50bcd-216">Figures 9 and 10 show a graceful way to handle exceptions raised due to invalid user input.</span></span> <span data-ttu-id="50bcd-217">W idealnym przypadku takie nieprawidłowe dane wejściowe nigdy nie docierają do warstwy logiki biznesowej w pierwszym miejscu, ponieważ strona ASP.NET powinna upewnić się, że dane wejściowe użytkownika są prawidłowe przed wywołaniem metody `UpdateProduct`j klasy `ProductsBLL`.</span><span class="sxs-lookup"><span data-stu-id="50bcd-217">Ideally, though, such invalid input will never reach the Business Logic Layer in the first place, as the ASP.NET page should ensure that the user's inputs are valid before invoking the `ProductsBLL` class's `UpdateProduct` method.</span></span> <span data-ttu-id="50bcd-218">W naszym następnym samouczku dowiesz się, jak dodać kontrolki weryfikacji do edycji i wstawiania interfejsów, aby upewnić się, że dane przesyłane do warstwy logiki biznesowej są zgodne z regułami biznesowymi.</span><span class="sxs-lookup"><span data-stu-id="50bcd-218">In our next tutorial we'll see how to add validation controls to the editing and inserting interfaces to ensure that the data submitted to the Business Logic Layer conforms to the business rules.</span></span> <span data-ttu-id="50bcd-219">Kontrolki walidacji nie tylko uniemożliwiają wywołanie metody `UpdateProduct`, dopóki dane podane przez użytkownika nie będą prawidłowe, ale również zapewniają bardziej szczegółowe środowisko użytkownika do identyfikowania problemów z wprowadzaniem danych.</span><span class="sxs-lookup"><span data-stu-id="50bcd-219">The validation controls not only prevent the invocation of the `UpdateProduct` method until the user-supplied data is valid, but also provide a more informative user experience for identifying data entry problems.</span></span>

## <a name="step-3-gracefully-handling-bll-level-exceptions"></a><span data-ttu-id="50bcd-220">Krok 3. bezpieczne obsługiwanie wyjątków na poziomie LOGIKI biznesowej</span><span class="sxs-lookup"><span data-stu-id="50bcd-220">Step 3: Gracefully Handling BLL-Level Exceptions</span></span>

<span data-ttu-id="50bcd-221">Podczas wstawiania, aktualizowania lub usuwania danych, warstwa dostępu do danych może zgłosić wyjątek w wyniku błędu związanego z danymi.</span><span class="sxs-lookup"><span data-stu-id="50bcd-221">When inserting, updating, or deleting data, the Data Access Layer may throw an exception in the face of a data-related error.</span></span> <span data-ttu-id="50bcd-222">Baza danych może być w trybie offline, wymagana kolumna tabeli bazy danych może nie mieć określonej wartości lub ograniczenie poziomu tabeli mogło zostać naruszone.</span><span class="sxs-lookup"><span data-stu-id="50bcd-222">The database may be offline, a required database table column might not have had a value specified, or a table-level constraint may have been violated.</span></span> <span data-ttu-id="50bcd-223">Oprócz nieścisłych wyjątków związanych z danymi, Warstwa logiki biznesowej może używać wyjątków, aby wskazać, kiedy reguły biznesowe zostały naruszone.</span><span class="sxs-lookup"><span data-stu-id="50bcd-223">In addition to strictly data-related exceptions, the Business Logic Layer can use exceptions to indicate when business rules have been violated.</span></span> <span data-ttu-id="50bcd-224">W samouczku [Tworzenie warstwy logiki biznesowej](../introduction/creating-a-business-logic-layer-cs.md) na przykład dodaliśmy sprawdzanie reguły biznesowej do oryginalnego przeciążenia `UpdateProduct`.</span><span class="sxs-lookup"><span data-stu-id="50bcd-224">In the [Creating a Business Logic Layer](../introduction/creating-a-business-logic-layer-cs.md) tutorial, for example, we added a business rule check to the original `UpdateProduct` overload.</span></span> <span data-ttu-id="50bcd-225">W przypadku, gdy użytkownik oznaczy produkt jako niegotowy, firma Microsoft zobowiązana, że produkt nie należy do jedynej dostarczonej przez niego dostawcy.</span><span class="sxs-lookup"><span data-stu-id="50bcd-225">Specifically, if the user was marking a product as discontinued, we required that the product not be the only one provided by its supplier.</span></span> <span data-ttu-id="50bcd-226">Jeśli ten warunek został naruszony, zgłoszono `ApplicationException`.</span><span class="sxs-lookup"><span data-stu-id="50bcd-226">If this condition was violated, an `ApplicationException` was thrown.</span></span>

<span data-ttu-id="50bcd-227">W przypadku przeciążenia `UpdateProduct` utworzonego w ramach tego samouczka dodamy regułę biznesową, która zabrania, aby pole `UnitPrice` było ustawione na nową wartość, która jest większa niż dwukrotnie oryginalna wartość `UnitPrice`.</span><span class="sxs-lookup"><span data-stu-id="50bcd-227">For the `UpdateProduct` overload created in this tutorial, let's add a business rule that prohibits the `UnitPrice` field from being set to a new value that's more than twice the original `UnitPrice` value.</span></span> <span data-ttu-id="50bcd-228">Aby to osiągnąć, Dostosuj Przeciążenie `UpdateProduct` tak, aby wykonywało to sprawdzenie i zgłosi `ApplicationException`, jeśli reguła zostanie naruszona.</span><span class="sxs-lookup"><span data-stu-id="50bcd-228">To accomplish this, adjust the `UpdateProduct` overload so that it performs this check and throws an `ApplicationException` if the rule is violated.</span></span> <span data-ttu-id="50bcd-229">Zaktualizowana Metoda jest następująca:</span><span class="sxs-lookup"><span data-stu-id="50bcd-229">The updated method follows:</span></span>

[!code-csharp[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/samples/sample6.cs)]

<span data-ttu-id="50bcd-230">Wprowadzenie tej zmiany spowoduje, że wszystkie aktualizacje cen, które są większe niż dwa razy w istniejącej cenie, spowodują zgłoszenie `ApplicationException`.</span><span class="sxs-lookup"><span data-stu-id="50bcd-230">With this change, any price update that is more than twice the existing price will cause an `ApplicationException` to be thrown.</span></span> <span data-ttu-id="50bcd-231">Podobnie jak wyjątek wywoływany z DAL, ten LOGIKI biznesowej podniesione `ApplicationException` można wykryć i obsłużyć w programie obsługi zdarzeń `RowUpdated` GridView.</span><span class="sxs-lookup"><span data-stu-id="50bcd-231">Just like the exception raised from the DAL, this BLL-raised `ApplicationException` can be detected and handled in the GridView's `RowUpdated` event handler.</span></span> <span data-ttu-id="50bcd-232">W rzeczywistości kod programu obsługi zdarzeń `RowUpdated`, zgodnie z zapisaniem, prawidłowo wykryje ten wyjątek i wyświetli wartość właściwości `Message` `ApplicationException`.</span><span class="sxs-lookup"><span data-stu-id="50bcd-232">In fact, the `RowUpdated` event handler's code, as written, will correctly detect this exception and display the `ApplicationException`'s `Message` property value.</span></span> <span data-ttu-id="50bcd-233">Rysunek 11 przedstawia zrzut ekranu, gdy użytkownik próbuje zaktualizować cenę Chai do $50,00, która jest większa niż podwójna cena w wysokości $19,95.</span><span class="sxs-lookup"><span data-stu-id="50bcd-233">Figure 11 shows a screen shot when a user attempts to update the price of Chai to $50.00, which is more than double its current price of $19.95.</span></span>

<span data-ttu-id="50bcd-234">[![reguły biznesowe nie zezwalają na zwiększenie cen, które przekraczają cenę produktu](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image30.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="50bcd-234">[![The Business Rules Disallow Price Increases That More Than Double a Product's Price](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image30.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image29.png)</span></span>

<span data-ttu-id="50bcd-235">**Ilustracja 11**. reguły biznesowe nie zezwalają na zwiększenie cen, które przekraczają cenę produktu ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image31.png))</span><span class="sxs-lookup"><span data-stu-id="50bcd-235">**Figure 11**: The Business Rules Disallow Price Increases That More Than Double a Product's Price ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image31.png))</span></span>

> [!NOTE]
> <span data-ttu-id="50bcd-236">Najlepiej, gdy nasze reguły logiki biznesowej byłyby refaktoryzacji z przeciążeń metody `UpdateProduct` i we wspólnej metodzie.</span><span class="sxs-lookup"><span data-stu-id="50bcd-236">Ideally our business logic rules would be refactored out of the `UpdateProduct` method overloads and into a common method.</span></span> <span data-ttu-id="50bcd-237">Jest to pozostawione jako ćwiczenie dla czytnika.</span><span class="sxs-lookup"><span data-stu-id="50bcd-237">This is left as an exercise for the reader.</span></span>

## <a name="summary"></a><span data-ttu-id="50bcd-238">Podsumowanie</span><span class="sxs-lookup"><span data-stu-id="50bcd-238">Summary</span></span>

<span data-ttu-id="50bcd-239">Podczas wstawiania, aktualizowania i usuwania operacji zarówno formant sieci Web danych, jak i element ObjectDataSource są wyzwalane przez zdarzenia poprzedzające i końcowe, które bookendją rzeczywistą operację.</span><span class="sxs-lookup"><span data-stu-id="50bcd-239">During inserting, updating, and deleting operations, both the data Web control and the ObjectDataSource involved fire pre- and post-level events that bookend the actual operation.</span></span> <span data-ttu-id="50bcd-240">Jak już wspomniano w tym samouczku i powyższym, podczas pracy z edytowalnym elementem GridView `RowUpdating` zdarzenie wyzwalane, a następnie zdarzenie `Updating` elementu ObjectDataSource, w którym jest wykonywane polecenie Update w obiekcie źródłowym elementu ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="50bcd-240">As we saw in this tutorial and the preceding one, when working with an editable GridView the GridView's `RowUpdating` event fires, followed by the ObjectDataSource's `Updating` event, at which point the update command is made to the ObjectDataSource's underlying object.</span></span> <span data-ttu-id="50bcd-241">Po zakończeniu operacji zdarzenie `Updated` elementu ObjectDataSource zostanie wyzwolone, a następnie zdarzenie `RowUpdated` GridView.</span><span class="sxs-lookup"><span data-stu-id="50bcd-241">After the operation has completed, the ObjectDataSource's `Updated` event fires, followed by the GridView's `RowUpdated` event.</span></span>

<span data-ttu-id="50bcd-242">Możemy utworzyć programy obsługi zdarzeń dla zdarzeń przedpoziomu, aby dostosować parametry wejściowe lub dla zdarzeń na poziomie, aby móc sprawdzać wyniki operacji i odpowiadać na nie.</span><span class="sxs-lookup"><span data-stu-id="50bcd-242">We can create event handlers for the pre-level events in order to customize the input parameters or for the post-level events in order to inspect and respond to the operation's results.</span></span> <span data-ttu-id="50bcd-243">Programy obsługi zdarzeń na poziomie są najczęściej używane do wykrywania, czy wystąpił wyjątek podczas operacji.</span><span class="sxs-lookup"><span data-stu-id="50bcd-243">Post-level event handlers are most commonly used to detect whether an exception occurred during the operation.</span></span> <span data-ttu-id="50bcd-244">W przypadku wyjątku te programy obsługi zdarzeń na poziomie mogą opcjonalnie obsłużyć wyjątek samodzielnie.</span><span class="sxs-lookup"><span data-stu-id="50bcd-244">In the face of an exception, these post-level event handlers can optionally handle the exception on their own.</span></span> <span data-ttu-id="50bcd-245">W tym samouczku pokazano, jak obsłużyć taki wyjątek, wyświetlając przyjazny komunikat o błędzie.</span><span class="sxs-lookup"><span data-stu-id="50bcd-245">In this tutorial we saw how to handle such an exception by displaying a friendly error message.</span></span>

<span data-ttu-id="50bcd-246">W następnym samouczku dowiesz się, jak zmniejszyć prawdopodobieństwo wystąpienia wyjątków wynikających z problemów z formatowaniem danych (takich jak wprowadzanie negatywnej `UnitPrice`).</span><span class="sxs-lookup"><span data-stu-id="50bcd-246">In the next tutorial we'll see how to lessen the likelihood of exceptions arising from data formatting issues (such as entering a negative `UnitPrice`).</span></span> <span data-ttu-id="50bcd-247">W celu dowiesz się, jak dodać kontrolki weryfikacji do edycji i wstawiania interfejsów.</span><span class="sxs-lookup"><span data-stu-id="50bcd-247">Specifically, we'll look at how to add validation controls to the editing and inserting interfaces.</span></span>

<span data-ttu-id="50bcd-248">Szczęśliwe programowanie!</span><span class="sxs-lookup"><span data-stu-id="50bcd-248">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="50bcd-249">Informacje o autorze</span><span class="sxs-lookup"><span data-stu-id="50bcd-249">About the Author</span></span>

<span data-ttu-id="50bcd-250">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor siedmiu grup ASP/ASP. NET Books i założyciel of [4GuysFromRolla.com](http://www.4guysfromrolla.com), pracował z technologiami sieci Web firmy Microsoft od czasu 1998.</span><span class="sxs-lookup"><span data-stu-id="50bcd-250">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="50bcd-251">Scott działa jako niezależny konsultant, trainer i składnik zapisywania.</span><span class="sxs-lookup"><span data-stu-id="50bcd-251">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="50bcd-252">Jego Najnowsza książka to [*Sams ASP.NET 2,0 w ciągu 24 godzin*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="50bcd-252">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="50bcd-253">Można go osiągnąć w [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="50bcd-253">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="50bcd-254">lub za pośrednictwem swojego blogu, który można znaleźć w [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="50bcd-254">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="50bcd-255">Specjalne podziękowania</span><span class="sxs-lookup"><span data-stu-id="50bcd-255">Special Thanks To</span></span>

<span data-ttu-id="50bcd-256">Ta seria samouczków została sprawdzona przez wielu przydatnych recenzentów.</span><span class="sxs-lookup"><span data-stu-id="50bcd-256">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="50bcd-257">Recenzent potencjalnych klientów dla tego samouczka został Liz Shulok.</span><span class="sxs-lookup"><span data-stu-id="50bcd-257">Lead reviewer for this tutorial was Liz Shulok.</span></span> <span data-ttu-id="50bcd-258">Chcesz przeglądać moje nadchodzące artykuły MSDN?</span><span class="sxs-lookup"><span data-stu-id="50bcd-258">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="50bcd-259">Jeśli tak, upuść mi linię w [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="50bcd-259">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="50bcd-260">[Poprzednie](examining-the-events-associated-with-inserting-updating-and-deleting-cs.md)
> [dalej](adding-validation-controls-to-the-editing-and-inserting-interfaces-cs.md)</span><span class="sxs-lookup"><span data-stu-id="50bcd-260">[Previous](examining-the-events-associated-with-inserting-updating-and-deleting-cs.md)
[Next](adding-validation-controls-to-the-editing-and-inserting-interfaces-cs.md)</span></span>
