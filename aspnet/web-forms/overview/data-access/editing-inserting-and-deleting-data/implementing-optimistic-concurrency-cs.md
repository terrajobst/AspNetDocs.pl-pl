---
uid: web-forms/overview/data-access/editing-inserting-and-deleting-data/implementing-optimistic-concurrency-cs
title: Implementowanie optymistycznej współbieżności (C#) | Microsoft Docs
author: rick-anderson
description: W przypadku aplikacji sieci Web, która pozwala wielu użytkownikom edytować dane, istnieje ryzyko, że dwóch użytkowników może jednocześnie edytować te same dane. W tym tutori...
ms.author: riande
ms.date: 07/17/2006
ms.assetid: 56e15b33-93b8-43ad-8e19-44c6647ea05c
msc.legacyurl: /web-forms/overview/data-access/editing-inserting-and-deleting-data/implementing-optimistic-concurrency-cs
msc.type: authoredcontent
ms.openlocfilehash: 3cddb0efd28249ffc5708ece39c80581d078a5a2
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 11/28/2019
ms.locfileid: "74617478"
---
# <a name="implementing-optimistic-concurrency-c"></a><span data-ttu-id="8ea9a-104">Implementowanie optymistycznej współbieżności (C#)</span><span class="sxs-lookup"><span data-stu-id="8ea9a-104">Implementing Optimistic Concurrency (C#)</span></span>

<span data-ttu-id="8ea9a-105">przez [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="8ea9a-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="8ea9a-106">[Pobierz przykładową aplikację](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_21_CS.exe) lub [Pobierz plik PDF](implementing-optimistic-concurrency-cs/_static/datatutorial21cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="8ea9a-106">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_21_CS.exe) or [Download PDF](implementing-optimistic-concurrency-cs/_static/datatutorial21cs1.pdf)</span></span>

> <span data-ttu-id="8ea9a-107">W przypadku aplikacji sieci Web, która pozwala wielu użytkownikom edytować dane, istnieje ryzyko, że dwóch użytkowników może jednocześnie edytować te same dane.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-107">For a web application that allows multiple users to edit data, there is the risk that two users may be editing the same data at the same time.</span></span> <span data-ttu-id="8ea9a-108">W tym samouczku wykonamy implementację optymistycznej kontroli współbieżności w celu obsługi tego ryzyka.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-108">In this tutorial we'll implement optimistic concurrency control to handle this risk.</span></span>

## <a name="introduction"></a><span data-ttu-id="8ea9a-109">Wprowadzenie</span><span class="sxs-lookup"><span data-stu-id="8ea9a-109">Introduction</span></span>

<span data-ttu-id="8ea9a-110">W przypadku aplikacji sieci Web, które umożliwiają użytkownikom wyświetlanie danych lub dla tych, które zawierają tylko jednego użytkownika, który może modyfikować dane, nie ma żadnego zagrożenia dla dwóch równoczesnych użytkowników.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-110">For web applications that only allow users to view data, or for those that include only a single user who can modify data, there's no threat of two concurrent users accidentally overwriting one another's changes.</span></span> <span data-ttu-id="8ea9a-111">W przypadku aplikacji sieci Web, które umożliwiają wielu użytkownikom aktualizowanie lub usuwanie danych, istnieje jednak możliwość modyfikacji konfliktów jednego użytkownika z innym współbieżnym użytkownikiem.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-111">For web applications that allow multiple users to update or delete data, however, there's the potential for one user's modifications to clash with another concurrent user's.</span></span> <span data-ttu-id="8ea9a-112">Bez żadnych zasad współbieżności, gdy dwaj użytkownicy jednocześnie edytują pojedynczy rekord, użytkownik, który zatwierdzi zmiany, zastąpi zmiany wprowadzone w pierwszej kolejności.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-112">Without any concurrency policy in place, when two users are simultaneously editing a single record, the user who commits her changes last will override the changes made by the first.</span></span>

<span data-ttu-id="8ea9a-113">Załóżmy na przykład, że dwóch użytkowników, Jisun i sam odwiedzają stronę w naszej aplikacji, która umożliwia odwiedzającym aktualizowanie i usuwanie produktów za pomocą kontrolki GridView.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-113">For example, imagine that two users, Jisun and Sam, were both visiting a page in our application that allowed visitors to update and delete the products through a GridView control.</span></span> <span data-ttu-id="8ea9a-114">Jednocześnie kliknij przycisk Edytuj w widoku GridView.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-114">Both click the Edit button in the GridView around the same time.</span></span> <span data-ttu-id="8ea9a-115">Jisun zmienia nazwę produktu na "Chai herbata" i klika przycisk Aktualizuj.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-115">Jisun changes the product name to "Chai Tea" and clicks the Update button.</span></span> <span data-ttu-id="8ea9a-116">Wynik netto to instrukcja `UPDATE`, która jest wysyłana do bazy danych, która ustawia *wszystkie* pola, które można aktualizować, mimo że Jisun tylko zaktualizowane jedno pole, `ProductName`).</span><span class="sxs-lookup"><span data-stu-id="8ea9a-116">The net result is an `UPDATE` statement that is sent to the database, which sets *all* of the product's updateable fields (even though Jisun only updated one field, `ProductName`).</span></span> <span data-ttu-id="8ea9a-117">W tym momencie baza danych ma wartości "Chai herbata", "napoje kategorii", "produkty" i tak dalej dla tego konkretnego produktu.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-117">At this point in time, the database has the values "Chai Tea," the category Beverages, the supplier Exotic Liquids, and so on for this particular product.</span></span> <span data-ttu-id="8ea9a-118">Jednak widok GridView na ekranie sam wyświetla nazwę produktu w edytowalnym wierszu GridView jako "Chai".</span><span class="sxs-lookup"><span data-stu-id="8ea9a-118">However, the GridView on Sam's screen still shows the product name in the editable GridView row as "Chai".</span></span> <span data-ttu-id="8ea9a-119">Kilka sekund po przeprowadzeniu zmian Jisun, sam aktualizuje kategorię do przypraw i klika przycisk Aktualizuj.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-119">A few seconds after Jisun's changes have been committed, Sam updates the category to Condiments and clicks Update.</span></span> <span data-ttu-id="8ea9a-120">Spowoduje to wysłanie instrukcji `UPDATE` do bazy danych, która ustawia nazwę produktu na "Chai", `CategoryID` do odpowiedniego identyfikatora kategorii napoje i tak dalej.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-120">This results in an `UPDATE` statement sent to the database that sets the product name to "Chai," the `CategoryID` to the corresponding Beverages category ID, and so on.</span></span> <span data-ttu-id="8ea9a-121">Zmiany nazwy produktu Jisun zostały nadpisywane.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-121">Jisun's changes to the product name have been overwritten.</span></span> <span data-ttu-id="8ea9a-122">Rysunek 1 ilustracja przedstawia tę serię zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-122">Figure 1 graphically depicts this series of events.</span></span>

<span data-ttu-id="8ea9a-123">[![, gdy dwaj użytkownicy jednocześnie zaktualizują rekord, a potencjalne dla jednego użytkownika s zmienią się, aby zastąpić inne s](implementing-optimistic-concurrency-cs/_static/image2.png)](implementing-optimistic-concurrency-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="8ea9a-123">[![When Two Users Simultaneously Update a Record There s Potential for One User s Changes to Overwrite the Other s](implementing-optimistic-concurrency-cs/_static/image2.png)](implementing-optimistic-concurrency-cs/_static/image1.png)</span></span>

<span data-ttu-id="8ea9a-124">**Rysunek 1**. gdy dwaj użytkownicy jednocześnie zaktualizują rekord, a potencjalne dla jednego użytkownika s zmienią się, aby zastąpić inne s ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](implementing-optimistic-concurrency-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="8ea9a-124">**Figure 1**: When Two Users Simultaneously Update a Record There s Potential for One User s Changes to Overwrite the Other s ([Click to view full-size image](implementing-optimistic-concurrency-cs/_static/image3.png))</span></span>

<span data-ttu-id="8ea9a-125">Podobnie, gdy dwaj użytkownicy odwiedzają stronę, jeden użytkownik może być w pośrodku o aktualizację rekordu, gdy zostanie on usunięty przez innego użytkownika.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-125">Similarly, when two users are visiting a page, one user might be in the midst of updating a record when it is deleted by another user.</span></span> <span data-ttu-id="8ea9a-126">Lub, między kiedy użytkownik załaduje stronę i klika przycisk Usuń, może zmodyfikować zawartość tego rekordu przez innego użytkownika.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-126">Or, between when a user loads a page and when they click the Delete button, another user may have modified the contents of that record.</span></span>

<span data-ttu-id="8ea9a-127">Dostępne są trzy strategie [kontroli współbieżności](http://en.wikipedia.org/wiki/Concurrency_control) :</span><span class="sxs-lookup"><span data-stu-id="8ea9a-127">There are three [concurrency control](http://en.wikipedia.org/wiki/Concurrency_control) strategies available:</span></span>

- <span data-ttu-id="8ea9a-128">**Nic nie rób** — Jeśli jednoczesny użytkownik modyfikuje ten sam rekord, pozwól na ostatnie Zatwierdź (zachowanie domyślne)</span><span class="sxs-lookup"><span data-stu-id="8ea9a-128">**Do Nothing** -if concurrent users are modifying the same record, let the last commit win (the default behavior)</span></span>
- <span data-ttu-id="8ea9a-129">[**Współbieżność optymistyczna**](http://en.wikipedia.org/wiki/Optimistic_concurrency_control) — zakłada, że podczas gdy mogą wystąpić konflikty współbieżności co teraz, a następnie, większość czasu takie konflikty nie wystąpi. w związku z tym, jeśli wystąpi konflikt, po prostu poinformuj użytkownika o tym, że nie można zapisać zmian, ponieważ inny użytkownik zmodyfikował te same dane</span><span class="sxs-lookup"><span data-stu-id="8ea9a-129">[**Optimistic Concurrency**](http://en.wikipedia.org/wiki/Optimistic_concurrency_control) - assume that while there may be concurrency conflicts every now and then, the vast majority of the time such conflicts won't arise; therefore, if a conflict does arise, simply inform the user that their changes can't be saved because another user has modified the same data</span></span>
- <span data-ttu-id="8ea9a-130">**Współbieżność pesymistyczna** — założono, że konflikty współbieżności są commonplace i że użytkownicy nie będą tolerowali, że zmiany nie zostały zapisane z powodu współbieżnych działań użytkownika. w związku z tym, gdy jeden użytkownik zaczyna aktualizować rekord, należy go zablokować, aby uniemożliwić innym użytkownikom edytowanie lub usuwanie rekordu, dopóki użytkownik nie zatwierdzi ich modyfikacji</span><span class="sxs-lookup"><span data-stu-id="8ea9a-130">**Pessimistic Concurrency** - assume that concurrency conflicts are commonplace and that users won't tolerate being told their changes weren't saved due to another user's concurrent activity; therefore, when one user starts updating a record, lock it, thereby preventing any other users from editing or deleting that record until the user commits their modifications</span></span>

<span data-ttu-id="8ea9a-131">We wszystkich naszych samouczkach użyto domyślnej strategii rozwiązywania współbieżności — w tym Przypuśćmy, że wystąpiła Ostatnia zapis.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-131">All of our tutorials thus far have used the default concurrency resolution strategy - namely, we've let the last write win.</span></span> <span data-ttu-id="8ea9a-132">W tym samouczku opisano sposób implementacji optymistycznej kontroli współbieżności.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-132">In this tutorial we'll examine how to implement optimistic concurrency control.</span></span>

> [!NOTE]
> <span data-ttu-id="8ea9a-133">W tej serii samouczków nie będzie wyglądać na przykład pesymistyczne współbieżności.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-133">We won't look at pessimistic concurrency examples in this tutorial series.</span></span> <span data-ttu-id="8ea9a-134">Współbieżność pesymistyczna jest rzadko używana, ponieważ takie blokady, w przypadku nieprawidłowego wypróbowania, mogą uniemożliwić innym użytkownikom aktualizowanie danych.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-134">Pessimistic concurrency is rarely used because such locks, if not properly relinquished, can prevent other users from updating data.</span></span> <span data-ttu-id="8ea9a-135">Na przykład jeśli użytkownik zablokuje rekord do edycji, a następnie opuszcza dzień przed jego odblokowaniem, żaden inny użytkownik nie będzie mógł zaktualizować tego rekordu, dopóki oryginalny użytkownik nie zwróci i nie ukończy aktualizacji.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-135">For example, if a user locks a record for editing and then leaves for the day before unlocking it, no other user will be able to update that record until the original user returns and completes his update.</span></span> <span data-ttu-id="8ea9a-136">W związku z tym w sytuacjach, w których jest używana pesymistyczna współbieżność, zazwyczaj jest przekroczenie limitu czasu, który, jeśli został osiągnięty, anuluje blokadę.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-136">Therefore, in situations where pessimistic concurrency is used, there's typically a timeout that, if reached, cancels the lock.</span></span> <span data-ttu-id="8ea9a-137">Witryny sieci Web sprzedaży biletów, która blokuje konkretną lokalizację dla krótkiego okresu, gdy użytkownik ukończy proces zamawiania, to przykład pesymistycznej kontroli współbieżności.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-137">Ticket sales websites, which lock a particular seating location for short period while the user completes the order process, is an example of pessimistic concurrency control.</span></span>

## <a name="step-1-looking-at-how-optimistic-concurrency-is-implemented"></a><span data-ttu-id="8ea9a-138">Krok 1. spojrzenie na sposób implementacji optymistycznej współbieżności</span><span class="sxs-lookup"><span data-stu-id="8ea9a-138">Step 1: Looking at How Optimistic Concurrency is Implemented</span></span>

<span data-ttu-id="8ea9a-139">Optymistyczna kontrola współbieżności działa przez upewnienie się, że aktualizowany lub usuwany rekord ma takie same wartości jak w przypadku uruchomienia procesu aktualizowania lub usuwania.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-139">Optimistic concurrency control works by ensuring that the record being updated or deleted has the same values as it did when the updating or deleting process started.</span></span> <span data-ttu-id="8ea9a-140">Na przykład po kliknięciu przycisku Edytuj w edytowalnym widoku GridView wartości rekordu są odczytywane z bazy danych i wyświetlane w polach tekstowych i innych formantach sieci Web.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-140">For example, when clicking the Edit button in an editable GridView, the record's values are read from the database and displayed in TextBoxes and other Web controls.</span></span> <span data-ttu-id="8ea9a-141">Te oryginalne wartości są zapisywane przez GridView.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-141">These original values are saved by the GridView.</span></span> <span data-ttu-id="8ea9a-142">Później po wprowadzeniu zmian przez użytkownika i kliknięciu przycisku Aktualizuj pierwotne wartości oraz nowe wartości są wysyłane do warstwy logiki biznesowej, a następnie do warstwy dostępu do danych.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-142">Later, after the user makes her changes and clicks the Update button, the original values plus the new values are sent to the Business Logic Layer, and then down to the Data Access Layer.</span></span> <span data-ttu-id="8ea9a-143">Warstwa dostępu do danych musi wystawić instrukcję SQL, która zaktualizuje rekord tylko wtedy, gdy pierwotne wartości edytowane przez użytkownika są identyczne z wartościami nadal w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-143">The Data Access Layer must issue a SQL statement that will only update the record if the original values that the user started editing are identical to the values still in the database.</span></span> <span data-ttu-id="8ea9a-144">Rysunek 2 przedstawia tę sekwencję zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-144">Figure 2 depicts this sequence of events.</span></span>

<span data-ttu-id="8ea9a-145">[Aby można było pomyślnie zaktualizować lub usunąć ![, oryginalne wartości muszą być równe bieżącym wartościom bazy danych](implementing-optimistic-concurrency-cs/_static/image5.png)](implementing-optimistic-concurrency-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="8ea9a-145">[![For the Update or Delete to Succeed, the Original Values Must Be Equal to the Current Database Values](implementing-optimistic-concurrency-cs/_static/image5.png)](implementing-optimistic-concurrency-cs/_static/image4.png)</span></span>

<span data-ttu-id="8ea9a-146">**Rysunek 2**. Aby pomyślnie zaktualizować lub usunąć, oryginalne wartości muszą być równe bieżącym wartościom bazy danych ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](implementing-optimistic-concurrency-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="8ea9a-146">**Figure 2**: For the Update or Delete to Succeed, the Original Values Must Be Equal to the Current Database Values ([Click to view full-size image](implementing-optimistic-concurrency-cs/_static/image6.png))</span></span>

<span data-ttu-id="8ea9a-147">Istnieją różne podejścia do implementowania optymistycznej współbieżności (zobacz "Bromberg" [optymistycznej logiki aktualizacji współbieżności](http://www.eggheadcafe.com/articles/20050719.asp) [,](http://peterbromberg.net/)aby skrócić kilka opcji).</span><span class="sxs-lookup"><span data-stu-id="8ea9a-147">There are various approaches to implementing optimistic concurrency (see [Peter A. Bromberg](http://peterbromberg.net/)'s [Optimistic Concurrency Updating Logic](http://www.eggheadcafe.com/articles/20050719.asp) for a brief look at a number of options).</span></span> <span data-ttu-id="8ea9a-148">Zestaw danych typu ADO.NET zawiera jedną implementację, którą można skonfigurować za pomocą tylko znacznika pola wyboru.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-148">The ADO.NET Typed DataSet provides one implementation that can be configured with just the tick of a checkbox.</span></span> <span data-ttu-id="8ea9a-149">Włączenie optymistycznej współbieżności dla TableAdapter w określonym zestawie danych rozszerza instrukcje `UPDATE` TableAdapter i `DELETE` w celu uwzględnienia porównania wszystkich oryginalnych wartości w klauzuli `WHERE`.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-149">Enabling optimistic concurrency for a TableAdapter in the Typed DataSet augments the TableAdapter's `UPDATE` and `DELETE` statements to include a comparison of all of the original values in the `WHERE` clause.</span></span> <span data-ttu-id="8ea9a-150">Poniższa instrukcja `UPDATE`, na przykład aktualizuje nazwę i cenę produktu, tylko wtedy, gdy bieżące wartości bazy danych są równe wartościom, które zostały pierwotnie pobrane podczas aktualizowania rekordu w widoku GridView.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-150">The following `UPDATE` statement, for example, updates the name and price of a product only if the current database values are equal to the values that were originally retrieved when updating the record in the GridView.</span></span> <span data-ttu-id="8ea9a-151">Parametry `@ProductName` i `@UnitPrice` zawierają nowe wartości wprowadzone przez użytkownika, natomiast `@original_ProductName` i `@original_UnitPrice` zawierają wartości, które zostały początkowo załadowane do widoku GridView po kliknięciu przycisku Edytuj:</span><span class="sxs-lookup"><span data-stu-id="8ea9a-151">The `@ProductName` and `@UnitPrice` parameters contain the new values entered by the user, whereas `@original_ProductName` and `@original_UnitPrice` contain the values that were originally loaded into the GridView when the Edit button was clicked:</span></span>

[!code-sql[Main](implementing-optimistic-concurrency-cs/samples/sample1.sql)]

> [!NOTE]
> <span data-ttu-id="8ea9a-152">Ta instrukcja `UPDATE` została uproszczona w celu zapewnienia czytelności.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-152">This `UPDATE` statement has been simplified for readability.</span></span> <span data-ttu-id="8ea9a-153">W tej sytuacji `UnitPrice` się, że klauzula `WHERE` będzie bardziej zastosowana, ponieważ `UnitPrice` może zawierać `NULL` s i sprawdzać, czy `NULL = NULL` zawsze zwraca wartość false (zamiast tego należy użyć `IS NULL`).</span><span class="sxs-lookup"><span data-stu-id="8ea9a-153">In practice, the `UnitPrice` check in the `WHERE` clause would be more involved since `UnitPrice` can contain `NULL` s and checking if `NULL = NULL` always returns False (instead you must use `IS NULL`).</span></span>

<span data-ttu-id="8ea9a-154">Oprócz korzystania z innej bazowej instrukcji `UPDATE`, skonfigurowanie TableAdapter do korzystania z optymistycznej współbieżności również modyfikuje sygnaturę metod bezpośrednich usługi DB.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-154">In addition to using a different underlying `UPDATE` statement, configuring a TableAdapter to use optimistic concurrency also modifies the signature of its DB direct methods.</span></span> <span data-ttu-id="8ea9a-155">Odwołaj się z naszego pierwszego samouczka, [*tworząc warstwę dostępu do danych*](../introduction/creating-a-data-access-layer-cs.md), że metody usługi DB Direct były tymi, które akceptują listę wartości skalarnych jako parametry wejściowe (a nie z jednoznacznie określonym wystąpieniem DataRow lub DataTable).</span><span class="sxs-lookup"><span data-stu-id="8ea9a-155">Recall from our first tutorial, [*Creating a Data Access Layer*](../introduction/creating-a-data-access-layer-cs.md), that DB direct methods were those that accepts a list of scalar values as input parameters (rather than a strongly-typed DataRow or DataTable instance).</span></span> <span data-ttu-id="8ea9a-156">W przypadku korzystania z optymistycznej współbieżności metody `Update()` i `Delete()` bazy danych Direct zawierają również parametry wejściowe dla oryginalnych wartości.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-156">When using optimistic concurrency, the DB direct `Update()` and `Delete()` methods include input parameters for the original values as well.</span></span> <span data-ttu-id="8ea9a-157">Ponadto kod w logiki biznesowej do użycia wzorca aktualizacji wsadowej (`Update()` przeciążeń metody, które akceptują wiersze Datai DataTable zamiast wartości skalarnych), również muszą być zmienione.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-157">Moreover, the code in the BLL for using the batch update pattern (the `Update()` method overloads that accept DataRows and DataTables rather than scalar values) must be changed as well.</span></span>

<span data-ttu-id="8ea9a-158">Zamiast rozwijać nasze istniejące DAL TableAdapters, aby użyć optymistycznej współbieżności (co wymagałoby zmiany LOGIKI BIZNESOWEJu na dołączenie), należy utworzyć nowy typ zestawu danych o nazwie `NorthwindOptimisticConcurrency`, do którego zostanie dodany `Products` TableAdapter, który używa optymistycznej współbieżności.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-158">Rather than extend our existing DAL's TableAdapters to use optimistic concurrency (which would necessitate changing the BLL to accommodate), let's instead create a new Typed DataSet named `NorthwindOptimisticConcurrency`, to which we'll add a `Products` TableAdapter that uses optimistic concurrency.</span></span> <span data-ttu-id="8ea9a-159">Poniżej przedstawiono Tworzenie klasy warstwy logiki biznesowej `ProductsOptimisticConcurrencyBLL`, która ma odpowiednie modyfikacje w celu obsługi optymistycznej współbieżności DAL.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-159">Following that, we'll create a `ProductsOptimisticConcurrencyBLL` Business Logic Layer class that has the appropriate modifications to support the optimistic concurrency DAL.</span></span> <span data-ttu-id="8ea9a-160">Po podaniu tego podstawę będzie można utworzyć stronę ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-160">Once this groundwork has been laid, we'll be ready to create the ASP.NET page.</span></span>

## <a name="step-2-creating-a-data-access-layer-that-supports-optimistic-concurrency"></a><span data-ttu-id="8ea9a-161">Krok 2. Tworzenie warstwy dostępu do danych, która obsługuje optymistyczne współbieżność</span><span class="sxs-lookup"><span data-stu-id="8ea9a-161">Step 2: Creating a Data Access Layer That Supports Optimistic Concurrency</span></span>

<span data-ttu-id="8ea9a-162">Aby utworzyć nowy typ zestawu danych, kliknij prawym przyciskiem myszy folder `DAL` w folderze `App_Code` i Dodaj nowy zestaw danych o nazwie `NorthwindOptimisticConcurrency`.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-162">To create a new Typed DataSet, right-click on the `DAL` folder within the `App_Code` folder and add a new DataSet named `NorthwindOptimisticConcurrency`.</span></span> <span data-ttu-id="8ea9a-163">Tak jak w pierwszym samouczku, spowoduje to dodanie nowego TableAdapter do określonego zestawu danych, automatyczne uruchomienie Kreatora konfiguracji TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-163">As we saw in the first tutorial, doing so will add a new TableAdapter to the Typed DataSet, automatically launching the TableAdapter Configuration Wizard.</span></span> <span data-ttu-id="8ea9a-164">Na pierwszym ekranie zostanie wyświetlony monit o określenie bazy danych, z którą ma zostać nawiązane połączenie — Połącz się z tą samą bazą danych Northwind przy użyciu ustawienia `NORTHWNDConnectionString` z `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-164">In the first screen, we're prompted to specify the database to connect to - connect to the same Northwind database using the `NORTHWNDConnectionString` setting from `Web.config`.</span></span>

<span data-ttu-id="8ea9a-165">[![połączyć się z tą samą bazą danych Northwind](implementing-optimistic-concurrency-cs/_static/image8.png)](implementing-optimistic-concurrency-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="8ea9a-165">[![Connect to the Same Northwind Database](implementing-optimistic-concurrency-cs/_static/image8.png)](implementing-optimistic-concurrency-cs/_static/image7.png)</span></span>

<span data-ttu-id="8ea9a-166">**Rysunek 3**. Łączenie się z tą samą bazą danych Northwind ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](implementing-optimistic-concurrency-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="8ea9a-166">**Figure 3**: Connect to the Same Northwind Database ([Click to view full-size image](implementing-optimistic-concurrency-cs/_static/image9.png))</span></span>

<span data-ttu-id="8ea9a-167">Następnie zostanie wyświetlony monit z pytaniem o sposób wykonywania zapytań dotyczących danych: za pomocą instrukcji SQL ad hoc, nowej procedury składowanej lub istniejącej procedury składowanej.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-167">Next, we are prompted as to how to query the data: through an ad-hoc SQL statement, a new stored procedure, or an existing stored procedure.</span></span> <span data-ttu-id="8ea9a-168">Ponieważ używamy zapytań SQL ad hoc w oryginalnym DAL, należy użyć tej opcji również w tym miejscu.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-168">Since we used ad-hoc SQL queries in our original DAL, use this option here as well.</span></span>

<span data-ttu-id="8ea9a-169">[![określić dane do pobrania przy użyciu instrukcji SQL ad hoc](implementing-optimistic-concurrency-cs/_static/image11.png)](implementing-optimistic-concurrency-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="8ea9a-169">[![Specify the Data to Retrieve Using an Ad-Hoc SQL Statement](implementing-optimistic-concurrency-cs/_static/image11.png)](implementing-optimistic-concurrency-cs/_static/image10.png)</span></span>

<span data-ttu-id="8ea9a-170">**Rysunek 4**. Określanie danych do pobrania przy użyciu instrukcji SQL ad hoc ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](implementing-optimistic-concurrency-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="8ea9a-170">**Figure 4**: Specify the Data to Retrieve Using an Ad-Hoc SQL Statement ([Click to view full-size image](implementing-optimistic-concurrency-cs/_static/image12.png))</span></span>

<span data-ttu-id="8ea9a-171">Na poniższym ekranie Wprowadź kwerendę SQL, która ma zostać użyta do pobrania informacji o produkcie.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-171">On the following screen, enter the SQL query to use to retrieve the product information.</span></span> <span data-ttu-id="8ea9a-172">Użyjmy dokładnie tego samego zapytania SQL, które jest używane dla `Products` TableAdapter z oryginalnego DALu, który zwraca wszystkie kolumny `Product` wraz z nazwami dostawcy i kategorii produktu:</span><span class="sxs-lookup"><span data-stu-id="8ea9a-172">Let's use the exact same SQL query used for the `Products` TableAdapter from our original DAL, which returns all of the `Product` columns along with the product's supplier and category names:</span></span>

[!code-sql[Main](implementing-optimistic-concurrency-cs/samples/sample2.sql)]

<span data-ttu-id="8ea9a-173">[![używać tego samego zapytania SQL z produktów TableAdapter w oryginalnym DAL](implementing-optimistic-concurrency-cs/_static/image14.png)](implementing-optimistic-concurrency-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="8ea9a-173">[![Use the Same SQL Query from the Products TableAdapter in the Original DAL](implementing-optimistic-concurrency-cs/_static/image14.png)](implementing-optimistic-concurrency-cs/_static/image13.png)</span></span>

<span data-ttu-id="8ea9a-174">**Rysunek 5**. Użyj tego samego zapytania SQL z `Products` TableAdapter w oryginalnym dal (kliknij,[Aby wyświetlić obraz o pełnym rozmiarze](implementing-optimistic-concurrency-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="8ea9a-174">**Figure 5**: Use the Same SQL Query from the `Products` TableAdapter in the Original DAL ([Click to view full-size image](implementing-optimistic-concurrency-cs/_static/image15.png))</span></span>

<span data-ttu-id="8ea9a-175">Przed przejściem na następny ekran kliknij przycisk Opcje zaawansowane.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-175">Before moving onto the next screen, click the Advanced Options button.</span></span> <span data-ttu-id="8ea9a-176">Aby ta TableAdapter korzystała z optymistycznej kontroli współbieżności, po prostu zaznacz pole wyboru Użyj optymistycznej współbieżności.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-176">To have this TableAdapter employ optimistic concurrency control, simply check the "Use optimistic concurrency" checkbox.</span></span>

<span data-ttu-id="8ea9a-177">[![włączyć optymistyczną kontrolę współbieżności, sprawdzając &quot;użyć pola wyboru optymistyczne współbieżność&quot;](implementing-optimistic-concurrency-cs/_static/image17.png)](implementing-optimistic-concurrency-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="8ea9a-177">[![Enable Optimistic Concurrency Control by Checking the &quot;Use optimistic concurrency&quot; CheckBox](implementing-optimistic-concurrency-cs/_static/image17.png)](implementing-optimistic-concurrency-cs/_static/image16.png)</span></span>

<span data-ttu-id="8ea9a-178">**Ilustracja 6**. Włącz optymistyczną kontrolę współbieżności, zaznaczając pole wyboru "Użyj optymistycznej współbieżności" ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](implementing-optimistic-concurrency-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="8ea9a-178">**Figure 6**: Enable Optimistic Concurrency Control by Checking the "Use optimistic concurrency" CheckBox ([Click to view full-size image](implementing-optimistic-concurrency-cs/_static/image18.png))</span></span>

<span data-ttu-id="8ea9a-179">Na koniec wskaż, że TableAdapter powinien używać wzorców dostępu do danych, które wypełniają DataTable i zwracają DataTable; należy również wskazać, że powinny być tworzone metody DB Direct.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-179">Lastly, indicate that the TableAdapter should use the data access patterns that both fill a DataTable and return a DataTable; also indicate that the DB direct methods should be created.</span></span> <span data-ttu-id="8ea9a-180">Zmień nazwę metody dla zwracanego wzorca DataTable z GetData na getProducts, tak aby odzwierciedlała konwencje nazewnictwa używane w oryginalnym DAL.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-180">Change the method name for the Return a DataTable pattern from GetData to GetProducts, so as to mirror the naming conventions we used in our original DAL.</span></span>

<span data-ttu-id="8ea9a-181">[![TableAdapter używać wszystkich wzorców dostępu do danych](implementing-optimistic-concurrency-cs/_static/image20.png)](implementing-optimistic-concurrency-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="8ea9a-181">[![Have the TableAdapter Utilize All Data Access Patterns](implementing-optimistic-concurrency-cs/_static/image20.png)](implementing-optimistic-concurrency-cs/_static/image19.png)</span></span>

<span data-ttu-id="8ea9a-182">**Rysunek 7**. Korzystanie z TableAdapter wszystkich wzorców dostępu do danych ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](implementing-optimistic-concurrency-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="8ea9a-182">**Figure 7**: Have the TableAdapter Utilize All Data Access Patterns ([Click to view full-size image](implementing-optimistic-concurrency-cs/_static/image21.png))</span></span>

<span data-ttu-id="8ea9a-183">Po zakończeniu działania kreatora Projektant obiektów DataSet będzie zawierać silnie wpisaną `Products` DataTable i TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-183">After completing the wizard, the DataSet Designer will include a strongly-typed `Products` DataTable and TableAdapter.</span></span> <span data-ttu-id="8ea9a-184">Poświęć chwilę na zmianę nazwy elementu DataTable z `Products` na `ProductsOptimisticConcurrency`, co można zrobić, klikając prawym przyciskiem myszy pasek tytułu tabeli DataTable i wybierając polecenie Zmień nazwę z menu kontekstowego.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-184">Take a moment to rename the DataTable from `Products` to `ProductsOptimisticConcurrency`, which you can do by right-clicking on the DataTable's title bar and choosing Rename from the context menu.</span></span>

<span data-ttu-id="8ea9a-185">[![element DataTable i TableAdapter zostały dodane do określonego zestawu danych](implementing-optimistic-concurrency-cs/_static/image23.png)](implementing-optimistic-concurrency-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="8ea9a-185">[![A DataTable and TableAdapter Have Been Added to the Typed DataSet](implementing-optimistic-concurrency-cs/_static/image23.png)](implementing-optimistic-concurrency-cs/_static/image22.png)</span></span>

<span data-ttu-id="8ea9a-186">**Ilustracja 8**. element DataTable i TableAdapter zostały dodane do określonego zestawu danych ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](implementing-optimistic-concurrency-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="8ea9a-186">**Figure 8**: A DataTable and TableAdapter Have Been Added to the Typed DataSet ([Click to view full-size image](implementing-optimistic-concurrency-cs/_static/image24.png))</span></span>

<span data-ttu-id="8ea9a-187">Aby zobaczyć różnice między `UPDATE` i `DELETE` zapytaniami między `ProductsOptimisticConcurrency` TableAdapter (które korzystają z optymistycznej współbieżności) i produktów TableAdapter (które nie są), kliknij TableAdapter i przejdź do okno Właściwości.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-187">To see the differences between the `UPDATE` and `DELETE` queries between the `ProductsOptimisticConcurrency` TableAdapter (which uses optimistic concurrency) and the Products TableAdapter (which doesn't), click on the TableAdapter and go to the Properties window.</span></span> <span data-ttu-id="8ea9a-188">We właściwościach `DeleteCommand` i `UpdateCommand` właściwości `CommandText` można zobaczyć rzeczywistą składnię SQL, która jest wysyłana do bazy danych, gdy wywoływana jest metoda aktualizacji lub usuwania DAL.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-188">In the `DeleteCommand` and `UpdateCommand` properties' `CommandText` subproperties you can see the actual SQL syntax that is sent to the database when the DAL's update or delete-related methods are invoked.</span></span> <span data-ttu-id="8ea9a-189">W przypadku `ProductsOptimisticConcurrency` TableAdapter użyto instrukcji `DELETE`:</span><span class="sxs-lookup"><span data-stu-id="8ea9a-189">For the `ProductsOptimisticConcurrency` TableAdapter the `DELETE` statement used is:</span></span>

[!code-sql[Main](implementing-optimistic-concurrency-cs/samples/sample3.sql)]

<span data-ttu-id="8ea9a-190">W związku z tym, że `DELETE` produktu TableAdapter w oryginalnym DAL jest znacznie prostsze:</span><span class="sxs-lookup"><span data-stu-id="8ea9a-190">Whereas the `DELETE` statement for the Product TableAdapter in our original DAL is the much simpler:</span></span>

[!code-sql[Main](implementing-optimistic-concurrency-cs/samples/sample4.sql)]

<span data-ttu-id="8ea9a-191">Jak widać, klauzula `WHERE` w instrukcji `DELETE` dla TableAdapter, która używa optymistycznej współbieżności, zawiera porównanie między każdą z istniejących wartości kolumn w tabeli `Product` i oryginalnymi wartościami w chwili ostatniego wypełnienia GridView (lub DetailsView lub FormView).</span><span class="sxs-lookup"><span data-stu-id="8ea9a-191">As you can see, the `WHERE` clause in the `DELETE` statement for the TableAdapter that uses optimistic concurrency includes a comparison between each of the `Product` table's existing column values and the original values at the time the GridView (or DetailsView or FormView) was last populated.</span></span> <span data-ttu-id="8ea9a-192">Ponieważ wszystkie pola inne niż `ProductID`, `ProductName`i `Discontinued` mogą mieć wartości `NULL`, dodatkowe parametry i testy są uwzględniane w celu poprawnego porównania wartości `NULL` w klauzuli `WHERE`.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-192">Since all fields other than `ProductID`, `ProductName`, and `Discontinued` can have `NULL` values, additional parameters and checks are included to correctly compare `NULL` values in the `WHERE` clause.</span></span>

<span data-ttu-id="8ea9a-193">Nie będziemy dodawać żadnych dodatkowych tabel danych do optymistycznej z obsługą współbieżności dla tego samouczka, ponieważ nasza strona ASP.NET będzie zawierać tylko aktualizacje i usuwanie informacji o produkcie.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-193">We won't be adding any additional DataTables to the optimistic concurrency-enabled DataSet for this tutorial, as our ASP.NET page will only provide updating and deleting product information.</span></span> <span data-ttu-id="8ea9a-194">Jednak nadal trzeba dodać metodę `GetProductByProductID(productID)` do `ProductsOptimisticConcurrency` TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-194">However, we do still need to add the `GetProductByProductID(productID)` method to the `ProductsOptimisticConcurrency` TableAdapter.</span></span>

<span data-ttu-id="8ea9a-195">Aby to osiągnąć, kliknij prawym przyciskiem myszy pasek tytułu TableAdapter (obszar bezpośrednio nad `Fill` i `GetProducts` nazw metod) i wybierz polecenie Dodaj zapytanie z menu kontekstowego.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-195">To accomplish this, right-click on the TableAdapter's title bar (the area right above the `Fill` and `GetProducts` method names) and choose Add Query from the context menu.</span></span> <span data-ttu-id="8ea9a-196">Spowoduje to uruchomienie Kreatora konfiguracji zapytania TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-196">This will launch the TableAdapter Query Configuration Wizard.</span></span> <span data-ttu-id="8ea9a-197">Podobnie jak w przypadku konfiguracji początkowej TableAdapter, należy wybrać metodę `GetProductByProductID(productID)` przy użyciu instrukcji SQL ad hoc (patrz rysunek 4).</span><span class="sxs-lookup"><span data-stu-id="8ea9a-197">As with our TableAdapter's initial configuration, opt to create the `GetProductByProductID(productID)` method using an ad-hoc SQL statement (see Figure 4).</span></span> <span data-ttu-id="8ea9a-198">Ponieważ metoda `GetProductByProductID(productID)` zwraca informacje o określonym produkcie, należy wskazać, że to zapytanie jest typu zapytania `SELECT`, który zwraca wiersze.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-198">Since the `GetProductByProductID(productID)` method returns information about a particular product, indicate that this query is a `SELECT` query type that returns rows.</span></span>

<span data-ttu-id="8ea9a-199">[![oznaczyć typ zapytania jako &quot;SELECT, który zwraca wiersze&quot;](implementing-optimistic-concurrency-cs/_static/image26.png)](implementing-optimistic-concurrency-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="8ea9a-199">[![Mark the Query Type as a &quot;SELECT which returns rows&quot;](implementing-optimistic-concurrency-cs/_static/image26.png)](implementing-optimistic-concurrency-cs/_static/image25.png)</span></span>

<span data-ttu-id="8ea9a-200">**Rysunek 9**. Oznacz typ zapytania jako "`SELECT`, która zwraca wiersze" ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](implementing-optimistic-concurrency-cs/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="8ea9a-200">**Figure 9**: Mark the Query Type as a "`SELECT` which returns rows" ([Click to view full-size image](implementing-optimistic-concurrency-cs/_static/image27.png))</span></span>

<span data-ttu-id="8ea9a-201">Na następnym ekranie zostanie wyświetlony monit o zapytanie SQL, które ma być używane, z wstępnie załadowana zapytania domyślnego TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-201">On the next screen we're prompted for the SQL query to use, with the TableAdapter's default query pre-loaded.</span></span> <span data-ttu-id="8ea9a-202">Uzupełnij istniejące zapytanie, aby uwzględnić klauzulę `WHERE ProductID = @ProductID`, jak pokazano na rysunku 10.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-202">Augment the existing query to include the clause `WHERE ProductID = @ProductID`, as shown in Figure 10.</span></span>

<span data-ttu-id="8ea9a-203">[![dodać klauzulę WHERE do wstępnie załadowanego zapytania w celu zwrócenia określonego rekordu produktu](implementing-optimistic-concurrency-cs/_static/image29.png)](implementing-optimistic-concurrency-cs/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="8ea9a-203">[![Add a WHERE Clause to the Pre-Loaded Query to Return a Specific Product Record](implementing-optimistic-concurrency-cs/_static/image29.png)](implementing-optimistic-concurrency-cs/_static/image28.png)</span></span>

<span data-ttu-id="8ea9a-204">**Rysunek 10**. Dodaj klauzulę `WHERE` do wstępnie załadowanego zapytania w celu zwrócenia określonego rekordu produktu ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](implementing-optimistic-concurrency-cs/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="8ea9a-204">**Figure 10**: Add a `WHERE` Clause to the Pre-Loaded Query to Return a Specific Product Record ([Click to view full-size image](implementing-optimistic-concurrency-cs/_static/image30.png))</span></span>

<span data-ttu-id="8ea9a-205">Na koniec Zmień nazwy wygenerowanej metody na `FillByProductID` i `GetProductByProductID`.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-205">Finally, change the generated method names to `FillByProductID` and `GetProductByProductID`.</span></span>

<span data-ttu-id="8ea9a-206">[![zmienić nazwy metod na FillByProductID i GetProductByProductID](implementing-optimistic-concurrency-cs/_static/image32.png)](implementing-optimistic-concurrency-cs/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="8ea9a-206">[![Rename the Methods to FillByProductID and GetProductByProductID](implementing-optimistic-concurrency-cs/_static/image32.png)](implementing-optimistic-concurrency-cs/_static/image31.png)</span></span>

<span data-ttu-id="8ea9a-207">**Ilustracja 11**. zmiana nazw metod na `FillByProductID` i `GetProductByProductID` ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](implementing-optimistic-concurrency-cs/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="8ea9a-207">**Figure 11**: Rename the Methods to `FillByProductID` and `GetProductByProductID` ([Click to view full-size image](implementing-optimistic-concurrency-cs/_static/image33.png))</span></span>

<span data-ttu-id="8ea9a-208">Po ukończeniu pracy tego kreatora TableAdapter teraz zawiera dwie metody pobierania danych: `GetProducts()`, które zwracają *wszystkie* produkty; i `GetProductByProductID(productID)`, która zwraca określony produkt.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-208">With this wizard complete, the TableAdapter now contains two methods for retrieving data: `GetProducts()`, which returns *all* products; and `GetProductByProductID(productID)`, which returns the specified product.</span></span>

## <a name="step-3-creating-a-business-logic-layer-for-the-optimistic-concurrency-enabled-dal"></a><span data-ttu-id="8ea9a-209">Krok 3. Tworzenie warstwy logiki biznesowej dla optymistycznej DAL z obsługą współbieżności</span><span class="sxs-lookup"><span data-stu-id="8ea9a-209">Step 3: Creating a Business Logic Layer for the Optimistic Concurrency-Enabled DAL</span></span>

<span data-ttu-id="8ea9a-210">Nasze istniejące klasy `ProductsBLL` zawierają przykłady użycia zarówno wzorca aktualizacji wsadowych, jak i bezpośrednich.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-210">Our existing `ProductsBLL` class has examples of using both the batch update and DB direct patterns.</span></span> <span data-ttu-id="8ea9a-211">Metody `AddProduct` i przeciążenia `UpdateProduct` używają wzorca aktualizacji wsadowej, przekazując wystąpienie `ProductRow` do metody aktualizacji TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-211">The `AddProduct` method and `UpdateProduct` overloads both use the batch update pattern, passing in a `ProductRow` instance to the TableAdapter's Update method.</span></span> <span data-ttu-id="8ea9a-212">Metoda `DeleteProduct`, z drugiej strony, używa wzorca DB Direct, wywołując metodę `Delete(productID)` TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-212">The `DeleteProduct` method, on the other hand, uses the DB direct pattern, calling the TableAdapter's `Delete(productID)` method.</span></span>

<span data-ttu-id="8ea9a-213">Przy użyciu nowych `ProductsOptimisticConcurrency` TableAdapter metody DB Direct wymagają teraz przekazywania oryginalnych wartości.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-213">With the new `ProductsOptimisticConcurrency` TableAdapter, the DB direct methods now require that the original values also be passed in.</span></span> <span data-ttu-id="8ea9a-214">Na przykład Metoda `Delete` teraz oczekuje dziesięciu parametrów wejściowych: oryginalnych `ProductID`, `ProductName`, `SupplierID`, `CategoryID`, `QuantityPerUnit`, `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, `ReorderLevel`i `Discontinued`.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-214">For example, the `Delete` method now expects ten input parameters: the original `ProductID`, `ProductName`, `SupplierID`, `CategoryID`, `QuantityPerUnit`, `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, `ReorderLevel`, and `Discontinued`.</span></span> <span data-ttu-id="8ea9a-215">Używa tych dodatkowych wartości parametrów wejściowych w klauzuli `WHERE` instrukcji `DELETE` wysyłanej do bazy danych, usuwając określony rekord tylko wtedy, gdy bieżące wartości są mapowane na oryginalne.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-215">It uses these additional input parameters' values in `WHERE` clause of the `DELETE` statement sent to the database, only deleting the specified record if the database's current values map up to the original ones.</span></span>

<span data-ttu-id="8ea9a-216">Gdy sygnatura metody `Update`ej użyta w wzorcu aktualizacji wsadowych nie zmieniła się, kod wymagany do rejestrowania oryginalnych i nowych wartości ma wartość.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-216">While the method signature for the TableAdapter's `Update` method used in the batch update pattern hasn't changed, the code needed to record the original and new values has.</span></span> <span data-ttu-id="8ea9a-217">W związku z tym zamiast próbować używać DAL optymistycznej współbieżności z istniejącą klasą `ProductsBLL`, Utwórzmy nową klasę warstwy logiki biznesowej do pracy z naszym nowym DALem.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-217">Therefore, rather than attempt to use the optimistic concurrency-enabled DAL with our existing `ProductsBLL` class, let's create a new Business Logic Layer class for working with our new DAL.</span></span>

<span data-ttu-id="8ea9a-218">Dodaj klasę o nazwie `ProductsOptimisticConcurrencyBLL` do folderu `BLL` w folderze `App_Code`.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-218">Add a class named `ProductsOptimisticConcurrencyBLL` to the `BLL` folder within the `App_Code` folder.</span></span>

![Dodawanie klasy ProductsOptimisticConcurrencyBLL do folderu LOGIKI biznesowej](implementing-optimistic-concurrency-cs/_static/image34.png)

<span data-ttu-id="8ea9a-220">**Ilustracja 12**. dodawanie klasy `ProductsOptimisticConcurrencyBLL` do folderu logiki biznesowej</span><span class="sxs-lookup"><span data-stu-id="8ea9a-220">**Figure 12**: Add the `ProductsOptimisticConcurrencyBLL` Class to the BLL Folder</span></span>

<span data-ttu-id="8ea9a-221">Następnie Dodaj następujący kod do klasy `ProductsOptimisticConcurrencyBLL`:</span><span class="sxs-lookup"><span data-stu-id="8ea9a-221">Next, add the following code to the `ProductsOptimisticConcurrencyBLL` class:</span></span>

[!code-csharp[Main](implementing-optimistic-concurrency-cs/samples/sample5.cs)]

<span data-ttu-id="8ea9a-222">Zwróć uwagę, że instrukcja using `NorthwindOptimisticConcurrencyTableAdapters` powyżej początku deklaracji klasy.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-222">Note the using `NorthwindOptimisticConcurrencyTableAdapters` statement above the start of the class declaration.</span></span> <span data-ttu-id="8ea9a-223">Przestrzeń nazw `NorthwindOptimisticConcurrencyTableAdapters` zawiera klasę `ProductsOptimisticConcurrencyTableAdapter`, która dostarcza metody DAL.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-223">The `NorthwindOptimisticConcurrencyTableAdapters` namespace contains the `ProductsOptimisticConcurrencyTableAdapter` class, which provides the DAL's methods.</span></span> <span data-ttu-id="8ea9a-224">Ponadto przed deklaracją klasy znajdziesz atrybut `System.ComponentModel.DataObject`, który instruuje program Visual Studio, aby dołączył tę klasę do listy rozwijanej Kreatora elementu ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-224">Also before the class declaration you'll find the `System.ComponentModel.DataObject` attribute, which instructs Visual Studio to include this class in the ObjectDataSource wizard's drop-down list.</span></span>

<span data-ttu-id="8ea9a-225">Właściwość `Adapter` `ProductsOptimisticConcurrencyBLL`zapewnia szybki dostęp do wystąpienia klasy `ProductsOptimisticConcurrencyTableAdapter` i jest zgodna ze wzorcem używanym w oryginalnych klasach LOGIKI biznesowej (`ProductsBLL`, `CategoriesBLL`itd.).</span><span class="sxs-lookup"><span data-stu-id="8ea9a-225">The `ProductsOptimisticConcurrencyBLL`'s `Adapter` property provides quick access to an instance of the `ProductsOptimisticConcurrencyTableAdapter` class, and follows the pattern used in our original BLL classes (`ProductsBLL`, `CategoriesBLL`, and so on).</span></span> <span data-ttu-id="8ea9a-226">Na koniec Metoda `GetProducts()` po prostu wywołuje metodę `GetProducts()` DAL i zwraca obiekt `ProductsOptimisticConcurrencyDataTable` wypełniony wystąpieniem `ProductsOptimisticConcurrencyRow` dla każdego rekordu produktu w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-226">Finally, the `GetProducts()` method simply calls down into the DAL's `GetProducts()` method and returns a `ProductsOptimisticConcurrencyDataTable` object populated with a `ProductsOptimisticConcurrencyRow` instance for each product record in the database.</span></span>

## <a name="deleting-a-product-using-the-db-direct-pattern-with-optimistic-concurrency"></a><span data-ttu-id="8ea9a-227">Usuwanie produktu przy użyciu wzorca DB Direct z optymistyczną współbieżnością</span><span class="sxs-lookup"><span data-stu-id="8ea9a-227">Deleting a Product Using the DB Direct Pattern with Optimistic Concurrency</span></span>

<span data-ttu-id="8ea9a-228">W przypadku korzystania ze wzorca DB Direct dla DAL, który używa optymistycznej współbieżności, metody muszą być przenoszone do nowych i oryginalnych wartości.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-228">When using the DB direct pattern against a DAL that uses optimistic concurrency, the methods must be passed the new and original values.</span></span> <span data-ttu-id="8ea9a-229">W przypadku usuwania nie ma nowych wartości, dlatego tylko oryginalne wartości muszą zostać przesłane.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-229">For deleting, there are no new values, so only the original values need be passed in.</span></span> <span data-ttu-id="8ea9a-230">W naszym LOGIKI biznesowej należy zaakceptować wszystkie oryginalne parametry jako parametry wejściowe.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-230">In our BLL, then, we must accept all of the original parameters as input parameters.</span></span> <span data-ttu-id="8ea9a-231">Przyjrzyjmy się metodzie `DeleteProduct` w klasie `ProductsOptimisticConcurrencyBLL` za pomocą metody DB Direct.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-231">Let's have the `DeleteProduct` method in the `ProductsOptimisticConcurrencyBLL` class use the DB direct method.</span></span> <span data-ttu-id="8ea9a-232">Oznacza to, że ta metoda musi przyjąć wszystkie dziesięć pól danych produktu jako parametry wejściowe i przekazać je do DAL, jak pokazano w poniższym kodzie:</span><span class="sxs-lookup"><span data-stu-id="8ea9a-232">This means that this method needs to take in all ten product data fields as input parameters, and pass these to the DAL, as shown in the following code:</span></span>

[!code-csharp[Main](implementing-optimistic-concurrency-cs/samples/sample6.cs)]

<span data-ttu-id="8ea9a-233">Jeśli pierwotne wartości — te wartości, które zostały ostatnio załadowane do GridView (lub DetailsView lub FormView) — różnią się od wartości w bazie danych, gdy użytkownik kliknie przycisk Usuń, klauzula `WHERE` nie będzie zgodna z żadnym rekordem bazy danych i nie ma wpływu na rekordy.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-233">If the original values - those values that were last loaded into the GridView (or DetailsView or FormView) - differ from the values in the database when the user clicks the Delete button the `WHERE` clause won't match up with any database record and no records will be affected.</span></span> <span data-ttu-id="8ea9a-234">W związku z tym Metoda `Delete` TableAdapter zwróci `0`, a metoda `DeleteProduct` LOGIKI biznesowej zwróci `false`.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-234">Hence, the TableAdapter's `Delete` method will return `0` and the BLL's `DeleteProduct` method will return `false`.</span></span>

## <a name="updating-a-product-using-the-batch-update-pattern-with-optimistic-concurrency"></a><span data-ttu-id="8ea9a-235">Aktualizowanie produktu przy użyciu wzorca aktualizacji usługi Batch z optymistyczną współbieżnością</span><span class="sxs-lookup"><span data-stu-id="8ea9a-235">Updating a Product Using the Batch Update Pattern with Optimistic Concurrency</span></span>

<span data-ttu-id="8ea9a-236">Jak wspomniano wcześniej, TableAdapter Metoda `Update` dla wzorca aktualizacji wsadowej ma ten sam podpis metody, niezależnie od tego, czy jest stosowana Optymistyczna współbieżność.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-236">As noted earlier, the TableAdapter's `Update` method for the batch update pattern has the same method signature regardless of whether or not optimistic concurrency is employed.</span></span> <span data-ttu-id="8ea9a-237">Mianowicie, Metoda `Update` oczekuje obiektu DataRow, tablicy danych, elementu DataTable lub określonego typu.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-237">Namely, the `Update` method expects a DataRow, an array of DataRows, a DataTable, or a Typed DataSet.</span></span> <span data-ttu-id="8ea9a-238">Nie ma dodatkowych parametrów wejściowych do określenia oryginalnych wartości.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-238">There are no additional input parameters for specifying the original values.</span></span> <span data-ttu-id="8ea9a-239">Jest to możliwe, ponieważ element DataTable śledzi pierwotne i zmodyfikowane wartości dla swoich elementów DataRow.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-239">This is possible because the DataTable keeps track of the original and modified values for its DataRow(s).</span></span> <span data-ttu-id="8ea9a-240">Gdy DAL wystawia swoją instrukcję `UPDATE`, parametry `@original_ColumnName` są wypełniane oryginalnymi wartościami, natomiast parametry `@ColumnName` są wypełniane wartościami zmodyfikowanymi przez element DataRow.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-240">When the DAL issues its `UPDATE` statement, the `@original_ColumnName` parameters are populated with the DataRow's original values, whereas the `@ColumnName` parameters are populated with the DataRow's modified values.</span></span>

<span data-ttu-id="8ea9a-241">W klasie `ProductsBLL` (która korzysta z naszego oryginalnego, nieoptymistycznej współbieżności DAL), podczas korzystania ze wzorca aktualizacji wsadowych do aktualizowania informacji o produkcie nasz kod wykonuje następującą sekwencję zdarzeń:</span><span class="sxs-lookup"><span data-stu-id="8ea9a-241">In the `ProductsBLL` class (which uses our original, non-optimistic concurrency DAL), when using the batch update pattern to update product information our code performs the following sequence of events:</span></span>

1. <span data-ttu-id="8ea9a-242">Przeczytaj informacje o produkcie bieżącej bazy danych w wystąpieniu `ProductRow` przy użyciu metody `GetProductByProductID(productID)` TableAdapter</span><span class="sxs-lookup"><span data-stu-id="8ea9a-242">Read the current database product information into a `ProductRow` instance using the TableAdapter's `GetProductByProductID(productID)` method</span></span>
2. <span data-ttu-id="8ea9a-243">Przypisz nowe wartości do wystąpienia `ProductRow` z kroku 1</span><span class="sxs-lookup"><span data-stu-id="8ea9a-243">Assign the new values to the `ProductRow` instance from Step 1</span></span>
3. <span data-ttu-id="8ea9a-244">Wywołaj metodę `Update` TableAdapter, przekazując wystąpienie `ProductRow`</span><span class="sxs-lookup"><span data-stu-id="8ea9a-244">Call the TableAdapter's `Update` method, passing in the `ProductRow` instance</span></span>

<span data-ttu-id="8ea9a-245">Ta sekwencja kroków nie będzie jednak prawidłowo obsługiwać optymistycznej współbieżności, ponieważ `ProductRow` wypełnionej w kroku 1 jest wypełniana bezpośrednio z bazy danych, co oznacza, że oryginalne wartości używane przez ten element DataRow są te, które aktualnie istnieją w bazie danych, a nie te, które zostały powiązane z elementem GridView na początku procesu edycji.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-245">This sequence of steps, however, won't correctly support optimistic concurrency because the `ProductRow` populated in Step 1 is populated directly from the database, meaning that the original values used by the DataRow are those that currently exist in the database, and not those that were bound to the GridView at the start of the editing process.</span></span> <span data-ttu-id="8ea9a-246">Zamiast tego w przypadku używania optymistycznej DAL z obsługą współbieżności należy zmienić przeciążenia metody `UpdateProduct`, aby wykonać następujące czynności:</span><span class="sxs-lookup"><span data-stu-id="8ea9a-246">Instead, when using an optimistic concurrency-enabled DAL, we need to alter the `UpdateProduct` method overloads to use the following steps:</span></span>

1. <span data-ttu-id="8ea9a-247">Przeczytaj informacje o produkcie bieżącej bazy danych w wystąpieniu `ProductsOptimisticConcurrencyRow` przy użyciu metody `GetProductByProductID(productID)` TableAdapter</span><span class="sxs-lookup"><span data-stu-id="8ea9a-247">Read the current database product information into a `ProductsOptimisticConcurrencyRow` instance using the TableAdapter's `GetProductByProductID(productID)` method</span></span>
2. <span data-ttu-id="8ea9a-248">Przypisz *oryginalne* wartości do wystąpienia `ProductsOptimisticConcurrencyRow` z kroku 1</span><span class="sxs-lookup"><span data-stu-id="8ea9a-248">Assign the *original* values to the `ProductsOptimisticConcurrencyRow` instance from Step 1</span></span>
3. <span data-ttu-id="8ea9a-249">Wywołaj metodę `AcceptChanges()` `ProductsOptimisticConcurrencyRow` wystąpienia, która instruuje element DataRow, że jego bieżące wartości są "oryginalnymi"</span><span class="sxs-lookup"><span data-stu-id="8ea9a-249">Call the `ProductsOptimisticConcurrencyRow` instance's `AcceptChanges()` method, which instructs the DataRow that its current values are the "original" ones</span></span>
4. <span data-ttu-id="8ea9a-250">Przypisz *nowe* wartości do wystąpienia `ProductsOptimisticConcurrencyRow`</span><span class="sxs-lookup"><span data-stu-id="8ea9a-250">Assign the *new* values to the `ProductsOptimisticConcurrencyRow` instance</span></span>
5. <span data-ttu-id="8ea9a-251">Wywołaj metodę `Update` TableAdapter, przekazując wystąpienie `ProductsOptimisticConcurrencyRow`</span><span class="sxs-lookup"><span data-stu-id="8ea9a-251">Call the TableAdapter's `Update` method, passing in the `ProductsOptimisticConcurrencyRow` instance</span></span>

<span data-ttu-id="8ea9a-252">Krok 1 odczytuje wszystkie bieżące wartości bazy danych dla określonego rekordu produktu.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-252">Step 1 reads in all of the current database values for the specified product record.</span></span> <span data-ttu-id="8ea9a-253">Ten krok jest zbędny w ramach przeciążenia `UpdateProduct`, które aktualizuje *wszystkie* kolumny produktu (ponieważ te wartości są zastępowane w kroku 2), ale są niezbędne dla tych przeciążeń, w których tylko podzbiór wartości kolumn jest przenoszona jako parametry wejściowe.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-253">This step is superfluous in the `UpdateProduct` overload that updates *all* of the product columns (as these values are overwritten in Step 2), but is essential for those overloads where only a subset of the column values are passed in as input parameters.</span></span> <span data-ttu-id="8ea9a-254">Po przypisaniu oryginalnych wartości do wystąpienia `ProductsOptimisticConcurrencyRow`, wywoływana jest metoda `AcceptChanges()`, która oznacza bieżące wartości DataRow jako pierwotne wartości, które mają być używane w parametrach `@original_ColumnName` w instrukcji `UPDATE`.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-254">Once the original values have been assigned to the `ProductsOptimisticConcurrencyRow` instance, the `AcceptChanges()` method is called, which marks the current DataRow values as the original values to be used in the `@original_ColumnName` parameters in the `UPDATE` statement.</span></span> <span data-ttu-id="8ea9a-255">Następnie nowe wartości parametrów są przypisywane do `ProductsOptimisticConcurrencyRow`, a wreszcie Metoda `Update` jest wywoływana, przekazując w elemencie DataRow.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-255">Next, the new parameter values are assigned to the `ProductsOptimisticConcurrencyRow` and, finally, the `Update` method is invoked, passing in the DataRow.</span></span>

<span data-ttu-id="8ea9a-256">Poniższy kod przedstawia Przeciążenie `UpdateProduct`, które akceptuje wszystkie pola danych produktu jako parametry wejściowe.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-256">The following code shows the `UpdateProduct` overload that accepts all product data fields as input parameters.</span></span> <span data-ttu-id="8ea9a-257">Chociaż nie pokazano tego tutaj, Klasa `ProductsOptimisticConcurrencyBLL` uwzględniona w pobraniu dla tego samouczka zawiera również Przeciążenie `UpdateProduct`, które akceptuje tylko nazwę i cenę produktu jako parametry wejściowe.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-257">While not shown here, the `ProductsOptimisticConcurrencyBLL` class included in the download for this tutorial also contains an `UpdateProduct` overload that accepts just the product's name and price as input parameters.</span></span>

[!code-csharp[Main](implementing-optimistic-concurrency-cs/samples/sample7.cs)]

## <a name="step-4-passing-the-original-and-new-values-from-the-aspnet-page-to-the-bll-methods"></a><span data-ttu-id="8ea9a-258">Krok 4. przekazanie oryginalnych i nowych wartości ze strony ASP.NET do metod LOGIKI biznesowej</span><span class="sxs-lookup"><span data-stu-id="8ea9a-258">Step 4: Passing the Original and New Values From the ASP.NET Page to the BLL Methods</span></span>

<span data-ttu-id="8ea9a-259">Po ukończeniu DAL i LOGIKI biznesowej wszystko to jest w celu utworzenia strony ASP.NET, która może korzystać z optymistycznej logiki współbieżności wbudowanej w System.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-259">With the DAL and BLL complete, all that remains is to create an ASP.NET page that can utilize the optimistic concurrency logic built in to the system.</span></span> <span data-ttu-id="8ea9a-260">W odniesieniu do formantu sieci Web danych (GridView, DetailsView lub FormView) musi zapamiętać jego pierwotne wartości, a element ObjectDataSource musi przekazywać oba zestawy wartości do warstwy logiki biznesowej.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-260">Specifically, the data Web control (the GridView, DetailsView, or FormView) must remember its original values and the ObjectDataSource must pass both sets of values to the Business Logic Layer.</span></span> <span data-ttu-id="8ea9a-261">Ponadto należy skonfigurować stronę ASP.NET, aby bezpiecznie obsługiwać naruszenia współbieżności.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-261">Furthermore, the ASP.NET page must be configured to gracefully handle concurrency violations.</span></span>

<span data-ttu-id="8ea9a-262">Zacznij od otwarcia strony `OptimisticConcurrency.aspx` w folderze `EditInsertDelete` i dodania widoku GridView do projektanta, ustawiając jej Właściwość `ID` na `ProductsGrid`.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-262">Start by opening the `OptimisticConcurrency.aspx` page in the `EditInsertDelete` folder and adding a GridView to the Designer, setting its `ID` property to `ProductsGrid`.</span></span> <span data-ttu-id="8ea9a-263">W tagu inteligentnym GridView, należy wybrać opcję Utwórz nowy element ObjectDataSource o nazwie `ProductsOptimisticConcurrencyDataSource`.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-263">From the GridView's smart tag, opt to create a new ObjectDataSource named `ProductsOptimisticConcurrencyDataSource`.</span></span> <span data-ttu-id="8ea9a-264">Ponieważ chcemy, aby ten element ObjectDataSource używał DAL, który obsługuje optymistyczne współbieżność, skonfiguruj go tak, aby korzystał z obiektu `ProductsOptimisticConcurrencyBLL`.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-264">Since we want this ObjectDataSource to use the DAL that supports optimistic concurrency, configure it to use the `ProductsOptimisticConcurrencyBLL` object.</span></span>

<span data-ttu-id="8ea9a-265">[![, że element ObjectDataSource używa obiektu ProductsOptimisticConcurrencyBLL](implementing-optimistic-concurrency-cs/_static/image36.png)](implementing-optimistic-concurrency-cs/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="8ea9a-265">[![Have the ObjectDataSource Use the ProductsOptimisticConcurrencyBLL Object](implementing-optimistic-concurrency-cs/_static/image36.png)](implementing-optimistic-concurrency-cs/_static/image35.png)</span></span>

<span data-ttu-id="8ea9a-266">**Ilustracja 13**. aby element ObjectDataSource używał obiektu `ProductsOptimisticConcurrencyBLL` ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](implementing-optimistic-concurrency-cs/_static/image37.png))</span><span class="sxs-lookup"><span data-stu-id="8ea9a-266">**Figure 13**: Have the ObjectDataSource Use the `ProductsOptimisticConcurrencyBLL` Object ([Click to view full-size image](implementing-optimistic-concurrency-cs/_static/image37.png))</span></span>

<span data-ttu-id="8ea9a-267">Wybierz metody `GetProducts`, `UpdateProduct`i `DeleteProduct` z list rozwijanych w kreatorze.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-267">Choose the `GetProducts`, `UpdateProduct`, and `DeleteProduct` methods from drop-down lists in the wizard.</span></span> <span data-ttu-id="8ea9a-268">Dla metody UpdateProduct Użyj przeciążenia, które akceptuje wszystkie pola danych produktu.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-268">For the UpdateProduct method, use the overload that accepts all of the product's data fields.</span></span>

## <a name="configuring-the-objectdatasource-controls-properties"></a><span data-ttu-id="8ea9a-269">Konfigurowanie właściwości kontrolki ObjectDataSource</span><span class="sxs-lookup"><span data-stu-id="8ea9a-269">Configuring the ObjectDataSource Control's Properties</span></span>

<span data-ttu-id="8ea9a-270">Po zakończeniu działania kreatora znaczniki deklaratywne elementu ObjectDataSource powinny wyglądać następująco:</span><span class="sxs-lookup"><span data-stu-id="8ea9a-270">After completing the wizard, the ObjectDataSource's declarative markup should look like the following:</span></span>

[!code-aspx[Main](implementing-optimistic-concurrency-cs/samples/sample8.aspx)]

<span data-ttu-id="8ea9a-271">Jak widać, kolekcja `DeleteParameters` zawiera wystąpienie `Parameter` dla każdego z dziesięciu parametrów wejściowych w metodzie `DeleteProduct` klasy `ProductsOptimisticConcurrencyBLL`.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-271">As you can see, the `DeleteParameters` collection contains a `Parameter` instance for each of the ten input parameters in the `ProductsOptimisticConcurrencyBLL` class's `DeleteProduct` method.</span></span> <span data-ttu-id="8ea9a-272">Podobnie kolekcja `UpdateParameters` zawiera wystąpienie `Parameter` dla każdego z parametrów wejściowych w `UpdateProduct`.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-272">Likewise, the `UpdateParameters` collection contains a `Parameter` instance for each of the input parameters in `UpdateProduct`.</span></span>

<span data-ttu-id="8ea9a-273">Dla tych wcześniejszych samouczków, które dotyczyły modyfikacji danych, usuniemy Właściwość `OldValuesParameterFormatString` elementu ObjectDataSource w tym momencie, ponieważ ta właściwość wskazuje, że metoda LOGIKI biznesowej oczekuje starych (lub oryginalnych) wartości do przekazania, a także nowych wartości.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-273">For those previous tutorials that involved data modification, we'd remove the ObjectDataSource's `OldValuesParameterFormatString` property at this point, since this property indicates that the BLL method expects the old (or original) values to be passed in as well as the new values.</span></span> <span data-ttu-id="8ea9a-274">Ponadto ta wartość właściwości wskazuje nazwy parametrów wejściowych dla oryginalnych wartości.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-274">Furthermore, this property value indicates the input parameter names for the original values.</span></span> <span data-ttu-id="8ea9a-275">Ponieważ przekazujemy oryginalne wartości do LOGIKI biznesowej, *nie usuwaj* tej właściwości.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-275">Since we are passing in the original values into the BLL, do *not* remove this property.</span></span>

> [!NOTE]
> <span data-ttu-id="8ea9a-276">Wartość właściwości `OldValuesParameterFormatString` musi być mapowana na nazwy parametrów wejściowych w LOGIKI biznesowej, które oczekują oryginalnych wartości.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-276">The value of the `OldValuesParameterFormatString` property must map to the input parameter names in the BLL that expect the original values.</span></span> <span data-ttu-id="8ea9a-277">Ponieważ zostały nazwane te parametry `original_productName`, `original_supplierID`i tak dalej, można pozostawić wartość właściwości `OldValuesParameterFormatString` jako `original_{0}`.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-277">Since we named these parameters `original_productName`, `original_supplierID`, and so on, you can leave the `OldValuesParameterFormatString` property value as `original_{0}`.</span></span> <span data-ttu-id="8ea9a-278">Jeśli jednak parametry wejściowe metody LOGIKI biznesowej mają nazwy, takie jak `old_productName`, `old_supplierID`i tak dalej, należy zaktualizować Właściwość `OldValuesParameterFormatString` na `old_{0}`.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-278">If, however, the BLL methods' input parameters had names like `old_productName`, `old_supplierID`, and so on, you'd need to update the `OldValuesParameterFormatString` property to `old_{0}`.</span></span>

<span data-ttu-id="8ea9a-279">Istnieje jedno ustawienie właściwości końcowej, które musi zostać wykonane, aby element ObjectDataSource prawidłowo przeszedł oryginalne wartości do metod LOGIKI biznesowej.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-279">There's one final property setting that needs to be made in order for the ObjectDataSource to correctly pass the original values to the BLL methods.</span></span> <span data-ttu-id="8ea9a-280">Element ObjectDataSource ma [Właściwość ConflictDetection](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.conflictdetection.aspx) , która może być przypisana do [jednej z dwóch wartości](https://msdn.microsoft.com/library/system.web.ui.conflictoptions.aspx):</span><span class="sxs-lookup"><span data-stu-id="8ea9a-280">The ObjectDataSource has a [ConflictDetection property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.conflictdetection.aspx) that can be assigned to [one of two values](https://msdn.microsoft.com/library/system.web.ui.conflictoptions.aspx):</span></span>

- <span data-ttu-id="8ea9a-281">`OverwriteChanges` — wartość domyślna; nie wysyła oryginalnych wartości do oryginalnych parametrów wejściowych metod LOGIKI biznesowej</span><span class="sxs-lookup"><span data-stu-id="8ea9a-281">`OverwriteChanges` - the default value; does not send the original values to the BLL methods' original input parameters</span></span>
- <span data-ttu-id="8ea9a-282">`CompareAllValues` — wysyła oryginalne wartości do metod LOGIKI biznesowej; Wybierz tę opcję, jeśli używasz optymistycznej współbieżności</span><span class="sxs-lookup"><span data-stu-id="8ea9a-282">`CompareAllValues` - does send the original values to the BLL methods; choose this option when using optimistic concurrency</span></span>

<span data-ttu-id="8ea9a-283">Poświęć chwilę, aby ustawić właściwość `ConflictDetection` na `CompareAllValues`.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-283">Take a moment to set the `ConflictDetection` property to `CompareAllValues`.</span></span>

## <a name="configuring-the-gridviews-properties-and-fields"></a><span data-ttu-id="8ea9a-284">Konfigurowanie właściwości i pól widoku GridView</span><span class="sxs-lookup"><span data-stu-id="8ea9a-284">Configuring the GridView's Properties and Fields</span></span>

<span data-ttu-id="8ea9a-285">Po prawidłowym skonfigurowaniu właściwości elementu ObjectDataSource Przyjrzyjmy się naszej uwagi, aby skonfigurować widok GridView.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-285">With the ObjectDataSource's properties properly configured, let's turn our attention to setting up the GridView.</span></span> <span data-ttu-id="8ea9a-286">Po pierwsze, ponieważ chcemy, aby GridView obsługiwał edytowanie i usuwanie, kliknij pole wyboru Włącz edytowanie i Włącz usuwanie w tagu inteligentnym GridView.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-286">First, since we want the GridView to support editing and deleting, click the Enable Editing and Enable Deleting checkboxes from the GridView's smart tag.</span></span> <span data-ttu-id="8ea9a-287">Spowoduje to dodanie elementu CommandField, którego `ShowEditButton` i `ShowDeleteButton` są ustawione jako `true`.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-287">This will add a CommandField whose `ShowEditButton` and `ShowDeleteButton` are both set to `true`.</span></span>

<span data-ttu-id="8ea9a-288">Po powiązaniu z `ProductsOptimisticConcurrencyDataSource` elementem ObjectDataSource, GridView zawiera pole dla każdego z pól danych produktu.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-288">When bound to the `ProductsOptimisticConcurrencyDataSource` ObjectDataSource, the GridView contains a field for each of the product's data fields.</span></span> <span data-ttu-id="8ea9a-289">Ten widok GridView można edytować, ale środowisko użytkownika jest dowolne, ale akceptowalne.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-289">While such a GridView can be edited, the user experience is anything but acceptable.</span></span> <span data-ttu-id="8ea9a-290">`CategoryID` i `SupplierID` BoundFields będą renderowane jako pola tekstowe, wymagając od użytkownika podania odpowiedniej kategorii i dostawcy jako numerów IDENTYFIKACYJNych.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-290">The `CategoryID` and `SupplierID` BoundFields will render as TextBoxes, requiring the user to enter the appropriate category and supplier as ID numbers.</span></span> <span data-ttu-id="8ea9a-291">Nie ma żadnego formatowania dla pól liczbowych i nie ma żadnych kontrolek weryfikacji, aby upewnić się, że nazwa produktu została podana oraz że cena jednostkowa, jednostki w magazynie, jednostki w kolejności i wartości na poziomie zmiany kolejności są prawidłowymi wartościami liczbowymi i są większe lub równe na zero.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-291">There will be no formatting for the numeric fields and no validation controls to ensure that the product's name has been supplied and that the unit price, units in stock, units on order, and reorder level values are both proper numeric values and are greater than or equal to zero.</span></span>

<span data-ttu-id="8ea9a-292">Zgodnie z opisem w temacie *Dodawanie kontrolek weryfikacji do edycji i wstawiania interfejsów* i dostosowywania samouczków dotyczących *interfejsu modyfikacji danych* , interfejs użytkownika można dostosować, zastępując BoundFields z używanie TemplateField.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-292">As we discussed in the *Adding Validation Controls to the Editing and Inserting Interfaces* and *Customizing the Data Modification Interface* tutorials, the user interface can be customized by replacing the BoundFields with TemplateFields.</span></span> <span data-ttu-id="8ea9a-293">Zmodyfikowano ten widok GridView i jego interfejs edycji w następujący sposób:</span><span class="sxs-lookup"><span data-stu-id="8ea9a-293">I've modified this GridView and its editing interface in the following ways:</span></span>

- <span data-ttu-id="8ea9a-294">Usunięto `ProductID`, `SupplierName`i `CategoryName` BoundFields</span><span class="sxs-lookup"><span data-stu-id="8ea9a-294">Removed the `ProductID`, `SupplierName`, and `CategoryName` BoundFields</span></span>
- <span data-ttu-id="8ea9a-295">Przekonwertowano `ProductName` BoundField na TemplateField i dodano kontrolkę RequiredFieldValidation.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-295">Converted the `ProductName` BoundField to a TemplateField and added a RequiredFieldValidation control.</span></span>
- <span data-ttu-id="8ea9a-296">Przekonwertowano `CategoryID` i `SupplierID` BoundFields na używanie TemplateField i dostosowano interfejs edycji do używania kontrolek DropDownList zamiast pól tekstowych.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-296">Converted the `CategoryID` and `SupplierID` BoundFields to TemplateFields, and adjusted the editing interface to use DropDownLists rather than TextBoxes.</span></span> <span data-ttu-id="8ea9a-297">W tych używanie TemplateField `ItemTemplates`wyświetlane są pola danych `CategoryName` i `SupplierName`.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-297">In these TemplateFields' `ItemTemplates`, the `CategoryName` and `SupplierName` data fields are displayed.</span></span>
- <span data-ttu-id="8ea9a-298">Przekonwertowane `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`i `ReorderLevel` BoundFields na używanie TemplateField i dodane kontrolki CompareValidator.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-298">Converted the `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, and `ReorderLevel` BoundFields to TemplateFields and added CompareValidator controls.</span></span>

<span data-ttu-id="8ea9a-299">Ze względu na to, jak można wykonać te zadania w poprzednich samouczkach, w tym miejscu chcę wyświetlić ostateczną składnię deklaratywną i pozostawić implementację jako ćwiczenie.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-299">Since we've already examined how to accomplish these tasks in previous tutorials, I'll just list the final declarative syntax here and leave the implementation as practice.</span></span>

[!code-aspx[Main](implementing-optimistic-concurrency-cs/samples/sample9.aspx)]

<span data-ttu-id="8ea9a-300">Jesteśmy bardzo blisko, aby przetworzyć w pełni działający przykład.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-300">We're very close to having a fully-working example.</span></span> <span data-ttu-id="8ea9a-301">Istnieje jednak kilka subtletiesów, które wywołują się i spowodują problemy.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-301">However, there are a few subtleties that will creep up and cause us problems.</span></span> <span data-ttu-id="8ea9a-302">Ponadto nadal potrzebujemy pewnego interfejsu, który ostrzega użytkownika o wystąpieniu naruszenia współbieżności.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-302">Additionally, we still need some interface that alerts the user when a concurrency violation has occurred.</span></span>

> [!NOTE]
> <span data-ttu-id="8ea9a-303">Aby formant sieci Web danych prawidłowo przekazywać oryginalne wartości do elementu ObjectDataSource (które są następnie przekazywane do LOGIKI biznesowej), ważne jest, aby Właściwość `EnableViewState` GridView była ustawiona na `true` (domyślnie).</span><span class="sxs-lookup"><span data-stu-id="8ea9a-303">In order for a data Web control to correctly pass the original values to the ObjectDataSource (which are then passed to the BLL), it's vital that the GridView's `EnableViewState` property is set to `true` (the default).</span></span> <span data-ttu-id="8ea9a-304">Jeśli wyłączysz stan widoku, oryginalne wartości zostaną utracone po odświeżeniu.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-304">If you disable view state, the original values are lost on postback.</span></span>

## <a name="passing-the-correct-original-values-to-the-objectdatasource"></a><span data-ttu-id="8ea9a-305">Przekazywanie prawidłowych wartości pierwotnych do elementu ObjectDataSource</span><span class="sxs-lookup"><span data-stu-id="8ea9a-305">Passing the Correct Original Values to the ObjectDataSource</span></span>

<span data-ttu-id="8ea9a-306">Istnieje kilka problemów ze sposobem, w jaki widok GridView został skonfigurowany.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-306">There are a couple of problems with the way the GridView has been configured.</span></span> <span data-ttu-id="8ea9a-307">Jeśli właściwość `ConflictDetection` elementu ObjectDataSource jest ustawiona na wartość `CompareAllValues` (jako nasza), gdy `Update()` elementu ObjectDataSource lub metoda `Delete()` są wywoływane przez GridView (lub DetailsView lub FormView), element ObjectDataSource próbuje skopiować oryginalne wartości elementu GridView do odpowiednich wystąpień `Parameter`.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-307">If the ObjectDataSource's `ConflictDetection` property is set to `CompareAllValues` (as is ours), when the ObjectDataSource's `Update()` or `Delete()` methods are invoked by the GridView (or DetailsView or FormView), the ObjectDataSource attempts to copy the GridView's original values into its appropriate `Parameter` instances.</span></span> <span data-ttu-id="8ea9a-308">Zapoznaj się z powrotem do rysunku 2, aby poznać graficzną reprezentację tego procesu.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-308">Refer back to Figure 2 for a graphical representation of this process.</span></span>

<span data-ttu-id="8ea9a-309">W szczególnym czasie pierwotne wartości elementu GridView są przypisywane wartościom w dwukierunkowych instrukcjach wiązania danych, gdy dane są powiązane z elementem GridView.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-309">Specifically, the GridView's original values are assigned the values in the two-way databinding statements each time the data is bound to the GridView.</span></span> <span data-ttu-id="8ea9a-310">W związku z tym ważne jest, aby wszystkie wymagane oryginalne wartości były przechwytywane za pośrednictwem dwukierunkowego wiązania danych i że są one dostarczane w formacie konwersji.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-310">Therefore, it's essential that the required original values all are captured via two-way databinding and that they are provided in a convertible format.</span></span>

<span data-ttu-id="8ea9a-311">Aby dowiedzieć się, dlaczego jest to ważne, zapoznaj się z naszą stroną w przeglądarce.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-311">To see why this is important, take a moment to visit our page in a browser.</span></span> <span data-ttu-id="8ea9a-312">Zgodnie z oczekiwaniami, GridView wyświetla każdy produkt za pomocą przycisku Edytuj i Usuń w kolumnie z lewej strony.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-312">As expected, the GridView lists each product with an Edit and Delete button in the leftmost column.</span></span>

<span data-ttu-id="8ea9a-313">[![produkty są wymienione w widoku GridView](implementing-optimistic-concurrency-cs/_static/image39.png)](implementing-optimistic-concurrency-cs/_static/image38.png)</span><span class="sxs-lookup"><span data-stu-id="8ea9a-313">[![The Products are Listed in a GridView](implementing-optimistic-concurrency-cs/_static/image39.png)](implementing-optimistic-concurrency-cs/_static/image38.png)</span></span>

<span data-ttu-id="8ea9a-314">**Ilustracja 14**. produkty są wymienione w widoku GridView ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](implementing-optimistic-concurrency-cs/_static/image40.png))</span><span class="sxs-lookup"><span data-stu-id="8ea9a-314">**Figure 14**: The Products are Listed in a GridView ([Click to view full-size image](implementing-optimistic-concurrency-cs/_static/image40.png))</span></span>

<span data-ttu-id="8ea9a-315">Jeśli klikniesz przycisk Usuń dla dowolnego produktu, zostanie zgłoszony `FormatException`.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-315">If you click the Delete button for any product, a `FormatException` is thrown.</span></span>

<span data-ttu-id="8ea9a-316">[![próby usunięcia dowolnych wyników z produktu w FormatException](implementing-optimistic-concurrency-cs/_static/image42.png)](implementing-optimistic-concurrency-cs/_static/image41.png)</span><span class="sxs-lookup"><span data-stu-id="8ea9a-316">[![Attempting to Delete Any Product Results in a FormatException](implementing-optimistic-concurrency-cs/_static/image42.png)](implementing-optimistic-concurrency-cs/_static/image41.png)</span></span>

<span data-ttu-id="8ea9a-317">**Ilustracja 15**. próba usunięcia wszystkich wyników produktów w `FormatException` ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](implementing-optimistic-concurrency-cs/_static/image43.png))</span><span class="sxs-lookup"><span data-stu-id="8ea9a-317">**Figure 15**: Attempting to Delete Any Product Results in a `FormatException` ([Click to view full-size image](implementing-optimistic-concurrency-cs/_static/image43.png))</span></span>

<span data-ttu-id="8ea9a-318">`FormatException` jest wywoływane, gdy element ObjectDataSource próbuje odczytać w pierwotnej wartości `UnitPrice`.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-318">The `FormatException` is raised when the ObjectDataSource attempts to read in the original `UnitPrice` value.</span></span> <span data-ttu-id="8ea9a-319">Ponieważ `ItemTemplate` ma `UnitPrice` sformatowaną jako waluta (`<%# Bind("UnitPrice", "{0:C}") %>`), zawiera symbol waluty, na przykład $19,95.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-319">Since the `ItemTemplate` has the `UnitPrice` formatted as a currency (`<%# Bind("UnitPrice", "{0:C}") %>`), it includes a currency symbol, like $19.95.</span></span> <span data-ttu-id="8ea9a-320">`FormatException` występuje, ponieważ element ObjectDataSource próbuje przekonwertować ten ciąg na `decimal`.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-320">The `FormatException` occurs as the ObjectDataSource attempts to convert this string into a `decimal`.</span></span> <span data-ttu-id="8ea9a-321">Aby obejść ten problem, mamy kilka opcji:</span><span class="sxs-lookup"><span data-stu-id="8ea9a-321">To circumvent this problem, we have a number of options:</span></span>

- <span data-ttu-id="8ea9a-322">Usuń formatowanie waluty z `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-322">Remove the currency formatting from the `ItemTemplate`.</span></span> <span data-ttu-id="8ea9a-323">Oznacza to, że zamiast używać `<%# Bind("UnitPrice", "{0:C}") %>`, wystarczy użyć `<%# Bind("UnitPrice") %>`.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-323">That is, instead of using `<%# Bind("UnitPrice", "{0:C}") %>`, simply use `<%# Bind("UnitPrice") %>`.</span></span> <span data-ttu-id="8ea9a-324">Minusem jest to, że cena nie jest już sformatowana.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-324">The downside of this is that the price is no longer formatted.</span></span>
- <span data-ttu-id="8ea9a-325">Wyświetl `UnitPrice` sformatowaną jako walutę w `ItemTemplate`, ale Użyj słowa kluczowego `Eval`, aby to zrobić.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-325">Display the `UnitPrice` formatted as a currency in the `ItemTemplate`, but use the `Eval` keyword to accomplish this.</span></span> <span data-ttu-id="8ea9a-326">Odwołaj, że `Eval` wykonuje jednokierunkowe powiązanie danych.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-326">Recall that `Eval` performs one-way databinding.</span></span> <span data-ttu-id="8ea9a-327">Nadal musimy podać wartość `UnitPrice` dla oryginalnych wartości, więc nadal będzie potrzebna dwukierunkowa instrukcja DataBinding w `ItemTemplate`, ale można ją umieścić w kontrolce sieci Web etykiety, której Właściwość `Visible` jest ustawiona na `false`.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-327">We still need to provide the `UnitPrice` value for the original values, so we'll still need a two-way databinding statement in the `ItemTemplate`, but this can be placed in a Label Web control whose `Visible` property is set to `false`.</span></span> <span data-ttu-id="8ea9a-328">Możemy użyć następującego znacznika w ItemTemplate:</span><span class="sxs-lookup"><span data-stu-id="8ea9a-328">We could use the following markup in the ItemTemplate:</span></span>

[!code-aspx[Main](implementing-optimistic-concurrency-cs/samples/sample10.aspx)]

- <span data-ttu-id="8ea9a-329">Usuń formatowanie waluty z `ItemTemplate`przy użyciu `<%# Bind("UnitPrice") %>`.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-329">Remove the currency formatting from the `ItemTemplate`, using `<%# Bind("UnitPrice") %>`.</span></span> <span data-ttu-id="8ea9a-330">W programie obsługi zdarzeń `RowDataBound` GridView program programowo uzyskuje dostęp do kontrolki sieci Web etykieta, w której zostanie wyświetlona wartość `UnitPrice`, i ustawi jej Właściwość `Text` na sformatowaną wersję.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-330">In the GridView's `RowDataBound` event handler, programmatically access the Label Web control within which the `UnitPrice` value is displayed and set its `Text` property to the formatted version.</span></span>
- <span data-ttu-id="8ea9a-331">Pozostaw `UnitPrice` sformatowany jako walutę.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-331">Leave the `UnitPrice` formatted as a currency.</span></span> <span data-ttu-id="8ea9a-332">W programie obsługi zdarzeń `RowDeleting` GridView Zastąp istniejącą oryginalną wartość `UnitPrice` ($19,95) wartością rzeczywistą dziesiętną przy użyciu `Decimal.Parse`.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-332">In the GridView's `RowDeleting` event handler, replace the existing original `UnitPrice` value ($19.95) with an actual decimal value using `Decimal.Parse`.</span></span> <span data-ttu-id="8ea9a-333">Znaleźliśmy, jak wykonać coś podobnego w obsłudze zdarzeń `RowUpdating` w przypadku [*obsługi wyjątków logiki biznesowej i dal w samouczku dotyczącym strony ASP.NET*](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) .</span><span class="sxs-lookup"><span data-stu-id="8ea9a-333">We saw how to accomplish something similar in the `RowUpdating` event handler in the [*Handling BLL- and DAL-Level Exceptions in an ASP.NET Page*](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) tutorial.</span></span>

<span data-ttu-id="8ea9a-334">W przypadku mojego przykładu wybieramy, aby przejść do drugiego podejścia, dodając kontrolkę sieci Web ukrytej etykiety, której Właściwość `Text` to dane dwukierunkowe powiązane z niesformatowaną `UnitPrice` wartością.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-334">For my example I chose to go with the second approach, adding a hidden Label Web control whose `Text` property is two-way data bound to the unformatted `UnitPrice` value.</span></span>

<span data-ttu-id="8ea9a-335">Po rozwiązaniu tego problemu spróbuj ponownie kliknąć przycisk Usuń dla każdego produktu.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-335">After solving this problem, try clicking the Delete button for any product again.</span></span> <span data-ttu-id="8ea9a-336">Tym razem otrzymasz `InvalidOperationException`, gdy element ObjectDataSource podejmie próbę wywołania metody `UpdateProduct` LOGIKI biznesowej.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-336">This time you'll get an `InvalidOperationException` when the ObjectDataSource attempts to invoke the BLL's `UpdateProduct` method.</span></span>

<span data-ttu-id="8ea9a-337">[![element ObjectDataSource nie może znaleźć metody z parametrami wejściowymi, które chce wysłać](implementing-optimistic-concurrency-cs/_static/image45.png)](implementing-optimistic-concurrency-cs/_static/image44.png)</span><span class="sxs-lookup"><span data-stu-id="8ea9a-337">[![The ObjectDataSource Cannot Find a Method with the Input Parameters it Wants to Send](implementing-optimistic-concurrency-cs/_static/image45.png)](implementing-optimistic-concurrency-cs/_static/image44.png)</span></span>

<span data-ttu-id="8ea9a-338">**Ilustracja 16**. Element ObjectDataSource nie może znaleźć metody z parametrami wejściowymi, które chce wysłać ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](implementing-optimistic-concurrency-cs/_static/image46.png))</span><span class="sxs-lookup"><span data-stu-id="8ea9a-338">**Figure 16**: The ObjectDataSource Cannot Find a Method with the Input Parameters it Wants to Send ([Click to view full-size image](implementing-optimistic-concurrency-cs/_static/image46.png))</span></span>

<span data-ttu-id="8ea9a-339">Oglądając komunikat wyjątku, należy wyczyścić, że element ObjectDataSource chce wywołać metodę LOGIKI biznesowej `DeleteProduct`, która zawiera parametry wejściowe `original_CategoryName` i `original_SupplierName`.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-339">Looking at the exception's message, it's clear that the ObjectDataSource wants to invoke a BLL `DeleteProduct` method that includes `original_CategoryName` and `original_SupplierName` input parameters.</span></span> <span data-ttu-id="8ea9a-340">Wynika to z faktu, że `ItemTemplate` s dla `CategoryID` i `SupplierID` używanie TemplateField obecnie zawiera instrukcje dwukierunkowego wiązania z polami danych `CategoryName` i `SupplierName`.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-340">This is because the `ItemTemplate` s for the `CategoryID` and `SupplierID` TemplateFields currently contain two-way Bind statements with the `CategoryName` and `SupplierName` data fields.</span></span> <span data-ttu-id="8ea9a-341">Zamiast tego musimy uwzględnić instrukcje `Bind` z polami danych `CategoryID` i `SupplierID`.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-341">Instead, we need to include `Bind` statements with the `CategoryID` and `SupplierID` data fields.</span></span> <span data-ttu-id="8ea9a-342">Aby to osiągnąć, Zastąp istniejące instrukcje bind instrukcją `Eval`, a następnie Dodaj ukryte kontrolki etykiety, których właściwości `Text` są powiązane z polami danych `CategoryID` i `SupplierID` przy użyciu wiązania dwukierunkowego, jak pokazano poniżej:</span><span class="sxs-lookup"><span data-stu-id="8ea9a-342">To accomplish this, replace the existing Bind statements with `Eval` statements, and then add hidden Label controls whose `Text` properties are bound to the `CategoryID` and `SupplierID` data fields using two-way databinding, as shown below:</span></span>

[!code-aspx[Main](implementing-optimistic-concurrency-cs/samples/sample11.aspx)]

<span data-ttu-id="8ea9a-343">Po wprowadzeniu tych zmian teraz można pomyślnie usunąć i edytować informacje o produkcie.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-343">With these changes, we are now able to successfully delete and edit product information!</span></span> <span data-ttu-id="8ea9a-344">W kroku 5 powiesz się, jak sprawdzić, czy są wykryte naruszenia współbieżności.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-344">In Step 5 we'll look at how to verify that concurrency violations are being detected.</span></span> <span data-ttu-id="8ea9a-345">Jednak za kilka minut spróbuj zaktualizować i usunąć kilka rekordów, aby upewnić się, że aktualizacja i usuwanie dla jednego użytkownika działa zgodnie z oczekiwaniami.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-345">But for now, take a few minutes to try updating and deleting a few records to ensure that updating and deleting for a single user works as expected.</span></span>

## <a name="step-5-testing-the-optimistic-concurrency-support"></a><span data-ttu-id="8ea9a-346">Krok 5. Testowanie obsługi optymistycznej współbieżności</span><span class="sxs-lookup"><span data-stu-id="8ea9a-346">Step 5: Testing the Optimistic Concurrency Support</span></span>

<span data-ttu-id="8ea9a-347">Aby upewnić się, że są wykrywane naruszenia współbieżności (zamiast polegania na wykryciu danych), musimy otworzyć dwa okna przeglądarki na tej stronie.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-347">In order to verify that concurrency violations are being detected (rather than resulting in data being blindly overwritten), we need to open two browser windows to this page.</span></span> <span data-ttu-id="8ea9a-348">W obu wystąpieniach przeglądarki kliknij przycisk Edytuj dla Chai.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-348">In both browser instances, click on the Edit button for Chai.</span></span> <span data-ttu-id="8ea9a-349">Następnie w jednej z przeglądarek Zmień nazwę na "Chai herbata" i kliknij przycisk Aktualizuj.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-349">Then, in just one of the browsers, change the name to "Chai Tea" and click Update.</span></span> <span data-ttu-id="8ea9a-350">Aktualizacja powinna zakończyć się pomyślnie i zwrócić widok GridView do stanu sprzed edycji, z opcją "Chai herbata" jako nową nazwą produktu.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-350">The update should succeed and return the GridView to its pre-editing state, with "Chai Tea" as the new product name.</span></span>

<span data-ttu-id="8ea9a-351">W innym wystąpieniu okna przeglądarki, jednak pole tekstowe Nazwa produktu nadal zawiera "Chai".</span><span class="sxs-lookup"><span data-stu-id="8ea9a-351">In the other browser window instance, however, the product name TextBox still shows "Chai".</span></span> <span data-ttu-id="8ea9a-352">W tym drugim oknie przeglądarki zaktualizuj `UnitPrice`, aby `25.00`.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-352">In this second browser window, update the `UnitPrice` to `25.00`.</span></span> <span data-ttu-id="8ea9a-353">Bez optymistycznej obsługi współbieżności, kliknięcie pozycji Aktualizuj w drugim wystąpieniu przeglądarki spowoduje zmianę nazwy produktu z powrotem na "Chai", co powoduje zastąpienie zmian wprowadzonych w pierwszym wystąpieniu przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-353">Without optimistic concurrency support, clicking update in the second browser instance would change the product name back to "Chai", thereby overwriting the changes made by the first browser instance.</span></span> <span data-ttu-id="8ea9a-354">Jednak dzięki optymistycznej współbieżności, kliknięcie przycisku Aktualizuj w drugim wystąpieniu przeglądarki skutkuje wystąpieniem [DBConcurrencyException](https://msdn.microsoft.com/library/system.data.dbconcurrencyexception.aspx).</span><span class="sxs-lookup"><span data-stu-id="8ea9a-354">With optimistic concurrency employed, however, clicking the Update button in the second browser instance results in a [DBConcurrencyException](https://msdn.microsoft.com/library/system.data.dbconcurrencyexception.aspx).</span></span>

<span data-ttu-id="8ea9a-355">[![, gdy zostanie wykryte naruszenie współbieżności, zostanie zgłoszony wyjątek DBConcurrencyException](implementing-optimistic-concurrency-cs/_static/image48.png)](implementing-optimistic-concurrency-cs/_static/image47.png)</span><span class="sxs-lookup"><span data-stu-id="8ea9a-355">[![When a Concurrency Violation is Detected, a DBConcurrencyException is Thrown](implementing-optimistic-concurrency-cs/_static/image48.png)](implementing-optimistic-concurrency-cs/_static/image47.png)</span></span>

<span data-ttu-id="8ea9a-356">**Ilustracja 17**. w przypadku wykrycia naruszenia współbieżności zostanie zgłoszony `DBConcurrencyException` ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](implementing-optimistic-concurrency-cs/_static/image49.png))</span><span class="sxs-lookup"><span data-stu-id="8ea9a-356">**Figure 17**: When a Concurrency Violation is Detected, a `DBConcurrencyException` is Thrown ([Click to view full-size image](implementing-optimistic-concurrency-cs/_static/image49.png))</span></span>

<span data-ttu-id="8ea9a-357">`DBConcurrencyException` jest generowany tylko wtedy, gdy jest używany wzorzec aktualizacji wsadowych DAL.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-357">The `DBConcurrencyException` is only thrown when the DAL's batch update pattern is utilized.</span></span> <span data-ttu-id="8ea9a-358">Wzorzec DB Direct nie zgłasza wyjątku, tylko wskazuje, że nie wpłynęło to na żadne wiersze.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-358">The DB direct pattern does not raise an exception, it merely indicates that no rows were affected.</span></span> <span data-ttu-id="8ea9a-359">Aby to zilustrować, zwróć widok widoku GridView obu wystąpień przeglądarki do stanu sprzed edycji.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-359">To illustrate this, return both browser instances' GridView to their pre-editing state.</span></span> <span data-ttu-id="8ea9a-360">Następnie w pierwszym wystąpieniu przeglądarki kliknij przycisk Edytuj, a następnie zmień nazwę produktu z "Chai herbata" z powrotem na "Chai", a następnie kliknij przycisk Aktualizuj.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-360">Next, in the first browser instance, click the Edit button and change the product name from "Chai Tea" back to "Chai" and click Update.</span></span> <span data-ttu-id="8ea9a-361">W drugim oknie przeglądarki kliknij przycisk Usuń dla Chai.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-361">In the second browser window, click the Delete button for Chai.</span></span>

<span data-ttu-id="8ea9a-362">Po kliknięciu przycisku Usuń Strona zapisuje zwrotnie, a element GridView wywołuje metodę `Delete()` elementu ObjectDataSource, a element ObjectDataSource wywołuje metodę `DeleteProduct` klasy `ProductsOptimisticConcurrencyBLL`, przekazując wartości pierwotne.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-362">Upon clicking Delete, the page posts back, the GridView invokes the ObjectDataSource's `Delete()` method, and the ObjectDataSource calls down into the `ProductsOptimisticConcurrencyBLL` class's `DeleteProduct` method, passing along the original values.</span></span> <span data-ttu-id="8ea9a-363">Oryginalna wartość `ProductName` dla drugiego wystąpienia przeglądarki to "Chai herbata", która nie jest zgodna z bieżącą wartością `ProductName` w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-363">The original `ProductName` value for the second browser instance is "Chai Tea", which doesn't match up with the current `ProductName` value in the database.</span></span> <span data-ttu-id="8ea9a-364">W związku z tym instrukcja `DELETE` wystawiona dla bazy danych wpływa na zero wierszy, ponieważ w bazie danych nie ma rekordu, który spełnia klauzulę `WHERE`.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-364">Therefore the `DELETE` statement issued to the database affects zero rows since there's no record in the database that the `WHERE` clause satisfies.</span></span> <span data-ttu-id="8ea9a-365">Metoda `DeleteProduct` zwraca `false`, a dane elementu ObjectDataSource są ponownie powiązane z elementem GridView.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-365">The `DeleteProduct` method returns `false` and the ObjectDataSource's data is rebound to the GridView.</span></span>

<span data-ttu-id="8ea9a-366">Z punktu widzenia użytkownika końcowego klikanie przycisku Usuń dla Chai Tea w drugim oknie przeglądarki spowodowało, że ekran jest odtwarzany, a po odwrocie produkt nadal znajduje się na liście "Chai" (Nazwa produktu została zmieniona przez pierwszą przeglądarkę wystąpienie).</span><span class="sxs-lookup"><span data-stu-id="8ea9a-366">From the end user's perspective, clicking on the Delete button for Chai Tea in the second browser window caused the screen to flash and, upon coming back, the product is still there, although now it's listed as "Chai" (the product name change made by the first browser instance).</span></span> <span data-ttu-id="8ea9a-367">Jeśli użytkownik kliknie przycisk Usuń ponownie, usuwanie zakończy się pomyślnie, ponieważ oryginalna wartość `ProductName` GridView ("Chai") będzie teraz zgodna z wartością w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-367">If the user clicks the Delete button again, the Delete will succeed, as the GridView's original `ProductName` value ("Chai") now matches up with the value in the database.</span></span>

<span data-ttu-id="8ea9a-368">W obu tych przypadkach środowisko użytkownika jest daleko od idealnego.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-368">In both of these cases, the user experience is far from ideal.</span></span> <span data-ttu-id="8ea9a-369">Nie chcemy, aby podczas korzystania ze wzorca aktualizacji wsadowych nittył szczegóły dotyczące wyjątku `DBConcurrencyException`-Gritty.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-369">We clearly don't want to show the user the nitty-gritty details of the `DBConcurrencyException` exception when using the batch update pattern.</span></span> <span data-ttu-id="8ea9a-370">Zachowanie podczas korzystania ze wzorca DB Direct jest nieco mylące, ponieważ polecenie nie powiodło się, ale nie było dokładne wskazanie dlaczego.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-370">And the behavior when using the DB direct pattern is somewhat confusing as the users command failed, but there was no precise indication of why.</span></span>

<span data-ttu-id="8ea9a-371">Aby rozwiązać te dwa problemy, można utworzyć kontrolki sieci Web etykieta na stronie, która zawiera wyjaśnienie przyczyny niepowodzenia aktualizacji lub usunięcia.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-371">To remedy these two issues, we can create Label Web controls on the page that provide an explanation to why an update or delete failed.</span></span> <span data-ttu-id="8ea9a-372">W przypadku wzorca aktualizacji wsadowych można określić, czy `DBConcurrencyException` wystąpił wyjątek w obsłudze zdarzeń na poziomie po stronie GridView, wyświetlając etykietę ostrzegawczą w razie potrzeby.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-372">For the batch update pattern, we can determine whether or not a `DBConcurrencyException` exception occurred in the GridView's post-level event handler, displaying the warning label as needed.</span></span> <span data-ttu-id="8ea9a-373">W przypadku metody DB Direct możemy przeanalizować wartość zwracaną metody LOGIKI biznesowej (która jest `true`, jeśli wpłynęło to na jeden wiersz, `false` w przeciwnym razie) i wyświetlić komunikat informacyjny zgodnie z wymaganiami.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-373">For the DB direct method, we can examine the return value of the BLL method (which is `true` if one row was affected, `false` otherwise) and display an informational message as needed.</span></span>

## <a name="step-6-adding-informational-messages-and-displaying-them-in-the-face-of-a-concurrency-violation"></a><span data-ttu-id="8ea9a-374">Krok 6. Dodawanie komunikatów informacyjnych i wyświetlanie ich w celu naruszenia współbieżności</span><span class="sxs-lookup"><span data-stu-id="8ea9a-374">Step 6: Adding Informational Messages and Displaying Them in the Face of a Concurrency Violation</span></span>

<span data-ttu-id="8ea9a-375">W przypadku naruszenia współbieżności zachowanie jest zależne od tego, czy użyto aktualizacji wsadowej DAL czy wzorca usługi DB.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-375">When a concurrency violation occurs, the behavior exhibited depends on whether the DAL's batch update or DB direct pattern was used.</span></span> <span data-ttu-id="8ea9a-376">Nasz samouczek używa obu wzorców, z wzorcem aktualizacji wsadowej używanego do aktualizacji i wzorca bazy danych bezpośrednio używanego do usuwania.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-376">Our tutorial uses both patterns, with the batch update pattern being used for updating and the DB direct pattern used for deleting.</span></span> <span data-ttu-id="8ea9a-377">Aby rozpocząć, Dodajmy do naszej strony dwie kontrolki sieci Web z etykietami, które wyjaśniają, że wystąpiło naruszenie współbieżności podczas próby usunięcia lub aktualizacji danych.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-377">To get started, let's add two Label Web controls to our page that explain that a concurrency violation occurred when attempting to delete or update data.</span></span> <span data-ttu-id="8ea9a-378">Ustaw właściwości `Visible` i `EnableViewState` kontrolki etykieta na `false`; spowoduje to ukrycie ich na każdej stronie, z wyjątkiem tych, w których właściwości `Visible` są programowo ustawione na `true`.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-378">Set the Label control's `Visible` and `EnableViewState` properties to `false`; this will cause them to be hidden on each page visit except for those particular page visits where their `Visible` property is programmatically set to `true`.</span></span>

[!code-aspx[Main](implementing-optimistic-concurrency-cs/samples/sample12.aspx)]

<span data-ttu-id="8ea9a-379">Oprócz ustawiania właściwości `Visible`, `EnabledViewState`i `Text`, ustawiam również właściwość `CssClass` na `Warning`, która powoduje, że etykieta będzie wyświetlana w postaci długiej, czerwonej, kursywy, pogrubionej czcionki.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-379">In addition to setting their `Visible`, `EnabledViewState`, and `Text` properties, I've also set the `CssClass` property to `Warning`, which causes the Label's to be displayed in a large, red, italic, bold font.</span></span> <span data-ttu-id="8ea9a-380">Ta klasa `Warning` CSS została zdefiniowana i dodana do stylów. CSS z powrotem w temacie *badanie zdarzeń skojarzonych z wstawianiem, aktualizowaniem i usuwaniem* samouczka.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-380">This CSS `Warning` class was defined and added to Styles.css back in the *Examining the Events Associated with Inserting, Updating, and Deleting* tutorial.</span></span>

<span data-ttu-id="8ea9a-381">Po dodaniu tych etykiet projektant w programie Visual Studio powinien wyglądać podobnie do rysunku 18.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-381">After adding these Labels, the Designer in Visual Studio should look similar to Figure 18.</span></span>

<span data-ttu-id="8ea9a-382">[do strony dodano ![dwóch kontrolek etykiet](implementing-optimistic-concurrency-cs/_static/image51.png)](implementing-optimistic-concurrency-cs/_static/image50.png)</span><span class="sxs-lookup"><span data-stu-id="8ea9a-382">[![Two Label Controls Have Been Added to the Page](implementing-optimistic-concurrency-cs/_static/image51.png)](implementing-optimistic-concurrency-cs/_static/image50.png)</span></span>

<span data-ttu-id="8ea9a-383">**Ilustracja 18**. do strony dodano dwie kontrolki etykiet ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](implementing-optimistic-concurrency-cs/_static/image52.png))</span><span class="sxs-lookup"><span data-stu-id="8ea9a-383">**Figure 18**: Two Label Controls Have Been Added to the Page ([Click to view full-size image](implementing-optimistic-concurrency-cs/_static/image52.png))</span></span>

<span data-ttu-id="8ea9a-384">Przy użyciu tych kontrolek sieci Web etykieta na miejscu jesteśmy gotowi do sprawdzenia, jak ustalić, kiedy nastąpiło naruszenie współbieżności, w którym momencie można ustawić właściwość `Visible` odpowiedniej etykiety na `true`, wyświetlając komunikat informacyjny.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-384">With these Label Web controls in place, we're ready to examine how to determine when a concurrency violation has occurred, at which point the appropriate Label's `Visible` property can be set to `true`, displaying the informational message.</span></span>

## <a name="handling-concurrency-violations-when-updating"></a><span data-ttu-id="8ea9a-385">Obsługa naruszeń współbieżności podczas aktualizacji</span><span class="sxs-lookup"><span data-stu-id="8ea9a-385">Handling Concurrency Violations When Updating</span></span>

<span data-ttu-id="8ea9a-386">Najpierw przyjrzyjmy się obsłudze naruszeń współbieżności podczas korzystania ze wzorca aktualizacji wsadowych.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-386">Let's first look at how to handle concurrency violations when using the batch update pattern.</span></span> <span data-ttu-id="8ea9a-387">Ponieważ takie naruszenia wzorca aktualizacji wsadowych powodują zgłoszenie wyjątku `DBConcurrencyException`, musimy dodać kod do naszej strony ASP.NET, aby określić, czy `DBConcurrencyException` wystąpił wyjątek podczas procesu aktualizacji.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-387">Since such violations with the batch update pattern cause a `DBConcurrencyException` exception to be thrown, we need to add code to our ASP.NET page to determine whether a `DBConcurrencyException` exception occurred during the update process.</span></span> <span data-ttu-id="8ea9a-388">W takim przypadku powinien zostać wyświetlony komunikat informujący o tym, że zmiany nie zostały zapisane, ponieważ inny użytkownik zmodyfikował te same dane między rozpoczęciem edytowania rekordu a kliknięciem przycisku Aktualizuj.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-388">If so, we should display a message to the user explaining that their changes were not saved because another user had modified the same data between when they started editing the record and when they clicked the Update button.</span></span>

<span data-ttu-id="8ea9a-389">Zgodnie z opisem w samouczku *dotyczącym obsługi logiki biznesowej i dal na stronie ASP.NET* , takie wyjątki mogą być wykrywane i pomijane w procedurach obsługi zdarzeń na poziomie.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-389">As we saw in the *Handling BLL- and DAL-Level Exceptions in an ASP.NET Page* tutorial, such exceptions can be detected and suppressed in the data Web control's post-level event handlers.</span></span> <span data-ttu-id="8ea9a-390">W związku z tym musimy utworzyć procedurę obsługi zdarzeń dla zdarzenia `RowUpdated` GridView, które sprawdza, czy zgłoszono wyjątek `DBConcurrencyException`.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-390">Therefore, we need to create an event handler for the GridView's `RowUpdated` event that checks if a `DBConcurrencyException` exception has been thrown.</span></span> <span data-ttu-id="8ea9a-391">Ta procedura obsługi zdarzeń została przekazana odwołanie do dowolnego wyjątku, który został zgłoszony podczas procesu aktualizacji, jak pokazano w poniższym kodzie programu obsługi zdarzeń:</span><span class="sxs-lookup"><span data-stu-id="8ea9a-391">This event handler is passed a reference to any exception that was raised during the updating process, as shown in the event handler code below:</span></span>

[!code-csharp[Main](implementing-optimistic-concurrency-cs/samples/sample13.cs)]

<span data-ttu-id="8ea9a-392">W przypadku wyjątku `DBConcurrencyException` ten program obsługi zdarzeń wyświetla kontrolkę etykieta `UpdateConflictMessage` i wskazuje, że wyjątek został obsłużony.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-392">In the face of a `DBConcurrencyException` exception, this event handler displays the `UpdateConflictMessage` Label control and indicates that the exception has been handled.</span></span> <span data-ttu-id="8ea9a-393">Gdy ten kod jest używany, gdy nastąpi naruszenie współbieżności podczas aktualizowania rekordu, zmiany użytkownika są tracone, ponieważ w tym samym czasie nadpisały modyfikacje innego użytkownika.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-393">With this code in place, when a concurrency violation occurs when updating a record, the user's changes are lost, since they would have overwritten another user's modifications at the same time.</span></span> <span data-ttu-id="8ea9a-394">W szczególności widok GridView jest zwracany do stanu sprzed edycji i powiązany z bieżącymi danymi bazy danych.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-394">In particular, the GridView is returned to its pre-editing state and bound to the current database data.</span></span> <span data-ttu-id="8ea9a-395">Spowoduje to zaktualizowanie wiersza GridView przy użyciu zmian innych użytkowników, które wcześniej nie były widoczne.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-395">This will update the GridView row with the other user's changes, which were previously not visible.</span></span> <span data-ttu-id="8ea9a-396">Ponadto kontrolka etykieta `UpdateConflictMessage` będzie wyjaśnić użytkownikowi, co się stało.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-396">Additionally, the `UpdateConflictMessage` Label control will explain to the user what just happened.</span></span> <span data-ttu-id="8ea9a-397">Ta sekwencja zdarzeń została szczegółowo opisana na rysunku 19.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-397">This sequence of events is detailed in Figure 19.</span></span>

<span data-ttu-id="8ea9a-398">[![aktualizacje użytkownika s zostaną utracone w wyniku naruszenia współbieżności](implementing-optimistic-concurrency-cs/_static/image54.png)](implementing-optimistic-concurrency-cs/_static/image53.png)</span><span class="sxs-lookup"><span data-stu-id="8ea9a-398">[![A User s Updates are Lost in the Face of a Concurrency Violation](implementing-optimistic-concurrency-cs/_static/image54.png)](implementing-optimistic-concurrency-cs/_static/image53.png)</span></span>

<span data-ttu-id="8ea9a-399">**Ilustracja 19**. aktualizacje użytkowników są tracone w przypadku naruszenia współbieżności ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](implementing-optimistic-concurrency-cs/_static/image55.png))</span><span class="sxs-lookup"><span data-stu-id="8ea9a-399">**Figure 19**: A User s Updates are Lost in the Face of a Concurrency Violation ([Click to view full-size image](implementing-optimistic-concurrency-cs/_static/image55.png))</span></span>

> [!NOTE]
> <span data-ttu-id="8ea9a-400">Alternatywnie, zamiast zwracać widok GridView do stanu sprzed edycji, można opuścić widok GridView w stanie edycji, ustawiając właściwość `KeepInEditMode` zadanego obiektu `GridViewUpdatedEventArgs`d na wartość true.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-400">Alternatively, rather than returning the GridView to the pre-editing state, we could leave the GridView in its editing state by setting the `KeepInEditMode` property of the passed-in `GridViewUpdatedEventArgs` object to true.</span></span> <span data-ttu-id="8ea9a-401">W przypadku podjęcia tego podejścia należy jednak upewnić się, że te dane są ponownie powiązane z tym GridView (przez wywołanie metody `DataBind()`), tak aby wartości innych użytkowników zostały załadowane do interfejsu edycji.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-401">If you take this approach, however, be certain to rebind the data to the GridView (by invoking its `DataBind()` method) so that the other user's values are loaded into the editing interface.</span></span> <span data-ttu-id="8ea9a-402">Kod dostępny do pobrania w tym samouczku zawiera te dwa wiersze kodu w programie obsługi zdarzeń `RowUpdated`. po prostu usuń znaczniki komentarza z tych wierszy kodu, aby zachować GridView w trybie edycji po naruszeniu współbieżności.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-402">The code available for download with this tutorial has these two lines of code in the `RowUpdated` event handler commented out; simply uncomment these lines of code to have the GridView remain in edit mode after a concurrency violation.</span></span>

## <a name="responding-to-concurrency-violations-when-deleting"></a><span data-ttu-id="8ea9a-403">Reagowanie na naruszenia współbieżności podczas usuwania</span><span class="sxs-lookup"><span data-stu-id="8ea9a-403">Responding to Concurrency Violations When Deleting</span></span>

<span data-ttu-id="8ea9a-404">W przypadku wzorca DB Direct nie ma żadnego wyjątku zgłoszonego w wyniku naruszenia współbieżności.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-404">With the DB direct pattern, there is no exception raised in the face of a concurrency violation.</span></span> <span data-ttu-id="8ea9a-405">Zamiast tego instrukcja Database po prostu nie wpływa na żadne rekordy, ponieważ klauzula WHERE nie jest zgodna z żadnym rekordem.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-405">Instead, the database statement simply affects no records, as the WHERE clause does not match with any record.</span></span> <span data-ttu-id="8ea9a-406">Wszystkie metody modyfikacji danych utworzone w LOGIKI biznesowej zostały zaprojektowane w taki sposób, że zwracają wartość logiczną wskazującą, czy mają one dokładnie jeden rekord.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-406">All of the data modification methods created in the BLL have been designed such that they return a Boolean value indicating whether or not they affected precisely one record.</span></span> <span data-ttu-id="8ea9a-407">W związku z tym, aby określić, czy nastąpiło naruszenie współbieżności podczas usuwania rekordu, można sprawdzić wartość zwracaną metody `DeleteProduct` LOGIKI biznesowej.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-407">Therefore, to determine if a concurrency violation occurred when deleting a record, we can examine the return value of the BLL's `DeleteProduct` method.</span></span>

<span data-ttu-id="8ea9a-408">Wartość zwracana dla metody LOGIKI biznesowej można sprawdzić w obsłudze zdarzeń na poziomie elementu ObjectDataSource za pomocą właściwości `ReturnValue` obiektu `ObjectDataSourceStatusEventArgs` przekazaną do procedury obsługi zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-408">The return value for a BLL method can be examined in the ObjectDataSource's post-level event handlers through the `ReturnValue` property of the `ObjectDataSourceStatusEventArgs` object passed into the event handler.</span></span> <span data-ttu-id="8ea9a-409">Ponieważ chcemy określić wartość zwracaną z metody `DeleteProduct`, musimy utworzyć procedurę obsługi zdarzeń dla zdarzenia `Deleted` elementu ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-409">Since we are interested in determining the return value from the `DeleteProduct` method, we need to create an event handler for the ObjectDataSource's `Deleted` event.</span></span> <span data-ttu-id="8ea9a-410">Właściwość `ReturnValue` jest typu `object` i może być `null`, jeśli wyjątek został zgłoszony i metoda została przerwana przed zwróceniem wartości.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-410">The `ReturnValue` property is of type `object` and can be `null` if an exception was raised and the method was interrupted before it could return a value.</span></span> <span data-ttu-id="8ea9a-411">W związku z tym należy najpierw upewnić się, że właściwość `ReturnValue` nie jest `null` i jest wartością logiczną.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-411">Therefore, we should first ensure that the `ReturnValue` property is not `null` and is a Boolean value.</span></span> <span data-ttu-id="8ea9a-412">Przy założeniu, że ta kontrola przebiega pomyślnie, zostanie wyświetlona `DeleteConflictMessage` kontrolka etykiety, jeśli `ReturnValue` jest `false`.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-412">Assuming this check passes, we show the `DeleteConflictMessage` Label control if the `ReturnValue` is `false`.</span></span> <span data-ttu-id="8ea9a-413">Można to osiągnąć przy użyciu następującego kodu:</span><span class="sxs-lookup"><span data-stu-id="8ea9a-413">This can be accomplished by using the following code:</span></span>

[!code-csharp[Main](implementing-optimistic-concurrency-cs/samples/sample14.cs)]

<span data-ttu-id="8ea9a-414">W przypadku naruszenia współbieżności żądanie usunięcia użytkownika zostało anulowane.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-414">In the face of a concurrency violation, the user's delete request is canceled.</span></span> <span data-ttu-id="8ea9a-415">Widok GridView zostanie odświeżony, pokazując zmiany, które wystąpiły w tym rekordzie między czasem załadowania strony przez użytkownika a kliknięciem przycisku Usuń.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-415">The GridView is refreshed, showing the changes that occurred for that record between the time the user loaded the page and when he clicked the Delete button.</span></span> <span data-ttu-id="8ea9a-416">W przypadku takiego naruszenia transpires wyświetlana jest etykieta `DeleteConflictMessage`, co wyjaśnia, co się stało (Zobacz Rysunek 20).</span><span class="sxs-lookup"><span data-stu-id="8ea9a-416">When such a violation transpires, the `DeleteConflictMessage` Label is shown, explaining what just happened (see Figure 20).</span></span>

<span data-ttu-id="8ea9a-417">[![Usuwanie użytkownika zostało anulowane w wyniku naruszenia współbieżności](implementing-optimistic-concurrency-cs/_static/image57.png)](implementing-optimistic-concurrency-cs/_static/image56.png)</span><span class="sxs-lookup"><span data-stu-id="8ea9a-417">[![A User s Delete is Canceled in the Face of a Concurrency Violation](implementing-optimistic-concurrency-cs/_static/image57.png)](implementing-optimistic-concurrency-cs/_static/image56.png)</span></span>

<span data-ttu-id="8ea9a-418">**Ilustracja 20**. usunięcie użytkownika s zostało anulowane w wyniku naruszenia współbieżności ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](implementing-optimistic-concurrency-cs/_static/image58.png))</span><span class="sxs-lookup"><span data-stu-id="8ea9a-418">**Figure 20**: A User s Delete is Canceled in the Face of a Concurrency Violation ([Click to view full-size image](implementing-optimistic-concurrency-cs/_static/image58.png))</span></span>

## <a name="summary"></a><span data-ttu-id="8ea9a-419">Podsumowanie</span><span class="sxs-lookup"><span data-stu-id="8ea9a-419">Summary</span></span>

<span data-ttu-id="8ea9a-420">Możliwości naruszeń współbieżności istnieją w każdej aplikacji, która pozwala wielu równoczesnym użytkownikom aktualizować lub usuwać dane.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-420">Opportunities for concurrency violations exist in every application that allows multiple, concurrent users to update or delete data.</span></span> <span data-ttu-id="8ea9a-421">Jeśli takie naruszenia nie są uwzględniane w przypadku, gdy dwaj użytkownicy jednocześnie zaktualizują te same dane, w ostatnim zapisie "WINS" zastąpią zmiany wprowadzone przez innych użytkowników.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-421">If such violations are not accounted for, when two users simultaneously update the same data whoever gets in the last write "wins," overwriting the other user's changes changes.</span></span> <span data-ttu-id="8ea9a-422">Deweloperzy mogą również zaimplementować optymistyczną lub pesymistyczną kontrolę współbieżności.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-422">Alternatively, developers can implement either optimistic or pessimistic concurrency control.</span></span> <span data-ttu-id="8ea9a-423">Optymistyczna kontrola współbieżności zakłada, że naruszenia współbieżności są rzadko i po prostu nie zezwala na polecenie Update lub DELETE, które mogłoby stanowić naruszenie współbieżności.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-423">Optimistic concurrency control assumes that concurrency violations are infrequent and simply disallows an update or delete command that would constitute a concurrency violation.</span></span> <span data-ttu-id="8ea9a-424">W ramach pesymistycznej kontroli współbieżności założono, że naruszenia współbieżności są częste i po prostu odrzucenie polecenia Update lub DELETE jednego użytkownika nie jest akceptowalne.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-424">Pessimistic concurrency control assumes that concurrency violations are frequent and simply rejecting one user's update or delete command is not acceptable.</span></span> <span data-ttu-id="8ea9a-425">Dzięki pesymistycznej kontroli współbieżności, aktualizacja rekordu wymaga blokowania, co uniemożliwia innym użytkownikom modyfikowanie lub usuwanie rekordu, gdy jest on zablokowany.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-425">With pessimistic concurrency control, updating a record involves locking it, thereby preventing any other users from modifying or deleting the record while it is locked.</span></span>

<span data-ttu-id="8ea9a-426">Typ zestaw danych w programie .NET zawiera funkcje umożliwiające obsługę optymistycznej kontroli współbieżności.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-426">The Typed DataSet in .NET provides functionality for supporting optimistic concurrency control.</span></span> <span data-ttu-id="8ea9a-427">W szczególności instrukcje `UPDATE` i `DELETE` wystawione dla bazy danych obejmują wszystkie kolumny tabeli, a tym samym zagwarantowanie, że aktualizacja lub usunięcie zostanie wykonane tylko wtedy, gdy bieżące dane rekordu są zgodne z oryginalnymi danymi, które użytkownik musiał podczas przeprowadzania aktualizacji lub usuwania.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-427">In particular, the `UPDATE` and `DELETE` statements issued to the database include all of the table's columns, thereby ensuring that the update or delete will only occur if the record's current data matches with the original data the user had when performing their update or delete.</span></span> <span data-ttu-id="8ea9a-428">Po skonfigurowaniu DAL do obsługi optymistycznej współbieżności należy zaktualizować metody LOGIKI biznesowej.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-428">Once the DAL has been configured to support optimistic concurrency, the BLL methods need to be updated.</span></span> <span data-ttu-id="8ea9a-429">Ponadto strona ASP.NET, która wywołuje do LOGIKI biznesowej, musi być skonfigurowana tak, aby element ObjectDataSource pobierał pierwotne wartości z jego formantu sieci Web danych i przekazuje je do LOGIKI biznesowej.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-429">Additionally, the ASP.NET page that calls down into the BLL must be configured such that the ObjectDataSource retrieves the original values from its data Web control and passes them down into the BLL.</span></span>

<span data-ttu-id="8ea9a-430">Jak zostało to opisane w tym samouczku, wdrożenie optymistycznej kontroli współbieżności w aplikacji sieci Web ASP.NET obejmuje aktualizację DAL i LOGIKI biznesowej oraz dodanie obsługi na stronie ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-430">As we saw in this tutorial, implementing optimistic concurrency control in an ASP.NET web application involves updating the DAL and BLL and adding support in the ASP.NET page.</span></span> <span data-ttu-id="8ea9a-431">Bez względu na to, czy ta dodana praca jest poinwestowanym czasem i nakładem pracy, zależy od aplikacji.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-431">Whether or not this added work is a wise investment of your time and effort depends on your application.</span></span> <span data-ttu-id="8ea9a-432">Jeśli użytkownik nie ma często równoczesnych aktualizacji danych lub dane, które są aktualizowane, różnią się od siebie nawzajem, kontrola współbieżności nie jest problemem z kluczem.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-432">If you infrequently have concurrent users updating data, or the data they are updating is different from one another, then concurrency control is not a key issue.</span></span> <span data-ttu-id="8ea9a-433">Jeśli jednak planujesz pracę wielu użytkowników w Twojej lokacji z tymi samymi danymi, kontrola współbieżności może pomóc zapobiec aktualizacji lub usunięciu z przypadkowego przez jednego użytkownika.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-433">If, however, you routinely have multiple users on your site working with the same data, concurrency control can help prevent one user's updates or deletes from unwittingly overwriting another's.</span></span>

<span data-ttu-id="8ea9a-434">Szczęśliwe programowanie!</span><span class="sxs-lookup"><span data-stu-id="8ea9a-434">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="8ea9a-435">Informacje o autorze</span><span class="sxs-lookup"><span data-stu-id="8ea9a-435">About the Author</span></span>

<span data-ttu-id="8ea9a-436">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor siedmiu grup ASP/ASP. NET Books i założyciel of [4GuysFromRolla.com](http://www.4guysfromrolla.com), pracował z technologiami sieci Web firmy Microsoft od czasu 1998.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-436">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="8ea9a-437">Scott działa jako niezależny konsultant, trainer i składnik zapisywania.</span><span class="sxs-lookup"><span data-stu-id="8ea9a-437">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="8ea9a-438">Jego Najnowsza książka to [*Sams ASP.NET 2,0 w ciągu 24 godzin*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="8ea9a-438">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="8ea9a-439">Można go osiągnąć w [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="8ea9a-439">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="8ea9a-440">lub za pośrednictwem swojego blogu, który można znaleźć w [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="8ea9a-440">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="8ea9a-441">[Poprzednie](customizing-the-data-modification-interface-cs.md)
> [dalej](adding-client-side-confirmation-when-deleting-cs.md)</span><span class="sxs-lookup"><span data-stu-id="8ea9a-441">[Previous](customizing-the-data-modification-interface-cs.md)
[Next](adding-client-side-confirmation-when-deleting-cs.md)</span></span>
