---
uid: web-forms/overview/data-access/working-with-binary-files/including-a-file-upload-option-when-adding-a-new-record-cs
title: W tym pliku przekazywania opcji podczas dodawania nowego rekordu (C#) | Dokumentacja firmy Microsoft
author: rick-anderson
description: W tym samouczku pokazano, jak utworzyć interfejs sieci Web, który umożliwia użytkownikowi wprowadzanie tekstu danych i przekaż pliki binarne. Aby zilustrować t dostępne opcje...
ms.author: riande
ms.date: 03/27/2007
ms.assetid: 362ade25-3965-4fb2-88d2-835c4786244f
msc.legacyurl: /web-forms/overview/data-access/working-with-binary-files/including-a-file-upload-option-when-adding-a-new-record-cs
msc.type: authoredcontent
ms.openlocfilehash: 9ec09bfcadaa56401a08a389028766ee04f1daad
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 04/09/2019
ms.locfileid: "59379885"
---
# <a name="including-a-file-upload-option-when-adding-a-new-record-c"></a><span data-ttu-id="6d9f2-104">Dołączanie opcji przekazywania pliku podczas dodawania nowego rekordu (C#)</span><span class="sxs-lookup"><span data-stu-id="6d9f2-104">Including a File Upload Option When Adding a New Record (C#)</span></span>

<span data-ttu-id="6d9f2-105">przez [Bento Scott](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="6d9f2-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="6d9f2-106">[Pobierz przykładową aplikację](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_56_CS.exe) lub [Pobierz plik PDF](including-a-file-upload-option-when-adding-a-new-record-cs/_static/datatutorial56cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="6d9f2-106">[Download Sample App](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_56_CS.exe) or [Download PDF](including-a-file-upload-option-when-adding-a-new-record-cs/_static/datatutorial56cs1.pdf)</span></span>

> <span data-ttu-id="6d9f2-107">W tym samouczku pokazano, jak utworzyć interfejs sieci Web, który umożliwia użytkownikowi wprowadzanie tekstu danych i przekaż pliki binarne.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-107">This tutorial shows how to create a Web interface that allows the user to both enter text data and upload binary files.</span></span> <span data-ttu-id="6d9f2-108">Aby zilustrować dostępne opcje aby przechowywać dane binarne, jeden plik zostanie zapisany w bazie danych, podczas gdy druga jest przechowywany w systemie plików.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-108">To illustrate the options available to store binary data, one file will be saved in the database while the other is stored in the file system.</span></span>


## <a name="introduction"></a><span data-ttu-id="6d9f2-109">Wprowadzenie</span><span class="sxs-lookup"><span data-stu-id="6d9f2-109">Introduction</span></span>

<span data-ttu-id="6d9f2-110">W poprzednich samouczkach dwóch rozważyliśmy technik do przechowywania danych binarnych, który jest skojarzony z modelem danych aplikacji s, przyjrzano się jak formant FileUpload służy do wysyłania plików z klienta do serwera sieci web i poznaliśmy sposób przedstawiania tych danych binarnych w danych W Kontrolka EB.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-110">In the previous two tutorials we explored techniques for storing binary data that is associated with the application s data model, looked at how to use the FileUpload control to send files from the client to the web server, and saw how to present this binary data in a data Web control.</span></span> <span data-ttu-id="6d9f2-111">Firma Microsoft ve jeszcze, aby porozmawiać na temat sposobu kojarzenia przekazane dane z modelu danych, mimo że.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-111">We ve yet to talk about how to associate uploaded data with the data model, though.</span></span>

<span data-ttu-id="6d9f2-112">W tym samouczku utworzymy strony sieci web, aby dodać nową kategorię.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-112">In this tutorial we will create a web page to add a new category.</span></span> <span data-ttu-id="6d9f2-113">Oprócz pól tekstowych dla kategorii s nazwę i opis ta strona muszą zawierać dwóch kontrolek FileUpload dla nowego obrazu kategorii s i jeden dla broszurę.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-113">In addition to TextBoxes for the category s name and description, this page will need to include two FileUpload controls one for the new category s picture and one for the brochure.</span></span> <span data-ttu-id="6d9f2-114">Przekazany obraz będą przechowywane bezpośrednio w nowym rekordzie s `Picture` kolumny, natomiast broszurę zostanie zapisany w `~/Brochures` folderu ze ścieżką do pliku, który został zapisany w nowym rekordzie s `BrochurePath` kolumny.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-114">The uploaded picture will be stored directly in the new record s `Picture` column, whereas the brochure will be saved to the `~/Brochures` folder with the path to the file saved in the new record s `BrochurePath` column.</span></span>

<span data-ttu-id="6d9f2-115">Przed utworzeniem tej nowej strony sieci web, musimy zaktualizować architekturę.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-115">Before creating this new web page, we'll need to update the architecture.</span></span> <span data-ttu-id="6d9f2-116">`CategoriesTableAdapter` s główne zapytanie nie pobrać `Picture` kolumny.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-116">The `CategoriesTableAdapter` s main query does not retrieve the `Picture` column.</span></span> <span data-ttu-id="6d9f2-117">W związku z tym, wygenerowaną automatycznie `Insert` metoda zawiera tylko dane wejściowe dla `CategoryName`, `Description`, i `BrochurePath` pola.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-117">Consequently, the auto-generated `Insert` method only has inputs for the `CategoryName`, `Description`, and `BrochurePath` fields.</span></span> <span data-ttu-id="6d9f2-118">W związku z tym, należy utworzyć dodatkową metodę w TableAdapter, zawierająca monit o podanie wszystkie cztery `Categories` pola.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-118">Therefore, we need to create an additional method in the TableAdapter that prompts for all four `Categories` fields.</span></span> <span data-ttu-id="6d9f2-119">`CategoriesBLL` Klasy w warstwy logiki biznesowej będzie również trzeba być aktualizowane.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-119">The `CategoriesBLL` class in the Business Logic Layer will also need to be updated.</span></span>

## <a name="step-1-adding-aninsertwithpicturemethod-to-thecategoriestableadapter"></a><span data-ttu-id="6d9f2-120">Krok 1. Dodawanie`InsertWithPicture`metody`CategoriesTableAdapter`</span><span class="sxs-lookup"><span data-stu-id="6d9f2-120">Step 1: Adding an`InsertWithPicture`Method to the`CategoriesTableAdapter`</span></span>

<span data-ttu-id="6d9f2-121">Po utworzeniu `CategoriesTableAdapter` w [Tworzenie warstwy dostępu do danych](../introduction/creating-a-data-access-layer-cs.md) samouczka został skonfigurowany do automatycznego generowania `INSERT`, `UPDATE`, i `DELETE` instrukcji na podstawie głównego zapytania.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-121">When we created the `CategoriesTableAdapter` back in the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-cs.md) tutorial, we configured it to automatically generate `INSERT`, `UPDATE`, and `DELETE` statements based on the main query.</span></span> <span data-ttu-id="6d9f2-122">Ponadto firma Microsoft zgodnie z instrukcjami otrzymywanymi TableAdapter można wykorzystywać podejście bezpośredniego bazy danych, który metody `Insert`, `Update`, i `Delete`.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-122">Moreover, we instructed the TableAdapter to employ the DB Direct approach, which created the methods `Insert`, `Update`, and `Delete`.</span></span> <span data-ttu-id="6d9f2-123">Te metody wykonywania wygenerowany automatycznie `INSERT`, `UPDATE`, i `DELETE` instrukcji i w związku z tym, Zaakceptuj parametrów wejściowych, na podstawie kolumn zwrócony przez główne zapytanie.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-123">These methods execute the auto-generated `INSERT`, `UPDATE`, and `DELETE` statements and, consequently, accept input parameters based on the columns returned by the main query.</span></span> <span data-ttu-id="6d9f2-124">W [przesyłanie plików](uploading-files-cs.md) samouczka będziemy rozszerzone `CategoriesTableAdapter` s główne zapytanie do użycia `BrochurePath` kolumny.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-124">In the [Uploading Files](uploading-files-cs.md) tutorial we augmented the `CategoriesTableAdapter` s main query to use the `BrochurePath` column.</span></span>

<span data-ttu-id="6d9f2-125">Ponieważ `CategoriesTableAdapter` s główne zapytanie nie odwołuje się `Picture` kolumny, firma Microsoft nie można dodać nowy rekord ani zaktualizować istniejący rekord z wartością dla `Picture` kolumny.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-125">Since the `CategoriesTableAdapter` s main query does not reference the `Picture` column, we can neither add a new record nor update an existing record with a value for the `Picture` column.</span></span> <span data-ttu-id="6d9f2-126">Aby można było przechwytywać te informacje, możemy albo utworzyć nową metodę w TableAdapter, który jest używany do wstawienia rekordu z danymi binarnymi, lub można dostosować, wygenerowany automatycznie `INSERT` instrukcji.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-126">In order to capture this information, we can either create a new method in the TableAdapter that is used specifically to insert a record with binary data or we can customize the auto-generated `INSERT` statement.</span></span> <span data-ttu-id="6d9f2-127">Problem dotyczący Dostosowywanie generowanych automatycznie `INSERT` instrukcja jest firma Microsoft ryzyka o naszych dostosowania zastąpione przez kreatora.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-127">The problem with customizing the auto-generated `INSERT` statement is that we risk having our customizations overwritten by the wizard.</span></span> <span data-ttu-id="6d9f2-128">Załóżmy, że możemy dostosować `INSERT` instrukcję, aby uwzględnić użycie `Picture` kolumny.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-128">For example, imagine that we customized the `INSERT` statement to include use of the `Picture` column.</span></span> <span data-ttu-id="6d9f2-129">Spowoduje to zaktualizowanie TableAdapter s `Insert` metodę, aby uwzględnić dodatkowy parametr wejściowy dla danych binarnych obraz s kategorii s.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-129">This would update the TableAdapter s `Insert` method to include an additional input parameter for the category s picture s binary data.</span></span> <span data-ttu-id="6d9f2-130">Następnie możemy utworzyć metodę w warstwy logiki biznesowej, ta metoda warstwy DAL do wywołania tej metody LOGIKI przez warstwę prezentacji i wszystko będzie działać bajeczną.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-130">We could then create a method in the Business Logic Layer to use this DAL method and invoke this BLL method through the Presentation Layer, and everything would work wonderfully.</span></span> <span data-ttu-id="6d9f2-131">Oznacza to aż do następnego skonfigurowaliśmy TableAdapter za pomocą Kreatora konfiguracji TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-131">That is, until the next time we configured the TableAdapter through the TableAdapter Configuration wizard.</span></span> <span data-ttu-id="6d9f2-132">Tak szybko, jak ukończono działanie kreatora, nasze dostosowania `INSERT` instrukcji zostaną zastąpione, `Insert` metoda będzie powracać do jego starego formularza i naszego kodu będzie już kompilacji!</span><span class="sxs-lookup"><span data-stu-id="6d9f2-132">As soon as the wizard completed, our customizations to the `INSERT` statement would be overwritten, the `Insert` method would revert to its old form, and our code would no longer compile!</span></span>

> [!NOTE]
> <span data-ttu-id="6d9f2-133">Określenia tego dokuczliwości jest bez problemu, korzystając z procedur składowanych zamiast instrukcji SQL zapytań ad-hoc.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-133">This annoyance is a non-issue when using stored procedures instead of ad-hoc SQL statements.</span></span> <span data-ttu-id="6d9f2-134">Samouczek przyszłych przedstawimy korzystanie z procedur składowanych, zamiast instrukcji SQL zapytań ad-hoc w warstwie dostępu do danych.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-134">A future tutorial will explore using stored procedures in lieu of ad-hoc SQL statements in the Data Access Layer.</span></span>


<span data-ttu-id="6d9f2-135">Aby uniknąć tego potencjalnych kłopotliwe, zamiast Dostosowywanie instrukcji SQL generowanych automatycznie umożliwiają s zamiast utworzenie nowej metody TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-135">To avoid this potential headache, rather than customizing the auto-generated SQL statements let s instead create a new method for the TableAdapter.</span></span> <span data-ttu-id="6d9f2-136">Ta metoda o nazwie `InsertWithPicture`, będzie akceptować wartości `CategoryName`, `Description`, `BrochurePath`, i `Picture` kolumny, a następnie wykonaj `INSERT` instrukcji, która przechowuje wszystkie cztery wartości w nowym rekordzie.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-136">This method, named `InsertWithPicture`, will accept values for the `CategoryName`, `Description`, `BrochurePath`, and `Picture` columns and execute an `INSERT` statement that stores all four values in a new record.</span></span>

<span data-ttu-id="6d9f2-137">Otwórz zestaw danych wpisane, a przy użyciu projektanta, kliknij prawym przyciskiem myszy `CategoriesTableAdapter` nagłówka s i z menu kontekstowego wybierz polecenie Dodaj zapytanie.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-137">Open the Typed DataSet and, from the Designer, right-click on the `CategoriesTableAdapter` s header and choose Add Query from the context menu.</span></span> <span data-ttu-id="6d9f2-138">Spowoduje to uruchomienie Kreatora konfiguracji zapytania TableAdapter, który rozpoczyna się od pytaniem jak zapytania TableAdapter powinien uzyskiwać dostęp do bazy danych.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-138">This launches the TableAdapter Query Configuration Wizard, which begins by asking us how the TableAdapter query should access the database.</span></span> <span data-ttu-id="6d9f2-139">Wybierz opcję Użyj instrukcji SQL, a następnie kliknij przycisk Dalej.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-139">Choose Use SQL statements and click Next.</span></span> <span data-ttu-id="6d9f2-140">Następnym krokiem monituje o podanie typu zapytania do wygenerowania.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-140">The next step prompts for the type of query to be generated.</span></span> <span data-ttu-id="6d9f2-141">Ponieważ firma Microsoft, ponownie tworząc zapytanie, aby dodać nowy rekord do `Categories` tabeli, wybierz opcję Wstaw i kliknij przycisk Dalej.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-141">Since we re creating a query to add a new record to the `Categories` table, choose INSERT and click Next.</span></span>


[![S<span data-ttu-id="6d9f2-142">Wybiera opcję Wstaw]</span><span class="sxs-lookup"><span data-stu-id="6d9f2-142">elect the INSERT Option]</span></span>(including-a-file-upload-option-when-adding-a-new-record-cs/_static/image1.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image1.png)

<span data-ttu-id="6d9f2-143">**Rysunek 1**: Wybierz opcję Wstaw ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="6d9f2-143">**Figure 1**: Select the INSERT Option ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image2.png))</span></span>


<span data-ttu-id="6d9f2-144">Teraz musisz określić `INSERT` instrukcji SQL.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-144">We now need to specify the `INSERT` SQL statement.</span></span> <span data-ttu-id="6d9f2-145">Kreator automatycznie sugeruje `INSERT` instrukcji odpowiadający główne zapytanie TableAdapter s.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-145">The wizard automatically suggests an `INSERT` statement corresponding to the TableAdapter s main query.</span></span> <span data-ttu-id="6d9f2-146">W tym przypadku go s `INSERT` instrukcję, która wstawia `CategoryName`, `Description`, i `BrochurePath` wartości.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-146">In this case, it s an `INSERT` statement that inserts the `CategoryName`, `Description`, and `BrochurePath` values.</span></span> <span data-ttu-id="6d9f2-147">Aktualizacja instrukcji, aby `Picture` kolumny jest dołączany wraz `@Picture` parametru, w następujący sposób:</span><span class="sxs-lookup"><span data-stu-id="6d9f2-147">Update the statement so that the `Picture` column is included along with a `@Picture` parameter, like so:</span></span>


[!code-sql[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample1.sql)]

<span data-ttu-id="6d9f2-148">Na ostatnim ekranie kreatora pyta, czy nam nadaj nazwę nowej metody TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-148">The final screen of the wizard asks us to name the new TableAdapter method.</span></span> <span data-ttu-id="6d9f2-149">Wprowadź `InsertWithPicture` i kliknij przycisk Zakończ.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-149">Enter `InsertWithPicture` and click Finish.</span></span>


[![N<span data-ttu-id="6d9f2-150">Nazwa nowego InsertWithPicture metody TableAdapter]</span><span class="sxs-lookup"><span data-stu-id="6d9f2-150">ame the New TableAdapter Method InsertWithPicture]</span></span>(including-a-file-upload-option-when-adding-a-new-record-cs/_static/image2.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image3.png)

<span data-ttu-id="6d9f2-151">**Rysunek 2**: Nadaj nazwę nowej metody TableAdapter `InsertWithPicture` ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="6d9f2-151">**Figure 2**: Name the New TableAdapter Method `InsertWithPicture` ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image4.png))</span></span>


## <a name="step-2-updating-the-business-logic-layer"></a><span data-ttu-id="6d9f2-152">Krok 2. Aktualizowanie warstwy logiki biznesowej</span><span class="sxs-lookup"><span data-stu-id="6d9f2-152">Step 2: Updating the Business Logic Layer</span></span>

<span data-ttu-id="6d9f2-153">Ponieważ warstwa prezentacji tylko powinny współpracować z warstwy logiki biznesowej, a nie z pominięciem jej spowoduje przejście bezpośrednio do warstwy dostępu do danych, należy utworzyć metodę LOGIKI, która wywołuje metodę DAL, którą właśnie utworzyliśmy (`InsertWithPicture`).</span><span class="sxs-lookup"><span data-stu-id="6d9f2-153">Since the Presentation Layer should only interface with the Business Logic Layer rather than bypassing it to go directly to the Data Access Layer, we need to create a BLL method that invokes the DAL method we just created (`InsertWithPicture`).</span></span> <span data-ttu-id="6d9f2-154">W tym samouczku należy utworzyć metodę w `CategoriesBLL` klasę o nazwie `InsertWithPicture` akceptujący jako danych wejściowych trzech `string` s i `byte` tablicy.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-154">For this tutorial, create a method in the `CategoriesBLL` class named `InsertWithPicture` that accepts as input three `string` s and a `byte` array.</span></span> <span data-ttu-id="6d9f2-155">`string` Parametry wejściowe są nazwa kategorii s, opis i ścieżkę pliku broszura, podczas gdy `byte` tablica jest binarny zawartości obrazu kategorii s.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-155">The `string` input parameters are for the category s name, description, and brochure file path, while the `byte` array is for the binary contents of the category s picture.</span></span> <span data-ttu-id="6d9f2-156">Jak pokazano na poniższym kodem, ta metoda LOGIKI wywołuje odpowiednia metoda DAL:</span><span class="sxs-lookup"><span data-stu-id="6d9f2-156">As the following code shows, this BLL method invokes the corresponding DAL method:</span></span>


[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample2.cs)]

> [!NOTE]
> <span data-ttu-id="6d9f2-157">Upewnij się, został zapisany wpisany zestaw danych przed dodaniem `InsertWithPicture` metody LOGIKI.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-157">Make sure that you have saved the Typed DataSet before adding the `InsertWithPicture` method to the BLL.</span></span> <span data-ttu-id="6d9f2-158">Ponieważ `CategoriesTableAdapter` kod klasy został wygenerowany automatycznie na podstawie wpisana zestawu danych, jeśli don t najpierw zapisać zmiany do zestawu danych wpisane `Adapter` właściwość nie będzie wiedzieć o `InsertWithPicture` metody.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-158">Since the `CategoriesTableAdapter` class code is auto-generated based on the Typed DataSet, if you don t first save your changes to the Typed DataSet the `Adapter` property won't know about the `InsertWithPicture` method.</span></span>


## <a name="step-3-listing-the-existing-categories-and-their-binary-data"></a><span data-ttu-id="6d9f2-159">Krok 3. Wyświetlanie listy istniejących kategorii i ich dane binarne</span><span class="sxs-lookup"><span data-stu-id="6d9f2-159">Step 3: Listing the Existing Categories and their Binary Data</span></span>

<span data-ttu-id="6d9f2-160">W tym samouczku zostanie utworzona strona, która pozwala użytkownikowi końcowemu dodać nową kategorię do systemu, podając obrazu i broszura nowej kategorii.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-160">In this tutorial we will create a page that allows an end user to add a new category to the system, providing a picture and brochure for the new category.</span></span> <span data-ttu-id="6d9f2-161">W [poprzedni Samouczek](displaying-binary-data-in-the-data-web-controls-cs.md) użyliśmy GridView TemplateField i ImageField, aby wyświetlić nazwę każdej kategorii s, opis, obraz i link umożliwiający pobranie jej broszura.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-161">In the [preceding tutorial](displaying-binary-data-in-the-data-web-controls-cs.md) we used a GridView with a TemplateField and ImageField to display each category s name, description, picture, and a link to download its brochure.</span></span> <span data-ttu-id="6d9f2-162">Pozwól s replikowanie tej funkcji na potrzeby tego samouczka tworzenia strona, która zawiera listę wszystkich istniejących kategorii i pozwala na nowe ma zostać utworzony.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-162">Let s replicate that functionality for this tutorial, creating a page that both lists all existing categories and allows for new ones to be created.</span></span>

<span data-ttu-id="6d9f2-163">Zacznij od otwarcia `DisplayOrDownload.aspx` strony `BinaryData` folderu.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-163">Start by opening the `DisplayOrDownload.aspx` page from the `BinaryData` folder.</span></span> <span data-ttu-id="6d9f2-164">Przejdź do widoku źródła i skopiuj kontrolkami GridView i kontrolki ObjectDataSource s składni deklaratywnej, wklejając je w ramach `<asp:Content>` element `UploadInDetailsView.aspx`.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-164">Go to the Source view and copy the GridView and ObjectDataSource s declarative syntax, pasting it within the `<asp:Content>` element in `UploadInDetailsView.aspx`.</span></span> <span data-ttu-id="6d9f2-165">Ponadto don t zapomnij Skopiuj `GenerateBrochureLink` metody z klasy CodeBehind `DisplayOrDownload.aspx` do `UploadInDetailsView.aspx`.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-165">Also, don t forget to copy over the `GenerateBrochureLink` method from the code-behind class of `DisplayOrDownload.aspx` to `UploadInDetailsView.aspx`.</span></span>


[![C<span data-ttu-id="6d9f2-166">Kopiuj i Wklej składni deklaratywnej z DisplayOrDownload.aspx do UploadInDetailsView.aspx]</span><span class="sxs-lookup"><span data-stu-id="6d9f2-166">opy and Paste the Declarative Syntax from DisplayOrDownload.aspx to UploadInDetailsView.aspx]</span></span>(including-a-file-upload-option-when-adding-a-new-record-cs/_static/image3.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image5.png)

<span data-ttu-id="6d9f2-167">**Rysunek 3**: Skopiuj i Wklej składni deklaratywnej z `DisplayOrDownload.aspx` do `UploadInDetailsView.aspx` ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="6d9f2-167">**Figure 3**: Copy and Paste the Declarative Syntax from `DisplayOrDownload.aspx` to `UploadInDetailsView.aspx` ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image6.png))</span></span>


<span data-ttu-id="6d9f2-168">Po skopiowaniu składni deklaratywnej i `GenerateBrochureLink` metodę za pośrednictwem `UploadInDetailsView.aspx` stron, wyświetlenia strony za pośrednictwem przeglądarki, aby upewnić się, że wszystko zostało skopiowano za pośrednictwem.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-168">After copying the declarative syntax and `GenerateBrochureLink` method over to the `UploadInDetailsView.aspx` page, view the page through a browser to ensure that everything was copied over correctly.</span></span> <span data-ttu-id="6d9f2-169">Powinien zostać wyświetlony GridView listę osiem kategorii zawiera link do pobierania broszurę oraz obraz kategorii s.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-169">You should see a GridView listing the eight categories that includes a link to download the brochure as well as the category s picture.</span></span>


[![Y<span data-ttu-id="6d9f2-170">jednostki organizacyjnej powinno być teraz wyświetlane w każdej kategorii, wraz z jego dane binarne]</span><span class="sxs-lookup"><span data-stu-id="6d9f2-170">ou Should Now See Each Category Along with Its Binary Data]</span></span>(including-a-file-upload-option-when-adding-a-new-record-cs/_static/image4.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image7.png)

<span data-ttu-id="6d9f2-171">**Rysunek 4**: Powinien zostać wyświetlony w każdej kategorii, wraz z jego danych binarnych ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="6d9f2-171">**Figure 4**: You Should Now See Each Category Along with Its Binary Data ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image8.png))</span></span>


## <a name="step-4-configuring-thecategoriesdatasourceto-support-inserting"></a><span data-ttu-id="6d9f2-172">Krok 4. Konfigurowanie`CategoriesDataSource`do wstawiania pomocy technicznej</span><span class="sxs-lookup"><span data-stu-id="6d9f2-172">Step 4: Configuring the`CategoriesDataSource`to Support Inserting</span></span>

<span data-ttu-id="6d9f2-173">`CategoriesDataSource` Posługują się ObjectDataSource `Categories` GridView aktualnie nie zapewniają możliwość wstawiania danych.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-173">The `CategoriesDataSource` ObjectDataSource used by the `Categories` GridView currently does not provide the ability to insert data.</span></span> <span data-ttu-id="6d9f2-174">Aby zapewnić obsługę wstawiania za pomocą tego formantu źródła danych, należy mapowanie jego `Insert` metody do metody w jego obiektu źródłowego `CategoriesBLL`.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-174">In order to support inserting through this data source control, we need to map its `Insert` method to a method in its underlying object, `CategoriesBLL`.</span></span> <span data-ttu-id="6d9f2-175">W szczególności, chcemy zamapować na `CategoriesBLL` metoda dodaliśmy w kroku 2 `InsertWithPicture`.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-175">In particular, we want to map it to the `CategoriesBLL` method we added back in Step 2, `InsertWithPicture`.</span></span>

<span data-ttu-id="6d9f2-176">Rozpocznij, klikając link Konfiguruj źródła danych za pomocą kontrolki ObjectDataSource tagu inteligentnego s.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-176">Start by clicking the Configure Data Source link from the ObjectDataSource s smart tag.</span></span> <span data-ttu-id="6d9f2-177">Pierwszy ekran przedstawia obiektu źródła danych jest skonfigurowane do pracy z `CategoriesBLL`.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-177">The first screen shows the object the data source is configured to work with, `CategoriesBLL`.</span></span> <span data-ttu-id="6d9f2-178">Pozostaw to ustawienie jako — jest i kliknij przycisk Dalej, przejdź do ekranu definiowanie metody dotyczące danych.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-178">Leave this setting as-is and click Next to advance to the Define Data Methods screen.</span></span> <span data-ttu-id="6d9f2-179">Przenieś na kartę Wstaw, a następnie wybierz `InsertWithPicture` metodę z listy rozwijanej.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-179">Move to the INSERT tab and pick the `InsertWithPicture` method from the drop-down list.</span></span> <span data-ttu-id="6d9f2-180">Kliknij przycisk Zakończ, aby zakończyć działanie kreatora.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-180">Click Finish to complete the wizard.</span></span>


[![C<span data-ttu-id="6d9f2-181">onfiguruj ObjectDataSource przy użyciu metody InsertWithPicture]</span><span class="sxs-lookup"><span data-stu-id="6d9f2-181">onfigure the ObjectDataSource to use the InsertWithPicture Method]</span></span>(including-a-file-upload-option-when-adding-a-new-record-cs/_static/image5.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image9.png)

<span data-ttu-id="6d9f2-182">**Rysunek 5**: Konfigurowanie kontrolki ObjectDataSource używać `InsertWithPicture` — metoda ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="6d9f2-182">**Figure 5**: Configure the ObjectDataSource to use the `InsertWithPicture` Method ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image10.png))</span></span>


> [!NOTE]
> <span data-ttu-id="6d9f2-183">Po ukończeniu kreatora, Visual Studio może wystąpić, jeśli chcesz odświeżyć pola i klucze, który spowoduje to ponowne wygenerowanie danych sieci Web kontroluje pola.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-183">Upon completing the wizard, Visual Studio may ask if you want to Refresh Fields and Keys, which will regenerate the data Web controls fields.</span></span> <span data-ttu-id="6d9f2-184">Wybierz opcję nie, ponieważ wybranie opcji Tak spowoduje zastąpienie wszelkich dostosowań pola, które mogły zostać wprowadzone.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-184">Choose No, because choosing Yes will overwrite any field customizations you may have made.</span></span>


<span data-ttu-id="6d9f2-185">Po ukończeniu kreatora, kontrolki ObjectDataSource będzie teraz obejmować wartości jego `InsertMethod` właściwość także `InsertParameters` do kategorii czterech kolumn, jako następujących oznaczeniu deklaracyjnym przedstawia:</span><span class="sxs-lookup"><span data-stu-id="6d9f2-185">After completing the wizard, the ObjectDataSource will now include a value for its `InsertMethod` property as well as `InsertParameters` for the four category columns, as the following declarative markup illustrates:</span></span>


[!code-aspx[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample3.aspx)]

## <a name="step-5-creating-the-inserting-interface"></a><span data-ttu-id="6d9f2-186">Krok 5. Tworzenie interfejsu Wstawianie</span><span class="sxs-lookup"><span data-stu-id="6d9f2-186">Step 5: Creating the Inserting Interface</span></span>

<span data-ttu-id="6d9f2-187">Jako pierwsze objęte [Przegląd Wstawianie, aktualizowanie i usuwanie danych](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md), kontrolce DetailsView udostępnia wbudowane, wstawianie interfejs, który może być wykorzystywany podczas pracy z kontrolą źródła danych, który obsługuje wstawiania.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-187">As first covered in the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md), the DetailsView control provides a built-in inserting interface that can be utilized when working with a data source control that supports inserting.</span></span> <span data-ttu-id="6d9f2-188">Pozwól s dodać kontrolki widoku szczegółów do tej strony powyżej GridView zostanie trwale renderowanie jego Wstawianie interfejs użytkownika szybko dodać nową kategorię.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-188">Let s add a DetailsView control to this page above the GridView that will permanently render its inserting interface, allowing a user to quickly add a new category.</span></span> <span data-ttu-id="6d9f2-189">Po dodaniu nowej kategorii w DetailsView, GridView znajdujące się poniżej zostanie automatycznie odświeżania i wyświetlać nową kategorię.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-189">Upon adding a new category in the DetailsView, the GridView beneath it will automatically refresh and display the new category.</span></span>

<span data-ttu-id="6d9f2-190">Start, przeciągając DetailsView z przybornika w Projektancie powyżej GridView, ustawiając jego `ID` właściwości `NewCategory` i wyczyszczenie `Height` i `Width` wartości właściwości.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-190">Start by dragging a DetailsView from the Toolbox onto the Designer above the GridView, setting its `ID` property to `NewCategory` and clearing out the `Height` and `Width` property values.</span></span> <span data-ttu-id="6d9f2-191">Za pomocą tagu inteligentnego s DetailsView powiązać go do istniejących `CategoriesDataSource` , a następnie zaznacz pole wyboru Włącz wstawianie.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-191">From the DetailsView s smart tag, bind it to the existing `CategoriesDataSource` and then check the Enable Inserting checkbox.</span></span>


[![B<span data-ttu-id="6d9f2-192">Znajdź DetailsView CategoriesDataSource i Włącz wstawianie]</span><span class="sxs-lookup"><span data-stu-id="6d9f2-192">ind the DetailsView to the CategoriesDataSource and Enable Inserting]</span></span>(including-a-file-upload-option-when-adding-a-new-record-cs/_static/image6.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image11.png)

<span data-ttu-id="6d9f2-193">**Rysunek 6**: Powiąż DetailsView do `CategoriesDataSource` i umożliwić wstawianie ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="6d9f2-193">**Figure 6**: Bind the DetailsView to the `CategoriesDataSource` and Enable Inserting ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image12.png))</span></span>


<span data-ttu-id="6d9f2-194">Aby renderować trwale DetailsView w jego interfejsie Wstawianie, ustaw jego `DefaultMode` właściwość `Insert`.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-194">To permanently render the DetailsView in its inserting interface, set its `DefaultMode` property to `Insert`.</span></span>

<span data-ttu-id="6d9f2-195">Należy zauważyć, że DetailsView ma pięć BoundFields `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, i `BrochurePath` mimo że `CategoryID` elementu BoundField nie jest wyświetlana w interfejsie Wstawianie, ponieważ jego `InsertVisible` Właściwość jest ustawiona na `false`.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-195">Note that the DetailsView has five BoundFields `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, and `BrochurePath` although the `CategoryID` BoundField is not rendered in the inserting interface because its `InsertVisible` property is set to `false`.</span></span> <span data-ttu-id="6d9f2-196">Te BoundFields istnieje, ponieważ są one kolumny zwracane przez `GetCategories()` metoda, która jest kontrolki ObjectDataSource wywołuje można pobrać danych.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-196">These BoundFields exists because they are the columns returned by the `GetCategories()` method, which is what the ObjectDataSource invokes to retrieve its data.</span></span> <span data-ttu-id="6d9f2-197">Do wstawiania, jednak firma Microsoft don t chcesz, aby umożliwić użytkownikowi określić wartość dla `NumberOfProducts`.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-197">For inserting, however, we don t want to let the user specify a value for `NumberOfProducts`.</span></span> <span data-ttu-id="6d9f2-198">Ponadto należy zezwolić im na przekazywanie obrazu dla nowej kategorii, a także przekazać plik PDF broszurę.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-198">Moreover, we need to allow them to upload a picture for the new category as well as upload a PDF for the brochure.</span></span>

<span data-ttu-id="6d9f2-199">Usuń `NumberOfProducts` elementu BoundField z całkowicie DetailsView, a następnie zaktualizuj `HeaderText` właściwości `CategoryName` i `BrochurePath` BoundFields do kategorii i Brochure, odpowiednio.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-199">Remove the `NumberOfProducts` BoundField from the DetailsView altogether and then update the `HeaderText` properties of the `CategoryName` and `BrochurePath` BoundFields to Category and Brochure, respectively.</span></span> <span data-ttu-id="6d9f2-200">Następnie przekonwertować `BrochurePath` elementu BoundField do TemplateField i dodać nowe TemplateField obrazu, dzięki czemu ten nowy TemplateField `HeaderText` wartość obrazu.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-200">Next, convert the `BrochurePath` BoundField into a TemplateField and add a new TemplateField for the picture, giving this new TemplateField a `HeaderText` value of Picture.</span></span> <span data-ttu-id="6d9f2-201">Przenieś `Picture` TemplateField, tak aby można ją między `BrochurePath` TemplateField i CommandField.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-201">Move the `Picture` TemplateField so that it is between the `BrochurePath` TemplateField and CommandField.</span></span>


![Powiązywanie DetailsView CategoriesDataSource i umożliwić wstawianie](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image7.gif)

<span data-ttu-id="6d9f2-203">**Rysunek 7**: Powiąż DetailsView do `CategoriesDataSource` i umożliwić wstawianie</span><span class="sxs-lookup"><span data-stu-id="6d9f2-203">**Figure 7**: Bind the DetailsView to the `CategoriesDataSource` and Enable Inserting</span></span>


<span data-ttu-id="6d9f2-204">Jeśli po konwersji `BrochurePath` obejmuje TemplateField elementu BoundField do TemplateField za pomocą okna dialogowego Edytowanie pól, `ItemTemplate`, `EditItemTemplate`, i `InsertItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-204">If you converted the `BrochurePath` BoundField into a TemplateField through the Edit Fields dialog box, the TemplateField includes an `ItemTemplate`, `EditItemTemplate`, and `InsertItemTemplate`.</span></span> <span data-ttu-id="6d9f2-205">Tylko `InsertItemTemplate` jest wymagane, jednak, więc możesz usunąć dwa szablony.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-205">Only the `InsertItemTemplate` is needed, however, so feel free to remove the other two templates.</span></span> <span data-ttu-id="6d9f2-206">W tym momencie DetailsView składni deklaratywnej s powinna wyglądać następująco:</span><span class="sxs-lookup"><span data-stu-id="6d9f2-206">At this point your DetailsView s declarative syntax should look like the following:</span></span>


[!code-aspx[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample4.aspx)]

## <a name="adding-fileupload-controls-for-the-brochure-and-picture-fields"></a><span data-ttu-id="6d9f2-207">Dodawanie formantów FileUpload broszura i pola obrazu</span><span class="sxs-lookup"><span data-stu-id="6d9f2-207">Adding FileUpload Controls for the Brochure and Picture Fields</span></span>

<span data-ttu-id="6d9f2-208">Obecnie `BrochurePath` TemplateField s `InsertItemTemplate` zawiera pole tekstowe, podczas gdy `Picture` TemplateField nie zawiera żadnych szablonów.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-208">Presently, the `BrochurePath` TemplateField s `InsertItemTemplate` contains a TextBox, while the `Picture` TemplateField does not contain any templates.</span></span> <span data-ttu-id="6d9f2-209">Należy zaktualizować te dwa s TemplateField `InsertItemTemplate` s, aby użyć kontrolek FileUpload.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-209">We need to update these two TemplateField s `InsertItemTemplate` s to use FileUpload controls.</span></span>

<span data-ttu-id="6d9f2-210">W tagu inteligentnego s DetailsView opcję Edytuj szablony, a następnie wybierz `BrochurePath` TemplateField s `InsertItemTemplate` z listy rozwijanej.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-210">From the DetailsView s smart tag, choose the Edit Templates option and then select the `BrochurePath` TemplateField s `InsertItemTemplate` from the drop-down list.</span></span> <span data-ttu-id="6d9f2-211">Usuń pole tekstowe, a następnie przeciągnij formant FileUpload z przybornika, do szablonu.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-211">Remove the TextBox and then drag a FileUpload control from the Toolbox into the template.</span></span> <span data-ttu-id="6d9f2-212">Ustawianie kontroli FileUpload s `ID` do `BrochureUpload`.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-212">Set the FileUpload control s `ID` to `BrochureUpload`.</span></span> <span data-ttu-id="6d9f2-213">Podobnie, Dodaj kontrolkę FileUpload do `Picture` TemplateField s `InsertItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-213">Similarly, add a FileUpload control to the `Picture` TemplateField s `InsertItemTemplate`.</span></span> <span data-ttu-id="6d9f2-214">Ustaw ten formant FileUpload s `ID` do `PictureUpload`.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-214">Set this FileUpload control s `ID` to `PictureUpload`.</span></span>


[![A<span data-ttu-id="6d9f2-215">dd formantu InsertItemTemplate z przekazywaniem plików]</span><span class="sxs-lookup"><span data-stu-id="6d9f2-215">dd a FileUpload Control to the InsertItemTemplate]</span></span>(including-a-file-upload-option-when-adding-a-new-record-cs/_static/image8.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image13.png)

<span data-ttu-id="6d9f2-216">**Rysunek 8**: Dodawanie do formantu FileUpload `InsertItemTemplate` ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="6d9f2-216">**Figure 8**: Add a FileUpload Control to the `InsertItemTemplate` ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image14.png))</span></span>


<span data-ttu-id="6d9f2-217">Po wprowadzeniu tych dodatków, będą dwa składni deklaratywnej s TemplateField:</span><span class="sxs-lookup"><span data-stu-id="6d9f2-217">After making these additions, the two TemplateField s declarative syntax will be:</span></span>


[!code-aspx[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample5.aspx)]

<span data-ttu-id="6d9f2-218">Gdy użytkownik doda nową kategorię, chcemy upewnić się, że broszura i obraz typu odpowiedniego pliku.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-218">When a user adds a new category, we want to ensure that the brochure and picture are of the correct file type.</span></span> <span data-ttu-id="6d9f2-219">Dla brochure że użytkownik musi podać plik PDF.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-219">For the brochure, the user must supply a PDF.</span></span> <span data-ttu-id="6d9f2-220">Obraz, firma Microsoft na potrzeby użytkownika można przekazać pliku obrazu, ale możemy zezwalają na *wszelkie* obrazu pliku lub tylko pliki obrazów określonego typu, na przykład plików GIF lub jpg?</span><span class="sxs-lookup"><span data-stu-id="6d9f2-220">For the picture, we need the user to upload an image file, but do we allow *any* image file or only image files of a particular type, such as GIFs or JPGs?</span></span> <span data-ttu-id="6d9f2-221">Aby umożliwić dla różnych typów plików, d należy rozszerzyć `Categories` schematu, aby zawierała kolumnę, która przechwytuje typ pliku, więc, że tego typu mogą być wysyłane do klienta za pośrednictwem `Response.ContentType` w `DisplayCategoryPicture.aspx`.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-221">In order to allow for different file types, we d need to extend the `Categories` schema to include a column that captures the file type so that this type can be sent to the client through `Response.ContentType` in `DisplayCategoryPicture.aspx`.</span></span> <span data-ttu-id="6d9f2-222">Ponieważ firma Microsoft don t kolumnie jest, byłoby rozsądne ograniczyć użytkowników do zapewniania tylko typu pliku określonego obrazu.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-222">Since we don t have such a column, it would be prudent to restrict users to only providing a specific image file type.</span></span> <span data-ttu-id="6d9f2-223">`Categories` Tabeli s istniejących obrazów są mapy bitowe, ale jpg są bardziej odpowiednie format pliku obrazy obsługiwane za pośrednictwem sieci web.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-223">The `Categories` table s existing images are bitmaps, but JPGs are a more appropriate file format for images served over the web.</span></span>

<span data-ttu-id="6d9f2-224">Jeśli użytkownik prześle niepoprawny typ pliku, należy anulować insert i wyświetlić komunikat informujący o problemie.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-224">If a user uploads an incorrect file type, we need to cancel the insert and display a message indicating the problem.</span></span> <span data-ttu-id="6d9f2-225">Dodaj kontrolkę etykieta w sieci Web pod DetailsView.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-225">Add a Label Web control beneath the DetailsView.</span></span> <span data-ttu-id="6d9f2-226">Ustaw jego `ID` właściwości `UploadWarning`, wyczyść się jego `Text` , właściwością `CssClass` właściwości na ostrzegawczy i `Visible` i `EnableViewState` właściwości w celu `false`.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-226">Set its `ID` property to `UploadWarning`, clear out its `Text` property, set the `CssClass` property to Warning, and the `Visible` and `EnableViewState` properties to `false`.</span></span> <span data-ttu-id="6d9f2-227">`Warning` CSS, klasa jest zdefiniowana w `Styles.css` i renderuje tekstu duże czerwony, kursywą, pogrubioną czcionką.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-227">The `Warning` CSS class is defined in `Styles.css` and renders the text in a large, red, italicized, bold font.</span></span>

> [!NOTE]
> <span data-ttu-id="6d9f2-228">W idealnym przypadku `CategoryName` i `Description` BoundFields zostanie przekonwertowana na kontrolek TemplateField i ich interfejsy Wstawianie dostosowane.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-228">Ideally, the `CategoryName` and `Description` BoundFields would be converted to TemplateFields and their inserting interfaces customized.</span></span> <span data-ttu-id="6d9f2-229">`Description` Wstawianie interfejsu, na przykład będzie prawdopodobnie jej lepszego dostosowania za pośrednictwem wielowierszowym polu tekstowym.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-229">The `Description` inserting interface, for example, would likely be better suited through a multi-line textbox.</span></span> <span data-ttu-id="6d9f2-230">A ponieważ `CategoryName` kolumny nie akceptuje `NULL` wartości RequiredFieldValidator powinny zostać dodane do zapewnienia użytkownika zawiera wartość dla nowej nazwy kategorii s.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-230">And since the `CategoryName` column does not accept `NULL` values, a RequiredFieldValidator should be added to ensure the user provides a value for the new category s name.</span></span> <span data-ttu-id="6d9f2-231">Te kroki są pozostawiane w charakterze ćwiczenia do czytnika.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-231">These steps are left as an exercise to the reader.</span></span> <span data-ttu-id="6d9f2-232">Odwołaj się do [Dostosowywanie interfejsu modyfikacji danych](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) dla przyjrzeć się przestarzałe interfejsy modyfikacji danych.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-232">Refer back to [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) for an in-depth look at augmenting the data modification interfaces.</span></span>


## <a name="step-6-saving-the-uploaded-brochure-to-the-web-server-s-file-system"></a><span data-ttu-id="6d9f2-233">Krok 6. Zapisywanie broszura przekazanego do systemu plików s serwera sieci Web</span><span class="sxs-lookup"><span data-stu-id="6d9f2-233">Step 6: Saving the Uploaded Brochure to the Web Server s File System</span></span>

<span data-ttu-id="6d9f2-234">Gdy użytkownik wprowadza wartości dla nowej kategorii i kliknie przycisk Wstaw, występuje odświeżenie strony i rozwoju Wstawianie przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-234">When the user enters the values for a new category and clicks the Insert button, a postback occurs and the inserting workflow unfolds.</span></span> <span data-ttu-id="6d9f2-235">Po pierwsze, DetailsView s [ `ItemInserting` zdarzeń](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.iteminserting.aspx) uruchamiany.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-235">First, the DetailsView s [`ItemInserting` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.iteminserting.aspx) fires.</span></span> <span data-ttu-id="6d9f2-236">Następnie, ObjectDataSource s `Insert()` metoda jest wywoływana, co powoduje, że w nowym rekordzie dodawane do `Categories` tabeli.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-236">Next, the ObjectDataSource s `Insert()` method is invoked, which results in a new record being added to the `Categories` table.</span></span> <span data-ttu-id="6d9f2-237">Po zakończeniu DetailsView s [ `ItemInserted` zdarzeń](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.iteminserted.aspx) uruchamiany.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-237">After that, the DetailsView s [`ItemInserted` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.iteminserted.aspx) fires.</span></span>

<span data-ttu-id="6d9f2-238">Przed ObjectDataSource s `Insert()` metoda jest wywoływana, firma Microsoft musi najpierw upewnij się, że typy odpowiedniego pliku zostały przekazane przez użytkownika, a następnie zapisz broszura PDF w systemie plików serwera s sieci web.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-238">Before the ObjectDataSource s `Insert()` method is invoked, we must first ensure that the appropriate file types were uploaded by the user and then save the brochure PDF to the web server s file system.</span></span> <span data-ttu-id="6d9f2-239">Utwórz procedurę obsługi zdarzeń dla DetailsView s `ItemInserting` zdarzeń i Dodaj następujący kod:</span><span class="sxs-lookup"><span data-stu-id="6d9f2-239">Create an event handler for the DetailsView s `ItemInserting` event and add the following code:</span></span>


[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample6.cs)]

<span data-ttu-id="6d9f2-240">Program obsługi zdarzeń, który rozpoczyna się przez utworzenie odwołań do `BrochureUpload` FileUpload sterowania za pomocą szablonów s DetailsView.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-240">The event handler starts by referencing the `BrochureUpload` FileUpload control from the DetailsView s templates.</span></span> <span data-ttu-id="6d9f2-241">Następnie jeśli został przekazany broszurę rozszerzenie s przekazany plik jest sprawdzany pod.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-241">Then, if a brochure has been uploaded, the uploaded file s extension is examined.</span></span> <span data-ttu-id="6d9f2-242">Jeśli rozszerzenie nie jest. Pliki PDF, następnie ostrzeżenie jest wyświetlane, Wstaw zostało anulowane i kończy wykonywanie programu obsługi zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-242">If the extension is not .PDF, then a warning is displayed, the insert is cancelled, and the execution of the event handler ends.</span></span>

> [!NOTE]
> <span data-ttu-id="6d9f2-243">Opierając się na rozszerzenie s przekazany plik nie jest to technika stosowane za zapewnienie, że przekazany plik jest dokument PDF.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-243">Relying on the uploaded file s extension is not a sure-fire technique for ensuring that the uploaded file is a PDF document.</span></span> <span data-ttu-id="6d9f2-244">Użytkownik może mieć prawidłowy dokument PDF z rozszerzeniem `.Brochure`, lub można podjąć dokument PDF nie i biorąc pod uwagę jej `.pdf` rozszerzenia.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-244">The user could have a valid PDF document with the extension `.Brochure`, or could have taken a non-PDF document and given it a `.pdf` extension.</span></span> <span data-ttu-id="6d9f2-245">Zawartość binarna s pliku należałoby programowo należy zbadać w celu bardziej ostatecznie Sprawdź typ pliku.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-245">The file s binary content would need to be programmatically examined in order to more conclusively verify the file type.</span></span> <span data-ttu-id="6d9f2-246">Takie dokładnego podejścia, chociaż często są obszerne; Sprawdzanie rozszerzenie jest wystarczające dla większości scenariuszy.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-246">Such thorough approaches, though, are often overkill; checking the extension is sufficient for most scenarios.</span></span>


<span data-ttu-id="6d9f2-247">Zgodnie z opisem w [przesyłanie plików](uploading-files-cs.md) samouczek, należy zachować ostrożność podczas zapisywania plików do systemu plików, więc przekazywania tego jednego użytkownika s nie zastąpi inną s.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-247">As discussed in the [Uploading Files](uploading-files-cs.md) tutorial, care must be taken when saving files to the file system so that one user s upload does not overwrite another s.</span></span> <span data-ttu-id="6d9f2-248">W tym samouczku firma Microsoft spróbuje użyć takiej samej nazwie jako przekazanego pliku.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-248">For this tutorial we will attempt to use the same name as the uploaded file.</span></span> <span data-ttu-id="6d9f2-249">Jeśli istnieje już plik w `~/Brochures` katalog o tej samej nazwie pliku, jednak firma Microsoft będzie dodają liczbę na końcu aż do znalezienia unikatową nazwę.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-249">If there already exists a file in the `~/Brochures` directory with that same file name, however, we'll append a number at the end until a unique name is found.</span></span> <span data-ttu-id="6d9f2-250">Na przykład, jeśli użytkownik prześle broszura plik o nazwie `Meats.pdf`, ale istnieje już plik o nazwie `Meats.pdf` w `~/Brochures` folderu, zmienimy nazwę zapisanego pliku do `Meats-1.pdf`.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-250">For example, if the user uploads a brochure file named `Meats.pdf`, but there is already a file named `Meats.pdf` in the `~/Brochures` folder, we'll change the saved file name to `Meats-1.pdf`.</span></span> <span data-ttu-id="6d9f2-251">Jeśli, istnieje, zostanie podjęta `Meats-2.pdf`i tak dalej, aż do znalezienia unikatową nazwę pliku.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-251">If that exists, we'll try `Meats-2.pdf`, and so on, until a unique file name is found.</span></span>

<span data-ttu-id="6d9f2-252">Poniższy kod używa [ `File.Exists(path)` metoda](https://msdn.microsoft.com/library/system.io.file.exists.aspx) do ustalenia, czy plik istnieje już przy użyciu określonej nazwy pliku.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-252">The following code uses the [`File.Exists(path)` method](https://msdn.microsoft.com/library/system.io.file.exists.aspx) to determine if a file already exists with the specified file name.</span></span> <span data-ttu-id="6d9f2-253">Jeśli tak, będzie kontynuowane do wypróbowania nowej nazwy plików dla broszurę, aż do znalezienia żadnych konfliktów.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-253">If so, it continues to try new file names for the brochure until no conflict is found.</span></span>


[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample7.cs)]

<span data-ttu-id="6d9f2-254">Po znalezieniu prawidłową nazwę pliku pliku musi można zapisać w systemie plików i ObjectDataSource s `brochurePath``InsertParameter` wartość musi zostać zaktualizowany, aby ta nazwa pliku jest zapisywany w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-254">Once a valid file name has been found, the file needs to be saved to the file system and the ObjectDataSource s `brochurePath``InsertParameter` value needs to be updated so that this file name is written to the database.</span></span> <span data-ttu-id="6d9f2-255">Jak widzieliśmy w *przesyłanie plików* samouczku plik można zapisać za pomocą formantu FileUpload s `SaveAs(path)` metody.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-255">As we saw back in the *Uploading Files* tutorial, the file can be saved using the FileUpload control s `SaveAs(path)` method.</span></span> <span data-ttu-id="6d9f2-256">Aby zaktualizować ObjectDataSource s `brochurePath` parametru, użyj `e.Values` kolekcji.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-256">To update the ObjectDataSource s `brochurePath` parameter, use the `e.Values` collection.</span></span>


[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample8.cs)]

## <a name="step-7-saving-the-uploaded-picture-to-the-database"></a><span data-ttu-id="6d9f2-257">Krok 7. Zapisywanie obrazów przekazanych do bazy danych</span><span class="sxs-lookup"><span data-stu-id="6d9f2-257">Step 7: Saving the Uploaded Picture to the Database</span></span>

<span data-ttu-id="6d9f2-258">Do przechowywania przekazanego obrazu w nowym `Categories` rekord, należy przypisać przekazanych zawartość binarną do ObjectDataSource s `picture` parametr DetailsView s `ItemInserting` zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-258">To store the uploaded picture in the new `Categories` record, we need to assign the uploaded binary content to the ObjectDataSource s `picture` parameter in the DetailsView s `ItemInserting` event.</span></span> <span data-ttu-id="6d9f2-259">Przed to przypisanie, jednak należy najpierw upewnić się, że przekazany obraz JPG i nie innego obraz typu.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-259">Before we make this assignment, however, we need to first make sure that the uploaded picture is a JPG and not some other image type.</span></span> <span data-ttu-id="6d9f2-260">Jak w poniższym kroku 6 umożliwiają s stwierdzenia, jego typ za pomocą rozszerzenia pliku s przekazanego obrazu.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-260">As in Step 6, let s use the uploaded picture s file extension to ascertain its type.</span></span>

<span data-ttu-id="6d9f2-261">Gdy `Categories` umożliwia tabeli `NULL` wartości `Picture` kolumna, wszystkie kategorie obecnie ma obrazu.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-261">While the `Categories` table allows `NULL` values for the `Picture` column, all categories currently have a picture.</span></span> <span data-ttu-id="6d9f2-262">Pozwól s zmusza użytkownika do obrazu podczas dodawania nowej kategorii za pośrednictwem tej strony.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-262">Let s force the user to provide a picture when adding a new category through this page.</span></span> <span data-ttu-id="6d9f2-263">Poniższy kod sprawdza, aby upewnić się, że obraz został przekazany i ma właściwe rozszerzenie.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-263">The following code checks to ensure that a picture has been uploaded and that it has an appropriate extension.</span></span>


[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample9.cs)]

<span data-ttu-id="6d9f2-264">Ten kod będzie umieszczona *przed* kod z kroku 6 tak, aby w przypadku problemu z przekazywaniem obrazu programu obsługi zdarzeń przestanie obowiązywać przed zapisaniem pliku broszura do systemu plików.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-264">This code should be placed *before* the code from Step 6 so that if there is a problem with the picture upload, the event handler will terminate before the brochure file is saved to the file system.</span></span>

<span data-ttu-id="6d9f2-265">Przy założeniu, że odpowiedni plik został przekazany, należy przypisać przekazanych zawartość binarna do wartości s parametru obraz przy użyciu następującego kodu:</span><span class="sxs-lookup"><span data-stu-id="6d9f2-265">Assuming that an appropriate file has been uploaded, assign the uploaded binary content to the picture parameter s value with the following line of code:</span></span>


[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample10.cs)]

## <a name="the-completeiteminsertingevent-handler"></a><span data-ttu-id="6d9f2-266">Pełne`ItemInserting`program obsługi zdarzeń</span><span class="sxs-lookup"><span data-stu-id="6d9f2-266">The Complete`ItemInserting`Event Handler</span></span>

<span data-ttu-id="6d9f2-267">Aby informacje były kompletne, Oto `ItemInserting` program obsługi zdarzeń w całości:</span><span class="sxs-lookup"><span data-stu-id="6d9f2-267">For completeness, here is the `ItemInserting` event handler in its entirety:</span></span>


[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample11.cs)]

## <a name="step-8-fixing-thedisplaycategorypictureaspxpage"></a><span data-ttu-id="6d9f2-268">Krok 8. Naprawianie`DisplayCategoryPicture.aspx`strony</span><span class="sxs-lookup"><span data-stu-id="6d9f2-268">Step 8: Fixing the`DisplayCategoryPicture.aspx`Page</span></span>

<span data-ttu-id="6d9f2-269">Umożliwiają s Poświęć chwilę, w celu przetestowania Wstawianie interfejsu i `ItemInserting` program obsługi zdarzeń, który został utworzony w ciągu ostatnich kilku kroków.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-269">Let s take a moment to test out the inserting interface and `ItemInserting` event handler that was created over the last few steps.</span></span> <span data-ttu-id="6d9f2-270">Odwiedź stronę `UploadInDetailsView.aspx` strony za pośrednictwem przeglądarki i podjęcie próby dodać kategorię, ale Pomiń obraz lub obrazu innego niż JPG lub broszura niż PDF.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-270">Visit the `UploadInDetailsView.aspx` page through a browser and attempt to add a category, but omit the picture, or specify a non-JPG picture or a non-PDF brochure.</span></span> <span data-ttu-id="6d9f2-271">W dowolnym z tych przypadków pojawi się komunikat o błędzie i anulowane insert przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-271">In any of these cases, an error message will be displayed and the insert workflow cancelled.</span></span>


[![A <span data-ttu-id="6d9f2-272">Ostrzeżenie jest wyświetlane, jeśli został przekazany nieprawidłowy typ pliku]</span><span class="sxs-lookup"><span data-stu-id="6d9f2-272">Warning Message is Displayed If an Invalid File Type is Uploaded]</span></span>(including-a-file-upload-option-when-adding-a-new-record-cs/_static/image9.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image15.png)

<span data-ttu-id="6d9f2-273">**Rysunek 9**: Ostrzeżenie jest wyświetlane, jeśli został przekazany nieprawidłowy typ pliku ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="6d9f2-273">**Figure 9**: A Warning Message is Displayed If an Invalid File Type is Uploaded ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image16.png))</span></span>


<span data-ttu-id="6d9f2-274">Po upewnieniu się, że strona wymaga obraz do przekazania i nie akceptuje plików innych niż PDF lub innych JPG, Dodaj nową kategorię prawidłowy obraz JPG, jeśli pole broszura pozostanie puste.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-274">Once you have verified that the page requires a picture to be uploaded and won't accept non-PDF or non-JPG files, add a new category with a valid JPG picture, leaving the Brochure field empty.</span></span> <span data-ttu-id="6d9f2-275">Po kliknięciu przycisku Wstaw będzie ogłaszanie zwrotne strony i nowy rekord zostanie dodany do `Categories` tabelę zawierającą binarne treści przekazany obraz s bezpośrednio w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-275">After clicking the Insert button, the page will postback and a new record will be added to the `Categories` table with the uploaded image s binary contents stored directly in the database.</span></span> <span data-ttu-id="6d9f2-276">Kontrolki GridView zostanie zaktualizowana i zawiera wiersz dla nowo dodanego kategorii, ale, jak pokazano na rysunku nr 10, nowy obraz s kategorii nie jest poprawnie renderowana.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-276">The GridView is updated and shows a row for the newly added category, but, as Figure 10 shows, the new category s picture is not rendered correctly.</span></span>


[![T<span data-ttu-id="6d9f2-277">nie jest on nową kategorię s obraz wyświetlany]</span><span class="sxs-lookup"><span data-stu-id="6d9f2-277">he New Category s Picture is not Displayed]</span></span>(including-a-file-upload-option-when-adding-a-new-record-cs/_static/image10.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image17.png)

<span data-ttu-id="6d9f2-278">**Na rysunku nr 10**: S nowej kategorii nie jest wyświetlany obraz ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="6d9f2-278">**Figure 10**: The New Category s Picture is not Displayed ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image18.png))</span></span>


<span data-ttu-id="6d9f2-279">Przyczyną nowy obraz nie jest wyświetlany jest `DisplayCategoryPicture.aspx` strona, która zwraca wartość określonej kategorii s obrazu jest skonfigurowany do przetworzenia mapy bitowe, które mają nagłówek OLE.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-279">The reason the new picture is not displayed is because the `DisplayCategoryPicture.aspx` page that returns a specified category s picture is configured to process bitmaps that have an OLE header.</span></span> <span data-ttu-id="6d9f2-280">Ten nagłówek 78 bajtów jest pozbawiony `Picture` kolumny s binarne treści przed wysłaniem ich z powrotem do klienta.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-280">This 78 byte header is stripped from the `Picture` column s binary contents before they are sent back to the client.</span></span> <span data-ttu-id="6d9f2-281">Ale JPG plik, który właśnie został przekazany do nowej kategorii nie ma tego pliku nagłówkowego OLE; w związku z tym bajty prawidłowy, niezbędne są usuwane z danych binarnych s obrazu.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-281">But the JPG file we just uploaded for the new category does not have this OLE header; therefore, valid, necessary bytes are being removed from the image s binary data.</span></span>

<span data-ttu-id="6d9f2-282">Ponieważ teraz są oba map bitowych z nagłówkami OLE i JPG w `Categories` tabeli, należy zaktualizować `DisplayCategoryPicture.aspx` tak, aby jest nagłówek OLE obcięcie dla oryginalnego osiem kategorii i pomija ten obcięcie nowszej rekordów kategorii.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-282">Since there are now both bitmaps with OLE headers and JPGs in the `Categories` table, we need to update `DisplayCategoryPicture.aspx` so that it does the OLE header stripping for the original eight categories and bypasses this stripping for the newer category records.</span></span> <span data-ttu-id="6d9f2-283">W naszym samouczku dalej zajmiemy się jak zaktualizować istniejący obraz rekordu s, a dodamy wszystkie obrazy stare kategorii, aby były jpg.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-283">In our next tutorial we'll examine how to update an existing record s image, and we'll update all of the old category pictures so that they are JPGs.</span></span> <span data-ttu-id="6d9f2-284">Teraz, mimo że, użyj następującego kodu, w `DisplayCategoryPicture.aspx` oddzielić nagłówki OLE tylko dla tych oryginalnego osiem kategorii:</span><span class="sxs-lookup"><span data-stu-id="6d9f2-284">For now, though, use the following code in `DisplayCategoryPicture.aspx` to strip the OLE headers only for those original eight categories:</span></span>


[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample12.cs)]

<span data-ttu-id="6d9f2-285">Dzięki tej zmianie obraz JPG teraz poprawnie renderowana w widoku GridView.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-285">With this change, the JPG image is now rendered correctly in the GridView.</span></span>


[![T<span data-ttu-id="6d9f2-286">Obrazów JPG on dla nowych kategorii są poprawnie renderowane]</span><span class="sxs-lookup"><span data-stu-id="6d9f2-286">he JPG Images for New Categories are Correctly Rendered]</span></span>(including-a-file-upload-option-when-adding-a-new-record-cs/_static/image11.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image19.png)

<span data-ttu-id="6d9f2-287">**Rysunek 11**: Obrazów JPG dla nowych kategorii są poprawnie renderowane ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="6d9f2-287">**Figure 11**: The JPG Images for New Categories are Correctly Rendered ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image20.png))</span></span>


## <a name="step-9-deleting-the-brochure-in-the-face-of-an-exception"></a><span data-ttu-id="6d9f2-288">Krok 9. Usuwanie broszura także w przypadku wyjątku</span><span class="sxs-lookup"><span data-stu-id="6d9f2-288">Step 9: Deleting the Brochure in the Face of an Exception</span></span>

<span data-ttu-id="6d9f2-289">Jednym z wyzwań dotyczących przechowywania danych binarnych w systemie plików s serwera sieci web jest wprowadzenie rozłączenia od modelu danych i jego danych binarnych.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-289">One of the challenges of storing binary data on the web server s file system is that it introduces a disconnect between the data model and its binary data.</span></span> <span data-ttu-id="6d9f2-290">W związku z tym gdy rekord zostanie usunięty, odpowiadające im dane binarne w systemie plików należy także usunąć.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-290">Therefore, whenever a record is deleted, the corresponding binary data on the file system must also be removed.</span></span> <span data-ttu-id="6d9f2-291">Można to dochodzą do głosu przy wstawianiu, jak również.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-291">This can come into play when inserting, as well.</span></span> <span data-ttu-id="6d9f2-292">Rozważmy następujący scenariusz: użytkownik dodaje nową kategorię, określając prawidłowy obraz i broszura.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-292">Consider the following scenario: a user adds a new category, specifying a valid picture and brochure.</span></span> <span data-ttu-id="6d9f2-293">Kliknięcie przycisku Wstaw występuje odświeżenie strony i DetailsView s `ItemInserting` generowane zdarzenie, zapisywanie broszurę w systemie plików serwera s sieci web.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-293">Upon clicking the Insert button, a postback occurs and the DetailsView s `ItemInserting` event fires, saving the brochure to the web server s file system.</span></span> <span data-ttu-id="6d9f2-294">Następnie, s kontrolki ObjectDataSource `Insert()` wywoływana jest metoda, która wywołuje `CategoriesBLL` klasy s `InsertWithPicture` metody, która wywołuje `CategoriesTableAdapter` s `InsertWithPicture` metody.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-294">Next, the ObjectDataSource s `Insert()` method is invoked, which calls the `CategoriesBLL` class s `InsertWithPicture` method, which calls the `CategoriesTableAdapter` s `InsertWithPicture` method.</span></span>

<span data-ttu-id="6d9f2-295">Teraz, co się stanie, jeśli baza danych jest w trybie offline lub jeśli jest to błąd w `INSERT` instrukcji SQL?</span><span class="sxs-lookup"><span data-stu-id="6d9f2-295">Now, what happens if the database is offline, or if there is an error in the `INSERT` SQL statement?</span></span> <span data-ttu-id="6d9f2-296">Wyraźnie Wstaw zakończy się niepowodzeniem, więc nie nowy wiersz kategorii, które zostaną dodane do bazy danych.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-296">Clearly the INSERT will fail, so no new category row will be added to the database.</span></span> <span data-ttu-id="6d9f2-297">Ale mamy jeszcze plików przekazanych broszura znajdują się w systemie plików s serwera sieci web!</span><span class="sxs-lookup"><span data-stu-id="6d9f2-297">But we still have the uploaded brochure file sitting on the web server s file system!</span></span> <span data-ttu-id="6d9f2-298">Ten plik wymaga do usunięcia w przypadku wystąpienia wyjątku podczas Wstawianie przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-298">This file needs to be deleted in the face of an exception during the inserting workflow.</span></span>

<span data-ttu-id="6d9f2-299">Jak wspomniano wcześniej w [obsługi LOGIKI i wyjątki DAL na poziomie strony ASP.NET](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) samouczek, gdy wyjątek jest zgłaszany w ramach głębokości architektury, jest ona przepuszcza się za pomocą różnych warstw.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-299">As discussed previously in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) tutorial, when an exception is thrown from within the depths of the architecture it is bubbled up through the various layers.</span></span> <span data-ttu-id="6d9f2-300">W warstwie prezentacji, możemy określić, jeśli wystąpił wyjątek z DetailsView s `ItemInserted` zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-300">At the Presentation Layer, we can determine if an exception has occurred from the DetailsView s `ItemInserted` event.</span></span> <span data-ttu-id="6d9f2-301">Ta procedura obsługi zdarzeń są także wartości ObjectDataSource s `InsertParameters`.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-301">This event handler also provides the values of the ObjectDataSource s `InsertParameters`.</span></span> <span data-ttu-id="6d9f2-302">W związku z tym, można utworzyć program obsługi zdarzeń dla `ItemInserted` zdarzenia, które sprawdza w przypadku, gdy wystąpił wyjątek, a jeśli tak, usuwa plik określony przez ObjectDataSource s `brochurePath` parametru:</span><span class="sxs-lookup"><span data-stu-id="6d9f2-302">Therefore, we can create an event handler for the `ItemInserted` event that checks if there was an exception and, if so, deletes the file specified by the ObjectDataSource s `brochurePath` parameter:</span></span>


[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample13.cs)]

## <a name="summary"></a><span data-ttu-id="6d9f2-303">Podsumowanie</span><span class="sxs-lookup"><span data-stu-id="6d9f2-303">Summary</span></span>

<span data-ttu-id="6d9f2-304">Istnieje kilka kroków, które należy wykonać w celu zapewnienia interfejsu opartego na sieci web do dodawania rekordów, które zawierają dane binarne.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-304">There are a number of steps that must be performed in order to provide a web-based interface for adding records that include binary data.</span></span> <span data-ttu-id="6d9f2-305">Jeśli bezpośrednio do bazy danych przechowywane są dane binarne, jest szansa, że musisz zaktualizować architektury, dodawania konkretnych metod, aby obsłużyć przypadek, w którym wstawiono dane binarne.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-305">If the binary data is being stored directly into the database, chances are you'll need to update the architecture, adding specific methods to handle the case where binary data is being inserted.</span></span> <span data-ttu-id="6d9f2-306">Gdy architektura została zaktualizowana, następnym krokiem jest utworzenie Wstawianie interfejs, który można osiągnąć za pomocą DetailsView, który został dostosowany do uwzględnienia kontrolki FileUpload dla każdego pola danych binarnych.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-306">Once the architecture has been updated, the next step is creating the inserting interface, which can be accomplished using a DetailsView that has been customized to include a FileUpload control for each binary data field.</span></span> <span data-ttu-id="6d9f2-307">Można następnie przekazane dane zapisane w systemie plików serwera s sieci web lub przypisane do parametru źródła danych, w tym s DetailsView `ItemInserting` programu obsługi zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-307">The uploaded data can then be saved to the web server s file system or assigned to a data source parameter in the DetailsView s `ItemInserting` event handler.</span></span>

<span data-ttu-id="6d9f2-308">Zapisywanie danych binarnych w systemie plików wymaga planowania więcej niż zapisywanie danych bezpośrednio do bazy danych.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-308">Saving binary data to the file system requires more planning than saving data directly into the database.</span></span> <span data-ttu-id="6d9f2-309">Schemat nazewnictwa musi być wybrana w celu uniknięcia jeden przekazywania użytkownika s, zastępując inny s.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-309">A naming scheme must be chosen in order to avoid one user s upload overwriting another s.</span></span> <span data-ttu-id="6d9f2-310">Ponadto dodatkowe kroki należy usunąć przekazany plik, jeśli wstawienie bazy danych nie powiedzie się.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-310">Also, extra steps must be taken to delete the uploaded file if the database insert fails.</span></span>

<span data-ttu-id="6d9f2-311">Teraz mamy możliwość dodawania nowych kategorii do systemu za pomocą broszurę i obraz, ale ve jeszcze, aby przyjrzeć się sposobie aktualizowania istniejących danych binarnych s kategorii lub jak poprawnie usunąć dane binarne usunięto kategorię.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-311">We now have the ability to add new categories to the system with a brochure and picture, but we ve yet to look at how to update an existing category s binary data or how to correctly remove the binary data for a deleted category.</span></span> <span data-ttu-id="6d9f2-312">W następnym samouczku przyjrzymy się dwa następujące tematy.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-312">We'll explore these two topics in the next tutorial.</span></span>

<span data-ttu-id="6d9f2-313">Wszystkiego najlepszego programowania!</span><span class="sxs-lookup"><span data-stu-id="6d9f2-313">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="6d9f2-314">Informacje o autorze</span><span class="sxs-lookup"><span data-stu-id="6d9f2-314">About the Author</span></span>

<span data-ttu-id="6d9f2-315">[Scott Bento](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor siedem ASP/ASP.NET książek i założycielem [4GuysFromRolla.com](http://www.4guysfromrolla.com), pracował nad przy użyciu technologii Microsoft Web od 1998 r.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-315">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="6d9f2-316">Scott działa jako niezależny Konsultant, trainer i składnika zapisywania.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-316">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="6d9f2-317">Jego najnowszą książkę Stephena [ *Sams uczyć się ASP.NET 2.0 w ciągu 24 godzin*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="6d9f2-317">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="6d9f2-318">ADAM można z Tobą skontaktować w [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="6d9f2-318">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="6d9f2-319">lub za pośrednictwem jego blogu, który znajduje się w temacie [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="6d9f2-319">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="6d9f2-320">Specjalne podziękowania dla</span><span class="sxs-lookup"><span data-stu-id="6d9f2-320">Special Thanks To</span></span>

<span data-ttu-id="6d9f2-321">W tej serii samouczków został zrecenzowany przez wielu recenzentów pomocne.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-321">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="6d9f2-322">Wiodące osób dokonujących przeglądu, w tym samouczku zostały Dave Gardner Teresa Murphy i Bernadette Leigh.</span><span class="sxs-lookup"><span data-stu-id="6d9f2-322">Lead reviewers for this tutorial were Dave Gardner, Teresa Murphy, and Bernadette Leigh.</span></span> <span data-ttu-id="6d9f2-323">Zainteresowani zapoznaniem Moje kolejnych artykułów MSDN?</span><span class="sxs-lookup"><span data-stu-id="6d9f2-323">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="6d9f2-324">Jeśli tak, Porzuć mnie linii w [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="6d9f2-324">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="6d9f2-325">[Poprzednie](displaying-binary-data-in-the-data-web-controls-cs.md)
> [dalej](updating-and-deleting-existing-binary-data-cs.md)</span><span class="sxs-lookup"><span data-stu-id="6d9f2-325">[Previous](displaying-binary-data-in-the-data-web-controls-cs.md)
[Next](updating-and-deleting-existing-binary-data-cs.md)</span></span>
