---
uid: web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/performing-batch-updates-cs
title: Wykonywanie aktualizacji wsadowychC#() | Microsoft Docs
author: rick-anderson
description: Dowiedz się, jak utworzyć w pełni edytowalną listę DataList, w której wszystkie elementy znajdują się w trybie edycji, których wartości można zapisać, klikając przycisk "Aktualizuj wszystko" w...
ms.author: riande
ms.date: 10/30/2006
ms.assetid: 57743ca7-5695-4e07-aed1-44b297f245a9
msc.legacyurl: /web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/performing-batch-updates-cs
msc.type: authoredcontent
ms.openlocfilehash: cde12a4d24555216adc49dd02818901278932eaa
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 11/28/2019
ms.locfileid: "74631571"
---
# <a name="performing-batch-updates-c"></a><span data-ttu-id="8872d-103">Wykonywanie aktualizacji wsadowych (C#)</span><span class="sxs-lookup"><span data-stu-id="8872d-103">Performing Batch Updates (C#)</span></span>

<span data-ttu-id="8872d-104">przez [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="8872d-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="8872d-105">[Pobierz przykładową aplikację](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_37_CS.exe) lub [Pobierz plik PDF](performing-batch-updates-cs/_static/datatutorial37cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="8872d-105">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_37_CS.exe) or [Download PDF](performing-batch-updates-cs/_static/datatutorial37cs1.pdf)</span></span>

> <span data-ttu-id="8872d-106">Dowiedz się, jak utworzyć w pełni edytowalną stronę typu DataList, w której wszystkie elementy są w trybie edycji, których wartości można zapisać, klikając przycisk "Aktualizuj wszystko" na stronie.</span><span class="sxs-lookup"><span data-stu-id="8872d-106">Learn how to create a fully-editable DataList where all of its items are in edit mode and whose values can be saved by clicking an "Update All" button on the page.</span></span>

## <a name="introduction"></a><span data-ttu-id="8872d-107">Wprowadzenie</span><span class="sxs-lookup"><span data-stu-id="8872d-107">Introduction</span></span>

<span data-ttu-id="8872d-108">W [poprzednim samouczku](an-overview-of-editing-and-deleting-data-in-the-datalist-cs.md) sprawdziłmy, jak utworzyć element DataList na poziomie elementu.</span><span class="sxs-lookup"><span data-stu-id="8872d-108">In the [preceding tutorial](an-overview-of-editing-and-deleting-data-in-the-datalist-cs.md) we examined how to create an item-level DataList.</span></span> <span data-ttu-id="8872d-109">Podobnie jak w przypadku standardowego edytowalnego widoku GridView każdy element w elemencie DataList zawiera przycisk edycji, który po kliknięciu sprawia, że element będzie można edytować.</span><span class="sxs-lookup"><span data-stu-id="8872d-109">Like the standard editable GridView, each item in the DataList included an Edit button that, when clicked, would make the item editable.</span></span> <span data-ttu-id="8872d-110">Chociaż ta edycja na poziomie elementu działa prawidłowo w przypadku danych, które są aktualizowane tylko sporadycznie, niektóre scenariusze przypadków użycia wymagają od użytkownika edytowania wielu rekordów.</span><span class="sxs-lookup"><span data-stu-id="8872d-110">While this item-level editing works well for data that is only updated occasionally, certain use case scenarios require the user to edit many records.</span></span> <span data-ttu-id="8872d-111">Jeśli użytkownik musi edytować dziesiątki rekordów i musi kliknąć pozycję Edytuj, wprowadzić zmiany, a następnie kliknąć przycisk Aktualizuj dla każdej z nich, ilość klikniętych elementów może zakłócać swoją produktywność.</span><span class="sxs-lookup"><span data-stu-id="8872d-111">If a user needs to edit dozens of records and is forced to click Edit, make their changes, and click Update for each one, the amount of clicking can hamper her productivity.</span></span> <span data-ttu-id="8872d-112">W takich sytuacjach lepszym rozwiązaniem jest udostępnienie w pełni edytowalnego elementu DataList, jednego, gdzie *wszystkie* jego elementy znajdują się w trybie edycji. których wartości można edytować, klikając przycisk Aktualizuj wszystko na stronie (patrz rysunek 1).</span><span class="sxs-lookup"><span data-stu-id="8872d-112">In such situations, a better option is to provide a fully-editable DataList, one where *all* of its items are in edit mode and whose values can be edited by clicking an Update All button on the page (see Figure 1).</span></span>

<span data-ttu-id="8872d-113">[![każdy element w w pełni edytowalnej DataList można zmodyfikować](performing-batch-updates-cs/_static/image2.png)](performing-batch-updates-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="8872d-113">[![Each Item in a Fully Editable DataList can be Modified](performing-batch-updates-cs/_static/image2.png)](performing-batch-updates-cs/_static/image1.png)</span></span>

<span data-ttu-id="8872d-114">**Rysunek 1**: każdy element w w pełni edytowalnej DataList można zmodyfikować ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](performing-batch-updates-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="8872d-114">**Figure 1**: Each Item in a Fully Editable DataList can be Modified ([Click to view full-size image](performing-batch-updates-cs/_static/image3.png))</span></span>

<span data-ttu-id="8872d-115">W tym samouczku dowiesz się, jak umożliwić użytkownikom aktualizowanie informacji o adresie dostawców przy użyciu w pełni edytowalnej elementu DataList.</span><span class="sxs-lookup"><span data-stu-id="8872d-115">In this tutorial we'll examine how to enable users to update suppliers address information using a fully editable DataList.</span></span>

## <a name="step-1-create-the-editable-user-interface-in-the-datalist-s-itemtemplate"></a><span data-ttu-id="8872d-116">Krok 1. Tworzenie edytowalnego interfejsu użytkownika w ItemTemplate DataList</span><span class="sxs-lookup"><span data-stu-id="8872d-116">Step 1: Create the Editable User Interface in the DataList s ItemTemplate</span></span>

<span data-ttu-id="8872d-117">W poprzednim samouczku, w którym tworzymy standardową, edytowalną na poziomie elementu element DataList, użyto dwóch szablonów:</span><span class="sxs-lookup"><span data-stu-id="8872d-117">In the preceding tutorial, where we creating a standard, item-level editable DataList, we used two templates:</span></span>

- <span data-ttu-id="8872d-118">`ItemTemplate` zawiera interfejs użytkownika tylko do odczytu (kontrolki sieci Web etykiety do wyświetlania każdej nazwy i ceny produktu).</span><span class="sxs-lookup"><span data-stu-id="8872d-118">`ItemTemplate` contained the read-only user interface (the Label Web controls for displaying each product s name and price).</span></span>
- <span data-ttu-id="8872d-119">`EditItemTemplate` zawiera interfejs użytkownika trybu edycji (dwie kontrolki sieci Web w postaci pola tekstowego).</span><span class="sxs-lookup"><span data-stu-id="8872d-119">`EditItemTemplate` contained the edit mode user interface (the two TextBox Web controls).</span></span>

<span data-ttu-id="8872d-120">Właściwość DataList s `EditItemIndex` określa, jakie `DataListItem` (jeśli istnieją) są renderowane przy użyciu `EditItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="8872d-120">The DataList s `EditItemIndex` property dictates what `DataListItem` (if any) is rendered using the `EditItemTemplate`.</span></span> <span data-ttu-id="8872d-121">W szczególności `DataListItem`, których `ItemIndex` wartość zgodna z właściwością DataList s `EditItemIndex` jest renderowany przy użyciu `EditItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="8872d-121">In particular, the `DataListItem` whose `ItemIndex` value matches the DataList s `EditItemIndex` property is rendered using the `EditItemTemplate`.</span></span> <span data-ttu-id="8872d-122">Ten model działa dobrze, gdy można edytować tylko jeden element jednocześnie, ale przy tworzeniu w pełni edytowalnego elementu DataList.</span><span class="sxs-lookup"><span data-stu-id="8872d-122">This model works well when only one item can be edited at a time, but falls apart when creating a fully-editable DataList.</span></span>

<span data-ttu-id="8872d-123">W przypadku w pełni edytowalnej wartości DataList chcemy, aby *wszystkie* `DataListItem` s były renderowane przy użyciu interfejsu edytowalnego.</span><span class="sxs-lookup"><span data-stu-id="8872d-123">For a fully editable DataList, we want *all* of the `DataListItem` s to render using the editable interface.</span></span> <span data-ttu-id="8872d-124">Najprostszym sposobem osiągnięcia tego celu jest zdefiniowanie interfejsu edytowalnego w `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="8872d-124">The simplest way to accomplish this is to define the editable interface in the `ItemTemplate`.</span></span> <span data-ttu-id="8872d-125">W przypadku modyfikowania informacji o adresie dostawcy, edytowalny interfejs zawiera nazwę dostawcy jako tekst, a następnie pola tekstowe dla wartości adres, miasto i kraj.</span><span class="sxs-lookup"><span data-stu-id="8872d-125">For modifying the suppliers address information, the editable interface contains the supplier name as text and then TextBoxes for the address, city, and country values.</span></span>

<span data-ttu-id="8872d-126">Aby rozpocząć, Otwórz stronę `BatchUpdate.aspx`, Dodaj kontrolkę DataList i ustaw jej Właściwość `ID` na `Suppliers`.</span><span class="sxs-lookup"><span data-stu-id="8872d-126">Start by opening the `BatchUpdate.aspx` page, add a DataList control, and set its `ID` property to `Suppliers`.</span></span> <span data-ttu-id="8872d-127">W tagu inteligentnym DataList s Dodaj nową kontrolkę ObjectDataSource o nazwie `SuppliersDataSource`.</span><span class="sxs-lookup"><span data-stu-id="8872d-127">From the DataList s smart tag, opt to add a new ObjectDataSource control named `SuppliersDataSource`.</span></span>

<span data-ttu-id="8872d-128">[![utworzyć nowego elementu ObjectDataSource o nazwie SuppliersDataSource](performing-batch-updates-cs/_static/image5.png)](performing-batch-updates-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="8872d-128">[![Create a New ObjectDataSource Named SuppliersDataSource](performing-batch-updates-cs/_static/image5.png)](performing-batch-updates-cs/_static/image4.png)</span></span>

<span data-ttu-id="8872d-129">**Rysunek 2**. Utwórz nowy element ObjectDataSource o nazwie `SuppliersDataSource` ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](performing-batch-updates-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="8872d-129">**Figure 2**: Create a New ObjectDataSource Named `SuppliersDataSource` ([Click to view full-size image](performing-batch-updates-cs/_static/image6.png))</span></span>

<span data-ttu-id="8872d-130">Skonfiguruj element ObjectDataSource do pobierania danych przy użyciu metody `GetSuppliers()` `SuppliersBLL` Class (patrz rysunek 3).</span><span class="sxs-lookup"><span data-stu-id="8872d-130">Configure the ObjectDataSource to retrieve data using the `SuppliersBLL` class s `GetSuppliers()` method (see Figure 3).</span></span> <span data-ttu-id="8872d-131">Podobnie jak w przypadku poprzedniego samouczka, zamiast aktualizowania informacji o dostawcach za pomocą elementu ObjectDataSource, będziemy współpracować bezpośrednio z warstwą logiki biznesowej.</span><span class="sxs-lookup"><span data-stu-id="8872d-131">As with the preceding tutorial, rather than updating the supplier information through the ObjectDataSource, we'll work directly with the Business Logic Layer.</span></span> <span data-ttu-id="8872d-132">W związku z tym Ustaw listę rozwijaną na wartość (brak) na karcie aktualizacja (zobacz rysunek 4).</span><span class="sxs-lookup"><span data-stu-id="8872d-132">Therefore, set the drop-down list to (None) in the UPDATE tab (see Figure 4).</span></span>

<span data-ttu-id="8872d-133">[![pobrać informacji o dostawcy za pomocą metody getdostawcs ()](performing-batch-updates-cs/_static/image8.png)](performing-batch-updates-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="8872d-133">[![Retrieve Supplier Information Using the GetSuppliers() Method](performing-batch-updates-cs/_static/image8.png)](performing-batch-updates-cs/_static/image7.png)</span></span>

<span data-ttu-id="8872d-134">**Rysunek 3**. Pobieranie informacji o dostawcy za pomocą metody `GetSuppliers()` ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](performing-batch-updates-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="8872d-134">**Figure 3**: Retrieve Supplier Information Using the `GetSuppliers()` Method ([Click to view full-size image](performing-batch-updates-cs/_static/image9.png))</span></span>

<span data-ttu-id="8872d-135">[![ustawić dla listy rozwijanej wartość (brak) na karcie aktualizacja.](performing-batch-updates-cs/_static/image11.png)](performing-batch-updates-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="8872d-135">[![Set the Drop-Down List to (None) in the UPDATE Tab](performing-batch-updates-cs/_static/image11.png)](performing-batch-updates-cs/_static/image10.png)</span></span>

<span data-ttu-id="8872d-136">**Rysunek 4**. Ustaw listę rozwijaną na (brak) na karcie aktualizacja ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](performing-batch-updates-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="8872d-136">**Figure 4**: Set the Drop-Down List to (None) in the UPDATE Tab ([Click to view full-size image](performing-batch-updates-cs/_static/image12.png))</span></span>

<span data-ttu-id="8872d-137">Po zakończeniu działania kreatora program Visual Studio automatycznie generuje `ItemTemplate` DataList s, aby wyświetlić każde pole danych zwrócone przez źródło danych w kontrolce sieci Web etykieta.</span><span class="sxs-lookup"><span data-stu-id="8872d-137">After completing the wizard, Visual Studio automatically generates the DataList s `ItemTemplate` to display each data field returned by the data source in a Label Web control.</span></span> <span data-ttu-id="8872d-138">Musimy zmodyfikować ten szablon w taki sposób, aby zamiast niego udostępnił interfejs edycji.</span><span class="sxs-lookup"><span data-stu-id="8872d-138">We need to modify this template so that it provides the editing interface instead.</span></span> <span data-ttu-id="8872d-139">`ItemTemplate` można dostosować za pomocą projektanta przy użyciu opcji Edytuj szablony z taga inteligentnego DataList s lub bezpośrednio za pomocą składni deklaracyjnej.</span><span class="sxs-lookup"><span data-stu-id="8872d-139">The `ItemTemplate` can be customized through the Designer using the Edit Templates option from the DataList s smart tag or directly through the declarative syntax.</span></span>

<span data-ttu-id="8872d-140">Poświęć chwilę na utworzenie interfejsu edycji, który wyświetla nazwę dostawcy jako tekst, ale zawiera pola tekstowe dla adresu dostawcy, miasta i wartości kraju.</span><span class="sxs-lookup"><span data-stu-id="8872d-140">Take a moment to create an editing interface that displays the supplier s name as text, but includes TextBoxes for the supplier s address, city, and country values.</span></span> <span data-ttu-id="8872d-141">Po wprowadzeniu tych zmian składnia deklaracyjnej strony powinna wyglądać podobnie do następującej:</span><span class="sxs-lookup"><span data-stu-id="8872d-141">After making these changes, your page s declarative syntax should look similar to the following:</span></span>

[!code-aspx[Main](performing-batch-updates-cs/samples/sample1.aspx)]

> [!NOTE]
> <span data-ttu-id="8872d-142">Tak jak w poprzednim samouczku, DataList w tym samouczku musi mieć włączony stan widoku.</span><span class="sxs-lookup"><span data-stu-id="8872d-142">As with the preceding tutorial, the DataList in this tutorial must have its view state enabled.</span></span>

<span data-ttu-id="8872d-143">W `ItemTemplate` I m przy użyciu dwóch nowych klas CSS, `SupplierPropertyLabel` i `SupplierPropertyValue`, które zostały dodane do klasy `Styles.css` i zostały skonfigurowane tak, aby korzystały z tych samych ustawień stylu co `ProductPropertyLabel` i `ProductPropertyValue` klas CSS.</span><span class="sxs-lookup"><span data-stu-id="8872d-143">In the `ItemTemplate` I m using two new CSS classes, `SupplierPropertyLabel` and `SupplierPropertyValue`, which have been added to the `Styles.css` class and configured to use the same style settings as the `ProductPropertyLabel` and `ProductPropertyValue` CSS classes.</span></span>

[!code-css[Main](performing-batch-updates-cs/samples/sample2.css)]

<span data-ttu-id="8872d-144">Po wprowadzeniu tych zmian odwiedź tę stronę za pomocą przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="8872d-144">After making these changes, visit this page through a browser.</span></span> <span data-ttu-id="8872d-145">Jak pokazano na rysunku 5, każdy element DataList wyświetla nazwę dostawcy jako tekst i używa pól tekstowych do wyświetlania adresu, miasta i kraju.</span><span class="sxs-lookup"><span data-stu-id="8872d-145">As Figure 5 shows, each DataList item displays the supplier name as text and uses TextBoxes to display the address, city, and country.</span></span>

<span data-ttu-id="8872d-146">[![każdy dostawca w elemencie DataList jest edytowalny](performing-batch-updates-cs/_static/image14.png)](performing-batch-updates-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="8872d-146">[![Each Supplier in the DataList is Editable](performing-batch-updates-cs/_static/image14.png)](performing-batch-updates-cs/_static/image13.png)</span></span>

<span data-ttu-id="8872d-147">**Rysunek 5**. można edytować każdego dostawcę w elemencie DataList ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](performing-batch-updates-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="8872d-147">**Figure 5**: Each Supplier in the DataList is Editable ([Click to view full-size image](performing-batch-updates-cs/_static/image15.png))</span></span>

## <a name="step-2-adding-an-update-all-button"></a><span data-ttu-id="8872d-148">Krok 2. Dodawanie przycisku Aktualizuj wszystko</span><span class="sxs-lookup"><span data-stu-id="8872d-148">Step 2: Adding an Update All Button</span></span>

<span data-ttu-id="8872d-149">Każdy dostawca na rysunku 5 ma pola adres, miasto i kraj wyświetlane w polu tekstowym, a obecnie nie ma dostępnego przycisku Aktualizuj.</span><span class="sxs-lookup"><span data-stu-id="8872d-149">While each supplier in Figure 5 has its address, city, and country fields displayed in a TextBox, there currently is no Update button available.</span></span> <span data-ttu-id="8872d-150">Zamiast przycisku Aktualizuj dla każdego elementu z pełnymi edytowalnymi listami danych na stronie jest zwykle pojedynczy przycisk Aktualizuj wszystko, który po kliknięciu aktualizuje *wszystkie* rekordy w elemencie DataList.</span><span class="sxs-lookup"><span data-stu-id="8872d-150">Rather than having an Update button per item, with fully editable DataLists there is typically a single Update All button on the page that, when clicked, updates *all* of the records in the DataList.</span></span> <span data-ttu-id="8872d-151">Na potrzeby tego samouczka Dodaj dwa przyciski aktualizacji wszystkie — jeden w górnej części strony i jeden u dołu (mimo że kliknięcie jednego z nich będzie miało ten sam efekt).</span><span class="sxs-lookup"><span data-stu-id="8872d-151">For this tutorial, let s add two Update All buttons - one at the top of the page and one at the bottom (although clicking either button will have the same effect).</span></span>

<span data-ttu-id="8872d-152">Zacznij od dodania kontrolki sieci Web przycisku powyżej elementu DataList i ustaw jej Właściwość `ID` na `UpdateAll1`.</span><span class="sxs-lookup"><span data-stu-id="8872d-152">Start by adding a Button Web control above the DataList and set its `ID` property to `UpdateAll1`.</span></span> <span data-ttu-id="8872d-153">Następnie Dodaj drugi kontrolkę sieci Web przycisku poniżej elementu DataList, ustawiając jej `ID` na `UpdateAll2`.</span><span class="sxs-lookup"><span data-stu-id="8872d-153">Next, add the second Button Web control beneath the DataList, setting its `ID` to `UpdateAll2`.</span></span> <span data-ttu-id="8872d-154">Ustaw właściwości `Text` dla dwóch przycisków, aby zaktualizować wszystkie.</span><span class="sxs-lookup"><span data-stu-id="8872d-154">Set the `Text` properties for the two Buttons to Update All.</span></span> <span data-ttu-id="8872d-155">Na koniec Utwórz programy obsługi zdarzeń dla obu przycisków `Click` zdarzenia.</span><span class="sxs-lookup"><span data-stu-id="8872d-155">Lastly, create event handlers for both Buttons `Click` events.</span></span> <span data-ttu-id="8872d-156">Zamiast duplikowania logiki aktualizacji w każdym z programów obsługi zdarzeń, należy powiadomić element, który jest logiką do trzeciej metody, `UpdateAllSupplierAddresses`, że programy obsługi zdarzeń po prostu wywołujeją tę trzecią metodę.</span><span class="sxs-lookup"><span data-stu-id="8872d-156">Rather than duplicating the update logic in each of the event handlers, let s refactor that logic to a third method, `UpdateAllSupplierAddresses`, having the event handlers simply invoking this third method.</span></span>

[!code-csharp[Main](performing-batch-updates-cs/samples/sample3.cs)]

<span data-ttu-id="8872d-157">Rysunek 6 przedstawia stronę po dodaniu przycisków Aktualizuj wszystkie.</span><span class="sxs-lookup"><span data-stu-id="8872d-157">Figure 6 shows the page after the Update All buttons have been added.</span></span>

<span data-ttu-id="8872d-158">[do strony dodano ![dwie przyciski aktualizacji](performing-batch-updates-cs/_static/image17.png)](performing-batch-updates-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="8872d-158">[![Two Update All Buttons have been Added to the Page](performing-batch-updates-cs/_static/image17.png)](performing-batch-updates-cs/_static/image16.png)</span></span>

<span data-ttu-id="8872d-159">**Ilustracja 6**. do strony dodano dwa przyciski aktualizacji ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](performing-batch-updates-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="8872d-159">**Figure 6**: Two Update All Buttons have been Added to the Page ([Click to view full-size image](performing-batch-updates-cs/_static/image18.png))</span></span>

## <a name="step-3-updating-all-of-the-suppliers-address-information"></a><span data-ttu-id="8872d-160">Krok 3. aktualizowanie wszystkich informacji o adresie dostawcy</span><span class="sxs-lookup"><span data-stu-id="8872d-160">Step 3: Updating All of the Suppliers Address Information</span></span>

<span data-ttu-id="8872d-161">Wszystkie elementy DataList są wyświetlane w interfejsie edycji i z dodaniem przycisków Aktualizuj wszystkie, które pozostaną, pisząc kod do wykonania aktualizacji wsadowej.</span><span class="sxs-lookup"><span data-stu-id="8872d-161">With all of the DataList s items displaying the editing interface and with the addition of the Update All buttons, all that remains is writing the code to perform the batch update.</span></span> <span data-ttu-id="8872d-162">W odniesieniu do każdej z nich musimy przepętlać przez elementy DataList i wywoływać metodę `SuppliersBLL` klasy s `UpdateSupplierAddress` dla każdej z nich.</span><span class="sxs-lookup"><span data-stu-id="8872d-162">Specifically, we need to loop through the DataList s items and call the `SuppliersBLL` class s `UpdateSupplierAddress` method for each one.</span></span>

<span data-ttu-id="8872d-163">Do kolekcji wystąpień `DataListItem`, które korzeńą Właściwość DataList, można uzyskać dostęp za pośrednictwem właściwości DataList s [`Items`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.items.aspx).</span><span class="sxs-lookup"><span data-stu-id="8872d-163">The collection of `DataListItem` instances that makeup the DataList can be accessed via the DataList s [`Items` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.items.aspx).</span></span> <span data-ttu-id="8872d-164">W odniesieniu do `DataListItem`można pobrać odpowiednie `SupplierID` z kolekcji `DataKeys` i programowo odwoływać się do kontrolek sieci Web typu TextBox w `ItemTemplate`, jak ilustruje poniższy kod:</span><span class="sxs-lookup"><span data-stu-id="8872d-164">With a reference to a `DataListItem`, we can grab the corresponding `SupplierID` from the `DataKeys` collection and programmatically reference the TextBox Web controls within the `ItemTemplate` as the following code illustrates:</span></span>

[!code-csharp[Main](performing-batch-updates-cs/samples/sample4.cs)]

<span data-ttu-id="8872d-165">Gdy użytkownik kliknie jeden z przycisków Aktualizuj wszystkie, Metoda `UpdateAllSupplierAddresses` iteruje przez poszczególne `DataListItem` w `Suppliers` DataList i wywołuje metodę `SuppliersBLL` klasy s `UpdateSupplierAddress`, przekazując odpowiednie wartości.</span><span class="sxs-lookup"><span data-stu-id="8872d-165">When the user clicks one of the Update All buttons, the `UpdateAllSupplierAddresses` method iterates through each `DataListItem` in the `Suppliers` DataList and calls the `SuppliersBLL` class s `UpdateSupplierAddress` method, passing in the corresponding values.</span></span> <span data-ttu-id="8872d-166">Wartość, która nie została wprowadzona dla przechodzenia adresu, miasta lub kraju, jest wartością `Nothing` do `UpdateSupplierAddress` (zamiast pustego ciągu), co powoduje `NULL` bazy danych dla źródłowych pól rekordów.</span><span class="sxs-lookup"><span data-stu-id="8872d-166">A non-entered value for address, city, or country passes is a value of `Nothing` to `UpdateSupplierAddress` (rather than a blank string), which results in a database `NULL` for the underlying record s fields.</span></span>

> [!NOTE]
> <span data-ttu-id="8872d-167">W ramach ulepszeń można dodać kontrolkę sieci Web etykieta stanu do strony, która zawiera komunikat z potwierdzeniem po wykonaniu aktualizacji wsadowej.</span><span class="sxs-lookup"><span data-stu-id="8872d-167">As an enhancement, you may want to add a status Label Web control to the page that provides some confirmation message after the batch update is performed.</span></span>

## <a name="updating-only-those-addresses-that-have-been-modified"></a><span data-ttu-id="8872d-168">Aktualizowanie tylko tych adresów, które zostały zmodyfikowane</span><span class="sxs-lookup"><span data-stu-id="8872d-168">Updating Only Those Addresses That Have Been Modified</span></span>

<span data-ttu-id="8872d-169">Algorytm aktualizacji wsadowych używany w tym samouczku wywołuje metodę `UpdateSupplierAddress` dla *każdego* dostawcy w elemencie DataList, niezależnie od tego, czy informacje o adresie zostały zmienione.</span><span class="sxs-lookup"><span data-stu-id="8872d-169">The batch update algorithm used for this tutorial calls the `UpdateSupplierAddress` method for *every* supplier in the DataList, regardless of whether their address information has been changed.</span></span> <span data-ttu-id="8872d-170">Chociaż takie aktualizacje niewidome nie są zwykle przyczyną problemów z wydajnością, mogą powodować zbędne rekordy w przypadku ponownego inspekcji zmian w tabeli bazy danych.</span><span class="sxs-lookup"><span data-stu-id="8872d-170">While such blind updates aren't usually a performance issue, they can lead to superfluous records if you re auditing changes to the database table.</span></span> <span data-ttu-id="8872d-171">Na przykład, jeśli używasz wyzwalaczy do rejestrowania wszystkich `UPDATE` s w tabeli `Suppliers` do tabeli inspekcji, za każdym razem, gdy użytkownik kliknie przycisk Aktualizuj wszystko, zostanie utworzony nowy rekord inspekcji dla każdego dostawcy w systemie, niezależnie od tego, czy użytkownik wprowadził jakiekolwiek zmiany.</span><span class="sxs-lookup"><span data-stu-id="8872d-171">For example, if you use triggers to record all `UPDATE` s to the `Suppliers` table to an auditing table, every time a user clicks the Update All button a new audit record will be created for each supplier in the system, regardless of whether the user made any changes.</span></span>

<span data-ttu-id="8872d-172">Klasy ADO.NET DataTable i DataAdapter są przeznaczone do obsługi aktualizacji wsadowych, gdy tylko zmodyfikowane, usunięte i nowe rekordy są wynikiem komunikacji z bazą danych.</span><span class="sxs-lookup"><span data-stu-id="8872d-172">The ADO.NET DataTable and DataAdapter classes are designed to support batch updates where only modified, deleted, and new records results in any database communication.</span></span> <span data-ttu-id="8872d-173">Każdy wiersz w elemencie DataTable ma [właściwość`RowState`](https://msdn.microsoft.com/library/system.data.datarow.rowstate.aspx) , która wskazuje, czy wiersz został dodany do elementu DataTable, usunięty z niego, zmodyfikowany lub pozostaje niezmieniony.</span><span class="sxs-lookup"><span data-stu-id="8872d-173">Each row in the DataTable has a [`RowState` property](https://msdn.microsoft.com/library/system.data.datarow.rowstate.aspx) that indicates whether the row has been added to the DataTable, deleted from it, modified, or remains unchanged.</span></span> <span data-ttu-id="8872d-174">Gdy element DataTable jest wypełniany początkowo, wszystkie wiersze są oznaczone jako niezmienione.</span><span class="sxs-lookup"><span data-stu-id="8872d-174">When a DataTable is initially populated, all rows are marked unchanged.</span></span> <span data-ttu-id="8872d-175">Zmiana wartości któregokolwiek z kolumn wiersza s oznacza, że wiersz został zmodyfikowany.</span><span class="sxs-lookup"><span data-stu-id="8872d-175">Changing the value of any of the row s columns marks the row as modified.</span></span>

<span data-ttu-id="8872d-176">W `SuppliersBLL` klasie aktualizujemy informacje o określonym adresie dostawcy, najpierw odczytując w rekordzie pojedynczego dostawcy do `SuppliersDataTable`, a następnie ustaw wartości kolumn `Address`, `City`i `Country` przy użyciu następującego kodu:</span><span class="sxs-lookup"><span data-stu-id="8872d-176">In the `SuppliersBLL` class we update the specified supplier s address information by first reading in the single supplier record into a `SuppliersDataTable` and then set the `Address`, `City`, and `Country` column values using the following code:</span></span>

[!code-csharp[Main](performing-batch-updates-cs/samples/sample5.cs)]

<span data-ttu-id="8872d-177">Ten kod naively przypisuje wartości zatwierdzono adres, miasto i kraj do `SuppliersRow` w `SuppliersDataTable` niezależnie od tego, czy wartości zostały zmienione.</span><span class="sxs-lookup"><span data-stu-id="8872d-177">This code naively assigns the passed-in address, city, and country values to the `SuppliersRow` in the `SuppliersDataTable` regardless of whether or not the values have changed.</span></span> <span data-ttu-id="8872d-178">Te modyfikacje powodują, że właściwość `SuppliersRow` s `RowState` zostanie oznaczona jako modyfikowana.</span><span class="sxs-lookup"><span data-stu-id="8872d-178">These modifications cause the `SuppliersRow` s `RowState` property to be marked as modified.</span></span> <span data-ttu-id="8872d-179">Gdy wywoływana jest metoda `Update` dostępu do danych, zauważa, że `SupplierRow` została zmodyfikowana i w związku z tym wysyła polecenie `UPDATE` do bazy danych.</span><span class="sxs-lookup"><span data-stu-id="8872d-179">When the Data Access Layer s `Update` method is called, it sees that the `SupplierRow` has been modified and therefore sends an `UPDATE` command to the database.</span></span>

<span data-ttu-id="8872d-180">Wyobraź sobie, że dodaliśmy kod do tej metody, aby przypisać tylko wartości w polu adres, miasto i kraj, jeśli różnią się one od istniejących wartości `SuppliersRow` s.</span><span class="sxs-lookup"><span data-stu-id="8872d-180">Imagine, however, that we added code to this method to only assign the passed-in address, city, and country values if they differ from the `SuppliersRow` s existing values.</span></span> <span data-ttu-id="8872d-181">W przypadku, gdy adres, miasto i kraj są takie same jak istniejące dane, nie zostaną wprowadzone żadne zmiany, a `SupplierRow` s `RowState` zostaną oznaczone jako niezmienione.</span><span class="sxs-lookup"><span data-stu-id="8872d-181">In the case where the address, city, and country are the same as the existing data, no changes will be made and the `SupplierRow` s `RowState` will be left marked as unchanged.</span></span> <span data-ttu-id="8872d-182">Wynikiem jest fakt, że po wywołaniu metody DAL s `Update` nie zostanie wykonane żadne wywołanie bazy danych, ponieważ `SuppliersRow` nie została zmodyfikowana.</span><span class="sxs-lookup"><span data-stu-id="8872d-182">The net result is that when the DAL s `Update` method is called, no database call will be made because the `SuppliersRow` has not been modified.</span></span>

<span data-ttu-id="8872d-183">Aby przyjąć tę zmianę, Zastąp instrukcje, które nie przypisują wartości adresu zatwierdzono, miasto i kraj z następującym kodem:</span><span class="sxs-lookup"><span data-stu-id="8872d-183">To enact this change, replace the statements that blindly assign the passed-in address, city, and country values with the following code:</span></span>

[!code-csharp[Main](performing-batch-updates-cs/samples/sample6.cs)]

<span data-ttu-id="8872d-184">W tym dodatkowym kodzie Metoda DAL s `Update` wysyła instrukcję `UPDATE` do bazy danych tylko dla tych rekordów, których wartości związane z adresami uległy zmianie.</span><span class="sxs-lookup"><span data-stu-id="8872d-184">With this added code, the DAL s `Update` method sends an `UPDATE` statement to the database for only those records whose address-related values have changed.</span></span>

<span data-ttu-id="8872d-185">Alternatywnie możemy śledzić, czy istnieją różnice między polami adresów zatwierdzono i danymi bazy danych i, jeśli nie ma żadnych, należy po prostu pominąć wywołanie metody DAL s `Update`.</span><span class="sxs-lookup"><span data-stu-id="8872d-185">Alternatively, we could keep track of whether there are any differences between the passed-in address fields and the database data and, if there are none, simply bypass the call to the DAL s `Update` method.</span></span> <span data-ttu-id="8872d-186">Ta metoda działa prawidłowo w przypadku ponownego użycia metody DB Direct, ponieważ metoda DB Direct jest t przekazała wystąpienie `SuppliersRow`, którego `RowState` można sprawdzić w celu ustalenia, czy wywołanie bazy danych jest rzeczywiście potrzebne.</span><span class="sxs-lookup"><span data-stu-id="8872d-186">This approach works well if you re using the DB direct method, since the DB direct method isn t passed a `SuppliersRow` instance whose `RowState` can be checked to determine whether a database call is actually needed.</span></span>

> [!NOTE]
> <span data-ttu-id="8872d-187">Za każdym razem, gdy wywoływana jest metoda `UpdateSupplierAddress`, nastąpi wywołanie do bazy danych w celu pobrania informacji o zaktualizowanym rekordzie.</span><span class="sxs-lookup"><span data-stu-id="8872d-187">Each time the `UpdateSupplierAddress` method is invoked, a call is made to the database to retrieve information about the updated record.</span></span> <span data-ttu-id="8872d-188">Następnie, jeśli istnieją jakiekolwiek zmiany w danych, zostanie wykonane inne wywołanie do bazy danych w celu zaktualizowania wiersza tabeli.</span><span class="sxs-lookup"><span data-stu-id="8872d-188">Then, if there are any changes in data, another call to the database is made to update the table row.</span></span> <span data-ttu-id="8872d-189">Ten przepływ pracy można zoptymalizować przez utworzenie przeciążenia metody `UpdateSupplierAddress`, które akceptuje wystąpienie `EmployeesDataTable`, które zawiera *wszystkie* zmiany ze strony `BatchUpdate.aspx`.</span><span class="sxs-lookup"><span data-stu-id="8872d-189">This workflow could be optimized by creating an `UpdateSupplierAddress` method overload that accepts an `EmployeesDataTable` instance that has *all* of the changes from the `BatchUpdate.aspx` page.</span></span> <span data-ttu-id="8872d-190">Następnie może nawiązać połączenie z bazą danych, aby pobrać wszystkie rekordy z tabeli `Suppliers`.</span><span class="sxs-lookup"><span data-stu-id="8872d-190">Then, it could make one call to the database to get all of the records from the `Suppliers` table.</span></span> <span data-ttu-id="8872d-191">Następnie można wyliczyć te dwa zestawy wyników i można zaktualizować tylko te rekordy, w których wystąpiły zmiany.</span><span class="sxs-lookup"><span data-stu-id="8872d-191">The two resultsets could then be enumerated and only those records where changes have occurred could be updated.</span></span>

## <a name="summary"></a><span data-ttu-id="8872d-192">Podsumowanie</span><span class="sxs-lookup"><span data-stu-id="8872d-192">Summary</span></span>

<span data-ttu-id="8872d-193">W tym samouczku pokazano, jak utworzyć w pełni edytowalną element DataList, umożliwiając użytkownikowi szybkie modyfikowanie informacji o adresie dla wielu dostawców.</span><span class="sxs-lookup"><span data-stu-id="8872d-193">In this tutorial we saw how to create a fully editable DataList, allowing a user to quickly modify the address information for multiple suppliers.</span></span> <span data-ttu-id="8872d-194">Rozpoczęto od zdefiniowania interfejsu edycji kontrolki sieci Web TextBox dla wartości adres dostawcy, miasto i kraj w `ItemTemplate`DataList.</span><span class="sxs-lookup"><span data-stu-id="8872d-194">We started by defining the editing interface a TextBox Web control for the supplier s address, city, and country values in the DataList s `ItemTemplate`.</span></span> <span data-ttu-id="8872d-195">Następnie dodaliśmy opcję Aktualizuj wszystkie przyciski powyżej i poniżej elementu DataList.</span><span class="sxs-lookup"><span data-stu-id="8872d-195">Next, we added Update All buttons above and below the DataList.</span></span> <span data-ttu-id="8872d-196">Po dokonaniu zmian przez użytkownika i kliknięciu jednego z przycisków aktualizacji wszystkie `DataListItem` są wyliczane i zostanie wykonane wywołanie metody `UpdateSupplierAddress` `SuppliersBLL` Class s.</span><span class="sxs-lookup"><span data-stu-id="8872d-196">After a user has made his changes and clicked one of the Update All buttons, the `DataListItem` s are enumerated and a call to the `SuppliersBLL` class s `UpdateSupplierAddress` method is made.</span></span>

<span data-ttu-id="8872d-197">Szczęśliwe programowanie!</span><span class="sxs-lookup"><span data-stu-id="8872d-197">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="8872d-198">Informacje o autorze</span><span class="sxs-lookup"><span data-stu-id="8872d-198">About the Author</span></span>

<span data-ttu-id="8872d-199">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor siedmiu grup ASP/ASP. NET Books i założyciel of [4GuysFromRolla.com](http://www.4guysfromrolla.com), pracował z technologiami sieci Web firmy Microsoft od czasu 1998.</span><span class="sxs-lookup"><span data-stu-id="8872d-199">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="8872d-200">Scott działa jako niezależny konsultant, trainer i składnik zapisywania.</span><span class="sxs-lookup"><span data-stu-id="8872d-200">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="8872d-201">Jego Najnowsza książka to [*Sams ASP.NET 2,0 w ciągu 24 godzin*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="8872d-201">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="8872d-202">Można go osiągnąć w [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="8872d-202">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="8872d-203">lub za pośrednictwem swojego blogu, który można znaleźć w [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="8872d-203">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="8872d-204">Specjalne podziękowania</span><span class="sxs-lookup"><span data-stu-id="8872d-204">Special Thanks To</span></span>

<span data-ttu-id="8872d-205">Ta seria samouczków została sprawdzona przez wielu przydatnych recenzentów.</span><span class="sxs-lookup"><span data-stu-id="8872d-205">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="8872d-206">Recenzenci liderzy dla tego samouczka to Zack Kowalski i Krzysztof Pespisa.</span><span class="sxs-lookup"><span data-stu-id="8872d-206">Lead reviewers for this tutorial were Zack Jones and Ken Pespisa.</span></span> <span data-ttu-id="8872d-207">Chcesz przeglądać moje nadchodzące artykuły MSDN?</span><span class="sxs-lookup"><span data-stu-id="8872d-207">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="8872d-208">Jeśli tak, upuść mi linię w [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="8872d-208">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="8872d-209">[Poprzednie](an-overview-of-editing-and-deleting-data-in-the-datalist-cs.md)
> [dalej](handling-bll-and-dal-level-exceptions-cs.md)</span><span class="sxs-lookup"><span data-stu-id="8872d-209">[Previous](an-overview-of-editing-and-deleting-data-in-the-datalist-cs.md)
[Next](handling-bll-and-dal-level-exceptions-cs.md)</span></span>
