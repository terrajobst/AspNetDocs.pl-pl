---
uid: web-forms/overview/data-access/caching-data/caching-data-in-the-architecture-cs
title: Buforowanie danych w architekturze (C#) | Microsoft Docs
author: rick-anderson
description: W poprzednim samouczku dowiesz się, jak zastosować buforowanie w warstwie prezentacji. W tym samouczku dowiesz się, jak korzystać z naszych warstwowych architectu...
ms.author: riande
ms.date: 05/30/2007
ms.assetid: d29a7c41-0628-4a23-9dfc-bfea9c6c1054
msc.legacyurl: /web-forms/overview/data-access/caching-data/caching-data-in-the-architecture-cs
msc.type: authoredcontent
ms.openlocfilehash: 192cadb8e2f862ac2a97a36b375e247b281ece93
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 03/06/2020
ms.locfileid: "78551171"
---
# <a name="caching-data-in-the-architecture-c"></a><span data-ttu-id="caacc-104">Buforowanie danych w architekturze (C#)</span><span class="sxs-lookup"><span data-stu-id="caacc-104">Caching Data in the Architecture (C#)</span></span>

<span data-ttu-id="caacc-105">przez [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="caacc-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="caacc-106">[Pobierz przykładową aplikację](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_59_CS.exe) lub [Pobierz plik PDF](caching-data-in-the-architecture-cs/_static/datatutorial59cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="caacc-106">[Download Sample App](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_59_CS.exe) or [Download PDF](caching-data-in-the-architecture-cs/_static/datatutorial59cs1.pdf)</span></span>

> <span data-ttu-id="caacc-107">W poprzednim samouczku dowiesz się, jak zastosować buforowanie w warstwie prezentacji.</span><span class="sxs-lookup"><span data-stu-id="caacc-107">In the previous tutorial we learned how to apply caching at the Presentation Layer.</span></span> <span data-ttu-id="caacc-108">W tym samouczku dowiesz się, jak wykorzystać architekturę warstwową do buforowania danych w warstwie logiki biznesowej.</span><span class="sxs-lookup"><span data-stu-id="caacc-108">In this tutorial we learn how to take advantage of our layered architecture to cache data at the Business Logic Layer.</span></span> <span data-ttu-id="caacc-109">Możemy to zrobić, rozszerzając architekturę w celu uwzględnienia warstwy pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="caacc-109">We do this by extending the architecture to include a Caching Layer.</span></span>

## <a name="introduction"></a><span data-ttu-id="caacc-110">Wprowadzenie</span><span class="sxs-lookup"><span data-stu-id="caacc-110">Introduction</span></span>

<span data-ttu-id="caacc-111">Jak zostało to opisane w poprzednim samouczku, buforowanie danych ObjectDataSource s jest tak proste jak ustawienie kilku właściwości.</span><span class="sxs-lookup"><span data-stu-id="caacc-111">As we saw in the preceding tutorial, caching the ObjectDataSource s data is as simple as setting a couple of properties.</span></span> <span data-ttu-id="caacc-112">Niestety, element ObjectDataSource stosuje buforowanie w warstwie prezentacji, co ściśle Couples Zasady buforowania przy użyciu strony ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="caacc-112">Unfortunately, the ObjectDataSource applies caching at the Presentation Layer, which tightly couples the caching policies with the ASP.NET page.</span></span> <span data-ttu-id="caacc-113">Jedną z przyczyn utworzenia architektury warstwowej jest umożliwienie przerwania takich sprzężeń.</span><span class="sxs-lookup"><span data-stu-id="caacc-113">One of the reasons for creating a layered architecture is to allow such couplings to be broken.</span></span> <span data-ttu-id="caacc-114">Warstwa logiki biznesowej na przykład oddziela logikę biznesową od stron ASP.NET, podczas gdy warstwa dostępu do danych oddziela szczegóły dostępu do danych.</span><span class="sxs-lookup"><span data-stu-id="caacc-114">The Business Logic Layer, for instance, decouples the business logic from the ASP.NET pages, while the Data Access Layer decouples the data access details.</span></span> <span data-ttu-id="caacc-115">Takie oddzielenie informacji o logice biznesowej i dostępie do danych jest preferowane w części, ponieważ sprawia, że system jest bardziej czytelny i bardziej elastyczny.</span><span class="sxs-lookup"><span data-stu-id="caacc-115">This decoupling of business logic and data access details is preferred, in part, because it makes the system more readable, more maintainable, and more flexible to change.</span></span> <span data-ttu-id="caacc-116">Pozwala ona również na znajomość domeny i dział robocizny pracujących nad warstwą prezentacji. nie należy znać informacji o szczegółach dotyczących bazy danych w celu wykonania zadania.</span><span class="sxs-lookup"><span data-stu-id="caacc-116">It also allows for domain knowledge and division of labor a developer working on the Presentation Layer doesn t need to be familiar with the database s details in order to do her job.</span></span> <span data-ttu-id="caacc-117">Oddzielenie zasad buforowania od warstwy prezentacji oferuje podobne korzyści.</span><span class="sxs-lookup"><span data-stu-id="caacc-117">Decoupling the caching policy from the Presentation Layer offers similar benefits.</span></span>

<span data-ttu-id="caacc-118">W tym samouczku zostanie wdrożona nasza architektura obejmująca *warstwę pamięci podręcznej* (lub CL dla krótkich), która korzysta z naszych zasad buforowania.</span><span class="sxs-lookup"><span data-stu-id="caacc-118">In this tutorial we will augment our architecture to include a *Caching Layer* (or CL for short) that employs our caching policy.</span></span> <span data-ttu-id="caacc-119">Warstwa buforowania będzie zawierać klasę `ProductsCL`, która zapewnia dostęp do informacji o produkcie przy użyciu metod takich jak `GetProducts()`, `GetProductsByCategoryID(categoryID)`i tak dalej, że po wywołaniu zostanie najpierw podjęta próba pobrania danych z pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="caacc-119">The Caching Layer will include a `ProductsCL` class that provides access to product information with methods like `GetProducts()`, `GetProductsByCategoryID(categoryID)`, and so forth, that, when invoked, will first attempt to retrieve the data from the cache.</span></span> <span data-ttu-id="caacc-120">Jeśli pamięć podręczna jest pusta, te metody spowodują wywołanie odpowiedniej metody `ProductsBLL` w LOGIKI biznesowej, która spowodowałaby pobieranie danych z DAL.</span><span class="sxs-lookup"><span data-stu-id="caacc-120">If the cache is empty, these methods will invoke the appropriate `ProductsBLL` method in the BLL, which would in turn get the data from the DAL.</span></span> <span data-ttu-id="caacc-121">Metody `ProductsCL` buforują dane pobierane z LOGIKI biznesowej przed ich zwróceniem.</span><span class="sxs-lookup"><span data-stu-id="caacc-121">The `ProductsCL` methods cache the data retrieved from the BLL before returning it.</span></span>

<span data-ttu-id="caacc-122">Jak pokazano na rysunku 1, te CL znajdują się między warstwami prezentacji i logiki biznesowej.</span><span class="sxs-lookup"><span data-stu-id="caacc-122">As Figure 1 shows, the CL resides between the Presentation and Business Logic Layers.</span></span>

![Warstwa buforowania (CL) jest kolejną warstwą w naszej architekturze](caching-data-in-the-architecture-cs/_static/image1.png)

<span data-ttu-id="caacc-124">**Rysunek 1**. warstwa buforowania (CL) jest kolejną warstwą w naszej architekturze</span><span class="sxs-lookup"><span data-stu-id="caacc-124">**Figure 1**: The Caching Layer (CL) is Another Layer in Our Architecture</span></span>

## <a name="step-1-creating-the-caching-layer-classes"></a><span data-ttu-id="caacc-125">Krok 1. tworzenie klas warstwy buforowania</span><span class="sxs-lookup"><span data-stu-id="caacc-125">Step 1: Creating the Caching Layer Classes</span></span>

<span data-ttu-id="caacc-126">W tym samouczku utworzymy bardzo proste CL przy użyciu pojedynczej klasy `ProductsCL`, która ma tylko kilku metod.</span><span class="sxs-lookup"><span data-stu-id="caacc-126">In this tutorial we will create a very simple CL with a single class `ProductsCL` that has only a handful of methods.</span></span> <span data-ttu-id="caacc-127">Utworzenie kompletnej warstwy buforowania dla całej aplikacji wymagało utworzenia klas `CategoriesCL`, `EmployeesCL`i `SuppliersCL` oraz zapewnienia metody w tych klasach warstwy buforowania dla każdej metody dostępu do danych lub modyfikacji w LOGIKI biznesowej.</span><span class="sxs-lookup"><span data-stu-id="caacc-127">Building a complete Caching Layer for the entire application would require creating `CategoriesCL`, `EmployeesCL`, and `SuppliersCL` classes, and providing a method in these Caching Layer classes for each data access or modification method in the BLL.</span></span> <span data-ttu-id="caacc-128">Podobnie jak w przypadku LOGIKI biznesowej i DAL, warstwa buforowania powinna zostać zaimplementowana jako oddzielny projekt biblioteki klas. jednak zostanie ona wdrożona jako Klasa w folderze `App_Code`.</span><span class="sxs-lookup"><span data-stu-id="caacc-128">As with the BLL and DAL, the Caching Layer should ideally be implemented as a separate Class Library project; however, we will implement it as a class in the `App_Code` folder.</span></span>

<span data-ttu-id="caacc-129">Aby dokładniej oddzielić klasy CL z klas DAL i LOGIKI biznesowej, pozwól s utworzyć nowy podfolder w folderze `App_Code`.</span><span class="sxs-lookup"><span data-stu-id="caacc-129">To more cleanly separate the CL classes from the DAL and BLL classes, let s create a new subfolder in the `App_Code` folder.</span></span> <span data-ttu-id="caacc-130">Kliknij prawym przyciskiem myszy folder `App_Code` w Eksplorator rozwiązań, wybierz pozycję Nowy folder i nazwij nowy folder `CL`.</span><span class="sxs-lookup"><span data-stu-id="caacc-130">Right-click on the `App_Code` folder in the Solution Explorer, choose New Folder, and name the new folder `CL`.</span></span> <span data-ttu-id="caacc-131">Po utworzeniu tego folderu Dodaj do niego nową klasę o nazwie `ProductsCL.cs`.</span><span class="sxs-lookup"><span data-stu-id="caacc-131">After creating this folder, add to it a new class named `ProductsCL.cs`.</span></span>

![Dodaj nowy folder o nazwie CL i klasę o nazwie ProductsCL.cs](caching-data-in-the-architecture-cs/_static/image2.png)

<span data-ttu-id="caacc-133">**Rysunek 2**. Dodawanie nowego folderu o nazwie `CL` i klasy o nazwie `ProductsCL.cs`</span><span class="sxs-lookup"><span data-stu-id="caacc-133">**Figure 2**: Add a New Folder Named `CL` and a Class Named `ProductsCL.cs`</span></span>

<span data-ttu-id="caacc-134">Klasa `ProductsCL` powinna zawierać ten sam zestaw metod dostępu do danych i modyfikacji, jak znaleziono w odpowiedniej klasie warstwy logiki biznesowej (`ProductsBLL`).</span><span class="sxs-lookup"><span data-stu-id="caacc-134">The `ProductsCL` class should include the same set of data access and modification methods as found in its corresponding Business Logic Layer class (`ProductsBLL`).</span></span> <span data-ttu-id="caacc-135">Zamiast tworzyć wszystkie te metody, pozwól, aby po prostu kompilować kilka tutaj, aby uzyskać wrażenie dla wzorców używanych przez CL.</span><span class="sxs-lookup"><span data-stu-id="caacc-135">Rather than creating all of these methods, let s just build a couple here to get a feel for the patterns used by the CL.</span></span> <span data-ttu-id="caacc-136">W szczególności dodamy metody `GetProducts()` i `GetProductsByCategoryID(categoryID)` w kroku 3 i Przeciążenie `UpdateProduct` w kroku 4.</span><span class="sxs-lookup"><span data-stu-id="caacc-136">In particular, we'll add the `GetProducts()` and `GetProductsByCategoryID(categoryID)` methods in Step 3 and an `UpdateProduct` overload in Step 4.</span></span> <span data-ttu-id="caacc-137">Pozostałe metody `ProductsCL` i `CategoriesCL`, `EmployeesCL`i klasy `SuppliersCL` można dodać na wypoczynek.</span><span class="sxs-lookup"><span data-stu-id="caacc-137">You can add the remaining `ProductsCL` methods and `CategoriesCL`, `EmployeesCL`, and `SuppliersCL` classes at your leisure.</span></span>

## <a name="step-2-reading-and-writing-to-the-data-cache"></a><span data-ttu-id="caacc-138">Krok 2: odczytywanie i zapisywanie w pamięci podręcznej danych</span><span class="sxs-lookup"><span data-stu-id="caacc-138">Step 2: Reading and Writing to the Data Cache</span></span>

<span data-ttu-id="caacc-139">Funkcja buforowania elementu ObjectDataSource w poprzednim samouczku wewnętrznie używa pamięci podręcznej danych ASP.NET do przechowywania danych pobranych z LOGIKI biznesowej.</span><span class="sxs-lookup"><span data-stu-id="caacc-139">The ObjectDataSource caching feature explored in the preceding tutorial internally uses the ASP.NET data cache to store the data retrieved from the BLL.</span></span> <span data-ttu-id="caacc-140">Dostęp do pamięci podręcznej danych można również programistycznie z klas ASP.NETych za pomocą kodu stron lub z klas w architekturze aplikacji sieci Web.</span><span class="sxs-lookup"><span data-stu-id="caacc-140">The data cache can also be accessed programmatically from ASP.NET pages code-behind classes or from the classes in the web application s architecture.</span></span> <span data-ttu-id="caacc-141">Aby odczytywać i zapisywać dane w pamięci podręcznej danych z klasy ASP.NET strony powiązanej z kodem, użyj następującego wzorca:</span><span class="sxs-lookup"><span data-stu-id="caacc-141">To read and write to the data cache from an ASP.NET page s code-behind class, use the following pattern:</span></span>

[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample1.cs)]

<span data-ttu-id="caacc-142">[Metoda`Insert`](https://msdn.microsoft.com/library/system.web.caching.cache.insert.aspx) [`Cache` klasy](https://msdn.microsoft.com/library/system.web.caching.cache.aspx) s ma wiele przeciążeń.</span><span class="sxs-lookup"><span data-stu-id="caacc-142">The [`Cache` class](https://msdn.microsoft.com/library/system.web.caching.cache.aspx) s [`Insert` method](https://msdn.microsoft.com/library/system.web.caching.cache.insert.aspx) has a number of overloads.</span></span> <span data-ttu-id="caacc-143">`Cache["key"] = value` i `Cache.Insert(key, value)` są synonimami i oba dodają element do pamięci podręcznej przy użyciu określonego klucza bez zdefiniowanego wygaśnięcia.</span><span class="sxs-lookup"><span data-stu-id="caacc-143">`Cache["key"] = value` and `Cache.Insert(key, value)` are synonymous and both add an item to the cache using the specified key without a defined expiry.</span></span> <span data-ttu-id="caacc-144">Zazwyczaj chcemy określić wygaśnięcie przy dodawaniu elementu do pamięci podręcznej, w zależności od czasu, lub w obu przypadkach.</span><span class="sxs-lookup"><span data-stu-id="caacc-144">Typically, we want to specify an expiry when adding an item to the cache, either as a dependency, a time-based expiry, or both.</span></span> <span data-ttu-id="caacc-145">Użyj jednego z innych przeciążeń metody `Insert`, aby zapewnić informacje o wygasaniu zależności lub czasu.</span><span class="sxs-lookup"><span data-stu-id="caacc-145">Use one of the other `Insert` method s overloads to provide dependency- or time-based expiry information.</span></span>

<span data-ttu-id="caacc-146">Metody warstwy buforowania muszą najpierw sprawdzić, czy żądane dane znajdują się w pamięci podręcznej, a jeśli tak, należy zwrócić ją z tego miejsca.</span><span class="sxs-lookup"><span data-stu-id="caacc-146">The Caching Layer s methods need to first check if the requested data is in the cache and, if so, return it from there.</span></span> <span data-ttu-id="caacc-147">Jeśli żądane dane nie znajduje się w pamięci podręcznej, należy wywołać odpowiednią metodę LOGIKI biznesowej.</span><span class="sxs-lookup"><span data-stu-id="caacc-147">If the requested data is not in the cache, the appropriate BLL method needs to be invoked.</span></span> <span data-ttu-id="caacc-148">Wartość zwracana powinna być buforowana i zwracana, jak pokazano na poniższym diagramie sekwencji.</span><span class="sxs-lookup"><span data-stu-id="caacc-148">Its return value should be cached and then returned, as the following sequence diagram illustrates.</span></span>

![Metody buforowania warstwy s zwracają dane z pamięci podręcznej, jeśli są dostępne](caching-data-in-the-architecture-cs/_static/image3.png)

<span data-ttu-id="caacc-150">**Rysunek 3**. buforowanie metod warstwy s zwraca dane z pamięci podręcznej, jeśli są dostępne</span><span class="sxs-lookup"><span data-stu-id="caacc-150">**Figure 3**: The Caching Layer s Methods Return Data from the Cache if it s Available</span></span>

<span data-ttu-id="caacc-151">Sekwencja przedstawiony na rysunku 3 jest realizowana w klasach CL przy użyciu następującego wzorca:</span><span class="sxs-lookup"><span data-stu-id="caacc-151">The sequence depicted in Figure 3 is accomplished in the CL classes using the following pattern:</span></span>

[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample2.cs)]

<span data-ttu-id="caacc-152">W tym miejscu *wpisz* typ danych przechowywanych w pamięci podręcznej `Northwind.ProductsDataTable`, na przykład, gdy *klucz* jest kluczem, który jednoznacznie identyfikuje element pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="caacc-152">Here, *Type* is the type of data being stored in the cache `Northwind.ProductsDataTable`, for example while *key* is the key that uniquely identifies the cache item.</span></span> <span data-ttu-id="caacc-153">Jeśli element o określonym *kluczu* nie znajduje się w pamięci podręcznej, *wystąpienie* zostanie `null` i dane zostaną pobrane z odpowiedniej metody logiki biznesowej i dodane do pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="caacc-153">If the item with the specified *key* is not in the cache, then *instance* will be `null` and the data will be retrieved from the appropriate BLL method and added to the cache.</span></span> <span data-ttu-id="caacc-154">Po osiągnięciu czasu `return instance` *wystąpienia* zawiera odwołanie do danych z pamięci podręcznej lub pobrane z logiki biznesowej.</span><span class="sxs-lookup"><span data-stu-id="caacc-154">By the time `return instance` is reached, *instance* contains a reference to the data, either from the cache or pulled from the BLL.</span></span>

<span data-ttu-id="caacc-155">Należy pamiętać, aby użyć powyższego wzorca podczas uzyskiwania dostępu do danych z pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="caacc-155">Be sure to use the above pattern when accessing data from the cache.</span></span> <span data-ttu-id="caacc-156">Poniższy wzorzec, który na pierwszy rzut oka, wygląda jako odpowiednik, zawiera delikatne różnice, które wprowadzają sytuację wyścigu.</span><span class="sxs-lookup"><span data-stu-id="caacc-156">The following pattern, which, at first glance, looks equivalent, contains a subtle difference that introduces a race condition.</span></span> <span data-ttu-id="caacc-157">Sytuacje wyścigu są trudne do debugowania, ponieważ ujawniają się one sporadycznie i trudno je odtworzyć.</span><span class="sxs-lookup"><span data-stu-id="caacc-157">Race conditions are difficult to debug because they reveal themselves sporadically and are difficult to reproduce.</span></span>

[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample3.cs)]

<span data-ttu-id="caacc-158">Różnica w tej sekundzie jest nieprawidłowym fragmentem kodu, który zamiast przechowywania odwołania do pamięci podręcznej w zmiennej lokalnej jest dostęp do pamięci podręcznej danych bezpośrednio w instrukcji warunkowej *i* w `return`.</span><span class="sxs-lookup"><span data-stu-id="caacc-158">The difference in this second, incorrect code snippet is that rather than storing a reference to the cached item in a local variable, the data cache is accessed directly in the conditional statement *and* in the `return`.</span></span> <span data-ttu-id="caacc-159">Załóżmy, że po osiągnięciu tego kodu `Cache["key"]` nie`null`, ale przed osiągnięciem instrukcji `return`, system wyklucza *klucz* z pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="caacc-159">Imagine that when this code is reached, `Cache["key"]` is non-`null`, but before the `return` statement is reached, the system evicts *key* from the cache.</span></span> <span data-ttu-id="caacc-160">W tym rzadkim przypadku kod zwróci wartość `null`, a nie obiekt o oczekiwanym typie.</span><span class="sxs-lookup"><span data-stu-id="caacc-160">In this rare case, the code will return a `null` value rather than an object of the expected type.</span></span>

> [!NOTE]
> <span data-ttu-id="caacc-161">Pamięć podręczna danych jest bezpieczna wątkowo, dlatego nie trzeba synchronizować dostępu do wątków w przypadku prostych odczytów lub zapisów.</span><span class="sxs-lookup"><span data-stu-id="caacc-161">The data cache is thread-safe, so you don t need to synchronize thread access for simple reads or writes.</span></span> <span data-ttu-id="caacc-162">Jeśli jednak trzeba wykonać wiele operacji na danych w pamięci podręcznej, które muszą być niepodzielne, użytkownik jest odpowiedzialny za wdrożenie blokady lub innego mechanizmu w celu zapewnienia bezpieczeństwa wątków.</span><span class="sxs-lookup"><span data-stu-id="caacc-162">However, if you need to perform multiple operations on data in the cache that need to be atomic, you are responsible for implementing a lock or some other mechanism to ensure thread safety.</span></span> <span data-ttu-id="caacc-163">Aby uzyskać więcej informacji [, zobacz Synchronizowanie dostępu do pamięci Podręcznej ASP.NET](http://www.ddj.com/184406369) .</span><span class="sxs-lookup"><span data-stu-id="caacc-163">See [Synchronizing Access to the ASP.NET Cache](http://www.ddj.com/184406369) for more information.</span></span>

<span data-ttu-id="caacc-164">Element może być programowo wykluczony z pamięci podręcznej danych przy użyciu [metody`Remove`](https://msdn.microsoft.com/library/system.web.caching.cache.remove.aspx) , takiej jak:</span><span class="sxs-lookup"><span data-stu-id="caacc-164">An item can be programmatically evicted from the data cache using the [`Remove` method](https://msdn.microsoft.com/library/system.web.caching.cache.remove.aspx) like so:</span></span>

[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample4.cs)]

## <a name="step-3-returning-product-information-from-theproductsclclass"></a><span data-ttu-id="caacc-165">Krok 3. Zwracanie informacji o produkcie z klasy`ProductsCL`</span><span class="sxs-lookup"><span data-stu-id="caacc-165">Step 3: Returning Product Information from the`ProductsCL`Class</span></span>

<span data-ttu-id="caacc-166">W tym samouczku postanowimy zaimplementować dwie metody zwracania informacji o produkcie z klasy `ProductsCL`: `GetProducts()` i `GetProductsByCategoryID(categoryID)`.</span><span class="sxs-lookup"><span data-stu-id="caacc-166">For this tutorial let s implement two methods for returning product information from the `ProductsCL` class: `GetProducts()` and `GetProductsByCategoryID(categoryID)`.</span></span> <span data-ttu-id="caacc-167">Podobnie jak w przypadku klasy `ProductsBL` w warstwie logiki biznesowej, Metoda `GetProducts()` w CL zwraca informacje o wszystkich produktach jako obiekt `Northwind.ProductsDataTable`, podczas gdy `GetProductsByCategoryID(categoryID)` zwraca wszystkie produkty z określonej kategorii.</span><span class="sxs-lookup"><span data-stu-id="caacc-167">Like with the `ProductsBL` class in the Business Logic Layer, the `GetProducts()` method in the CL returns information about all of the products as a `Northwind.ProductsDataTable` object, while `GetProductsByCategoryID(categoryID)` returns all of the products from a specified category.</span></span>

<span data-ttu-id="caacc-168">Poniższy kod przedstawia część metod w klasie `ProductsCL`:</span><span class="sxs-lookup"><span data-stu-id="caacc-168">The following code shows a portion of the methods in the `ProductsCL` class:</span></span>

[!code-vb[Main](caching-data-in-the-architecture-cs/samples/sample5.vb)]

<span data-ttu-id="caacc-169">Najpierw należy zwrócić uwagę na `DataObject` i `DataObjectMethodAttribute` atrybuty zastosowane do klasy i metod.</span><span class="sxs-lookup"><span data-stu-id="caacc-169">First, note the `DataObject` and `DataObjectMethodAttribute` attributes applied to the class and methods.</span></span> <span data-ttu-id="caacc-170">Te atrybuty dostarczają informacje do kreatora ObjectDataSource s wskazujące klasy i metody, które powinny być wyświetlane w krokach kreatora s.</span><span class="sxs-lookup"><span data-stu-id="caacc-170">These attributes provide information to the ObjectDataSource s wizard, indicating what classes and methods should appear in the wizard s steps.</span></span> <span data-ttu-id="caacc-171">Ze względu na to, że metody i klasy CL są dostępne z elementu ObjectDataSource w warstwie prezentacji, te atrybuty zostały dodane w celu zwiększenia środowiska czasu projektowania.</span><span class="sxs-lookup"><span data-stu-id="caacc-171">Since the CL classes and methods will be accessed from an ObjectDataSource in the Presentation Layer, I added these attributes to enhance the design-time experience.</span></span> <span data-ttu-id="caacc-172">Zapoznaj się z powrotem z samouczkiem [Tworzenie warstwy logiki biznesowej](../introduction/creating-a-business-logic-layer-cs.md) , aby uzyskać dokładniejszy opis tych atrybutów i ich efektów.</span><span class="sxs-lookup"><span data-stu-id="caacc-172">Refer back to the [Creating a Business Logic Layer](../introduction/creating-a-business-logic-layer-cs.md) tutorial for a more thorough description on these attributes and their effects.</span></span>

<span data-ttu-id="caacc-173">W metodach `GetProducts()` i `GetProductsByCategoryID(categoryID)` dane zwrócone przez metodę `GetCacheItem(key)` są przypisywane do zmiennej lokalnej.</span><span class="sxs-lookup"><span data-stu-id="caacc-173">In the `GetProducts()` and `GetProductsByCategoryID(categoryID)` methods, the data returned from the `GetCacheItem(key)` method is assigned to a local variable.</span></span> <span data-ttu-id="caacc-174">Metoda `GetCacheItem(key)`, którą sprawdzimy wkrótce, zwraca określony element z pamięci podręcznej na podstawie określonego *klucza*.</span><span class="sxs-lookup"><span data-stu-id="caacc-174">The `GetCacheItem(key)` method, which we'll examine shortly, returns a particular item from the cache based on the specified *key*.</span></span> <span data-ttu-id="caacc-175">Jeśli nie zostaną znalezione takie dane w pamięci podręcznej, zostaną pobrane z odpowiedniej metody klasy `ProductsBLL`, a następnie dodane do pamięci podręcznej przy użyciu metody `AddCacheItem(key, value)`.</span><span class="sxs-lookup"><span data-stu-id="caacc-175">If no such data is found in cache, it is retrieved from the corresponding `ProductsBLL` class method and then added to the cache using the `AddCacheItem(key, value)` method.</span></span>

<span data-ttu-id="caacc-176">Interfejs `GetCacheItem(key)` i `AddCacheItem(key, value)` metody z pamięcią podręczną danych, odczytywanie i zapisywanie odpowiednio wartości.</span><span class="sxs-lookup"><span data-stu-id="caacc-176">The `GetCacheItem(key)` and `AddCacheItem(key, value)` methods interface with the data cache, reading and writing values, respectively.</span></span> <span data-ttu-id="caacc-177">Metoda `GetCacheItem(key)` jest prostszym z dwóch.</span><span class="sxs-lookup"><span data-stu-id="caacc-177">The `GetCacheItem(key)` method is the simpler of the two.</span></span> <span data-ttu-id="caacc-178">Po prostu zwraca wartość z klasy cache przy użyciu *klucza*przekazywania:</span><span class="sxs-lookup"><span data-stu-id="caacc-178">It simply returns the value from the Cache class using the passed-in *key*:</span></span>

[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample6.cs)]

<span data-ttu-id="caacc-179">`GetCacheItem(key)` nie używa wartości *klucza* jako dostarczonej, ale zamiast tego wywołuje metodę `GetCacheKey(key)`, która zwraca *klucz* poprzedzony ProductsCache-.</span><span class="sxs-lookup"><span data-stu-id="caacc-179">`GetCacheItem(key)` does not use *key* value as supplied, but instead calls the `GetCacheKey(key)` method, which returns the *key* prepended with ProductsCache-.</span></span> <span data-ttu-id="caacc-180">`MasterCacheKeyArray`, który zawiera ciąg ProductsCache, jest również używany przez metodę `AddCacheItem(key, value)`, ponieważ zobaczymy chwilę.</span><span class="sxs-lookup"><span data-stu-id="caacc-180">The `MasterCacheKeyArray`, which holds the string ProductsCache, is also used by the `AddCacheItem(key, value)` method, as we'll see momentarily.</span></span>

<span data-ttu-id="caacc-181">W klasie z kodem ASP.NET Page s można uzyskać dostęp do pamięci podręcznej danych przy użyciu [właściwości`Cache`](https://msdn.microsoft.com/library/system.web.ui.page.cache.aspx)klasy `Page` i umożliwia składnię taką jak `Cache["key"] = value`, zgodnie z opisem w kroku 2.</span><span class="sxs-lookup"><span data-stu-id="caacc-181">From an ASP.NET page s code-behind class, the data cache can be accessed using the `Page` class s [`Cache` property](https://msdn.microsoft.com/library/system.web.ui.page.cache.aspx), and allows for syntax like `Cache["key"] = value`, as discussed in Step 2.</span></span> <span data-ttu-id="caacc-182">Z klasy w ramach architektury można uzyskać dostęp do pamięci podręcznej danych przy użyciu `HttpRuntime.Cache` lub `HttpContext.Current.Cache`.</span><span class="sxs-lookup"><span data-stu-id="caacc-182">From a class within the architecture, the data cache can be accessed using either `HttpRuntime.Cache` or `HttpContext.Current.Cache`.</span></span> <span data-ttu-id="caacc-183">Wpis w blogu [Piotr Johnsonem](https://weblogs.asp.net/pjohnson/default.aspx) [HttpRuntime. cache zamiast HttpContext. Current. cache](https://weblogs.asp.net/pjohnson/httpruntime-cache-vs-httpcontext-current-cache) uwagi o nieznacznej wydajności w przypadku używania `HttpRuntime` zamiast `HttpContext.Current`; w związku z tym `ProductsCL` używa `HttpRuntime`.</span><span class="sxs-lookup"><span data-stu-id="caacc-183">[Peter Johnson](https://weblogs.asp.net/pjohnson/default.aspx)'s blog entry [HttpRuntime.Cache vs. HttpContext.Current.Cache](https://weblogs.asp.net/pjohnson/httpruntime-cache-vs-httpcontext-current-cache) notes the slight performance advantage in using `HttpRuntime` instead of `HttpContext.Current`; consequently, `ProductsCL` uses `HttpRuntime`.</span></span>

> [!NOTE]
> <span data-ttu-id="caacc-184">Jeśli architektura jest implementowana przy użyciu projektów biblioteki klas, należy dodać odwołanie do zestawu `System.Web`, aby użyć klas [httpRuntime](https://msdn.microsoft.com/library/system.web.httpruntime.aspx) i [HttpContext](https://msdn.microsoft.com/library/system.web.httpcontext.aspx) .</span><span class="sxs-lookup"><span data-stu-id="caacc-184">If your architecture is implemented using Class Library projects then you will need to add a reference to the `System.Web` assembly in order to use the [HttpRuntime](https://msdn.microsoft.com/library/system.web.httpruntime.aspx) and [HttpContext](https://msdn.microsoft.com/library/system.web.httpcontext.aspx) classes.</span></span>

<span data-ttu-id="caacc-185">Jeśli element nie zostanie znaleziony w pamięci podręcznej, metody `ProductsCL` klasy s pobierają dane z LOGIKI biznesowej i dodają je do pamięci podręcznej przy użyciu metody `AddCacheItem(key, value)`.</span><span class="sxs-lookup"><span data-stu-id="caacc-185">If the item is not found in the cache, the `ProductsCL` class s methods get the data from the BLL and add it to the cache using the `AddCacheItem(key, value)` method.</span></span> <span data-ttu-id="caacc-186">Aby dodać *wartość* do pamięci podręcznej, można użyć poniższego kodu, który korzysta z 60 sekund po upływie limitu czasu:</span><span class="sxs-lookup"><span data-stu-id="caacc-186">To add *value* to the cache we could use the following code, which uses a 60 second time expiry:</span></span>

[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample7.cs)]

<span data-ttu-id="caacc-187">`DateTime.Now.AddSeconds(CacheDuration)` określa czas wygaśnięcia (w sekundach) 60 sekund, podczas gdy [`System.Web.Caching.Cache.NoSlidingExpiration`](https://msdn.microsoft.com/library/system.web.caching.cache.noslidingexpiration(vs.80).aspx) wskazuje, że nie wystąpiło wygaśnięcie.</span><span class="sxs-lookup"><span data-stu-id="caacc-187">`DateTime.Now.AddSeconds(CacheDuration)` specifies the time-based expiry 60 seconds in the future while [`System.Web.Caching.Cache.NoSlidingExpiration`](https://msdn.microsoft.com/library/system.web.caching.cache.noslidingexpiration(vs.80).aspx) indicates that there s no sliding expiration.</span></span> <span data-ttu-id="caacc-188">Chociaż to `Insert` Przeciążenie metody ma parametry wejściowe dla wygaśnięcia bezwzględnego i przesuwania, można podać tylko jeden z nich.</span><span class="sxs-lookup"><span data-stu-id="caacc-188">While this `Insert` method overload has input parameters for both an absolute and sliding expiry, you can only provide one of the two.</span></span> <span data-ttu-id="caacc-189">W przypadku próby określenia czasu bezwzględnego i przedziału czasu Metoda `Insert` zgłosi wyjątek `ArgumentException`.</span><span class="sxs-lookup"><span data-stu-id="caacc-189">If you attempt to specify both an absolute time and a time span, the `Insert` method will throw an `ArgumentException` exception.</span></span>

> [!NOTE]
> <span data-ttu-id="caacc-190">Ta implementacja metody `AddCacheItem(key, value)` aktualnie ma pewne nieprawidłowości.</span><span class="sxs-lookup"><span data-stu-id="caacc-190">This implementation of the `AddCacheItem(key, value)` method currently has some shortcomings.</span></span> <span data-ttu-id="caacc-191">Będziemy nam rozwiązać te problemy i przezwyciężyć je w kroku 4.</span><span class="sxs-lookup"><span data-stu-id="caacc-191">We'll address and overcome these issues in Step 4.</span></span>

## <a name="step-4-invalidating-the-cache-when-the-data-is-modified-through-the-architecture"></a><span data-ttu-id="caacc-192">Krok 4. unieważnienie pamięci podręcznej, gdy dane są modyfikowane za pomocą architektury</span><span class="sxs-lookup"><span data-stu-id="caacc-192">Step 4: Invalidating the Cache When the Data is Modified Through the Architecture</span></span>

<span data-ttu-id="caacc-193">Wraz z metodami pobierania danych warstwa buforowania musi dostarczać te same metody jak LOGIKI biznesowej do wstawiania, aktualizowania i usuwania danych.</span><span class="sxs-lookup"><span data-stu-id="caacc-193">Along with data retrieval methods, the Caching Layer needs to provide the same methods as the BLL for inserting, updating, and deleting data.</span></span> <span data-ttu-id="caacc-194">Metody modyfikacji danych CL s nie modyfikują danych w pamięci podręcznej, ale raczej wywołują odpowiednią metodę modyfikacji danych LOGIKI biznesowej, a następnie unieważnić pamięć podręczną.</span><span class="sxs-lookup"><span data-stu-id="caacc-194">The CL s data modification methods do not modify the cached data, but rather call the BLL s corresponding data modification method and then invalidate the cache.</span></span> <span data-ttu-id="caacc-195">Jak zostało to opisane w poprzednim samouczku, jest to takie samo zachowanie, które element ObjectDataSource ma zastosowanie po włączeniu jego funkcji pamięci podręcznej, a jego metody `Insert`, `Update`lub `Delete` są wywoływane.</span><span class="sxs-lookup"><span data-stu-id="caacc-195">As we saw in the preceding tutorial, this is the same behavior that the ObjectDataSource applies when its caching features are enabled and its `Insert`, `Update`, or `Delete` methods are invoked.</span></span>

<span data-ttu-id="caacc-196">Następujące `UpdateProduct` Przeciążenie ilustruje sposób implementacji metod modyfikacji danych w CL:</span><span class="sxs-lookup"><span data-stu-id="caacc-196">The following `UpdateProduct` overload illustrates how to implement the data modification methods in the CL:</span></span>

[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample8.cs)]

<span data-ttu-id="caacc-197">Odpowiednia metoda warstwy logiki biznesowej modyfikacji danych jest wywoływana, ale przed zwróceniem odpowiedzi musimy unieważnić pamięć podręczną.</span><span class="sxs-lookup"><span data-stu-id="caacc-197">The appropriate data modification Business Logic Layer method is invoked, but before its response is returned we need to invalidate the cache.</span></span> <span data-ttu-id="caacc-198">Niestety, unieważnienie pamięci podręcznej nie jest proste, ponieważ Klasa `ProductsCL` s `GetProducts()` i `GetProductsByCategoryID(categoryID)` metody dodają elementy do pamięci podręcznej z różnymi kluczami, a metoda `GetProductsByCategoryID(categoryID)` dodaje inny element pamięci podręcznej dla każdego unikatowego *IDkategorii*.</span><span class="sxs-lookup"><span data-stu-id="caacc-198">Unfortunately, invalidating the cache is not straightforward because the `ProductsCL` class s `GetProducts()` and `GetProductsByCategoryID(categoryID)` methods each add items to the cache with different keys, and the `GetProductsByCategoryID(categoryID)` method adds a different cache item for each unique *categoryID*.</span></span>

<span data-ttu-id="caacc-199">Podczas unieważniania pamięci podręcznej musimy usunąć *wszystkie* elementy, które mogły zostać dodane przez klasę `ProductsCL`.</span><span class="sxs-lookup"><span data-stu-id="caacc-199">When invalidating the cache, we need to remove *all* of the items that may have been added by the `ProductsCL` class.</span></span> <span data-ttu-id="caacc-200">Można to osiągnąć, kojarząc *zależność pamięci podręcznej* z każdym elementem dodanym do pamięci podręcznej w metodzie `AddCacheItem(key, value)`.</span><span class="sxs-lookup"><span data-stu-id="caacc-200">This can be accomplished by associating a *cache dependency* with the each item added to the cache in the `AddCacheItem(key, value)` method.</span></span> <span data-ttu-id="caacc-201">Ogólnie rzecz biorąc, zależność pamięci podręcznej może być kolejną pozycją w pamięci podręcznej, plikiem w systemie plików lub danymi z bazy danych Microsoft SQL Server.</span><span class="sxs-lookup"><span data-stu-id="caacc-201">In general, a cache dependency can be another item in the cache, a file on the file system, or data from a Microsoft SQL Server database.</span></span> <span data-ttu-id="caacc-202">Gdy zależność ulegnie zmianie lub zostanie usunięta z pamięci podręcznej, elementy pamięci podręcznej, z którą są skojarzone, są automatycznie usuwane z pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="caacc-202">When the dependency changes or is removed from the cache, the cache items it is associated with are automatically evicted from the cache.</span></span> <span data-ttu-id="caacc-203">W tym samouczku chcemy utworzyć dodatkowy element w pamięci podręcznej, który służy jako zależność pamięci podręcznej dla wszystkich elementów dodanych za pomocą klasy `ProductsCL`.</span><span class="sxs-lookup"><span data-stu-id="caacc-203">For this tutorial, we want to create an additional item in the cache that serves as a cache dependency for all items added through the `ProductsCL` class.</span></span> <span data-ttu-id="caacc-204">W ten sposób wszystkie te elementy można usunąć z pamięci podręcznej, po prostu usuwając zależność pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="caacc-204">That way, all of these items can be removed from the cache by simply removing the cache dependency.</span></span>

<span data-ttu-id="caacc-205">Pozwól s zaktualizować metodę `AddCacheItem(key, value)` tak, aby każdy element dodany do pamięci podręcznej za pomocą tej metody został skojarzony z pojedynczą zależnością pamięci podręcznej:</span><span class="sxs-lookup"><span data-stu-id="caacc-205">Let s update the `AddCacheItem(key, value)` method so that each item added to the cache through this method is associated with a single cache dependency:</span></span>

[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample9.cs)]

<span data-ttu-id="caacc-206">`MasterCacheKeyArray` jest tablicą ciągów, która zawiera pojedynczą wartość ProductsCache.</span><span class="sxs-lookup"><span data-stu-id="caacc-206">`MasterCacheKeyArray` is a string array that holds a single value, ProductsCache.</span></span> <span data-ttu-id="caacc-207">Najpierw element pamięci podręcznej jest dodawany do pamięci podręcznej i przypisywany jest bieżącą datę i godzinę.</span><span class="sxs-lookup"><span data-stu-id="caacc-207">First, a cache item is added to the cache and assigned the current date and time.</span></span> <span data-ttu-id="caacc-208">Jeśli element pamięci podręcznej już istnieje, zostanie zaktualizowany.</span><span class="sxs-lookup"><span data-stu-id="caacc-208">If the cache item already exists, it is updated.</span></span> <span data-ttu-id="caacc-209">Następnie zostanie utworzona zależność pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="caacc-209">Next, a cache dependency is created.</span></span> <span data-ttu-id="caacc-210">Konstruktor [`CacheDependency` klasy](https://msdn.microsoft.com/library/system.web.caching.cachedependency(VS.80).aspx) s ma wiele przeciążeń, ale jest on używany w tym miejscu, który oczekuje dwóch `string` danych wejściowych tablicy.</span><span class="sxs-lookup"><span data-stu-id="caacc-210">The [`CacheDependency` class](https://msdn.microsoft.com/library/system.web.caching.cachedependency(VS.80).aspx) s constructor has a number of overloads, but the one being used in here expects two `string` array inputs.</span></span> <span data-ttu-id="caacc-211">Pierwszy z nich określa zestaw plików, które mają być używane jako zależności.</span><span class="sxs-lookup"><span data-stu-id="caacc-211">The first one specifies the set of files to be used as dependencies.</span></span> <span data-ttu-id="caacc-212">Ponieważ nie chcemy używać żadnych zależności opartych na plikach, wartość `null` jest używana jako pierwszy parametr wejściowy.</span><span class="sxs-lookup"><span data-stu-id="caacc-212">Since we don t want to use any file-based dependencies, a value of `null` is used for the first input parameter.</span></span> <span data-ttu-id="caacc-213">Drugi parametr wejściowy określa zestaw kluczy pamięci podręcznej do użycia jako zależności.</span><span class="sxs-lookup"><span data-stu-id="caacc-213">The second input parameter specifies the set of cache keys to use as dependencies.</span></span> <span data-ttu-id="caacc-214">Tutaj określamy nasze pojedyncze zależności, `MasterCacheKeyArray`.</span><span class="sxs-lookup"><span data-stu-id="caacc-214">Here we specify our single dependency, `MasterCacheKeyArray`.</span></span> <span data-ttu-id="caacc-215">`CacheDependency` jest następnie przenoszona do metody `Insert`.</span><span class="sxs-lookup"><span data-stu-id="caacc-215">The `CacheDependency` is then passed into the `Insert` method.</span></span>

<span data-ttu-id="caacc-216">W przypadku tej modyfikacji `AddCacheItem(key, value)`nieprawidłowej pamięci podręcznej jest tak proste jak usuwanie zależności.</span><span class="sxs-lookup"><span data-stu-id="caacc-216">With this modification to `AddCacheItem(key, value)`, invaliding the cache is as simple as removing the dependency.</span></span>

[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample10.cs)]

## <a name="step-5-calling-the-caching-layer-from-the-presentation-layer"></a><span data-ttu-id="caacc-217">Krok 5. wywoływanie warstwy buforowania z warstwy prezentacji</span><span class="sxs-lookup"><span data-stu-id="caacc-217">Step 5: Calling the Caching Layer from the Presentation Layer</span></span>

<span data-ttu-id="caacc-218">Klasy i metody buforowania mogą służyć do pracy z danymi przy użyciu technik, które nie są sprawdzane w tych samouczkach.</span><span class="sxs-lookup"><span data-stu-id="caacc-218">The Caching Layer s classes and methods can be used to work with data using the techniques we ve examined throughout these tutorials.</span></span> <span data-ttu-id="caacc-219">Aby zilustrować pracę z danymi buforowanymi, Zapisz zmiany w klasie `ProductsCL`, a następnie otwórz stronę `FromTheArchitecture.aspx` w folderze `Caching` i Dodaj widok GridView.</span><span class="sxs-lookup"><span data-stu-id="caacc-219">To illustrate working with cached data, save your changes to the `ProductsCL` class and then open the `FromTheArchitecture.aspx` page in the `Caching` folder and add a GridView.</span></span> <span data-ttu-id="caacc-220">W tagu inteligentnym GridView Utwórz nowy element ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="caacc-220">From the GridView s smart tag, create a new ObjectDataSource.</span></span> <span data-ttu-id="caacc-221">W pierwszym kroku kreatora należy zobaczyć klasę `ProductsCL` jako jedną z opcji z listy rozwijanej.</span><span class="sxs-lookup"><span data-stu-id="caacc-221">In the wizard s first step you should see the `ProductsCL` class as one of the options from the drop-down list.</span></span>

<span data-ttu-id="caacc-222">[![Klasa ProductsCL jest uwzględniona na liście rozwijanej obiekt biznesowy](caching-data-in-the-architecture-cs/_static/image5.png)](caching-data-in-the-architecture-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="caacc-222">[![The ProductsCL Class is Included in the Business Object Drop-Down List](caching-data-in-the-architecture-cs/_static/image5.png)](caching-data-in-the-architecture-cs/_static/image4.png)</span></span>

<span data-ttu-id="caacc-223">**Rysunek 4**. Klasa `ProductsCL` jest uwzględniona na liście rozwijanej obiekt biznesowy ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](caching-data-in-the-architecture-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="caacc-223">**Figure 4**: The `ProductsCL` Class is Included in the Business Object Drop-Down List ([Click to view full-size image](caching-data-in-the-architecture-cs/_static/image6.png))</span></span>

<span data-ttu-id="caacc-224">Po wybraniu `ProductsCL`kliknij przycisk Dalej.</span><span class="sxs-lookup"><span data-stu-id="caacc-224">After selecting `ProductsCL`, click Next.</span></span> <span data-ttu-id="caacc-225">Lista rozwijana na karcie Wybierz zawiera dwa elementy — `GetProducts()` i `GetProductsByCategoryID(categoryID)`, a na karcie aktualizacja znajduje się jedyny `UpdateProduct` przeciążenia.</span><span class="sxs-lookup"><span data-stu-id="caacc-225">The drop-down list in the SELECT tab has two items - `GetProducts()` and `GetProductsByCategoryID(categoryID)` and the UPDATE tab has the sole `UpdateProduct` overload.</span></span> <span data-ttu-id="caacc-226">Wybierz metodę `GetProducts()` z karty wybierz i metodę `UpdateProducts` z karty aktualizacja, a następnie kliknij przycisk Zakończ.</span><span class="sxs-lookup"><span data-stu-id="caacc-226">Choose the `GetProducts()` method from the SELECT tab and the `UpdateProducts` method from the UPDATE tab and click Finish.</span></span>

<span data-ttu-id="caacc-227">[![metody klasy s ProductsCL są wyświetlane na listach rozwijanych](caching-data-in-the-architecture-cs/_static/image8.png)](caching-data-in-the-architecture-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="caacc-227">[![The ProductsCL Class s Methods are Listed in the Drop-Down Lists](caching-data-in-the-architecture-cs/_static/image8.png)](caching-data-in-the-architecture-cs/_static/image7.png)</span></span>

<span data-ttu-id="caacc-228">**Rysunek 5**. metody klasy `ProductsCL` s są wymienione na liście rozwijanej ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](caching-data-in-the-architecture-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="caacc-228">**Figure 5**: The `ProductsCL` Class s Methods are Listed in the Drop-Down Lists ([Click to view full-size image](caching-data-in-the-architecture-cs/_static/image9.png))</span></span>

<span data-ttu-id="caacc-229">Po zakończeniu działania kreatora program Visual Studio ustawi właściwość ObjectDataSource s `OldValuesParameterFormatString` na `original_{0}` i doda odpowiednie pola do widoku GridView.</span><span class="sxs-lookup"><span data-stu-id="caacc-229">After completing the wizard, Visual Studio will set the ObjectDataSource s `OldValuesParameterFormatString` property to `original_{0}` and add the appropriate fields to the GridView.</span></span> <span data-ttu-id="caacc-230">Zmień właściwość `OldValuesParameterFormatString` na wartość domyślną, `{0}`i skonfiguruj widok GridView, aby obsługiwał stronicowanie, sortowanie i edytowanie.</span><span class="sxs-lookup"><span data-stu-id="caacc-230">Change the `OldValuesParameterFormatString` property back to its default value, `{0}`, and configure the GridView to support paging, sorting, and editing.</span></span> <span data-ttu-id="caacc-231">Ponieważ Przeciążenie `UploadProducts` używane przez CL akceptuje tylko edytowane nazwy i ceny produktu, należy ograniczyć widok GridView, aby można było edytować tylko te pola.</span><span class="sxs-lookup"><span data-stu-id="caacc-231">Since the `UploadProducts` overload used by the CL accepts only the edited product s name and price, limit the GridView so that only these fields are editable.</span></span>

<span data-ttu-id="caacc-232">W poprzednim samouczku zdefiniowano widok GridView, aby uwzględnić pola `ProductName`, `CategoryName`i `UnitPrice`.</span><span class="sxs-lookup"><span data-stu-id="caacc-232">In the preceding tutorial we defined a GridView to include fields for the `ProductName`, `CategoryName`, and `UnitPrice` fields.</span></span> <span data-ttu-id="caacc-233">Możesz przeprowadzić replikację tego formatowania i struktury, w takim przypadku znaczniki deklaratywne GridView i ObjectDataSource powinny wyglądać podobnie do następujących:</span><span class="sxs-lookup"><span data-stu-id="caacc-233">Feel free to replicate this formatting and structure, in which case your GridView and ObjectDataSource s declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](caching-data-in-the-architecture-cs/samples/sample11.aspx)]

<span data-ttu-id="caacc-234">W tym momencie mamy stronę korzystającą z warstwy buforowania.</span><span class="sxs-lookup"><span data-stu-id="caacc-234">At this point we have a page that uses the Caching Layer.</span></span> <span data-ttu-id="caacc-235">Aby wyświetlić pamięć podręczną w działaniu, ustaw punkty przerwania w metodach `GetProducts()` `ProductsCL` klasy s i `UpdateProduct`.</span><span class="sxs-lookup"><span data-stu-id="caacc-235">To see the cache in action, set breakpoints in the `ProductsCL` class s `GetProducts()` and `UpdateProduct` methods.</span></span> <span data-ttu-id="caacc-236">Odwiedź stronę w przeglądarce i przechodzenie przez kod podczas sortowania i stronicowania, aby wyświetlić dane pobrane z pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="caacc-236">Visit the page in a browser and step through the code when sorting and paging in order to see the data pulled from the cache.</span></span> <span data-ttu-id="caacc-237">Następnie zaktualizuj rekord i zwróć uwagę, że pamięć podręczna jest unieważniona i w związku z tym jest pobierana z LOGIKI biznesowej, gdy dane są ponownie powiązane z elementem GridView.</span><span class="sxs-lookup"><span data-stu-id="caacc-237">Then update a record and note that the cache is invalidated and, consequently, it is retrieved from the BLL when the data is rebound to the GridView.</span></span>

> [!NOTE]
> <span data-ttu-id="caacc-238">Warstwa buforowania podana w tym artykule nie została ukończona.</span><span class="sxs-lookup"><span data-stu-id="caacc-238">The Caching Layer provided in the download accompanying this article is not complete.</span></span> <span data-ttu-id="caacc-239">Zawiera tylko jedną klasę, `ProductsCL`, która tylko sportuje kilku metod.</span><span class="sxs-lookup"><span data-stu-id="caacc-239">It contains only one class, `ProductsCL`, which only sports a handful of methods.</span></span> <span data-ttu-id="caacc-240">Ponadto tylko jedna strona ASP.NET używa CL (`~/Caching/FromTheArchitecture.aspx`) wszystkie inne nadal odwoływać się bezpośrednio do LOGIKI biznesowej.</span><span class="sxs-lookup"><span data-stu-id="caacc-240">Moreover, only a single ASP.NET page uses the CL (`~/Caching/FromTheArchitecture.aspx`) all others still reference the BLL directly.</span></span> <span data-ttu-id="caacc-241">Jeśli planujesz używanie CL w aplikacji, wszystkie wywołania z warstwy prezentacji powinny przechodzić do CL, co wymagałoby, aby klasy i metody CL zostały objęte tymi klasami i metodami w LOGIKI biznesowej aktualnie używanym przez warstwę prezentacji.</span><span class="sxs-lookup"><span data-stu-id="caacc-241">If you plan on using a CL in your application, all calls from the Presentation Layer should go to the CL, which would require that the CL s classes and methods covered those classes and methods in the BLL currently used by the Presentation Layer.</span></span>

## <a name="summary"></a><span data-ttu-id="caacc-242">Podsumowanie</span><span class="sxs-lookup"><span data-stu-id="caacc-242">Summary</span></span>

<span data-ttu-id="caacc-243">Podczas gdy buforowanie może być stosowane w warstwie prezentacji przy użyciu ASP.NET 2,0 s kontrolki SqlDataSource i elementów ObjectDataSource, idealne obowiązki buforowania byłyby delegowane do oddzielnej warstwy w architekturze.</span><span class="sxs-lookup"><span data-stu-id="caacc-243">While caching can be applied at the Presentation Layer with ASP.NET 2.0 s SqlDataSource and ObjectDataSource controls, ideally caching responsibilities would be delegated to a separate layer in the architecture.</span></span> <span data-ttu-id="caacc-244">W tym samouczku utworzyliśmy warstwę pamięci podręcznej, która znajduje się między warstwą prezentacji a warstwą logiki biznesowej.</span><span class="sxs-lookup"><span data-stu-id="caacc-244">In this tutorial we created a Caching Layer that resides between the Presentation Layer and the Business Logic Layer.</span></span> <span data-ttu-id="caacc-245">Warstwa buforowania musi dostarczać ten sam zestaw klas i metod, które istnieją w LOGIKI biznesowej i są wywoływane z warstwy prezentacji.</span><span class="sxs-lookup"><span data-stu-id="caacc-245">The Caching Layer needs to provide the same set of classes and methods that exist in the BLL and are called from the Presentation Layer.</span></span>

<span data-ttu-id="caacc-246">Przykłady w tej warstwie buforowania zostały omówione w tym i poprzednie samouczki zamieszczono z *wyprzedzeniem*.</span><span class="sxs-lookup"><span data-stu-id="caacc-246">The Caching Layer examples we explored in this and the preceding tutorials exhibited *reactive loading*.</span></span> <span data-ttu-id="caacc-247">W przypadku ponownego ładowania dane są ładowane do pamięci podręcznej tylko wtedy, gdy jest wykonywane żądanie dotyczące danych i brakuje w niej danych.</span><span class="sxs-lookup"><span data-stu-id="caacc-247">With reactive loading, the data is loaded into the cache only when a request for the data is made and that data is missing from the cache.</span></span> <span data-ttu-id="caacc-248">Dane można także *aktywnie ładować* do pamięci podręcznej, a technika ładująca dane do pamięci podręcznej, zanim będzie ona faktycznie wymagana.</span><span class="sxs-lookup"><span data-stu-id="caacc-248">Data can also be *proactively loaded* into the cache, a technique that loads the data into the cache before it is actually needed.</span></span> <span data-ttu-id="caacc-249">W następnym samouczku zobaczymy przykład aktywnego ładowania, gdy zobaczymy, jak przechowywać wartości statyczne w pamięci podręcznej podczas uruchamiania aplikacji.</span><span class="sxs-lookup"><span data-stu-id="caacc-249">In the next tutorial we'll see an example of proactive loading when we look at how to store static values into the cache at application startup.</span></span>

<span data-ttu-id="caacc-250">Szczęśliwe programowanie!</span><span class="sxs-lookup"><span data-stu-id="caacc-250">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="caacc-251">Informacje o autorze</span><span class="sxs-lookup"><span data-stu-id="caacc-251">About the Author</span></span>

<span data-ttu-id="caacc-252">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor siedmiu grup ASP/ASP. NET Books i założyciel of [4GuysFromRolla.com](http://www.4guysfromrolla.com), pracował z technologiami sieci Web firmy Microsoft od czasu 1998.</span><span class="sxs-lookup"><span data-stu-id="caacc-252">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="caacc-253">Scott działa jako niezależny konsultant, trainer i składnik zapisywania.</span><span class="sxs-lookup"><span data-stu-id="caacc-253">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="caacc-254">Jego Najnowsza książka to [*Sams ASP.NET 2,0 w ciągu 24 godzin*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="caacc-254">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="caacc-255">Można go osiągnąć w [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="caacc-255">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="caacc-256">lub za pośrednictwem swojego blogu, który można znaleźć w [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="caacc-256">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="caacc-257">Specjalne podziękowania</span><span class="sxs-lookup"><span data-stu-id="caacc-257">Special Thanks To</span></span>

<span data-ttu-id="caacc-258">Ta seria samouczków została sprawdzona przez wielu przydatnych recenzentów.</span><span class="sxs-lookup"><span data-stu-id="caacc-258">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="caacc-259">Recenzent potencjalnych klientów dla tego samouczka został Teresa Murph.</span><span class="sxs-lookup"><span data-stu-id="caacc-259">Lead reviewer for this tutorial was Teresa Murph.</span></span> <span data-ttu-id="caacc-260">Chcesz przeglądać moje nadchodzące artykuły MSDN?</span><span class="sxs-lookup"><span data-stu-id="caacc-260">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="caacc-261">Jeśli tak, upuść mi linię w [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="caacc-261">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="caacc-262">[Poprzednie](caching-data-with-the-objectdatasource-cs.md)
> [dalej](caching-data-at-application-startup-cs.md)</span><span class="sxs-lookup"><span data-stu-id="caacc-262">[Previous](caching-data-with-the-objectdatasource-cs.md)
[Next](caching-data-at-application-startup-cs.md)</span></span>
