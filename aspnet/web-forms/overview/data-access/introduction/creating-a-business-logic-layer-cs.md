---
uid: web-forms/overview/data-access/introduction/creating-a-business-logic-layer-cs
title: Tworzenie warstwy logiki biznesowej (C#) | Microsoft Docs
author: rick-anderson
description: W tym samouczku dowiesz się, jak scentralizować reguły biznesowe do warstwy logiki biznesowej (LOGIKI biznesowej), która służy jako pośrednik do wymiany danych między t...
ms.author: riande
ms.date: 03/31/2010
ms.assetid: 85554606-47cb-4e4f-9848-eed9da579056
msc.legacyurl: /web-forms/overview/data-access/introduction/creating-a-business-logic-layer-cs
msc.type: authoredcontent
ms.openlocfilehash: df96f3e7422a0537bf1b003a33fe8d71a671ac33
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 03/06/2020
ms.locfileid: "78605624"
---
# <a name="creating-a-business-logic-layer-c"></a><span data-ttu-id="8a837-103">Tworzenie warstwy logiki biznesowej (C#)</span><span class="sxs-lookup"><span data-stu-id="8a837-103">Creating a Business Logic Layer (C#)</span></span>

<span data-ttu-id="8a837-104">przez [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="8a837-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="8a837-105">[Pobierz przykładową aplikację](https://download.microsoft.com/download/4/6/3/463cf87c-4724-4cbc-b7b5-3f866f43ba50/ASPNET_Data_Tutorial_2_CS.exe) lub [Pobierz plik PDF](creating-a-business-logic-layer-cs/_static/datatutorial02cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="8a837-105">[Download Sample App](https://download.microsoft.com/download/4/6/3/463cf87c-4724-4cbc-b7b5-3f866f43ba50/ASPNET_Data_Tutorial_2_CS.exe) or [Download PDF](creating-a-business-logic-layer-cs/_static/datatutorial02cs1.pdf)</span></span>

> <span data-ttu-id="8a837-106">W tym samouczku dowiesz się, jak scentralizować reguły biznesowe do warstwy logiki biznesowej (LOGIKI biznesowej), która służy jako pośrednik do wymiany danych między warstwą prezentacji a DALą.</span><span class="sxs-lookup"><span data-stu-id="8a837-106">In this tutorial we'll see how to centralize your business rules into a Business Logic Layer (BLL) that serves as an intermediary for data exchange between the presentation layer and the DAL.</span></span>

## <a name="introduction"></a><span data-ttu-id="8a837-107">Wprowadzenie</span><span class="sxs-lookup"><span data-stu-id="8a837-107">Introduction</span></span>

<span data-ttu-id="8a837-108">Warstwa dostępu do danych (DAL) utworzona w [pierwszym samouczku](creating-a-data-access-layer-cs.md) czyści logikę dostępu do danych z logiki prezentacji.</span><span class="sxs-lookup"><span data-stu-id="8a837-108">The Data Access Layer (DAL) created in the [first tutorial](creating-a-data-access-layer-cs.md) cleanly separates the data access logic from the presentation logic.</span></span> <span data-ttu-id="8a837-109">Jednak mimo że DAL czyści szczegóły dostępu do danych z warstwy prezentacji, nie wymusza żadnych reguł firmy, które mogą być stosowane.</span><span class="sxs-lookup"><span data-stu-id="8a837-109">However, while the DAL cleanly separates the data access details from the presentation layer, it does not enforce any business rules that may apply.</span></span> <span data-ttu-id="8a837-110">Na przykład w przypadku naszej aplikacji możemy chcieć zmodyfikować pola `CategoryID` lub `SupplierID` tabeli `Products`, gdy pole `Discontinued` jest ustawione na 1, lub możemy wymusić zasady starszeństwa, uniemożliwiając sytuacje, w których pracownik jest zarządzany przez kogoś, kto go zazatrudniał.</span><span class="sxs-lookup"><span data-stu-id="8a837-110">For example, for our application we may want to disallow the `CategoryID` or `SupplierID` fields of the `Products` table to be modified when the `Discontinued` field is set to 1, or we might want to enforce seniority rules, prohibiting situations in which an employee is managed by someone who was hired after them.</span></span> <span data-ttu-id="8a837-111">Innym typowym scenariuszem jest autoryzacja, co może spowodować, że tylko użytkownicy w danej roli mogą usuwać produkty lub zmieniać wartość `UnitPrice`.</span><span class="sxs-lookup"><span data-stu-id="8a837-111">Another common scenario is authorization perhaps only users in a particular role can delete products or can change the `UnitPrice` value.</span></span>

<span data-ttu-id="8a837-112">W tym samouczku dowiesz się, jak scentralizować te reguły biznesowe do warstwy logiki biznesowej (LOGIKI biznesowej), która służy jako pośrednik do wymiany danych między warstwą prezentacji a DALą.</span><span class="sxs-lookup"><span data-stu-id="8a837-112">In this tutorial we'll see how to centralize these business rules into a Business Logic Layer (BLL) that serves as an intermediary for data exchange between the presentation layer and the DAL.</span></span> <span data-ttu-id="8a837-113">W świecie rzeczywistym LOGIKI biznesowej powinien być zaimplementowany jako oddzielny projekt biblioteki klas. Jednak dla tych samouczków będziemy implementować LOGIKI biznesowej jako serię klas w naszym folderze `App_Code`, aby uprościć strukturę projektu.</span><span class="sxs-lookup"><span data-stu-id="8a837-113">In a real-world application, the BLL should be implemented as a separate Class Library project; however, for these tutorials we'll implement the BLL as a series of classes in our `App_Code` folder in order to simplify the project structure.</span></span> <span data-ttu-id="8a837-114">Rysunek 1 ilustruje relacje architektury między warstwą prezentacji, LOGIKI biznesowej i DAL.</span><span class="sxs-lookup"><span data-stu-id="8a837-114">Figure 1 illustrates the architectural relationships among the presentation layer, BLL, and DAL.</span></span>

![LOGIKI biznesowej oddziela warstwę prezentacji od warstwy dostępu do danych i nakłada reguły biznesowe](creating-a-business-logic-layer-cs/_static/image1.png)

<span data-ttu-id="8a837-116">**Rysunek 1**. logiki biznesowej oddziela warstwę prezentacji od warstwy dostępu do danych i nakłada reguły biznesowe</span><span class="sxs-lookup"><span data-stu-id="8a837-116">**Figure 1**: The BLL Separates the Presentation Layer from the Data Access Layer and Imposes Business Rules</span></span>

## <a name="step-1-creating-the-bll-classes"></a><span data-ttu-id="8a837-117">Krok 1. tworzenie klas LOGIKI biznesowej</span><span class="sxs-lookup"><span data-stu-id="8a837-117">Step 1: Creating the BLL Classes</span></span>

<span data-ttu-id="8a837-118">Nasza LOGIKI biznesowej będzie złożona z czterech klas, jednej dla każdej TableAdapter w DAL; Każda z tych klas LOGIKI biznesowej będzie miała metody pobierania, wstawiania, aktualizowania i usuwania z odpowiednich TableAdapter w DAL, stosując odpowiednie reguły biznesowe.</span><span class="sxs-lookup"><span data-stu-id="8a837-118">Our BLL will be composed of four classes, one for each TableAdapter in the DAL; each of these BLL classes will have methods for retrieving, inserting, updating, and deleting from the respective TableAdapter in the DAL, applying the appropriate business rules.</span></span>

<span data-ttu-id="8a837-119">Aby dokładniej oddzielić klasy powiązane z DAL i LOGIKI biznesowej, Utwórzmy dwa podfoldery w folderze `App_Code`, `DAL` i `BLL`.</span><span class="sxs-lookup"><span data-stu-id="8a837-119">To more cleanly separate the DAL- and BLL-related classes, let's create two subfolders in the `App_Code` folder, `DAL` and `BLL`.</span></span> <span data-ttu-id="8a837-120">Po prostu kliknij prawym przyciskiem myszy folder `App_Code` w Eksplorator rozwiązań i wybierz pozycję Nowy folder.</span><span class="sxs-lookup"><span data-stu-id="8a837-120">Simply right-click on the `App_Code` folder in the Solution Explorer and choose New Folder.</span></span> <span data-ttu-id="8a837-121">Po utworzeniu tych dwóch folderów Przenieś określony zestaw danych utworzony w pierwszym samouczku do podfolderu `DAL`.</span><span class="sxs-lookup"><span data-stu-id="8a837-121">After creating these two folders, move the Typed DataSet created in the first tutorial into the `DAL` subfolder.</span></span>

<span data-ttu-id="8a837-122">Następnie utwórz cztery pliki klas LOGIKI biznesowej w podfolderze `BLL`.</span><span class="sxs-lookup"><span data-stu-id="8a837-122">Next, create the four BLL class files in the `BLL` subfolder.</span></span> <span data-ttu-id="8a837-123">Aby to osiągnąć, kliknij prawym przyciskiem myszy podfolder `BLL`, wybierz polecenie Dodaj nowy element i wybierz szablon klasy.</span><span class="sxs-lookup"><span data-stu-id="8a837-123">To accomplish this, right-click on the `BLL` subfolder, choose Add a New Item, and choose the Class template.</span></span> <span data-ttu-id="8a837-124">Nazwij cztery klasy `ProductsBLL`, `CategoriesBLL`, `SuppliersBLL`i `EmployeesBLL`.</span><span class="sxs-lookup"><span data-stu-id="8a837-124">Name the four classes `ProductsBLL`, `CategoriesBLL`, `SuppliersBLL`, and `EmployeesBLL`.</span></span>

![Dodaj cztery nowe klasy do folderu App_Code](creating-a-business-logic-layer-cs/_static/image2.png)

<span data-ttu-id="8a837-126">**Rysunek 2**. Dodawanie czterech nowych klas do folderu `App_Code`</span><span class="sxs-lookup"><span data-stu-id="8a837-126">**Figure 2**: Add Four New Classes to the `App_Code` Folder</span></span>

<span data-ttu-id="8a837-127">Następnie Dodajmy metody do poszczególnych klas, aby po prostu otoczyć metody zdefiniowane dla TableAdapters z pierwszego samouczka.</span><span class="sxs-lookup"><span data-stu-id="8a837-127">Next, let's add methods to each of the classes to simply wrap the methods defined for the TableAdapters from the first tutorial.</span></span> <span data-ttu-id="8a837-128">Teraz te metody przywołują się bezpośrednio do DAL; będziemy później wrócić do dodania dowolnej wymaganej logiki biznesowej.</span><span class="sxs-lookup"><span data-stu-id="8a837-128">For now, these methods will just call directly into the DAL; we'll return later to add any needed business logic.</span></span>

> [!NOTE]
> <span data-ttu-id="8a837-129">Jeśli używasz programu Visual Studio w wersji Standard lub nowszej (to oznacza, że *nie* używasz programu Visual Web Developer), możesz opcjonalnie projektować klasy wizualnie przy użyciu [Projektant klas](https://msdn.microsoft.com/library/default.asp?url=/library/dv_vstechart/html/clssdsgnr.asp).</span><span class="sxs-lookup"><span data-stu-id="8a837-129">If you are using Visual Studio Standard Edition or above (that is, you're *not* using Visual Web Developer), you can optionally design your classes visually using the [Class Designer](https://msdn.microsoft.com/library/default.asp?url=/library/dv_vstechart/html/clssdsgnr.asp).</span></span> <span data-ttu-id="8a837-130">Zapoznaj się z [blogiem Projektant klas](https://blogs.msdn.com/classdesigner/default.aspx) , aby uzyskać więcej informacji na temat tej nowej funkcji w programie Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="8a837-130">Refer to the [Class Designer Blog](https://blogs.msdn.com/classdesigner/default.aspx) for more information on this new feature in Visual Studio.</span></span>

<span data-ttu-id="8a837-131">Dla klasy `ProductsBLL` musimy dodać łącznie siedem metod:</span><span class="sxs-lookup"><span data-stu-id="8a837-131">For the `ProductsBLL` class we need to add a total of seven methods:</span></span>

- <span data-ttu-id="8a837-132">`GetProducts()` zwraca wszystkie produkty</span><span class="sxs-lookup"><span data-stu-id="8a837-132">`GetProducts()` returns all products</span></span>
- <span data-ttu-id="8a837-133">`GetProductByProductID(productID)` zwraca produkt o określonym IDENTYFIKATORze produktu</span><span class="sxs-lookup"><span data-stu-id="8a837-133">`GetProductByProductID(productID)` returns the product with the specified product ID</span></span>
- <span data-ttu-id="8a837-134">`GetProductsByCategoryID(categoryID)` zwraca wszystkie produkty z określonej kategorii</span><span class="sxs-lookup"><span data-stu-id="8a837-134">`GetProductsByCategoryID(categoryID)` returns all products from the specified category</span></span>
- <span data-ttu-id="8a837-135">`GetProductsBySupplier(supplierID)` zwraca wszystkie produkty z określonego dostawcy</span><span class="sxs-lookup"><span data-stu-id="8a837-135">`GetProductsBySupplier(supplierID)` returns all products from the specified supplier</span></span>
- <span data-ttu-id="8a837-136">`AddProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued)` wstawia nowy produkt do bazy danych przy użyciu wartości przekazywania; Zwraca wartość `ProductID` nowo wstawionego rekordu.</span><span class="sxs-lookup"><span data-stu-id="8a837-136">`AddProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued)` inserts a new product into the database using the values passed-in; returns the `ProductID` value of the newly inserted record</span></span>
- <span data-ttu-id="8a837-137">`UpdateProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued, productID)` aktualizuje istniejący produkt w bazie danych przy użyciu wartości przekazywania; zwraca `true`, jeśli dokładnie jeden wiersz został zaktualizowany, `false` w przeciwnym razie</span><span class="sxs-lookup"><span data-stu-id="8a837-137">`UpdateProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued, productID)` updates an existing product in the database using the passed-in values; returns `true` if precisely one row was updated, `false` otherwise</span></span>
- <span data-ttu-id="8a837-138">`DeleteProduct(productID)` usuwa określony produkt z bazy danych</span><span class="sxs-lookup"><span data-stu-id="8a837-138">`DeleteProduct(productID)` deletes the specified product from the database</span></span>

<span data-ttu-id="8a837-139">ProductsBLL.cs</span><span class="sxs-lookup"><span data-stu-id="8a837-139">ProductsBLL.cs</span></span>

[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample1.cs)]

<span data-ttu-id="8a837-140">Metody, które po prostu zwracają dane `GetProducts`, `GetProductByProductID`, `GetProductsByCategoryID`i `GetProductBySuppliersID` są dość proste, ponieważ po prostu wywołują się do DAL.</span><span class="sxs-lookup"><span data-stu-id="8a837-140">The methods that simply return data `GetProducts`, `GetProductByProductID`, `GetProductsByCategoryID`, and `GetProductBySuppliersID` are fairly straightforward as they simply call down into the DAL.</span></span> <span data-ttu-id="8a837-141">W niektórych scenariuszach mogą istnieć reguły biznesowe, które muszą być wdrożone na tym poziomie (na przykład reguły autoryzacji oparte na aktualnie zalogowanym użytkowniku lub roli, do której należy użytkownik). po prostu te metody będą opuszczane.</span><span class="sxs-lookup"><span data-stu-id="8a837-141">While in some scenarios there may be business rules that need to be implemented at this level (such as authorization rules based on the currently logged on user or the role to which the user belongs), we'll simply leave these methods as-is.</span></span> <span data-ttu-id="8a837-142">W przypadku tych metod LOGIKI biznesowej służy tylko jako serwer proxy, za pośrednictwem którego warstwa prezentacji uzyskuje dostęp do danych źródłowych z warstwy dostępu do danych.</span><span class="sxs-lookup"><span data-stu-id="8a837-142">For these methods, then, the BLL serves merely as a proxy through which the presentation layer accesses the underlying data from the Data Access Layer.</span></span>

<span data-ttu-id="8a837-143">Metody `AddProduct` i `UpdateProduct` przyjmują jako parametry wartości dla różnych pól produktu i dodają nowy produkt lub aktualizują odpowiednio istniejący.</span><span class="sxs-lookup"><span data-stu-id="8a837-143">The `AddProduct` and `UpdateProduct` methods both take in as parameters the values for the various product fields and add a new product or update an existing one, respectively.</span></span> <span data-ttu-id="8a837-144">Ponieważ wiele kolumn tabeli `Product` może przyjmować wartości `NULL` (`CategoryID`, `SupplierID`i `UnitPrice`, aby nazwać kilka), te parametry wejściowe dla `AddProduct` i `UpdateProduct` mapowane na takie kolumny używają [typów dopuszczających wartość null](https://msdn.microsoft.com/library/1t3y8s4s(v=vs.80).aspx).</span><span class="sxs-lookup"><span data-stu-id="8a837-144">Since many of the `Product` table's columns can accept `NULL` values (`CategoryID`, `SupplierID`, and `UnitPrice`, to name a few), those input parameters for `AddProduct` and `UpdateProduct` that map to such columns use [nullable types](https://msdn.microsoft.com/library/1t3y8s4s(v=vs.80).aspx).</span></span> <span data-ttu-id="8a837-145">Typy dopuszczające wartość null są nowe w programie .NET 2,0 i zapewniają technikę wskazującą, czy typ wartości powinien być `null`.</span><span class="sxs-lookup"><span data-stu-id="8a837-145">Nullable types are new to .NET 2.0 and provide a technique for indicating whether a value type should, instead, be `null`.</span></span> <span data-ttu-id="8a837-146">W C# obszarze można oflagować typ wartości jako typ dopuszczający wartość null poprzez dodanie `?` po typie (na przykład `int? x;`).</span><span class="sxs-lookup"><span data-stu-id="8a837-146">In C# you can flag a value type as a nullable type by adding `?` after the type (like `int? x;`).</span></span> <span data-ttu-id="8a837-147">Aby uzyskać więcej informacji, zapoznaj się z sekcją [Typy dopuszczające wartość null](https://msdn.microsoft.com/library/1t3y8s4s.aspx) w [ C# przewodniku programowania](https://msdn.microsoft.com/library/67ef8sbd%28VS.80%29.aspx) .</span><span class="sxs-lookup"><span data-stu-id="8a837-147">Refer to the [Nullable Types](https://msdn.microsoft.com/library/1t3y8s4s.aspx) section in the [C# Programming Guide](https://msdn.microsoft.com/library/67ef8sbd%28VS.80%29.aspx) for more information.</span></span>

<span data-ttu-id="8a837-148">Wszystkie trzy metody zwracają wartość logiczną wskazującą, czy wiersz został wstawiony, zaktualizowany lub usunięty, ponieważ operacja może nie skutkować odpowiednim wierszem.</span><span class="sxs-lookup"><span data-stu-id="8a837-148">All three methods return a Boolean value indicating whether a row was inserted, updated, or deleted since the operation may not result in an affected row.</span></span> <span data-ttu-id="8a837-149">Na przykład, jeśli programista strony wywoła `DeleteProduct` przekazywanie `ProductID` dla nieistniejącego produktu, instrukcja `DELETE` wystawiona dla bazy danych nie będzie miała znaczenia i w związku z tym Metoda `DeleteProduct` zwróci `false`.</span><span class="sxs-lookup"><span data-stu-id="8a837-149">For example, if the page developer calls `DeleteProduct` passing in a `ProductID` for a non-existent product, the `DELETE` statement issued to the database will have no affect and therefore the `DeleteProduct` method will return `false`.</span></span>

<span data-ttu-id="8a837-150">Należy pamiętać, że podczas dodawania nowego produktu lub aktualizowania istniejącej wartości pola nowe lub zmodyfikowane produkt jako listę skalarnych zamiast akceptować wystąpienie `ProductsRow`.</span><span class="sxs-lookup"><span data-stu-id="8a837-150">Note that when adding a new product or updating an existing one we take in the new or modified product's field values as a list of scalars as opposed to accepting a `ProductsRow` instance.</span></span> <span data-ttu-id="8a837-151">Ta metoda została wybrana, ponieważ Klasa `ProductsRow` dziedziczy z klasy `DataRow` ADO.NET, która nie ma domyślnego konstruktora bez parametrów.</span><span class="sxs-lookup"><span data-stu-id="8a837-151">This approach was chosen because the `ProductsRow` class derives from the ADO.NET `DataRow` class, which doesn't have a default parameterless constructor.</span></span> <span data-ttu-id="8a837-152">Aby można było utworzyć nowe wystąpienie `ProductsRow`, należy najpierw utworzyć wystąpienie `ProductsDataTable`, a następnie wywołać jego metodę `NewProductRow()` (którą będziemy w `AddProduct`).</span><span class="sxs-lookup"><span data-stu-id="8a837-152">In order to create a new `ProductsRow` instance, we must first create a `ProductsDataTable` instance and then invoke its `NewProductRow()` method (which we do in `AddProduct`).</span></span> <span data-ttu-id="8a837-153">To Nieto przede wszystkim, gdy będziemy wstawiać i aktualizować produkty przy użyciu elementu ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="8a837-153">This shortcoming rears its head when we turn to inserting and updating products using the ObjectDataSource.</span></span> <span data-ttu-id="8a837-154">W końcu element ObjectDataSource podejmie próbę utworzenia wystąpienia parametrów wejściowych.</span><span class="sxs-lookup"><span data-stu-id="8a837-154">In short, the ObjectDataSource will try to create an instance of the input parameters.</span></span> <span data-ttu-id="8a837-155">Jeśli metoda LOGIKI biznesowej oczekuje wystąpienia `ProductsRow`, element ObjectDataSource podejmie próbę utworzenia jednego, ale kończy się niepowodzeniem z powodu braku domyślnego konstruktora bez parametrów.</span><span class="sxs-lookup"><span data-stu-id="8a837-155">If the BLL method expects a `ProductsRow` instance, the ObjectDataSource will try to create one, but fail due to the lack of a default parameterless constructor.</span></span> <span data-ttu-id="8a837-156">Aby uzyskać więcej informacji na temat tego problemu, zapoznaj się z poniższymi wpisami forów ASP.NET: [aktualizowaniem obiektów ObjectDataSource z zestawami danych z jednoznacznie określonymi typami](https://forums.asp.net/1098630/ShowPost.aspx)i [problemem przy użyciu elementu ObjectDataSource i jednoznacznie określonego typu](https://forums.asp.net/1048212/ShowPost.aspx).</span><span class="sxs-lookup"><span data-stu-id="8a837-156">For more information on this problem, refer to the following two ASP.NET Forums posts: [Updating ObjectDataSources with Strongly-Typed DataSets](https://forums.asp.net/1098630/ShowPost.aspx), and [Problem With ObjectDataSource and Strongly-Typed DataSet](https://forums.asp.net/1048212/ShowPost.aspx).</span></span>

<span data-ttu-id="8a837-157">Następnie w obu `AddProduct` i `UpdateProduct`kod tworzy wystąpienie `ProductsRow` i wypełnia je przekazaniem wartości.</span><span class="sxs-lookup"><span data-stu-id="8a837-157">Next, in both `AddProduct` and `UpdateProduct`, the code creates a `ProductsRow` instance and populates it with the values just passed in.</span></span> <span data-ttu-id="8a837-158">Podczas przypisywania wartości do DataColumns obiektu DataRow mogą wystąpić różne sprawdzenia poprawności na poziomie pola.</span><span class="sxs-lookup"><span data-stu-id="8a837-158">When assigning values to DataColumns of a DataRow various field-level validation checks can occur.</span></span> <span data-ttu-id="8a837-159">W związku z tym ręczne wprowadzanie wartości z powrotem do obiektu DataRow pozwala upewnić się, że dane są przesyłane do metody LOGIKI biznesowej.</span><span class="sxs-lookup"><span data-stu-id="8a837-159">Therefore, manually putting the passed in values back into a DataRow helps ensure the validity of the data being passed to the BLL method.</span></span> <span data-ttu-id="8a837-160">Niestety klasy DataRow o jednoznacznie określonym typie wygenerowane przez program Visual Studio nie używają typów dopuszczających wartość null.</span><span class="sxs-lookup"><span data-stu-id="8a837-160">Unfortunately the strongly-typed DataRow classes generated by Visual Studio do not use nullable types.</span></span> <span data-ttu-id="8a837-161">Zamiast tego, aby wskazać, że określona kolumna danych w elemencie DataRow powinna odpowiadać wartości `NULL` Database, należy użyć metody `SetColumnNameNull()`.</span><span class="sxs-lookup"><span data-stu-id="8a837-161">Rather, to indicate that a particular DataColumn in a DataRow should correspond to a `NULL` database value we must use the `SetColumnNameNull()` method.</span></span>

<span data-ttu-id="8a837-162">W `UpdateProduct` najpierw załadujemy produkt do aktualizacji przy użyciu `GetProductByProductID(productID)`.</span><span class="sxs-lookup"><span data-stu-id="8a837-162">In `UpdateProduct` we first load in the product to update using `GetProductByProductID(productID)`.</span></span> <span data-ttu-id="8a837-163">Chociaż może się to okazać niepotrzebnym wyjazdem bazy danych, ta dodatkowa podróż będzie wartościowa w przyszłych samouczkach, które eksplorują współbieżność optymistyczną.</span><span class="sxs-lookup"><span data-stu-id="8a837-163">While this may seem like an unnecessary trip to the database, this extra trip will prove worthwhile in future tutorials that explore optimistic concurrency.</span></span> <span data-ttu-id="8a837-164">Optymistyczna współbieżność to technika, która zapewnia, że dwóch użytkowników, którzy jednocześnie pracują nad tymi samymi danymi, nie zastąpią przypadkowo zmian.</span><span class="sxs-lookup"><span data-stu-id="8a837-164">Optimistic concurrency is a technique to ensure that two users who are simultaneously working on the same data don't accidentally overwrite one another's changes.</span></span> <span data-ttu-id="8a837-165">Przechwycony cały rekord ułatwia również tworzenie metod aktualizacji w LOGIKI biznesowej, które modyfikują podzestaw kolumn elementu DataRow.</span><span class="sxs-lookup"><span data-stu-id="8a837-165">Grabbing the entire record also makes it easier to create update methods in the BLL that only modify a subset of the DataRow's columns.</span></span> <span data-ttu-id="8a837-166">Podczas eksplorowania klasy `SuppliersBLL` zobaczymy przykład.</span><span class="sxs-lookup"><span data-stu-id="8a837-166">When we explore the `SuppliersBLL` class we'll see such an example.</span></span>

<span data-ttu-id="8a837-167">Na koniec należy zauważyć, że Klasa `ProductsBLL` ma [przypisany atrybut DataObject](https://msdn.microsoft.com/library/system.componentmodel.dataobjectattribute.aspx) (`[System.ComponentModel.DataObject]` składni bezpośrednio przed instrukcją klasy w górnej części pliku), a metody mają [atrybuty DataObjectMethodAttribute](https://msdn.microsoft.com/library/system.componentmodel.dataobjectmethodattribute.aspx).</span><span class="sxs-lookup"><span data-stu-id="8a837-167">Finally, note that the `ProductsBLL` class has the [DataObject attribute](https://msdn.microsoft.com/library/system.componentmodel.dataobjectattribute.aspx) applied to it (the `[System.ComponentModel.DataObject]` syntax right before the class statement near the top of the file) and the methods have [DataObjectMethodAttribute attributes](https://msdn.microsoft.com/library/system.componentmodel.dataobjectmethodattribute.aspx).</span></span> <span data-ttu-id="8a837-168">Atrybut `DataObject` oznacza klasę jako obiekt odpowiedni dla powiązania z [kontrolką ObjectDataSource](https://msdn.microsoft.com/library/9a4kyhcx.aspx), podczas gdy `DataObjectMethodAttribute` wskazuje przeznaczenie metody.</span><span class="sxs-lookup"><span data-stu-id="8a837-168">The `DataObject` attribute marks the class as being an object suitable for binding to an [ObjectDataSource control](https://msdn.microsoft.com/library/9a4kyhcx.aspx), whereas the `DataObjectMethodAttribute` indicates the purpose of the method.</span></span> <span data-ttu-id="8a837-169">Ponieważ zobaczymy w przyszłych samouczkach, element ObjectDataSource ASP.NET 2.0 ułatwia deklaratywne uzyskiwanie dostępu do danych z klasy.</span><span class="sxs-lookup"><span data-stu-id="8a837-169">As we'll see in future tutorials, ASP.NET 2.0's ObjectDataSource makes it easy to declaratively access data from a class.</span></span> <span data-ttu-id="8a837-170">Aby można było filtrować listę możliwych klas do powiązania w Kreatorze elementu ObjectDataSource, domyślnie tylko te klasy oznaczone jako `DataObjects` są wyświetlane na liście rozwijanej kreatora.</span><span class="sxs-lookup"><span data-stu-id="8a837-170">To help filter the list of possible classes to bind to in the ObjectDataSource's wizard, by default only those classes marked as `DataObjects` are shown in the wizard's drop-down list.</span></span> <span data-ttu-id="8a837-171">Klasa `ProductsBLL` będzie działać tylko wtedy, gdy nie są to atrybuty, ale ich dodanie ułatwia pracę z kreatorem elementu ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="8a837-171">The `ProductsBLL` class will work just as well without these attributes, but adding them makes it easier to work with in the ObjectDataSource's wizard.</span></span>

## <a name="adding-the-other-classes"></a><span data-ttu-id="8a837-172">Dodawanie innych klas</span><span class="sxs-lookup"><span data-stu-id="8a837-172">Adding the Other Classes</span></span>

<span data-ttu-id="8a837-173">Po ukończeniu klasy `ProductsBLL` nadal musimy dodać klasy do pracy z kategoriami, dostawcami i pracownikami.</span><span class="sxs-lookup"><span data-stu-id="8a837-173">With the `ProductsBLL` class complete, we still need to add the classes for working with categories, suppliers, and employees.</span></span> <span data-ttu-id="8a837-174">Poświęć chwilę na utworzenie następujących klas i metod przy użyciu koncepcji z powyższego przykładu:</span><span class="sxs-lookup"><span data-stu-id="8a837-174">Take a moment to create the following classes and methods using the concepts from the example above:</span></span>

- <span data-ttu-id="8a837-175">**CategoriesBLL.cs**</span><span class="sxs-lookup"><span data-stu-id="8a837-175">**CategoriesBLL.cs**</span></span>

    - `GetCategories()`
    - `GetCategoryByCategoryID(categoryID)`
- <span data-ttu-id="8a837-176">**SuppliersBLL.cs**</span><span class="sxs-lookup"><span data-stu-id="8a837-176">**SuppliersBLL.cs**</span></span>

    - `GetSuppliers()`
    - `GetSupplierBySupplierID(supplierID)`
    - `GetSuppliersByCountry(country)`
    - `UpdateSupplierAddress(supplierID, address, city, country)`
- <span data-ttu-id="8a837-177">**EmployeesBLL.cs**</span><span class="sxs-lookup"><span data-stu-id="8a837-177">**EmployeesBLL.cs**</span></span>

    - `GetEmployees()`
    - `GetEmployeeByEmployeeID(employeeID)`
    - `GetEmployeesByManager(managerID)`

<span data-ttu-id="8a837-178">Jedną z metod należy zauważyć, że metoda `UpdateSupplierAddress` klasy `SuppliersBLL`.</span><span class="sxs-lookup"><span data-stu-id="8a837-178">The one method worth noting is the `SuppliersBLL` class's `UpdateSupplierAddress` method.</span></span> <span data-ttu-id="8a837-179">Ta metoda zapewnia interfejs do aktualizowania tylko informacji o adresie dostawcy.</span><span class="sxs-lookup"><span data-stu-id="8a837-179">This method provides an interface for updating just the supplier's address information.</span></span> <span data-ttu-id="8a837-180">Wewnętrznie metoda ta odczytuje w obiekcie `SupplierDataRow` dla określonego `supplierID` (przy użyciu `GetSupplierBySupplierID`), ustawia jego właściwości powiązane z adresami, a następnie wywołuje do metody `Update` `SupplierDataTable`.</span><span class="sxs-lookup"><span data-stu-id="8a837-180">Internally, this method reads in the `SupplierDataRow` object for the specified `supplierID` (using `GetSupplierBySupplierID`), sets its address-related properties, and then calls down into the `SupplierDataTable`'s `Update` method.</span></span> <span data-ttu-id="8a837-181">Metoda `UpdateSupplierAddress` jest następująca:</span><span class="sxs-lookup"><span data-stu-id="8a837-181">The `UpdateSupplierAddress` method follows:</span></span>

[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample2.cs)]

<span data-ttu-id="8a837-182">Zapoznaj się z tym artykułem Pobierz, aby dokończyć implementację klas LOGIKI biznesowej.</span><span class="sxs-lookup"><span data-stu-id="8a837-182">Refer to this article's download for my complete implementation of the BLL classes.</span></span>

## <a name="step-2-accessing-the-typed-datasets-through-the-bll-classes"></a><span data-ttu-id="8a837-183">Krok 2. Uzyskiwanie dostępu do wpisanych zestawów danych za pomocą klas LOGIKI biznesowej</span><span class="sxs-lookup"><span data-stu-id="8a837-183">Step 2: Accessing the Typed DataSets Through the BLL Classes</span></span>

<span data-ttu-id="8a837-184">W pierwszym samouczku przedstawiono przykłady pracy bezpośrednio z określonym zestawem danych programowo, ale z dodaniem naszych klas LOGIKI biznesowej, warstwa prezentacji powinna działać na LOGIKI biznesowej.</span><span class="sxs-lookup"><span data-stu-id="8a837-184">In the first tutorial we saw examples of working directly with the Typed DataSet programmatically, but with the addition of our BLL classes, the presentation tier should work against the BLL instead.</span></span> <span data-ttu-id="8a837-185">W `AllProducts.aspx` przykładzie z pierwszego samouczka `ProductsTableAdapter` został użyty do powiązania listy produktów z elementem GridView, jak pokazano w poniższym kodzie:</span><span class="sxs-lookup"><span data-stu-id="8a837-185">In the `AllProducts.aspx` example from the first tutorial, the `ProductsTableAdapter` was used to bind the list of products to a GridView, as shown in the following code:</span></span>

[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample3.cs)]

<span data-ttu-id="8a837-186">Aby korzystać z nowych klas LOGIKI biznesowej, wszystkie te, które muszą zostać zmienione, to pierwszy wiersz kodu po prostu Zastąp `ProductsTableAdapter` obiekt obiektem `ProductBLL`:</span><span class="sxs-lookup"><span data-stu-id="8a837-186">To use the new BLL classes, all that needs to be changed is the first line of code simply replace the `ProductsTableAdapter` object with a `ProductBLL` object:</span></span>

[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample4.cs)]

<span data-ttu-id="8a837-187">Klasy LOGIKI biznesowej można również uzyskać deklaratywnie (jako zestaw danych) za pomocą elementu ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="8a837-187">The BLL classes can also be accessed declaratively (as can the Typed DataSet) by using the ObjectDataSource.</span></span> <span data-ttu-id="8a837-188">Więcej szczegółów znajduje się w poniższych samouczkach dotyczących programu ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="8a837-188">We'll be discussing the ObjectDataSource in greater detail in the following tutorials.</span></span>

<span data-ttu-id="8a837-189">[![Lista produktów zostanie wyświetlona w widoku GridView](creating-a-business-logic-layer-cs/_static/image4.png)](creating-a-business-logic-layer-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="8a837-189">[![The List of Products is Displayed in a GridView](creating-a-business-logic-layer-cs/_static/image4.png)](creating-a-business-logic-layer-cs/_static/image3.png)</span></span>

<span data-ttu-id="8a837-190">**Rysunek 3**. Lista produktów jest wyświetlana w widoku GridView ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](creating-a-business-logic-layer-cs/_static/image5.png))</span><span class="sxs-lookup"><span data-stu-id="8a837-190">**Figure 3**: The List of Products is Displayed in a GridView ([Click to view full-size image](creating-a-business-logic-layer-cs/_static/image5.png))</span></span>

## <a name="step-3-adding-field-level-validation-to-the-datarow-classes"></a><span data-ttu-id="8a837-191">Krok 3. Dodawanie walidacji na poziomie pola do klas DataRow</span><span class="sxs-lookup"><span data-stu-id="8a837-191">Step 3: Adding Field-Level Validation to the DataRow Classes</span></span>

<span data-ttu-id="8a837-192">Walidacja na poziomie pola jest sprawdzana względem wartości właściwości obiektów biznesowych podczas wstawiania lub aktualizowania.</span><span class="sxs-lookup"><span data-stu-id="8a837-192">Field-level validation are checks that pertains to the property values of the business objects when inserting or updating.</span></span> <span data-ttu-id="8a837-193">Niektóre reguły walidacji na poziomie pola dla produktów obejmują:</span><span class="sxs-lookup"><span data-stu-id="8a837-193">Some field-level validation rules for products include:</span></span>

- <span data-ttu-id="8a837-194">Pole `ProductName` nie może zawierać więcej niż 40 znaków</span><span class="sxs-lookup"><span data-stu-id="8a837-194">The `ProductName` field must be 40 characters or less in length</span></span>
- <span data-ttu-id="8a837-195">Długość pola `QuantityPerUnit` nie może przekraczać 20 znaków</span><span class="sxs-lookup"><span data-stu-id="8a837-195">The `QuantityPerUnit` field must be 20 characters or less in length</span></span>
- <span data-ttu-id="8a837-196">Pola `ProductID`, `ProductName`i `Discontinued` są wymagane, ale wszystkie inne pola są opcjonalne</span><span class="sxs-lookup"><span data-stu-id="8a837-196">The `ProductID`, `ProductName`, and `Discontinued` fields are required, but all other fields are optional</span></span>
- <span data-ttu-id="8a837-197">Pola `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`i `ReorderLevel` nie mogą być równe zeru ani mniejsze.</span><span class="sxs-lookup"><span data-stu-id="8a837-197">The `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, and `ReorderLevel` fields must be greater than or equal to zero</span></span>

<span data-ttu-id="8a837-198">Te reguły mogą i powinny być wyrażone na poziomie bazy danych.</span><span class="sxs-lookup"><span data-stu-id="8a837-198">These rules can and should be expressed at the database level.</span></span> <span data-ttu-id="8a837-199">Limit znaków w polach `ProductName` i `QuantityPerUnit` jest przechwytywany przez typy danych tych kolumn w tabeli `Products` (odpowiednio`nvarchar(40)` i `nvarchar(20)`).</span><span class="sxs-lookup"><span data-stu-id="8a837-199">The character limit on the `ProductName` and `QuantityPerUnit` fields are captured by the data types of those columns in the `Products` table (`nvarchar(40)` and `nvarchar(20)`, respectively).</span></span> <span data-ttu-id="8a837-200">Czy pola są wymagane, a opcjonalne są wyrażane przez, jeśli kolumna tabeli bazy danych zezwala `NULL` s.</span><span class="sxs-lookup"><span data-stu-id="8a837-200">Whether fields are required and optional are expressed by if the database table column allows `NULL` s.</span></span> <span data-ttu-id="8a837-201">Istnieją cztery [ograniczenia check](https://msdn.microsoft.com/library/ms188258.aspx) , które zapewniają, że tylko wartości większe niż lub równe zero mogą wprowadzać je do kolumn `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`lub `ReorderLevel`.</span><span class="sxs-lookup"><span data-stu-id="8a837-201">Four [check constraints](https://msdn.microsoft.com/library/ms188258.aspx) exist that ensure that only values greater than or equal to zero can make it into the `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, or `ReorderLevel` columns.</span></span>

<span data-ttu-id="8a837-202">Oprócz wymuszania tych reguł w bazie danych należy również wymusić na poziomie zestawu danych.</span><span class="sxs-lookup"><span data-stu-id="8a837-202">In addition to enforcing these rules at the database they should also be enforced at the DataSet level.</span></span> <span data-ttu-id="8a837-203">W rzeczywistości długość pola oraz informacja o tym, czy wartość jest wymagana, czy opcjonalnie, są już przechwytywane dla zestawu danych DataColumns.</span><span class="sxs-lookup"><span data-stu-id="8a837-203">In fact, the field length and whether a value is required or optional are already captured for each DataTable's set of DataColumns.</span></span> <span data-ttu-id="8a837-204">Aby zobaczyć istniejące automatyczne sprawdzanie poprawności na poziomie pola, przejdź do projektanta obiektów DataSet, wybierz pole z jednej z tabel danych, a następnie przejdź do okno Właściwości.</span><span class="sxs-lookup"><span data-stu-id="8a837-204">To see the existing field-level validation automatically provided, go to the DataSet Designer, select a field from one of the DataTables and then go to the Properties window.</span></span> <span data-ttu-id="8a837-205">Jak pokazano na rysunku 4, kolumna `QuantityPerUnit` DataColumn w `ProductsDataTable` ma maksymalną długość 20 znaków i zezwala na `NULL` wartości.</span><span class="sxs-lookup"><span data-stu-id="8a837-205">As Figure 4 shows, the `QuantityPerUnit` DataColumn in the `ProductsDataTable` has a maximum length of 20 characters and does allow `NULL` values.</span></span> <span data-ttu-id="8a837-206">Jeśli podjęto próbę ustawienia właściwości `QuantityPerUnit` `ProductsDataRow`na wartość ciągu dłuższą niż 20 znaków, zostanie zgłoszony `ArgumentException`.</span><span class="sxs-lookup"><span data-stu-id="8a837-206">If we attempt to set the `ProductsDataRow`'s `QuantityPerUnit` property to a string value longer than 20 characters an `ArgumentException` will be thrown.</span></span>

<span data-ttu-id="8a837-207">[![kolumna DataColumn zapewnia podstawowe sprawdzanie poprawności na poziomie pola](creating-a-business-logic-layer-cs/_static/image7.png)](creating-a-business-logic-layer-cs/_static/image6.png)</span><span class="sxs-lookup"><span data-stu-id="8a837-207">[![The DataColumn Provides Basic Field-Level Validation](creating-a-business-logic-layer-cs/_static/image7.png)](creating-a-business-logic-layer-cs/_static/image6.png)</span></span>

<span data-ttu-id="8a837-208">**Rysunek 4**. kolumna DataColumn zawiera podstawowe sprawdzanie poprawności na poziomie pola ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](creating-a-business-logic-layer-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="8a837-208">**Figure 4**: The DataColumn Provides Basic Field-Level Validation ([Click to view full-size image](creating-a-business-logic-layer-cs/_static/image8.png))</span></span>

<span data-ttu-id="8a837-209">Niestety, nie możemy określić kontroli granic, takich jak wartość `UnitPrice` musi być większa lub równa zero, przez okno Właściwości.</span><span class="sxs-lookup"><span data-stu-id="8a837-209">Unfortunately, we can't specify bounds checks, such as the `UnitPrice` value must be greater than or equal to zero, through the Properties window.</span></span> <span data-ttu-id="8a837-210">Aby zapewnić ten typ walidacji na poziomie pola, należy utworzyć procedurę obsługi zdarzeń dla zdarzenia [ColumnChanging](https://msdn.microsoft.com/library/system.data.datatable.columnchanging%28VS.80%29.aspx) tabeli DataTable.</span><span class="sxs-lookup"><span data-stu-id="8a837-210">In order to provide this type of field-level validation we need to create an event handler for the DataTable's [ColumnChanging](https://msdn.microsoft.com/library/system.data.datatable.columnchanging%28VS.80%29.aspx) event.</span></span> <span data-ttu-id="8a837-211">Jak wspomniano w [poprzednim samouczku](creating-a-data-access-layer-cs.md), elementy DataSet, DataTables i DataRow utworzone przez określony zestaw danych można rozszerzyć za pomocą klas częściowych.</span><span class="sxs-lookup"><span data-stu-id="8a837-211">As mentioned in the [preceding tutorial](creating-a-data-access-layer-cs.md), the DataSet, DataTables, and DataRow objects created by the Typed DataSet can be extended through the use of partial classes.</span></span> <span data-ttu-id="8a837-212">Za pomocą tej techniki możemy utworzyć procedurę obsługi zdarzeń `ColumnChanging` dla klasy `ProductsDataTable`.</span><span class="sxs-lookup"><span data-stu-id="8a837-212">Using this technique we can create a `ColumnChanging` event handler for the `ProductsDataTable` class.</span></span> <span data-ttu-id="8a837-213">Zacznij od utworzenia klasy w folderze `App_Code` o nazwie `ProductsDataTable.ColumnChanging.cs`.</span><span class="sxs-lookup"><span data-stu-id="8a837-213">Start by creating a class in the `App_Code` folder named `ProductsDataTable.ColumnChanging.cs`.</span></span>

<span data-ttu-id="8a837-214">[![dodać nową klasę do folderu App_Code](creating-a-business-logic-layer-cs/_static/image10.png)](creating-a-business-logic-layer-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="8a837-214">[![Add a New Class to the App_Code Folder](creating-a-business-logic-layer-cs/_static/image10.png)](creating-a-business-logic-layer-cs/_static/image9.png)</span></span>

<span data-ttu-id="8a837-215">**Rysunek 5**. Dodawanie nowej klasy do folderu `App_Code` ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](creating-a-business-logic-layer-cs/_static/image11.png))</span><span class="sxs-lookup"><span data-stu-id="8a837-215">**Figure 5**: Add a New Class to the `App_Code` Folder ([Click to view full-size image](creating-a-business-logic-layer-cs/_static/image11.png))</span></span>

<span data-ttu-id="8a837-216">Następnie Utwórz procedurę obsługi zdarzeń dla zdarzenia `ColumnChanging`, która zapewnia, że wartości kolumn `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`i `ReorderLevel` (jeśli nie `NULL`) są większe lub równe zero.</span><span class="sxs-lookup"><span data-stu-id="8a837-216">Next, create an event handler for the `ColumnChanging` event that ensures that the `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, and `ReorderLevel` column values (if not `NULL`) are greater than or equal to zero.</span></span> <span data-ttu-id="8a837-217">Jeśli jakakolwiek taka kolumna jest poza zakresem, zgłoś `ArgumentException`.</span><span class="sxs-lookup"><span data-stu-id="8a837-217">If any such column is out of range, throw an `ArgumentException`.</span></span>

<span data-ttu-id="8a837-218">ProductsDataTable.ColumnChanging.cs</span><span class="sxs-lookup"><span data-stu-id="8a837-218">ProductsDataTable.ColumnChanging.cs</span></span>

[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample5.cs)]

## <a name="step-4-adding-custom-business-rules-to-the-blls-classes"></a><span data-ttu-id="8a837-219">Krok 4. Dodawanie niestandardowych reguł biznesowych do klas LOGIKI biznesowej</span><span class="sxs-lookup"><span data-stu-id="8a837-219">Step 4: Adding Custom Business Rules to the BLL's Classes</span></span>

<span data-ttu-id="8a837-220">Oprócz walidacji na poziomie pola mogą istnieć niestandardowe reguły biznesowe, które obejmują różne jednostki lub koncepcje, które nie można wyrazić elementu na poziomie pojedynczej kolumny, takie jak:</span><span class="sxs-lookup"><span data-stu-id="8a837-220">In addition to field-level validation, there may be high-level custom business rules that involve different entities or concepts not expressible at the single column level, such as:</span></span>

- <span data-ttu-id="8a837-221">W przypadku wycofania produktu nie można zaktualizować jego `UnitPrice`</span><span class="sxs-lookup"><span data-stu-id="8a837-221">If a product is discontinued, its `UnitPrice` cannot be updated</span></span>
- <span data-ttu-id="8a837-222">Kraj pobytu pracownika musi być taki sam jak kraj zamieszkania swojego kierownika</span><span class="sxs-lookup"><span data-stu-id="8a837-222">An employee's country of residence must be the same as their manager's country of residence</span></span>
- <span data-ttu-id="8a837-223">Produkt nie może zostać wycofany, jeśli jest jedynym produktem dostarczonym przez dostawcę</span><span class="sxs-lookup"><span data-stu-id="8a837-223">A product cannot be discontinued if it is the only product provided by the supplier</span></span>

<span data-ttu-id="8a837-224">Klasy LOGIKI biznesowej powinny zawierać kontrole w celu zapewnienia zgodności z regułami biznesowymi aplikacji.</span><span class="sxs-lookup"><span data-stu-id="8a837-224">The BLL classes should contain checks to ensure adherence to the application's business rules.</span></span> <span data-ttu-id="8a837-225">Te sprawdzenia można dodać bezpośrednio do metod, do których mają zastosowanie.</span><span class="sxs-lookup"><span data-stu-id="8a837-225">These checks can be added directly to the methods to which they apply.</span></span>

<span data-ttu-id="8a837-226">Załóżmy, że nasze reguły biznesowe określają, że produkt nie może zostać oznaczony jako nieobsługiwany, jeśli był to jedyny produkt od danego dostawcy.</span><span class="sxs-lookup"><span data-stu-id="8a837-226">Imagine that our business rules dictate that a product could not be marked discontinued if it was the only product from a given supplier.</span></span> <span data-ttu-id="8a837-227">Oznacza to, że jeśli produkt *X* był jedynym produktem zakupionego od dostawcy *Y*, nie można oznaczyć *X* jako nieprzerwanego; Jeśli jednak dostawca *Y* podał nam trzy produkty, *a*, *B*i *C*, możemy oznaczyć wszystkie te i wszystkie z nich jako nieobsługiwane.</span><span class="sxs-lookup"><span data-stu-id="8a837-227">That is, if product *X* was the only product we purchased from supplier *Y*, we could not mark *X* as discontinued; if, however, supplier *Y* supplied us with three products, *A*, *B*, and *C*, then we could mark any and all of these as discontinued.</span></span> <span data-ttu-id="8a837-228">Nieparzysta reguła biznesowa, ale reguły biznesowe i wspólny sens nie zawsze są wyrównane!</span><span class="sxs-lookup"><span data-stu-id="8a837-228">An odd business rule, but business rules and common sense aren't always aligned!</span></span>

<span data-ttu-id="8a837-229">Aby wymusić tę regułę biznesową w `UpdateProducts` metodzie, należy sprawdzić, czy `Discontinued` została ustawiona na `true` i, jeśli tak, będziemy dzwonić w `GetProductsBySupplierID`, aby określić liczbę produktów zakupionych od dostawcy tego produktu.</span><span class="sxs-lookup"><span data-stu-id="8a837-229">To enforce this business rule in the `UpdateProducts` method we'd start by checking if `Discontinued` was set to `true` and, if so, we'd call `GetProductsBySupplierID` to determine how many products we purchased from this product's supplier.</span></span> <span data-ttu-id="8a837-230">W przypadku zakupu tylko jednego produktu od tego dostawcy zgłaszamy `ApplicationException`.</span><span class="sxs-lookup"><span data-stu-id="8a837-230">If only one product is purchased from this supplier, we throw an `ApplicationException`.</span></span>

[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample6.cs)]

## <a name="responding-to-validation-errors-in-the-presentation-tier"></a><span data-ttu-id="8a837-231">Reagowanie na błędy walidacji w warstwie prezentacji</span><span class="sxs-lookup"><span data-stu-id="8a837-231">Responding to Validation Errors in the Presentation Tier</span></span>

<span data-ttu-id="8a837-232">Podczas wywoływania LOGIKI biznesowej z poziomu warstwy prezentacji możemy zdecydować, czy próbować obsługiwać wszelkie wyjątki, które mogą zostać zgłoszone, lub pozwolić im na wystąpienie bąbelków w ASP.NET (które spowodują wygenerowanie zdarzenia `Error` `HttpApplication`).</span><span class="sxs-lookup"><span data-stu-id="8a837-232">When calling the BLL from the presentation tier we can decide whether to attempt to handle any exceptions that might be raised or let them bubble up to ASP.NET (which will raise the `HttpApplication`'s `Error` event).</span></span> <span data-ttu-id="8a837-233">Aby obsłużyć wyjątek podczas programistycznego pracy z LOGIKI biznesowej, możemy użyć [try... Catch](https://msdn.microsoft.com/library/0yd65esw.aspx) , jak pokazano na poniższym przykładzie:</span><span class="sxs-lookup"><span data-stu-id="8a837-233">To handle an exception when working with the BLL programmatically, we can use a [try...catch](https://msdn.microsoft.com/library/0yd65esw.aspx) block, as the following example shows:</span></span>

[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample7.cs)]

<span data-ttu-id="8a837-234">Jak zobaczymy w przyszłych samouczkach, obsługa wyjątków, które są zaznaczane na podstawie LOGIKI biznesowej przy użyciu kontrolki sieci Web danych do wstawiania, aktualizowania lub usuwania danych, może być obsłużona bezpośrednio w programie obsługi zdarzeń, zamiast konieczności zawijania kodu w blokach `try...catch`.</span><span class="sxs-lookup"><span data-stu-id="8a837-234">As we'll see in future tutorials, handling exceptions that bubble up from the BLL when using a data Web control for inserting, updating, or deleting data can be handled directly in an event handler as opposed to having to wrap code in `try...catch` blocks.</span></span>

## <a name="summary"></a><span data-ttu-id="8a837-235">Podsumowanie</span><span class="sxs-lookup"><span data-stu-id="8a837-235">Summary</span></span>

<span data-ttu-id="8a837-236">Dobrze zaprojektowana aplikacja jest przygotowana do odrębnych warstw, z których każdy hermetyzuje określoną rolę.</span><span class="sxs-lookup"><span data-stu-id="8a837-236">A well architected application is crafted into distinct layers, each of which encapsulates a particular role.</span></span> <span data-ttu-id="8a837-237">W pierwszym samouczku w tej serii artykułu została utworzona Warstwa dostępu do danych za pomocą zestawów DataSet z określonym typem; w tym samouczku utworzyliśmy warstwę logiki biznesowej jako serię klas w folderze `App_Code` aplikacji, który jest wywoływany w naszym DAL.</span><span class="sxs-lookup"><span data-stu-id="8a837-237">In the first tutorial of this article series we created a Data Access Layer using Typed DataSets; in this tutorial we built a Business Logic Layer as a series of classes in our application's `App_Code` folder that call down into our DAL.</span></span> <span data-ttu-id="8a837-238">LOGIKI biznesowej implementuje logikę na poziomie pola i na poziomie firmy dla naszej aplikacji.</span><span class="sxs-lookup"><span data-stu-id="8a837-238">The BLL implements the field-level and business-level logic for our application.</span></span> <span data-ttu-id="8a837-239">Oprócz tworzenia oddzielnych LOGIKI biznesowej, tak jak w tym samouczku, kolejną opcją jest poszerzenie metod TableAdapters "za pomocą klas częściowych.</span><span class="sxs-lookup"><span data-stu-id="8a837-239">In addition to creating a separate BLL, as we did in this tutorial, another option is to extend the TableAdapters' methods through the use of partial classes.</span></span> <span data-ttu-id="8a837-240">Jednak użycie tej techniki nie pozwala na zastąpienie istniejących metod ani oddzielenie naszych DAL i naszych LOGIKI biznesowej jako czystych, jak podejście podjęte w tym artykule.</span><span class="sxs-lookup"><span data-stu-id="8a837-240">However, using this technique does not allow us to override existing methods nor does it separate our DAL and our BLL as cleanly as the approach we've taken in this article.</span></span>

<span data-ttu-id="8a837-241">Po ukończeniu DAL i LOGIKI biznesowej wszystko jest gotowe do rozpoczęcia pracy nad naszą warstwą prezentacji.</span><span class="sxs-lookup"><span data-stu-id="8a837-241">With the DAL and BLL complete, we're ready to start on our presentation layer.</span></span> <span data-ttu-id="8a837-242">W [następnym samouczku](master-pages-and-site-navigation-cs.md) zajmiemy się krótką prezentacją dotyczącą tematów dotyczących dostępu do danych i definiowania spójnego układu stron do użycia w całym samouczku.</span><span class="sxs-lookup"><span data-stu-id="8a837-242">In the [next tutorial](master-pages-and-site-navigation-cs.md) we'll take a brief detour from data access topics and define a consistent page layout for use throughout the tutorials.</span></span>

<span data-ttu-id="8a837-243">Szczęśliwe programowanie!</span><span class="sxs-lookup"><span data-stu-id="8a837-243">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="8a837-244">Informacje o autorze</span><span class="sxs-lookup"><span data-stu-id="8a837-244">About the Author</span></span>

<span data-ttu-id="8a837-245">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor siedmiu grup ASP/ASP. NET Books i założyciel of [4GuysFromRolla.com](http://www.4guysfromrolla.com), pracował z technologiami sieci Web firmy Microsoft od czasu 1998.</span><span class="sxs-lookup"><span data-stu-id="8a837-245">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="8a837-246">Scott działa jako niezależny konsultant, trainer i składnik zapisywania.</span><span class="sxs-lookup"><span data-stu-id="8a837-246">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="8a837-247">Jego Najnowsza książka to [*Sams ASP.NET 2,0 w ciągu 24 godzin*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="8a837-247">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="8a837-248">Można go osiągnąć w [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="8a837-248">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="8a837-249">lub za pośrednictwem swojego blogu, który można znaleźć w [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="8a837-249">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="8a837-250">Specjalne podziękowania</span><span class="sxs-lookup"><span data-stu-id="8a837-250">Special Thanks To</span></span>

<span data-ttu-id="8a837-251">Ta seria samouczków została sprawdzona przez wielu przydatnych recenzentów.</span><span class="sxs-lookup"><span data-stu-id="8a837-251">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="8a837-252">Recenzenci liderzy dla tego samouczka to Liz Shulok, Dennis Patterson, Carlos Santos i Hilton Giesenow.</span><span class="sxs-lookup"><span data-stu-id="8a837-252">Lead reviewers for this tutorial were Liz Shulok, Dennis Patterson, Carlos Santos, and Hilton Giesenow.</span></span> <span data-ttu-id="8a837-253">Chcesz przeglądać moje nadchodzące artykuły MSDN?</span><span class="sxs-lookup"><span data-stu-id="8a837-253">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="8a837-254">Jeśli tak, upuść mi linię w [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="8a837-254">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="8a837-255">[Poprzednie](creating-a-data-access-layer-cs.md)
> [dalej](master-pages-and-site-navigation-cs.md)</span><span class="sxs-lookup"><span data-stu-id="8a837-255">[Previous](creating-a-data-access-layer-cs.md)
[Next](master-pages-and-site-navigation-cs.md)</span></span>
