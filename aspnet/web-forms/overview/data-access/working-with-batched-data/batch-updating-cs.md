---
uid: web-forms/overview/data-access/working-with-batched-data/batch-updating-cs
title: Aktualizacja wsadowaC#() | Microsoft Docs
author: rick-anderson
description: Dowiedz się, jak aktualizować wiele rekordów bazy danych w ramach jednej operacji. W warstwie interfejsu użytkownika tworzymy widok GridView, w którym każdy wiersz jest edytowalny. W danych...
ms.author: riande
ms.date: 06/26/2007
ms.assetid: 4e849bcc-c557-4bc3-937e-f7453ee87265
msc.legacyurl: /web-forms/overview/data-access/working-with-batched-data/batch-updating-cs
msc.type: authoredcontent
ms.openlocfilehash: baaaf37c47cc57d90ea579a5c20949bf8cfc7a3c
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 03/06/2020
ms.locfileid: "78589293"
---
# <a name="batch-updating-c"></a><span data-ttu-id="f9c07-105">Aktualizowanie w partiach (C#)</span><span class="sxs-lookup"><span data-stu-id="f9c07-105">Batch Updating (C#)</span></span>

<span data-ttu-id="f9c07-106">przez [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="f9c07-106">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="f9c07-107">[Pobierz kod](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_64_CS.zip) lub [Pobierz plik PDF](batch-updating-cs/_static/datatutorial64cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="f9c07-107">[Download Code](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_64_CS.zip) or [Download PDF](batch-updating-cs/_static/datatutorial64cs1.pdf)</span></span>

> <span data-ttu-id="f9c07-108">Dowiedz się, jak aktualizować wiele rekordów bazy danych w ramach jednej operacji.</span><span class="sxs-lookup"><span data-stu-id="f9c07-108">Learn how to update multiple database records in a single operation.</span></span> <span data-ttu-id="f9c07-109">W warstwie interfejsu użytkownika tworzymy widok GridView, w którym każdy wiersz jest edytowalny.</span><span class="sxs-lookup"><span data-stu-id="f9c07-109">In the User Interface Layer we build a GridView where each row is editable.</span></span> <span data-ttu-id="f9c07-110">W warstwie dostępu do danych zawijamy wiele operacji aktualizacji w ramach transakcji, aby upewnić się, że wszystkie aktualizacje zostały wykonane pomyślnie, lub wszystkie aktualizacje zostaną wycofane.</span><span class="sxs-lookup"><span data-stu-id="f9c07-110">In the Data Access Layer we wrap the multiple Update operations within a transaction to ensure that all updates succeed or all updates are rolled back.</span></span>

## <a name="introduction"></a><span data-ttu-id="f9c07-111">Wprowadzenie</span><span class="sxs-lookup"><span data-stu-id="f9c07-111">Introduction</span></span>

<span data-ttu-id="f9c07-112">W [poprzednim samouczku](wrapping-database-modifications-within-a-transaction-cs.md) przedstawiono sposób rozbudowania warstwy dostępu do danych w celu dodania obsługi transakcji bazy danych.</span><span class="sxs-lookup"><span data-stu-id="f9c07-112">In the [preceding tutorial](wrapping-database-modifications-within-a-transaction-cs.md) we saw how to extend the Data Access Layer to add support for database transactions.</span></span> <span data-ttu-id="f9c07-113">Transakcje bazy danych gwarantują, że seria instrukcji modyfikacji danych będzie traktowana jako jedna operacja niepodzielna, co gwarantuje, że wszystkie modyfikacje zakończą się niepowodzeniem lub wszystkie zakończyły się pomyślnie.</span><span class="sxs-lookup"><span data-stu-id="f9c07-113">Database transactions guarantee that a series of data modification statements will be treated as one atomic operation, which ensures that all modifications will fail or all will succeed.</span></span> <span data-ttu-id="f9c07-114">Dzięki tej funkcji DAL na niskim poziomie wszystko gotowe do przeprowadzenia naszej uwagi w celu utworzenia interfejsów modyfikacji danych wsadowych.</span><span class="sxs-lookup"><span data-stu-id="f9c07-114">With this low-level DAL functionality out of the way, we re ready to turn our attention to creating batch data modification interfaces.</span></span>

<span data-ttu-id="f9c07-115">W tym samouczku utworzymy widok GridView, w którym każdy wiersz jest edytowalny (patrz rysunek 1).</span><span class="sxs-lookup"><span data-stu-id="f9c07-115">In this tutorial we'll build a GridView where each row is editable (see Figure 1).</span></span> <span data-ttu-id="f9c07-116">Ponieważ każdy wiersz jest renderowany w interfejsie edycyjnym, nie ma potrzeby dla kolumny edycji, aktualizacji i przycisków anulowania.</span><span class="sxs-lookup"><span data-stu-id="f9c07-116">Since each row is rendered in its editing interface, there s no need for a column of Edit, Update, and Cancel buttons.</span></span> <span data-ttu-id="f9c07-117">Zamiast tego na stronie znajdują się dwa przyciski aktualizacji produktów, które po kliknięciu należy wyliczyć z wierszy GridView i aktualizować bazę danych.</span><span class="sxs-lookup"><span data-stu-id="f9c07-117">Instead, there are two Update Products buttons on the page that, when clicked, enumerate the GridView rows and update the database.</span></span>

<span data-ttu-id="f9c07-118">[![można edytować każdego wiersza w widoku GridView](batch-updating-cs/_static/image1.gif)](batch-updating-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="f9c07-118">[![Each Row in the GridView is Editable](batch-updating-cs/_static/image1.gif)](batch-updating-cs/_static/image1.png)</span></span>

<span data-ttu-id="f9c07-119">**Rysunek 1**. edytowalny każdy wiersz w widoku GridView ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](batch-updating-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="f9c07-119">**Figure 1**: Each Row in the GridView is Editable ([Click to view full-size image](batch-updating-cs/_static/image2.png))</span></span>

<span data-ttu-id="f9c07-120">Zacznij korzystać z aplikacji.</span><span class="sxs-lookup"><span data-stu-id="f9c07-120">Let s get started!</span></span>

> [!NOTE]
> <span data-ttu-id="f9c07-121">W samouczku [wykonywanie aktualizacji wsadowych](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-cs.md) został utworzony interfejs edytowania partii przy użyciu formantu DataList.</span><span class="sxs-lookup"><span data-stu-id="f9c07-121">In the [Performing Batch Updates](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-cs.md) tutorial we created a batch editing interface using the DataList control.</span></span> <span data-ttu-id="f9c07-122">Ten samouczek różni się od poprzedniej usługi w programie, która korzysta z widoku GridView, a aktualizacja wsadowa jest wykonywana w zakresie transakcji.</span><span class="sxs-lookup"><span data-stu-id="f9c07-122">This tutorial differs from the previous one in that is uses a GridView and the batch update is performed within the scope of a transaction.</span></span> <span data-ttu-id="f9c07-123">Po ukończeniu tego samouczka zachęcamy do powrotu do wcześniejszego samouczka i aktualizowania go w celu korzystania z funkcji związanych z transakcjami bazy danych dodanych w poprzednim samouczku.</span><span class="sxs-lookup"><span data-stu-id="f9c07-123">After completing this tutorial I encourage you to return to the earlier tutorial and update it to use the database transaction-related functionality added in the preceding tutorial.</span></span>

## <a name="examining-the-steps-for-making-all-gridview-rows-editable"></a><span data-ttu-id="f9c07-124">Badanie kroków umożliwiających edytowanie wszystkich wierszy GridView</span><span class="sxs-lookup"><span data-stu-id="f9c07-124">Examining the Steps for Making All GridView Rows Editable</span></span>

<span data-ttu-id="f9c07-125">Zgodnie z opisem w temacie [Omówienie wstawiania, aktualizowania i usuwania danych](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md) , widok GridView oferuje wbudowaną obsługę edytowania danych źródłowych w poszczególnych wierszach.</span><span class="sxs-lookup"><span data-stu-id="f9c07-125">As discussed in the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md) tutorial, the GridView offers built-in support for editing its underlying data on a per-row basis.</span></span> <span data-ttu-id="f9c07-126">Wewnętrznie, w widoku GridView notatki, jaki wiersz jest edytowalny za pomocą [właściwości`EditIndex`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.editindex(VS.80).aspx).</span><span class="sxs-lookup"><span data-stu-id="f9c07-126">Internally, the GridView notes what row is editable through its [`EditIndex` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.editindex(VS.80).aspx).</span></span> <span data-ttu-id="f9c07-127">Gdy widok GridView jest powiązany ze źródłem danych, sprawdza każdy wiersz, aby zobaczyć, czy indeks wiersza jest równy wartości `EditIndex`.</span><span class="sxs-lookup"><span data-stu-id="f9c07-127">As the GridView is being bound to its data source, it checks each row to see if the index of the row equals the value of `EditIndex`.</span></span> <span data-ttu-id="f9c07-128">Jeśli tak, to pola wiersza s są renderowane przy użyciu ich interfejsów edycji.</span><span class="sxs-lookup"><span data-stu-id="f9c07-128">If so, that row s fields are rendered using their editing interfaces.</span></span> <span data-ttu-id="f9c07-129">W przypadku BoundFields interfejs edytowania jest polem tekstowym, którego właściwość `Text` ma przypisaną wartość pola danych określonego przez właściwość `DataField` s.</span><span class="sxs-lookup"><span data-stu-id="f9c07-129">For BoundFields, the editing interface is a TextBox whose `Text` property is assigned the value of the data field specified by the BoundField s `DataField` property.</span></span> <span data-ttu-id="f9c07-130">W przypadku używanie TemplateField `EditItemTemplate` jest używana zamiast `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="f9c07-130">For TemplateFields, the `EditItemTemplate` is used in place of the `ItemTemplate`.</span></span>

<span data-ttu-id="f9c07-131">Odwołaj, że przepływ pracy edytowania jest uruchamiany, gdy użytkownik kliknie przycisk Edytuj wiersza.</span><span class="sxs-lookup"><span data-stu-id="f9c07-131">Recall that the editing workflow starts when a user clicks a row s Edit button.</span></span> <span data-ttu-id="f9c07-132">Powoduje to odświeżenie, ustawia właściwość GridView s `EditIndex` na kliknięty indeks Row s i ponownie wiąże dane z siatką.</span><span class="sxs-lookup"><span data-stu-id="f9c07-132">This causes a postback, sets the GridView s `EditIndex` property to the clicked row s index, and rebinds the data to the grid.</span></span> <span data-ttu-id="f9c07-133">Po kliknięciu przycisku Anuluj wiersza s na stronie ogłaszania zwrotnego `EditIndex` jest ustawiona na wartość `-1` przed ponownym powiązaniem danych z siatką.</span><span class="sxs-lookup"><span data-stu-id="f9c07-133">When a row s Cancel button is clicked, on postback the `EditIndex` is set to a value of `-1` before rebinding the data to the grid.</span></span> <span data-ttu-id="f9c07-134">Ponieważ wiersze GridView s zaczynają indeksować na zero, ustawienie `EditIndex` na `-1` ma wpływ na wyświetlanie widoku GridView w trybie tylko do odczytu.</span><span class="sxs-lookup"><span data-stu-id="f9c07-134">Since the GridView s rows start indexing at zero, setting `EditIndex` to `-1` has the effect of displaying the GridView in read-only mode.</span></span>

<span data-ttu-id="f9c07-135">Właściwość `EditIndex` dobrze sprawdza się w przypadku edycji na wiersz, ale nie jest przeznaczona do edycji wsadowej.</span><span class="sxs-lookup"><span data-stu-id="f9c07-135">The `EditIndex` property works well for per-row editing, but is not designed for batch editing.</span></span> <span data-ttu-id="f9c07-136">Aby można było edytować cały widok GridView, musimy mieć każdy wiersz renderowania przy użyciu interfejsu edycji.</span><span class="sxs-lookup"><span data-stu-id="f9c07-136">To make the entire GridView editable, we need to have each row render using its editing interface.</span></span> <span data-ttu-id="f9c07-137">Najprostszym sposobem na to jest utworzenie miejsca, w którym każde edytowalne pole jest zaimplementowane jako TemplateField z interfejsem edycji zdefiniowanym w `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="f9c07-137">The easiest way to accomplish this is to create where each editable field is implemented as a TemplateField with its editing interface defined in the `ItemTemplate`.</span></span>

<span data-ttu-id="f9c07-138">W ciągu następnych kilku kroków utworzysz całkowicie edytowalny widok GridView.</span><span class="sxs-lookup"><span data-stu-id="f9c07-138">Over the next several steps we'll create a completely editable GridView.</span></span> <span data-ttu-id="f9c07-139">W kroku 1 zaczniemy od utworzenia widoku GridView i jego elementu ObjectDataSource i przekonwertowania jego BoundFields i CheckBoxField na używanie TemplateField.</span><span class="sxs-lookup"><span data-stu-id="f9c07-139">In Step 1 we'll start by creating the GridView and its ObjectDataSource and convert its BoundFields and CheckBoxField into TemplateFields.</span></span> <span data-ttu-id="f9c07-140">W krokach 2 i 3 przeniesiemy interfejsy edycji z używanie TemplateField `EditItemTemplate` s do `ItemTemplate` s.</span><span class="sxs-lookup"><span data-stu-id="f9c07-140">In Steps 2 and 3 we'll move the editing interfaces from the TemplateFields `EditItemTemplate` s to their `ItemTemplate` s.</span></span>

## <a name="step-1-displaying-product-information"></a><span data-ttu-id="f9c07-141">Krok 1. Wyświetlanie informacji o produkcie</span><span class="sxs-lookup"><span data-stu-id="f9c07-141">Step 1: Displaying Product Information</span></span>

<span data-ttu-id="f9c07-142">Przed zajmować się tworzeniem widoku GridView, gdzie są edytowalne wiersze, Zacznij od samego wyświetlenia informacji o produkcie.</span><span class="sxs-lookup"><span data-stu-id="f9c07-142">Before we worry about creating a GridView where are rows are editable, let s start by simply displaying the product information.</span></span> <span data-ttu-id="f9c07-143">Otwórz stronę `BatchUpdate.aspx` w folderze `BatchData` i przeciągnij widok GridView z przybornika na projektanta.</span><span class="sxs-lookup"><span data-stu-id="f9c07-143">Open the `BatchUpdate.aspx` page in the `BatchData` folder and drag a GridView from the Toolbox onto the Designer.</span></span> <span data-ttu-id="f9c07-144">Ustaw `ID` GridView s na `ProductsGrid` i, z jego tagu inteligentnego, wybierz powiązanie go z nowym elementem ObjectDataSource o nazwie `ProductsDataSource`.</span><span class="sxs-lookup"><span data-stu-id="f9c07-144">Set the GridView s `ID` to `ProductsGrid` and, from its smart tag, choose to bind it to a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="f9c07-145">Skonfiguruj element ObjectDataSource, aby pobierać jego dane z metody `GetProducts` `ProductsBLL` Class.</span><span class="sxs-lookup"><span data-stu-id="f9c07-145">Configure the ObjectDataSource to retrieve its data from the `ProductsBLL` class s `GetProducts` method.</span></span>

<span data-ttu-id="f9c07-146">[![skonfigurować element ObjectDataSource do używania klasy ProductsBLL](batch-updating-cs/_static/image2.gif)](batch-updating-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="f9c07-146">[![Configure the ObjectDataSource to Use the ProductsBLL Class](batch-updating-cs/_static/image2.gif)](batch-updating-cs/_static/image3.png)</span></span>

<span data-ttu-id="f9c07-147">**Rysunek 2**. Konfigurowanie elementu ObjectDataSource do używania klasy `ProductsBLL` ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](batch-updating-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="f9c07-147">**Figure 2**: Configure the ObjectDataSource to Use the `ProductsBLL` Class ([Click to view full-size image](batch-updating-cs/_static/image4.png))</span></span>

<span data-ttu-id="f9c07-148">[![pobrać danych produktu przy użyciu metody getproductss](batch-updating-cs/_static/image3.gif)](batch-updating-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="f9c07-148">[![Retrieve the Product Data Using the GetProducts Method](batch-updating-cs/_static/image3.gif)](batch-updating-cs/_static/image5.png)</span></span>

<span data-ttu-id="f9c07-149">**Rysunek 3**. Pobieranie danych produktu przy użyciu metody `GetProducts` ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](batch-updating-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="f9c07-149">**Figure 3**: Retrieve the Product Data Using the `GetProducts` Method ([Click to view full-size image](batch-updating-cs/_static/image6.png))</span></span>

<span data-ttu-id="f9c07-150">Podobnie jak w widoku GridView, funkcje modyfikacji elementu ObjectDataSource są przeznaczone do pracy w poszczególnych wierszach.</span><span class="sxs-lookup"><span data-stu-id="f9c07-150">Like the GridView, the ObjectDataSource s modification features are designed to work on a per-row basis.</span></span> <span data-ttu-id="f9c07-151">Aby można było zaktualizować zestaw rekordów, musimy napisać bit kodu w klasie ASP.NET Page s, która tworzy dane i przekazuje je do LOGIKI biznesowej.</span><span class="sxs-lookup"><span data-stu-id="f9c07-151">In order to update a set of records, we'll need to write a bit of code in the ASP.NET page s code-behind class that batches the data and passes it to the BLL.</span></span> <span data-ttu-id="f9c07-152">W związku z tym należy ustawić listy rozwijane na kartach Usuń lub Dodaj, a następnie usunąć do (brak).</span><span class="sxs-lookup"><span data-stu-id="f9c07-152">Therefore, set the drop-down lists in the ObjectDataSource s UPDATE, INSERT, and DELETE tabs to (None).</span></span> <span data-ttu-id="f9c07-153">Kliknij przycisk Zakończ, aby zakończyć pracę kreatora.</span><span class="sxs-lookup"><span data-stu-id="f9c07-153">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="f9c07-154">[![ustawić listy rozwijane na kartach Aktualizuj, Wstaw i Usuń do (brak).](batch-updating-cs/_static/image4.gif)](batch-updating-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="f9c07-154">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](batch-updating-cs/_static/image4.gif)](batch-updating-cs/_static/image7.png)</span></span>

<span data-ttu-id="f9c07-155">**Rysunek 4**. Ustawianie list rozwijanych w kartach Aktualizuj, Wstaw i Usuń do (brak) ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](batch-updating-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="f9c07-155">**Figure 4**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](batch-updating-cs/_static/image8.png))</span></span>

<span data-ttu-id="f9c07-156">Po zakończeniu działania Kreatora konfiguracji źródła danych, znaczniki deklaratywne programu ObjectDataSource powinny wyglądać następująco:</span><span class="sxs-lookup"><span data-stu-id="f9c07-156">After completing the Configure Data Source wizard, the ObjectDataSource s declarative markup should look like the following:</span></span>

[!code-aspx[Main](batch-updating-cs/samples/sample1.aspx)]

<span data-ttu-id="f9c07-157">Ukończenie kreatora konfigurowania źródła danych powoduje również, że program Visual Studio tworzy BoundFields i CheckBoxField dla pól danych produktu w widoku GridView.</span><span class="sxs-lookup"><span data-stu-id="f9c07-157">Completing the Configure Data Source wizard also causes Visual Studio to create BoundFields and a CheckBoxField for the product data fields in the GridView.</span></span> <span data-ttu-id="f9c07-158">W tym samouczku pozwól, aby użytkownicy mogli wyświetlać i edytować nazwę produktu, kategorię, cenę i stan wycofany.</span><span class="sxs-lookup"><span data-stu-id="f9c07-158">For this tutorial, let s only allow the user to view and edit the product s name, category, price, and discontinued status.</span></span> <span data-ttu-id="f9c07-159">Usuń wszystkie pola oprócz `ProductName`, `CategoryName`, `UnitPrice`i `Discontinued` i Zmień nazwę właściwości `HeaderText` pierwszych trzech pól na produkt, kategorię i cenę.</span><span class="sxs-lookup"><span data-stu-id="f9c07-159">Remove all but the `ProductName`, `CategoryName`, `UnitPrice`, and `Discontinued` fields and rename the `HeaderText` properties of the first three fields to Product, Category, and Price, respectively.</span></span> <span data-ttu-id="f9c07-160">Na koniec zaznacz pola wyboru Włącz stronicowanie i Włącz sortowanie w tagów inteligentnych GridView.</span><span class="sxs-lookup"><span data-stu-id="f9c07-160">Lastly, check the Enable Paging and Enable Sorting checkboxes in the GridView s smart tag.</span></span>

<span data-ttu-id="f9c07-161">W tym momencie widok GridView ma trzy BoundFields (`ProductName`, `CategoryName`i `UnitPrice`) i CheckBoxField (`Discontinued`).</span><span class="sxs-lookup"><span data-stu-id="f9c07-161">At this point the GridView has three BoundFields (`ProductName`, `CategoryName`, and `UnitPrice`) and a CheckBoxField (`Discontinued`).</span></span> <span data-ttu-id="f9c07-162">Musimy przekonwertować te cztery pola na używanie TemplateField, a następnie przenieść interfejs edycji z TemplateField s `EditItemTemplate` do jego `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="f9c07-162">We need to convert these four fields into TemplateFields and then move the editing interface from the TemplateField s `EditItemTemplate` to its `ItemTemplate`.</span></span>

> [!NOTE]
> <span data-ttu-id="f9c07-163">Zbadamy tworzenie i dostosowywanie używanie TemplateField w samouczku [Dostosowywanie interfejsu modyfikacji danych](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) .</span><span class="sxs-lookup"><span data-stu-id="f9c07-163">We explored creating and customizing TemplateFields in the [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) tutorial.</span></span> <span data-ttu-id="f9c07-164">Przeprowadzimy procedurę konwertowania BoundFields i CheckBoxField na używanie TemplateField i definiując ich interfejsy edycji w `ItemTemplate` s, ale w przypadku zablokowania lub potrzeby odświeżacza, nie niechętnie zezwalają, aby odwołać się do tego wcześniejszego samouczka.</span><span class="sxs-lookup"><span data-stu-id="f9c07-164">We'll walk through the steps of converting the BoundFields and CheckBoxField into TemplateFields and defining their editing interfaces in their `ItemTemplate` s, but if you get stuck or need a refresher, don t hesitate to refer back to this earlier tutorial.</span></span>

<span data-ttu-id="f9c07-165">W tagu inteligentnym GridView kliknij link Edytuj kolumny, aby otworzyć okno dialogowe pola.</span><span class="sxs-lookup"><span data-stu-id="f9c07-165">From the GridView s smart tag, click the Edit Columns link to open the Fields dialog box.</span></span> <span data-ttu-id="f9c07-166">Następnie zaznacz każde pole i kliknij łącze Konwertuj to pole na TemplateField.</span><span class="sxs-lookup"><span data-stu-id="f9c07-166">Next, select each field and click the Convert this field into a TemplateField link.</span></span>

![Konwertuj istniejące BoundFields i CheckBoxField na TemplateField](batch-updating-cs/_static/image5.gif)

<span data-ttu-id="f9c07-168">**Rysunek 5**. Konwersja istniejących BoundFields i CheckBoxField na TemplateField</span><span class="sxs-lookup"><span data-stu-id="f9c07-168">**Figure 5**: Convert the Existing BoundFields and CheckBoxField Into TemplateField</span></span>

<span data-ttu-id="f9c07-169">Teraz, gdy każde pole jest TemplateField, przygotowano do przeniesienia interfejsu edycji z `EditItemTemplate` s do `ItemTemplate` s.</span><span class="sxs-lookup"><span data-stu-id="f9c07-169">Now that each field is a TemplateField, we re ready to move the editing interface from the `EditItemTemplate` s to the `ItemTemplate` s.</span></span>

## <a name="step-2-creating-theproductnameunitprice-anddiscontinuedediting-interfaces"></a><span data-ttu-id="f9c07-170">Krok 2. tworzenie interfejsów`ProductName`,`UnitPrice`i`Discontinued`edytowania</span><span class="sxs-lookup"><span data-stu-id="f9c07-170">Step 2: Creating the`ProductName`,`UnitPrice`, and`Discontinued`Editing Interfaces</span></span>

<span data-ttu-id="f9c07-171">Tworzenie `ProductName`, `UnitPrice`i `Discontinued` interfejsów edytowania jest tematem tego kroku i są dość proste, ponieważ każdy interfejs jest już zdefiniowany w `EditItemTemplate`TemplateField s.</span><span class="sxs-lookup"><span data-stu-id="f9c07-171">Creating the `ProductName`, `UnitPrice`, and `Discontinued` editing interfaces are the topic of this step and are pretty straightforward, as each interface is already defined in the TemplateField s `EditItemTemplate`.</span></span> <span data-ttu-id="f9c07-172">Tworzenie `CategoryName` interfejsu edytowania jest nieco bardziej zaliczane, ponieważ musimy utworzyć DropDownList odpowiednich kategorii.</span><span class="sxs-lookup"><span data-stu-id="f9c07-172">Creating the `CategoryName` editing interface is a bit more involved since we need to create a DropDownList of the applicable categories.</span></span> <span data-ttu-id="f9c07-173">Ten interfejs `CategoryName` edytowania jest omawiany w kroku 3.</span><span class="sxs-lookup"><span data-stu-id="f9c07-173">This `CategoryName` editing interface is tackled in Step 3.</span></span>

<span data-ttu-id="f9c07-174">Zacznij od `ProductName` TemplateField.</span><span class="sxs-lookup"><span data-stu-id="f9c07-174">Let s start with the `ProductName` TemplateField.</span></span> <span data-ttu-id="f9c07-175">Kliknij link Edytuj szablony z tagu inteligentnego GridView s i przejdź do szczegółów `ProductName` TemplateField s `EditItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="f9c07-175">Click on the Edit Templates link from the GridView s smart tag and drill down to the `ProductName` TemplateField s `EditItemTemplate`.</span></span> <span data-ttu-id="f9c07-176">Zaznacz pole tekstowe, skopiuj je do schowka, a następnie wklej je do `ProductName` TemplateField s `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="f9c07-176">Select the TextBox, copy it to the clipboard, and then paste it to the `ProductName` TemplateField s `ItemTemplate`.</span></span> <span data-ttu-id="f9c07-177">Zmień właściwość TextBox s `ID` na `ProductName`.</span><span class="sxs-lookup"><span data-stu-id="f9c07-177">Change the TextBox s `ID` property to `ProductName`.</span></span>

<span data-ttu-id="f9c07-178">Następnie Dodaj RequiredFieldValidator do `ItemTemplate`, aby upewnić się, że użytkownik poda wartość dla każdej nazwy produktu.</span><span class="sxs-lookup"><span data-stu-id="f9c07-178">Next, add a RequiredFieldValidator to the `ItemTemplate` to ensure that the user provides a value for each product s name.</span></span> <span data-ttu-id="f9c07-179">Ustaw właściwość `ControlToValidate` na ProductName, właściwość `ErrorMessage` na wartość należy podać nazwę produktu.</span><span class="sxs-lookup"><span data-stu-id="f9c07-179">Set the `ControlToValidate` property to ProductName, the `ErrorMessage` property to You must provide the product's name.</span></span> <span data-ttu-id="f9c07-180">i Właściwość `Text`, aby \*.</span><span class="sxs-lookup"><span data-stu-id="f9c07-180">and the `Text` property to \*.</span></span> <span data-ttu-id="f9c07-181">Po wprowadzeniu tych dodatków do `ItemTemplate`ekran powinien wyglądać podobnie do rysunku 6.</span><span class="sxs-lookup"><span data-stu-id="f9c07-181">After making these additions to the `ItemTemplate`, your screen should look similar to Figure 6.</span></span>

<span data-ttu-id="f9c07-182">[![ProductName TemplateField teraz zawiera pole tekstowe i RequiredFieldValidator](batch-updating-cs/_static/image6.gif)](batch-updating-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="f9c07-182">[![The ProductName TemplateField Now Includes a TextBox and a RequiredFieldValidator](batch-updating-cs/_static/image6.gif)](batch-updating-cs/_static/image9.png)</span></span>

<span data-ttu-id="f9c07-183">**Ilustracja 6**. `ProductName` TemplateField teraz zawiera pole tekstowe i RequiredFieldValidator ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](batch-updating-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="f9c07-183">**Figure 6**: The `ProductName` TemplateField Now Includes a TextBox and a RequiredFieldValidator ([Click to view full-size image](batch-updating-cs/_static/image10.png))</span></span>

<span data-ttu-id="f9c07-184">Dla interfejsu edycji `UnitPrice` Zacznij od skopiowania pola tekstowego z `EditItemTemplate` do `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="f9c07-184">For the `UnitPrice` editing interface, start by copying the TextBox from the `EditItemTemplate` to the `ItemTemplate`.</span></span> <span data-ttu-id="f9c07-185">Następnie umieść $ na początku pola tekstowego i ustaw jego właściwość `ID` na CenaJednostkowa i Właściwość `Columns` na 8.</span><span class="sxs-lookup"><span data-stu-id="f9c07-185">Next, place a $ in front of the TextBox and set its `ID` property to UnitPrice and its `Columns` property to 8 .</span></span>

<span data-ttu-id="f9c07-186">Dodaj także CompareValidator do `ItemTemplate` `UnitPrice`, aby upewnić się, że wartość wprowadzona przez użytkownika jest prawidłową wartością waluty większą lub równą $0,00.</span><span class="sxs-lookup"><span data-stu-id="f9c07-186">Also add a CompareValidator to the `UnitPrice` s `ItemTemplate` to ensure that the value entered by the user is a valid currency value greater than or equal to $0.00.</span></span> <span data-ttu-id="f9c07-187">Ustaw właściwość `ControlToValidate` modułu sprawdzania poprawności na wartość CenaJednostkowa, jej Właściwość `ErrorMessage` na wartość, a następnie wprowadź poprawną walutę.</span><span class="sxs-lookup"><span data-stu-id="f9c07-187">Set the validator s `ControlToValidate` property to UnitPrice, its `ErrorMessage` property to You must enter a valid currency value.</span></span> <span data-ttu-id="f9c07-188">Pomiń wszystkie symbole walut. Właściwość `Text` do \*, jej Właściwość `Type` do `Currency`, jej Właściwość `Operator` do `GreaterThanEqual`, a jej Właściwość `ValueToCompare` równa 0.</span><span class="sxs-lookup"><span data-stu-id="f9c07-188">Please omit any currency symbols., its `Text` property to \*, its `Type` property to `Currency`, its `Operator` property to `GreaterThanEqual`, and its `ValueToCompare` property to 0 .</span></span>

<span data-ttu-id="f9c07-189">[![dodać CompareValidator, aby upewnić się, że wprowadzona cena jest wartością nieujemną waluty](batch-updating-cs/_static/image7.gif)](batch-updating-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="f9c07-189">[![Add a CompareValidator to Ensure the Price Entered is a Non-Negative Currency Value](batch-updating-cs/_static/image7.gif)](batch-updating-cs/_static/image11.png)</span></span>

<span data-ttu-id="f9c07-190">**Rysunek 7**. Dodawanie CompareValidator, aby upewnić się, że wprowadzona cena jest wartością nieujemnej waluty ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](batch-updating-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="f9c07-190">**Figure 7**: Add a CompareValidator to Ensure the Price Entered is a Non-Negative Currency Value ([Click to view full-size image](batch-updating-cs/_static/image12.png))</span></span>

<span data-ttu-id="f9c07-191">Dla `Discontinued` TemplateField można użyć pola wyboru już zdefiniowanego w `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="f9c07-191">For the `Discontinued` TemplateField you can use the CheckBox already defined in the `ItemTemplate`.</span></span> <span data-ttu-id="f9c07-192">Po prostu ustaw jej `ID` na niekontynuację i Właściwość `Enabled` do `true`.</span><span class="sxs-lookup"><span data-stu-id="f9c07-192">Simply set its `ID` to Discontinued and its `Enabled` property to `true`.</span></span>

## <a name="step-3-creating-thecategorynameediting-interface"></a><span data-ttu-id="f9c07-193">Krok 3. Tworzenie interfejsu edycji`CategoryName`</span><span class="sxs-lookup"><span data-stu-id="f9c07-193">Step 3: Creating the`CategoryName`Editing Interface</span></span>

<span data-ttu-id="f9c07-194">Interfejs edycji w `CategoryName` TemplateField s `EditItemTemplate` zawiera pole tekstowe, w którym jest wyświetlana wartość pola danych `CategoryName`.</span><span class="sxs-lookup"><span data-stu-id="f9c07-194">The editing interface in the `CategoryName` TemplateField s `EditItemTemplate` contains a TextBox that displays the value of the `CategoryName` data field.</span></span> <span data-ttu-id="f9c07-195">Musimy zastąpić ten element DropDownList, który zawiera listę możliwych kategorii.</span><span class="sxs-lookup"><span data-stu-id="f9c07-195">We need to replace this with a DropDownList that lists the possible categories.</span></span>

> [!NOTE]
> <span data-ttu-id="f9c07-196">Samouczek [Dostosowywanie interfejsu modyfikacji danych](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) zawiera bardziej szczegółowe i kompletne Omówienie dostosowywania szablonu w celu uwzględnienia DropDownList, w przeciwieństwie do pola tekstowego.</span><span class="sxs-lookup"><span data-stu-id="f9c07-196">The [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) tutorial contains a more thorough and complete discussion on customizing a template to include a DropDownList as opposed to a TextBox.</span></span> <span data-ttu-id="f9c07-197">Po wykonaniu tych czynności są one prezentowane w tersely.</span><span class="sxs-lookup"><span data-stu-id="f9c07-197">While the steps here are complete, they are presented tersely.</span></span> <span data-ttu-id="f9c07-198">Dokładniejsze omówienie tworzenia i konfigurowania kategorii DropDownList można znaleźć w samouczku [Dostosowywanie interfejsu modyfikacji danych](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) .</span><span class="sxs-lookup"><span data-stu-id="f9c07-198">For a more in-depth look at creating and configuring the categories DropDownList, refer back to the [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) tutorial.</span></span>

<span data-ttu-id="f9c07-199">Przeciągnij DropDownList z przybornika do `ItemTemplate``CategoryName` TemplateField s, ustawiając `ID` na `Categories`.</span><span class="sxs-lookup"><span data-stu-id="f9c07-199">Drag a DropDownList from the Toolbox onto the `CategoryName` TemplateField s `ItemTemplate`, setting its `ID` to `Categories`.</span></span> <span data-ttu-id="f9c07-200">W tym momencie zwykle definiujemy źródło danych kontrolek DropDownList s za pomocą jego tagu inteligentnego, tworząc nowy element ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="f9c07-200">At this point we would usually define the DropDownLists s data source through its smart tag, creating a new ObjectDataSource.</span></span> <span data-ttu-id="f9c07-201">Jednak spowoduje to dodanie elementu ObjectDataSource w ramach `ItemTemplate`, co spowoduje utworzenie wystąpienia klasy ObjectDataSource dla każdego wiersza GridView.</span><span class="sxs-lookup"><span data-stu-id="f9c07-201">However, this will add the ObjectDataSource within the `ItemTemplate`, which will result in an ObjectDataSource instance created for each GridView row.</span></span> <span data-ttu-id="f9c07-202">Zamiast tego należy utworzyć element ObjectDataSource poza używanie TemplateField GridView.</span><span class="sxs-lookup"><span data-stu-id="f9c07-202">Instead, let s create the ObjectDataSource outside of the GridView s TemplateFields.</span></span> <span data-ttu-id="f9c07-203">Zakończ edycję szablonu i przeciągnij element ObjectDataSource z przybornika do projektanta znajdującego się pod `ProductsDataSource` elemencie ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="f9c07-203">End the template editing and drag an ObjectDataSource from the Toolbox onto the Designer beneath the `ProductsDataSource` ObjectDataSource.</span></span> <span data-ttu-id="f9c07-204">Nazwij nowy element ObjectDataSource `CategoriesDataSource` i skonfiguruj go tak, aby korzystał z metody `GetCategories` klasy `CategoriesBLL`.</span><span class="sxs-lookup"><span data-stu-id="f9c07-204">Name the new ObjectDataSource `CategoriesDataSource` and configure it to use the `CategoriesBLL` class s `GetCategories` method.</span></span>

<span data-ttu-id="f9c07-205">[![skonfigurować element ObjectDataSource do używania klasy CategoriesBLL](batch-updating-cs/_static/image8.gif)](batch-updating-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="f9c07-205">[![Configure the ObjectDataSource to Use the CategoriesBLL Class](batch-updating-cs/_static/image8.gif)](batch-updating-cs/_static/image13.png)</span></span>

<span data-ttu-id="f9c07-206">**Ilustracja 8**. Konfigurowanie elementu ObjectDataSource do używania klasy `CategoriesBLL` ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](batch-updating-cs/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="f9c07-206">**Figure 8**: Configure the ObjectDataSource to Use the `CategoriesBLL` Class ([Click to view full-size image](batch-updating-cs/_static/image14.png))</span></span>

<span data-ttu-id="f9c07-207">[![pobrać danych kategorii za pomocą metody getcategorys](batch-updating-cs/_static/image9.gif)](batch-updating-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="f9c07-207">[![Retrieve the Category Data Using the GetCategories Method](batch-updating-cs/_static/image9.gif)](batch-updating-cs/_static/image15.png)</span></span>

<span data-ttu-id="f9c07-208">**Ilustracja 9**. Pobieranie danych kategorii za pomocą metody `GetCategories` ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](batch-updating-cs/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="f9c07-208">**Figure 9**: Retrieve the Category Data Using the `GetCategories` Method ([Click to view full-size image](batch-updating-cs/_static/image16.png))</span></span>

<span data-ttu-id="f9c07-209">Ponieważ ten element ObjectDataSource jest używany wyłącznie do pobierania danych, Ustaw listę rozwijaną na kartach Aktualizuj i Usuń na (brak).</span><span class="sxs-lookup"><span data-stu-id="f9c07-209">Since this ObjectDataSource is used merely to retrieve data, set the drop-down lists in the UPDATE and DELETE tabs to (None).</span></span> <span data-ttu-id="f9c07-210">Kliknij przycisk Zakończ, aby zakończyć pracę kreatora.</span><span class="sxs-lookup"><span data-stu-id="f9c07-210">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="f9c07-211">[![ustawić listy rozwijane na kartach Aktualizuj i Usuń do (brak)](batch-updating-cs/_static/image10.gif)](batch-updating-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="f9c07-211">[![Set the Drop-Down Lists in the UPDATE and DELETE Tabs to (None)](batch-updating-cs/_static/image10.gif)](batch-updating-cs/_static/image17.png)</span></span>

<span data-ttu-id="f9c07-212">**Ilustracja 10**. Ustawianie list rozwijanych na kartach Aktualizuj i Usuń do (brak) ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](batch-updating-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="f9c07-212">**Figure 10**: Set the Drop-Down Lists in the UPDATE and DELETE Tabs to (None) ([Click to view full-size image](batch-updating-cs/_static/image18.png))</span></span>

<span data-ttu-id="f9c07-213">Po zakończeniu działania kreatora, znaczniki deklaratywne `CategoriesDataSource` s powinny wyglądać następująco:</span><span class="sxs-lookup"><span data-stu-id="f9c07-213">After completing the wizard, the `CategoriesDataSource` s declarative markup should look like the following:</span></span>

[!code-aspx[Main](batch-updating-cs/samples/sample2.aspx)]

<span data-ttu-id="f9c07-214">Po utworzeniu i skonfigurowaniu `CategoriesDataSource` Wróć do `CategoryName` TemplateField s `ItemTemplate` i z taga inteligentnego DropDownList s kliknij link wybierz źródło danych.</span><span class="sxs-lookup"><span data-stu-id="f9c07-214">With the `CategoriesDataSource` created and configured, return to the `CategoryName` TemplateField s `ItemTemplate` and, from the DropDownList s smart tag, click on the Choose Data Source link.</span></span> <span data-ttu-id="f9c07-215">W Kreatorze konfiguracji źródła danych wybierz opcję `CategoriesDataSource` z pierwszej listy rozwijanej i wybierz, aby `CategoryName` do wyświetlania i `CategoryID` jako wartość.</span><span class="sxs-lookup"><span data-stu-id="f9c07-215">In the Data Source Configuration wizard, select the `CategoriesDataSource` option from the first drop-down list and choose to have `CategoryName` used for the display and `CategoryID` as the value.</span></span>

<span data-ttu-id="f9c07-216">[![powiązać DropDownList z CategoriesDataSource](batch-updating-cs/_static/image11.gif)](batch-updating-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="f9c07-216">[![Bind the DropDownList to the CategoriesDataSource](batch-updating-cs/_static/image11.gif)](batch-updating-cs/_static/image19.png)</span></span>

<span data-ttu-id="f9c07-217">**Ilustracja 11**. powiązanie DropDownList z `CategoriesDataSource` ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](batch-updating-cs/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="f9c07-217">**Figure 11**: Bind the DropDownList to the `CategoriesDataSource` ([Click to view full-size image](batch-updating-cs/_static/image20.png))</span></span>

<span data-ttu-id="f9c07-218">W tym momencie `Categories` DropDownList wyświetla wszystkie kategorie, ale nie jest jeszcze automatycznie wybierać odpowiedniej kategorii dla produktu powiązanego z wierszem GridView.</span><span class="sxs-lookup"><span data-stu-id="f9c07-218">At this point the `Categories` DropDownList lists all of the categories, but it does not yet automatically select the appropriate category for the product bound to the GridView row.</span></span> <span data-ttu-id="f9c07-219">Aby to osiągnąć, należy ustawić `Categories` DropDownList s `SelectedValue` na wartość `CategoryID` produktu.</span><span class="sxs-lookup"><span data-stu-id="f9c07-219">To accomplish this we need to set the `Categories` DropDownList s `SelectedValue` to the product s `CategoryID` value.</span></span> <span data-ttu-id="f9c07-220">Kliknij link Edytuj powiązania danych z tagu inteligentnego DropDownList s i Skojarz właściwość `SelectedValue` z polem danych `CategoryID`, jak pokazano na rysunku 12.</span><span class="sxs-lookup"><span data-stu-id="f9c07-220">Click on the Edit DataBindings link from the DropDownList s smart tag and associate the `SelectedValue` property with the `CategoryID` data field as shown in Figure 12.</span></span>

![Powiąż wartość IDKategorii produktu z właściwością DropDownList s SelectedValue](batch-updating-cs/_static/image12.gif)

<span data-ttu-id="f9c07-222">**Rysunek 12**. Powiąż wartość `CategoryID` produktu z właściwością DropDownList s `SelectedValue`</span><span class="sxs-lookup"><span data-stu-id="f9c07-222">**Figure 12**: Bind the Product s `CategoryID` Value to the DropDownList s `SelectedValue` Property</span></span>

<span data-ttu-id="f9c07-223">Ten ostatni problem pozostaje: Jeśli produkt nie ma określonej wartości `CategoryID`, instrukcja DataBinding na `SelectedValue` spowoduje wyjątek.</span><span class="sxs-lookup"><span data-stu-id="f9c07-223">One last problem remains: if the product doesn t have a `CategoryID` value specified then the databinding statement on `SelectedValue` will result in an exception.</span></span> <span data-ttu-id="f9c07-224">Wynika to z faktu, że DropDownList zawiera tylko elementy dla kategorii i nie oferuje opcji dla tych produktów, które mają `NULL` wartość bazy danych dla `CategoryID`.</span><span class="sxs-lookup"><span data-stu-id="f9c07-224">This is because the DropDownList contains only items for the categories and does not offer an option for those products that have a `NULL` database value for `CategoryID`.</span></span> <span data-ttu-id="f9c07-225">Aby to naprawić, ustaw właściwość DropDownList `AppendDataBoundItems` s na `true` i Dodaj nowy element do DropDownList, pomijając Właściwość `Value` ze składni deklaracyjnej.</span><span class="sxs-lookup"><span data-stu-id="f9c07-225">To remedy this, set the DropDownList s `AppendDataBoundItems` property to `true` and add a new item to the DropDownList, omitting the `Value` property from the declarative syntax.</span></span> <span data-ttu-id="f9c07-226">Oznacza to, że składnia deklaracyjne `Categories` DropDownList s wygląda następująco:</span><span class="sxs-lookup"><span data-stu-id="f9c07-226">That is, make sure that the `Categories` DropDownList s declarative syntax looks like the following:</span></span>

[!code-aspx[Main](batch-updating-cs/samples/sample3.aspx)]

<span data-ttu-id="f9c07-227">Zauważ, jak `<asp:ListItem Value="">` — wybierz jeden — ma atrybut `Value` jawnie ustawiony jako pusty ciąg.</span><span class="sxs-lookup"><span data-stu-id="f9c07-227">Note how the `<asp:ListItem Value="">` -- Select One -- has its `Value` attribute explicitly set to an empty string.</span></span> <span data-ttu-id="f9c07-228">Zapoznaj się z artykułem [Dostosowywanie interfejsu modyfikacji danych](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) , aby zapoznać się z bardziej dokładną dyskusją na temat tego, dlaczego dodatkowy element DropDownList jest wymagany do obsługi przypadku `NULL` i dlaczego przypisanie właściwości `Value` do pustego ciągu jest niezbędne.</span><span class="sxs-lookup"><span data-stu-id="f9c07-228">Refer back to the [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) tutorial for a more thorough discussion on why this additional DropDownList item is needed to handle the `NULL` case and why assignment of the `Value` property to an empty string is essential.</span></span>

> [!NOTE]
> <span data-ttu-id="f9c07-229">W tym miejscu istnieje potencjalne problemy dotyczące wydajności i skalowalności.</span><span class="sxs-lookup"><span data-stu-id="f9c07-229">There is a potential performance and scalability issue here that is worth mentioning.</span></span> <span data-ttu-id="f9c07-230">Ponieważ każdy wiersz ma DropDownList, który używa `CategoriesDataSource` jako źródła danych, Metoda `CategoriesBLL` klasy s `GetCategories` będzie wywoływana *n* razy na stronie, gdzie *n* to liczba wierszy w GridView.</span><span class="sxs-lookup"><span data-stu-id="f9c07-230">Since each row has a DropDownList that uses the `CategoriesDataSource` as its data source, the `CategoriesBLL` class s `GetCategories` method will be called *n* times per page visit, where *n* is the number of rows in the GridView.</span></span> <span data-ttu-id="f9c07-231">Te *n* wywołania do `GetCategories` powodują, że w *n* zapytania do bazy danych.</span><span class="sxs-lookup"><span data-stu-id="f9c07-231">These *n* calls to `GetCategories` result in *n* queries to the database.</span></span> <span data-ttu-id="f9c07-232">Ten wpływ na bazę danych można zmniejszyć przez buforowanie zwracanych kategorii w pamięci podręcznej żądania lub za pośrednictwem warstwy buforowania przy użyciu zależności pamięci podręcznej SQL lub bardzo krótki czas wygaśnięcia.</span><span class="sxs-lookup"><span data-stu-id="f9c07-232">This impact on the database could be lessened by caching the returned categories either in a per-request cache or through the Caching Layer using a SQL caching dependency or a very short time-based expiry.</span></span> <span data-ttu-id="f9c07-233">Aby uzyskać więcej informacji na temat opcji buforowania na żądanie, zobacz [`HttpContext.Items` magazynu pamięci podręcznej na żądanie](http://aspnet.4guysfromrolla.com/articles/060904-1.aspx).</span><span class="sxs-lookup"><span data-stu-id="f9c07-233">For more information on the per-request caching option, see [`HttpContext.Items` a Per-Request Cache Store](http://aspnet.4guysfromrolla.com/articles/060904-1.aspx).</span></span>

## <a name="step-4-completing-the-editing-interface"></a><span data-ttu-id="f9c07-234">Krok 4. Korzystanie z interfejsu edycji</span><span class="sxs-lookup"><span data-stu-id="f9c07-234">Step 4: Completing the Editing Interface</span></span>

<span data-ttu-id="f9c07-235">Wprowadziliśmy wiele zmian w szablonach GridView i nie wstrzymuje się w celu wyświetlenia naszego postępu.</span><span class="sxs-lookup"><span data-stu-id="f9c07-235">We ve made a number of changes to the GridView s templates without pausing to view our progress.</span></span> <span data-ttu-id="f9c07-236">Poświęć chwilę na wyświetlenie postępu w przeglądarce.</span><span class="sxs-lookup"><span data-stu-id="f9c07-236">Take a moment to view our progress through a browser.</span></span> <span data-ttu-id="f9c07-237">Jak pokazano na rysunku 13, każdy wiersz jest renderowany przy użyciu `ItemTemplate`, który zawiera interfejs edycji komórki.</span><span class="sxs-lookup"><span data-stu-id="f9c07-237">As Figure 13 shows, each row is rendered using its `ItemTemplate`, which contains the cell s editing interface.</span></span>

<span data-ttu-id="f9c07-238">[![każdy wiersz GridView jest edytowalny](batch-updating-cs/_static/image13.gif)](batch-updating-cs/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="f9c07-238">[![Each GridView Row is Editable](batch-updating-cs/_static/image13.gif)](batch-updating-cs/_static/image21.png)</span></span>

<span data-ttu-id="f9c07-239">**Ilustracja 13**. Każdy wiersz GridView jest edytowalny ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](batch-updating-cs/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="f9c07-239">**Figure 13**: Each GridView Row is Editable ([Click to view full-size image](batch-updating-cs/_static/image22.png))</span></span>

<span data-ttu-id="f9c07-240">Istnieje kilka drobnych problemów z formatowaniem, które należy zachować na tym etapie.</span><span class="sxs-lookup"><span data-stu-id="f9c07-240">There are a few minor formatting issues that we should take care of at this point.</span></span> <span data-ttu-id="f9c07-241">Najpierw należy zauważyć, że wartość `UnitPrice` zawiera cztery dziesiętne punkty.</span><span class="sxs-lookup"><span data-stu-id="f9c07-241">First, note that the `UnitPrice` value contains four decimal points.</span></span> <span data-ttu-id="f9c07-242">Aby rozwiązać ten problem, Wróć do `UnitPrice` TemplateField s `ItemTemplate` i z taga HTML TextBox s kliknij łącze Edytuj powiązania danych.</span><span class="sxs-lookup"><span data-stu-id="f9c07-242">To fix this, return to the `UnitPrice` TemplateField s `ItemTemplate` and, from the TextBox s smart tag, click on the Edit DataBindings link.</span></span> <span data-ttu-id="f9c07-243">Następnie określ, że właściwość `Text` powinna być sformatowana jako liczba.</span><span class="sxs-lookup"><span data-stu-id="f9c07-243">Next, specify that the `Text` property should be formatted as a number.</span></span>

![Sformatuj właściwość Text jako liczbę](batch-updating-cs/_static/image14.gif)

<span data-ttu-id="f9c07-245">**Ilustracja 14**. formatowanie właściwości `Text` jako liczby</span><span class="sxs-lookup"><span data-stu-id="f9c07-245">**Figure 14**: Format the `Text` Property as a Number</span></span>

<span data-ttu-id="f9c07-246">Po drugie, Zezwól na wyśrodkowanie pola wyboru w kolumnie `Discontinued` (zamiast wyrównania do lewej).</span><span class="sxs-lookup"><span data-stu-id="f9c07-246">Second, let s center the checkbox in the `Discontinued` column (rather than having it left-aligned).</span></span> <span data-ttu-id="f9c07-247">Kliknij pozycję Edytuj kolumny w tagu inteligentnym GridView s i wybierz `Discontinued` TemplateField z listy pól w lewym dolnym rogu.</span><span class="sxs-lookup"><span data-stu-id="f9c07-247">Click on Edit Columns from the GridView s smart tag and select the `Discontinued` TemplateField from the list of fields in the bottom left corner.</span></span> <span data-ttu-id="f9c07-248">Przejdź do szczegółów `ItemStyle` i ustaw właściwość `HorizontalAlign` na Wyśrodkuj, jak pokazano na rysunku 15.</span><span class="sxs-lookup"><span data-stu-id="f9c07-248">Drill down into `ItemStyle` and set the `HorizontalAlign` property to Center as shown in Figure 15.</span></span>

![Wyśrodkuj pole wyboru](batch-updating-cs/_static/image15.gif)

<span data-ttu-id="f9c07-250">**Ilustracja 15**. wyśrodkowanie pola wyboru `Discontinued`</span><span class="sxs-lookup"><span data-stu-id="f9c07-250">**Figure 15**: Center the `Discontinued` CheckBox</span></span>

<span data-ttu-id="f9c07-251">Następnie Dodaj kontrolkę podsumowania walidacji do strony i ustaw jej Właściwość `ShowMessageBox` na `true` i jej Właściwość `ShowSummary` na `false`.</span><span class="sxs-lookup"><span data-stu-id="f9c07-251">Next, add a ValidationSummary control to the page and set its `ShowMessageBox` property to `true` and its `ShowSummary` property to `false`.</span></span> <span data-ttu-id="f9c07-252">Dodaj również kontrolki sieci Web przycisku, które po kliknięciu spowodują zaktualizowanie zmian użytkownika.</span><span class="sxs-lookup"><span data-stu-id="f9c07-252">Also add the Button Web controls that, when clicked, will update the user s changes.</span></span> <span data-ttu-id="f9c07-253">W tym celu Dodaj dwa kontrolki sieci Web Button, jeden nad GridView i jeden poniżej, ustawienie obydwu formantów `Text` właściwości, aby zaktualizować produkty.</span><span class="sxs-lookup"><span data-stu-id="f9c07-253">Specifically, add two Button Web controls, one above the GridView and one below it, setting both controls `Text` properties to Update Products .</span></span>

<span data-ttu-id="f9c07-254">Ponieważ interfejs edytowania GridView jest zdefiniowany w używanie TemplateField `ItemTemplate` s, `EditItemTemplate` s są zbędne i mogą zostać usunięte.</span><span class="sxs-lookup"><span data-stu-id="f9c07-254">Since the GridView s editing interface is defined in its TemplateFields `ItemTemplate` s, the `EditItemTemplate` s are superfluous and may be deleted.</span></span>

<span data-ttu-id="f9c07-255">Po wprowadzeniu powyżej określonego formatowania, dodania kontrolek przycisk i usunięciu niepotrzebnych `EditItemTemplate` s, składnia deklaracyjnej strony powinna wyglądać następująco:</span><span class="sxs-lookup"><span data-stu-id="f9c07-255">After making the above mentioned formatting changes, adding the Button controls, and removing the unnecessary `EditItemTemplate` s, your page s declarative syntax should look like the following:</span></span>

[!code-aspx[Main](batch-updating-cs/samples/sample4.aspx)]

<span data-ttu-id="f9c07-256">Rysunek 16 pokazuje Tę stronę, gdy oglądasz za pomocą przeglądarki po dodaniu kontrolek sieci Web przycisku i wprowadzeniu zmian formatowania.</span><span class="sxs-lookup"><span data-stu-id="f9c07-256">Figure 16 shows this page when viewed through a browser after the Button Web controls have been added and the formatting changes made.</span></span>

<span data-ttu-id="f9c07-257">[![Strona zawiera teraz dwa przyciski aktualizacji produktów](batch-updating-cs/_static/image16.gif)](batch-updating-cs/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="f9c07-257">[![The Page Now Includes Two Update Products Buttons](batch-updating-cs/_static/image16.gif)](batch-updating-cs/_static/image23.png)</span></span>

<span data-ttu-id="f9c07-258">**Ilustracja 16**. Strona zawiera teraz dwa przyciski aktualizacji produktów ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](batch-updating-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="f9c07-258">**Figure 16**: The Page Now Includes Two Update Products Buttons ([Click to view full-size image](batch-updating-cs/_static/image24.png))</span></span>

## <a name="step-5-updating-the-products"></a><span data-ttu-id="f9c07-259">Krok 5. aktualizowanie produktów</span><span class="sxs-lookup"><span data-stu-id="f9c07-259">Step 5: Updating the Products</span></span>

<span data-ttu-id="f9c07-260">Gdy użytkownik odwiedza tę stronę, wprowadzi zmiany, a następnie klika jeden z dwóch przycisków aktualizacji produktów.</span><span class="sxs-lookup"><span data-stu-id="f9c07-260">When a user visits this page they will make their modifications and then click one of the two Update Products buttons.</span></span> <span data-ttu-id="f9c07-261">W tym momencie musimy w jakiś sposób zapisać wartości wprowadzone przez użytkownika dla każdego wiersza w wystąpieniu `ProductsDataTable`, a następnie przekazać je do metody LOGIKI biznesowej, która następnie przekaże to wystąpienie `ProductsDataTable` do metody `UpdateWithTransaction` DAL.</span><span class="sxs-lookup"><span data-stu-id="f9c07-261">At that point we need to somehow save the user-entered values for each row into a `ProductsDataTable` instance and then pass that to a BLL method that will then pass that `ProductsDataTable` instance to the DAL s `UpdateWithTransaction` method.</span></span> <span data-ttu-id="f9c07-262">Metoda `UpdateWithTransaction`, która została utworzona w [poprzednim samouczku](wrapping-database-modifications-within-a-transaction-cs.md), zapewnia, że partia zmian zostanie zaktualizowana jako operacja niepodzielna.</span><span class="sxs-lookup"><span data-stu-id="f9c07-262">The `UpdateWithTransaction` method, which we created in the [preceding tutorial](wrapping-database-modifications-within-a-transaction-cs.md), ensures that the batch of changes will be updated as an atomic operation.</span></span>

<span data-ttu-id="f9c07-263">Utwórz metodę o nazwie `BatchUpdate` w `BatchUpdate.aspx.cs` i Dodaj następujący kod:</span><span class="sxs-lookup"><span data-stu-id="f9c07-263">Create a method named `BatchUpdate` in `BatchUpdate.aspx.cs` and add the following code:</span></span>

[!code-csharp[Main](batch-updating-cs/samples/sample5.cs)]

<span data-ttu-id="f9c07-264">Ta metoda rozpoczyna się od pobrania wszystkich produktów z powrotem w `ProductsDataTable` za pośrednictwem wywołania metody `GetProducts` LOGIKI biznesowej s.</span><span class="sxs-lookup"><span data-stu-id="f9c07-264">This method starts out by getting all of the products back in a `ProductsDataTable` via a call to the BLL s `GetProducts` method.</span></span> <span data-ttu-id="f9c07-265">Następnie wylicza `ProductGrid` [`Rows`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rows(VS.80).aspx)GridView.</span><span class="sxs-lookup"><span data-stu-id="f9c07-265">It then enumerates the `ProductGrid` GridView s [`Rows` collection](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rows(VS.80).aspx).</span></span> <span data-ttu-id="f9c07-266">Kolekcja `Rows` zawiera [wystąpienie`GridViewRow`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewrow.aspx) dla każdego wiersza wyświetlanego w widoku GridView.</span><span class="sxs-lookup"><span data-stu-id="f9c07-266">The `Rows` collection contains a [`GridViewRow` instance](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewrow.aspx) for each row displayed in the GridView.</span></span> <span data-ttu-id="f9c07-267">Ponieważ pokazujemy co najwyżej dziesięć wierszy na stronie, kolekcja `Rows` GridView nie będzie zawierać więcej niż dziesięciu elementów.</span><span class="sxs-lookup"><span data-stu-id="f9c07-267">Since we are showing at most ten rows per page, the GridView s `Rows` collection will have no more than ten items.</span></span>

<span data-ttu-id="f9c07-268">Dla każdego wiersza `ProductID` jest pobierana z kolekcji `DataKeys` i wybierana jest odpowiednia `ProductsRow` z `ProductsDataTable`.</span><span class="sxs-lookup"><span data-stu-id="f9c07-268">For each row the `ProductID` is grabbed from the `DataKeys` collection and the appropriate `ProductsRow` is selected from the `ProductsDataTable`.</span></span> <span data-ttu-id="f9c07-269">Cztery kontrolki danych wejściowych TemplateField są programowo przywoływane i ich wartości przypisane do właściwości wystąpienia `ProductsRow` s.</span><span class="sxs-lookup"><span data-stu-id="f9c07-269">The four TemplateField input controls are programmatically referenced and their values assigned to the `ProductsRow` instance s properties.</span></span> <span data-ttu-id="f9c07-270">Po zastosowaniu wszystkich wartości wiersza w wierszu GridView w celu zaktualizowania `ProductsDataTable`są one przenoszone do metody `UpdateWithTransaction` LOGIKI biznesowej s, która zgodnie z poprzednią częścią samouczka, po prostu wywołuje metodę `UpdateWithTransaction` DAL s.</span><span class="sxs-lookup"><span data-stu-id="f9c07-270">After each GridView row s values have been used to update the `ProductsDataTable`, it s passed to the BLL s `UpdateWithTransaction` method which, as we saw in the preceding tutorial, simply calls down into the DAL s `UpdateWithTransaction` method.</span></span>

<span data-ttu-id="f9c07-271">Algorytm aktualizacji wsadowych użyty w tym samouczku aktualizuje każdy wiersz w `ProductsDataTable`, który odnosi się do wiersza w widoku GridView, niezależnie od tego, czy informacje o produkcie zostały zmienione.</span><span class="sxs-lookup"><span data-stu-id="f9c07-271">The batch update algorithm used for this tutorial updates each row in the `ProductsDataTable` that corresponds to a row in the GridView, regardless of whether the product s information has been changed.</span></span> <span data-ttu-id="f9c07-272">Chociaż takie aktualizacje niewidome nie są zwykle przyczyną problemów z wydajnością, mogą powodować zbędne rekordy w przypadku ponownego inspekcji zmian w tabeli bazy danych.</span><span class="sxs-lookup"><span data-stu-id="f9c07-272">While such blind updates aren't usually a performance issue, they can lead to superfluous records if you re auditing changes to the database table.</span></span> <span data-ttu-id="f9c07-273">Z powrotem w samouczku [wykonywanie aktualizacji wsadowych](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-cs.md) został zbadany interfejs aktualizacji partii z elementem DataList i dodany kod, który zaktualizuje tylko te rekordy, które zostały rzeczywiście zmodyfikowane przez użytkownika.</span><span class="sxs-lookup"><span data-stu-id="f9c07-273">Back in the [Performing Batch Updates](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-cs.md) tutorial we explored a batch updating interface with the DataList and added code that would only update those records that were actually modified by the user.</span></span> <span data-ttu-id="f9c07-274">W razie potrzeby możesz korzystać z technik [przeprowadzania aktualizacji wsadowych](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-cs.md) w celu zaktualizowania kodu w tym samouczku.</span><span class="sxs-lookup"><span data-stu-id="f9c07-274">Feel free to use the techniques from [Performing Batch Updates](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-cs.md) to update the code in this tutorial, if desired.</span></span>

> [!NOTE]
> <span data-ttu-id="f9c07-275">Po powiązaniu źródła danych z GridView przez jego tag inteligentny program Visual Studio automatycznie przypisuje wartość klucza podstawowego źródła danych do właściwości GridView `DataKeyNames`.</span><span class="sxs-lookup"><span data-stu-id="f9c07-275">When binding the data source to the GridView through its smart tag, Visual Studio automatically assigns the data source s primary key value(s) to the GridView s `DataKeyNames` property.</span></span> <span data-ttu-id="f9c07-276">Jeśli element ObjectDataSource nie został powiązany ze znacznikiem GridView za pomocą tagu inteligentnego GridView s, jak opisano w kroku 1, należy ręcznie ustawić właściwość GridView s `DataKeyNames` na wartość ProductID w celu uzyskania dostępu do `ProductID` wartości dla każdego wiersza za pomocą kolekcji `DataKeys`.</span><span class="sxs-lookup"><span data-stu-id="f9c07-276">If you did not bind the ObjectDataSource to the GridView through the GridView s smart tag as outlined in Step 1, then you will need to manually set the GridView s `DataKeyNames` property to ProductID in order to access the `ProductID` value for each row through the `DataKeys` collection.</span></span>

<span data-ttu-id="f9c07-277">Kod używany w `BatchUpdate` jest podobny do tego, który został użyty w metodach `UpdateProduct` LOGIKI biznesowej. główna różnica polega na tym, że w metodach `UpdateProduct` tylko pojedyncze wystąpienie `ProductRow` jest pobierane z architektury.</span><span class="sxs-lookup"><span data-stu-id="f9c07-277">The code used in `BatchUpdate` is similar to that used in the BLL s `UpdateProduct` methods, the main difference being that in the `UpdateProduct` methods only a single `ProductRow` instance is retrieved from the architecture.</span></span> <span data-ttu-id="f9c07-278">Kod, który przypisuje właściwości `ProductRow`, jest taki sam między metodami `UpdateProducts` i kodem w pętli `foreach` w `BatchUpdate`, zgodnie z ogólnym wzorcem.</span><span class="sxs-lookup"><span data-stu-id="f9c07-278">The code that assigns the properties of the `ProductRow` is the same between the `UpdateProducts` methods and the code within the `foreach` loop in `BatchUpdate`, as is the overall pattern.</span></span>

<span data-ttu-id="f9c07-279">Aby ukończyć ten samouczek, musimy wywołać metodę `BatchUpdate`, gdy zostanie kliknięty jeden z przycisków aktualizacji produktów.</span><span class="sxs-lookup"><span data-stu-id="f9c07-279">To complete this tutorial, we need to have the `BatchUpdate` method invoked when either of the Update Products buttons is clicked.</span></span> <span data-ttu-id="f9c07-280">Utwórz programy obsługi zdarzeń dla zdarzeń `Click` tych dwóch kontrolek przycisków i Dodaj następujący kod do programów obsługi zdarzeń:</span><span class="sxs-lookup"><span data-stu-id="f9c07-280">Create event handlers for the `Click` events of these two Button controls and add the following code in the event handlers:</span></span>

[!code-csharp[Main](batch-updating-cs/samples/sample6.cs)]

<span data-ttu-id="f9c07-281">Pierwsze wywołanie jest nawiązywane do `BatchUpdate`.</span><span class="sxs-lookup"><span data-stu-id="f9c07-281">First a call is made to `BatchUpdate`.</span></span> <span data-ttu-id="f9c07-282">Następnie `ClientScript property` służy do iniekcji kodu JavaScript, który będzie wyświetlał element MessageBox, który odczytuje produkty, które zostały zaktualizowane.</span><span class="sxs-lookup"><span data-stu-id="f9c07-282">Next, the `ClientScript property` is used to inject JavaScript that will display a messagebox that reads The products have been updated.</span></span>

<span data-ttu-id="f9c07-283">Poświęć chwilę na przetestowanie tego kodu.</span><span class="sxs-lookup"><span data-stu-id="f9c07-283">Take a minute to test out this code.</span></span> <span data-ttu-id="f9c07-284">Odwiedź witrynę `BatchUpdate.aspx` za pomocą przeglądarki, Edytuj kilka wierszy, a następnie kliknij jeden z przycisków Aktualizuj produkty.</span><span class="sxs-lookup"><span data-stu-id="f9c07-284">Visit `BatchUpdate.aspx` through a browser, edit a number of rows, and click one of the Update Products buttons.</span></span> <span data-ttu-id="f9c07-285">Przy założeniu, że nie występują błędy walidacji danych wejściowych, zobaczysz element MessageBox, który odczytuje produkty, które zostały zaktualizowane.</span><span class="sxs-lookup"><span data-stu-id="f9c07-285">Assuming there are no input validation errors, you should see a messagebox that reads The products have been updated.</span></span> <span data-ttu-id="f9c07-286">Aby sprawdzić niepodzielność aktualizacji, rozważ dodanie ograniczenia `CHECK` losowego, takiego jak taki, który nie zezwala na `UnitPrice` wartości 1234,56.</span><span class="sxs-lookup"><span data-stu-id="f9c07-286">To verify the atomicity of the update, consider adding a random `CHECK` constraint, like one that disallows `UnitPrice` values of 1234.56.</span></span> <span data-ttu-id="f9c07-287">Następnie z `BatchUpdate.aspx`edytować wiele rekordów, pamiętając o ustawieniu jednej z wartości `UnitPrice` produktu na wartość zabroniona (1234,56).</span><span class="sxs-lookup"><span data-stu-id="f9c07-287">Then from `BatchUpdate.aspx`, edit a number of records, making sure to set one of the product s `UnitPrice` value to the forbidden value ( 1234.56 ).</span></span> <span data-ttu-id="f9c07-288">Powinno to spowodować błąd po kliknięciu przycisku Aktualizuj produkty z innymi zmianami w trakcie tej operacji wsadowej z powrotem do ich oryginalnych wartości.</span><span class="sxs-lookup"><span data-stu-id="f9c07-288">This should result in an error when clicking Update Products with the other changes during that batch operation rolled back to their original values.</span></span>

## <a name="an-alternativebatchupdatemethod"></a><span data-ttu-id="f9c07-289">Alternatywna metoda`BatchUpdate`</span><span class="sxs-lookup"><span data-stu-id="f9c07-289">An Alternative`BatchUpdate`Method</span></span>

<span data-ttu-id="f9c07-290">Właśnie zbadana Metoda `BatchUpdate` pobiera *wszystkie* produkty z metody logiki biznesowej s `GetProducts` a następnie aktualizuje tylko te rekordy, które są wyświetlane w widoku GridView.</span><span class="sxs-lookup"><span data-stu-id="f9c07-290">The `BatchUpdate` method we just examined retrieves *all* of the products from the BLL s `GetProducts` method and then updates just those records that appear in the GridView.</span></span> <span data-ttu-id="f9c07-291">Takie podejście jest idealne, jeśli GridView nie używa stronicowania, ale jeśli tak, mogą być setki, tysiące lub dziesiątki tysięcy produktów, ale tylko dziesięć wierszy w GridView.</span><span class="sxs-lookup"><span data-stu-id="f9c07-291">This approach is ideal if the GridView does not use paging, but if it does, there may be hundreds, thousands, or tens of thousands of products, but only ten rows in the GridView.</span></span> <span data-ttu-id="f9c07-292">W takim przypadku pobieranie wszystkich produktów z bazy danych tylko do modyfikacji 10 z nich jest mniejsze niż idealne.</span><span class="sxs-lookup"><span data-stu-id="f9c07-292">In such a case, getting all of the products from the database only to modify 10 of them is less than ideal.</span></span>

<span data-ttu-id="f9c07-293">W przypadku tych typów sytuacji Rozważ użycie następującej metody `BatchUpdateAlternate`:</span><span class="sxs-lookup"><span data-stu-id="f9c07-293">For those types of situations, consider using the following `BatchUpdateAlternate` method instead:</span></span>

[!code-csharp[Main](batch-updating-cs/samples/sample7.cs)]

<span data-ttu-id="f9c07-294">`BatchMethodAlternate` uruchamia się, tworząc nowe puste `ProductsDataTable` o nazwie `products`.</span><span class="sxs-lookup"><span data-stu-id="f9c07-294">`BatchMethodAlternate` starts by creating a new empty `ProductsDataTable` named `products`.</span></span> <span data-ttu-id="f9c07-295">Następnie kroki w kolekcji `Rows` GridView i dla każdego wiersza pobiera informacje o produkcie przy użyciu metody `GetProductByProductID(productID)` LOGIKI biznesowej s.</span><span class="sxs-lookup"><span data-stu-id="f9c07-295">It then steps through the GridView s `Rows` collection and for each row gets the particular product information using the BLL s `GetProductByProductID(productID)` method.</span></span> <span data-ttu-id="f9c07-296">Pobrane wystąpienie `ProductsRow` ma zaktualizowane właściwości w taki sam sposób jak `BatchUpdate`, ale po zaktualizowaniu wiersza, który jest importowany do `products``ProductsDataTable` za pomocą [metody`ImportRow(DataRow)`](https://msdn.microsoft.com/library/system.data.datatable.importrow(VS.80).aspx)DataTable s.</span><span class="sxs-lookup"><span data-stu-id="f9c07-296">The retrieved `ProductsRow` instance has its properties updated in the same fashion as `BatchUpdate`, but after updating the row it is imported into the `products``ProductsDataTable` via the DataTable s [`ImportRow(DataRow)` method](https://msdn.microsoft.com/library/system.data.datatable.importrow(VS.80).aspx).</span></span>

<span data-ttu-id="f9c07-297">Po zakończeniu `foreach` pętli `products` zawiera jedno wystąpienie `ProductsRow` dla każdego wiersza w widoku GridView.</span><span class="sxs-lookup"><span data-stu-id="f9c07-297">After the `foreach` loop completes, `products` contains one `ProductsRow` instance for each row in the GridView.</span></span> <span data-ttu-id="f9c07-298">Ponieważ każde wystąpienie `ProductsRow` zostało dodane do `products` (zamiast aktualizacji), jeśli nie przejdziemy do metody `UpdateWithTransaction`, `ProductsTableAdapter` spróbuje wstawić każdy rekord do bazy danych.</span><span class="sxs-lookup"><span data-stu-id="f9c07-298">Since each of the `ProductsRow` instances have been added to the `products` (instead of updated), if we blindly pass it to the `UpdateWithTransaction` method the `ProductsTableAdapter` will try to insert each of the records into the database.</span></span> <span data-ttu-id="f9c07-299">Zamiast tego musimy określić, że każdy z tych wierszy został zmodyfikowany (nie został dodany).</span><span class="sxs-lookup"><span data-stu-id="f9c07-299">Instead, we need to specify that each of these rows has been modified (not added).</span></span>

<span data-ttu-id="f9c07-300">Można to osiągnąć przez dodanie nowej metody do LOGIKI biznesowej o nazwie `UpdateProductsWithTransaction`.</span><span class="sxs-lookup"><span data-stu-id="f9c07-300">This can be accomplished by adding a new method to the BLL named `UpdateProductsWithTransaction`.</span></span> <span data-ttu-id="f9c07-301">`UpdateProductsWithTransaction`, pokazane poniżej, ustawia `RowState` każdego wystąpienia `ProductsRow` w `ProductsDataTable`, aby `Modified`, a następnie przekazuje `ProductsDataTable` do metody DAL s `UpdateWithTransaction`.</span><span class="sxs-lookup"><span data-stu-id="f9c07-301">`UpdateProductsWithTransaction`, shown below, sets the `RowState` of each of the `ProductsRow` instances in the `ProductsDataTable` to `Modified` and then passes the `ProductsDataTable` to the DAL s `UpdateWithTransaction` method.</span></span>

[!code-csharp[Main](batch-updating-cs/samples/sample8.cs)]

## <a name="summary"></a><span data-ttu-id="f9c07-302">Podsumowanie</span><span class="sxs-lookup"><span data-stu-id="f9c07-302">Summary</span></span>

<span data-ttu-id="f9c07-303">Widok GridView zawiera wbudowane możliwości edytowania na wiersz, ale nie obsługuje tworzenia w pełni edytowalnych interfejsów.</span><span class="sxs-lookup"><span data-stu-id="f9c07-303">The GridView provides built-in per-row editing capabilities, but lacks support for creating fully editable interfaces.</span></span> <span data-ttu-id="f9c07-304">Jak zostało to opisane w tym samouczku, takie interfejsy są możliwe, ale wymagają one bitu pracy.</span><span class="sxs-lookup"><span data-stu-id="f9c07-304">As we saw in this tutorial, such interfaces are possible, but require a bit of work.</span></span> <span data-ttu-id="f9c07-305">Aby utworzyć widok GridView, w którym każdy wiersz jest edytowalny, musimy przekonwertować pola GridView w używanie TemplateField i zdefiniować interfejs edycji w `ItemTemplate` s.</span><span class="sxs-lookup"><span data-stu-id="f9c07-305">To create a GridView where every row is editable, we need to convert the GridView s fields into TemplateFields and define the editing interface within the `ItemTemplate` s.</span></span> <span data-ttu-id="f9c07-306">Ponadto należy dodać do strony wszystkie kontrolki sieci Web typu Button, niezależnie od widoku GridView.</span><span class="sxs-lookup"><span data-stu-id="f9c07-306">Additionally, Update All -type Button Web controls must be added to the page, separate from the GridView.</span></span> <span data-ttu-id="f9c07-307">Te przyciski `Click` programy obsługi zdarzeń muszą wyliczyć kolekcję GridView `Rows`, przechować zmiany w `ProductsDataTable`i przekazać zaktualizowane informacje do odpowiedniej metody LOGIKI biznesowej.</span><span class="sxs-lookup"><span data-stu-id="f9c07-307">These Buttons `Click` event handlers need to enumerate the GridView s `Rows` collection, store the changes in a `ProductsDataTable`, and pass the updated information into the appropriate BLL method.</span></span>

<span data-ttu-id="f9c07-308">W następnym samouczku zobaczymy, jak utworzyć interfejs do usuwania wsadowego.</span><span class="sxs-lookup"><span data-stu-id="f9c07-308">In the next tutorial we'll see how to create an interface for batch deleting.</span></span> <span data-ttu-id="f9c07-309">W szczególności każdy wiersz GridView będzie zawierać pole wyboru, a nie polecenie Aktualizuj wszystkie przyciski, a my usunie przyciski z zaznaczonymi wierszami.</span><span class="sxs-lookup"><span data-stu-id="f9c07-309">In particular, each GridView row will include a checkbox and instead of Update All -type buttons, we'll have Delete Selected Rows buttons.</span></span>

<span data-ttu-id="f9c07-310">Szczęśliwe programowanie!</span><span class="sxs-lookup"><span data-stu-id="f9c07-310">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="f9c07-311">Informacje o autorze</span><span class="sxs-lookup"><span data-stu-id="f9c07-311">About the Author</span></span>

<span data-ttu-id="f9c07-312">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor siedmiu grup ASP/ASP. NET Books i założyciel of [4GuysFromRolla.com](http://www.4guysfromrolla.com), pracował z technologiami sieci Web firmy Microsoft od czasu 1998.</span><span class="sxs-lookup"><span data-stu-id="f9c07-312">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="f9c07-313">Scott działa jako niezależny konsultant, trainer i składnik zapisywania.</span><span class="sxs-lookup"><span data-stu-id="f9c07-313">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="f9c07-314">Jego Najnowsza książka to [*Sams ASP.NET 2,0 w ciągu 24 godzin*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="f9c07-314">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="f9c07-315">Można go osiągnąć w [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="f9c07-315">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="f9c07-316">lub za pośrednictwem swojego blogu, który można znaleźć w [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="f9c07-316">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="f9c07-317">Specjalne podziękowania</span><span class="sxs-lookup"><span data-stu-id="f9c07-317">Special Thanks To</span></span>

<span data-ttu-id="f9c07-318">Ta seria samouczków została sprawdzona przez wielu przydatnych recenzentów.</span><span class="sxs-lookup"><span data-stu-id="f9c07-318">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="f9c07-319">Recenzenci liderzy dla tego samouczka to Teresa Murphy i David suru.</span><span class="sxs-lookup"><span data-stu-id="f9c07-319">Lead reviewers for this tutorial were Teresa Murphy and David Suru.</span></span> <span data-ttu-id="f9c07-320">Chcesz przeglądać moje nadchodzące artykuły MSDN?</span><span class="sxs-lookup"><span data-stu-id="f9c07-320">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="f9c07-321">Jeśli tak, upuść mi linię w [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="f9c07-321">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="f9c07-322">[Poprzednie](wrapping-database-modifications-within-a-transaction-cs.md)
> [dalej](batch-deleting-cs.md)</span><span class="sxs-lookup"><span data-stu-id="f9c07-322">[Previous](wrapping-database-modifications-within-a-transaction-cs.md)
[Next](batch-deleting-cs.md)</span></span>
