---
uid: web-forms/overview/data-access/working-with-batched-data/batch-inserting-cs
title: Wstawianie wsadoweC#() | Microsoft Docs
author: rick-anderson
description: Dowiedz się, jak wstawiać wiele rekordów bazy danych w ramach jednej operacji. W warstwie interfejsu użytkownika rozszerzono widok GridView, aby umożliwić użytkownikowi wprowadzanie wielu n...
ms.author: riande
ms.date: 06/26/2007
ms.assetid: cf025e08-48fc-4385-b176-8610aa7b5565
msc.legacyurl: /web-forms/overview/data-access/working-with-batched-data/batch-inserting-cs
msc.type: authoredcontent
ms.openlocfilehash: 5dc4d0b6ac9bf3aa2baa54fe9f5d4149494e47d2
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 03/06/2020
ms.locfileid: "78618525"
---
# <a name="batch-inserting-c"></a><span data-ttu-id="e7a4c-104">Wstawianie w partiach (C#)</span><span class="sxs-lookup"><span data-stu-id="e7a4c-104">Batch Inserting (C#)</span></span>

<span data-ttu-id="e7a4c-105">przez [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="e7a4c-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="e7a4c-106">[Pobierz kod](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_66_CS.zip) lub [Pobierz plik PDF](batch-inserting-cs/_static/datatutorial66cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="e7a4c-106">[Download Code](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_66_CS.zip) or [Download PDF](batch-inserting-cs/_static/datatutorial66cs1.pdf)</span></span>

> <span data-ttu-id="e7a4c-107">Dowiedz się, jak wstawiać wiele rekordów bazy danych w ramach jednej operacji.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-107">Learn how to insert multiple database records in a single operation.</span></span> <span data-ttu-id="e7a4c-108">W warstwie interfejsu użytkownika rozszerzono widok GridView, aby umożliwić użytkownikowi wprowadzanie wielu nowych rekordów.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-108">In the User Interface Layer we extend the GridView to allow the user to enter multiple new records.</span></span> <span data-ttu-id="e7a4c-109">W warstwie dostępu do danych zawijamy wiele operacji wstawiania w ramach transakcji, aby upewnić się, że wszystkie operacje wstawiania zakończyły się powodzeniem lub wszystkie wstawienia są wycofywane.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-109">In the Data Access Layer we wrap the multiple Insert operations within a transaction to ensure that all insertions succeed or all insertions are rolled back.</span></span>

## <a name="introduction"></a><span data-ttu-id="e7a4c-110">Wprowadzenie</span><span class="sxs-lookup"><span data-stu-id="e7a4c-110">Introduction</span></span>

<span data-ttu-id="e7a4c-111">W samouczku [aktualizacji wsadowych](batch-updating-cs.md) sprawdziłem, jak dostosowujesz formant GridView, aby przedstawić interfejs, w którym można było edytować wiele rekordów.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-111">In the [Batch Updating](batch-updating-cs.md) tutorial we looked at customizing the GridView control to present an interface where multiple records were editable.</span></span> <span data-ttu-id="e7a4c-112">Użytkownik odwiedzający stronę może wprowadzić serię zmian, a następnie po kliknięciu jednego przycisku wykonać aktualizację zbiorczą.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-112">The user visiting the page could make a series of changes and then, with a single button click, perform a batch update.</span></span> <span data-ttu-id="e7a4c-113">W przypadku sytuacji, w których użytkownicy często aktualizują wiele rekordów w jednym miejscu, taki interfejs może zapisywać niezliczone kliknięć i przełączanie kontekstu klawiatury do myszy w porównaniu z domyślnymi funkcjami edycji poszczególnych wierszy, które zostały po raz pierwszy omówione w temacie [Omówienie wstawiania, aktualizowania i usuwania danych](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md) .</span><span class="sxs-lookup"><span data-stu-id="e7a4c-113">For situations where users commonly update many records in one go, such an interface can save countless clicks and keyboard-to-mouse context switches when compared to the default per-row editing features that were first explored back in the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md) tutorial.</span></span>

<span data-ttu-id="e7a4c-114">To pojęcie można również zastosować w przypadku dodawania rekordów.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-114">This concept can also be applied when adding records.</span></span> <span data-ttu-id="e7a4c-115">Załóżmy, że w tym miejscu w firmie Northwind Traders często odbieramy wysyłki od dostawców zawierających kilka produktów dla określonej kategorii.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-115">Imagine that here at Northwind Traders we commonly receive shipments from suppliers that contain a number of products for a particular category.</span></span> <span data-ttu-id="e7a4c-116">Załóżmy na przykład, że firma Microsoft może otrzymać wydanie sześć różnych produktów herbaty i kawy od handlowców z Warszawy.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-116">As an example, we might receive a shipment of six different tea and coffee products from Tokyo Traders.</span></span> <span data-ttu-id="e7a4c-117">Jeśli użytkownik wprowadzi sześć produktów po raz za pośrednictwem kontrolki DetailsView, będzie musiał wybrać wiele z tych samych wartości jednocześnie i ponownie: będzie to wymagało wybrania tej samej kategorii (napoje), tego samego dostawcy (dla Warszawy), tej samej wartości zaniechanej ( False) i te same jednostki na wartości kolejności (0).</span><span class="sxs-lookup"><span data-stu-id="e7a4c-117">If a user enters the six products one at a time through a DetailsView control, they will have to choose many of the same values over and over again: they will need to choose the same category (Beverages), the same supplier (Tokyo Traders), the same discontinued value (False), and the same units on order value (0).</span></span> <span data-ttu-id="e7a4c-118">Ten powtarzający się wpis danych nie tylko czasochłonne, ale jest podatny na błędy.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-118">This repetitive data entry is not only time consuming, but is prone to errors.</span></span>

<span data-ttu-id="e7a4c-119">W przypadku niewielkiej pracy możemy utworzyć interfejs wstawiania wsadowego, który umożliwia użytkownikowi wybranie dostawcy i kategorii Raz, wprowadzić serię nazw produktów i ceny jednostkowe, a następnie kliknąć przycisk, aby dodać nowe produkty do bazy danych (patrz rysunek 1).</span><span class="sxs-lookup"><span data-stu-id="e7a4c-119">With a little work we can create a batch inserting interface that enables the user to choose the supplier and category once, enter a series of product names and unit prices, and then click a button to add the new products to the database (see Figure 1).</span></span> <span data-ttu-id="e7a4c-120">Po dodaniu każdego produktu do pól danych `ProductName` i `UnitPrice` są przypisywane wartości wprowadzone w polach tekstowych, podczas gdy `CategoryID` i `SupplierID` wartości są przypisywane wartości z kontrolek DropDownList w górnej części formularza.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-120">As each product is added, its `ProductName` and `UnitPrice` data fields are assigned the values entered in the TextBoxes, while its `CategoryID` and `SupplierID` values are assigned the values from the DropDownLists at the top fo the form.</span></span> <span data-ttu-id="e7a4c-121">Wartości `Discontinued` i `UnitsOnOrder` są ustawiane jako zakodowane odpowiednio wartości `false` i 0.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-121">The `Discontinued` and `UnitsOnOrder` values are set to the hard-coded values of `false` and 0, respectively.</span></span>

<span data-ttu-id="e7a4c-122">[![Wstawianie interfejsu wsadowego](batch-inserting-cs/_static/image2.png)](batch-inserting-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="e7a4c-122">[![The Batch Inserting Interface](batch-inserting-cs/_static/image2.png)](batch-inserting-cs/_static/image1.png)</span></span>

<span data-ttu-id="e7a4c-123">**Rysunek 1**: wsadowe Wstawianie interfejsu ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](batch-inserting-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="e7a4c-123">**Figure 1**: The Batch Inserting Interface ([Click to view full-size image](batch-inserting-cs/_static/image3.png))</span></span>

<span data-ttu-id="e7a4c-124">W tym samouczku utworzymy stronę, która implementuje interfejs wstawiania wsadowego przedstawiony na rysunku 1.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-124">In this tutorial we will create a page that implements the batch inserting interface shown in Figure 1.</span></span> <span data-ttu-id="e7a4c-125">Podobnie jak w przypadku poprzednich dwóch samouczków, umieścimy wstawienia w zakresie transakcji, aby zapewnić niepodzielność.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-125">As with the previous two tutorials, we will wrap the insertions within the scope of a transaction to ensure atomicity.</span></span> <span data-ttu-id="e7a4c-126">Zacznij korzystać z aplikacji.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-126">Let s get started!</span></span>

## <a name="step-1-creating-the-display-interface"></a><span data-ttu-id="e7a4c-127">Krok 1. Tworzenie interfejsu wyświetlania</span><span class="sxs-lookup"><span data-stu-id="e7a4c-127">Step 1: Creating the Display Interface</span></span>

<span data-ttu-id="e7a4c-128">Ten samouczek będzie składać się z jednej strony, która jest podzielona na dwa regiony: region wyświetlania i region wstawiania.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-128">This tutorial will consist of a single page that is divided into two regions: a display region and an inserting region.</span></span> <span data-ttu-id="e7a4c-129">Interfejs wyświetlania, który zostanie utworzony w tym kroku, pokazuje produkty w widoku GridView i zawiera przycisk zatytułowany proces dostawy produktu.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-129">The display interface, which we'll create in this step, shows the products in a GridView and includes a button titled Process Product Shipment.</span></span> <span data-ttu-id="e7a4c-130">Po kliknięciu tego przycisku interfejs wyświetlania jest zastępowany interfejsem wstawiania, który jest przedstawiony na rysunku 1.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-130">When this button is clicked, the display interface is replaced with the inserting interface, which is shown in Figure 1.</span></span> <span data-ttu-id="e7a4c-131">Interfejs ekranu zwraca po kliknięciu przycisku Dodaj produkty z wysyłki lub Anuluj.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-131">The display interface returns after the Add Products from Shipment or Cancel buttons are clicked.</span></span> <span data-ttu-id="e7a4c-132">Utworzymy interfejs wstawiania w kroku 2.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-132">We'll create the inserting interface in Step 2.</span></span>

<span data-ttu-id="e7a4c-133">Podczas tworzenia strony z dwoma interfejsami tylko jeden z nich jest widoczny w danym momencie, każdy interfejs jest zwykle umieszczany w [kontrolce sieci Web panelu](http://www.w3schools.com/aspnet/control_panel.asp), który służy jako kontener dla innych formantów.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-133">When creating a page that has two interfaces, only one of which is visible at a time, each interface typically is placed within a [Panel Web control](http://www.w3schools.com/aspnet/control_panel.asp), which serves as a container for other controls.</span></span> <span data-ttu-id="e7a4c-134">W związku z tym nasza strona ma dwa kontrolki panel dla każdego interfejsu.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-134">Therefore, our page will have two Panel controls one for each interface.</span></span>

<span data-ttu-id="e7a4c-135">Zacznij od otworzenia strony `BatchInsert.aspx` w folderze `BatchData` i przeciągnij panel z przybornika do projektanta (patrz rysunek 2).</span><span class="sxs-lookup"><span data-stu-id="e7a4c-135">Start by opening the `BatchInsert.aspx` page in the `BatchData` folder and drag a Panel from the Toolbox onto the Designer (see Figure 2).</span></span> <span data-ttu-id="e7a4c-136">Ustaw właściwość `ID` panelu s na `DisplayInterface`.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-136">Set the Panel s `ID` property to `DisplayInterface`.</span></span> <span data-ttu-id="e7a4c-137">Podczas dodawania panelu do projektanta, jego właściwości `Height` i `Width` są odpowiednio ustawione na 50px i 125px.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-137">When adding the Panel to the Designer, its `Height` and `Width` properties are set to 50px and 125px, respectively.</span></span> <span data-ttu-id="e7a4c-138">Wyczyść te wartości właściwości z okno Właściwości.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-138">Clear out these property values from the Properties window.</span></span>

<span data-ttu-id="e7a4c-139">[![przeciąganie panelu z przybornika do projektanta](batch-inserting-cs/_static/image5.png)](batch-inserting-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="e7a4c-139">[![Drag a Panel from the Toolbox onto the Designer](batch-inserting-cs/_static/image5.png)](batch-inserting-cs/_static/image4.png)</span></span>

<span data-ttu-id="e7a4c-140">**Rysunek 2**. przeciągnięcie panelu z przybornika do projektanta ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](batch-inserting-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="e7a4c-140">**Figure 2**: Drag a Panel from the Toolbox onto the Designer ([Click to view full-size image](batch-inserting-cs/_static/image6.png))</span></span>

<span data-ttu-id="e7a4c-141">Następnie przeciągnij przycisk i formant GridView do panelu.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-141">Next, drag a Button and GridView control into the Panel.</span></span> <span data-ttu-id="e7a4c-142">Ustaw właściwość Button `ID` na `ProcessShipment` i jej Właściwość `Text`, aby przetwarzać wysyłkę produktu.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-142">Set the Button s `ID` property to `ProcessShipment` and its `Text` property to Process Product Shipment.</span></span> <span data-ttu-id="e7a4c-143">Ustaw właściwość GridView s `ID` na `ProductsGrid` i, z jej tagu inteligentnego, powiąż ją z nowym elementem ObjectDataSource o nazwie `ProductsDataSource`.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-143">Set the GridView s `ID` property to `ProductsGrid` and, from its smart tag, bind it to a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="e7a4c-144">Skonfiguruj element ObjectDataSource, aby ściągał swoje dane z metody `GetProducts` `ProductsBLL` Class.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-144">Configure the ObjectDataSource to pull its data from the `ProductsBLL` class s `GetProducts` method.</span></span> <span data-ttu-id="e7a4c-145">Ponieważ ten element GridView jest używany tylko do wyświetlania danych, Ustaw listę rozwijaną na kartach UPDATE, INSERT i DELETE na wartość (brak).</span><span class="sxs-lookup"><span data-stu-id="e7a4c-145">Since this GridView is used only to display data, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None).</span></span> <span data-ttu-id="e7a4c-146">Kliknij przycisk Zakończ, aby zakończyć pracę Kreatora konfiguracji źródła danych.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-146">Click Finish to complete the Configure Data Source wizard.</span></span>

<span data-ttu-id="e7a4c-147">[![wyświetlić dane zwrócone przez metodę getProducts klasy ProductsBLL](batch-inserting-cs/_static/image8.png)](batch-inserting-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="e7a4c-147">[![Display the Data Returned from the ProductsBLL Class s GetProducts Method](batch-inserting-cs/_static/image8.png)](batch-inserting-cs/_static/image7.png)</span></span>

<span data-ttu-id="e7a4c-148">**Rysunek 3**. Wyświetlanie danych zwróconych z metody `GetProducts` `ProductsBLL` Class ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](batch-inserting-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="e7a4c-148">**Figure 3**: Display the Data Returned from the `ProductsBLL` Class s `GetProducts` Method ([Click to view full-size image](batch-inserting-cs/_static/image9.png))</span></span>

<span data-ttu-id="e7a4c-149">[![ustawić listy rozwijane na kartach Aktualizuj, Wstaw i Usuń do (brak).](batch-inserting-cs/_static/image11.png)](batch-inserting-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="e7a4c-149">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](batch-inserting-cs/_static/image11.png)](batch-inserting-cs/_static/image10.png)</span></span>

<span data-ttu-id="e7a4c-150">**Rysunek 4**. Ustawianie list rozwijanych w kartach Aktualizuj, Wstaw i Usuń do (brak) ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](batch-inserting-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="e7a4c-150">**Figure 4**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](batch-inserting-cs/_static/image12.png))</span></span>

<span data-ttu-id="e7a4c-151">Po zakończeniu działania kreatora ObjectDataSource Visual Studio doda BoundFields i CheckBoxField dla pól danych produktu.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-151">After completing the ObjectDataSource wizard, Visual Studio will add BoundFields and a CheckBoxField for the product data fields.</span></span> <span data-ttu-id="e7a4c-152">Usuń wszystkie pola oprócz `ProductName`, `CategoryName`, `SupplierName`, `UnitPrice`i `Discontinued`.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-152">Remove all but the `ProductName`, `CategoryName`, `SupplierName`, `UnitPrice`, and `Discontinued` fields.</span></span> <span data-ttu-id="e7a4c-153">Korzystaj z bezpłatnych dostosowań.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-153">Feel free to make any aesthetic customizations.</span></span> <span data-ttu-id="e7a4c-154">Postanowiono sformatować pole `UnitPrice` jako wartość walutową, zmienić kolejność pól i zmienić nazwy kilku pól `HeaderText` wartości.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-154">I decided to format the `UnitPrice` field as a currency value, reordered the fields, and renamed several of the fields `HeaderText` values.</span></span> <span data-ttu-id="e7a4c-155">Skonfiguruj również widok GridView, aby obejmował obsługę stronicowania i sortowania, zaznaczając pola wyboru Włącz stronicowanie i Włącz sortowanie w tagu inteligentnym GridView.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-155">Also configure the GridView to include paging and sorting support by checking the Enable Paging and Enable Sorting checkboxes in the GridView s smart tag.</span></span>

<span data-ttu-id="e7a4c-156">Po dodaniu kontrolek panel, Button, GridView i ObjectDataSource i dostosowaniu pól GridView, znaczniki deklaratywne strony powinny wyglądać podobnie do poniższego:</span><span class="sxs-lookup"><span data-stu-id="e7a4c-156">After adding the Panel, Button, GridView, and ObjectDataSource controls and customizing the GridView s fields, your page s declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](batch-inserting-cs/samples/sample1.aspx)]

<span data-ttu-id="e7a4c-157">Należy zauważyć, że znaczniki dla przycisku i widoku GridView pojawiają się w tagach otwierających i zamykających `<asp:Panel>`.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-157">Note that the markup for the Button and GridView appear within the opening and closing `<asp:Panel>` tags.</span></span> <span data-ttu-id="e7a4c-158">Ponieważ te kontrolki znajdują się w panelu `DisplayInterface`, można je ukryć przez ustawienie właściwości `Visible` panelu s na `false`.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-158">Since these controls are within the `DisplayInterface` Panel, we can hide them by simply setting the Panel s `Visible` property to `false`.</span></span> <span data-ttu-id="e7a4c-159">Krok 3 sprawdza programowo zmianę właściwości `Visible` panelu i w odpowiedzi na przycisk kliknij, aby wyświetlić jeden interfejs podczas ukrywania drugiego.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-159">Step 3 looks at programmatically changing the Panel s `Visible` property in response to a button click to show one interface while hiding the other.</span></span>

<span data-ttu-id="e7a4c-160">Poświęć chwilę na wyświetlenie postępu w przeglądarce.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-160">Take a moment to view our progress through a browser.</span></span> <span data-ttu-id="e7a4c-161">Jak pokazano na rysunku 5, powinien zostać wyświetlony przycisk przetwórz dostawy produktu powyżej widoku GridView, który wyświetla dziesięć produktów w danym momencie.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-161">As Figure 5 shows, you should see a Process Product Shipment button above a GridView that lists the products ten at a time.</span></span>

<span data-ttu-id="e7a4c-162">[![GridView wyświetla listę produktów i oferuje funkcje sortowania i stronicowania](batch-inserting-cs/_static/image14.png)](batch-inserting-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="e7a4c-162">[![The GridView Lists the Products and Offers Sorting and Paging Capabilities](batch-inserting-cs/_static/image14.png)](batch-inserting-cs/_static/image13.png)</span></span>

<span data-ttu-id="e7a4c-163">**Ilustracja 5**. element GridView wyświetla listę produktów i oferuje funkcje sortowania i stronicowania ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](batch-inserting-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="e7a4c-163">**Figure 5**: The GridView Lists the Products and Offers Sorting and Paging Capabilities ([Click to view full-size image](batch-inserting-cs/_static/image15.png))</span></span>

## <a name="step-2-creating-the-inserting-interface"></a><span data-ttu-id="e7a4c-164">Krok 2. Tworzenie interfejsu wstawiania</span><span class="sxs-lookup"><span data-stu-id="e7a4c-164">Step 2: Creating the Inserting Interface</span></span>

<span data-ttu-id="e7a4c-165">Po zakończeniu interfejsu wyświetlania, gotowy do utworzenia interfejsu wstawiania.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-165">With the display interface complete, we re ready to create the inserting interface.</span></span> <span data-ttu-id="e7a4c-166">Na potrzeby tego samouczka Utwórz interfejs wstawiania, który będzie monitował o pojedynczy dostawca i wartość kategorii, a następnie umożliwi użytkownikowi wprowadzenie do pięciu nazw produktów i wartości cen jednostkowych.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-166">For this tutorial, let s create an inserting interface that prompts for a single supplier and category value and then allows the user to enter up to five product names and unit price values.</span></span> <span data-ttu-id="e7a4c-167">Za pomocą tego interfejsu użytkownik może dodać jeden do pięciu nowych produktów, które współużytkują tę samą kategorię i dostawcę, ale mają unikatowe nazwy produktów i ceny.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-167">With this interface, the user can add one to five new products that all share the same category and supplier, but have unique product names and prices.</span></span>

<span data-ttu-id="e7a4c-168">Zacznij od przeciągnięcia panelu z przybornika do projektanta, umieszczając go pod istniejącym panelem `DisplayInterface`.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-168">Start by dragging a Panel from the Toolbox onto the Designer, placing it beneath the existing `DisplayInterface` Panel.</span></span> <span data-ttu-id="e7a4c-169">Ustaw właściwość `ID` tego nowo dodany panel, aby `InsertingInterface` i ustawić jej Właściwość `Visible` na `false`.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-169">Set the `ID` property of this newly added Panel to `InsertingInterface` and set its `Visible` property to `false`.</span></span> <span data-ttu-id="e7a4c-170">Dodamy kod, który ustawia właściwość `Visible` panelu `InsertingInterface` na `true` w kroku 3.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-170">We'll add code that sets the `InsertingInterface` Panel s `Visible` property to `true` in Step 3.</span></span> <span data-ttu-id="e7a4c-171">Wyczyść również wartości właściwości Panel s `Height` i `Width`.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-171">Also clear out the Panel s `Height` and `Width` property values.</span></span>

<span data-ttu-id="e7a4c-172">Następnie musimy utworzyć interfejs wstawiania, który został pokazany na rysunku 1.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-172">Next, we need to create the inserting interface that was shown back in Figure 1.</span></span> <span data-ttu-id="e7a4c-173">Ten interfejs można utworzyć za pomocą różnych technik HTML, ale będziemy używać dość prostego: tabeli zawierającej cztery kolumny, siedem wierszy.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-173">This interface can be created through a variety of HTML techniques, but we will use a fairly straightforward one: a four-column, seven-row table.</span></span>

> [!NOTE]
> <span data-ttu-id="e7a4c-174">Gdy wprowadzasz znaczniki dla elementów `<table>` HTML, wolisz korzystać z widoku źródła.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-174">When entering markup for HTML `<table>` elements, I prefer to use the Source view.</span></span> <span data-ttu-id="e7a4c-175">Mimo że program Visual Studio ma narzędzia do dodawania `<table>` elementów za pomocą projektanta, Projektant wydaje się wszystko zbyt skłonne, aby wstrzyknąć nieproszony `style` ustawień do znaczników.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-175">While Visual Studio does have tools for adding `<table>` elements through the Designer, the Designer seems all too willing to inject unasked for `style` settings into the markup.</span></span> <span data-ttu-id="e7a4c-176">Po utworzeniu znacznika `<table>`, zazwyczaj wracam do projektanta, aby dodać kontrolki sieci Web i ustawić ich właściwości.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-176">Once I have created the `<table>` markup, I usually return to the Designer to add the Web controls and set their properties.</span></span> <span data-ttu-id="e7a4c-177">Podczas tworzenia tabel z wstępnie określonymi kolumnami i preferowanymi wierszami przy użyciu statycznego kodu HTML zamiast [kontrolki sieci Web tabeli](https://msdn.microsoft.com/library/system.web.ui.webcontrols.table.aspx) , ponieważ dowolnych kontrolek sieci Web umieszczonych w formancie sieci Web tabeli można uzyskać dostęp tylko przy użyciu wzorca `FindControl("controlID")`.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-177">When creating tables with pre-determined columns and rows I prefer using static HTML rather than the [Table Web control](https://msdn.microsoft.com/library/system.web.ui.webcontrols.table.aspx) because any Web controls placed within a Table Web control can only be accessed using the `FindControl("controlID")` pattern.</span></span> <span data-ttu-id="e7a4c-178">Należy jednak użyć formantów sieci Web tabeli do dynamicznego rozmiaru tabel (dla których wiersze lub kolumny są oparte na pewnych kryteriach określonych przez użytkownika), ponieważ kontrolka sieci Web tabeli może być skonstruowana programowo.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-178">I do, however, use Table Web controls for dynamically-sized tables (ones whose rows or columns are based on some database or user-specified criteria), since the Table Web control can be constructed programmatically.</span></span>

<span data-ttu-id="e7a4c-179">Wprowadź następujące znaczniki w `<asp:Panel>` tagów `InsertingInterface` panelu:</span><span class="sxs-lookup"><span data-stu-id="e7a4c-179">Enter the following markup within the `<asp:Panel>` tags of the `InsertingInterface` Panel:</span></span>

[!code-html[Main](batch-inserting-cs/samples/sample2.html)]

<span data-ttu-id="e7a4c-180">Ten `<table>` znacznik nie zawiera jeszcze żadnych kontrolek sieci Web, dodamy je na chwilę.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-180">This `<table>` markup does not include any Web controls yet, we'll add those momentarily.</span></span> <span data-ttu-id="e7a4c-181">Należy zauważyć, że każdy element `<tr>` zawiera określone ustawienie klasy CSS: `BatchInsertHeaderRow` wiersza nagłówka, w którym zostanie wykontrolek DropDownList dostawca i Kategoria. `BatchInsertFooterRow` wiersza stopki, w którym zostaną umieszczone przyciski Dodaj produkty z wysyłki i Anuluj; i zmienne `BatchInsertRow` i `BatchInsertAlternatingRow` dla wierszy, które będą zawierać kontrolki TextBox produktu i ceny jednostkowej.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-181">Note that each `<tr>` element contains a particular CSS class setting: `BatchInsertHeaderRow` for the header row where the supplier and category DropDownLists will go; `BatchInsertFooterRow` for the footer row where the Add Products from Shipment and Cancel Buttons will go; and alternating `BatchInsertRow` and `BatchInsertAlternatingRow` values for the rows that will contain the product and unit price TextBox controls.</span></span> <span data-ttu-id="e7a4c-182">W pliku `Styles.css` zostały utworzone odpowiednie klasy CSS, aby zapewnić Wstawianie interfejsu podobnego do kontrolek GridView i DetailsView, które są używane w tym samouczku.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-182">I ve created corresponding CSS classes in the `Styles.css` file to give the inserting interface an appearance similar to the GridView and DetailsView controls we ve used throughout these tutorials.</span></span> <span data-ttu-id="e7a4c-183">Te klasy CSS przedstawiono poniżej.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-183">These CSS classes are shown below.</span></span>

[!code-css[Main](batch-inserting-cs/samples/sample3.css)]

<span data-ttu-id="e7a4c-184">Po wprowadzeniu tej oznaczeń Wróć do widok Projekt.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-184">With this markup entered, return to the Design view.</span></span> <span data-ttu-id="e7a4c-185">Ta `<table>` powinna być wyświetlana jako tabela z czterema wierszami, siedem wierszy w projektancie, jak pokazano na rysunku 6.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-185">This `<table>` should show as a four-column, seven-row table in the Designer, as Figure 6 illustrates.</span></span>

<span data-ttu-id="e7a4c-186">[![Wstawianie interfejsu składa się z czterech kolumn, siedmiu wierszy tabeli](batch-inserting-cs/_static/image17.png)](batch-inserting-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="e7a4c-186">[![The Inserting Interface is Composed of a Four-Column, Seven-Row Table](batch-inserting-cs/_static/image17.png)](batch-inserting-cs/_static/image16.png)</span></span>

<span data-ttu-id="e7a4c-187">**Rysunek 6**. Wstawianie interfejsu składa się z czterech kolumn, siedmiu wierszy tabeli ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](batch-inserting-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="e7a4c-187">**Figure 6**: The Inserting Interface is Composed of a Four-Column, Seven-Row Table ([Click to view full-size image](batch-inserting-cs/_static/image18.png))</span></span>

<span data-ttu-id="e7a4c-188">Teraz wszystko jest gotowe do dodania formantów sieci Web do interfejsu wstawiania.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-188">We re now ready to add the Web controls to the inserting interface.</span></span> <span data-ttu-id="e7a4c-189">Przeciągnij dwie kontrolek DropDownList z przybornika do odpowiednich komórek w tabeli, a drugi dla dostawcy i dla kategorii.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-189">Drag two DropDownLists from the Toolbox into the appropriate cells in the table one for the supplier and one for the category.</span></span>

<span data-ttu-id="e7a4c-190">Ustaw właściwość DropDownList dostawcy `ID` na `Suppliers` i powiąż ją z nowym elementem ObjectDataSource o nazwie `SuppliersDataSource`.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-190">Set the supplier DropDownList s `ID` property to `Suppliers` and bind it to a new ObjectDataSource named `SuppliersDataSource`.</span></span> <span data-ttu-id="e7a4c-191">Skonfiguruj nowy element ObjectDataSource do pobrania danych z metody `SuppliersBLL` Class `GetSuppliers` i Ustaw listę rozwijaną karta Aktualizuj na (brak).</span><span class="sxs-lookup"><span data-stu-id="e7a4c-191">Configure the new ObjectDataSource to retrieve its data from the `SuppliersBLL` class s `GetSuppliers` method and set the UPDATE tab s drop-down list to (None).</span></span> <span data-ttu-id="e7a4c-192">Kliknij przycisk Zakończ, aby zakończyć pracę kreatora.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-192">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="e7a4c-193">[![skonfigurować element ObjectDataSource do używania metody getdostawca klasy SuppliersBLL](batch-inserting-cs/_static/image20.png)](batch-inserting-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="e7a4c-193">[![Configure the ObjectDataSource to Use the SuppliersBLL Class s GetSuppliers Method](batch-inserting-cs/_static/image20.png)](batch-inserting-cs/_static/image19.png)</span></span>

<span data-ttu-id="e7a4c-194">**Rysunek 7**. Konfigurowanie elementu ObjectDataSource do używania metody `GetSuppliers` `SuppliersBLL` klasy s ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](batch-inserting-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="e7a4c-194">**Figure 7**: Configure the ObjectDataSource to Use the `SuppliersBLL` Class s `GetSuppliers` Method ([Click to view full-size image](batch-inserting-cs/_static/image21.png))</span></span>

<span data-ttu-id="e7a4c-195">`Suppliers` DropDownList wyświetlić pola dane `CompanyName` i użyj pola dane `SupplierID` jako wartości `ListItem` s.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-195">Have the `Suppliers` DropDownList display the `CompanyName` data field and use the `SupplierID` data field as its `ListItem` s values.</span></span>

<span data-ttu-id="e7a4c-196">[![wyświetlić pola danych NazwaFirmy i użyć IDDostawcy jako wartości](batch-inserting-cs/_static/image23.png)](batch-inserting-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="e7a4c-196">[![Display the CompanyName Data Field and Use SupplierID as the Value](batch-inserting-cs/_static/image23.png)](batch-inserting-cs/_static/image22.png)</span></span>

<span data-ttu-id="e7a4c-197">**Ilustracja 8**. Wyświetl `CompanyName` pole danych i użyj `SupplierID` jako wartości (kliknij,[Aby wyświetlić obraz w pełnym rozmiarze](batch-inserting-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="e7a4c-197">**Figure 8**: Display the `CompanyName` Data Field and Use `SupplierID` as the Value ([Click to view full-size image](batch-inserting-cs/_static/image24.png))</span></span>

<span data-ttu-id="e7a4c-198">Nazwij drugi DropDownList `Categories` i powiąż go z nowym elementem ObjectDataSource o nazwie `CategoriesDataSource`.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-198">Name the second DropDownList `Categories` and bind it to a new ObjectDataSource named `CategoriesDataSource`.</span></span> <span data-ttu-id="e7a4c-199">Skonfiguruj `CategoriesDataSource` element ObjectDataSource, aby używał metody `GetCategories` klasy `CategoriesBLL`. Ustaw listę rozwijaną na kartach Aktualizuj i Usuń na (brak), a następnie kliknij przycisk Zakończ, aby zakończyć pracę kreatora.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-199">Configure the `CategoriesDataSource` ObjectDataSource to use the `CategoriesBLL` class s `GetCategories` method; set the drop-down lists in the UPDATE and DELETE tabs to (None) and click Finish to complete the wizard.</span></span> <span data-ttu-id="e7a4c-200">Na koniec DropDownList wyświetlić pole danych `CategoryName` i użyj `CategoryID` jako wartości.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-200">Finally, have the DropDownList display the `CategoryName` data field and use the `CategoryID` as the value.</span></span>

<span data-ttu-id="e7a4c-201">Po dodaniu tych dwóch kontrolek DropDownList i powiązaniu odpowiednich skonfigurowanych ObjectDataSourceów ekran powinien wyglądać podobnie do rysunku 9.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-201">After these two DropDownLists have been added and bound to appropriately configured ObjectDataSources, your screen should look similar to Figure 9.</span></span>

<span data-ttu-id="e7a4c-202">[![wiersz nagłówka zawiera teraz dostawców i kategorie kontrolek DropDownList](batch-inserting-cs/_static/image26.png)](batch-inserting-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="e7a4c-202">[![The Header Row Now Contains the Suppliers and Categories DropDownLists](batch-inserting-cs/_static/image26.png)](batch-inserting-cs/_static/image25.png)</span></span>

<span data-ttu-id="e7a4c-203">**Ilustracja 9**: wiersz nagłówka zawiera teraz `Suppliers` i `Categories` kontrolek DropDownList ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](batch-inserting-cs/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="e7a4c-203">**Figure 9**: The Header Row Now Contains the `Suppliers` and `Categories` DropDownLists ([Click to view full-size image](batch-inserting-cs/_static/image27.png))</span></span>

<span data-ttu-id="e7a4c-204">Teraz należy utworzyć pola tekstowe, aby zebrać nazwę i cenę każdego nowego produktu.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-204">We now need to create the TextBoxes to collect the name and price for each new product.</span></span> <span data-ttu-id="e7a4c-205">Przeciągnij kontrolkę TextBox z przybornika na projektanta dla każdej z pięciu wierszy Product Name i Price.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-205">Drag a TextBox control from the Toolbox onto the Designer for each of the five product name and price rows.</span></span> <span data-ttu-id="e7a4c-206">Ustaw właściwości `ID` pól tekstowych na `ProductName1`, `UnitPrice1`, `ProductName2`, `UnitPrice2`, `ProductName3`, `UnitPrice3`itd.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-206">Set the `ID` properties of the TextBoxes to `ProductName1`, `UnitPrice1`, `ProductName2`, `UnitPrice2`, `ProductName3`, `UnitPrice3`, and so on.</span></span>

<span data-ttu-id="e7a4c-207">Dodaj CompareValidator po każdej z pól tekstowych cen jednostkowych, ustawiając właściwość `ControlToValidate` na odpowiednie `ID`.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-207">Add a CompareValidator after each of the unit price TextBoxes, setting the `ControlToValidate` property to the appropriate `ID`.</span></span> <span data-ttu-id="e7a4c-208">Ustaw również właściwość `Operator` na `GreaterThanEqual`, `ValueToCompare` na 0, a `Type` na `Currency`.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-208">Also set the `Operator` property to `GreaterThanEqual`, `ValueToCompare` to 0, and `Type` to `Currency`.</span></span> <span data-ttu-id="e7a4c-209">Te ustawienia instruują CompareValidator, aby upewnić się, że cena, jeśli została wprowadzona, jest prawidłową wartością waluty, która jest większa lub równa zero.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-209">These settings instruct the CompareValidator to ensure that the price, if entered, is a valid currency value that is greater than or equal to zero.</span></span> <span data-ttu-id="e7a4c-210">Ustaw właściwość `Text` na \*, a `ErrorMessage` Cena musi być większa lub równa zero.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-210">Set the `Text` property to \*, and `ErrorMessage` to The price must be greater than or equal to zero.</span></span> <span data-ttu-id="e7a4c-211">Ponadto Pomiń wszystkie symbole walut.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-211">Also, please omit any currency symbols.</span></span>

> [!NOTE]
> <span data-ttu-id="e7a4c-212">Interfejs wstawiania nie zawiera żadnych kontrolek RequiredFieldValidator, mimo że pole `ProductName` w tabeli `Products` Database nie zezwala na wartości `NULL`.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-212">The inserting interface does not include any RequiredFieldValidator controls, even though the `ProductName` field in the `Products` database table does not allow `NULL` values.</span></span> <span data-ttu-id="e7a4c-213">Jest to spowodowane tym, że chcemy pozwolić, aby użytkownik wprowadził do pięciu produktów.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-213">This is because we want to let the user enter up to five products.</span></span> <span data-ttu-id="e7a4c-214">Na przykład, jeśli użytkownik musiał podać nazwę produktu i cenę jednostkową dla pierwszych trzech wierszy, pozostawiając ostatnie dwa wiersze puste, firma Microsoft dodaje trzy nowe produkty do systemu.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-214">For example, if the user were to provide the product name and unit price for the first three rows, leaving the last two rows blank, we d just add three new products to the system.</span></span> <span data-ttu-id="e7a4c-215">Ponieważ jest wymagane `ProductName`, należy przeprowadzić programowo kontrolę, aby upewnić się, że w przypadku wprowadzenia ceny jednostkowej podanej wartości nazwy produktu.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-215">Since `ProductName` is required, however, we will need to programmatically check to ensure that if a unit price is entered that a corresponding product name value is provided.</span></span> <span data-ttu-id="e7a4c-216">Zajmiemy się tym sprawdzaniem w kroku 4.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-216">We'll tackle this check in Step 4.</span></span>

<span data-ttu-id="e7a4c-217">Podczas sprawdzania poprawności danych wejściowych użytkownika CompareValidator raportuje nieprawidłowe dane, jeśli wartość zawiera symbol waluty.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-217">When validating the user s input, the CompareValidator reports invalid data if the value contains a currency symbol.</span></span> <span data-ttu-id="e7a4c-218">Dodaj $ przed każdą z pól tekstowych cen jednostkowych, aby traktować jako wizualną kontrolkę, która powoduje, że użytkownik pomija symbol waluty podczas wprowadzania ceny.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-218">Add a $ in front of each of the unit price TextBoxes to serve as a visual cue that instructs the user to omit the currency symbol when entering the price.</span></span>

<span data-ttu-id="e7a4c-219">Na koniec Dodaj kontrolkę podsumowania walidacji w panelu `InsertingInterface`, ustawienia właściwości `ShowMessageBox` do `true` i jej właściwości `ShowSummary` do `false`.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-219">Lastly, add a ValidationSummary control within the `InsertingInterface` Panel, settings its `ShowMessageBox` property to `true` and its `ShowSummary` property to `false`.</span></span> <span data-ttu-id="e7a4c-220">Jeśli przy użyciu tych ustawień użytkownik wprowadzi nieprawidłową wartość ceny jednostkowej, obok kontrolek TextBox pojawia się gwiazdka, a podsumowania walidacji wyświetli komunikat o błędzie, który określono wcześniej.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-220">With these settings, if the user enters an invalid unit price value, an asterisk will appear next to the offending TextBox controls and the ValidationSummary will display a client-side messagebox that shows the error message we specified earlier.</span></span>

<span data-ttu-id="e7a4c-221">W tym momencie ekran powinien wyglądać podobnie do rysunku 10.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-221">At this point, your screen should look similar to Figure 10.</span></span>

<span data-ttu-id="e7a4c-222">[![Wstawianie interfejsu zawiera teraz pola tekstowe dla nazw produktów i cen](batch-inserting-cs/_static/image29.png)](batch-inserting-cs/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="e7a4c-222">[![The Inserting Interface Now Includes TextBoxes for the Products Names and Prices](batch-inserting-cs/_static/image29.png)](batch-inserting-cs/_static/image28.png)</span></span>

<span data-ttu-id="e7a4c-223">**Ilustracja 10**. interfejs wstawiania zawiera teraz pola tekstowe dla nazw produktów i cen ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](batch-inserting-cs/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="e7a4c-223">**Figure 10**: The Inserting Interface Now Includes TextBoxes for the Products Names and Prices ([Click to view full-size image](batch-inserting-cs/_static/image30.png))</span></span>

<span data-ttu-id="e7a4c-224">Następnie musimy dodać przyciski Dodaj produkty z wysyłki i Anuluj do wiersza stopki.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-224">Next we need to add the Add Products from Shipment and Cancel buttons to the footer row.</span></span> <span data-ttu-id="e7a4c-225">Przeciągnij dwa kontrolki przycisków z przybornika do stopki wstawianego interfejsu, ustawiając przyciski `ID` właściwości na `AddProducts` i `CancelButton` i `Text` właściwości, aby dodać produkty z wysyłki i anulować odpowiednio.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-225">Drag two Button controls from the Toolbox into the footer of the inserting interface, setting the Buttons `ID` properties to `AddProducts` and `CancelButton` and `Text` properties to Add Products from Shipment and Cancel, respectively.</span></span> <span data-ttu-id="e7a4c-226">Ponadto ustaw właściwość `CancelButton` Control s `CausesValidation` na `false`.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-226">In addition, set the `CancelButton` control s `CausesValidation` property to `false`.</span></span>

<span data-ttu-id="e7a4c-227">Na koniec musimy dodać kontrolkę sieci Web etykieta, która będzie wyświetlać komunikaty o stanie dla obu interfejsów.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-227">Finally, we need to add a Label Web control that will display status messages for the two interfaces.</span></span> <span data-ttu-id="e7a4c-228">Na przykład, gdy użytkownik pomyślnie doda nową wysyłkę produktów, chcemy wrócić do interfejsu wyświetlania i wyświetlić komunikat potwierdzenia.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-228">For example, when a user successfully adds a new shipment of products, we want to return to the display interface and display a confirmation message.</span></span> <span data-ttu-id="e7a4c-229">Jeśli jednak użytkownik dostarczy cenę nowego produktu, ale opuszcza nazwę produktu, musimy wyświetlić komunikat ostrzegawczy, ponieważ pole `ProductName` jest wymagane.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-229">If, however, the user provides a price for a new product but leaves off the product name, we need to display a warning message since the `ProductName` field is required.</span></span> <span data-ttu-id="e7a4c-230">Ponieważ potrzebujemy, aby ten komunikat był wyświetlany dla obu interfejsów, umieść go w górnej części strony spoza paneli.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-230">Since we need this message to display for both interfaces, place it at the top of the page outside of the Panels.</span></span>

<span data-ttu-id="e7a4c-231">Przeciągnij kontrolkę Web Label z przybornika do góry strony w projektancie.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-231">Drag a Label Web control from the Toolbox to the top of the page in the Designer.</span></span> <span data-ttu-id="e7a4c-232">Ustaw właściwość `ID` na `StatusLabel`, wyczyść Właściwość `Text` i ustaw właściwości `Visible` i `EnableViewState` na `false`.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-232">Set the `ID` property to `StatusLabel`, clear out the `Text` property, and set the `Visible` and `EnableViewState` properties to `false`.</span></span> <span data-ttu-id="e7a4c-233">Jak widać w poprzednich samouczkach, ustawienie właściwości `EnableViewState` na `false` pozwala nam zmieniać wartości właściwości etykieta s i automatycznie przywracać je do wartości domyślnych podczas kolejnego ogłaszania zwrotnego.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-233">As we have seen in previous tutorials, setting the `EnableViewState` property to `false` allows us to programmatically change the Label s property values and have them automatically revert back to their defaults on the subsequent postback.</span></span> <span data-ttu-id="e7a4c-234">Upraszcza to kod pokazujący komunikat o stanie w odpowiedzi na część akcji użytkownika, która znika po kolejnym ogłaszaniu zwrotnym.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-234">This simplifies the code for showing a status message in response to some user action that disappears on the subsequent postback.</span></span> <span data-ttu-id="e7a4c-235">Na koniec ustaw właściwość `StatusLabel` Control s `CssClass` na Warning, która jest nazwą klasy CSS zdefiniowanej w `Styles.css`, która wyświetla tekst w postaci długiej, kursywy, pogrubienia, czerwonej czcionki.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-235">Finally, set the `StatusLabel` control s `CssClass` property to Warning, which is the name of a CSS class defined in `Styles.css` that displays text in a large, italic, bold, red font.</span></span>

<span data-ttu-id="e7a4c-236">Rysunek 11 pokazuje projektanta programu Visual Studio po dodaniu i skonfigurowaniu etykiety.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-236">Figure 11 shows the Visual Studio Designer after the Label has been added and configured.</span></span>

<span data-ttu-id="e7a4c-237">[![umieścić formant StatusLabel powyżej dwóch kontrolek panelu](batch-inserting-cs/_static/image32.png)](batch-inserting-cs/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="e7a4c-237">[![Place the StatusLabel Control Above the Two Panel Controls](batch-inserting-cs/_static/image32.png)](batch-inserting-cs/_static/image31.png)</span></span>

<span data-ttu-id="e7a4c-238">**Ilustracja 11**. umieszczenie kontrolki `StatusLabel` powyżej dwóch kontrolek panelu ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](batch-inserting-cs/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="e7a4c-238">**Figure 11**: Place the `StatusLabel` Control Above the Two Panel Controls ([Click to view full-size image](batch-inserting-cs/_static/image33.png))</span></span>

## <a name="step-3-switching-between-the-display-and-inserting-interfaces"></a><span data-ttu-id="e7a4c-239">Krok 3. przełączenie między wyświetlaniem i wstawianiem interfejsów</span><span class="sxs-lookup"><span data-stu-id="e7a4c-239">Step 3: Switching Between the Display and Inserting Interfaces</span></span>

<span data-ttu-id="e7a4c-240">W tym momencie ukończymy znaczniki dotyczące wyświetlania i wstawiania interfejsów, ale nadal pozostawiłem dwa zadania:</span><span class="sxs-lookup"><span data-stu-id="e7a4c-240">At this point we have completed the markup for our display and inserting interfaces, but we re still left with two tasks:</span></span>

- <span data-ttu-id="e7a4c-241">Przełączanie między wyświetlaniem i wstawianiem interfejsów</span><span class="sxs-lookup"><span data-stu-id="e7a4c-241">Switching between the display and inserting interfaces</span></span>
- <span data-ttu-id="e7a4c-242">Dodawanie produktów w wysyłce do bazy danych</span><span class="sxs-lookup"><span data-stu-id="e7a4c-242">Adding the products in the shipment to the database</span></span>

<span data-ttu-id="e7a4c-243">Obecnie interfejs wyświetlania jest widoczny, ale interfejs wstawiania jest ukryty.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-243">Currently, the display interface is visible but the inserting interface is hidden.</span></span> <span data-ttu-id="e7a4c-244">Wynika to z faktu, że właściwość `Visible` panelu `DisplayInterface` jest ustawiona na `true` (wartość domyślna), podczas gdy właściwość `InsertingInterface` panelu s `Visible` jest ustawiona na `false`.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-244">This is because the `DisplayInterface` Panel s `Visible` property is set to `true` (the default value), while the `InsertingInterface` Panel s `Visible` property is set to `false`.</span></span> <span data-ttu-id="e7a4c-245">Aby przełączać się między dwoma interfejsami, należy po prostu przełączyć każdą wartość właściwości `Visible` sterowania.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-245">To switch between the two interfaces we simply need to toggle each control s `Visible` property value.</span></span>

<span data-ttu-id="e7a4c-246">Chcemy przenieść z interfejsu wyświetlania do interfejsu wstawiania, gdy zostanie kliknięty przycisk Przetwarzaj produkt dostawy.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-246">We want to move from the display interface to the inserting interface when the Process Product Shipment button is clicked.</span></span> <span data-ttu-id="e7a4c-247">W związku z tym Utwórz procedurę obsługi zdarzeń dla tego przycisku s `Click` zdarzenie, które zawiera następujący kod:</span><span class="sxs-lookup"><span data-stu-id="e7a4c-247">Therefore, create an event handler for this Button s `Click` event that contains the following code:</span></span>

[!code-csharp[Main](batch-inserting-cs/samples/sample4.cs)]

<span data-ttu-id="e7a4c-248">Ten kod po prostu ukrywa panel `DisplayInterface` i pokazuje panel `InsertingInterface`.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-248">This code simply hides the `DisplayInterface` Panel and shows the `InsertingInterface` Panel.</span></span>

<span data-ttu-id="e7a4c-249">Następnie utwórz programy obsługi zdarzeń dla kontrolek Dodaj produkty z wysyłki i Anuluj w interfejsie wstawiania.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-249">Next, create event handlers for the Add Products from Shipment and Cancel Button controls in the inserting interface.</span></span> <span data-ttu-id="e7a4c-250">Po kliknięciu jednego z tych przycisków musimy wrócić do interfejsu wyświetlania.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-250">When either of these Buttons is clicked, we need to revert back to the display interface.</span></span> <span data-ttu-id="e7a4c-251">Utwórz procedury obsługi zdarzeń `Click` dla obu formantów Button, aby wywoływały `ReturnToDisplayInterface`, metodę, którą dodamy na chwilę.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-251">Create `Click` event handlers for both Button controls so that they call `ReturnToDisplayInterface`, a method we will add momentarily.</span></span> <span data-ttu-id="e7a4c-252">Oprócz ukrywania panelu `InsertingInterface` i wyświetlania panelu `DisplayInterface`, Metoda `ReturnToDisplayInterface` musi zwrócić kontrolki sieci Web do ich stanu sprzed edycji.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-252">In addition to hiding the `InsertingInterface` Panel and showing the `DisplayInterface` Panel, the `ReturnToDisplayInterface` method needs to return the Web controls to their pre-editing state.</span></span> <span data-ttu-id="e7a4c-253">Obejmuje to ustawienie właściwości `SelectedIndex` kontrolek DropDownList na 0 i wyczyszczenie właściwości `Text` formantów TextBox.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-253">This involves setting the DropDownLists `SelectedIndex` properties to 0 and clearing out the `Text` properties of the TextBox controls.</span></span>

> [!NOTE]
> <span data-ttu-id="e7a4c-254">Zastanów się, co może się zdarzyć, jeśli nie powrócisz formantów do stanu sprzed edycji przed powrotem do interfejsu wyświetlania.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-254">Consider what might happen if we didn't return the controls to their pre-editing state before returning to the display interface.</span></span> <span data-ttu-id="e7a4c-255">Użytkownik może kliknąć przycisk przetwórz wysyłkę produktu, wprowadzić produkty z wysyłki, a następnie kliknąć pozycję Dodaj produkty z wysyłki.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-255">A user might click the Process Product Shipment button, enter the products from the shipment, and then click Add Products from Shipment.</span></span> <span data-ttu-id="e7a4c-256">Spowoduje to dodanie produktów i zwrócenie tego użytkownika do interfejsu wyświetlania.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-256">This would add the products and return the user to the display interface.</span></span> <span data-ttu-id="e7a4c-257">W tym momencie użytkownik może chcieć dodać kolejną wysyłkę.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-257">At this point the user might want to add another shipment.</span></span> <span data-ttu-id="e7a4c-258">Po kliknięciu przycisku przetwórz dostawy produktu powrócisz do interfejsu wstawianego, ale wartości DropDownList i TextBox będą nadal wypełniane poprzednimi wartościami.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-258">Upon clicking the Process Product Shipment button they would return to the inserting interface but the DropDownList selections and TextBox values would still be populated with their previous values.</span></span>

[!code-csharp[Main](batch-inserting-cs/samples/sample5.cs)]

<span data-ttu-id="e7a4c-259">Oba procedury obsługi zdarzeń `Click` po prostu wywołują metodę `ReturnToDisplayInterface`, ale powrócimy do procedury obsługi zdarzeń Dodaj produkty z wysyłki `Click` w kroku 4 i Dodaj kod, aby zapisać produkty.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-259">Both `Click` event handlers simply call the `ReturnToDisplayInterface` method, although we'll return to the Add Products from Shipment `Click` event handler in Step 4 and add code to save the products.</span></span> <span data-ttu-id="e7a4c-260">`ReturnToDisplayInterface` uruchamia się, zwracając `Suppliers` i `Categories` kontrolek DropDownList do ich pierwszej opcji.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-260">`ReturnToDisplayInterface` starts by returning the `Suppliers` and `Categories` DropDownLists to their first options.</span></span> <span data-ttu-id="e7a4c-261">Dwie stałe `firstControlID` i `lastControlID` oznaczają wartości indeksu początkową i końcową używane podczas nazywania pól tekstowych i cen jednostkowych w interfejsie wstawiania i są używane w granicach pętli `for`, która ustawia `Text` właściwości kontrolek TextBox z powrotem do pustego ciągu.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-261">The two constants `firstControlID` and `lastControlID` mark the starting and ending control index values used in naming the product name and unit price TextBoxes in the inserting interface and are used in the bounds of the `for` loop that sets the `Text` properties of the TextBox controls back to an empty string.</span></span> <span data-ttu-id="e7a4c-262">Na koniec panele `Visible` właściwości są resetowane, aby interfejs wstawiania był ukryty i wyświetlany interfejs wyświetlania.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-262">Finally, the Panels `Visible` properties are reset so that the inserting interface is hidden and the display interface shown.</span></span>

<span data-ttu-id="e7a4c-263">Poświęć chwilę na przetestowanie tej strony w przeglądarce.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-263">Take a moment to test out this page in a browser.</span></span> <span data-ttu-id="e7a4c-264">Podczas pierwszego odwiedzania strony powinien zostać wyświetlony interfejs wyświetlania, jak pokazano na rysunku 5.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-264">When first visiting the page you should see the display interface as was shown in Figure 5.</span></span> <span data-ttu-id="e7a4c-265">Kliknij przycisk Przetwarzaj wysyłkę produktu.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-265">Click the Process Product Shipment button.</span></span> <span data-ttu-id="e7a4c-266">Strona zostanie odstawiona na odświeżenie, a teraz zobaczysz interfejs wstawiania, jak pokazano na rysunku 12.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-266">The page will postback and you should now see the inserting interface as shown in Figure 12.</span></span> <span data-ttu-id="e7a4c-267">Kliknięcie przycisku Dodaj produkty z wysyłki lub Anuluj powoduje powrót do interfejsu wyświetlania.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-267">Clicking either the Add Products from Shipment or Cancel buttons returns you to the display interface.</span></span>

> [!NOTE]
> <span data-ttu-id="e7a4c-268">Podczas wyświetlania interfejsu wstawiania, poświęć chwilę na przetestowanie CompareValidators w polach tekstowych ceny jednostkowej.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-268">While viewing the inserting interface, take a moment to test out the CompareValidators on the unit price TextBoxes.</span></span> <span data-ttu-id="e7a4c-269">Gdy klikniesz przycisk Dodaj produkty z wysyłki po stronie klienta, zobaczysz ostrzeżenie o nieprawidłowych wartościach walutowych lub cenach o wartości mniejszej od zera.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-269">You should see a client-side messagebox warning when clicking the Add Products from Shipment button with invalid currency values or prices with a value less than zero.</span></span>

<span data-ttu-id="e7a4c-270">[![Wstawianie interfejsu jest wyświetlane po kliknięciu przycisku przetwórz dostawy produktu](batch-inserting-cs/_static/image35.png)](batch-inserting-cs/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="e7a4c-270">[![The Inserting Interface is Displayed After Clicking the Process Product Shipment Button](batch-inserting-cs/_static/image35.png)](batch-inserting-cs/_static/image34.png)</span></span>

<span data-ttu-id="e7a4c-271">**Ilustracja 12**. po kliknięciu przycisku przetwórz produkt ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](batch-inserting-cs/_static/image36.png)) zostanie wyświetlony interfejs wstawiania.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-271">**Figure 12**: The Inserting Interface is Displayed After Clicking the Process Product Shipment Button ([Click to view full-size image](batch-inserting-cs/_static/image36.png))</span></span>

## <a name="step-4-adding-the-products"></a><span data-ttu-id="e7a4c-272">Krok 4. Dodawanie produktów</span><span class="sxs-lookup"><span data-stu-id="e7a4c-272">Step 4: Adding the Products</span></span>

<span data-ttu-id="e7a4c-273">Wszystkie te, które pozostaną w tym samouczku, mają na celu zapisanie produktów w bazie danych programu obsługi zdarzeń `Click` Dodaj produkty z wysyłki.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-273">All that remains for this tutorial is to save the products to the database in the Add Products from Shipment Button s `Click` event handler.</span></span> <span data-ttu-id="e7a4c-274">Można to osiągnąć przez utworzenie `ProductsDataTable` i dodanie wystąpienia `ProductsRow` dla każdej dostarczonej nazwy produktu.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-274">This can be accomplished by creating a `ProductsDataTable` and adding a `ProductsRow` instance for each of the product names supplied.</span></span> <span data-ttu-id="e7a4c-275">Po dodaniu tych `ProductsRow` s wykonamy wywołanie metody `ProductsBLL` klasy s `UpdateWithTransaction` przekazywaniu w `ProductsDataTable`.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-275">Once these `ProductsRow` s have been added we will make a call to the `ProductsBLL` class s `UpdateWithTransaction` method passing in the `ProductsDataTable`.</span></span> <span data-ttu-id="e7a4c-276">Odwołaj tę metodę `UpdateWithTransaction`, która została utworzona z powrotem w przypadku [modyfikacji zawijania bazy danych w ramach](wrapping-database-modifications-within-a-transaction-cs.md) samouczka transakcji, przekazuje `ProductsDataTable` do metody `UpdateWithTransaction` `ProductsTableAdapter` s.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-276">Recall that the `UpdateWithTransaction` method, which was created back in the [Wrapping Database Modifications within a Transaction](wrapping-database-modifications-within-a-transaction-cs.md) tutorial, passes the `ProductsDataTable` to the `ProductsTableAdapter` s `UpdateWithTransaction` method.</span></span> <span data-ttu-id="e7a4c-277">Z tego miejsca zostanie uruchomiona ADO.NET transakcji, a TableAdapter wystawia instrukcję `INSERT` do bazy danych dla każdej dodanej `ProductsRow` w elemencie DataTable.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-277">From there, an ADO.NET transaction is started and the TableAdapter issues an `INSERT` statement to the database for each added `ProductsRow` in the DataTable.</span></span> <span data-ttu-id="e7a4c-278">Przy założeniu, że wszystkie produkty są dodawane bez błędu, transakcja zostanie zatwierdzona, w przeciwnym razie zostanie wycofana.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-278">Assuming all products are added without error, the transaction is committed, otherwise it is rolled back.</span></span>

<span data-ttu-id="e7a4c-279">Kod dla przycisku Dodaj produkty z wysyłki s `Click` programu obsługi zdarzeń musi także wykonać trochę sprawdzania błędów.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-279">The code for the Add Products from Shipment Button s `Click` event handler also needs to perform a bit of error checking.</span></span> <span data-ttu-id="e7a4c-280">Ponieważ nie ma żadnych RequiredFieldValidators w interfejsie wstawiania, użytkownik może wprowadzić cenę dla produktu, pomijając jego nazwę.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-280">Since there are no RequiredFieldValidators used in the inserting interface, a user could enter a price for a product while omitting its name.</span></span> <span data-ttu-id="e7a4c-281">Ponieważ wymagana jest nazwa produktu, jeśli taki warunek nie ma załamania, musimy ostrzec użytkownika i nie kontynuować operacji wstawiania.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-281">Since the product s name is required, if such a condition unfolds we need to alert the user and not proceed with the inserts.</span></span> <span data-ttu-id="e7a4c-282">Pełny kod procedury obsługi zdarzeń `Click` następujący:</span><span class="sxs-lookup"><span data-stu-id="e7a4c-282">The complete `Click` event handler code follows:</span></span>

[!code-csharp[Main](batch-inserting-cs/samples/sample6.cs)]

<span data-ttu-id="e7a4c-283">Program obsługi zdarzeń jest uruchamiany przez zagwarantowanie, że właściwość `Page.IsValid` zwraca wartość `true`.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-283">The event handler starts by ensuring that the `Page.IsValid` property returns a value of `true`.</span></span> <span data-ttu-id="e7a4c-284">Jeśli zwróci `false`, oznacza to, że co najmniej jedna CompareValidators zgłasza nieprawidłowe dane; w takim przypadku nie chcemy próbować wstawiać wprowadzonych produktów lub wystąpi wyjątek podczas próby przypisania wartości ceny jednostkowej wprowadzonej przez użytkownika do właściwości `UnitPrice` `ProductsRow` s.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-284">If it returns `false`, then that means one or more of the CompareValidators are reporting invalid data; in such a case we do not want to attempt to insert the entered products or we'll end up with an exception when attempting to assign the user-entered unit price value to the `ProductsRow` s `UnitPrice` property.</span></span>

<span data-ttu-id="e7a4c-285">Następnie zostanie utworzone nowe wystąpienie `ProductsDataTable` (`products`).</span><span class="sxs-lookup"><span data-stu-id="e7a4c-285">Next, a new `ProductsDataTable` instance is created (`products`).</span></span> <span data-ttu-id="e7a4c-286">Pętla `for` jest używana do iteracji w postaci pól tekstowych i cen jednostkowych, a właściwości `Text` są odczytywane w zmiennych lokalnych `productName` i `unitPrice`.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-286">A `for` loop is used to iterate through the product name and unit price TextBoxes and the `Text` properties are read into the local variables `productName` and `unitPrice`.</span></span> <span data-ttu-id="e7a4c-287">Jeśli użytkownik wprowadzi wartość w polu cena jednostkowa, ale nie dla odpowiadającej mu nazwy produktu, `StatusLabel` wyświetli komunikat, jeśli podano cenę jednostkową, należy również uwzględnić nazwę produktu, a program obsługi zdarzeń zostanie zakończony.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-287">If the user has entered a value for the unit price but not for the corresponding product name, the `StatusLabel` displays the message If you provide a unit price you must also include the name of the product and the event handler is exited.</span></span>

<span data-ttu-id="e7a4c-288">W przypadku podanej nazwy produktu nowe wystąpienie `ProductsRow` jest tworzone przy użyciu metody `ProductsDataTable` s `NewProductsRow`.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-288">If a product name has been provided, a new `ProductsRow` instance is created using the `ProductsDataTable` s `NewProductsRow` method.</span></span> <span data-ttu-id="e7a4c-289">Ta nowa Właściwość `ProductsRow` wystąpienia s `ProductName` jest ustawiona na bieżącą nazwę produktu, podczas gdy właściwości `SupplierID` i `CategoryID` są przypisane do właściwości `SelectedValue` kontrolek DropDownList w nagłówku Wstawianie interfejsu s.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-289">This new `ProductsRow` instance s `ProductName` property is set to the current product name TextBox while the `SupplierID` and `CategoryID` properties are assigned to the `SelectedValue` properties of the DropDownLists in the inserting interface s header.</span></span> <span data-ttu-id="e7a4c-290">Jeśli użytkownik wprowadził wartość dla ceny produktu s, zostanie przypisany do właściwości `ProductsRow` wystąpienia s `UnitPrice`; w przeciwnym razie właściwość zostanie pozostawiona nieprzypisane, co spowoduje `NULL` wartość `UnitPrice` w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-290">If the user entered a value for the product s price, it is assigned to the `ProductsRow` instance s `UnitPrice` property; otherwise, the property is left unassigned, which will result in a `NULL` value for `UnitPrice` in the database.</span></span> <span data-ttu-id="e7a4c-291">Na koniec właściwości `Discontinued` i `UnitsOnOrder` są przypisywane do zakodowanych wartości `false` i 0 odpowiednio.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-291">Finally, the `Discontinued` and `UnitsOnOrder` properties are assigned to the hard-coded values `false` and 0, respectively.</span></span>

<span data-ttu-id="e7a4c-292">Po przypisaniu właściwości do wystąpienia `ProductsRow` zostanie ono dodane do `ProductsDataTable`.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-292">After the properties have been assigned to the `ProductsRow` instance it is added to the `ProductsDataTable`.</span></span>

<span data-ttu-id="e7a4c-293">Po zakończeniu pętli `for` sprawdzimy, czy zostały dodane jakieś produkty.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-293">At the completion of the `for` loop, we check whether any products have been added.</span></span> <span data-ttu-id="e7a4c-294">Użytkownik może po każdym kliknięciu dodać produkty z wysyłki przed wprowadzeniem jakichkolwiek nazw produktów lub cen.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-294">The user may, after all, have clicked the Add Products from Shipment before entering any product names or prices.</span></span> <span data-ttu-id="e7a4c-295">Jeśli w `ProductsDataTable`istnieje co najmniej jeden produkt, wywoływana jest metoda `ProductsBLL` klasy s `UpdateWithTransaction`.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-295">If there is at least one product in the `ProductsDataTable`, the `ProductsBLL` class s `UpdateWithTransaction` method is called.</span></span> <span data-ttu-id="e7a4c-296">Następnie dane zostaną przepowiązane z `ProductsGrid` GridView, aby nowo dodane produkty pojawiły się w interfejsie wyświetlania.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-296">Next, the data is rebound to the `ProductsGrid` GridView so that the newly added products will appear in the display interface.</span></span> <span data-ttu-id="e7a4c-297">`StatusLabel` został zaktualizowany, aby wyświetlić komunikat z potwierdzeniem i `ReturnToDisplayInterface` jest wywoływany, ukrywając interfejs wstawiania i pokazując interfejs wyświetlania.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-297">The `StatusLabel` is updated to display a confirmation message and the `ReturnToDisplayInterface` is invoked, hiding the inserting interface and showing the display interface.</span></span>

<span data-ttu-id="e7a4c-298">Jeśli nie wprowadzono żadnych produktów, interfejs wstawiania pozostaje wyświetlany, ale komunikat nie został dodany.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-298">If no products were entered, the inserting interface remains displayed but the message No products were added.</span></span> <span data-ttu-id="e7a4c-299">Wprowadź nazwy produktów i ceny jednostkowe w polach tekstowych.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-299">Please enter the product names and unit prices in the textboxes is displayed.</span></span>

<span data-ttu-id="e7a4c-300">Rysunek s 13, 14 i 15 Pokaż interfejsy wstawiania i wyświetlania w działaniu.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-300">Figure s 13, 14, and 15 show the inserting and display interfaces in action.</span></span> <span data-ttu-id="e7a4c-301">Na rysunku 13 użytkownik wprowadził wartość ceny jednostkowej bez odpowiadającej jej nazwy produktu.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-301">In Figure 13, the user has entered a unit price value without a corresponding product name.</span></span> <span data-ttu-id="e7a4c-302">Ilustracja 14 przedstawia interfejs wyświetlania po pomyślnym dodaniu trzech nowych produktów, natomiast rysunek 15 pokazuje dwa z nowo dodanych produktów w GridView (trzecia strona znajduje się na poprzedniej stronie).</span><span class="sxs-lookup"><span data-stu-id="e7a4c-302">Figure 14 shows the display interface after three new products have been added successfully, while Figure 15 shows two of the newly added products in the GridView (the third one is on the previous page).</span></span>

<span data-ttu-id="e7a4c-303">[![Nazwa produktu jest wymagana, gdy zostanie wprowadzona cena jednostkowa](batch-inserting-cs/_static/image38.png)](batch-inserting-cs/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="e7a4c-303">[![A Product Name is Required When Entering a Unit Price](batch-inserting-cs/_static/image38.png)](batch-inserting-cs/_static/image37.png)</span></span>

<span data-ttu-id="e7a4c-304">**Ilustracja 13**. Nazwa produktu jest wymagana podczas wprowadzania ceny jednostkowej ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](batch-inserting-cs/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="e7a4c-304">**Figure 13**: A Product Name is Required When Entering a Unit Price ([Click to view full-size image](batch-inserting-cs/_static/image39.png))</span></span>

<span data-ttu-id="e7a4c-305">[![dodano trzy nowe veggies dla dostawcy Mayumi s](batch-inserting-cs/_static/image41.png)](batch-inserting-cs/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="e7a4c-305">[![Three New Veggies Have Been Added for the Supplier Mayumi s](batch-inserting-cs/_static/image41.png)](batch-inserting-cs/_static/image40.png)</span></span>

<span data-ttu-id="e7a4c-306">**Ilustracja 14**. Dodano trzy nowe veggies dla dostawcy Mayumi s ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](batch-inserting-cs/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="e7a4c-306">**Figure 14**: Three New Veggies Have Been Added for the Supplier Mayumi s ([Click to view full-size image](batch-inserting-cs/_static/image42.png))</span></span>

<span data-ttu-id="e7a4c-307">[![nowe produkty znajdują się na ostatniej stronie widoku GridView](batch-inserting-cs/_static/image44.png)](batch-inserting-cs/_static/image43.png)</span><span class="sxs-lookup"><span data-stu-id="e7a4c-307">[![The New Products Can Be Found in the Last Page of the GridView](batch-inserting-cs/_static/image44.png)](batch-inserting-cs/_static/image43.png)</span></span>

<span data-ttu-id="e7a4c-308">**Ilustracja 15**. nowe produkty znajdują się na ostatniej stronie widoku GridView ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](batch-inserting-cs/_static/image45.png))</span><span class="sxs-lookup"><span data-stu-id="e7a4c-308">**Figure 15**: The New Products Can Be Found in the Last Page of the GridView ([Click to view full-size image](batch-inserting-cs/_static/image45.png))</span></span>

> [!NOTE]
> <span data-ttu-id="e7a4c-309">Logika wstawiania wsadowego użyta w tym samouczku otacza Wstawianie w ramach zakresu transakcji.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-309">The batch inserting logic used in this tutorial wraps the inserts within the scope of transaction.</span></span> <span data-ttu-id="e7a4c-310">Aby to sprawdzić, celowo całkowicie wprowadzić błąd na poziomie bazy danych.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-310">To verify this, purposefully introduce a database-level error.</span></span> <span data-ttu-id="e7a4c-311">Na przykład zamiast przypisywać nową właściwość `ProductsRow` wystąpienia s `CategoryID` do wybranej wartości w `Categories` DropDownList, przypisz ją do wartości podobnej do `i * 5`.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-311">For example, rather than assigning the new `ProductsRow` instance s `CategoryID` property to the selected value in the `Categories` DropDownList, assign it to a value like `i * 5`.</span></span> <span data-ttu-id="e7a4c-312">Tutaj `i` jest indeksator pętli i ma wartości z zakresu od 1 do 5.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-312">Here `i` is the loop indexer and has values ranging from 1 to 5.</span></span> <span data-ttu-id="e7a4c-313">W związku z tym podczas dodawania co najmniej dwóch produktów w usłudze Batch pierwszy produkt będzie miał prawidłową wartość `CategoryID` (5), ale kolejne produkty będą mieć `CategoryID` wartości, które nie pasują do `CategoryID` wartości w tabeli `Categories`.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-313">Therefore, when adding two or more products in batch insert the first product will have a valid `CategoryID` value (5), but subsequent products will have `CategoryID` values that do not match up to `CategoryID` values in the `Categories` table.</span></span> <span data-ttu-id="e7a4c-314">Efektem netto jest to, że podczas gdy pierwsze `INSERT` powiedzie się, kolejne z nich zakończą się niepowodzeniem z naruszeniem ograniczenia klucza obcego.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-314">The net effect is that while the first `INSERT` will succeed, subsequent ones will fail with a foreign key constraint violation.</span></span> <span data-ttu-id="e7a4c-315">Ponieważ wstawka wsadowa jest niepodzielna, pierwsze `INSERT` zostanie wycofane, zwracając bazę danych do stanu przed rozpoczęciem procesu tworzenia wsadowego.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-315">Since the batch insert is atomic, the first `INSERT` will be rolled back, returning the database to its state before the batch insert process began.</span></span>

## <a name="summary"></a><span data-ttu-id="e7a4c-316">Podsumowanie</span><span class="sxs-lookup"><span data-stu-id="e7a4c-316">Summary</span></span>

<span data-ttu-id="e7a4c-317">W ten sposób i poprzednie dwa samouczki utworzyły interfejsy umożliwiające aktualizowanie, usuwanie i wstawianie partii danych, z których korzystamy z obsługi transakcji dodanych do warstwy dostępu do danych w ramach samouczka [transakcji](wrapping-database-modifications-within-a-transaction-cs.md) .</span><span class="sxs-lookup"><span data-stu-id="e7a4c-317">Over this and the previous two tutorials we have created interfaces that allow for updating, deleting, and inserting batches of data, all of which used the transaction support we added to the Data Access Layer in the [Wrapping Database Modifications within a Transaction](wrapping-database-modifications-within-a-transaction-cs.md) tutorial.</span></span> <span data-ttu-id="e7a4c-318">W niektórych scenariuszach takie przetwarzanie wsadowe interfejsów użytkownika znacznie poprawia wydajność użytkowników końcowych dzięki wykorzystaniu liczby kliknięć, ogłaszania zwrotnego i przełączania kontekstu klawiatury na mysz, zachowując jednocześnie integralność danych źródłowych.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-318">For certain scenarios, such batch processing user interfaces greatly improve end user efficiency by cutting down on the number of clicks, postbacks, and keyboard-to-mouse context switches, while also maintaining the integrity of the underlying data.</span></span>

<span data-ttu-id="e7a4c-319">Ten samouczek kończy pracę z danymi wsadowymi.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-319">This tutorial completes our look at working with batched data.</span></span> <span data-ttu-id="e7a4c-320">W następnym zestawie samouczków przedstawiono różne scenariusze zaawansowanej warstwy dostępu do danych, w tym używanie procedur składowanych w metodach TableAdapter, Konfigurowanie ustawień na poziomie połączenia i poleceń w DAL, szyfrowanie parametrów połączenia itp.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-320">The next set of tutorials explores a variety of advanced Data Access Layer scenarios, including using stored procedures in the TableAdapter s methods, configuring connection- and command-level settings in the DAL, encrypting connection strings, and more!</span></span>

<span data-ttu-id="e7a4c-321">Szczęśliwe programowanie!</span><span class="sxs-lookup"><span data-stu-id="e7a4c-321">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="e7a4c-322">Informacje o autorze</span><span class="sxs-lookup"><span data-stu-id="e7a4c-322">About the Author</span></span>

<span data-ttu-id="e7a4c-323">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor siedmiu grup ASP/ASP. NET Books i założyciel of [4GuysFromRolla.com](http://www.4guysfromrolla.com), pracował z technologiami sieci Web firmy Microsoft od czasu 1998.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-323">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="e7a4c-324">Scott działa jako niezależny konsultant, trainer i składnik zapisywania.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-324">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="e7a4c-325">Jego Najnowsza książka to [*Sams ASP.NET 2,0 w ciągu 24 godzin*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="e7a4c-325">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="e7a4c-326">Można go osiągnąć w [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="e7a4c-326">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="e7a4c-327">lub za pośrednictwem swojego blogu, który można znaleźć w [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="e7a4c-327">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="e7a4c-328">Specjalne podziękowania</span><span class="sxs-lookup"><span data-stu-id="e7a4c-328">Special Thanks To</span></span>

<span data-ttu-id="e7a4c-329">Ta seria samouczków została sprawdzona przez wielu przydatnych recenzentów.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-329">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="e7a4c-330">Recenzenci dla liderów w tym samouczku zostały Hilton Giesenow i S Ren Jacob Lauritsen.</span><span class="sxs-lookup"><span data-stu-id="e7a4c-330">Lead reviewers for this tutorial were Hilton Giesenow and S ren Jacob Lauritsen.</span></span> <span data-ttu-id="e7a4c-331">Chcesz przeglądać moje nadchodzące artykuły MSDN?</span><span class="sxs-lookup"><span data-stu-id="e7a4c-331">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="e7a4c-332">Jeśli tak, upuść mi linię w [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="e7a4c-332">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="e7a4c-333">[Poprzednie](batch-deleting-cs.md)
> [dalej](wrapping-database-modifications-within-a-transaction-vb.md)</span><span class="sxs-lookup"><span data-stu-id="e7a4c-333">[Previous](batch-deleting-cs.md)
[Next](wrapping-database-modifications-within-a-transaction-vb.md)</span></span>
