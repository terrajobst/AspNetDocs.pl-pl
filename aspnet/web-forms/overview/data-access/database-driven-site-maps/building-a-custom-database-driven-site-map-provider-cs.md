---
uid: web-forms/overview/data-access/database-driven-site-maps/building-a-custom-database-driven-site-map-provider-cs
title: Tworzenie dostawcy mapy witryny opartej na bazie danych niestandardowych (C#) | Dokumentacja firmy Microsoft
author: rick-anderson
description: Dostawcy mapy witryny domyślnej w programie ASP.NET 2.0 pobiera dane z pliku XML statycznego. Gdy dostawca oparty na składni XML będzie odpowiednia dla wielu małych, jak i średni rozmiar...
ms.author: riande
ms.date: 06/26/2007
ms.assetid: 04b7591d-106f-4f05-87e9-d416cb65a8a6
msc.legacyurl: /web-forms/overview/data-access/database-driven-site-maps/building-a-custom-database-driven-site-map-provider-cs
msc.type: authoredcontent
ms.openlocfilehash: 4db59ed13aef81e94feba61299e710bfddd78a76
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 03/01/2019
ms.locfileid: "57072038"
---
<a name="building-a-custom-database-driven-site-map-provider-c"></a><span data-ttu-id="f5154-104">Tworzenie niestandardowego dostawcy map witryn opartych na bazie danych (C#)</span><span class="sxs-lookup"><span data-stu-id="f5154-104">Building a Custom Database-Driven Site Map Provider (C#)</span></span>
====================
<span data-ttu-id="f5154-105">przez [Bento Scott](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="f5154-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="f5154-106">[Pobierz program Code](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_62_CS.zip) lub [Pobierz plik PDF](building-a-custom-database-driven-site-map-provider-cs/_static/datatutorial62cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="f5154-106">[Download Code](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_62_CS.zip) or [Download PDF](building-a-custom-database-driven-site-map-provider-cs/_static/datatutorial62cs1.pdf)</span></span>

> <span data-ttu-id="f5154-107">Dostawcy mapy witryny domyślnej w programie ASP.NET 2.0 pobiera dane z pliku XML statycznego.</span><span class="sxs-lookup"><span data-stu-id="f5154-107">The default site map provider in ASP.NET 2.0 retrieves its data from a static XML file.</span></span> <span data-ttu-id="f5154-108">Dostawca opartych na języku XML nadaje się do wielu witryn sieci Web małe i średnie, większej aplikacji sieci Web wymagają mapy witryny sieci Web bardziej dynamiczne.</span><span class="sxs-lookup"><span data-stu-id="f5154-108">While the XML-based provider is suitable to many small and medium-sized Web sites, larger Web applications require a more dynamic site map.</span></span> <span data-ttu-id="f5154-109">W tym samouczku utworzymy niestandardowego dostawcy mapy witryny, która pobiera dane z warstwy logiki biznesowej, która z kolei pobiera dane z bazy danych.</span><span class="sxs-lookup"><span data-stu-id="f5154-109">In this tutorial we'll build a custom site map provider that retrieves its data from the Business Logic Layer, which in turn retrieves data from the database.</span></span>


## <a name="introduction"></a><span data-ttu-id="f5154-110">Wprowadzenie</span><span class="sxs-lookup"><span data-stu-id="f5154-110">Introduction</span></span>

<span data-ttu-id="f5154-111">Program ASP.NET 2.0 funkcji mapy witryny s temu deweloper strony do definiowania mapy witryny sieci web aplikacji s niektóre nośnika trwałego, takie jak w pliku XML.</span><span class="sxs-lookup"><span data-stu-id="f5154-111">ASP.NET 2.0 s site map feature enables a page developer to define a web application s site map in some persistent medium, such as in an XML file.</span></span> <span data-ttu-id="f5154-112">Po zdefiniowaniu dane mapy witryny są dostępne programowo za pośrednictwem [ `SiteMap` klasy](https://msdn.microsoft.com/library/system.web.sitemap.aspx) w [ `System.Web` przestrzeni nazw](https://msdn.microsoft.com/library/system.web.aspx) lub przy użyciu różnych nawigacji sieci Web formanty, takie jak Formanty SiteMapPath, Menu i widoku drzewa.</span><span class="sxs-lookup"><span data-stu-id="f5154-112">Once defined, the site map data can be accessed programmatically through the [`SiteMap` class](https://msdn.microsoft.com/library/system.web.sitemap.aspx) in the [`System.Web` namespace](https://msdn.microsoft.com/library/system.web.aspx) or through a variety of navigation Web controls, such as the SiteMapPath, Menu, and TreeView controls.</span></span> <span data-ttu-id="f5154-113">System mapy witryny używa [modelu dostawca](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx) tak, aby implementacje serializacji mapy innej lokacji można tworzyć i podłączony do aplikacji sieci web.</span><span class="sxs-lookup"><span data-stu-id="f5154-113">The site map system uses the [provider model](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx) so that different site map serialization implementations can be created and plugged into a web application.</span></span> <span data-ttu-id="f5154-114">Dostawcy mapy witryny domyślnej, który jest dostarczany z programem ASP.NET 2.0 są utrwalane struktury mapy witryny w pliku XML.</span><span class="sxs-lookup"><span data-stu-id="f5154-114">The default site map provider that ships with ASP.NET 2.0 persists site map structure in an XML file.</span></span> <span data-ttu-id="f5154-115">Ponownie [strony wzorcowe i nawigacja w witrynie](../introduction/master-pages-and-site-navigation-cs.md) samouczku utworzyliśmy plik o nazwie `Web.sitemap` , zawarty tej struktury i jego XML został Trwa aktualizowanie za pomocą każdej nowej sekcji samouczka.</span><span class="sxs-lookup"><span data-stu-id="f5154-115">Back in the [Master Pages and Site Navigation](../introduction/master-pages-and-site-navigation-cs.md) tutorial we created a file named `Web.sitemap` that contained this structure and have been updating its XML with each new tutorial section.</span></span>

<span data-ttu-id="f5154-116">Dostawcy mapy witryny opartego na języku XML domyślne działa dobrze, jeśli struktura s mapy witryny jest stosunkowo statycznych, takich jak potrzeby tych samouczków.</span><span class="sxs-lookup"><span data-stu-id="f5154-116">The default XML-based site map provider works well if the site map s structure is fairly static, such as for these tutorials.</span></span> <span data-ttu-id="f5154-117">W wielu scenariuszach jednak bardziej dynamiczne mapy witryny jest wymagany.</span><span class="sxs-lookup"><span data-stu-id="f5154-117">In many scenarios, however, a more dynamic site map is needed.</span></span> <span data-ttu-id="f5154-118">Należy wziąć pod uwagę Mapa witryny, przedstawionej na rysunku 1, w którym każdej kategorii i produktu są wyświetlane jako sekcje w strukturze s witryny sieci Web.</span><span class="sxs-lookup"><span data-stu-id="f5154-118">Consider the site map shown in Figure 1, where each category and product appear as sections in the website s structure.</span></span> <span data-ttu-id="f5154-119">Za pomocą tej mapy witryny odwiedzając stronę sieci web, odpowiadający węzeł główny może wyświetlić listę wszystkich kategorii, odwiedzając stronę sieci web określonej kategorii s zwróciłaby listę produktów s tej kategorii i wyświetlania strony sieci web określonym produktem s pokazywałaby produktu szczegóły s.</span><span class="sxs-lookup"><span data-stu-id="f5154-119">With this site map, visiting the web page corresponding to the root node might list all of the categories, whereas visiting a particular category s web page would list that category s products and viewing a particular product s web page would show that product s details.</span></span>


<span data-ttu-id="f5154-120">[![Kategorie i produktów w skład struktury s mapy witryny](building-a-custom-database-driven-site-map-provider-cs/_static/image1.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="f5154-120">[![The Categories and Products Makeup the Site Map s Structure](building-a-custom-database-driven-site-map-provider-cs/_static/image1.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image1.png)</span></span>

<span data-ttu-id="f5154-121">**Rysunek 1**: Kategorie i produkty korzeń s mapy witryny struktury ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="f5154-121">**Figure 1**: The Categories and Products Makeup the Site Map s Structure ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image2.png))</span></span>


<span data-ttu-id="f5154-122">Ta struktura według kategorii i produktu może być ustalone w `Web.sitemap` pliku, plik musi być aktualizowane za każdym razem w kategorii lub dodane, usunięte lub zmieniono jego nazwę produktu.</span><span class="sxs-lookup"><span data-stu-id="f5154-122">While this category- and product-based structure could be hard-coded into the `Web.sitemap` file, the file would need to be updated each time a category or product was added, removed, or renamed.</span></span> <span data-ttu-id="f5154-123">W związku z tym obsługa map lokacji będzie znacznie uprościć jeśli jego strukturę została pobrana z bazy danych, lub najlepiej, jeśli z warstwy logiki biznesowej aplikacji architektury s.</span><span class="sxs-lookup"><span data-stu-id="f5154-123">Consequently, the site map maintenance would be greatly simplified if its structure was retrieved from the database or, ideally, from the Business Logic Layer of the application s architecture.</span></span> <span data-ttu-id="f5154-124">W ten sposób, jak produkty i kategorie zostały dodane, zmieniono nazwę lub usunięto, Mapa witryny będzie automatycznie aktualizowana w celu odzwierciedlenia tych zmian.</span><span class="sxs-lookup"><span data-stu-id="f5154-124">That way, as products and categories were added, renamed, or deleted, the site map would automatically update to reflect these changes.</span></span>

<span data-ttu-id="f5154-125">Ponieważ serializacji mapy witryny s ASP.NET 2.0 jest kompilowanych na podstawie modelu dostawców, możemy utworzyć własną niestandardowego dostawcy mapy witryny, bierze jego dane z magazynu danych, takich jak bazy danych lub architektury.</span><span class="sxs-lookup"><span data-stu-id="f5154-125">Since ASP.NET 2.0 s site map serialization is built atop the provider model, we can create our own custom site map provider that grabs its data from an alternate data store, such as the database or architecture.</span></span> <span data-ttu-id="f5154-126">W tym samouczku utworzymy niestandardowego dostawcy, która pobiera dane z LOGIKI.</span><span class="sxs-lookup"><span data-stu-id="f5154-126">In this tutorial we'll build a custom provider that retrieves its data from the BLL.</span></span> <span data-ttu-id="f5154-127">Rozpocznij pracę dzięki s!</span><span class="sxs-lookup"><span data-stu-id="f5154-127">Let s get started!</span></span>

> [!NOTE]
> <span data-ttu-id="f5154-128">Niestandardowego dostawcy mapy witryny utworzonych w tym samouczku jest ściśle powiązany aplikacji s architektury i danych modelu.</span><span class="sxs-lookup"><span data-stu-id="f5154-128">The custom site map provider created in this tutorial is tightly coupled to the application s architecture and data model.</span></span> <span data-ttu-id="f5154-129">Jeff Prosise s [przechowywania mapy witryny w programie SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) i [dostawcy mapy witryny SQL był dawna oczekiwane](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx) artykuły zbadać uogólnionego podejścia do przechowywania danych mapy witryny w programie SQL Server.</span><span class="sxs-lookup"><span data-stu-id="f5154-129">Jeff Prosise s [Storing Site Maps in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) and [The SQL Site Map Provider You ve Been Waiting For](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx) articles examine a generalized approach to storing site map data in SQL Server.</span></span>


## <a name="step-1-creating-the-custom-site-map-provider-web-pages"></a><span data-ttu-id="f5154-130">Krok 1. Tworzenie stron sieci Web uzyskiwania informacji na temat dostawcy mapy witryny niestandardowej</span><span class="sxs-lookup"><span data-stu-id="f5154-130">Step 1: Creating the Custom Site Map Provider Web Pages</span></span>

<span data-ttu-id="f5154-131">Zanim zaczniemy Tworzenie niestandardowego dostawcy mapy witryny, należy umożliwić s najpierw dodać strony ASP.NET, które będą potrzebne w ramach tego samouczka.</span><span class="sxs-lookup"><span data-stu-id="f5154-131">Before we start creating a custom site map provider, let s first add the ASP.NET pages we'll need for this tutorial.</span></span> <span data-ttu-id="f5154-132">Rozpocznij od dodania nowy folder o nazwie `SiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="f5154-132">Start by adding a new folder named `SiteMapProvider`.</span></span> <span data-ttu-id="f5154-133">Następnie dodaj następujące strony ASP.NET do tego folderu, upewniając się skojarzyć każdą stronę z `Site.master` strona główna:</span><span class="sxs-lookup"><span data-stu-id="f5154-133">Next, add the following ASP.NET pages to that folder, making sure to associate each page with the `Site.master` master page:</span></span>

- `Default.aspx`
- `ProductsByCategory.aspx`
- `ProductDetails.aspx`

<span data-ttu-id="f5154-134">Również dodać `CustomProviders` podfolder na potrzeby `App_Code` folderu.</span><span class="sxs-lookup"><span data-stu-id="f5154-134">Also add a `CustomProviders` subfolder to the `App_Code` folder.</span></span>


![Dodawanie stron ASP.NET samouczki dotyczące dostawcy mapy witryny](building-a-custom-database-driven-site-map-provider-cs/_static/image2.gif)

<span data-ttu-id="f5154-136">**Rysunek 2**: Dodawanie stron ASP.NET samouczki dotyczące dostawcy mapy witryny</span><span class="sxs-lookup"><span data-stu-id="f5154-136">**Figure 2**: Add the ASP.NET Pages for the Site Map Provider-Related Tutorials</span></span>


<span data-ttu-id="f5154-137">Ponieważ istnieje tylko jeden samouczek dla tej sekcji, firma Microsoft don potrzebę t `Default.aspx` Aby wyświetlić listę samouczków sekcji s.</span><span class="sxs-lookup"><span data-stu-id="f5154-137">Since there is only one tutorial for this section, we don t need `Default.aspx` to list the section s tutorials.</span></span> <span data-ttu-id="f5154-138">Zamiast tego `Default.aspx` będą wyświetlane kategorie w kontrolce GridView.</span><span class="sxs-lookup"><span data-stu-id="f5154-138">Instead, `Default.aspx` will display the categories in a GridView control.</span></span> <span data-ttu-id="f5154-139">Firma Microsoft będzie rozwiązano ten problem w kroku 2.</span><span class="sxs-lookup"><span data-stu-id="f5154-139">We'll tackle this in Step 2.</span></span>

<span data-ttu-id="f5154-140">Następnie zaktualizuj `Web.sitemap` obejmujący odwołaniem do `Default.aspx` strony.</span><span class="sxs-lookup"><span data-stu-id="f5154-140">Next, update `Web.sitemap` to include a reference to the `Default.aspx` page.</span></span> <span data-ttu-id="f5154-141">W szczególności należy dodać następujące znaczniki po Caching `<siteMapNode>`:</span><span class="sxs-lookup"><span data-stu-id="f5154-141">Specifically, add the following markup after the Caching `<siteMapNode>`:</span></span>


[!code-xml[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample1.xml)]

<span data-ttu-id="f5154-142">Po zaktualizowaniu `Web.sitemap`, Poświęć chwilę, aby wyświetlić witrynę sieci Web w samouczkach, za pośrednictwem przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="f5154-142">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="f5154-143">Menu po lewej stronie zawiera teraz element samouczek dostawcy mapy witryny wyłącznie.</span><span class="sxs-lookup"><span data-stu-id="f5154-143">The menu on the left now includes an item for the sole site map provider tutorial.</span></span>


![Mapa witryny zawiera teraz wpis dla samouczka dostawcy mapy witryny](building-a-custom-database-driven-site-map-provider-cs/_static/image3.gif)

<span data-ttu-id="f5154-145">**Rysunek 3**: Mapa witryny zawiera teraz wpis dla samouczka dostawcy mapy witryny</span><span class="sxs-lookup"><span data-stu-id="f5154-145">**Figure 3**: The Site Map Now Includes an Entry for the Site Map Provider Tutorial</span></span>


<span data-ttu-id="f5154-146">Ten samouczek s głównego koncentruje się na ilustrują Tworzenie niestandardowego dostawcy mapy witryny i konfigurowanie aplikacji sieci web do używania tego dostawcy.</span><span class="sxs-lookup"><span data-stu-id="f5154-146">This tutorial s main focus is to illustrate creating a custom site map provider and configuring a web application to use that provider.</span></span> <span data-ttu-id="f5154-147">W szczególności będziemy tworzyć dostawcy, która zwraca Mapa witryny, która zawiera węzeł główny wraz z węzła dla każdej kategorii i produktu, jak pokazano na rysunku 1.</span><span class="sxs-lookup"><span data-stu-id="f5154-147">In particular, we'll build a provider that returns a site map that includes a root node along with a node for each category and product, as depicted in Figure 1.</span></span> <span data-ttu-id="f5154-148">Ogólnie rzecz biorąc każdy węzeł na mapie witryny może określić adres URL.</span><span class="sxs-lookup"><span data-stu-id="f5154-148">In general, each node in the site map may specify a URL.</span></span> <span data-ttu-id="f5154-149">Dla naszych mapy witryny będzie główny adres URL węzła s `~/SiteMapProvider/Default.aspx`, która spowoduje wyświetlenie listy wszystkich kategorii w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="f5154-149">For our site map, the root node s URL will be `~/SiteMapProvider/Default.aspx`, which will list all of the categories in the database.</span></span> <span data-ttu-id="f5154-150">Każdy węzeł kategorii, mapy witryny będzie mieć adres URL, który wskazuje na `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID`, która spowoduje wyświetlenie listy wszystkich produktów w określonym *categoryID*.</span><span class="sxs-lookup"><span data-stu-id="f5154-150">Each category node in the site map will have a URL that points to `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID`, which will list all of the products in the specified *categoryID*.</span></span> <span data-ttu-id="f5154-151">Ponadto każdy węzeł mapy witryny produktu wskaże `~/SiteMapProvider/ProductDetails.aspx?ProductID=productID`, co spowoduje wyświetlenie szczegółów konkretnego produktu s.</span><span class="sxs-lookup"><span data-stu-id="f5154-151">Finally, each product site map node will point to `~/SiteMapProvider/ProductDetails.aspx?ProductID=productID`, which will display the specific product s details.</span></span>

<span data-ttu-id="f5154-152">Aby rozpocząć musimy utworzyć `Default.aspx`, `ProductsByCategory.aspx`, i `ProductDetails.aspx` stron.</span><span class="sxs-lookup"><span data-stu-id="f5154-152">To start we need to create the `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages.</span></span> <span data-ttu-id="f5154-153">Strony te są wykonywane w kroku 2, 3 i 4, odpowiednio.</span><span class="sxs-lookup"><span data-stu-id="f5154-153">These pages are completed in Steps 2, 3, and 4, respectively.</span></span> <span data-ttu-id="f5154-154">Ponieważ ciągu po ukończeniu tego samouczka znajduje się w dostawcy mapy witryny i poprzednich samouczków Omówiliśmy już tworzenia raportów tego rodzaju wielostronicowych wzorzec/szczegół, firma Microsoft będzie Pospiesz się za pośrednictwem kroki 2 do 4.</span><span class="sxs-lookup"><span data-stu-id="f5154-154">Since the thrust of this tutorial is on site map providers, and since past tutorials have covered creating these sorts of multi-page master/detail reports, we will hurry through Steps 2 through 4.</span></span> <span data-ttu-id="f5154-155">Jeśli potrzebujesz przypomnienia informacji na temat tworzenia raportów wzorzec/szczegół, obejmujących wiele stron, odwołaj się do [wzorzec/szczegół filtrowania na dwóch stronach](../masterdetail/master-detail-filtering-across-two-pages-cs.md) samouczka.</span><span class="sxs-lookup"><span data-stu-id="f5154-155">If you need a refresher on creating master/detail reports that span multiple pages, refer back to the [Master/Detail Filtering Across Two Pages](../masterdetail/master-detail-filtering-across-two-pages-cs.md) tutorial.</span></span>

## <a name="step-2-displaying-a-list-of-categories"></a><span data-ttu-id="f5154-156">Krok 2. Wyświetlanie listy kategorii</span><span class="sxs-lookup"><span data-stu-id="f5154-156">Step 2: Displaying a List of Categories</span></span>

<span data-ttu-id="f5154-157">Otwórz `Default.aspx` strony w `SiteMapProvider` folder i przeciągnij GridView z przybornika w projektancie, ustawiając jego `ID` do `Categories`.</span><span class="sxs-lookup"><span data-stu-id="f5154-157">Open the `Default.aspx` page in the `SiteMapProvider` folder and drag a GridView from the Toolbox onto the Designer, setting its `ID` to `Categories`.</span></span> <span data-ttu-id="f5154-158">Za pomocą tagu inteligentnego s GridView powiązać go do nowego elementu ObjectDataSource, o nazwie `CategoriesDataSource` i skonfiguruj ją tak, pobiera jego dane za pomocą `CategoriesBLL` klasy s `GetCategories` metody.</span><span class="sxs-lookup"><span data-stu-id="f5154-158">From the GridView s smart tag, bind it to a new ObjectDataSource named `CategoriesDataSource` and configure it so that it retrieves its data using the `CategoriesBLL` class s `GetCategories` method.</span></span> <span data-ttu-id="f5154-159">Ponieważ ten GridView po prostu Wyświetla kategorie i nie zapewnia możliwości modyfikacji danych, zestawu list rozwijanych w UPDATE, INSERT i usuwanie kart (Brak).</span><span class="sxs-lookup"><span data-stu-id="f5154-159">Since this GridView just displays the categories and does not provide data modification capabilities, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>


<span data-ttu-id="f5154-160">[![Konfigurowanie kontrolki ObjectDataSource do zwrócenia kategorii przy użyciu metody GetCategories](building-a-custom-database-driven-site-map-provider-cs/_static/image4.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="f5154-160">[![Configure the ObjectDataSource to Return Categories Using the GetCategories Method](building-a-custom-database-driven-site-map-provider-cs/_static/image4.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image3.png)</span></span>

<span data-ttu-id="f5154-161">**Rysunek 4**: Konfigurowanie kontrolki ObjectDataSource powrócić za pomocą kategorii `GetCategories` — metoda ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="f5154-161">**Figure 4**: Configure the ObjectDataSource to Return Categories Using the `GetCategories` Method ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image4.png))</span></span>


<span data-ttu-id="f5154-162">[![Ustaw list rozwijanych w UPDATE, INSERT i usuwanie kart (Brak)](building-a-custom-database-driven-site-map-provider-cs/_static/image5.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="f5154-162">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](building-a-custom-database-driven-site-map-provider-cs/_static/image5.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image5.png)</span></span>

<span data-ttu-id="f5154-163">**Rysunek 5**: Ustaw listy rozwijane w aktualizacji, WSTAWIANIA i usuwania karty (Brak) ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="f5154-163">**Figure 5**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image6.png))</span></span>


<span data-ttu-id="f5154-164">Po zakończeniu pracy kreatora Konfigurowanie źródła danych, program Visual Studio spowoduje dodanie elementu BoundField dla `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, i `BrochurePath`.</span><span class="sxs-lookup"><span data-stu-id="f5154-164">After completing the Configure Data Source wizard, Visual Studio will add a BoundField for `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, and `BrochurePath`.</span></span> <span data-ttu-id="f5154-165">Edytowanie widoku GridView tak, aby zawierała tylko `CategoryName` i `Description` BoundFields i zaktualizuj `CategoryName` s elementu BoundField `HeaderText` właściwości do kategorii.</span><span class="sxs-lookup"><span data-stu-id="f5154-165">Edit the GridView so that it only contains the `CategoryName` and `Description` BoundFields and update the `CategoryName` BoundField s `HeaderText` property to Category .</span></span>

<span data-ttu-id="f5154-166">Następnie dodaj pole hiperłącza HyperLinkField i umieść ją tak że s pola najdalej po lewej stronie.</span><span class="sxs-lookup"><span data-stu-id="f5154-166">Next, add a HyperLinkField and position it so that it s the left-most field.</span></span> <span data-ttu-id="f5154-167">Ustaw `DataNavigateUrlFields` właściwości `CategoryID` i `DataNavigateUrlFormatString` właściwość `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID={0}`.</span><span class="sxs-lookup"><span data-stu-id="f5154-167">Set the `DataNavigateUrlFields` property to `CategoryID` and the `DataNavigateUrlFormatString` property to `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID={0}`.</span></span> <span data-ttu-id="f5154-168">Ustaw `Text` właściwości Wyświetl produkty.</span><span class="sxs-lookup"><span data-stu-id="f5154-168">Set the `Text` property to View Products .</span></span>


![Dodaj pole hiperłącza HyperLinkField do kontrolki GridView kategorii](building-a-custom-database-driven-site-map-provider-cs/_static/image6.gif)

<span data-ttu-id="f5154-170">**Rysunek 6**: Dodaj pole hiperłącza HyperLinkField do `Categories` GridView</span><span class="sxs-lookup"><span data-stu-id="f5154-170">**Figure 6**: Add a HyperLinkField to the `Categories` GridView</span></span>


<span data-ttu-id="f5154-171">Po utworzeniu kontrolki ObjectDataSource i dostosowywanie pól s GridView, dwie kontrolki o oznaczeniu deklaracyjnym będzie wyglądać następująco:</span><span class="sxs-lookup"><span data-stu-id="f5154-171">After creating the ObjectDataSource and customizing the GridView s fields, the two controls declarative markup will look like the following:</span></span>


[!code-aspx[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample2.aspx)]

<span data-ttu-id="f5154-172">Rysunek nr 7 przedstawia `Default.aspx` podczas wyświetlania za pośrednictwem przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="f5154-172">Figure 7 shows `Default.aspx` when viewed through a browser.</span></span> <span data-ttu-id="f5154-173">Kliknięcie kategorii s Wyświetl produkty link umożliwia przejście do `ProductsByCategory.aspx?CategoryID=categoryID`, który utworzymy w kroku 3.</span><span class="sxs-lookup"><span data-stu-id="f5154-173">Clicking a category s View Products link takes you to `ProductsByCategory.aspx?CategoryID=categoryID`, which we will build in Step 3.</span></span>


<span data-ttu-id="f5154-174">[![Każda kategoria jest wyświetlane wraz z Linkiem umożliwiającym wyświetlanie produktów](building-a-custom-database-driven-site-map-provider-cs/_static/image7.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="f5154-174">[![Each Category is Listed Along with a View Products Link](building-a-custom-database-driven-site-map-provider-cs/_static/image7.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image7.png)</span></span>

<span data-ttu-id="f5154-175">**Rysunek 7**: Każda kategoria jest wyświetlane wraz z Linkiem umożliwiającym wyświetlanie produktów ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="f5154-175">**Figure 7**: Each Category is Listed Along with a View Products Link ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image8.png))</span></span>


## <a name="step-3-listing-the-selected-category-s-products"></a><span data-ttu-id="f5154-176">Krok 3. Wyświetlanie listy produktów s wybranej kategorii</span><span class="sxs-lookup"><span data-stu-id="f5154-176">Step 3: Listing the Selected Category s Products</span></span>

<span data-ttu-id="f5154-177">Otwórz `ProductsByCategory.aspx` strony, a następnie dodaj GridView nadawania mu nazwy `ProductsByCategory`.</span><span class="sxs-lookup"><span data-stu-id="f5154-177">Open the `ProductsByCategory.aspx` page and add a GridView, naming it `ProductsByCategory`.</span></span> <span data-ttu-id="f5154-178">W tagu inteligentnego, należy powiązać widoku GridView nowe kontrolki ObjectDataSource, o nazwie `ProductsByCategoryDataSource`.</span><span class="sxs-lookup"><span data-stu-id="f5154-178">From its smart tag, bind the GridView to a new ObjectDataSource named `ProductsByCategoryDataSource`.</span></span> <span data-ttu-id="f5154-179">Konfigurowanie kontrolki ObjectDataSource używać `ProductsBLL` klasy s `GetProductsByCategoryID(categoryID)` metody i zestaw z listy rozwijanej listy (Brak) na kartach UPDATE, INSERT i DELETE.</span><span class="sxs-lookup"><span data-stu-id="f5154-179">Configure the ObjectDataSource to use the `ProductsBLL` class s `GetProductsByCategoryID(categoryID)` method and set the drop-down lists to (None) in the UPDATE, INSERT, and DELETE tabs.</span></span>


<span data-ttu-id="f5154-180">[![Użyj metody GetProductsByCategoryID(categoryID) s ProductsBLL, klasa](building-a-custom-database-driven-site-map-provider-cs/_static/image8.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="f5154-180">[![Use the ProductsBLL Class s GetProductsByCategoryID(categoryID) Method](building-a-custom-database-driven-site-map-provider-cs/_static/image8.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image9.png)</span></span>

<span data-ttu-id="f5154-181">**Rysunek 8**: Użyj `ProductsBLL` klasy s `GetProductsByCategoryID(categoryID)` — metoda ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="f5154-181">**Figure 8**: Use the `ProductsBLL` Class s `GetProductsByCategoryID(categoryID)` Method ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image10.png))</span></span>


<span data-ttu-id="f5154-182">Ostatni krok w Kreatorze konfigurowania źródła danych, który wyświetla monit dotyczący źródło parametru *categoryID*.</span><span class="sxs-lookup"><span data-stu-id="f5154-182">The final step in the Configure Data Source wizard prompts for a parameter source for *categoryID*.</span></span> <span data-ttu-id="f5154-183">Ponieważ te informacje są przesyłane za pośrednictwem pole querystring `CategoryID`, z listy rozwijanej wybierz QueryString i wprowadź w polu tekstowym vlastnost QueryStringField CategoryID, jak pokazano na rysunku 9.</span><span class="sxs-lookup"><span data-stu-id="f5154-183">Since this information is passed through the querystring field `CategoryID`, select QueryString from the drop-down list and enter CategoryID in the QueryStringField textbox as shown in Figure 9.</span></span> <span data-ttu-id="f5154-184">Kliknij przycisk Zakończ, aby zakończyć działanie kreatora.</span><span class="sxs-lookup"><span data-stu-id="f5154-184">Click Finish to complete the wizard.</span></span>


<span data-ttu-id="f5154-185">[![Na użytek pole Querystring CategoryID categoryID parametru](building-a-custom-database-driven-site-map-provider-cs/_static/image9.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="f5154-185">[![Use the CategoryID Querystring Field for the categoryID Parameter](building-a-custom-database-driven-site-map-provider-cs/_static/image9.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image11.png)</span></span>

<span data-ttu-id="f5154-186">**Rysunek 9**: Użyj `CategoryID` pole Querystring *categoryID* parametru ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="f5154-186">**Figure 9**: Use the `CategoryID` Querystring Field for the *categoryID* Parameter ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image12.png))</span></span>


<span data-ttu-id="f5154-187">Po zakończeniu działania kreatora programu Visual Studio spowoduje to dodanie odpowiednich BoundFields i CheckBoxField do kontrolki GridView dla pól danych produktu.</span><span class="sxs-lookup"><span data-stu-id="f5154-187">After completing the wizard, Visual Studio will add corresponding BoundFields and a CheckBoxField to the GridView for the product data fields.</span></span> <span data-ttu-id="f5154-188">Usuń wszystkie elementy oprócz `ProductName`, `UnitPrice`, i `SupplierName` BoundFields.</span><span class="sxs-lookup"><span data-stu-id="f5154-188">Remove all but the `ProductName`, `UnitPrice`, and `SupplierName` BoundFields.</span></span> <span data-ttu-id="f5154-189">Dostosuj te trzy BoundFields `HeaderText` znaków do odczytania produktu, ceny i dostawcy, odpowiednio.</span><span class="sxs-lookup"><span data-stu-id="f5154-189">Customize these three BoundFields `HeaderText` properties to read Product, Price, and Supplier, respectively.</span></span> <span data-ttu-id="f5154-190">Format `UnitPrice` elementu BoundField jako walutę.</span><span class="sxs-lookup"><span data-stu-id="f5154-190">Format the `UnitPrice` BoundField as a currency.</span></span>

<span data-ttu-id="f5154-191">Następnie dodaj pole hiperłącza HyperLinkField i przenieś ją do pozycji najdalej po lewej stronie.</span><span class="sxs-lookup"><span data-stu-id="f5154-191">Next, add a HyperLinkField and move it to the left-most position.</span></span> <span data-ttu-id="f5154-192">Ustaw jego `Text` właściwości, aby wyświetlić szczegóły jego `DataNavigateUrlFields` właściwości `ProductID`i jego `DataNavigateUrlFormatString` właściwość `~/SiteMapProvider/ProductDetails.aspx?ProductID={0}`.</span><span class="sxs-lookup"><span data-stu-id="f5154-192">Set its `Text` property to View Details, its `DataNavigateUrlFields` property to `ProductID`, and its `DataNavigateUrlFormatString` property to `~/SiteMapProvider/ProductDetails.aspx?ProductID={0}`.</span></span>


![Dodaj widok szczegółów pole hiperłącza HyperLinkField wskazujący ProductDetails.aspx](building-a-custom-database-driven-site-map-provider-cs/_static/image10.gif)

<span data-ttu-id="f5154-194">**Na rysunku nr 10**: Dodaj widok szczegółów pole hiperłącza HyperLinkField wskazujący `ProductDetails.aspx`</span><span class="sxs-lookup"><span data-stu-id="f5154-194">**Figure 10**: Add a View Details HyperLinkField that Points to `ProductDetails.aspx`</span></span>


<span data-ttu-id="f5154-195">Po wykonaniu tych dostosowań, kontrolkami GridView i kontrolki ObjectDataSource s oznaczeniu deklaracyjnym powinien wyglądać w następujący sposób:</span><span class="sxs-lookup"><span data-stu-id="f5154-195">After making these customizations, the GridView and ObjectDataSource s declarative markup should resemble the following:</span></span>


[!code-aspx[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample3.aspx)]

<span data-ttu-id="f5154-196">Wróć do wyświetlania `Default.aspx` za pośrednictwem przeglądarki i kliknij przycisk Wyświetl produkty łączy dla Beverages.</span><span class="sxs-lookup"><span data-stu-id="f5154-196">Return to viewing `Default.aspx` through a browser and click on the View Products link for Beverages.</span></span> <span data-ttu-id="f5154-197">Spowoduje to przejście do `ProductsByCategory.aspx?CategoryID=1`, wyświetlanie nazw, cen i dostawców produktów w bazie danych Northwind, które należą do kategorii Beverages (zobacz rysunek 11).</span><span class="sxs-lookup"><span data-stu-id="f5154-197">This will take you to `ProductsByCategory.aspx?CategoryID=1`, displaying the names, prices, and suppliers of the products in the Northwind database that belong to the Beverages category (see Figure 11).</span></span> <span data-ttu-id="f5154-198">Możesz rozszerzyć tę stronę, aby uwzględnić łącze do zwrócenia użytkowników na stronę listy kategorii (`Default.aspx`) i DetailsView lub FormView formant, który wyświetla wybraną kategorię s nazwę i opis.</span><span class="sxs-lookup"><span data-stu-id="f5154-198">Feel free to further enhance this page to include a link to return users to the category listing page (`Default.aspx`) and a DetailsView or FormView control that displays the selected category s name and description.</span></span>


<span data-ttu-id="f5154-199">[![Są wyświetlane nazwy Beverages, ceny i dostawcami](building-a-custom-database-driven-site-map-provider-cs/_static/image11.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="f5154-199">[![The Beverages Names, Prices, and Suppliers are Displayed](building-a-custom-database-driven-site-map-provider-cs/_static/image11.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image13.png)</span></span>

<span data-ttu-id="f5154-200">**Rysunek 11**: Są wyświetlane nazwy Beverages, ceny i dostawców ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-cs/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="f5154-200">**Figure 11**: The Beverages Names, Prices, and Suppliers are Displayed ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image14.png))</span></span>


## <a name="step-4-showing-a-product-s-details"></a><span data-ttu-id="f5154-201">Krok 4. Wyświetlanie szczegółów produktu s</span><span class="sxs-lookup"><span data-stu-id="f5154-201">Step 4: Showing a Product s Details</span></span>

<span data-ttu-id="f5154-202">Strony końcowe `ProductDetails.aspx`, są wyświetlane szczegóły wybranych produktów.</span><span class="sxs-lookup"><span data-stu-id="f5154-202">The final page, `ProductDetails.aspx`, displays the selected products details.</span></span> <span data-ttu-id="f5154-203">Otwórz `ProductDetails.aspx` i przeciągnij element DetailsView z przybornika do projektanta.</span><span class="sxs-lookup"><span data-stu-id="f5154-203">Open `ProductDetails.aspx` and drag a DetailsView from the Toolbox onto the Designer.</span></span> <span data-ttu-id="f5154-204">Ustaw DetailsView s `ID` właściwości `ProductInfo` i wyczyszczenie jego `Height` i `Width` wartości właściwości.</span><span class="sxs-lookup"><span data-stu-id="f5154-204">Set the DetailsView s `ID` property to `ProductInfo` and clear out its `Height` and `Width` property values.</span></span> <span data-ttu-id="f5154-205">W tagu inteligentnego, należy powiązać DetailsView nowe kontrolki ObjectDataSource, o nazwie `ProductDataSource`, konfigurowanie kontrolki ObjectDataSource swoich danych z `ProductsBLL` klasy s `GetProductByProductID(productID)` metody.</span><span class="sxs-lookup"><span data-stu-id="f5154-205">From its smart tag, bind the DetailsView to a new ObjectDataSource named `ProductDataSource`, configuring the ObjectDataSource to pull its data from the `ProductsBLL` class s `GetProductByProductID(productID)` method.</span></span> <span data-ttu-id="f5154-206">Podobnie jak w przypadku poprzednich stron sieci web utworzonych w krokach 2 i 3 zestawu list rozwijanych w UPDATE, INSERT i usuwanie kart (Brak).</span><span class="sxs-lookup"><span data-stu-id="f5154-206">As with the previous web pages created in Steps 2 and 3, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>


<span data-ttu-id="f5154-207">[![Konfigurowanie kontrolki ObjectDataSource przy użyciu metody GetProductByProductID(productID)](building-a-custom-database-driven-site-map-provider-cs/_static/image12.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="f5154-207">[![Configure the ObjectDataSource to Use the GetProductByProductID(productID) Method](building-a-custom-database-driven-site-map-provider-cs/_static/image12.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image15.png)</span></span>

<span data-ttu-id="f5154-208">**Rysunek 12**: Konfigurowanie kontrolki ObjectDataSource do użycia `GetProductByProductID(productID)` — metoda ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-cs/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="f5154-208">**Figure 12**: Configure the ObjectDataSource to Use the `GetProductByProductID(productID)` Method ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image16.png))</span></span>


<span data-ttu-id="f5154-209">Ostatni krok w Kreatorze konfigurowania źródła danych, który wyświetla monit dotyczący źródła *productID* parametru.</span><span class="sxs-lookup"><span data-stu-id="f5154-209">The last step of the Configure Data Source wizard prompts for the source of the *productID* parameter.</span></span> <span data-ttu-id="f5154-210">Ponieważ te dane przechodzą przez pole querystring `ProductID`, ustaw listy rozwijanej na ciąg zapytania i pole tekstowe vlastnost QueryStringField do elementu ProductID.</span><span class="sxs-lookup"><span data-stu-id="f5154-210">Since this data comes through the querystring field `ProductID`, set the drop-down list to QueryString and the QueryStringField textbox to ProductID.</span></span> <span data-ttu-id="f5154-211">Na koniec kliknij przycisk Zakończ, aby zakończyć pracę kreatora.</span><span class="sxs-lookup"><span data-stu-id="f5154-211">Finally, click the Finish button to complete the wizard.</span></span>


<span data-ttu-id="f5154-212">[![Konfigurowanie productID parametru, aby ściągnąć jego wartość z pola Querystring ProductID](building-a-custom-database-driven-site-map-provider-cs/_static/image13.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="f5154-212">[![Configure the productID Parameter to Pull its Value from the ProductID Querystring Field](building-a-custom-database-driven-site-map-provider-cs/_static/image13.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image17.png)</span></span>

<span data-ttu-id="f5154-213">**Rysunek 13**: Konfigurowanie *productID* parametru, aby ściągnąć jego wartość z `ProductID` pole Querystring ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="f5154-213">**Figure 13**: Configure the *productID* Parameter to Pull its Value from the `ProductID` Querystring Field ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image18.png))</span></span>


<span data-ttu-id="f5154-214">Po zakończeniu pracy kreatora Konfigurowanie źródła danych, Visual Studio utworzy odpowiednie BoundFields i CheckBoxField w DetailsView dla pól danych produktu.</span><span class="sxs-lookup"><span data-stu-id="f5154-214">After completing the Configure Data Source wizard, Visual Studio will create corresponding BoundFields and a CheckBoxField in the DetailsView for the product data fields.</span></span> <span data-ttu-id="f5154-215">Usuń `ProductID`, `SupplierID`, i `CategoryID` BoundFields i skonfiguruj pozostałe pola, zgodnie z potrzebami.</span><span class="sxs-lookup"><span data-stu-id="f5154-215">Remove the `ProductID`, `SupplierID`, and `CategoryID` BoundFields and configure the remaining fields as you see fit.</span></span> <span data-ttu-id="f5154-216">Po kilku estetycznych konfiguracje Moje DetailsView i kontrolki ObjectDataSource s oznaczeniu deklaracyjnym oglądałem się podobne do następującego:</span><span class="sxs-lookup"><span data-stu-id="f5154-216">After a handful of aesthetic configurations, my DetailsView and ObjectDataSource s declarative markup looked like the following:</span></span>


[!code-aspx[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample4.aspx)]

<span data-ttu-id="f5154-217">Aby przetestować tę stronę, wróć do `Default.aspx` i kliknij pozycję Wyświetl produkty dla kategorii Beverages.</span><span class="sxs-lookup"><span data-stu-id="f5154-217">To test this page, return to `Default.aspx` and click on View Products for the Beverages category.</span></span> <span data-ttu-id="f5154-218">Z listy spożywczy produktów, kliknij link Wyświetl szczegóły Chai herbaty.</span><span class="sxs-lookup"><span data-stu-id="f5154-218">From the listing of beverage products, click on the View Details link for Chai Tea.</span></span> <span data-ttu-id="f5154-219">Spowoduje to przejście do `ProductDetails.aspx?ProductID=1`, który wskazuje s herbaty Chai więcej (zobacz rysunek 14).</span><span class="sxs-lookup"><span data-stu-id="f5154-219">This will take you to `ProductDetails.aspx?ProductID=1`, which shows a Chai Tea s details (see Figure 14).</span></span>


<span data-ttu-id="f5154-220">[![Jest wyświetlana herbaty Chai s dostawca, kategoria, ceny i inne informacje](building-a-custom-database-driven-site-map-provider-cs/_static/image14.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="f5154-220">[![Chai Tea s Supplier, Category, Price, and Other Information is Displayed](building-a-custom-database-driven-site-map-provider-cs/_static/image14.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image19.png)</span></span>

<span data-ttu-id="f5154-221">**Rysunek 14**: Jest wyświetlana herbaty Chai s dostawca, kategoria, ceny i inne informacje ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-cs/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="f5154-221">**Figure 14**: Chai Tea s Supplier, Category, Price, and Other Information is Displayed ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image20.png))</span></span>


## <a name="step-5-understanding-the-inner-workings-of-a-site-map-provider"></a><span data-ttu-id="f5154-222">Krok 5. Omówienie wewnętrznego działania dostawcy mapy witryny</span><span class="sxs-lookup"><span data-stu-id="f5154-222">Step 5: Understanding the Inner Workings of a Site Map Provider</span></span>

<span data-ttu-id="f5154-223">Mapa witryny jest reprezentowana w pamięci serwera s sieci web jako kolekcja `SiteMapNode` wystąpień, które tworzą hierarchię.</span><span class="sxs-lookup"><span data-stu-id="f5154-223">The site map is represented in the web server s memory as a collection of `SiteMapNode` instances that form a hierarchy.</span></span> <span data-ttu-id="f5154-224">Musi istnieć dokładnie jeden katalog główny, wszystkie węzły inne niż główny musi mieć dokładnie jeden węzeł nadrzędny, a wszystkie węzły mogą mieć dowolną liczbę elementów podrzędnych.</span><span class="sxs-lookup"><span data-stu-id="f5154-224">There must be exactly one root, all non-root nodes must have exactly one parent node, and all nodes may have an arbitrary number of children.</span></span> <span data-ttu-id="f5154-225">Każdy `SiteMapNode` obiekt reprezentuje sekcję w strukturze witryny sieci Web s; te sekcje często ma odpowiadającą mu stronę sieci web.</span><span class="sxs-lookup"><span data-stu-id="f5154-225">Each `SiteMapNode` object represents a section in the website s structure; these sections commonly have a corresponding web page.</span></span> <span data-ttu-id="f5154-226">W związku z tym [ `SiteMapNode` klasy](https://msdn.microsoft.com/library/system.web.sitemapnode.aspx) ma właściwości, takie jak `Title`, `Url`, i `Description`, które zawierają informacje o sekcji `SiteMapNode` reprezentuje.</span><span class="sxs-lookup"><span data-stu-id="f5154-226">Consequently, the [`SiteMapNode` class](https://msdn.microsoft.com/library/system.web.sitemapnode.aspx) has properties like `Title`, `Url`, and `Description`, which provide information for the section the `SiteMapNode` represents.</span></span> <span data-ttu-id="f5154-227">Istnieje również `Key` właściwość, która jednoznacznie identyfikuje każdy `SiteMapNode` w hierarchii, a także właściwości, używany do ustanawiania tej hierarchii `ChildNodes`, `ParentNode`, `NextSibling`, `PreviousSibling`, i tak dalej.</span><span class="sxs-lookup"><span data-stu-id="f5154-227">There is also a `Key` property that uniquely identifies each `SiteMapNode` in the hierarchy, as well as properties used to establish this hierarchy `ChildNodes`, `ParentNode`, `NextSibling`, `PreviousSibling`, and so forth.</span></span>

<span data-ttu-id="f5154-228">Rysunek 15 przedstawia witrynę ogólną strukturę mapy z rysunku 1, ale przy użyciu szczegółów implementacji określiła bardziej szczegółowo.</span><span class="sxs-lookup"><span data-stu-id="f5154-228">Figure 15 shows the general site map structure from Figure 1, but with the implementation details sketched out in finer detail.</span></span>


<span data-ttu-id="f5154-229">[![Każdy SiteMapNode ma właściwości, takie jak tytuł, adres Url, klucz itd.](building-a-custom-database-driven-site-map-provider-cs/_static/image16.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image15.gif)</span><span class="sxs-lookup"><span data-stu-id="f5154-229">[![Each SiteMapNode has Properties Like Title, Url, Key, and So On](building-a-custom-database-driven-site-map-provider-cs/_static/image16.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image15.gif)</span></span>

<span data-ttu-id="f5154-230">**Rysunek 15**: Każdy `SiteMapNode` ma właściwości takich jak `Title`, `Url`, `Key`i tak dalej ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-cs/_static/image17.gif))</span><span class="sxs-lookup"><span data-stu-id="f5154-230">**Figure 15**: Each `SiteMapNode` has Properties Like `Title`, `Url`, `Key`, and So On ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image17.gif))</span></span>


<span data-ttu-id="f5154-231">Mapa witryny jest dostępny za pośrednictwem [ `SiteMap` klasy](https://msdn.microsoft.com/library/system.web.sitemap.aspx) w [ `System.Web` przestrzeni nazw](https://msdn.microsoft.com/library/system.web.aspx).</span><span class="sxs-lookup"><span data-stu-id="f5154-231">The site map is accessible through the [`SiteMap` class](https://msdn.microsoft.com/library/system.web.sitemap.aspx) in the [`System.Web` namespace](https://msdn.microsoft.com/library/system.web.aspx).</span></span> <span data-ttu-id="f5154-232">Ta klasa s `RootNode` właściwość zwraca lokacji głównej mapy s `SiteMapNode` wystąpienia klasy `CurrentNode` zwraca `SiteMapNode` którego `Url` właściwość zgodny z adresem URL obecnie żądanej strony.</span><span class="sxs-lookup"><span data-stu-id="f5154-232">This class s `RootNode` property returns the site map s root `SiteMapNode` instance; `CurrentNode` returns the `SiteMapNode` whose `Url` property matches the URL of the currently requested page.</span></span> <span data-ttu-id="f5154-233">Ta klasa jest używana wewnętrznie przez kontrolki sieci Web programu ASP.NET 2.0 s.</span><span class="sxs-lookup"><span data-stu-id="f5154-233">This class is used internally by ASP.NET 2.0 s navigation Web controls.</span></span>

<span data-ttu-id="f5154-234">Gdy `SiteMap` właściwości klasy s są dostępne, musi go serializować struktura mapy witryny z niektórych nośnika trwałego do pamięci.</span><span class="sxs-lookup"><span data-stu-id="f5154-234">When the `SiteMap` class s properties are accessed, it must serialize the site map structure from some persistent medium into memory.</span></span> <span data-ttu-id="f5154-235">Logika serializacji mapy witryny nie jest jednak twardych zakodowanej w `SiteMap` klasy.</span><span class="sxs-lookup"><span data-stu-id="f5154-235">However, the site map serialization logic is not hard coded into the `SiteMap` class.</span></span> <span data-ttu-id="f5154-236">Zamiast tego w czasie wykonywania `SiteMap` klasa określa, które mapy witryny *dostawcy* na potrzeby serializacji.</span><span class="sxs-lookup"><span data-stu-id="f5154-236">Instead, at runtime the `SiteMap` class determines which site map *provider* to use for serialization.</span></span> <span data-ttu-id="f5154-237">Domyślnie [ `XmlSiteMapProvider` klasy](https://msdn.microsoft.com/library/system.web.xmlsitemapprovider.aspx) jest używany, która odczytuje struktury mapy s lokacji z pliku XML niepoprawnie sformatowany.</span><span class="sxs-lookup"><span data-stu-id="f5154-237">By default, the [`XmlSiteMapProvider` class](https://msdn.microsoft.com/library/system.web.xmlsitemapprovider.aspx) is used, which reads the site map s structure from a properly-formatted XML file.</span></span> <span data-ttu-id="f5154-238">Jednak za pomocą trochę pracy możemy utworzyć własną niestandardowego dostawcy mapy witryny.</span><span class="sxs-lookup"><span data-stu-id="f5154-238">However, with a little bit of work we can create our own custom site map provider.</span></span>

<span data-ttu-id="f5154-239">Wszyscy dostawcy mapy witryny musi pochodzić od [ `SiteMapProvider` klasy](https://msdn.microsoft.com/library/system.web.sitemapprovider.aspx), która obejmuje podstawowe metody i właściwości służące do lokacji mapować dostawcy, ale pomija wiele szczegółów implementacji.</span><span class="sxs-lookup"><span data-stu-id="f5154-239">All site map providers must be derived from the [`SiteMapProvider` class](https://msdn.microsoft.com/library/system.web.sitemapprovider.aspx), which includes the essential methods and properties needed for site map providers, but omits many of the implementation details.</span></span> <span data-ttu-id="f5154-240">Druga klasa [ `StaticSiteMapProvider` ](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.aspx), rozszerza `SiteMapProvider` klasy i zawiera bardziej niezawodne wdrożenia wymaganych funkcji.</span><span class="sxs-lookup"><span data-stu-id="f5154-240">A second class, [`StaticSiteMapProvider`](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.aspx), extends the `SiteMapProvider` class and contains a more robust implementation of the needed functionality.</span></span> <span data-ttu-id="f5154-241">Wewnętrznie `StaticSiteMapProvider` przechowuje `SiteMapNode` wystąpień witryny mapy w `Hashtable` i dostarcza metod, takich jak `AddNode(child, parent)`, `RemoveNode(siteMapNode),` i `Clear()` , dodawać i usuwać `SiteMapNode` s do wewnętrznego `Hashtable`.</span><span class="sxs-lookup"><span data-stu-id="f5154-241">Internally, the `StaticSiteMapProvider` stores the `SiteMapNode` instances of the site map in a `Hashtable` and provides methods like `AddNode(child, parent)`, `RemoveNode(siteMapNode),` and `Clear()` that add and remove `SiteMapNode` s to the internal `Hashtable`.</span></span> <span data-ttu-id="f5154-242">`XmlSiteMapProvider` jest tworzony na podstawie `StaticSiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="f5154-242">`XmlSiteMapProvider` is derived from `StaticSiteMapProvider`.</span></span>

<span data-ttu-id="f5154-243">Podczas tworzenia niestandardowego dostawcy mapy witryny, która rozszerza `StaticSiteMapProvider`, istnieją dwie metody abstrakcyjne, które musi zostać zastąpiona: [ `BuildSiteMap` ](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.buildsitemap.aspx) i [ `GetRootNodeCore` ](https://msdn.microsoft.com/library/system.web.sitemapprovider.getrootnodecore.aspx).</span><span class="sxs-lookup"><span data-stu-id="f5154-243">When creating a custom site map provider that extends `StaticSiteMapProvider`, there are two abstract methods that must be overridden: [`BuildSiteMap`](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.buildsitemap.aspx) and [`GetRootNodeCore`](https://msdn.microsoft.com/library/system.web.sitemapprovider.getrootnodecore.aspx).</span></span> <span data-ttu-id="f5154-244">`BuildSiteMap`, jak sama nazwa wskazuje, jest odpowiedzialne za ładowanie struktury mapy witryny z magazynu trwałego i tworzenia go w pamięci.</span><span class="sxs-lookup"><span data-stu-id="f5154-244">`BuildSiteMap`, as its name implies, is responsible for loading the site map structure from persistent storage and constructing it in memory.</span></span> <span data-ttu-id="f5154-245">`GetRootNodeCore` Zwraca węzeł główny mapy witryny.</span><span class="sxs-lookup"><span data-stu-id="f5154-245">`GetRootNodeCore` returns the root node in the site map.</span></span>

<span data-ttu-id="f5154-246">Przed sieci web aplikacji można użyć dostawcy mapy witryny, które muszą być zarejestrowane w konfiguracji s aplikacji.</span><span class="sxs-lookup"><span data-stu-id="f5154-246">Before a web application can use a site map provider it must be registered in the application s configuration.</span></span> <span data-ttu-id="f5154-247">Domyślnie `XmlSiteMapProvider` klasa jest zarejestrowana przy użyciu nazwy `AspNetXmlSiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="f5154-247">By default, the `XmlSiteMapProvider` class is registered using the name `AspNetXmlSiteMapProvider`.</span></span> <span data-ttu-id="f5154-248">Aby zarejestrować dostawcy mapy witryny dodatkowe, Dodaj następujący kod do `Web.config`:</span><span class="sxs-lookup"><span data-stu-id="f5154-248">To register additional site map providers, add the following markup to `Web.config`:</span></span>


[!code-xml[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample5.xml)]

<span data-ttu-id="f5154-249">*Nazwa* przypisuje wartość zrozumiałą nazwę dostawcy podczas *typu* Określa nazwę dostawcy mapy witryny w pełni kwalifikowanego typu.</span><span class="sxs-lookup"><span data-stu-id="f5154-249">The *name* value assigns a human-readable name to the provider while *type* specifies the fully-qualified type name of the site map provider.</span></span> <span data-ttu-id="f5154-250">Przedstawimy zagadnienia związane z konkretnych wartości *nazwa* i *typu* wartości w kroku 7 po możemy ve utworzony naszych niestandardowego dostawcy mapy witryny.</span><span class="sxs-lookup"><span data-stu-id="f5154-250">We'll explore concrete values for the *name* and *type* values in Step 7, after we ve created our custom site map provider.</span></span>

<span data-ttu-id="f5154-251">Klasa dostawcy mapy witryny zostanie uruchomiony po raz pierwszy jest dostępny z `SiteMap` klasy i pozostaje w pamięci dla cyklu życia aplikacji sieci web.</span><span class="sxs-lookup"><span data-stu-id="f5154-251">The site map provider class is instantiated the first time it is accessed from the `SiteMap` class and remains in memory for the lifetime of the web application.</span></span> <span data-ttu-id="f5154-252">Ponieważ istnieje tylko jedno wystąpienie dostawcy mapy witryny, które mogą być wywoływane z wielu jednoczesnych osoby odwiedzające, jest konieczne, aby móc wywoływać metody dostawcy s *wątkowo*.</span><span class="sxs-lookup"><span data-stu-id="f5154-252">Since there is only one instance of the site map provider that may be invoked from multiple, concurrent web site visitors, it is imperative that the provider s methods be *thread-safe*.</span></span>

<span data-ttu-id="f5154-253">Wydajność i skalowalność powodów jego ważne, firma Microsoft pamięci podręcznej witryny w pamięci mapowania struktury i zwracać buforowane to struktura, a nie odtworzenia go za każdym razem, gdy `BuildSiteMap` metoda jest wywoływana.</span><span class="sxs-lookup"><span data-stu-id="f5154-253">For performance and scalability reasons, it s important that we cache the in-memory site map structure and return this cached structure rather than recreating it every time the `BuildSiteMap` method is invoked.</span></span> <span data-ttu-id="f5154-254">`BuildSiteMap` może zostać wywołana wiele razy na żądanie strony dla każdego użytkownika, w zależności od formantów nawigacji używana na stronie i głębokość struktura mapy witryny.</span><span class="sxs-lookup"><span data-stu-id="f5154-254">`BuildSiteMap` may be called several times per page request per user, depending on the navigation controls in use on the page and the depth of the site map structure.</span></span> <span data-ttu-id="f5154-255">W każdym przypadku, jeśli firma Microsoft nie buforują struktury mapy witryny w `BuildSiteMap` każdym razem jest wywoływana, firma Microsoft będzie musiała ponownie pobrać produktu oraz informacje o kategorii z architektury (co mogłoby spowodować zapytania do bazy danych).</span><span class="sxs-lookup"><span data-stu-id="f5154-255">In any case, if we do not cache the site map structure in `BuildSiteMap` then each time it is invoked we would need to re-retrieve the product and category information from the architecture (which would result in a query to the database).</span></span> <span data-ttu-id="f5154-256">Jak wspomniano w poprzednich samouczkach buforowania danych w pamięci podręcznej mogą stać się przestarzałe.</span><span class="sxs-lookup"><span data-stu-id="f5154-256">As we discussed in the previous caching tutorials, cached data can become stale.</span></span> <span data-ttu-id="f5154-257">Aby walczyć z tym, możemy użyć czasu lub expiries na podstawie zależności pamięci podręcznej SQL.</span><span class="sxs-lookup"><span data-stu-id="f5154-257">To combat this, we can use either time- or SQL cache dependency-based expiries.</span></span>

> [!NOTE]
> <span data-ttu-id="f5154-258">Dostawcy mapy witryny opcjonalnie mogą zastępować [ `Initialize` metoda](https://msdn.microsoft.com/library/system.web.sitemapprovider.initialize.aspx).</span><span class="sxs-lookup"><span data-stu-id="f5154-258">A site map provider may optionally override the [`Initialize` method](https://msdn.microsoft.com/library/system.web.sitemapprovider.initialize.aspx).</span></span> <span data-ttu-id="f5154-259">`Initialize` jest wywoływane, gdy dostawcy mapy witryny najpierw zostanie uruchomiony i jest przekazywany wszelkie atrybuty niestandardowe, które zostały przypisane do dostawcy w `Web.config` w `<add>` elementów, takich jak: `<add name="name" type="type" customAttribute="value" />`.</span><span class="sxs-lookup"><span data-stu-id="f5154-259">`Initialize` is invoked when the site map provider is first instantiated and is passed any custom attributes assigned to the provider in `Web.config` in the `<add>` element like: `<add name="name" type="type" customAttribute="value" />`.</span></span> <span data-ttu-id="f5154-260">Jest to przydatne, jeśli chcesz zezwolić na dewelopera strony określić różne ustawienia mapy witryny związane z dostawcą bez konieczności modyfikowania kodu s dostawcy.</span><span class="sxs-lookup"><span data-stu-id="f5154-260">It is useful if you want to allow a page developer to specify various site map provider-related settings without having to modify the provider s code.</span></span> <span data-ttu-id="f5154-261">Na przykład, jeśli firma Microsoft była odczytu kategorii i produktów danych bezpośrednio z bazy danych, w przeciwieństwie do przy użyciu architektury, możemy d prawdopodobnie chcesz zezwolić strony dla deweloperów, określ parametry połączenia bazy danych za pośrednictwem `Web.config` zamiast przy użyciu zakodowanego wartość w kodzie dostawcy s.</span><span class="sxs-lookup"><span data-stu-id="f5154-261">For example, if we were reading the category and products data directly from the database as opposed to through the architecture, we d likely want to let the page developer specify the database connection string through `Web.config` rather than using a hard coded value in the provider s code.</span></span> <span data-ttu-id="f5154-262">Niestandardowego dostawcy mapy witryny będziemy tworzyć w kroku 6 nie zastępuje to `Initialize` metody.</span><span class="sxs-lookup"><span data-stu-id="f5154-262">The custom site map provider we'll build in Step 6 does not override this `Initialize` method.</span></span> <span data-ttu-id="f5154-263">Na przykład za pomocą `Initialize` metody, można znaleźć [Jeff Prosise](http://www.wintellect.com/Weblogs/CategoryView,category,Jeff%20Prosise.aspx) s [przechowywania mapy witryny w programie SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) artykułu.</span><span class="sxs-lookup"><span data-stu-id="f5154-263">For an example of using the `Initialize` method, refer to [Jeff Prosise](http://www.wintellect.com/Weblogs/CategoryView,category,Jeff%20Prosise.aspx) s [Storing Site Maps in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) article.</span></span>


## <a name="step-6-creating-the-custom-site-map-provider"></a><span data-ttu-id="f5154-264">Krok 6. Tworzenie niestandardowego dostawcy mapy witryny</span><span class="sxs-lookup"><span data-stu-id="f5154-264">Step 6: Creating the Custom Site Map Provider</span></span>

<span data-ttu-id="f5154-265">Aby utworzyć niestandardowego dostawcy mapy witryny, która tworzy mapowanie witryny z kategorii i produktów w bazie danych Northwind, należy utworzyć klasę, która rozszerza `StaticSiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="f5154-265">To create a custom site map provider that builds the site map from the categories and products in the Northwind database, we need to create a class that extends `StaticSiteMapProvider`.</span></span> <span data-ttu-id="f5154-266">W kroku 1 pojawia się pytanie, aby dodać `CustomProviders` folderu w `App_Code` folder — Dodaj nową klasę do tego folderu o nazwie `NorthwindSiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="f5154-266">In Step 1 I asked you to add a `CustomProviders` folder in the `App_Code` folder - add a new class to this folder named `NorthwindSiteMapProvider`.</span></span> <span data-ttu-id="f5154-267">Dodaj następujący kod do `NorthwindSiteMapProvider` klasy:</span><span class="sxs-lookup"><span data-stu-id="f5154-267">Add the following code to the `NorthwindSiteMapProvider` class:</span></span>


[!code-csharp[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample6.cs)]

<span data-ttu-id="f5154-268">Pozwól s rozpocząć eksplorowanie tej klasy s `BuildSiteMap` metody, która rozpoczyna się od [ `lock` instrukcji](https://msdn.microsoft.com/library/c5kehkcz.aspx).</span><span class="sxs-lookup"><span data-stu-id="f5154-268">Let s start with exploring this class s `BuildSiteMap` method, which starts with a [`lock` statement](https://msdn.microsoft.com/library/c5kehkcz.aspx).</span></span> <span data-ttu-id="f5154-269">`lock` Instrukcji może składać się jednemu wątkowi w czasie, aby wprowadzić, a tym samym dostęp do jej kodu serializacji co uniemożliwia przechodzenie krok po kroku na siebie nawzajem s palcach jednej przez dwa współbieżnych wątków.</span><span class="sxs-lookup"><span data-stu-id="f5154-269">The `lock` statement only allows one thread at a time to enter, thereby serializing access to its code and preventing two concurrent threads from stepping on one another s toes.</span></span>

<span data-ttu-id="f5154-270">Klasa poziomie `SiteMapNode` zmiennej `root` służy do buforowania struktura mapy witryny.</span><span class="sxs-lookup"><span data-stu-id="f5154-270">The class-level `SiteMapNode` variable `root` is used to cache the site map structure.</span></span> <span data-ttu-id="f5154-271">Gdy mapy witryny jest tworzony po raz pierwszy lub po raz pierwszy po zmodyfikowaniu danych bazowych `root` będzie `null` i będzie można konstruować struktury mapy witryny.</span><span class="sxs-lookup"><span data-stu-id="f5154-271">When the site map is constructed for the first time, or for the first time after the underlying data has been modified, `root` will be `null` and the site map structure will be constructed.</span></span> <span data-ttu-id="f5154-272">Węzeł główny mapy s witryny jest przypisany do `root` podczas tworzenia procesu, aby następnym razem ta metoda jest wywoływana, `root` nie będzie `null`.</span><span class="sxs-lookup"><span data-stu-id="f5154-272">The site map s root node is assigned to `root` during the construction process so that the next time this method is called, `root` will not be `null`.</span></span> <span data-ttu-id="f5154-273">W związku z tym tak długo, jak `root` nie `null` struktura mapy witryny zostanie zwrócony do obiektu wywołującego, bez konieczności ponownego tworzenia.</span><span class="sxs-lookup"><span data-stu-id="f5154-273">Consequently, so long as `root` is not `null` the site map structure will be returned to the caller without having to recreate it.</span></span>

<span data-ttu-id="f5154-274">Jeśli katalog główny jest `null`, struktura mapy witryny jest tworzona na podstawie produktu oraz informacje o kategorii.</span><span class="sxs-lookup"><span data-stu-id="f5154-274">If root is `null`, the site map structure is created from the product and category information.</span></span> <span data-ttu-id="f5154-275">Mapa witryny jest wbudowana, tworząc `SiteMapNode` wystąpień, a następnie tworzących hierarchię poprzez wywołania `StaticSiteMapProvider` klasy s `AddNode` metody.</span><span class="sxs-lookup"><span data-stu-id="f5154-275">The site map is built by creating the `SiteMapNode` instances and then forming the hierarchy through calls to the `StaticSiteMapProvider` class s `AddNode` method.</span></span> <span data-ttu-id="f5154-276">`AddNode` wykonuje wewnętrznej księgowości, przechowywania są formatowane przy `SiteMapNode` wystąpienia w `Hashtable`.</span><span class="sxs-lookup"><span data-stu-id="f5154-276">`AddNode` performs the internal bookkeeping, storing the assorted `SiteMapNode` instances in a `Hashtable`.</span></span> <span data-ttu-id="f5154-277">Zanim zaczniemy, tworzenia hierarchii, na początek, wywołując `Clear` metody, która usuwa elementów z wewnętrznego `Hashtable`.</span><span class="sxs-lookup"><span data-stu-id="f5154-277">Before we start constructing the hierarchy, we start by calling the `Clear` method, which clears out the elements from the internal `Hashtable`.</span></span> <span data-ttu-id="f5154-278">Następnie `ProductsBLL` klasy s `GetProducts` metody i wynikowy `ProductsDataTable` są przechowywane w zmiennych lokalnych.</span><span class="sxs-lookup"><span data-stu-id="f5154-278">Next, the `ProductsBLL` class s `GetProducts` method and the resulting `ProductsDataTable` are stored in local variables.</span></span>

<span data-ttu-id="f5154-279">Konstrukcja mapy s lokacji rozpoczyna się od Tworzenie węzła głównego i przypisywanie jej do `root`.</span><span class="sxs-lookup"><span data-stu-id="f5154-279">The site map s construction begins by creating the root node and assigning it to `root`.</span></span> <span data-ttu-id="f5154-280">Przeciążenia [ `SiteMapNode` Konstruktor s](https://msdn.microsoft.com/library/system.web.sitemapnode.sitemapnode.aspx) używane w tym miejscu i przez cały ten `BuildSiteMap` jest przekazywany następujące informacje:</span><span class="sxs-lookup"><span data-stu-id="f5154-280">The overload of the [`SiteMapNode` s constructor](https://msdn.microsoft.com/library/system.web.sitemapnode.sitemapnode.aspx) used here and throughout this `BuildSiteMap` is passed the following information:</span></span>

- <span data-ttu-id="f5154-281">Odwołanie do dostawcy mapy witryny (`this`).</span><span class="sxs-lookup"><span data-stu-id="f5154-281">A reference to the site map provider (`this`).</span></span>
- <span data-ttu-id="f5154-282">`SiteMapNode` s `Key`.</span><span class="sxs-lookup"><span data-stu-id="f5154-282">The `SiteMapNode` s `Key`.</span></span> <span data-ttu-id="f5154-283">To wymagane, wartość musi być unikatowa dla każdej `SiteMapNode`.</span><span class="sxs-lookup"><span data-stu-id="f5154-283">This required value must be unique for each `SiteMapNode`.</span></span>
- <span data-ttu-id="f5154-284">`SiteMapNode` s `Url`.</span><span class="sxs-lookup"><span data-stu-id="f5154-284">The `SiteMapNode` s `Url`.</span></span> <span data-ttu-id="f5154-285">`Url` jest opcjonalna, ale jeśli nie dostarczono, każdy `SiteMapNode` s `Url` wartość musi być unikatowa.</span><span class="sxs-lookup"><span data-stu-id="f5154-285">`Url` is optional, but if provided, each `SiteMapNode` s `Url` value must be unique.</span></span>
- <span data-ttu-id="f5154-286">`SiteMapNode` s `Title`, co jest wymagane.</span><span class="sxs-lookup"><span data-stu-id="f5154-286">The `SiteMapNode` s `Title`, which is required.</span></span>

<span data-ttu-id="f5154-287">`AddNode(root)` Dodaje wywołania metody `SiteMapNode` `root` do mapy witryny jako katalogu głównego.</span><span class="sxs-lookup"><span data-stu-id="f5154-287">The `AddNode(root)` method call adds the `SiteMapNode` `root` to the site map as the root.</span></span> <span data-ttu-id="f5154-288">Następnie każdy `ProductRow` w `ProductsDataTable` wyliczenia.</span><span class="sxs-lookup"><span data-stu-id="f5154-288">Next, each `ProductRow` in the `ProductsDataTable` is enumerated.</span></span> <span data-ttu-id="f5154-289">Jeśli istnieje już `SiteMapNode` dla bieżącej kategorii produktu s jest przywoływany.</span><span class="sxs-lookup"><span data-stu-id="f5154-289">If there already exists a `SiteMapNode` for the current product s category, it is referenced.</span></span> <span data-ttu-id="f5154-290">W przeciwnym razie nowy `SiteMapNode` dla kategorii zostanie utworzony i dodany jako element podrzędny elementu `SiteMapNode``root` za pośrednictwem `AddNode(categoryNode, root)` wywołania metody.</span><span class="sxs-lookup"><span data-stu-id="f5154-290">Otherwise, a new `SiteMapNode` for the category is created and added as a child of the `SiteMapNode``root` through the `AddNode(categoryNode, root)` method call.</span></span> <span data-ttu-id="f5154-291">Po odpowiedniej kategorii `SiteMapNode` węzła zostało znalezione lub utworzone, `SiteMapNode` zostanie utworzony dla bieżącego produktu i dodany jako element podrzędny kategorii `SiteMapNode` za pośrednictwem `AddNode(productNode, categoryNode)`.</span><span class="sxs-lookup"><span data-stu-id="f5154-291">After the appropriate category `SiteMapNode` node has been found or created, a `SiteMapNode` is created for the current product and added as a child of the category `SiteMapNode` via `AddNode(productNode, categoryNode)`.</span></span> <span data-ttu-id="f5154-292">Należy pamiętać, że kategoria `SiteMapNode` s `Url` wartość właściwości jest `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID` podczas produktu `SiteMapNode` s `Url` właściwość jest przypisana `~/SiteMapNode/ProductDetails.aspx?ProductID=productID`.</span><span class="sxs-lookup"><span data-stu-id="f5154-292">Note that the category `SiteMapNode` s `Url` property value is `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID` while the product `SiteMapNode` s `Url` property is assigned `~/SiteMapNode/ProductDetails.aspx?ProductID=productID`.</span></span>

> [!NOTE]
> <span data-ttu-id="f5154-293">Te produkty, które mają bazy danych `NULL` wartość ich `CategoryID` są zgrupowane w obszarze kategorii `SiteMapNode` którego `Title` właściwość jest ustawiona na brak i których `Url` ustawioną na pusty ciąg.</span><span class="sxs-lookup"><span data-stu-id="f5154-293">Those products that have a database `NULL` value for their `CategoryID` are grouped under a category `SiteMapNode` whose `Title` property is set to None and whose `Url` property is set to an empty string.</span></span> <span data-ttu-id="f5154-294">Czy mogę zdecydowała się ustawić `Url` na ciąg pusty, ponieważ `ProductBLL` klasy s `GetProductsByCategory(categoryID)` metoda obecnie nie ma możliwości, aby zwrócić tylko te produkty z `NULL` `CategoryID` wartości.</span><span class="sxs-lookup"><span data-stu-id="f5154-294">I decided to set `Url` to an empty string since the `ProductBLL` class s `GetProductsByCategory(categoryID)` method currently lacks the capability to return just those products with a `NULL` `CategoryID` value.</span></span> <span data-ttu-id="f5154-295">Ponadto potrzebowała zademonstrować sposób renderowania formantów nawigacji `SiteMapNode` , brakuje wartości dla swojej `Url` właściwości.</span><span class="sxs-lookup"><span data-stu-id="f5154-295">Also, I wanted to demonstrate how the navigation controls render a `SiteMapNode` that lacks a value for its `Url` property.</span></span> <span data-ttu-id="f5154-296">Zachęcam Cię do rozszerzać ten samouczek, aby Brak `SiteMapNode` s `Url` właściwość wskazuje `ProductsByCategory.aspx`, tylko Wyświetla produkty z `NULL` `CategoryID` wartości.</span><span class="sxs-lookup"><span data-stu-id="f5154-296">I encourage you to extend this tutorial so that the None `SiteMapNode` s `Url` property points to `ProductsByCategory.aspx`, yet only displays the products with `NULL` `CategoryID` values.</span></span>


<span data-ttu-id="f5154-297">Po tworzenia mapy witryny, dowolnego obiektu zostanie dodany do pamięci podręcznej danych używanie zależności pamięci podręcznej SQL na `Categories` i `Products` tabele za pośrednictwem `AggregateCacheDependency` obiektu.</span><span class="sxs-lookup"><span data-stu-id="f5154-297">After constructing the site map, an arbitrary object is added to the data cache using a SQL cache dependency on the `Categories` and `Products` tables through an `AggregateCacheDependency` object.</span></span> <span data-ttu-id="f5154-298">Rozważyliśmy używanie zależności pamięci podręcznej SQL w poprzednim samouczku *przy użyciu zależności pamięci podręcznej SQL*.</span><span class="sxs-lookup"><span data-stu-id="f5154-298">We explored using SQL cache dependencies in the preceding tutorial, *Using SQL Cache Dependencies*.</span></span> <span data-ttu-id="f5154-299">Niestandardowego dostawcy mapy witryny, jednak używane jest przeciążenie pamięci podręcznej danych s `Insert` metoda nim ve jeszcze do zbadania.</span><span class="sxs-lookup"><span data-stu-id="f5154-299">The custom site map provider, however, uses an overload of the data cache s `Insert` method that we ve yet to explore.</span></span> <span data-ttu-id="f5154-300">To przeciążenie akceptuje jako jego ostatni parametr wejściowy delegata, która jest wywoływana, gdy obiekt zostanie usunięty z pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="f5154-300">This overload accepts as its final input parameter a delegate that is called when the object is removed from the cache.</span></span> <span data-ttu-id="f5154-301">W szczególności przekazanie nowego [ `CacheItemRemovedCallback` delegować](https://msdn.microsoft.com/library/system.web.caching.cacheitemremovedcallback.aspx) wskazującej `OnSiteMapChanged` metoda zdefiniowana dalszych szczegółów w `NorthwindSiteMapProvider` klasy.</span><span class="sxs-lookup"><span data-stu-id="f5154-301">Specifically, we pass in a new [`CacheItemRemovedCallback` delegate](https://msdn.microsoft.com/library/system.web.caching.cacheitemremovedcallback.aspx) that points to the `OnSiteMapChanged` method defined further down in the `NorthwindSiteMapProvider` class.</span></span>

> [!NOTE]
> <span data-ttu-id="f5154-302">Reprezentacja w pamięci mapy witryny jest buforowana za pośrednictwem zmiennej poziomu klasa `root`.</span><span class="sxs-lookup"><span data-stu-id="f5154-302">The in-memory representation of the site map is cached through the class-level variable `root`.</span></span> <span data-ttu-id="f5154-303">Ponieważ istnieje tylko jedno wystąpienie, klasa dostawcy mapy witryny niestandardowej i ponieważ to wystąpienie jest współużytkowana przez wszystkie wątki w aplikacji sieci web, zmienna ta klasa służy jako pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="f5154-303">Since there is only one instance of the custom site map provider class and since that instance is shared among all threads in the web application, this class variable serves as a cache.</span></span> <span data-ttu-id="f5154-304">`BuildSiteMap` Metoda również korzysta z pamięci podręcznej danych, jednak tylko w sposób, aby otrzymać powiadomienie, gdy podstawowe dane z bazy danych w `Categories` lub `Products` tabel zmian.</span><span class="sxs-lookup"><span data-stu-id="f5154-304">The `BuildSiteMap` method also uses the data cache, but only as a means to receive notification when the underlying database data in the `Categories` or `Products` tables changes.</span></span> <span data-ttu-id="f5154-305">Należy pamiętać, że wartość umieszczane w pamięci podręcznej danych tylko bieżącą datę i godzinę.</span><span class="sxs-lookup"><span data-stu-id="f5154-305">Note that the value put into the data cache is just the current date and time.</span></span> <span data-ttu-id="f5154-306">Dane mapy rzeczywistej lokacji *nie* umieścić w pamięci podręcznej danych.</span><span class="sxs-lookup"><span data-stu-id="f5154-306">The actual site map data is *not* put in the data cache.</span></span>


<span data-ttu-id="f5154-307">`BuildSiteMap` Metoda kończy się, zwracając węzła głównego mapy witryny.</span><span class="sxs-lookup"><span data-stu-id="f5154-307">The `BuildSiteMap` method completes by returning the root node of the site map.</span></span>

<span data-ttu-id="f5154-308">Pozostałe metody są dość prosta.</span><span class="sxs-lookup"><span data-stu-id="f5154-308">The remaining methods are fairly straightforward.</span></span> <span data-ttu-id="f5154-309">`GetRootNodeCore` jest odpowiedzialna za zwrócenie węzła głównego.</span><span class="sxs-lookup"><span data-stu-id="f5154-309">`GetRootNodeCore` is responsible for returning the root node.</span></span> <span data-ttu-id="f5154-310">Ponieważ `BuildSiteMap` zwraca katalog główny, `GetRootNodeCore` po prostu zwraca `BuildSiteMap` s zwracają wartość.</span><span class="sxs-lookup"><span data-stu-id="f5154-310">Since `BuildSiteMap` returns the root, `GetRootNodeCore` simply returns `BuildSiteMap` s return value.</span></span> <span data-ttu-id="f5154-311">`OnSiteMapChanged` Metody ustawia `root` do `null` po usunięciu elementu pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="f5154-311">The `OnSiteMapChanged` method sets `root` back to `null` when the cache item is removed.</span></span> <span data-ttu-id="f5154-312">Z certyfikatem głównym powraca do `null`, przy następnym `BuildSiteMap` jest wywołana, struktura mapy witryny zostanie odbudowany.</span><span class="sxs-lookup"><span data-stu-id="f5154-312">With root set back to `null`, the next time `BuildSiteMap` is invoked, the site map structure will be rebuilt.</span></span> <span data-ttu-id="f5154-313">Na koniec `CachedDate` właściwość zwraca wartość daty i godziny, przechowywane w pamięci podręcznej danych, jeśli istnieje taka wartość.</span><span class="sxs-lookup"><span data-stu-id="f5154-313">Lastly, the `CachedDate` property returns the date and time value stored in the data cache, if such a value exists.</span></span> <span data-ttu-id="f5154-314">Tej właściwości może służyć przez dewelopera strony, aby określić, kiedy ostatnio buforowano dane mapy witryny.</span><span class="sxs-lookup"><span data-stu-id="f5154-314">This property can be used by a page developer to determine when the site map data was last cached.</span></span>

## <a name="step-7-registering-thenorthwindsitemapprovider"></a><span data-ttu-id="f5154-315">Krok 7. Rejestrowanie`NorthwindSiteMapProvider`</span><span class="sxs-lookup"><span data-stu-id="f5154-315">Step 7: Registering the`NorthwindSiteMapProvider`</span></span>

<span data-ttu-id="f5154-316">Aby nasza aplikacja sieci web do użycia `NorthwindSiteMapProvider` utworzony w kroku 6 dostawcy mapy witryny, należy zarejestrować go w `<siteMap>` części `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="f5154-316">In order for our web application to use the `NorthwindSiteMapProvider` site map provider created in Step 6, we need to register it in the `<siteMap>` section of `Web.config`.</span></span> <span data-ttu-id="f5154-317">W szczególności należy dodać następujący kod w ramach `<system.web>` element `Web.config`:</span><span class="sxs-lookup"><span data-stu-id="f5154-317">Specifically, add the following markup within the `<system.web>` element in `Web.config`:</span></span>


[!code-xml[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample7.xml)]

<span data-ttu-id="f5154-318">Ten kod znaczników wykonuje dwie czynności: po pierwsze, oznacza to, że wbudowane `AspNetXmlSiteMapProvider` jest dostawcy mapy witryny domyślnej; po drugie, rejestruje niestandardowego dostawcy mapy witryny utworzony w kroku 6 za pomocą nazw przyjaznych dla człowieka Northwind.</span><span class="sxs-lookup"><span data-stu-id="f5154-318">This markup does two things: first, it indicates that the built-in `AspNetXmlSiteMapProvider` is the default site map provider; second, it registers the custom site map provider created in Step 6 with the human-friendly name Northwind .</span></span>

> [!NOTE]
> <span data-ttu-id="f5154-319">Dla dostawcy mapy witryny s aplikacji na terenie `App_Code` folderu, wartość `type` atrybutu jest po prostu nazwą klasy.</span><span class="sxs-lookup"><span data-stu-id="f5154-319">For site map providers located in the application s `App_Code` folder, the value of the `type` attribute is simply the class name.</span></span> <span data-ttu-id="f5154-320">Alternatywnie niestandardowego dostawcy mapy witryny można zostały utworzone w osobnym projekcie Biblioteka klas przy użyciu skompilowanego zestawu umieszczone w elemencie s aplikacji sieci web `/Bin` katalogu.</span><span class="sxs-lookup"><span data-stu-id="f5154-320">Alternatively, the custom site map provider could have been created in a separate Class Library project with the compiled assembly placed in the web application s `/Bin` directory.</span></span> <span data-ttu-id="f5154-321">W takim przypadku `type` wartość atrybutu będzie *Namespace*. *ClassName*, *AssemblyName* .</span><span class="sxs-lookup"><span data-stu-id="f5154-321">In that case, the `type` attribute value would be *Namespace*.*ClassName*, *AssemblyName* .</span></span>


<span data-ttu-id="f5154-322">Po zaktualizowaniu `Web.config`, Poświęć chwilę, aby wyświetlić wszystkie strony z samouczków w przeglądarce.</span><span class="sxs-lookup"><span data-stu-id="f5154-322">After updating `Web.config`, take a moment to view any page from the tutorials in a browser.</span></span> <span data-ttu-id="f5154-323">Pamiętaj, że interfejs nawigacji po lewej stronie nadal pokazuje sekcje i samouczki zdefiniowane w `Web.sitemap`.</span><span class="sxs-lookup"><span data-stu-id="f5154-323">Note that the navigation interface on the left still shows the sections and tutorials defined in `Web.sitemap`.</span></span> <span data-ttu-id="f5154-324">Jest to spowodowane pozostawiliśmy `AspNetXmlSiteMapProvider` jako domyślnego dostawcę.</span><span class="sxs-lookup"><span data-stu-id="f5154-324">This is because we left `AspNetXmlSiteMapProvider` as the default provider.</span></span> <span data-ttu-id="f5154-325">Aby można było utworzyć nawigacji elementu interfejsu użytkownika, który używa `NorthwindSiteMapProvider`, musisz jawnie określić, że dostawcy mapy witryny Northwind powinien być używany.</span><span class="sxs-lookup"><span data-stu-id="f5154-325">In order to create a navigation user interface element that uses the `NorthwindSiteMapProvider`, we'll need to explicitly specify that the Northwind site map provider should be used.</span></span> <span data-ttu-id="f5154-326">Zobaczymy, jak to zrobić w kroku 8.</span><span class="sxs-lookup"><span data-stu-id="f5154-326">We'll see how to accomplish this in Step 8.</span></span>

## <a name="step-8-displaying-site-map-information-using-the-custom-site-map-provider"></a><span data-ttu-id="f5154-327">Krok 8. Wyświetlanie informacji mapy witryny przy użyciu niestandardowego dostawcy mapy witryny</span><span class="sxs-lookup"><span data-stu-id="f5154-327">Step 8: Displaying Site Map Information Using the Custom Site Map Provider</span></span>

<span data-ttu-id="f5154-328">Przy użyciu niestandardowej witryny dostawcy mapy utworzony i zarejestrowany w `Web.config`, możemy ponownie gotowy do dodawania formantów nawigacji do `Default.aspx`, `ProductsByCategory.aspx`, i `ProductDetails.aspx` stron w `SiteMapProvider` folderu.</span><span class="sxs-lookup"><span data-stu-id="f5154-328">With the custom site map provider created and registered in `Web.config`, we re ready to add navigation controls to the `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages in the `SiteMapProvider` folder.</span></span> <span data-ttu-id="f5154-329">Zacznij od otwarcia `Default.aspx` strony, a następnie przeciągnij `SiteMapPath` z przybornika do projektanta.</span><span class="sxs-lookup"><span data-stu-id="f5154-329">Start by opening the `Default.aspx` page and drag a `SiteMapPath` from the Toolbox onto the Designer.</span></span> <span data-ttu-id="f5154-330">Kontrolki ścieżki mapy witryny znajduje się w sekcji nawigacji przybornika.</span><span class="sxs-lookup"><span data-stu-id="f5154-330">The SiteMapPath control is located in the Navigation section of the Toolbox.</span></span>


<span data-ttu-id="f5154-331">[![Dodaj ścieżki mapy witryny do Default.aspx](building-a-custom-database-driven-site-map-provider-cs/_static/image19.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image18.gif)</span><span class="sxs-lookup"><span data-stu-id="f5154-331">[![Add a SiteMapPath to Default.aspx](building-a-custom-database-driven-site-map-provider-cs/_static/image19.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image18.gif)</span></span>

<span data-ttu-id="f5154-332">**Rysunek 16**: Dodaj SiteMapPath do `Default.aspx` ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-cs/_static/image20.gif))</span><span class="sxs-lookup"><span data-stu-id="f5154-332">**Figure 16**: Add a SiteMapPath to `Default.aspx` ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image20.gif))</span></span>


<span data-ttu-id="f5154-333">Kontrolki ścieżki mapy witryny Wyświetla ślad, wskazujący bieżącą lokalizację s strony w obrębie mapy witryny.</span><span class="sxs-lookup"><span data-stu-id="f5154-333">The SiteMapPath control displays a breadcrumb, indicating the current page s location within the site map.</span></span> <span data-ttu-id="f5154-334">Dodaliśmy SiteMapPath na górze strony wzorcowej w *strony wzorcowe i nawigacja w witrynie* samouczka.</span><span class="sxs-lookup"><span data-stu-id="f5154-334">We added a SiteMapPath to the top of the master page back in the *Master Pages and Site Navigation* tutorial.</span></span>

<span data-ttu-id="f5154-335">Poświęć chwilę, aby wyświetlić tą stronę za pośrednictwem przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="f5154-335">Take a moment to view this page through a browser.</span></span> <span data-ttu-id="f5154-336">SiteMapPath dodane w rysunek 16 używa domyślnego dostawcy mapy witryny, ściąganie danych z `Web.sitemap`.</span><span class="sxs-lookup"><span data-stu-id="f5154-336">The SiteMapPath added in Figure 16 uses the default site map provider, pulling its data from `Web.sitemap`.</span></span> <span data-ttu-id="f5154-337">W związku z tym, linków do stron nadrzędnych strona główna pokazuje &gt; Dostosowywanie mapy witryny, podobnie jak nawigacji w prawym górnym rogu.</span><span class="sxs-lookup"><span data-stu-id="f5154-337">Therefore, the breadcrumb shows Home &gt; Customizing the Site Map, just like the breadcrumb in the upper-right corner.</span></span>


<span data-ttu-id="f5154-338">[![Łącza do stron nadrzędnych używa domyślnego dostawcy mapy witryny](building-a-custom-database-driven-site-map-provider-cs/_static/image22.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image21.gif)</span><span class="sxs-lookup"><span data-stu-id="f5154-338">[![The Breadcrumb Uses the Default Site Map Provider](building-a-custom-database-driven-site-map-provider-cs/_static/image22.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image21.gif)</span></span>

<span data-ttu-id="f5154-339">**Rysunek 17**: Łącza do stron nadrzędnych używa dostawcy mapy witryny domyślnej ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-cs/_static/image23.gif))</span><span class="sxs-lookup"><span data-stu-id="f5154-339">**Figure 17**: The Breadcrumb Uses the Default Site Map Provider ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image23.gif))</span></span>


<span data-ttu-id="f5154-340">Aby SiteMapPath dodane w rysunek 16, użyć niestandardowego dostawcy mapy witryny utworzonego w kroku 6, ustaw jego [ `SiteMapProvider` właściwość](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sitemappath.sitemapprovider.aspx) do Northwind, przypisaną nazwę, firma Microsoft `NorthwindSiteMapProvider` w `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="f5154-340">To have the SiteMapPath added in Figure 16 use the custom site map provider we created in Step 6, set its [`SiteMapProvider` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sitemappath.sitemapprovider.aspx) to Northwind, the name we assigned to the `NorthwindSiteMapProvider` in `Web.config`.</span></span> <span data-ttu-id="f5154-341">Niestety Projektant będzie później nadal używać domyślnego dostawcy mapy witryny, ale jeśli odwiedź stronę za pośrednictwem przeglądarki po wprowadzeniu tej zmiany właściwości zobaczysz, że łączy do stron nadrzędnych teraz używa niestandardowego dostawcy mapy witryny.</span><span class="sxs-lookup"><span data-stu-id="f5154-341">Unfortunately, the Designer continues to use the default site map provider, but if you visit the page through a browser after making this property change you'll see that the breadcrumb now uses the custom site map provider.</span></span>


<span data-ttu-id="f5154-342">[![Łącza do stron nadrzędnych używa teraz NorthwindSiteMapProvider dostawcy mapy witryny niestandardowej](building-a-custom-database-driven-site-map-provider-cs/_static/image25.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image24.gif)</span><span class="sxs-lookup"><span data-stu-id="f5154-342">[![The Breadcrumb Now Uses the Custom Site Map Provider NorthwindSiteMapProvider](building-a-custom-database-driven-site-map-provider-cs/_static/image25.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image24.gif)</span></span>

<span data-ttu-id="f5154-343">**Rysunek 18**: Łącza do stron nadrzędnych korzysta z dostawcy mapy witryny niestandardowe `NorthwindSiteMapProvider` ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-cs/_static/image26.gif))</span><span class="sxs-lookup"><span data-stu-id="f5154-343">**Figure 18**: The Breadcrumb Now Uses the Custom Site Map Provider `NorthwindSiteMapProvider` ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image26.gif))</span></span>


<span data-ttu-id="f5154-344">Kontrolki ścieżki mapy witryny przedstawia bardziej funkcjonalnego interfejsu użytkownika w `ProductsByCategory.aspx` i `ProductDetails.aspx` stron.</span><span class="sxs-lookup"><span data-stu-id="f5154-344">The SiteMapPath control displays a more functional user interface in the `ProductsByCategory.aspx` and `ProductDetails.aspx` pages.</span></span> <span data-ttu-id="f5154-345">Dodaj ścieżki mapy witryny z tymi stronami, ustawienie `SiteMapProvider` właściwość zarówno do Northwind.</span><span class="sxs-lookup"><span data-stu-id="f5154-345">Add a SiteMapPath to these pages, setting the `SiteMapProvider` property in both to Northwind.</span></span> <span data-ttu-id="f5154-346">Z `Default.aspx` kliknij łącze Wyświetl produkty dla Beverages, a następnie łącze Wyświetl szczegóły dla Chai herbaty.</span><span class="sxs-lookup"><span data-stu-id="f5154-346">From `Default.aspx` click on the View Products link for Beverages, and then on the View Details link for Chai Tea.</span></span> <span data-ttu-id="f5154-347">Jak pokazano na rysunku 19, linków do stron nadrzędnych obejmuje bieżącej lokacji mapy (Chai herbaty) i jego elementów nadrzędnych: I wszystkich kategorii beverages.</span><span class="sxs-lookup"><span data-stu-id="f5154-347">As Figure 19 shows, the breadcrumb includes the current site map section ( Chai Tea ) and its ancestors: Beverages and All Categories .</span></span>


<span data-ttu-id="f5154-348">[![Łącza do stron nadrzędnych używa teraz NorthwindSiteMapProvider dostawcy mapy witryny niestandardowej](building-a-custom-database-driven-site-map-provider-cs/_static/image27.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="f5154-348">[![The Breadcrumb Now Uses the Custom Site Map Provider NorthwindSiteMapProvider](building-a-custom-database-driven-site-map-provider-cs/_static/image27.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image21.png)</span></span>

<span data-ttu-id="f5154-349">**Rysunek 19**: Łącza do stron nadrzędnych korzysta z dostawcy mapy witryny niestandardowe `NorthwindSiteMapProvider` ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-cs/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="f5154-349">**Figure 19**: The Breadcrumb Now Uses the Custom Site Map Provider `NorthwindSiteMapProvider` ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image22.png))</span></span>


<span data-ttu-id="f5154-350">Inne elementy interfejsu użytkownika nawigacji służy oprócz SiteMapPath, takich jak kontrolki Menu i widoku drzewa.</span><span class="sxs-lookup"><span data-stu-id="f5154-350">Other navigation user interface elements can be used in addition to the SiteMapPath, such as the Menu and TreeView controls.</span></span> <span data-ttu-id="f5154-351">`Default.aspx`, `ProductsByCategory.aspx`, I `ProductDetails.aspx` stron do pobrania na potrzeby tego samouczka, na przykład, obejmują formanty Menu (patrz rysunek 20).</span><span class="sxs-lookup"><span data-stu-id="f5154-351">The `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages in the download for this tutorial, for example, all include Menu controls (see Figure 20).</span></span> <span data-ttu-id="f5154-352">Zobacz [s badanie ASP.NET 2.0 funkcji nawigacji w witrynie](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx) i [za pomocą kontrolki witryny](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/navigation/sitenavcontrols.aspx) części [przewodników Szybki Start platformy ASP.NET 2.0](https://quickstarts.asp.net/QuickStartv20/aspnet/) dla bardziej szczegółowo poznać kontrolki i system mapy witryny ASP.NET w wersji 2.0.</span><span class="sxs-lookup"><span data-stu-id="f5154-352">See [Examining ASP.NET 2.0 s Site Navigation Features](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx) and the [Using Site Navigation Controls](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/navigation/sitenavcontrols.aspx) section of the [ASP.NET 2.0 QuickStarts](https://quickstarts.asp.net/QuickStartv20/aspnet/) for a more in-depth look at the navigation controls and site map system in ASP.NET 2.0.</span></span>


<span data-ttu-id="f5154-353">[![Formant Menu zawiera listę kategorii i produkty](building-a-custom-database-driven-site-map-provider-cs/_static/image29.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image28.gif)</span><span class="sxs-lookup"><span data-stu-id="f5154-353">[![The Menu Control Lists Each of the Categories and Products](building-a-custom-database-driven-site-map-provider-cs/_static/image29.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image28.gif)</span></span>

<span data-ttu-id="f5154-354">**Rysunek 20**: Menu Kontrola Wyświetla każdej kategorii i produktów ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-cs/_static/image30.gif))</span><span class="sxs-lookup"><span data-stu-id="f5154-354">**Figure 20**: The Menu Control Lists Each of the Categories and Products ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image30.gif))</span></span>


<span data-ttu-id="f5154-355">Jak wspomniano wcześniej w tym samouczku, struktura mapy witryny są dostępne programowo za pośrednictwem `SiteMap` klasy.</span><span class="sxs-lookup"><span data-stu-id="f5154-355">As mentioned earlier in this tutorial, the site map structure can be accessed programmatically through the `SiteMap` class.</span></span> <span data-ttu-id="f5154-356">Poniższy kod zwraca katalog główny `SiteMapNode` domyślnego dostawcy:</span><span class="sxs-lookup"><span data-stu-id="f5154-356">The following code returns the root `SiteMapNode` of the default provider:</span></span>


[!code-csharp[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample8.cs)]

<span data-ttu-id="f5154-357">Ponieważ `AspNetXmlSiteMapProvider` jest dostawcą domyślnym dla naszej aplikacji powyższy kod zwróci zdefiniowany w węźle głównym `Web.sitemap`.</span><span class="sxs-lookup"><span data-stu-id="f5154-357">Since the `AspNetXmlSiteMapProvider` is the default provider for our application, the above code would return the root node defined in `Web.sitemap`.</span></span> <span data-ttu-id="f5154-358">Aby odwoływać się do dostawcy mapy witryny, inny niż domyślny, należy użyć `SiteMap` klasy s [ `Providers` właściwość](https://msdn.microsoft.com/library/system.web.sitemap.providers.aspx) w następujący sposób:</span><span class="sxs-lookup"><span data-stu-id="f5154-358">To reference a site map provider other than the default, use the `SiteMap` class s [`Providers` property](https://msdn.microsoft.com/library/system.web.sitemap.providers.aspx) like so:</span></span>


[!code-csharp[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample9.cs)]

<span data-ttu-id="f5154-359">Gdzie *nazwa* nazywa się niestandardowego dostawcy mapy witryny (Northwind dla naszej aplikacji internetowej).</span><span class="sxs-lookup"><span data-stu-id="f5154-359">Where *name* is the name of the custom site map provider ( Northwind, for our web application).</span></span>

<span data-ttu-id="f5154-360">Aby uzyskać dostęp do składowej, które są specyficzne dla dostawcy mapy witryny, należy użyć `SiteMap.Providers["name"]` można pobrać wystąpienia dostawcy, a następnie przerzuć go do odpowiedniego typu.</span><span class="sxs-lookup"><span data-stu-id="f5154-360">To access a member specific to a site map provider, use `SiteMap.Providers["name"]` to retrieve the provider instance and then cast it to the appropriate type.</span></span> <span data-ttu-id="f5154-361">Na przykład, aby wyświetlić `NorthwindSiteMapProvider` s `CachedDate` właściwości na stronie ASP.NET, użyj następującego kodu:</span><span class="sxs-lookup"><span data-stu-id="f5154-361">For example, to display the `NorthwindSiteMapProvider` s `CachedDate` property in an ASP.NET page, use the following code:</span></span>


[!code-csharp[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample10.cs)]

> [!NOTE]
> <span data-ttu-id="f5154-362">Pamiętaj przetestowania funkcji zależności pamięci podręcznej SQL.</span><span class="sxs-lookup"><span data-stu-id="f5154-362">Be sure to test out the SQL cache dependency feature.</span></span> <span data-ttu-id="f5154-363">Po odwiedzając `Default.aspx`, `ProductsByCategory.aspx`, i `ProductDetails.aspx` stron, przejdź do jednego z samouczków w edytowanie, wstawianie i usuwanie sekcji i umożliwia edytowanie nazwy, kategorii lub produktu.</span><span class="sxs-lookup"><span data-stu-id="f5154-363">After visiting the `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages, go to one of the tutorials in the Editing, Inserting, and Deleting section and edit the name of a category or product.</span></span> <span data-ttu-id="f5154-364">Następnie wróć do jednej ze stron w `SiteMapProvider` folderu.</span><span class="sxs-lookup"><span data-stu-id="f5154-364">Then return to one of the pages in the `SiteMapProvider` folder.</span></span> <span data-ttu-id="f5154-365">Zakładając, że dla mechanizmu sondowania należy pamiętać, zmiany z podstawową bazą danych minęło wystarczająco dużo czasu, Mapa witryny, powinien zostać zaktualizowany do wyświetlenia nowego produktu lub nazwa kategorii.</span><span class="sxs-lookup"><span data-stu-id="f5154-365">Assuming enough time has passed for the polling mechanism to note the change to the underlying database, the site map should be updated to show the new product or category name.</span></span>


## <a name="summary"></a><span data-ttu-id="f5154-366">Podsumowanie</span><span class="sxs-lookup"><span data-stu-id="f5154-366">Summary</span></span>

<span data-ttu-id="f5154-367">Program ASP.NET 2.0 obejmuje funkcje mapy witryny s `SiteMap` klasy, określa liczbę nawigacyjny wbudowanych w sieci Web i dostawcy mapy witryny domyślnej, który oczekuje, że dane mapy witryny utrwalone w pliku XML.</span><span class="sxs-lookup"><span data-stu-id="f5154-367">ASP.NET 2.0 s site map features includes a `SiteMap` class, a number of built-in navigation Web controls, and a default site map provider that expects the site map information persisted to an XML file.</span></span> <span data-ttu-id="f5154-368">Aby można było używać mapy witryny z innego źródła takie jak bazy danych, architektura s lub zdalnej usługi sieci Web, należy utworzyć niestandardowego dostawcy mapy witryny.</span><span class="sxs-lookup"><span data-stu-id="f5154-368">In order to use site map information from some other source such as from a database, the application s architecture, or a remote Web service we need to create a custom site map provider.</span></span> <span data-ttu-id="f5154-369">Obejmuje to tworzenie klasy, która pochodzi bezpośrednio lub pośrednio z `SiteMapProvider` klasy.</span><span class="sxs-lookup"><span data-stu-id="f5154-369">This involves creating a class that derives, directly or indirectly, from the `SiteMapProvider` class.</span></span>

<span data-ttu-id="f5154-370">W tym samouczku widzieliśmy sposób tworzenia niestandardowego dostawcy mapy witryny, Mapa witryny na podstawie produktów i kategorii informacji ubitych z architektury aplikacji.</span><span class="sxs-lookup"><span data-stu-id="f5154-370">In this tutorial we saw how to create a custom site map provider that based the site map on the product and category information culled from the application architecture.</span></span> <span data-ttu-id="f5154-371">U naszego dostawcy rozszerzone `StaticSiteMapProvider` klasy i związanych z tworzenia `BuildSiteMap` metodę, która pobierane są dane, skonstruowany hierarchii mapy witryny i buforowane strukturze wynikowe w zmiennej na poziomie klasy.</span><span class="sxs-lookup"><span data-stu-id="f5154-371">Our provider extended the `StaticSiteMapProvider` class and entailed creating a `BuildSiteMap` method that retrieved the data, constructed the site map hierarchy, and cached the resulting structure in a class-level variable.</span></span> <span data-ttu-id="f5154-372">Użyliśmy zależności pamięci podręcznej SQL za pomocą funkcji wywołania zwrotnego do unieważnienia pamięci podręcznej struktury, gdy podstawowe `Categories` lub `Products` danych zostanie zmodyfikowany.</span><span class="sxs-lookup"><span data-stu-id="f5154-372">We used a SQL cache dependency with a callback function to invalidate the cached structure when the underlying `Categories` or `Products` data is modified.</span></span>

<span data-ttu-id="f5154-373">Wszystkiego najlepszego programowania!</span><span class="sxs-lookup"><span data-stu-id="f5154-373">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="f5154-374">Dalsze informacje</span><span class="sxs-lookup"><span data-stu-id="f5154-374">Further Reading</span></span>

<span data-ttu-id="f5154-375">Więcej informacji na tematów omówionych w tym samouczku można znaleźć w następujących zasobach:</span><span class="sxs-lookup"><span data-stu-id="f5154-375">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- <span data-ttu-id="f5154-376">[Przechowywanie mapy witryny w programie SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) i [dostawcy mapy witryny SQL był dawna oczekiwane](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx)</span><span class="sxs-lookup"><span data-stu-id="f5154-376">[Storing Site Maps in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) and [The SQL Site Map Provider You ve Been Waiting For](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx)</span></span>
- [<span data-ttu-id="f5154-377">Model dostawcy s przyjrzeć platformy ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="f5154-377">A Look at ASP.NET 2.0 s Provider Model</span></span>](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx)
- [<span data-ttu-id="f5154-378">Zestaw narzędzi dostawcy</span><span class="sxs-lookup"><span data-stu-id="f5154-378">The Provider Toolkit</span></span>](https://msdn.microsoft.com/asp.net/aa336558.aspx)
- [<span data-ttu-id="f5154-379">Badanie programu ASP.NET 2.0 funkcji nawigacji w witrynie s</span><span class="sxs-lookup"><span data-stu-id="f5154-379">Examining ASP.NET 2.0 s Site Navigation Features</span></span>](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx)

## <a name="about-the-author"></a><span data-ttu-id="f5154-380">Informacje o autorze</span><span class="sxs-lookup"><span data-stu-id="f5154-380">About the Author</span></span>

<span data-ttu-id="f5154-381">[Scott Bento](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor siedem ASP/ASP.NET książek i założycielem [4GuysFromRolla.com](http://www.4guysfromrolla.com), pracował nad przy użyciu technologii Microsoft Web od 1998 r.</span><span class="sxs-lookup"><span data-stu-id="f5154-381">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="f5154-382">Scott działa jako niezależny Konsultant, trainer i składnika zapisywania.</span><span class="sxs-lookup"><span data-stu-id="f5154-382">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="f5154-383">Jego najnowszą książkę Stephena [ *Sams uczyć się ASP.NET 2.0 w ciągu 24 godzin*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="f5154-383">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="f5154-384">ADAM można z Tobą skontaktować w [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="f5154-384">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="f5154-385">lub za pośrednictwem jego blogu, który znajduje się w temacie [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="f5154-385">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="f5154-386">Specjalne podziękowania dla</span><span class="sxs-lookup"><span data-stu-id="f5154-386">Special Thanks To</span></span>

<span data-ttu-id="f5154-387">W tej serii samouczków został zrecenzowany przez wielu recenzentów pomocne.</span><span class="sxs-lookup"><span data-stu-id="f5154-387">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="f5154-388">Wiodące osób dokonujących przeglądu, w tym samouczku zostały Dave Gardner, Zack Jones, Teresa Murphy i Bernadette Leigh.</span><span class="sxs-lookup"><span data-stu-id="f5154-388">Lead reviewers for this tutorial were Dave Gardner, Zack Jones, Teresa Murphy, and Bernadette Leigh.</span></span> <span data-ttu-id="f5154-389">Zainteresowani zapoznaniem Moje kolejnych artykułów MSDN?</span><span class="sxs-lookup"><span data-stu-id="f5154-389">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="f5154-390">Jeśli tak, Porzuć mnie linii w [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="f5154-390">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="f5154-391">Next</span><span class="sxs-lookup"><span data-stu-id="f5154-391">Next</span></span>](building-a-custom-database-driven-site-map-provider-vb.md)
