---
uid: web-forms/overview/data-access/database-driven-site-maps/building-a-custom-database-driven-site-map-provider-vb
title: Tworzenie niestandardowego dostawcy mapy witryny opartego na bazie danych (VB) | Microsoft Docs
author: rick-anderson
description: Domyślny dostawca mapy witryny w programie ASP.NET 2,0 pobiera dane z statycznego pliku XML. Chociaż dostawca oparty na języku XML jest odpowiedni dla wielu małych i średnich SIZ...
ms.author: riande
ms.date: 06/26/2007
ms.assetid: f904cd2c-a408-4484-9324-8b8d7fe33893
msc.legacyurl: /web-forms/overview/data-access/database-driven-site-maps/building-a-custom-database-driven-site-map-provider-vb
msc.type: authoredcontent
ms.openlocfilehash: 78051696bd75e1d574f55b1c5d5891fe67c3030d
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 11/28/2019
ms.locfileid: "74630445"
---
# <a name="building-a-custom-database-driven-site-map-provider-vb"></a><span data-ttu-id="09042-104">Tworzenie niestandardowego dostawcy map witryn opartych na bazie danych (VB)</span><span class="sxs-lookup"><span data-stu-id="09042-104">Building a Custom Database-Driven Site Map Provider (VB)</span></span>

<span data-ttu-id="09042-105">przez [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="09042-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="09042-106">[Pobierz kod](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_62_VB.zip) lub [Pobierz plik PDF](building-a-custom-database-driven-site-map-provider-vb/_static/datatutorial62vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="09042-106">[Download Code](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_62_VB.zip) or [Download PDF](building-a-custom-database-driven-site-map-provider-vb/_static/datatutorial62vb1.pdf)</span></span>

> <span data-ttu-id="09042-107">Domyślny dostawca mapy witryny w programie ASP.NET 2,0 pobiera dane z statycznego pliku XML.</span><span class="sxs-lookup"><span data-stu-id="09042-107">The default site map provider in ASP.NET 2.0 retrieves its data from a static XML file.</span></span> <span data-ttu-id="09042-108">Chociaż dostawca oparty na języku XML jest odpowiedni dla wielu małych i średnich witryn sieci Web, większe aplikacje sieci Web wymagają szerszej mapy witryn.</span><span class="sxs-lookup"><span data-stu-id="09042-108">While the XML-based provider is suitable to many small and medium-sized Web sites, larger Web applications require a more dynamic site map.</span></span> <span data-ttu-id="09042-109">W tym samouczku utworzymy niestandardowego dostawcę mapy witryny, który pobiera dane z warstwy logiki biznesowej, która z kolei pobiera dane z bazy danych.</span><span class="sxs-lookup"><span data-stu-id="09042-109">In this tutorial we'll build a custom site map provider that retrieves its data from the Business Logic Layer, which in turn retrieves data from the database.</span></span>

## <a name="introduction"></a><span data-ttu-id="09042-110">Wprowadzenie</span><span class="sxs-lookup"><span data-stu-id="09042-110">Introduction</span></span>

<span data-ttu-id="09042-111">ASP.NET 2,0 s funkcja mapy witryny umożliwia deweloperom stron Definiowanie mapy witryny aplikacji sieci Web w pewnym trwałym nośniku, na przykład w pliku XML.</span><span class="sxs-lookup"><span data-stu-id="09042-111">ASP.NET 2.0 s site map feature enables a page developer to define a web application s site map in some persistent medium, such as in an XML file.</span></span> <span data-ttu-id="09042-112">Po zdefiniowaniu dane mapy lokacji można uzyskać programowo przy użyciu [klasy`SiteMap`](https://msdn.microsoft.com/library/system.web.sitemap.aspx) w [przestrzeni nazw`System.Web`](https://msdn.microsoft.com/library/system.web.aspx) lub za pomocą różnych kontrolek sieci Web nawigacji, takich jak ścieżki mapy witryny, menu i drzewa TreeView.</span><span class="sxs-lookup"><span data-stu-id="09042-112">Once defined, the site map data can be accessed programmatically through the [`SiteMap` class](https://msdn.microsoft.com/library/system.web.sitemap.aspx) in the [`System.Web` namespace](https://msdn.microsoft.com/library/system.web.aspx) or through a variety of navigation Web controls, such as the SiteMapPath, Menu, and TreeView controls.</span></span> <span data-ttu-id="09042-113">System mapy lokacji korzysta z [modelu dostawcy](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx) , aby można było utworzyć różne implementacje serializacji mapy witryny i podłączyć je do aplikacji sieci Web.</span><span class="sxs-lookup"><span data-stu-id="09042-113">The site map system uses the [provider model](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx) so that different site map serialization implementations can be created and plugged into a web application.</span></span> <span data-ttu-id="09042-114">Domyślny dostawca mapy witryny dostarczany z ASP.NET 2,0 utrzymuje strukturę mapy witryny w pliku XML.</span><span class="sxs-lookup"><span data-stu-id="09042-114">The default site map provider that ships with ASP.NET 2.0 persists site map structure in an XML file.</span></span> <span data-ttu-id="09042-115">Z powrotem na [stronach wzorcowych i](../introduction/master-pages-and-site-navigation-vb.md) w samouczku nawigowania po witrynie został utworzony plik o nazwie `Web.sitemap`, który zawierał tę strukturę i który ZAKTUALIZOWAŁ kod XML za pomocą każdej nowej sekcji samouczka.</span><span class="sxs-lookup"><span data-stu-id="09042-115">Back in the [Master Pages and Site Navigation](../introduction/master-pages-and-site-navigation-vb.md) tutorial we created a file named `Web.sitemap` that contained this structure and have been updating its XML with each new tutorial section.</span></span>

<span data-ttu-id="09042-116">Domyślny dostawca mapy witryny oparty na języku XML działa prawidłowo, jeśli struktura mapy witryny jest dość statyczna, na przykład w przypadku tych samouczków.</span><span class="sxs-lookup"><span data-stu-id="09042-116">The default XML-based site map provider works well if the site map s structure is fairly static, such as for these tutorials.</span></span> <span data-ttu-id="09042-117">Jednak w wielu scenariuszach jest wymagana bardziej dynamiczna mapa witryny.</span><span class="sxs-lookup"><span data-stu-id="09042-117">In many scenarios, however, a more dynamic site map is needed.</span></span> <span data-ttu-id="09042-118">Rozważmy mapę witryny pokazaną na rysunku 1, gdzie każda kategoria i produkt są wyświetlane jako sekcje w strukturze witryny sieci Web.</span><span class="sxs-lookup"><span data-stu-id="09042-118">Consider the site map shown in Figure 1, where each category and product appear as sections in the website s structure.</span></span> <span data-ttu-id="09042-119">W przypadku tej mapy witryny odwiedzanie strony sieci Web odpowiadającej węzłowi głównemu może spowodować wyświetlenie wszystkich kategorii, a podczas odwiedzania określonej strony sieci Web w kategorii należy wyświetlić listę produktów kategorii i wyświetlić określoną stronę produktu w sieci Web.</span><span class="sxs-lookup"><span data-stu-id="09042-119">With this site map, visiting the web page corresponding to the root node might list all of the categories, whereas visiting a particular category s web page would list that category s products and viewing a particular product s web page would show that product s details.</span></span>

<span data-ttu-id="09042-120">[![kategorie i produkty korzeń strukturę mapy witryny](building-a-custom-database-driven-site-map-provider-vb/_static/image1.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="09042-120">[![The Categories and Products Makeup the Site Map s Structure](building-a-custom-database-driven-site-map-provider-vb/_static/image1.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image1.png)</span></span>

<span data-ttu-id="09042-121">**Rysunek 1**. kategorie i produkty korzeń strukturę mapy witryny ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-vb/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="09042-121">**Figure 1**: The Categories and Products Makeup the Site Map s Structure ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image2.png))</span></span>

<span data-ttu-id="09042-122">Chociaż ta struktura kategorii i produktu może być zakodowana w pliku `Web.sitemap`, należy ją zaktualizować za każdym razem, gdy Kategoria lub produkt został dodany, usunięty lub zmieniono jego nazwę.</span><span class="sxs-lookup"><span data-stu-id="09042-122">While this category- and product-based structure could be hard-coded into the `Web.sitemap` file, the file would need to be updated each time a category or product was added, removed, or renamed.</span></span> <span data-ttu-id="09042-123">W związku z tym, konserwacja mapy witryny będzie znacznie uproszczona, jeśli struktura została pobrana z bazy danych lub, najlepiej, z warstwy logiki biznesowej architektury aplikacji.</span><span class="sxs-lookup"><span data-stu-id="09042-123">Consequently, the site map maintenance would be greatly simplified if its structure was retrieved from the database or, ideally, from the Business Logic Layer of the application s architecture.</span></span> <span data-ttu-id="09042-124">Dzięki temu, jak produkty i kategorie zostały dodane, zmieniono nazwę lub usunięto, mapa witryny zostanie automatycznie zaktualizowana w celu odzwierciedlenia tych zmian.</span><span class="sxs-lookup"><span data-stu-id="09042-124">That way, as products and categories were added, renamed, or deleted, the site map would automatically update to reflect these changes.</span></span>

<span data-ttu-id="09042-125">Ponieważ ASP.NET 2,0 s Serializacja mapy witryny jest zbudowana korzystającego modelu dostawcy, możemy utworzyć własnego niestandardowego dostawcę mapy witryny, który będzie zbierał dane z alternatywnego magazynu danych, takiego jak baza danych lub architektura.</span><span class="sxs-lookup"><span data-stu-id="09042-125">Since ASP.NET 2.0 s site map serialization is built atop the provider model, we can create our own custom site map provider that grabs its data from an alternate data store, such as the database or architecture.</span></span> <span data-ttu-id="09042-126">W tym samouczku utworzysz dostawcę niestandardowego, który pobiera dane z LOGIKI biznesowej.</span><span class="sxs-lookup"><span data-stu-id="09042-126">In this tutorial we'll build a custom provider that retrieves its data from the BLL.</span></span> <span data-ttu-id="09042-127">Zacznij korzystać z aplikacji.</span><span class="sxs-lookup"><span data-stu-id="09042-127">Let s get started!</span></span>

> [!NOTE]
> <span data-ttu-id="09042-128">Niestandardowy dostawca mapy witryny utworzony w tym samouczku jest ściśle połączony z architekturą i modelem danych aplikacji.</span><span class="sxs-lookup"><span data-stu-id="09042-128">The custom site map provider created in this tutorial is tightly coupled to the application s architecture and data model.</span></span> <span data-ttu-id="09042-129">Marcin Prosise s [przechowujący mapy witryn w SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) i [dostawca mapy witryny SQL zaczekał na](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx) artykuły badanie uogólnionego podejścia do przechowywania danych mapy lokacji w SQL Server.</span><span class="sxs-lookup"><span data-stu-id="09042-129">Jeff Prosise s [Storing Site Maps in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) and [The SQL Site Map Provider You ve Been Waiting For](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx) articles examine a generalized approach to storing site map data in SQL Server.</span></span>

## <a name="step-1-creating-the-custom-site-map-provider-web-pages"></a><span data-ttu-id="09042-130">Krok 1. Tworzenie niestandardowych stron sieci Web dostawcy mapy witryny</span><span class="sxs-lookup"><span data-stu-id="09042-130">Step 1: Creating the Custom Site Map Provider Web Pages</span></span>

<span data-ttu-id="09042-131">Przed rozpoczęciem tworzenia niestandardowego dostawcy mapy witryny należy najpierw dodać strony ASP.NET, które będą potrzebne w tym samouczku.</span><span class="sxs-lookup"><span data-stu-id="09042-131">Before we start creating a custom site map provider, let s first add the ASP.NET pages we'll need for this tutorial.</span></span> <span data-ttu-id="09042-132">Zacznij od dodania nowego folderu o nazwie `SiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="09042-132">Start by adding a new folder named `SiteMapProvider`.</span></span> <span data-ttu-id="09042-133">Następnie Dodaj następujące strony ASP.NET do tego folderu, aby upewnić się, że każda strona jest skojarzona z `Site.master` stroną wzorcową:</span><span class="sxs-lookup"><span data-stu-id="09042-133">Next, add the following ASP.NET pages to that folder, making sure to associate each page with the `Site.master` master page:</span></span>

- `Default.aspx`
- `ProductsByCategory.aspx`
- `ProductDetails.aspx`

<span data-ttu-id="09042-134">Dodaj także podfolder `CustomProviders` do folderu `App_Code`.</span><span class="sxs-lookup"><span data-stu-id="09042-134">Also add a `CustomProviders` subfolder to the `App_Code` folder.</span></span>

![Dodaj strony ASP.NET dla samouczków związanych z dostawcą mapy witryny](building-a-custom-database-driven-site-map-provider-vb/_static/image2.gif)

<span data-ttu-id="09042-136">**Rysunek 2**. dodawanie stron ASP.NET dla samouczków związanych z dostawcą mapy witryny</span><span class="sxs-lookup"><span data-stu-id="09042-136">**Figure 2**: Add the ASP.NET Pages for the Site Map Provider-Related Tutorials</span></span>

<span data-ttu-id="09042-137">Ponieważ dla tej sekcji istnieje tylko jeden samouczek, nie potrzebujemy `Default.aspx`, aby wyświetlić listę samouczków sekcji.</span><span class="sxs-lookup"><span data-stu-id="09042-137">Since there is only one tutorial for this section, we don t need `Default.aspx` to list the section s tutorials.</span></span> <span data-ttu-id="09042-138">Zamiast tego, `Default.aspx` będą wyświetlać kategorie w kontrolce GridView.</span><span class="sxs-lookup"><span data-stu-id="09042-138">Instead, `Default.aspx` will display the categories in a GridView control.</span></span> <span data-ttu-id="09042-139">Zajmiemy się tym w kroku 2.</span><span class="sxs-lookup"><span data-stu-id="09042-139">We'll tackle this in Step 2.</span></span>

<span data-ttu-id="09042-140">Następnie zaktualizuj `Web.sitemap`, aby dołączyć odwołanie do strony `Default.aspx`.</span><span class="sxs-lookup"><span data-stu-id="09042-140">Next, update `Web.sitemap` to include a reference to the `Default.aspx` page.</span></span> <span data-ttu-id="09042-141">Należy dodać następujące znaczniki po `<siteMapNode>`buforowania:</span><span class="sxs-lookup"><span data-stu-id="09042-141">Specifically, add the following markup after the Caching `<siteMapNode>`:</span></span>

[!code-xml[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample1.xml)]

<span data-ttu-id="09042-142">Po aktualizacji `Web.sitemap`zapoznaj się z witryną internetową samouczków za pomocą przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="09042-142">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="09042-143">Menu po lewej stronie zawiera teraz element samouczka dla jedynego dostawcy mapy witryny.</span><span class="sxs-lookup"><span data-stu-id="09042-143">The menu on the left now includes an item for the sole site map provider tutorial.</span></span>

![Mapa witryny zawiera teraz wpis do samouczka dotyczącego dostawcy mapy witryny](building-a-custom-database-driven-site-map-provider-vb/_static/image3.gif)

<span data-ttu-id="09042-145">**Rysunek 3**. Mapa witryny zawiera teraz wpis do samouczka dotyczącego dostawcy mapy witryny</span><span class="sxs-lookup"><span data-stu-id="09042-145">**Figure 3**: The Site Map Now Includes an Entry for the Site Map Provider Tutorial</span></span>

<span data-ttu-id="09042-146">Ten samouczek przedstawia tworzenie niestandardowego dostawcy mapy witryny i Konfigurowanie aplikacji sieci Web do korzystania z tego dostawcy.</span><span class="sxs-lookup"><span data-stu-id="09042-146">This tutorial s main focus is to illustrate creating a custom site map provider and configuring a web application to use that provider.</span></span> <span data-ttu-id="09042-147">W szczególności utworzymy dostawcę, który zwróci mapę witryny, która zawiera węzeł główny wraz z węzłem dla każdej kategorii i produktu, jak przedstawiono na rysunku 1.</span><span class="sxs-lookup"><span data-stu-id="09042-147">In particular, we'll build a provider that returns a site map that includes a root node along with a node for each category and product, as depicted in Figure 1.</span></span> <span data-ttu-id="09042-148">Ogólnie rzecz biorąc, każdy węzeł w mapie witryny może określać adres URL.</span><span class="sxs-lookup"><span data-stu-id="09042-148">In general, each node in the site map may specify a URL.</span></span> <span data-ttu-id="09042-149">W przypadku naszej mapy witryny główny adres URL węzła zostanie `~/SiteMapProvider/Default.aspx`, co spowoduje wyświetlenie listy wszystkich kategorii w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="09042-149">For our site map, the root node s URL will be `~/SiteMapProvider/Default.aspx`, which will list all of the categories in the database.</span></span> <span data-ttu-id="09042-150">Każdy węzeł kategorii na mapie witryny będzie miał adres URL wskazujący na `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID`, który będzie zawierać listę wszystkich produktów w określonym *IDkategorii*.</span><span class="sxs-lookup"><span data-stu-id="09042-150">Each category node in the site map will have a URL that points to `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID`, which will list all of the products in the specified *categoryID*.</span></span> <span data-ttu-id="09042-151">Na koniec każdy węzeł mapy witryny produktu wskaże `~/SiteMapProvider/ProductDetails.aspx?ProductID=productID`, co spowoduje wyświetlenie szczegółowych informacji o produkcie.</span><span class="sxs-lookup"><span data-stu-id="09042-151">Finally, each product site map node will point to `~/SiteMapProvider/ProductDetails.aspx?ProductID=productID`, which will display the specific product s details.</span></span>

<span data-ttu-id="09042-152">Aby rozpocząć, należy utworzyć strony `Default.aspx`, `ProductsByCategory.aspx`i `ProductDetails.aspx`.</span><span class="sxs-lookup"><span data-stu-id="09042-152">To start we need to create the `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages.</span></span> <span data-ttu-id="09042-153">Te strony są wykonywane odpowiednio w krokach 2, 3 i 4.</span><span class="sxs-lookup"><span data-stu-id="09042-153">These pages are completed in Steps 2, 3, and 4, respectively.</span></span> <span data-ttu-id="09042-154">Ponieważ nacisk tego samouczka znajduje się w dostawcach mapy witryny, a ponieważ przeszłe samouczki pomogły utworzyć różne raporty wzorzec/szczegóły wielostronicowego, będziemy pospiesz przez kroki od 2 do 4.</span><span class="sxs-lookup"><span data-stu-id="09042-154">Since the thrust of this tutorial is on site map providers, and since past tutorials have covered creating these sorts of multi-page master/detail reports, we will hurry through Steps 2 through 4.</span></span> <span data-ttu-id="09042-155">Jeśli potrzebujesz odświeżacza przy tworzeniu raportów master/detail obejmujących wiele stron, zapoznaj się z artykułem dotyczącym [filtrowania wzorca/szczegółów na dwóch stronach](../masterdetail/master-detail-filtering-across-two-pages-vb.md) .</span><span class="sxs-lookup"><span data-stu-id="09042-155">If you need a refresher on creating master/detail reports that span multiple pages, refer back to the [Master/Detail Filtering Across Two Pages](../masterdetail/master-detail-filtering-across-two-pages-vb.md) tutorial.</span></span>

## <a name="step-2-displaying-a-list-of-categories"></a><span data-ttu-id="09042-156">Krok 2. Wyświetlanie listy kategorii</span><span class="sxs-lookup"><span data-stu-id="09042-156">Step 2: Displaying a List of Categories</span></span>

<span data-ttu-id="09042-157">Otwórz stronę `Default.aspx` w folderze `SiteMapProvider` i przeciągnij widok GridView z przybornika do projektanta, ustawiając jego `ID` na `Categories`.</span><span class="sxs-lookup"><span data-stu-id="09042-157">Open the `Default.aspx` page in the `SiteMapProvider` folder and drag a GridView from the Toolbox onto the Designer, setting its `ID` to `Categories`.</span></span> <span data-ttu-id="09042-158">Z taga inteligentnego w widoku GridView powiąż go z nowym elementem ObjectDataSource o nazwie `CategoriesDataSource` i skonfiguruj go tak, aby pobierał dane przy użyciu metody `CategoriesBLL` klasy s `GetCategories`.</span><span class="sxs-lookup"><span data-stu-id="09042-158">From the GridView s smart tag, bind it to a new ObjectDataSource named `CategoriesDataSource` and configure it so that it retrieves its data using the `CategoriesBLL` class s `GetCategories` method.</span></span> <span data-ttu-id="09042-159">Ponieważ w tym widoku GridView są wyświetlane kategorie i nie są dostępne funkcje modyfikacji danych, Ustaw listę rozwijaną na kartach UPDATE, INSERT i DELETE na wartość (brak).</span><span class="sxs-lookup"><span data-stu-id="09042-159">Since this GridView just displays the categories and does not provide data modification capabilities, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>

<span data-ttu-id="09042-160">[![skonfigurować element ObjectDataSource do zwracania kategorii za pomocą metody GetCategories](building-a-custom-database-driven-site-map-provider-vb/_static/image4.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="09042-160">[![Configure the ObjectDataSource to Return Categories Using the GetCategories Method](building-a-custom-database-driven-site-map-provider-vb/_static/image4.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image3.png)</span></span>

<span data-ttu-id="09042-161">**Ilustracja 4**. Konfigurowanie elementu ObjectDataSource do zwracania kategorii za pomocą metody `GetCategories` ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-vb/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="09042-161">**Figure 4**: Configure the ObjectDataSource to Return Categories Using the `GetCategories` Method ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image4.png))</span></span>

<span data-ttu-id="09042-162">[![ustawić listy rozwijane na kartach Aktualizuj, Wstaw i Usuń do (brak).](building-a-custom-database-driven-site-map-provider-vb/_static/image5.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="09042-162">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](building-a-custom-database-driven-site-map-provider-vb/_static/image5.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image5.png)</span></span>

<span data-ttu-id="09042-163">**Rysunek 5**. Ustawianie list rozwijanych w kartach Aktualizuj, Wstaw i Usuń do (brak) ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="09042-163">**Figure 5**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image6.png))</span></span>

<span data-ttu-id="09042-164">Po zakończeniu działania Kreatora konfiguracji źródła danych program Visual Studio doda BoundField do `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`i `BrochurePath`.</span><span class="sxs-lookup"><span data-stu-id="09042-164">After completing the Configure Data Source wizard, Visual Studio will add a BoundField for `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, and `BrochurePath`.</span></span> <span data-ttu-id="09042-165">Edytuj widok GridView, aby zawierał tylko `CategoryName` i `Description` BoundFields i zaktualizować Właściwość `CategoryName` BoundField s `HeaderText` do kategorii.</span><span class="sxs-lookup"><span data-stu-id="09042-165">Edit the GridView so that it only contains the `CategoryName` and `Description` BoundFields and update the `CategoryName` BoundField s `HeaderText` property to Category .</span></span>

<span data-ttu-id="09042-166">Następnie Dodaj element HyperLinkField i umieść go tak, aby pozostały do lewej strony.</span><span class="sxs-lookup"><span data-stu-id="09042-166">Next, add a HyperLinkField and position it so that it s the left-most field.</span></span> <span data-ttu-id="09042-167">Ustaw właściwość `DataNavigateUrlFields` na `CategoryID` i Właściwość `DataNavigateUrlFormatString` na `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID={0}`.</span><span class="sxs-lookup"><span data-stu-id="09042-167">Set the `DataNavigateUrlFields` property to `CategoryID` and the `DataNavigateUrlFormatString` property to `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID={0}`.</span></span> <span data-ttu-id="09042-168">Ustaw właściwość `Text`, aby wyświetlić produkty.</span><span class="sxs-lookup"><span data-stu-id="09042-168">Set the `Text` property to View Products .</span></span>

![Dodaj element HyperLinkField do kategorii GridView](building-a-custom-database-driven-site-map-provider-vb/_static/image6.gif)

<span data-ttu-id="09042-170">**Ilustracja 6**. Dodawanie HyperLinkField do `Categories` GridView</span><span class="sxs-lookup"><span data-stu-id="09042-170">**Figure 6**: Add a HyperLinkField to the `Categories` GridView</span></span>

<span data-ttu-id="09042-171">Po utworzeniu elementu ObjectDataSource i dostosowaniu pól GridView, dwa formanty deklaratywne znaczniki będą wyglądać następująco:</span><span class="sxs-lookup"><span data-stu-id="09042-171">After creating the ObjectDataSource and customizing the GridView s fields, the two controls declarative markup will look like the following:</span></span>

[!code-aspx[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample2.aspx)]

<span data-ttu-id="09042-172">Rysunek 7 przedstawia `Default.aspx`, gdy jest wyświetlany za pomocą przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="09042-172">Figure 7 shows `Default.aspx` when viewed through a browser.</span></span> <span data-ttu-id="09042-173">Kliknięcie linku Pokaż produkty kategorii spowoduje przejście do `ProductsByCategory.aspx?CategoryID=categoryID`, który zostanie skompilowany w kroku 3.</span><span class="sxs-lookup"><span data-stu-id="09042-173">Clicking a category s View Products link takes you to `ProductsByCategory.aspx?CategoryID=categoryID`, which we will build in Step 3.</span></span>

<span data-ttu-id="09042-174">[![każda kategoria jest wyświetlana razem z linkiem Wyświetl produkty](building-a-custom-database-driven-site-map-provider-vb/_static/image7.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="09042-174">[![Each Category is Listed Along with a View Products Link](building-a-custom-database-driven-site-map-provider-vb/_static/image7.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image7.png)</span></span>

<span data-ttu-id="09042-175">**Rysunek 7**. Każda kategoria jest wyświetlana wraz z linkiem Wyświetl produkty ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-vb/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="09042-175">**Figure 7**: Each Category is Listed Along with a View Products Link ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image8.png))</span></span>

## <a name="step-3-listing-the-selected-category-s-products"></a><span data-ttu-id="09042-176">Krok 3. Wyświetlanie listy wybranych produktów kategorii s</span><span class="sxs-lookup"><span data-stu-id="09042-176">Step 3: Listing the Selected Category s Products</span></span>

<span data-ttu-id="09042-177">Otwórz stronę `ProductsByCategory.aspx` i Dodaj widok GridView, nadając jej nazwę `ProductsByCategory`.</span><span class="sxs-lookup"><span data-stu-id="09042-177">Open the `ProductsByCategory.aspx` page and add a GridView, naming it `ProductsByCategory`.</span></span> <span data-ttu-id="09042-178">Ze znacznika inteligentnego Powiąż widok GridView z nowym elementem ObjectDataSource o nazwie `ProductsByCategoryDataSource`.</span><span class="sxs-lookup"><span data-stu-id="09042-178">From its smart tag, bind the GridView to a new ObjectDataSource named `ProductsByCategoryDataSource`.</span></span> <span data-ttu-id="09042-179">Skonfiguruj element ObjectDataSource do używania metody `GetProductsByCategoryID(categoryID)` `ProductsBLL` klasy s i Ustaw listę rozwijaną na wartość (brak) na kartach Aktualizuj, Wstaw i Usuń.</span><span class="sxs-lookup"><span data-stu-id="09042-179">Configure the ObjectDataSource to use the `ProductsBLL` class s `GetProductsByCategoryID(categoryID)` method and set the drop-down lists to (None) in the UPDATE, INSERT, and DELETE tabs.</span></span>

<span data-ttu-id="09042-180">[![użyć metody ProductsBLL Class s GetProductsByCategoryID (IDKategorii)](building-a-custom-database-driven-site-map-provider-vb/_static/image8.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="09042-180">[![Use the ProductsBLL Class s GetProductsByCategoryID(categoryID) Method](building-a-custom-database-driven-site-map-provider-vb/_static/image8.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image9.png)</span></span>

<span data-ttu-id="09042-181">**Ilustracja 8**. użyj metody `GetProductsByCategoryID(categoryID)` `ProductsBLL` Class (kliknij,[Aby wyświetlić obraz o pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-vb/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="09042-181">**Figure 8**: Use the `ProductsBLL` Class s `GetProductsByCategoryID(categoryID)` Method ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image10.png))</span></span>

<span data-ttu-id="09042-182">Ostatnim krokiem w Kreatorze konfiguracji źródła danych jest wyświetlanie danych źródłowych parametrów dla *IDkategorii*.</span><span class="sxs-lookup"><span data-stu-id="09042-182">The final step in the Configure Data Source wizard prompts for a parameter source for *categoryID*.</span></span> <span data-ttu-id="09042-183">Ponieważ te informacje są przesyłane za pośrednictwem pola QueryString `CategoryID`, z listy rozwijanej wybierz pozycję QueryString i wprowadź wartość IDKategorii w polu tekstowym QueryStringField, jak pokazano na rysunku 9.</span><span class="sxs-lookup"><span data-stu-id="09042-183">Since this information is passed through the querystring field `CategoryID`, select QueryString from the drop-down list and enter CategoryID in the QueryStringField textbox as shown in Figure 9.</span></span> <span data-ttu-id="09042-184">Kliknij przycisk Zakończ, aby zakończyć pracę kreatora.</span><span class="sxs-lookup"><span data-stu-id="09042-184">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="09042-185">[![użyć pola IDKategorii QueryString dla parametru IDKategorii](building-a-custom-database-driven-site-map-provider-vb/_static/image9.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="09042-185">[![Use the CategoryID Querystring Field for the categoryID Parameter](building-a-custom-database-driven-site-map-provider-vb/_static/image9.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image11.png)</span></span>

<span data-ttu-id="09042-186">**Rysunek 9**. użyj pola `CategoryID` QueryString dla parametru *IDkategorii* (kliknij,[Aby wyświetlić obraz o pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="09042-186">**Figure 9**: Use the `CategoryID` Querystring Field for the *categoryID* Parameter ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image12.png))</span></span>

<span data-ttu-id="09042-187">Po ukończeniu działania kreatora program Visual Studio doda odpowiednie BoundFields oraz CheckBoxField do widoku GridView dla pól danych produktu.</span><span class="sxs-lookup"><span data-stu-id="09042-187">After completing the wizard, Visual Studio will add corresponding BoundFields and a CheckBoxField to the GridView for the product data fields.</span></span> <span data-ttu-id="09042-188">Usuń wszystkie oprócz `ProductName`, `UnitPrice`i `SupplierName` BoundFields.</span><span class="sxs-lookup"><span data-stu-id="09042-188">Remove all but the `ProductName`, `UnitPrice`, and `SupplierName` BoundFields.</span></span> <span data-ttu-id="09042-189">Dostosuj te trzy BoundFields `HeaderText` właściwości, aby odczytywać odpowiednio produkt, cenę i dostawcę.</span><span class="sxs-lookup"><span data-stu-id="09042-189">Customize these three BoundFields `HeaderText` properties to read Product, Price, and Supplier, respectively.</span></span> <span data-ttu-id="09042-190">Sformatuj `UnitPrice` BoundField jako walutę.</span><span class="sxs-lookup"><span data-stu-id="09042-190">Format the `UnitPrice` BoundField as a currency.</span></span>

<span data-ttu-id="09042-191">Następnie Dodaj element HyperLinkField i przenieś go do pozycji z lewej strony.</span><span class="sxs-lookup"><span data-stu-id="09042-191">Next, add a HyperLinkField and move it to the left-most position.</span></span> <span data-ttu-id="09042-192">Ustaw jej Właściwość `Text`, aby wyświetlić szczegóły, jej Właściwość `DataNavigateUrlFields` do `ProductID`oraz jej Właściwość `DataNavigateUrlFormatString` do `~/SiteMapProvider/ProductDetails.aspx?ProductID={0}`.</span><span class="sxs-lookup"><span data-stu-id="09042-192">Set its `Text` property to View Details, its `DataNavigateUrlFields` property to `ProductID`, and its `DataNavigateUrlFormatString` property to `~/SiteMapProvider/ProductDetails.aspx?ProductID={0}`.</span></span>

![Dodaj szczegóły widoku HyperLinkField wskazujące ProductDetails. aspx](building-a-custom-database-driven-site-map-provider-vb/_static/image10.gif)

<span data-ttu-id="09042-194">**Ilustracja 10**. Dodawanie szczegółów widoku HyperLinkField, które wskazują `ProductDetails.aspx`</span><span class="sxs-lookup"><span data-stu-id="09042-194">**Figure 10**: Add a View Details HyperLinkField that Points to `ProductDetails.aspx`</span></span>

<span data-ttu-id="09042-195">Po wprowadzeniu tych dostosowań, znaczniki deklaratywne GridView i ObjectDataSource s powinny wyglądać podobnie do następujących:</span><span class="sxs-lookup"><span data-stu-id="09042-195">After making these customizations, the GridView and ObjectDataSource s declarative markup should resemble the following:</span></span>

[!code-aspx[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample3.aspx)]

<span data-ttu-id="09042-196">Wróć do wyświetlania `Default.aspx` za pomocą przeglądarki i kliknij link Wyświetl produkty dla napojów.</span><span class="sxs-lookup"><span data-stu-id="09042-196">Return to viewing `Default.aspx` through a browser and click on the View Products link for Beverages.</span></span> <span data-ttu-id="09042-197">Spowoduje to przejście do `ProductsByCategory.aspx?CategoryID=1`, wyświetlenie nazw, cen i dostawców produktów w bazie danych Northwind należących do kategorii napoje (patrz rysunek 11).</span><span class="sxs-lookup"><span data-stu-id="09042-197">This will take you to `ProductsByCategory.aspx?CategoryID=1`, displaying the names, prices, and suppliers of the products in the Northwind database that belong to the Beverages category (see Figure 11).</span></span> <span data-ttu-id="09042-198">Możesz bardziej ulepszyć Tę stronę, aby dołączyć łącze do strony z listą kategorii (`Default.aspx`) i formantem DetailsView lub FormView, który wyświetla wybraną nazwę kategorii i opis.</span><span class="sxs-lookup"><span data-stu-id="09042-198">Feel free to further enhance this page to include a link to return users to the category listing page (`Default.aspx`) and a DetailsView or FormView control that displays the selected category s name and description.</span></span>

<span data-ttu-id="09042-199">[![są wyświetlane nazwy napojów, ceny i dostawcy](building-a-custom-database-driven-site-map-provider-vb/_static/image11.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="09042-199">[![The Beverages Names, Prices, and Suppliers are Displayed](building-a-custom-database-driven-site-map-provider-vb/_static/image11.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image13.png)</span></span>

<span data-ttu-id="09042-200">**Rysunek 11**. wyświetlane są nazwy napojów, ceny i dostawcy ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-vb/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="09042-200">**Figure 11**: The Beverages Names, Prices, and Suppliers are Displayed ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image14.png))</span></span>

## <a name="step-4-showing-a-product-s-details"></a><span data-ttu-id="09042-201">Krok 4. Pokazywanie szczegółowych informacji o produkcie</span><span class="sxs-lookup"><span data-stu-id="09042-201">Step 4: Showing a Product s Details</span></span>

<span data-ttu-id="09042-202">Na ostatniej stronie `ProductDetails.aspx`wyświetlane są szczegóły wybranych produktów.</span><span class="sxs-lookup"><span data-stu-id="09042-202">The final page, `ProductDetails.aspx`, displays the selected products details.</span></span> <span data-ttu-id="09042-203">Otwórz `ProductDetails.aspx` i przeciągnij element DetailsView z przybornika do projektanta.</span><span class="sxs-lookup"><span data-stu-id="09042-203">Open `ProductDetails.aspx` and drag a DetailsView from the Toolbox onto the Designer.</span></span> <span data-ttu-id="09042-204">Ustaw właściwość DetailsView s `ID`, aby `ProductInfo` i wyczyścić `Height` i `Width` wartości właściwości.</span><span class="sxs-lookup"><span data-stu-id="09042-204">Set the DetailsView s `ID` property to `ProductInfo` and clear out its `Height` and `Width` property values.</span></span> <span data-ttu-id="09042-205">Z jego tagu inteligentnego Powiąż element DetailsView z nowym elementem ObjectDataSource o nazwie `ProductDataSource`, konfigurując element ObjectDataSource do ściągania danych z metody `GetProductByProductID(productID)` klasy `ProductsBLL`.</span><span class="sxs-lookup"><span data-stu-id="09042-205">From its smart tag, bind the DetailsView to a new ObjectDataSource named `ProductDataSource`, configuring the ObjectDataSource to pull its data from the `ProductsBLL` class s `GetProductByProductID(productID)` method.</span></span> <span data-ttu-id="09042-206">Podobnie jak w przypadku wcześniejszych stron sieci Web utworzonych w krokach 2 i 3, Ustaw listę rozwijaną na kartach Aktualizuj, Wstaw i Usuń do (brak).</span><span class="sxs-lookup"><span data-stu-id="09042-206">As with the previous web pages created in Steps 2 and 3, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>

<span data-ttu-id="09042-207">[![skonfigurować element ObjectDataSource do korzystania z metody GetProductByProductID (productID)](building-a-custom-database-driven-site-map-provider-vb/_static/image12.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="09042-207">[![Configure the ObjectDataSource to Use the GetProductByProductID(productID) Method](building-a-custom-database-driven-site-map-provider-vb/_static/image12.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image15.png)</span></span>

<span data-ttu-id="09042-208">**Ilustracja 12**. Konfigurowanie elementu ObjectDataSource do używania metody `GetProductByProductID(productID)` ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-vb/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="09042-208">**Figure 12**: Configure the ObjectDataSource to Use the `GetProductByProductID(productID)` Method ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image16.png))</span></span>

<span data-ttu-id="09042-209">Ostatnim krokiem w Kreatorze konfiguracji źródła danych jest wyświetlanie danych źródłowych parametru *ProductID* .</span><span class="sxs-lookup"><span data-stu-id="09042-209">The last step of the Configure Data Source wizard prompts for the source of the *productID* parameter.</span></span> <span data-ttu-id="09042-210">Ponieważ te dane pochodzą z pola QueryString `ProductID`, Ustaw listę rozwijaną na QueryString i pole tekstowe QueryStringField na ProductID.</span><span class="sxs-lookup"><span data-stu-id="09042-210">Since this data comes through the querystring field `ProductID`, set the drop-down list to QueryString and the QueryStringField textbox to ProductID.</span></span> <span data-ttu-id="09042-211">Na koniec kliknij przycisk Zakończ, aby zakończyć pracę kreatora.</span><span class="sxs-lookup"><span data-stu-id="09042-211">Finally, click the Finish button to complete the wizard.</span></span>

<span data-ttu-id="09042-212">[![skonfigurować parametr productID, aby ściągnąć jego wartość z pola IDProduktu QueryString](building-a-custom-database-driven-site-map-provider-vb/_static/image13.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="09042-212">[![Configure the productID Parameter to Pull its Value from the ProductID Querystring Field](building-a-custom-database-driven-site-map-provider-vb/_static/image13.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image17.png)</span></span>

<span data-ttu-id="09042-213">**Ilustracja 13**. Skonfiguruj parametr *ProductID* , aby ściągnąć jego wartość z pola `ProductID` QueryString ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="09042-213">**Figure 13**: Configure the *productID* Parameter to Pull its Value from the `ProductID` Querystring Field ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image18.png))</span></span>

<span data-ttu-id="09042-214">Po zakończeniu działania Kreatora konfiguracji źródła danych program Visual Studio utworzy odpowiednie BoundFields i CheckBoxField w widoku DetailsView dla pól danych produktu.</span><span class="sxs-lookup"><span data-stu-id="09042-214">After completing the Configure Data Source wizard, Visual Studio will create corresponding BoundFields and a CheckBoxField in the DetailsView for the product data fields.</span></span> <span data-ttu-id="09042-215">Usuń `ProductID`, `SupplierID`i `CategoryID` BoundFields i skonfiguruj pozostałe pola zgodnie z oczekiwaniami.</span><span class="sxs-lookup"><span data-stu-id="09042-215">Remove the `ProductID`, `SupplierID`, and `CategoryID` BoundFields and configure the remaining fields as you see fit.</span></span> <span data-ttu-id="09042-216">Po kilkuniu konfiguracji estetycznych, moje znaczniki deklaratywne i ObjectDataSource języka, wyglądały następująco:</span><span class="sxs-lookup"><span data-stu-id="09042-216">After a handful of aesthetic configurations, my DetailsView and ObjectDataSource s declarative markup looked like the following:</span></span>

[!code-aspx[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample4.aspx)]

<span data-ttu-id="09042-217">Aby przetestować Tę stronę, Wróć do `Default.aspx` i kliknij pozycję Wyświetl produkty dla kategorii napoje.</span><span class="sxs-lookup"><span data-stu-id="09042-217">To test this page, return to `Default.aspx` and click on View Products for the Beverages category.</span></span> <span data-ttu-id="09042-218">Z listy napojów produktów kliknij link Wyświetl szczegóły dla Chai herbata.</span><span class="sxs-lookup"><span data-stu-id="09042-218">From the listing of beverage products, click on the View Details link for Chai Tea.</span></span> <span data-ttu-id="09042-219">Spowoduje to przejście do `ProductDetails.aspx?ProductID=1`, w którym są wyświetlane szczegółowe informacje o Chai Tea (zobacz rysunek 14).</span><span class="sxs-lookup"><span data-stu-id="09042-219">This will take you to `ProductDetails.aspx?ProductID=1`, which shows a Chai Tea s details (see Figure 14).</span></span>

<span data-ttu-id="09042-220">[![Chai herbata, Kategoria, Cena i inne informacje są wyświetlane](building-a-custom-database-driven-site-map-provider-vb/_static/image14.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="09042-220">[![Chai Tea s Supplier, Category, Price, and Other Information is Displayed](building-a-custom-database-driven-site-map-provider-vb/_static/image14.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image19.png)</span></span>

<span data-ttu-id="09042-221">**Rysunek 14**: dostawca Chai herbata, Kategoria, Cena i inne informacje są wyświetlane ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-vb/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="09042-221">**Figure 14**: Chai Tea s Supplier, Category, Price, and Other Information is Displayed ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image20.png))</span></span>

## <a name="step-5-understanding-the-inner-workings-of-a-site-map-provider"></a><span data-ttu-id="09042-222">Krok 5. zrozumienie wewnętrznego działania dostawcy mapy witryny</span><span class="sxs-lookup"><span data-stu-id="09042-222">Step 5: Understanding the Inner Workings of a Site Map Provider</span></span>

<span data-ttu-id="09042-223">Mapa witryny jest reprezentowana w pamięci serwera sieci Web jako kolekcja wystąpień `SiteMapNode`, które tworzą hierarchię.</span><span class="sxs-lookup"><span data-stu-id="09042-223">The site map is represented in the web server s memory as a collection of `SiteMapNode` instances that form a hierarchy.</span></span> <span data-ttu-id="09042-224">Musi istnieć tylko jeden katalog główny, a wszystkie węzły inne niż główne muszą mieć dokładnie jeden węzeł nadrzędny, a wszystkie węzły mogą mieć dowolną liczbę elementów podrzędnych.</span><span class="sxs-lookup"><span data-stu-id="09042-224">There must be exactly one root, all non-root nodes must have exactly one parent node, and all nodes may have an arbitrary number of children.</span></span> <span data-ttu-id="09042-225">Każdy obiekt `SiteMapNode` reprezentuje sekcję w strukturze witryny sieci Web; te sekcje często mają odpowiednią stronę sieci Web.</span><span class="sxs-lookup"><span data-stu-id="09042-225">Each `SiteMapNode` object represents a section in the website s structure; these sections commonly have a corresponding web page.</span></span> <span data-ttu-id="09042-226">W związku z tym [klasa`SiteMapNode`](https://msdn.microsoft.com/library/system.web.sitemapnode.aspx) ma właściwości, takie jak `Title`, `Url`i `Description`, które zawierają informacje dotyczące sekcji, którą reprezentuje `SiteMapNode`.</span><span class="sxs-lookup"><span data-stu-id="09042-226">Consequently, the [`SiteMapNode` class](https://msdn.microsoft.com/library/system.web.sitemapnode.aspx) has properties like `Title`, `Url`, and `Description`, which provide information for the section the `SiteMapNode` represents.</span></span> <span data-ttu-id="09042-227">Istnieje również właściwość `Key`, która jednoznacznie identyfikuje poszczególne `SiteMapNode` w hierarchii, a także właściwości służące do ustanowienia tej hierarchii `ChildNodes`, `ParentNode`, `NextSibling`, `PreviousSibling`i tak dalej.</span><span class="sxs-lookup"><span data-stu-id="09042-227">There is also a `Key` property that uniquely identifies each `SiteMapNode` in the hierarchy, as well as properties used to establish this hierarchy `ChildNodes`, `ParentNode`, `NextSibling`, `PreviousSibling`, and so forth.</span></span>

<span data-ttu-id="09042-228">Rysunek 15 przedstawia ogólną strukturę mapy witryny na rysunku 1, ale z szczegółowymi informacjami o implementacji.</span><span class="sxs-lookup"><span data-stu-id="09042-228">Figure 15 shows the general site map structure from Figure 1, but with the implementation details sketched out in finer detail.</span></span>

<span data-ttu-id="09042-229">[![każda SiteMapNode ma właściwości, takie jak tytuł, adres URL, klucz i tak dalej.](building-a-custom-database-driven-site-map-provider-vb/_static/image16.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image15.gif)</span><span class="sxs-lookup"><span data-stu-id="09042-229">[![Each SiteMapNode has Properties Like Title, Url, Key, and So On](building-a-custom-database-driven-site-map-provider-vb/_static/image16.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image15.gif)</span></span>

<span data-ttu-id="09042-230">**Ilustracja 15**: Każda `SiteMapNode` ma właściwości, takie jak `Title`, `Url`, `Key`i tak dalej ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-vb/_static/image17.gif))</span><span class="sxs-lookup"><span data-stu-id="09042-230">**Figure 15**: Each `SiteMapNode` has Properties Like `Title`, `Url`, `Key`, and So On ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image17.gif))</span></span>

<span data-ttu-id="09042-231">Mapa witryny jest dostępna za pomocą [klasy`SiteMap`](https://msdn.microsoft.com/library/system.web.sitemap.aspx) w [przestrzeni nazw`System.Web`](https://msdn.microsoft.com/library/system.web.aspx).</span><span class="sxs-lookup"><span data-stu-id="09042-231">The site map is accessible through the [`SiteMap` class](https://msdn.microsoft.com/library/system.web.sitemap.aspx) in the [`System.Web` namespace](https://msdn.microsoft.com/library/system.web.aspx).</span></span> <span data-ttu-id="09042-232">Ta właściwość klasy s `RootNode` zwraca wystąpienie `SiteMapNode` głównej mapy witryny. `CurrentNode` zwraca `SiteMapNode`, którego właściwość `Url` pasuje do adresu URL aktualnie żądanej strony.</span><span class="sxs-lookup"><span data-stu-id="09042-232">This class s `RootNode` property returns the site map s root `SiteMapNode` instance; `CurrentNode` returns the `SiteMapNode` whose `Url` property matches the URL of the currently requested page.</span></span> <span data-ttu-id="09042-233">Ta klasa jest używana wewnętrznie przez kontrolki sieci Web ASP.NET 2,0 s nawigacji.</span><span class="sxs-lookup"><span data-stu-id="09042-233">This class is used internally by ASP.NET 2.0 s navigation Web controls.</span></span>

<span data-ttu-id="09042-234">Po uzyskaniu dostępu do właściwości `SiteMap` klasy s musi ona serializować strukturę mapy witryny z pewnego trwałego nośnika do pamięci.</span><span class="sxs-lookup"><span data-stu-id="09042-234">When the `SiteMap` class s properties are accessed, it must serialize the site map structure from some persistent medium into memory.</span></span> <span data-ttu-id="09042-235">Jednak logika serializacji mapy witryny nie jest sztywno zakodowana w klasie `SiteMap`.</span><span class="sxs-lookup"><span data-stu-id="09042-235">However, the site map serialization logic is not hard coded into the `SiteMap` class.</span></span> <span data-ttu-id="09042-236">Zamiast tego w czasie wykonywania Klasa `SiteMap` określa, który *dostawca* mapy lokacji ma być używany do serializacji.</span><span class="sxs-lookup"><span data-stu-id="09042-236">Instead, at runtime the `SiteMap` class determines which site map *provider* to use for serialization.</span></span> <span data-ttu-id="09042-237">Domyślnie używana jest [klasa`XmlSiteMapProvider`](https://msdn.microsoft.com/library/system.web.xmlsitemapprovider.aspx) , która odczytuje strukturę mapy lokacji z poprawnie sformatowanego pliku XML.</span><span class="sxs-lookup"><span data-stu-id="09042-237">By default, the [`XmlSiteMapProvider` class](https://msdn.microsoft.com/library/system.web.xmlsitemapprovider.aspx) is used, which reads the site map s structure from a properly-formatted XML file.</span></span> <span data-ttu-id="09042-238">Jednak w przypadku małej ilości pracy możemy utworzyć własnego niestandardowego dostawcę mapy witryny.</span><span class="sxs-lookup"><span data-stu-id="09042-238">However, with a little bit of work we can create our own custom site map provider.</span></span>

<span data-ttu-id="09042-239">Wszyscy dostawcy mapy witryny muszą pochodzić z [klasy`SiteMapProvider`](https://msdn.microsoft.com/library/system.web.sitemapprovider.aspx), która zawiera podstawowe metody i właściwości wymagane przez dostawców mapy witryny, ale pomija wiele szczegółów implementacji.</span><span class="sxs-lookup"><span data-stu-id="09042-239">All site map providers must be derived from the [`SiteMapProvider` class](https://msdn.microsoft.com/library/system.web.sitemapprovider.aspx), which includes the essential methods and properties needed for site map providers, but omits many of the implementation details.</span></span> <span data-ttu-id="09042-240">Druga klasa, [`StaticSiteMapProvider`](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.aspx), rozszerza klasę `SiteMapProvider` i zawiera bardziej niezawodną implementację wymaganej funkcjonalności.</span><span class="sxs-lookup"><span data-stu-id="09042-240">A second class, [`StaticSiteMapProvider`](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.aspx), extends the `SiteMapProvider` class and contains a more robust implementation of the needed functionality.</span></span> <span data-ttu-id="09042-241">Wewnętrznie w `StaticSiteMapProvider` są przechowywane `SiteMapNode` wystąpienia mapy witryny w `Hashtable` i przedstawiono metody, takie jak `AddNode(child, parent)`, `RemoveNode(siteMapNode),` i `Clear()`, które dodają i usuwają `SiteMapNode` s do wewnętrznej `Hashtable`.</span><span class="sxs-lookup"><span data-stu-id="09042-241">Internally, the `StaticSiteMapProvider` stores the `SiteMapNode` instances of the site map in a `Hashtable` and provides methods like `AddNode(child, parent)`, `RemoveNode(siteMapNode),` and `Clear()` that add and remove `SiteMapNode` s to the internal `Hashtable`.</span></span> <span data-ttu-id="09042-242">`XmlSiteMapProvider` pochodzi od `StaticSiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="09042-242">`XmlSiteMapProvider` is derived from `StaticSiteMapProvider`.</span></span>

<span data-ttu-id="09042-243">Podczas tworzenia niestandardowego dostawcy mapy witryny, który rozszerza `StaticSiteMapProvider`, istnieją dwie metody abstrakcyjne, które muszą zostać zastąpione: [`BuildSiteMap`](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.buildsitemap.aspx) i [`GetRootNodeCore`](https://msdn.microsoft.com/library/system.web.sitemapprovider.getrootnodecore.aspx).</span><span class="sxs-lookup"><span data-stu-id="09042-243">When creating a custom site map provider that extends `StaticSiteMapProvider`, there are two abstract methods that must be overridden: [`BuildSiteMap`](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.buildsitemap.aspx) and [`GetRootNodeCore`](https://msdn.microsoft.com/library/system.web.sitemapprovider.getrootnodecore.aspx).</span></span> <span data-ttu-id="09042-244">`BuildSiteMap`, zgodnie z jego nazwą, jest odpowiedzialny za ładowanie struktury mapy witryny z magazynu trwałego i konstruowanie jej w pamięci.</span><span class="sxs-lookup"><span data-stu-id="09042-244">`BuildSiteMap`, as its name implies, is responsible for loading the site map structure from persistent storage and constructing it in memory.</span></span> <span data-ttu-id="09042-245">`GetRootNodeCore` zwraca węzeł główny w mapie witryny.</span><span class="sxs-lookup"><span data-stu-id="09042-245">`GetRootNodeCore` returns the root node in the site map.</span></span>

<span data-ttu-id="09042-246">Zanim aplikacja sieci Web będzie mogła korzystać z dostawcy mapy witryny, musi być zarejestrowana w konfiguracji aplikacji.</span><span class="sxs-lookup"><span data-stu-id="09042-246">Before a web application can use a site map provider it must be registered in the application s configuration.</span></span> <span data-ttu-id="09042-247">Domyślnie Klasa `XmlSiteMapProvider` jest zarejestrowana przy użyciu nazwy `AspNetXmlSiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="09042-247">By default, the `XmlSiteMapProvider` class is registered using the name `AspNetXmlSiteMapProvider`.</span></span> <span data-ttu-id="09042-248">Aby zarejestrować dodatkowych dostawców mapy witryny, Dodaj następujące znaczniki do `Web.config`:</span><span class="sxs-lookup"><span data-stu-id="09042-248">To register additional site map providers, add the following markup to `Web.config`:</span></span>

[!code-xml[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample5.xml)]

<span data-ttu-id="09042-249">Wartość *Nazwa* przypisuje do dostawcy nazwę, którą można odczytać przez człowieka, podczas gdy *Typ* określa w pełni kwalifikowaną nazwę typu dostawcy mapy witryny.</span><span class="sxs-lookup"><span data-stu-id="09042-249">The *name* value assigns a human-readable name to the provider while *type* specifies the fully-qualified type name of the site map provider.</span></span> <span data-ttu-id="09042-250">Poszukamy konkretnych wartości *nazwy* i wartości *typów* w kroku 7, po utworzeniu niestandardowego dostawcy mapy witryny.</span><span class="sxs-lookup"><span data-stu-id="09042-250">We'll explore concrete values for the *name* and *type* values in Step 7, after we ve created our custom site map provider.</span></span>

<span data-ttu-id="09042-251">Klasa dostawcy mapy witryny jest tworzona przy pierwszym dostępie z klasy `SiteMap` i pozostaje w pamięci przez okres istnienia aplikacji sieci Web.</span><span class="sxs-lookup"><span data-stu-id="09042-251">The site map provider class is instantiated the first time it is accessed from the `SiteMap` class and remains in memory for the lifetime of the web application.</span></span> <span data-ttu-id="09042-252">Ponieważ istnieje tylko jedno wystąpienie dostawcy mapy witryny, które może zostać wywołane przez wielu osób odwiedzających witrynę sieci Web, konieczna jest *bezpieczna wątkowo*Metoda dostawcy.</span><span class="sxs-lookup"><span data-stu-id="09042-252">Since there is only one instance of the site map provider that may be invoked from multiple, concurrent web site visitors, it is imperative that the provider s methods be *thread-safe*.</span></span>

<span data-ttu-id="09042-253">Ze względu na wydajność i skalowalność należy pamiętać, że pamięć podręczna jest w pamięci podręcznej struktury mapy lokacji i zwrócić tę buforowaną strukturę zamiast tworzyć ją przy każdym wywołaniu metody `BuildSiteMap`.</span><span class="sxs-lookup"><span data-stu-id="09042-253">For performance and scalability reasons, it s important that we cache the in-memory site map structure and return this cached structure rather than recreating it every time the `BuildSiteMap` method is invoked.</span></span> <span data-ttu-id="09042-254">`BuildSiteMap` może być wywoływana kilka razy na żądanie strony dla użytkownika, w zależności od kontrolek nawigacyjnych używanych na stronie oraz głębokości struktury mapy witryny.</span><span class="sxs-lookup"><span data-stu-id="09042-254">`BuildSiteMap` may be called several times per page request per user, depending on the navigation controls in use on the page and the depth of the site map structure.</span></span> <span data-ttu-id="09042-255">W każdym przypadku, jeśli nie buforuje struktury mapy witryny w `BuildSiteMap` następnie przy każdym wywołaniu, należy ponownie pobrać informacje o produkcie i kategorii z architektury (co spowoduje wykonanie zapytania do bazy danych).</span><span class="sxs-lookup"><span data-stu-id="09042-255">In any case, if we do not cache the site map structure in `BuildSiteMap` then each time it is invoked we would need to re-retrieve the product and category information from the architecture (which would result in a query to the database).</span></span> <span data-ttu-id="09042-256">Zgodnie z opisem w poprzednich samouczkach buforowania dane buforowane mogą stać się przestarzałe.</span><span class="sxs-lookup"><span data-stu-id="09042-256">As we discussed in the previous caching tutorials, cached data can become stale.</span></span> <span data-ttu-id="09042-257">Aby to wymusić, możemy użyć wygaśnięcia opartych na zależnościach czasu lub w pamięci podręcznej SQL.</span><span class="sxs-lookup"><span data-stu-id="09042-257">To combat this, we can use either time- or SQL cache dependency-based expiries.</span></span>

> [!NOTE]
> <span data-ttu-id="09042-258">Dostawca mapy witryny może opcjonalnie zastąpić [metodę`Initialize`](https://msdn.microsoft.com/library/system.web.sitemapprovider.initialize.aspx).</span><span class="sxs-lookup"><span data-stu-id="09042-258">A site map provider may optionally override the [`Initialize` method](https://msdn.microsoft.com/library/system.web.sitemapprovider.initialize.aspx).</span></span> <span data-ttu-id="09042-259">`Initialize` jest wywoływany podczas pierwszego wystąpienia dostawcy mapy witryny i jest on przeszukiwany wszystkie atrybuty niestandardowe przypisane do dostawcy w `Web.config` w `<add>` elementu, takie jak: `<add name="name" type="type" customAttribute="value" />`.</span><span class="sxs-lookup"><span data-stu-id="09042-259">`Initialize` is invoked when the site map provider is first instantiated and is passed any custom attributes assigned to the provider in `Web.config` in the `<add>` element like: `<add name="name" type="type" customAttribute="value" />`.</span></span> <span data-ttu-id="09042-260">Jest to przydatne, jeśli chcesz zezwolić deweloperowi na określanie różnych ustawień związanych z dostawcą mapy witryny, bez konieczności modyfikowania kodu dostawcy.</span><span class="sxs-lookup"><span data-stu-id="09042-260">It is useful if you want to allow a page developer to specify various site map provider-related settings without having to modify the provider s code.</span></span> <span data-ttu-id="09042-261">Na przykład w przypadku odczytywania danych kategorii i produktów bezpośrednio z bazy danych, w przeciwieństwie do architektury, firma Microsoft chce pozwolić, aby deweloper strony określił parametry połączenia bazy danych za pośrednictwem `Web.config` zamiast korzystać z zakodowanej wartości w kodzie dostawcy.</span><span class="sxs-lookup"><span data-stu-id="09042-261">For example, if we were reading the category and products data directly from the database as opposed to through the architecture, we d likely want to let the page developer specify the database connection string through `Web.config` rather than using a hard coded value in the provider s code.</span></span> <span data-ttu-id="09042-262">Niestandardowy dostawca mapy witryny zostanie skompilowany w kroku 6 nie przesłania tej metody `Initialize`.</span><span class="sxs-lookup"><span data-stu-id="09042-262">The custom site map provider we'll build in Step 6 does not override this `Initialize` method.</span></span> <span data-ttu-id="09042-263">Przykład użycia metody `Initialize` można znaleźć w artykule [Jan Prosise](http://www.wintellect.com/Weblogs/CategoryView,category,Jeff%20Prosise.aspx) s [przechowującym mapy witryn w programie SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) .</span><span class="sxs-lookup"><span data-stu-id="09042-263">For an example of using the `Initialize` method, refer to [Jeff Prosise](http://www.wintellect.com/Weblogs/CategoryView,category,Jeff%20Prosise.aspx) s [Storing Site Maps in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) article.</span></span>

## <a name="step-6-creating-the-custom-site-map-provider"></a><span data-ttu-id="09042-264">Krok 6. Tworzenie niestandardowego dostawcy mapy witryny</span><span class="sxs-lookup"><span data-stu-id="09042-264">Step 6: Creating the Custom Site Map Provider</span></span>

<span data-ttu-id="09042-265">Aby utworzyć niestandardowego dostawcę mapy witryny, który kompiluje mapę witryny z kategorii i produktów w bazie danych Northwind, musimy utworzyć klasę rozszerzającą `StaticSiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="09042-265">To create a custom site map provider that builds the site map from the categories and products in the Northwind database, we need to create a class that extends `StaticSiteMapProvider`.</span></span> <span data-ttu-id="09042-266">W kroku 1 zażądano dodania folderu `CustomProviders` w folderze `App_Code` — Dodaj nową klasę do tego folderu o nazwie `NorthwindSiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="09042-266">In Step 1 I asked you to add a `CustomProviders` folder in the `App_Code` folder - add a new class to this folder named `NorthwindSiteMapProvider`.</span></span> <span data-ttu-id="09042-267">Dodaj następujący kod do klasy `NorthwindSiteMapProvider`:</span><span class="sxs-lookup"><span data-stu-id="09042-267">Add the following code to the `NorthwindSiteMapProvider` class:</span></span>

[!code-vb[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample6.vb)]

<span data-ttu-id="09042-268">Niech Rozpocznij od eksplorowania tej klasy `BuildSiteMap` Metoda, która rozpoczyna się od [instrukcji`lock`](https://msdn.microsoft.com/library/c5kehkcz.aspx).</span><span class="sxs-lookup"><span data-stu-id="09042-268">Let s start with exploring this class s `BuildSiteMap` method, which starts with a [`lock` statement](https://msdn.microsoft.com/library/c5kehkcz.aspx).</span></span> <span data-ttu-id="09042-269">Instrukcja `lock` zezwala tylko jednemu wątkowi na wprowadzenie, a tym samym serializacji dostęp do jego kodu i uniemożliwia dwa współbieżne wątki przed przechodzeniem na jeden inny wyglądają.</span><span class="sxs-lookup"><span data-stu-id="09042-269">The `lock` statement only allows one thread at a time to enter, thereby serializing access to its code and preventing two concurrent threads from stepping on one another s toes.</span></span>

<span data-ttu-id="09042-270">Zmienna `SiteMapNode` na poziomie klasy `root` służy do buforowania struktury mapy witryny.</span><span class="sxs-lookup"><span data-stu-id="09042-270">The class-level `SiteMapNode` variable `root` is used to cache the site map structure.</span></span> <span data-ttu-id="09042-271">Gdy mapa witryny jest tworzona po raz pierwszy lub po raz pierwszy po zmodyfikowaniu danych źródłowych, `root` zostanie `Nothing`, a struktura mapy witryny zostanie skonstruowana.</span><span class="sxs-lookup"><span data-stu-id="09042-271">When the site map is constructed for the first time, or for the first time after the underlying data has been modified, `root` will be `Nothing` and the site map structure will be constructed.</span></span> <span data-ttu-id="09042-272">Węzeł główny mapy witryny jest przypisywany do `root` podczas procesu konstruowania, dzięki czemu przy następnym wywołaniu tej metody `root` nie będzie `Nothing`.</span><span class="sxs-lookup"><span data-stu-id="09042-272">The site map s root node is assigned to `root` during the construction process so that the next time this method is called, `root` will not be `Nothing`.</span></span> <span data-ttu-id="09042-273">W związku z tym, tak długo, jak `root` nie jest `Nothing` struktura mapy witryny zostanie zwrócona do obiektu wywołującego bez konieczności ponownego tworzenia.</span><span class="sxs-lookup"><span data-stu-id="09042-273">Consequently, so long as `root` is not `Nothing` the site map structure will be returned to the caller without having to recreate it.</span></span>

<span data-ttu-id="09042-274">Jeśli katalog główny jest `Nothing`, struktura mapy witryny jest tworzona na podstawie informacji o produkcie i kategorii.</span><span class="sxs-lookup"><span data-stu-id="09042-274">If root is `Nothing`, the site map structure is created from the product and category information.</span></span> <span data-ttu-id="09042-275">Mapę witryny można utworzyć, tworząc `SiteMapNode` wystąpienia, a następnie tworząc hierarchię za pomocą wywołań do metody `StaticSiteMapProvider` klasy s `AddNode`.</span><span class="sxs-lookup"><span data-stu-id="09042-275">The site map is built by creating the `SiteMapNode` instances and then forming the hierarchy through calls to the `StaticSiteMapProvider` class s `AddNode` method.</span></span> <span data-ttu-id="09042-276">`AddNode` wykonuje wewnętrzne Księgowość, przechowując wystąpienia `SiteMapNode` w `Hashtable`.</span><span class="sxs-lookup"><span data-stu-id="09042-276">`AddNode` performs the internal bookkeeping, storing the assorted `SiteMapNode` instances in a `Hashtable`.</span></span> <span data-ttu-id="09042-277">Przed rozpoczęciem konstruowania hierarchii rozpoczynamy od wywołania metody `Clear`, która czyści elementy z `Hashtable`wewnętrznej.</span><span class="sxs-lookup"><span data-stu-id="09042-277">Before we start constructing the hierarchy, we start by calling the `Clear` method, which clears out the elements from the internal `Hashtable`.</span></span> <span data-ttu-id="09042-278">Następnie Metoda `ProductsBLL` klasy s `GetProducts` i `ProductsDataTable` wyniki są przechowywane w zmiennych lokalnych.</span><span class="sxs-lookup"><span data-stu-id="09042-278">Next, the `ProductsBLL` class s `GetProducts` method and the resulting `ProductsDataTable` are stored in local variables.</span></span>

<span data-ttu-id="09042-279">Konstrukcja mapy witryny rozpocznie się, tworząc węzeł główny i przypisując go do `root`.</span><span class="sxs-lookup"><span data-stu-id="09042-279">The site map s construction begins by creating the root node and assigning it to `root`.</span></span> <span data-ttu-id="09042-280">Przeciążanie [konstruktora`SiteMapNode` s](https://msdn.microsoft.com/library/system.web.sitemapnode.sitemapnode.aspx) użyte w tym miejscu i w tym `BuildSiteMap` jest przenoszone następujące informacje:</span><span class="sxs-lookup"><span data-stu-id="09042-280">The overload of the [`SiteMapNode` s constructor](https://msdn.microsoft.com/library/system.web.sitemapnode.sitemapnode.aspx) used here and throughout this `BuildSiteMap` is passed the following information:</span></span>

- <span data-ttu-id="09042-281">Odwołanie do dostawcy mapy witryny (`Me`).</span><span class="sxs-lookup"><span data-stu-id="09042-281">A reference to the site map provider (`Me`).</span></span>
- <span data-ttu-id="09042-282">`Key``SiteMapNode`.</span><span class="sxs-lookup"><span data-stu-id="09042-282">The `SiteMapNode` s `Key`.</span></span> <span data-ttu-id="09042-283">Ta wymagana wartość musi być unikatowa dla każdego `SiteMapNode`.</span><span class="sxs-lookup"><span data-stu-id="09042-283">This required value must be unique for each `SiteMapNode`.</span></span>
- <span data-ttu-id="09042-284">`Url``SiteMapNode`.</span><span class="sxs-lookup"><span data-stu-id="09042-284">The `SiteMapNode` s `Url`.</span></span> <span data-ttu-id="09042-285">`Url` jest opcjonalne, ale jeśli zostały podane, każda `SiteMapNode` `Url` wartość musi być unikatowa.</span><span class="sxs-lookup"><span data-stu-id="09042-285">`Url` is optional, but if provided, each `SiteMapNode` s `Url` value must be unique.</span></span>
- <span data-ttu-id="09042-286">Wymagany `Title``SiteMapNode` s.</span><span class="sxs-lookup"><span data-stu-id="09042-286">The `SiteMapNode` s `Title`, which is required.</span></span>

<span data-ttu-id="09042-287">Wywołanie metody `AddNode(root)` dodaje `root` `SiteMapNode` do mapy witryny jako element główny.</span><span class="sxs-lookup"><span data-stu-id="09042-287">The `AddNode(root)` method call adds the `SiteMapNode` `root` to the site map as the root.</span></span> <span data-ttu-id="09042-288">Następnie zostaną wyliczone wszystkie `ProductRow` w `ProductsDataTable`.</span><span class="sxs-lookup"><span data-stu-id="09042-288">Next, each `ProductRow` in the `ProductsDataTable` is enumerated.</span></span> <span data-ttu-id="09042-289">Jeśli istnieje już `SiteMapNode` dla kategorii Current Product, odwołanie jest przywoływane.</span><span class="sxs-lookup"><span data-stu-id="09042-289">If there already exists a `SiteMapNode` for the current product s category, it is referenced.</span></span> <span data-ttu-id="09042-290">W przeciwnym razie nowy `SiteMapNode` kategorii zostanie utworzony i dodany jako element podrzędny `SiteMapNode``root` za pomocą wywołania metody `AddNode(categoryNode, root)`.</span><span class="sxs-lookup"><span data-stu-id="09042-290">Otherwise, a new `SiteMapNode` for the category is created and added as a child of the `SiteMapNode``root` through the `AddNode(categoryNode, root)` method call.</span></span> <span data-ttu-id="09042-291">Po znalezieniu lub utworzeniu odpowiedniej kategorii `SiteMapNode` węźle zostanie utworzony `SiteMapNode` dla bieżącego produktu i dodany jako element podrzędny kategorii `SiteMapNode` za pośrednictwem `AddNode(productNode, categoryNode)`.</span><span class="sxs-lookup"><span data-stu-id="09042-291">After the appropriate category `SiteMapNode` node has been found or created, a `SiteMapNode` is created for the current product and added as a child of the category `SiteMapNode` via `AddNode(productNode, categoryNode)`.</span></span> <span data-ttu-id="09042-292">Należy zauważyć, że Kategoria `SiteMapNode` s `Url` wartość właściwości jest `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID`, podczas gdy produktu `SiteMapNode` s `Url` zostanie przypisany `~/SiteMapNode/ProductDetails.aspx?ProductID=productID`.</span><span class="sxs-lookup"><span data-stu-id="09042-292">Note that the category `SiteMapNode` s `Url` property value is `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID` while the product `SiteMapNode` s `Url` property is assigned `~/SiteMapNode/ProductDetails.aspx?ProductID=productID`.</span></span>

> [!NOTE]
> <span data-ttu-id="09042-293">Te produkty, które mają `NULL` wartość bazy danych dla ich `CategoryID` są pogrupowane w kategorii `SiteMapNode` której Właściwość `Title` ma wartość None, a właściwość `Url` jest ustawiona na pusty ciąg.</span><span class="sxs-lookup"><span data-stu-id="09042-293">Those products that have a database `NULL` value for their `CategoryID` are grouped under a category `SiteMapNode` whose `Title` property is set to None and whose `Url` property is set to an empty string.</span></span> <span data-ttu-id="09042-294">Zdecydowałem się ustawić `Url` na pusty ciąg, ponieważ metoda `ProductBLL` klasy `GetProductsByCategory(categoryID)` s nie ma obecnie możliwości zwrócenia tylko tych produktów z `NULL` `CategoryID` wartością.</span><span class="sxs-lookup"><span data-stu-id="09042-294">I decided to set `Url` to an empty string since the `ProductBLL` class s `GetProductsByCategory(categoryID)` method currently lacks the capability to return just those products with a `NULL` `CategoryID` value.</span></span> <span data-ttu-id="09042-295">Warto również zademonstrować, jak kontrolki nawigacji renderują `SiteMapNode`, które nie mają wartości właściwości `Url`.</span><span class="sxs-lookup"><span data-stu-id="09042-295">Also, I wanted to demonstrate how the navigation controls render a `SiteMapNode` that lacks a value for its `Url` property.</span></span> <span data-ttu-id="09042-296">Zachęcam do rozbudowania tego samouczka, tak aby Właściwość none `SiteMapNode` s `Url` wskazywała na `ProductsByCategory.aspx`, ale tylko te produkty mające `NULL` `CategoryID` wartości.</span><span class="sxs-lookup"><span data-stu-id="09042-296">I encourage you to extend this tutorial so that the None `SiteMapNode` s `Url` property points to `ProductsByCategory.aspx`, yet only displays the products with `NULL` `CategoryID` values.</span></span>

<span data-ttu-id="09042-297">Po skonstruowaniu mapy witryny do pamięci podręcznej danych zostanie dodany dowolny obiekt, przy użyciu zależności pamięci podręcznej SQL `Categories` i `Products` tabelach za pośrednictwem obiektu `AggregateCacheDependency`.</span><span class="sxs-lookup"><span data-stu-id="09042-297">After constructing the site map, an arbitrary object is added to the data cache using a SQL cache dependency on the `Categories` and `Products` tables through an `AggregateCacheDependency` object.</span></span> <span data-ttu-id="09042-298">Wiemy, jak korzystać z zależności w pamięci podręcznej SQL w poprzednim samouczku, *przy użyciu zależności pamięci podręcznej SQL*.</span><span class="sxs-lookup"><span data-stu-id="09042-298">We explored using SQL cache dependencies in the preceding tutorial, *Using SQL Cache Dependencies*.</span></span> <span data-ttu-id="09042-299">Dostawca niestandardowego mapowania witryn używa jednak przeciążenia metody `Insert`ej pamięci podręcznej danych, która nie została jeszcze zaeksplorowania.</span><span class="sxs-lookup"><span data-stu-id="09042-299">The custom site map provider, however, uses an overload of the data cache s `Insert` method that we ve yet to explore.</span></span> <span data-ttu-id="09042-300">To przeciążenie przyjmuje jako końcowy parametr wejściowy delegata, który jest wywoływany, gdy obiekt zostanie usunięty z pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="09042-300">This overload accepts as its final input parameter a delegate that is called when the object is removed from the cache.</span></span> <span data-ttu-id="09042-301">W każdym przypadku przekazujemy nowe [`CacheItemRemovedCallback` delegata](https://msdn.microsoft.com/library/system.web.caching.cacheitemremovedcallback.aspx) wskazujące na metodę `OnSiteMapChanged` zdefiniowana w dalszej części klasy `NorthwindSiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="09042-301">Specifically, we pass in a new [`CacheItemRemovedCallback` delegate](https://msdn.microsoft.com/library/system.web.caching.cacheitemremovedcallback.aspx) that points to the `OnSiteMapChanged` method defined further down in the `NorthwindSiteMapProvider` class.</span></span>

> [!NOTE]
> <span data-ttu-id="09042-302">Reprezentacja mapy witryny w pamięci jest buforowana przez zmienną na poziomie klasy `root`.</span><span class="sxs-lookup"><span data-stu-id="09042-302">The in-memory representation of the site map is cached through the class-level variable `root`.</span></span> <span data-ttu-id="09042-303">Ponieważ istnieje tylko jedno wystąpienie niestandardowej klasy dostawcy mapy witryny i ponieważ to wystąpienie jest współużytkowane przez wszystkie wątki w aplikacji sieci Web, ta zmienna klasy służy jako pamięć podręczna.</span><span class="sxs-lookup"><span data-stu-id="09042-303">Since there is only one instance of the custom site map provider class and since that instance is shared among all threads in the web application, this class variable serves as a cache.</span></span> <span data-ttu-id="09042-304">Metoda `BuildSiteMap` używa również pamięci podręcznej danych, ale tylko jako środek do odbierania powiadomień, gdy dane źródłowe bazy danych w `Categories` lub tabelach `Products` zmienią się.</span><span class="sxs-lookup"><span data-stu-id="09042-304">The `BuildSiteMap` method also uses the data cache, but only as a means to receive notification when the underlying database data in the `Categories` or `Products` tables changes.</span></span> <span data-ttu-id="09042-305">Należy pamiętać, że wartość wprowadzona w pamięci podręcznej danych jest tylko bieżącą datą i godziną.</span><span class="sxs-lookup"><span data-stu-id="09042-305">Note that the value put into the data cache is just the current date and time.</span></span> <span data-ttu-id="09042-306">Rzeczywiste dane mapy witryny *nie* są umieszczane w pamięci podręcznej danych.</span><span class="sxs-lookup"><span data-stu-id="09042-306">The actual site map data is *not* put in the data cache.</span></span>

<span data-ttu-id="09042-307">Metoda `BuildSiteMap` zostanie zakończona, zwracając węzeł główny mapy witryny.</span><span class="sxs-lookup"><span data-stu-id="09042-307">The `BuildSiteMap` method completes by returning the root node of the site map.</span></span>

<span data-ttu-id="09042-308">Pozostałe metody są dość proste.</span><span class="sxs-lookup"><span data-stu-id="09042-308">The remaining methods are fairly straightforward.</span></span> <span data-ttu-id="09042-309">`GetRootNodeCore` jest odpowiedzialny za zwracanie węzła głównego.</span><span class="sxs-lookup"><span data-stu-id="09042-309">`GetRootNodeCore` is responsible for returning the root node.</span></span> <span data-ttu-id="09042-310">Ponieważ `BuildSiteMap` zwraca element główny, `GetRootNodeCore` po prostu zwraca wartość zwracaną `BuildSiteMap` s.</span><span class="sxs-lookup"><span data-stu-id="09042-310">Since `BuildSiteMap` returns the root, `GetRootNodeCore` simply returns `BuildSiteMap` s return value.</span></span> <span data-ttu-id="09042-311">Metoda `OnSiteMapChanged` ustawia `root` z powrotem na `Nothing` po usunięciu elementu pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="09042-311">The `OnSiteMapChanged` method sets `root` back to `Nothing` when the cache item is removed.</span></span> <span data-ttu-id="09042-312">Po powrocie do `Nothing`przy następnym czasie `BuildSiteMap` jest wywoływana, struktura mapy witryny zostanie odbudowana.</span><span class="sxs-lookup"><span data-stu-id="09042-312">With root set back to `Nothing`, the next time `BuildSiteMap` is invoked, the site map structure will be rebuilt.</span></span> <span data-ttu-id="09042-313">Na koniec Właściwość `CachedDate` zwraca wartość daty i godziny przechowywanej w pamięci podręcznej danych, jeśli taka wartość istnieje.</span><span class="sxs-lookup"><span data-stu-id="09042-313">Lastly, the `CachedDate` property returns the date and time value stored in the data cache, if such a value exists.</span></span> <span data-ttu-id="09042-314">Ta właściwość może być używana przez dewelopera strony do określania, kiedy dane mapy lokacji były ostatnio buforowane.</span><span class="sxs-lookup"><span data-stu-id="09042-314">This property can be used by a page developer to determine when the site map data was last cached.</span></span>

## <a name="step-7-registering-thenorthwindsitemapprovider"></a><span data-ttu-id="09042-315">Krok 7: rejestrowanie`NorthwindSiteMapProvider`</span><span class="sxs-lookup"><span data-stu-id="09042-315">Step 7: Registering the`NorthwindSiteMapProvider`</span></span>

<span data-ttu-id="09042-316">Aby nasza aplikacja sieci Web korzystała z dostawcy mapy witryny `NorthwindSiteMapProvider` utworzonego w kroku 6, należy zarejestrować go w sekcji `<siteMap>` w `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="09042-316">In order for our web application to use the `NorthwindSiteMapProvider` site map provider created in Step 6, we need to register it in the `<siteMap>` section of `Web.config`.</span></span> <span data-ttu-id="09042-317">W tym celu Dodaj następujące znaczniki w `<system.web>` elementu w `Web.config`:</span><span class="sxs-lookup"><span data-stu-id="09042-317">Specifically, add the following markup within the `<system.web>` element in `Web.config`:</span></span>

[!code-xml[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample7.xml)]

<span data-ttu-id="09042-318">Ten znacznik wykonuje dwie czynności: po pierwsze wskazuje, że wbudowana `AspNetXmlSiteMapProvider` jest domyślnym dostawcą mapy witryny; Po drugie rejestruje niestandardowego dostawcę mapy witryny utworzonego w kroku 6 z przyjazną dla człowieka nazwą Northwind.</span><span class="sxs-lookup"><span data-stu-id="09042-318">This markup does two things: first, it indicates that the built-in `AspNetXmlSiteMapProvider` is the default site map provider; second, it registers the custom site map provider created in Step 6 with the human-friendly name Northwind .</span></span>

> [!NOTE]
> <span data-ttu-id="09042-319">W przypadku dostawców mapy witryny znajdujących się w folderze `App_Code` aplikacji wartość atrybutu `type` jest po prostu nazwą klasy.</span><span class="sxs-lookup"><span data-stu-id="09042-319">For site map providers located in the application s `App_Code` folder, the value of the `type` attribute is simply the class name.</span></span> <span data-ttu-id="09042-320">Alternatywnie można utworzyć niestandardowego dostawcę mapy witryny w osobnym projekcie biblioteki klas z skompilowanym zestawem umieszczonym w katalogu aplikacji sieci Web `/Bin`.</span><span class="sxs-lookup"><span data-stu-id="09042-320">Alternatively, the custom site map provider could have been created in a separate Class Library project with the compiled assembly placed in the web application s `/Bin` directory.</span></span> <span data-ttu-id="09042-321">W takim przypadku `type` wartością atrybutu będzie *przestrzeń nazw*. *ClassName*, *AssemblyName* .</span><span class="sxs-lookup"><span data-stu-id="09042-321">In that case, the `type` attribute value would be *Namespace*.*ClassName*, *AssemblyName* .</span></span>

<span data-ttu-id="09042-322">Po aktualizacji `Web.config`Poświęć chwilę na wyświetlenie dowolnej strony z samouczków w przeglądarce.</span><span class="sxs-lookup"><span data-stu-id="09042-322">After updating `Web.config`, take a moment to view any page from the tutorials in a browser.</span></span> <span data-ttu-id="09042-323">Należy pamiętać, że interfejs nawigacji po lewej stronie nadal pokazuje sekcje i samouczki zdefiniowane w `Web.sitemap`.</span><span class="sxs-lookup"><span data-stu-id="09042-323">Note that the navigation interface on the left still shows the sections and tutorials defined in `Web.sitemap`.</span></span> <span data-ttu-id="09042-324">Jest to spowodowane tym, że `AspNetXmlSiteMapProvider` jako domyślny dostawca.</span><span class="sxs-lookup"><span data-stu-id="09042-324">This is because we left `AspNetXmlSiteMapProvider` as the default provider.</span></span> <span data-ttu-id="09042-325">Aby utworzyć element interfejsu użytkownika nawigacji, który używa `NorthwindSiteMapProvider`, należy jawnie określić, że powinien być używany dostawca mapy witryny Northwind.</span><span class="sxs-lookup"><span data-stu-id="09042-325">In order to create a navigation user interface element that uses the `NorthwindSiteMapProvider`, we'll need to explicitly specify that the Northwind site map provider should be used.</span></span> <span data-ttu-id="09042-326">Zobaczmy, jak to zrobić w kroku 8.</span><span class="sxs-lookup"><span data-stu-id="09042-326">We'll see how to accomplish this in Step 8.</span></span>

## <a name="step-8-displaying-site-map-information-using-the-custom-site-map-provider"></a><span data-ttu-id="09042-327">Krok 8. Wyświetlanie informacji o mapie witryny przy użyciu niestandardowego dostawcy mapy witryny</span><span class="sxs-lookup"><span data-stu-id="09042-327">Step 8: Displaying Site Map Information Using the Custom Site Map Provider</span></span>

<span data-ttu-id="09042-328">Po utworzeniu niestandardowego dostawcy mapy witryny i zarejestrowaniu go w `Web.config`ponownie przygotujemy do dodania kontrolek nawigacji do stron `Default.aspx`, `ProductsByCategory.aspx`i `ProductDetails.aspx` w folderze `SiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="09042-328">With the custom site map provider created and registered in `Web.config`, we re ready to add navigation controls to the `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages in the `SiteMapProvider` folder.</span></span> <span data-ttu-id="09042-329">Zacznij od otworzenia strony `Default.aspx` i przeciągnij `SiteMapPath` z przybornika na projektanta.</span><span class="sxs-lookup"><span data-stu-id="09042-329">Start by opening the `Default.aspx` page and drag a `SiteMapPath` from the Toolbox onto the Designer.</span></span> <span data-ttu-id="09042-330">Kontrolka ścieżki mapy witryny znajduje się w sekcji nawigacji w przyborniku.</span><span class="sxs-lookup"><span data-stu-id="09042-330">The SiteMapPath control is located in the Navigation section of the Toolbox.</span></span>

<span data-ttu-id="09042-331">[![dodać ścieżki mapy witryny do default. aspx](building-a-custom-database-driven-site-map-provider-vb/_static/image19.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image18.gif)</span><span class="sxs-lookup"><span data-stu-id="09042-331">[![Add a SiteMapPath to Default.aspx](building-a-custom-database-driven-site-map-provider-vb/_static/image19.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image18.gif)</span></span>

<span data-ttu-id="09042-332">**Ilustracja 16**. Dodawanie ścieżki mapy witryny do `Default.aspx` ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-vb/_static/image20.gif))</span><span class="sxs-lookup"><span data-stu-id="09042-332">**Figure 16**: Add a SiteMapPath to `Default.aspx` ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image20.gif))</span></span>

<span data-ttu-id="09042-333">Kontrolka ścieżki mapy witryny wyświetla pasek nawigacyjny wskazujący bieżącą lokalizację strony w ramach mapy witryny.</span><span class="sxs-lookup"><span data-stu-id="09042-333">The SiteMapPath control displays a breadcrumb, indicating the current page s location within the site map.</span></span> <span data-ttu-id="09042-334">Dodaliśmy ścieżki mapy witryny w górnej części strony wzorcowej z powrotem na *stronach wzorcowych i* w samouczku nawigacji po witrynie.</span><span class="sxs-lookup"><span data-stu-id="09042-334">We added a SiteMapPath to the top of the master page back in the *Master Pages and Site Navigation* tutorial.</span></span>

<span data-ttu-id="09042-335">Poświęć chwilę na wyświetlenie tej strony za pomocą przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="09042-335">Take a moment to view this page through a browser.</span></span> <span data-ttu-id="09042-336">Ścieżki mapy witryny dodany na rysunku 16 używa domyślnego dostawcy mapy witryny, pobierając jego dane z `Web.sitemap`.</span><span class="sxs-lookup"><span data-stu-id="09042-336">The SiteMapPath added in Figure 16 uses the default site map provider, pulling its data from `Web.sitemap`.</span></span> <span data-ttu-id="09042-337">W związku z tym, w obszarze nawigacji znajdują się główne &gt; dostosowywania mapy witryny, podobnie jak w przypadku stron nadrzędnych w prawym górnym rogu.</span><span class="sxs-lookup"><span data-stu-id="09042-337">Therefore, the breadcrumb shows Home &gt; Customizing the Site Map, just like the breadcrumb in the upper-right corner.</span></span>

<span data-ttu-id="09042-338">[![pasek nawigacyjny używa domyślnego dostawcy mapy witryny](building-a-custom-database-driven-site-map-provider-vb/_static/image22.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image21.gif)</span><span class="sxs-lookup"><span data-stu-id="09042-338">[![The Breadcrumb Uses the Default Site Map Provider](building-a-custom-database-driven-site-map-provider-vb/_static/image22.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image21.gif)</span></span>

<span data-ttu-id="09042-339">**Ilustracja 17**. pasek nawigacyjny używa domyślnego dostawcy mapy witryny ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-vb/_static/image23.gif))</span><span class="sxs-lookup"><span data-stu-id="09042-339">**Figure 17**: The Breadcrumb Uses the Default Site Map Provider ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image23.gif))</span></span>

<span data-ttu-id="09042-340">Aby dodać ścieżki mapy witryny (rysunek 16), Użyj niestandardowego dostawcy mapy witryny, który został utworzony w kroku 6, ustaw jego [właściwość`SiteMapProvider`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sitemappath.sitemapprovider.aspx) na Northwind, nazwę, którą przypisano do `NorthwindSiteMapProvider` w `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="09042-340">To have the SiteMapPath added in Figure 16 use the custom site map provider we created in Step 6, set its [`SiteMapProvider` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sitemappath.sitemapprovider.aspx) to Northwind, the name we assigned to the `NorthwindSiteMapProvider` in `Web.config`.</span></span> <span data-ttu-id="09042-341">Niestety, Projektant nadal korzysta z domyślnego dostawcy mapy witryny, ale jeśli zostanie wyświetlona strona za pośrednictwem przeglądarki po wprowadzeniu tej zmiany właściwości, zobaczysz, że na tym pasku nawigacyjnym jest teraz używany niestandardowy dostawca mapy witryny.</span><span class="sxs-lookup"><span data-stu-id="09042-341">Unfortunately, the Designer continues to use the default site map provider, but if you visit the page through a browser after making this property change you'll see that the breadcrumb now uses the custom site map provider.</span></span>

<span data-ttu-id="09042-342">[![do stron nadrzędnych jest teraz stosowana niestandardowa NorthwindSiteMapProvider dostawcy mapy witryny](building-a-custom-database-driven-site-map-provider-vb/_static/image25.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image24.gif)</span><span class="sxs-lookup"><span data-stu-id="09042-342">[![The Breadcrumb Now Uses the Custom Site Map Provider NorthwindSiteMapProvider](building-a-custom-database-driven-site-map-provider-vb/_static/image25.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image24.gif)</span></span>

<span data-ttu-id="09042-343">**Ilustracja 18**. obraz przedstawiający teraz używa niestandardowego dostawcy mapy witryny `NorthwindSiteMapProvider` ([kliknij, aby wyświetlić obrazy o pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-vb/_static/image26.gif))</span><span class="sxs-lookup"><span data-stu-id="09042-343">**Figure 18**: The Breadcrumb Now Uses the Custom Site Map Provider `NorthwindSiteMapProvider` ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image26.gif))</span></span>

<span data-ttu-id="09042-344">Kontrolka ścieżki mapy witryny wyświetla bardziej funkcjonalny interfejs użytkownika na stronach `ProductsByCategory.aspx` i `ProductDetails.aspx`.</span><span class="sxs-lookup"><span data-stu-id="09042-344">The SiteMapPath control displays a more functional user interface in the `ProductsByCategory.aspx` and `ProductDetails.aspx` pages.</span></span> <span data-ttu-id="09042-345">Dodaj ścieżki mapy witryny do tych stron, ustawiając właściwość `SiteMapProvider` w obu wartościach na Northwind.</span><span class="sxs-lookup"><span data-stu-id="09042-345">Add a SiteMapPath to these pages, setting the `SiteMapProvider` property in both to Northwind.</span></span> <span data-ttu-id="09042-346">W `Default.aspx` kliknij link Wyświetl produkty dla napojów, a następnie na linku Wyświetl szczegóły dla Chai herbata.</span><span class="sxs-lookup"><span data-stu-id="09042-346">From `Default.aspx` click on the View Products link for Beverages, and then on the View Details link for Chai Tea.</span></span> <span data-ttu-id="09042-347">Jak pokazano na rysunku 19, pasek nawigacyjny zawiera bieżącą sekcję mapy witryny (Chai herbata) i jej elementy nadrzędne: napoje i wszystkie kategorie.</span><span class="sxs-lookup"><span data-stu-id="09042-347">As Figure 19 shows, the breadcrumb includes the current site map section ( Chai Tea ) and its ancestors: Beverages and All Categories .</span></span>

<span data-ttu-id="09042-348">[![do stron nadrzędnych jest teraz stosowana niestandardowa NorthwindSiteMapProvider dostawcy mapy witryny](building-a-custom-database-driven-site-map-provider-vb/_static/image27.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="09042-348">[![The Breadcrumb Now Uses the Custom Site Map Provider NorthwindSiteMapProvider](building-a-custom-database-driven-site-map-provider-vb/_static/image27.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image21.png)</span></span>

<span data-ttu-id="09042-349">**Ilustracja 19**. pasek nawigacyjny używa teraz niestandardowego dostawcy mapy witryny `NorthwindSiteMapProvider` ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-vb/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="09042-349">**Figure 19**: The Breadcrumb Now Uses the Custom Site Map Provider `NorthwindSiteMapProvider` ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image22.png))</span></span>

<span data-ttu-id="09042-350">Inne elementy interfejsu użytkownika nawigacji mogą służyć oprócz ścieżki mapy witryny, takich jak kontrolki menu i TreeView.</span><span class="sxs-lookup"><span data-stu-id="09042-350">Other navigation user interface elements can be used in addition to the SiteMapPath, such as the Menu and TreeView controls.</span></span> <span data-ttu-id="09042-351">Strony `Default.aspx`, `ProductsByCategory.aspx`i `ProductDetails.aspx` w pobraniu dla tego samouczka, na przykład wszystkie kontrolki menu dołączania (Zobacz Rysunek 20).</span><span class="sxs-lookup"><span data-stu-id="09042-351">The `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages in the download for this tutorial, for example, all include Menu controls (see Figure 20).</span></span> <span data-ttu-id="09042-352">Zobacz temat [Badanie funkcji nawigacyjnych witryny ASP.NET 2,0 s](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx) i sekcji [Używanie kontrolek nawigacji](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/navigation/sitenavcontrols.aspx) w witrynie [przewodnika szybki start w programie ASP.NET 2,0](https://quickstarts.asp.net/QuickStartv20/aspnet/) , aby uzyskać bardziej szczegółowy wygląd kontrolek nawigacji i systemu mapy witryny w ASP.NET 2,0.</span><span class="sxs-lookup"><span data-stu-id="09042-352">See [Examining ASP.NET 2.0 s Site Navigation Features](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx) and the [Using Site Navigation Controls](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/navigation/sitenavcontrols.aspx) section of the [ASP.NET 2.0 QuickStarts](https://quickstarts.asp.net/QuickStartv20/aspnet/) for a more in-depth look at the navigation controls and site map system in ASP.NET 2.0.</span></span>

<span data-ttu-id="09042-353">[![formant menu zawiera listę kategorii i produktów](building-a-custom-database-driven-site-map-provider-vb/_static/image29.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image28.gif)</span><span class="sxs-lookup"><span data-stu-id="09042-353">[![The Menu Control Lists Each of the Categories and Products](building-a-custom-database-driven-site-map-provider-vb/_static/image29.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image28.gif)</span></span>

<span data-ttu-id="09042-354">**Ilustracja 20**. kontrolka menu zawiera listę kategorii i produktów ([kliknij, aby wyświetlić obraz o pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-vb/_static/image30.gif))</span><span class="sxs-lookup"><span data-stu-id="09042-354">**Figure 20**: The Menu Control Lists Each of the Categories and Products ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image30.gif))</span></span>

<span data-ttu-id="09042-355">Jak wspomniano wcześniej w tym samouczku, można programowo uzyskać dostęp do struktury mapy witryny za pomocą klasy `SiteMap`.</span><span class="sxs-lookup"><span data-stu-id="09042-355">As mentioned earlier in this tutorial, the site map structure can be accessed programmatically through the `SiteMap` class.</span></span> <span data-ttu-id="09042-356">Poniższy kod zwraca `SiteMapNode` głównej domyślnego dostawcy:</span><span class="sxs-lookup"><span data-stu-id="09042-356">The following code returns the root `SiteMapNode` of the default provider:</span></span>

[!code-vb[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample8.vb)]

<span data-ttu-id="09042-357">Ponieważ `AspNetXmlSiteMapProvider` jest domyślnym dostawcą aplikacji, powyższy kod zwróci węzeł główny zdefiniowany w `Web.sitemap`.</span><span class="sxs-lookup"><span data-stu-id="09042-357">Since the `AspNetXmlSiteMapProvider` is the default provider for our application, the above code would return the root node defined in `Web.sitemap`.</span></span> <span data-ttu-id="09042-358">Aby odwołać się do dostawcy mapy witryny innego niż domyślny, użyj właściwości `SiteMap` klasy s [`Providers`](https://msdn.microsoft.com/library/system.web.sitemap.providers.aspx) , takiej jak:</span><span class="sxs-lookup"><span data-stu-id="09042-358">To reference a site map provider other than the default, use the `SiteMap` class s [`Providers` property](https://msdn.microsoft.com/library/system.web.sitemap.providers.aspx) like so:</span></span>

[!code-vb[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample9.vb)]

<span data-ttu-id="09042-359">Gdzie *name* to nazwa niestandardowego dostawcy mapy witryny (Northwind dla naszej aplikacji sieci Web).</span><span class="sxs-lookup"><span data-stu-id="09042-359">Where *name* is the name of the custom site map provider ( Northwind, for our web application).</span></span>

<span data-ttu-id="09042-360">Aby uzyskać dostęp do elementu członkowskiego określonego dla dostawcy mapy witryny, należy użyć `SiteMap.Providers["name"]` do pobrania wystąpienia dostawcy, a następnie rzutowania go na odpowiedni typ.</span><span class="sxs-lookup"><span data-stu-id="09042-360">To access a member specific to a site map provider, use `SiteMap.Providers["name"]` to retrieve the provider instance and then cast it to the appropriate type.</span></span> <span data-ttu-id="09042-361">Na przykład aby wyświetlić Właściwość `NorthwindSiteMapProvider` s `CachedDate` na stronie ASP.NET, użyj następującego kodu:</span><span class="sxs-lookup"><span data-stu-id="09042-361">For example, to display the `NorthwindSiteMapProvider` s `CachedDate` property in an ASP.NET page, use the following code:</span></span>

[!code-vb[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample10.vb)]

> [!NOTE]
> <span data-ttu-id="09042-362">Pamiętaj, aby przetestować funkcję zależności pamięci podręcznej SQL.</span><span class="sxs-lookup"><span data-stu-id="09042-362">Be sure to test out the SQL cache dependency feature.</span></span> <span data-ttu-id="09042-363">Po odwiedzeniu stron `Default.aspx`, `ProductsByCategory.aspx`i `ProductDetails.aspx` przejdź do jednego z samouczków w sekcji Edytowanie, wstawianie i usuwanie, a następnie Edytuj nazwę kategorii lub produktu.</span><span class="sxs-lookup"><span data-stu-id="09042-363">After visiting the `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages, go to one of the tutorials in the Editing, Inserting, and Deleting section and edit the name of a category or product.</span></span> <span data-ttu-id="09042-364">Następnie wróć do jednej ze stron w folderze `SiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="09042-364">Then return to one of the pages in the `SiteMapProvider` folder.</span></span> <span data-ttu-id="09042-365">Przy założeniu, że przed przekazaniem przez mechanizm sondowania zmian w źródłowej bazie danych zostanie zanotowany wystarczająco dużo czasu, należy zaktualizować mapę lokacji, aby pokazać nową nazwę produktu lub kategorii.</span><span class="sxs-lookup"><span data-stu-id="09042-365">Assuming enough time has passed for the polling mechanism to note the change to the underlying database, the site map should be updated to show the new product or category name.</span></span>

## <a name="summary"></a><span data-ttu-id="09042-366">Podsumowanie</span><span class="sxs-lookup"><span data-stu-id="09042-366">Summary</span></span>

<span data-ttu-id="09042-367">ASP.NET 2,0 s funkcje mapy witryny obejmują klasę `SiteMap`, wiele wbudowanych kontrolek sieci Web nawigacji i domyślnego dostawcę mapy witryny, który oczekuje informacji o mapie lokacji utrwalonych w pliku XML.</span><span class="sxs-lookup"><span data-stu-id="09042-367">ASP.NET 2.0 s site map features includes a `SiteMap` class, a number of built-in navigation Web controls, and a default site map provider that expects the site map information persisted to an XML file.</span></span> <span data-ttu-id="09042-368">Aby można było korzystać z informacji o mapie witryny z innego źródła, takiego jak baza danych, Architektura aplikacji lub zdalna usługa sieci Web, należy utworzyć niestandardowego dostawcę mapy witryny.</span><span class="sxs-lookup"><span data-stu-id="09042-368">In order to use site map information from some other source such as from a database, the application s architecture, or a remote Web service we need to create a custom site map provider.</span></span> <span data-ttu-id="09042-369">Obejmuje to Tworzenie klasy, która dziedziczy bezpośrednio lub pośrednio z klasy `SiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="09042-369">This involves creating a class that derives, directly or indirectly, from the `SiteMapProvider` class.</span></span>

<span data-ttu-id="09042-370">W tym samouczku przedstawiono sposób tworzenia niestandardowego dostawcy mapy witryny, który bazuje na mapie witryny na informacje o produkcie i kategorii, które pochodzą z architektury aplikacji.</span><span class="sxs-lookup"><span data-stu-id="09042-370">In this tutorial we saw how to create a custom site map provider that based the site map on the product and category information culled from the application architecture.</span></span> <span data-ttu-id="09042-371">Nasz dostawca rozszerzył klasę `StaticSiteMapProvider` i wymagała utworzenia metody `BuildSiteMap`, która pobrała dane, konstruuje hierarchię mapy lokacji i buforuje strukturę uzyskaną w zmiennej na poziomie klasy.</span><span class="sxs-lookup"><span data-stu-id="09042-371">Our provider extended the `StaticSiteMapProvider` class and entailed creating a `BuildSiteMap` method that retrieved the data, constructed the site map hierarchy, and cached the resulting structure in a class-level variable.</span></span> <span data-ttu-id="09042-372">Użyto zależności pamięci podręcznej SQL z funkcją wywołania zwrotnego, aby unieważniać buforowaną strukturę w przypadku zmodyfikowania bazowej `Categories` lub `Products` danych.</span><span class="sxs-lookup"><span data-stu-id="09042-372">We used a SQL cache dependency with a callback function to invalidate the cached structure when the underlying `Categories` or `Products` data is modified.</span></span>

<span data-ttu-id="09042-373">Szczęśliwe programowanie!</span><span class="sxs-lookup"><span data-stu-id="09042-373">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="09042-374">Dalsze informacje</span><span class="sxs-lookup"><span data-stu-id="09042-374">Further Reading</span></span>

<span data-ttu-id="09042-375">Aby uzyskać więcej informacji na temat tematów omówionych w tym samouczku, zapoznaj się z następującymi zasobami:</span><span class="sxs-lookup"><span data-stu-id="09042-375">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- <span data-ttu-id="09042-376">[Przechowywanie map witryn w SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) i [dostawca mapy witryny SQL zaczekał](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx)</span><span class="sxs-lookup"><span data-stu-id="09042-376">[Storing Site Maps in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) and [The SQL Site Map Provider You ve Been Waiting For](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx)</span></span>
- [<span data-ttu-id="09042-377">Zapoznaj się z modelem dostawcy ASP.NET 2,0 s</span><span class="sxs-lookup"><span data-stu-id="09042-377">A Look at ASP.NET 2.0 s Provider Model</span></span>](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx)
- [<span data-ttu-id="09042-378">Zestaw narzędzi dostawcy</span><span class="sxs-lookup"><span data-stu-id="09042-378">The Provider Toolkit</span></span>](https://msdn.microsoft.com/asp.net/aa336558.aspx)
- [<span data-ttu-id="09042-379">Badanie funkcji nawigowania po witrynie ASP.NET 2,0 s</span><span class="sxs-lookup"><span data-stu-id="09042-379">Examining ASP.NET 2.0 s Site Navigation Features</span></span>](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx)

## <a name="about-the-author"></a><span data-ttu-id="09042-380">Informacje o autorze</span><span class="sxs-lookup"><span data-stu-id="09042-380">About the Author</span></span>

<span data-ttu-id="09042-381">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor siedmiu grup ASP/ASP. NET Books i założyciel of [4GuysFromRolla.com](http://www.4guysfromrolla.com), pracował z technologiami sieci Web firmy Microsoft od czasu 1998.</span><span class="sxs-lookup"><span data-stu-id="09042-381">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="09042-382">Scott działa jako niezależny konsultant, trainer i składnik zapisywania.</span><span class="sxs-lookup"><span data-stu-id="09042-382">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="09042-383">Jego Najnowsza książka to [*Sams ASP.NET 2,0 w ciągu 24 godzin*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="09042-383">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="09042-384">Można go osiągnąć w [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="09042-384">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="09042-385">lub za pośrednictwem swojego blogu, który można znaleźć w [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="09042-385">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="09042-386">Specjalne podziękowania</span><span class="sxs-lookup"><span data-stu-id="09042-386">Special Thanks To</span></span>

<span data-ttu-id="09042-387">Ta seria samouczków została sprawdzona przez wielu przydatnych recenzentów.</span><span class="sxs-lookup"><span data-stu-id="09042-387">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="09042-388">Recenzenci liderzy dla tego samouczka to Dave Gardner, Zack Kowalski, Teresa Murphy i Bernadette Leigh.</span><span class="sxs-lookup"><span data-stu-id="09042-388">Lead reviewers for this tutorial were Dave Gardner, Zack Jones, Teresa Murphy, and Bernadette Leigh.</span></span> <span data-ttu-id="09042-389">Chcesz przeglądać moje nadchodzące artykuły MSDN?</span><span class="sxs-lookup"><span data-stu-id="09042-389">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="09042-390">Jeśli tak, upuść mi linię w [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="09042-390">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="09042-391">Ubiegł</span><span class="sxs-lookup"><span data-stu-id="09042-391">Previous</span></span>](building-a-custom-database-driven-site-map-provider-cs.md)
