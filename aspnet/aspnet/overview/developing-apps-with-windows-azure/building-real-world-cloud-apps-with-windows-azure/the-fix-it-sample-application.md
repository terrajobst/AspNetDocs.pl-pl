---
uid: aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/the-fix-it-sample-application
title: 'Dodatek: przykładowa aplikacja do rozwiązywania problemów (Tworzenie aplikacji w chmurze w rzeczywistości na platformie Azure) | Microsoft Docs'
author: MikeWasson
description: Tworzenie aplikacji w chmurze w świecie rzeczywistym za pomocą książki elektronicznej platformy Azure jest oparte na prezentacji opracowanej przez Scott Guthrie. Wyjaśniono 13 wzorców i praktyk, które mogą...
ms.author: riande
ms.date: 06/12/2014
ms.assetid: 1bc333c5-f096-4ea7-b170-779accc21c1a
msc.legacyurl: /aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/the-fix-it-sample-application
msc.type: authoredcontent
ms.openlocfilehash: e6fda47babd3c2505315f42667c45f09482218c2
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 11/28/2019
ms.locfileid: "74583746"
---
# <a name="appendix-the-fix-it-sample-application-building-real-world-cloud-apps-with-azure"></a><span data-ttu-id="c80e4-104">Dodatek: przykładowa aplikacja do rozwiązywania problemów (Tworzenie rzeczywistych aplikacji w chmurze przy użyciu platformy Azure)</span><span class="sxs-lookup"><span data-stu-id="c80e4-104">Appendix: The Fix It Sample Application (Building Real-World Cloud Apps with Azure)</span></span>

<span data-ttu-id="c80e4-105">przez [Jan Wasson](https://github.com/MikeWasson), [Rick Anderson]((https://twitter.com/RickAndMSFT)), [Tomasz Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="c80e4-105">by [Mike Wasson](https://github.com/MikeWasson), [Rick Anderson]((https://twitter.com/RickAndMSFT)), [Tom Dykstra](https://github.com/tdykstra)</span></span>

[<span data-ttu-id="c80e4-106">Pobierz projekt poprawki IT</span><span class="sxs-lookup"><span data-stu-id="c80e4-106">Download The Fix It Project</span></span>](https://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4)

> <span data-ttu-id="c80e4-107">**Tworzenie aplikacji w chmurze w świecie rzeczywistym za pomocą książki elektronicznej platformy Azure** jest oparte na prezentacji opracowanej przez Scott Guthrie.</span><span class="sxs-lookup"><span data-stu-id="c80e4-107">The **Building Real World Cloud Apps with Azure** e-book is based on a presentation developed by Scott Guthrie.</span></span> <span data-ttu-id="c80e4-108">Wyjaśniono 13 wzorców i praktyk, które mogą pomóc w pomyślnym tworzeniu aplikacji sieci Web dla chmury.</span><span class="sxs-lookup"><span data-stu-id="c80e4-108">It explains 13 patterns and practices that can help you be successful developing web apps for the cloud.</span></span> <span data-ttu-id="c80e4-109">Aby uzyskać informacje na temat książki elektronicznej, zobacz [pierwszy rozdział](introduction.md).</span><span class="sxs-lookup"><span data-stu-id="c80e4-109">For information about the e-book, see [the first chapter](introduction.md).</span></span>

<span data-ttu-id="c80e4-110">Ten dodatek do tworzenia aplikacji w chmurze w świecie rzeczywistym za pomocą książki elektronicznej platformy Azure zawiera następujące sekcje, które zawierają dodatkowe informacje na temat rozwiązywania problemów przykładowej aplikacji, którą można pobrać:</span><span class="sxs-lookup"><span data-stu-id="c80e4-110">This appendix to the Building Real World Cloud Apps with Azure e-book contains the following sections that provide additional information about the Fix It sample application that you can download:</span></span>

- [<span data-ttu-id="c80e4-111">Znane problemy</span><span class="sxs-lookup"><span data-stu-id="c80e4-111">Known issues</span></span>](#knownissues)
- [<span data-ttu-id="c80e4-112">Najlepsze rozwiązania</span><span class="sxs-lookup"><span data-stu-id="c80e4-112">Best practices</span></span>](#bestpractices)
- [<span data-ttu-id="c80e4-113">Jak uruchomić aplikację z programu Visual Studio na komputerze lokalnym</span><span class="sxs-lookup"><span data-stu-id="c80e4-113">How to run the app from Visual Studio on your local computer</span></span>](#run-in-vs)
- [<span data-ttu-id="c80e4-114">Jak wdrożyć aplikację podstawową w Azure App Service Web Apps przy użyciu skryptów programu Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="c80e4-114">How to deploy the base app to Azure App Service Web Apps by using the Windows PowerShell scripts</span></span>](#deploybase)
- [<span data-ttu-id="c80e4-115">Rozwiązywanie problemów ze skryptami programu Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="c80e4-115">Troubleshooting the Windows PowerShell scripts</span></span>](#troubleshooting)
- [<span data-ttu-id="c80e4-116">Jak wdrożyć aplikację przy użyciu przetwarzania w kolejce w celu Azure App Service Web Apps i usługi w chmurze platformy Azure</span><span class="sxs-lookup"><span data-stu-id="c80e4-116">How to deploy the app with queue processing to Azure App Service Web Apps and an Azure Cloud Service</span></span>](#deployqueues)

<a id="knownissues"></a>
## <a name="known-issues"></a><span data-ttu-id="c80e4-117">Znane problemy</span><span class="sxs-lookup"><span data-stu-id="c80e4-117">Known issues</span></span>

<span data-ttu-id="c80e4-118">Aplikacja do rozwiązywania problemów została pierwotnie opracowana w celu zilustrowania jak najprawdopodobniej niektórych wzorców przedstawionych w tej książce elektronicznej.</span><span class="sxs-lookup"><span data-stu-id="c80e4-118">The Fix It app was originally developed in order to illustrate as simply as possible some of the patterns presented in this e-book.</span></span> <span data-ttu-id="c80e4-119">Jednak ponieważ książka elektroniczna dotyczy tworzenia aplikacji w rzeczywistości, firma Microsoft pomogła rozwiązać ten problem w procesie przeglądu i testowania podobnym do tego, co robimy w przypadku wydanego oprogramowania.</span><span class="sxs-lookup"><span data-stu-id="c80e4-119">However, since the e-book is about building real-world apps, we subjected the Fix It code to a review and testing process similar to what we'd do for released software.</span></span> <span data-ttu-id="c80e4-120">Znaleźliśmy wiele problemów i tak jak w przypadku wszystkich aplikacji w świecie rzeczywistym, niektóre z nich zostały naprawione i niektóre z nich zostały odroczone do nowszej wersji.</span><span class="sxs-lookup"><span data-stu-id="c80e4-120">We found a number of issues, and as with any real-world application, some of them we fixed and some of them we deferred to a later release.</span></span>

<span data-ttu-id="c80e4-121">Poniższa lista zawiera problemy, które powinny być rozwiązane w aplikacji produkcyjnej, ale z jednej przyczyny lub innym, że nie postanowili się, aby nie poradzić sobie z początkową wersją przykładowej aplikacji.</span><span class="sxs-lookup"><span data-stu-id="c80e4-121">The following list includes issues that should be addressed in a production application, but for one reason or another we decided not to address in the initial release of the Fix It sample application.</span></span>

### <a name="security"></a><span data-ttu-id="c80e4-122">Zabezpieczenia</span><span class="sxs-lookup"><span data-stu-id="c80e4-122">Security</span></span>

- <span data-ttu-id="c80e4-123">Upewnij się, że nie możesz przypisać zadania do nieistniejącego właściciela.</span><span class="sxs-lookup"><span data-stu-id="c80e4-123">Ensure that you can't assign a task to a non-existent owner.</span></span>
- <span data-ttu-id="c80e4-124">Upewnij się, że możesz tylko wyświetlać i modyfikować zadania utworzone lub przypisane do Ciebie.</span><span class="sxs-lookup"><span data-stu-id="c80e4-124">Ensure that you can only view and modify tasks that you created or are assigned to you.</span></span>
- <span data-ttu-id="c80e4-125">Używaj protokołu HTTPS dla stron logowania i plików cookie uwierzytelniania.</span><span class="sxs-lookup"><span data-stu-id="c80e4-125">Use HTTPS for sign-in pages and authentication cookies.</span></span>
- <span data-ttu-id="c80e4-126">Określ limit czasu dla plików cookie uwierzytelniania.</span><span class="sxs-lookup"><span data-stu-id="c80e4-126">Specify a time limit for authentication cookies.</span></span>

### <a name="input-validation"></a><span data-ttu-id="c80e4-127">Walidacja danych wejściowych</span><span class="sxs-lookup"><span data-stu-id="c80e4-127">Input validation</span></span>

<span data-ttu-id="c80e4-128">Ogólnie rzecz biorąc, aplikacja produkcyjna będzie bardziej sprawdzać poprawność danych wejściowych niż poprawka IT.</span><span class="sxs-lookup"><span data-stu-id="c80e4-128">In general, a production app would do more input validation than the Fix It app.</span></span> <span data-ttu-id="c80e4-129">Na przykład rozmiar obrazu/rozmiar pliku obrazu dozwolony dla przekazywania powinien być ograniczony.</span><span class="sxs-lookup"><span data-stu-id="c80e4-129">For example, the image size / image file size allowed for upload should be limited.</span></span>

### <a name="administrator-functionality"></a><span data-ttu-id="c80e4-130">Funkcje administratora</span><span class="sxs-lookup"><span data-stu-id="c80e4-130">Administrator functionality</span></span>

<span data-ttu-id="c80e4-131">Administrator powinien mieć możliwość zmiany własności istniejących zadań.</span><span class="sxs-lookup"><span data-stu-id="c80e4-131">An administrator should be able to change ownership on existing tasks.</span></span> <span data-ttu-id="c80e4-132">Na przykład twórca zadania może opuścić firmę, pozostawiając bez nich uprawnienia do obsługi zadania, o ile nie jest włączony dostęp administracyjny.</span><span class="sxs-lookup"><span data-stu-id="c80e4-132">For example, the creator of a task might leave the company, leaving no one with authority to maintain the task unless administrative access is enabled.</span></span>

### <a name="queue-message-processing"></a><span data-ttu-id="c80e4-133">Przetwarzanie komunikatów w kolejce</span><span class="sxs-lookup"><span data-stu-id="c80e4-133">Queue message processing</span></span>

<span data-ttu-id="c80e4-134">Przetwarzanie komunikatów w kolejce w aplikacji, która została zaprojektowana tak, aby było proste, aby zilustrować wzorzec pracy skoncentrowanej na kolejkach o minimalnej ilości kodu.</span><span class="sxs-lookup"><span data-stu-id="c80e4-134">Queue message processing in the Fix It app was designed to be simple in order to illustrate the queue-centric work pattern with a minimum amount of code.</span></span> <span data-ttu-id="c80e4-135">Ten prosty kod nie będzie odpowiedni dla rzeczywistej aplikacji produkcyjnej.</span><span class="sxs-lookup"><span data-stu-id="c80e4-135">This simple code would not be adequate for an actual production application.</span></span>

- <span data-ttu-id="c80e4-136">Kod nie gwarantuje, że każdy komunikat w kolejce zostanie przetworzony co najwyżej raz.</span><span class="sxs-lookup"><span data-stu-id="c80e4-136">The code does not guarantee that each queue message will be processed at most once.</span></span> <span data-ttu-id="c80e4-137">Po otrzymaniu komunikatu z kolejki jest przedział czasu, w którym komunikat jest niewidoczny dla innych odbiorników kolejki.</span><span class="sxs-lookup"><span data-stu-id="c80e4-137">When you get a message from the queue, there is a timeout period, during which the message is invisible to other queue listeners.</span></span> <span data-ttu-id="c80e4-138">Jeśli limit czasu upłynie przed usunięciem komunikatu, komunikat zostanie ponownie widoczny.</span><span class="sxs-lookup"><span data-stu-id="c80e4-138">If the timeout expires before the message is deleted, the message becomes visible again.</span></span> <span data-ttu-id="c80e4-139">W związku z tym, jeśli wystąpienie roli procesu roboczego poświęca długi czas na przetwarzanie komunikatu, teoretycznie możliwe jest, aby ten sam komunikat został przetworzony dwa razy, co spowoduje zduplikowane zadanie w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="c80e4-139">Therefore, if a worker role instance spends a long time processing a message, it is theoretically possible for the same message to get processed twice, resulting in a duplicate task in the database.</span></span> <span data-ttu-id="c80e4-140">Aby uzyskać więcej informacji o tym problemie, zobacz [Korzystanie z kolejek usługi Azure Storage](https://msdn.microsoft.com/library/ff803365.aspx#sec7).</span><span class="sxs-lookup"><span data-stu-id="c80e4-140">For more information about this issue, see [Using Azure Storage Queues](https://msdn.microsoft.com/library/ff803365.aspx#sec7).</span></span>
- <span data-ttu-id="c80e4-141">Logika sondowania kolejki może być bardziej opłacalna dzięki wsadowemu pobieraniu komunikatów.</span><span class="sxs-lookup"><span data-stu-id="c80e4-141">The queue polling logic could be more cost-effective, by batching message retrieval.</span></span> <span data-ttu-id="c80e4-142">Przy każdym wywołaniu metody [CloudQueue. GetMessageAsync](https://msdn.microsoft.com/library/microsoft.windowsazure.storage.queue.cloudqueue.getmessageasync.aspx)występuje koszt transakcji.</span><span class="sxs-lookup"><span data-stu-id="c80e4-142">Every time you call [CloudQueue.GetMessageAsync](https://msdn.microsoft.com/library/microsoft.windowsazure.storage.queue.cloudqueue.getmessageasync.aspx), there is a transaction cost.</span></span> <span data-ttu-id="c80e4-143">Zamiast tego można wywołać metodę [CloudQueue. GetMessagesAsync](https://msdn.microsoft.com/library/microsoft.windowsazure.storage.queue.cloudqueue.getmessagesasync.aspx) (w liczbie mnogiej), która pobiera wiele komunikatów w jednej transakcji.</span><span class="sxs-lookup"><span data-stu-id="c80e4-143">Instead, you can call [CloudQueue.GetMessagesAsync](https://msdn.microsoft.com/library/microsoft.windowsazure.storage.queue.cloudqueue.getmessagesasync.aspx) (note the plural 's'), which gets multiple messages in a single transaction.</span></span> <span data-ttu-id="c80e4-144">Koszty transakcji dla kolejek usługi Azure Storage są bardzo małe, więc wpływ na koszty nie jest istotny w większości scenariuszy.</span><span class="sxs-lookup"><span data-stu-id="c80e4-144">The transaction costs for Azure Storage Queues are very low, so the impact on costs is not substantial in most scenarios.</span></span>
- <span data-ttu-id="c80e4-145">Ścisła pętla w kodzie przetwarzania komunikatów w kolejce powoduje, że koligacja procesora CPU nie korzysta efektywnie z wielordzeniowych maszyn wirtualnych.</span><span class="sxs-lookup"><span data-stu-id="c80e4-145">The tight loop in the queue message-processing code causes CPU affinity, which does not utilize multi-core VMs efficiently.</span></span> <span data-ttu-id="c80e4-146">Lepszym rozwiązaniem jest użycie równoległości zadań do równoległego uruchamiania kilku zadań asynchronicznych.</span><span class="sxs-lookup"><span data-stu-id="c80e4-146">A better design would use task parallelism to run several async tasks in parallel.</span></span>
- <span data-ttu-id="c80e4-147">Komunikat kolejki — przetwarzanie ma tylko podstawowe obsługę wyjątków.</span><span class="sxs-lookup"><span data-stu-id="c80e4-147">Queue message-processing has only rudimentary exception handling.</span></span> <span data-ttu-id="c80e4-148">Na przykład kod nie obsługuje [skażonych komunikatów](https://msdn.microsoft.com/library/ms789028.aspx).</span><span class="sxs-lookup"><span data-stu-id="c80e4-148">For example, the code doesn't handle [poison messages](https://msdn.microsoft.com/library/ms789028.aspx).</span></span> <span data-ttu-id="c80e4-149">(Gdy przetwarzanie komunikatów powoduje wyjątek, należy zarejestrować błąd i usunąć komunikat albo rola proces roboczy podejmie próbę przetworzenia go ponownie, a pętla będzie kontynuowała czas nieokreślony).</span><span class="sxs-lookup"><span data-stu-id="c80e4-149">(When message processing causes an exception, you have to log the error and delete the message, or the worker role will try to process it again, and the loop will continue indefinitely.)</span></span>

### <a name="sql-queries-are-unbounded"></a><span data-ttu-id="c80e4-150">Zapytania SQL są niepowiązane</span><span class="sxs-lookup"><span data-stu-id="c80e4-150">SQL queries are unbounded</span></span>

<span data-ttu-id="c80e4-151">Bieżąca poprawka kodu IT nie ma żadnego limitu liczby wierszy, które mogą zostać zwrócone przez zapytania dla stron indeksu.</span><span class="sxs-lookup"><span data-stu-id="c80e4-151">Current Fix It code places no limit on how many rows the queries for Index pages might return.</span></span> <span data-ttu-id="c80e4-152">W przypadku wprowadzenia w bazie danych dużej ilości zadań, rozmiar odebranych list może spowodować problemy z wydajnością.</span><span class="sxs-lookup"><span data-stu-id="c80e4-152">If a large volume of tasks is entered into the database, the size of the resulting lists received could cause performance issues.</span></span> <span data-ttu-id="c80e4-153">Rozwiązaniem jest zaimplementowanie stronicowania.</span><span class="sxs-lookup"><span data-stu-id="c80e4-153">The solution is to implement paging.</span></span> <span data-ttu-id="c80e4-154">Aby zapoznać się z przykładem, zobacz [sortowanie, filtrowanie i stronicowanie przy użyciu Entity Framework w aplikacji ASP.NET MVC](../../../../mvc/overview/getting-started/getting-started-with-ef-using-mvc/sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application.md).</span><span class="sxs-lookup"><span data-stu-id="c80e4-154">For an example, see [Sorting, Filtering, and Paging with the Entity Framework in an ASP.NET MVC Application](../../../../mvc/overview/getting-started/getting-started-with-ef-using-mvc/sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application.md).</span></span>

### <a name="view-models-recommended"></a><span data-ttu-id="c80e4-155">Zalecane modele widoku</span><span class="sxs-lookup"><span data-stu-id="c80e4-155">View models recommended</span></span>

<span data-ttu-id="c80e4-156">Aplikacja do rozwiązywania IT używa klasy jednostki FixItTask do przekazywania informacji między kontrolerem a widokiem.</span><span class="sxs-lookup"><span data-stu-id="c80e4-156">The Fix It app uses the FixItTask entity class to pass information between the controller and the view.</span></span> <span data-ttu-id="c80e4-157">Najlepszym rozwiązaniem jest użycie modeli widoku.</span><span class="sxs-lookup"><span data-stu-id="c80e4-157">A best practice is to use view models.</span></span> <span data-ttu-id="c80e4-158">Model domeny (np. Klasa jednostki FixItTask) jest zaprojektowana na podstawie tego, co jest potrzebne w przypadku trwałości danych, podczas gdy model widoku może być przeznaczony do prezentacji danych.</span><span class="sxs-lookup"><span data-stu-id="c80e4-158">The domain model (e.g., the FixItTask entity class) is designed around what is needed for data persistence, while a view model can be designed for data presentation.</span></span> <span data-ttu-id="c80e4-159">Aby uzyskać więcej informacji, zobacz [12 najważniejszych rozwiązań ASP.NET MVC](https://codeclimber.net.nz/archive/2009/10/27/12-asp.net-mvc-best-practices.aspx).</span><span class="sxs-lookup"><span data-stu-id="c80e4-159">For more information, see [12 ASP.NET MVC Best Practices](https://codeclimber.net.nz/archive/2009/10/27/12-asp.net-mvc-best-practices.aspx).</span></span>

### <a name="secure-image-blob-recommended"></a><span data-ttu-id="c80e4-160">Zalecany bezpieczny obiekt BLOB obrazu</span><span class="sxs-lookup"><span data-stu-id="c80e4-160">Secure image blob recommended</span></span>

<span data-ttu-id="c80e4-161">Poprawka It zapisuje przekazane obrazy jako publiczne, co oznacza, że każda osoba, która znajdzie adres URL, może uzyskać do nich dostęp.</span><span class="sxs-lookup"><span data-stu-id="c80e4-161">The Fix It app stores uploaded images as public, meaning that anyone who finds the URL can access the images.</span></span> <span data-ttu-id="c80e4-162">Obrazy mogą być zabezpieczone zamiast publicznie.</span><span class="sxs-lookup"><span data-stu-id="c80e4-162">The images could be secured instead of public.</span></span>

### <a name="no-powershell-automation-scripts-for-queues"></a><span data-ttu-id="c80e4-163">Brak skryptów automatyzacji programu PowerShell dla kolejek</span><span class="sxs-lookup"><span data-stu-id="c80e4-163">No PowerShell automation scripts for queues</span></span>

<span data-ttu-id="c80e4-164">Przykładowe skrypty automatyzacji programu PowerShell zostały zapisane tylko dla podstawowej wersji poprawki, która działa w całości w Azure App Service Web Apps.</span><span class="sxs-lookup"><span data-stu-id="c80e4-164">Sample PowerShell automation scripts were written only for the base version of Fix It that runs entirely in Azure App Service Web Apps.</span></span> <span data-ttu-id="c80e4-165">Nie podano skryptów do konfigurowania i wdrażania aplikacji sieci Web oraz środowiska usługi w chmurze wymaganego do przetwarzania kolejki.</span><span class="sxs-lookup"><span data-stu-id="c80e4-165">We haven't provided scripts for setting up and deploying to the web app plus Cloud Service environment required for queue processing.</span></span>

### <a name="special-handling-for-html-codes-in-user-input"></a><span data-ttu-id="c80e4-166">Specjalna obsługa kodów HTML w danych wejściowych użytkownika</span><span class="sxs-lookup"><span data-stu-id="c80e4-166">Special handling for HTML codes in user input</span></span>

<span data-ttu-id="c80e4-167">ASP.NET automatycznie zapobiega wielu sposobom, w których Złośliwi użytkownicy mogą próbować ataki skryptów między lokacjami, wprowadzając skrypt w polach tekstowych wprowadzanie danych przez użytkownika.</span><span class="sxs-lookup"><span data-stu-id="c80e4-167">ASP.NET automatically prevents many ways in which malicious users might attempt cross-site scripting attacks by entering script in user input text boxes.</span></span> <span data-ttu-id="c80e4-168">I pomocnik `DisplayFor` MVC używany do wyświetlania tytułów zadań i notatek automatycznie kodu HTML — koduje wartości wysyłane do przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="c80e4-168">And the MVC `DisplayFor` helper used to display task titles and notes automatically HTML-encodes values that it sends to the browser.</span></span> <span data-ttu-id="c80e4-169">Ale w aplikacji produkcyjnej możesz potrzebować dodatkowych miar.</span><span class="sxs-lookup"><span data-stu-id="c80e4-169">But in a production app you might want to take additional measures.</span></span> <span data-ttu-id="c80e4-170">Aby uzyskać więcej informacji, zobacz temat [Weryfikowanie żądań w ASP.NET](https://msdn.microsoft.com/library/hh882339.aspx).</span><span class="sxs-lookup"><span data-stu-id="c80e4-170">For more information, see [Request Validation in ASP.NET](https://msdn.microsoft.com/library/hh882339.aspx).</span></span>

<a id="bestpractices"></a>
## <a name="best-practices"></a><span data-ttu-id="c80e4-171">Najlepsze rozwiązania</span><span class="sxs-lookup"><span data-stu-id="c80e4-171">Best practices</span></span>

<span data-ttu-id="c80e4-172">Poniżej przedstawiono niektóre problemy, które zostały poprawione po wykryciu w przeglądzie kodu i przetestowaniu oryginalnej wersji aplikacji poprawki IT.</span><span class="sxs-lookup"><span data-stu-id="c80e4-172">Following are some issues that were fixed after being discovered in code review and testing of the original version of the Fix It app.</span></span> <span data-ttu-id="c80e4-173">Niektóre z nich wynikają z faktu, że oryginalny program codeer nie wie o konkretnym najlepszym wykorzystaniu, po prostu, ponieważ kod został zapisany szybko i nie był przeznaczony do wydania oprogramowania.</span><span class="sxs-lookup"><span data-stu-id="c80e4-173">Some were caused by the original coder not being aware of a particular best practice, some simply because the code was written quickly and wasn't intended for released software.</span></span> <span data-ttu-id="c80e4-174">Omawiamy tutaj problemy na wypadek wystąpienia tego przeglądu i testowania, które mogą okazać się przydatne dla innych użytkowników, którzy również opracowują aplikacje sieci Web.</span><span class="sxs-lookup"><span data-stu-id="c80e4-174">We're listing the issues here in case there's something we learned from this review and testing that might be helpful to others who are also developing web apps.</span></span>

### <a name="dispose-the-database-repository"></a><span data-ttu-id="c80e4-175">Usuwanie repozytorium bazy danych</span><span class="sxs-lookup"><span data-stu-id="c80e4-175">Dispose the database repository</span></span>

<span data-ttu-id="c80e4-176">Klasa `FixItTaskRepository` musi usunąć wystąpienie `DbContext` Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="c80e4-176">The `FixItTaskRepository` class must dispose the Entity Framework `DbContext` instance.</span></span> <span data-ttu-id="c80e4-177">Wprowadziliśmy to przez implementację `IDisposable` w klasie `FixItTaskRepository`:</span><span class="sxs-lookup"><span data-stu-id="c80e4-177">We did this by implementing `IDisposable` in the `FixItTaskRepository` class:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample1.cs)]

<span data-ttu-id="c80e4-178">Należy pamiętać, że AutoFac automatycznie usunie wystąpienie `FixItTaskRepository`, więc nie trzeba go jawnie usunąć.</span><span class="sxs-lookup"><span data-stu-id="c80e4-178">Note that AutoFac will automatically dispose the `FixItTaskRepository` instance, so we don't need to explicitly dispose it.</span></span>

<span data-ttu-id="c80e4-179">Inna opcja polega na usunięciu zmiennej składowej `DbContext` z `FixItTaskRepository`, a zamiast tego utworzyć lokalną zmienną `DbContext` w ramach każdej metody repozytorium, wewnątrz instrukcji `using`.</span><span class="sxs-lookup"><span data-stu-id="c80e4-179">Another option is to remove the `DbContext` member variable from `FixItTaskRepository`, and instead create a local `DbContext` variable within each repository method, inside a `using` statement.</span></span> <span data-ttu-id="c80e4-180">Na przykład:</span><span class="sxs-lookup"><span data-stu-id="c80e4-180">For example:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample2.cs)]

### <a name="register-singletons-as-such-with-di"></a><span data-ttu-id="c80e4-181">Zarejestruj pojedyncze jako takie przy użyciu DI</span><span class="sxs-lookup"><span data-stu-id="c80e4-181">Register singletons as such with DI</span></span>

<span data-ttu-id="c80e4-182">Ponieważ wymagana jest tylko jedno wystąpienie klasy `PhotoService` i klasy `Logger`, te klasy powinny być [rejestrowane jako pojedyncze wystąpienia iniekcji zależności](https://code.google.com/p/autofac/wiki/InstanceScope) w *DependenciesConfig.cs*:</span><span class="sxs-lookup"><span data-stu-id="c80e4-182">Since only one instance of the `PhotoService` class and `Logger` class is needed, these classes should be [registered as single instances for dependency injection](https://code.google.com/p/autofac/wiki/InstanceScope) in *DependenciesConfig.cs*:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample3.cs?highlight=1,3)]

### <a name="security-dont-show-error-details-to-users"></a><span data-ttu-id="c80e4-183">Zabezpieczenia: nie pokazuj szczegółów błędu użytkownikom</span><span class="sxs-lookup"><span data-stu-id="c80e4-183">Security: Don't show error details to users</span></span>

<span data-ttu-id="c80e4-184">Oryginalna aplikacja do usuwania poprawek nie miała ogólnej strony błędu i wystarczy zezwolić wszystkim wyjątkom na dostęp do interfejsu użytkownika, więc niektóre wyjątki, takie jak błędy połączenia z bazą danych, mogą spowodować wyświetlenie pełnego śladu stosu w przeglądarce.</span><span class="sxs-lookup"><span data-stu-id="c80e4-184">The original Fix It app didn't have a generic error page and just let all exceptions bubble up to the UI, so some exceptions such as database connection errors could result in a full stack trace being displayed to the browser.</span></span> <span data-ttu-id="c80e4-185">Szczegółowe informacje o błędzie mogą czasami ułatwić ataki złośliwym użytkownikom.</span><span class="sxs-lookup"><span data-stu-id="c80e4-185">Detailed error information can sometimes facilitate attacks by malicious users.</span></span> <span data-ttu-id="c80e4-186">Rozwiązanie to rejestruje szczegóły wyjątku i wyświetla stronę błędu użytkownikowi, który nie zawiera szczegółów błędu.</span><span class="sxs-lookup"><span data-stu-id="c80e4-186">The solution is to log the exception details and display an error page to the user that doesn't include error details.</span></span> <span data-ttu-id="c80e4-187">Ta aplikacja rozwiązania IT została już zarejestrowana i aby można było wyświetlić stronę błędu, dodaliśmy `<customErrors mode=On>` w pliku Web. config.</span><span class="sxs-lookup"><span data-stu-id="c80e4-187">The Fix It app was already logging, and in order to display an error page, we added `<customErrors mode=On>` in the Web.config file.</span></span>

[!code-xml[Main](the-fix-it-sample-application/samples/sample4.xml?highlight=2)]

<span data-ttu-id="c80e4-188">Domyślnie to powoduje, że *Views\Shared\Error.cshtml* są wyświetlane w przypadku błędów.</span><span class="sxs-lookup"><span data-stu-id="c80e4-188">By default this causes *Views\Shared\Error.cshtml* to be displayed for errors.</span></span> <span data-ttu-id="c80e4-189">Można dostosować *Error. cshtml* lub utworzyć własny widok strony błędu i dodać atrybut `defaultRedirect`.</span><span class="sxs-lookup"><span data-stu-id="c80e4-189">You can customize *Error.cshtml* or create your own error page view and add a `defaultRedirect` attribute.</span></span> <span data-ttu-id="c80e4-190">Można również określić różne strony błędów dla określonych błędów.</span><span class="sxs-lookup"><span data-stu-id="c80e4-190">You can also specify different error pages for specific errors.</span></span>

### <a name="security-only-allow-a-task-to-be-edited-by-its-creator"></a><span data-ttu-id="c80e4-191">Zabezpieczenia: Zezwalaj tylko na edytowanie zadania przez jego twórcę</span><span class="sxs-lookup"><span data-stu-id="c80e4-191">Security: only allow a task to be edited by its creator</span></span>

<span data-ttu-id="c80e4-192">Na stronie indeks pulpitu nawigacyjnego są wyświetlane tylko zadania utworzone przez zalogowanego użytkownika, ale złośliwy użytkownik może utworzyć adres URL z IDENTYFIKATORem do zadania innego użytkownika.</span><span class="sxs-lookup"><span data-stu-id="c80e4-192">The Dashboard Index page only shows tasks created by the logged-on user, but a malicious user could create a URL with an ID to another user's task.</span></span> <span data-ttu-id="c80e4-193">Dodaliśmy kod w *DashboardController.cs* , aby zwrócić 404 w tym przypadku:</span><span class="sxs-lookup"><span data-stu-id="c80e4-193">We added code in *DashboardController.cs* to return a 404 in that case:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample5.cs?highlight=9-14,24-29)]

### <a name="dont-swallow-exceptions"></a><span data-ttu-id="c80e4-194">Wyjątki unpołknięci</span><span class="sxs-lookup"><span data-stu-id="c80e4-194">Don't swallow exceptions</span></span>

<span data-ttu-id="c80e4-195">Oryginalna poprawka aplikacji IT zwróciła wartość null po zarejestrowaniu wyjątku, który powstał w wyniku zapytania SQL:</span><span class="sxs-lookup"><span data-stu-id="c80e4-195">The original Fix It app just returned null after logging an exception that resulted from a SQL query:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample6.cs?highlight=4)]

<span data-ttu-id="c80e4-196">Spowoduje to przeszukanie użytkownika tak, jakby kwerenda zakończyła się pomyślnie, ale nie zwróciła żadnych wierszy.</span><span class="sxs-lookup"><span data-stu-id="c80e4-196">This would make it look to the user as if the query succeeded but just didn't return any rows.</span></span> <span data-ttu-id="c80e4-197">Rozwiązanie to ponowne zgłoszenie wyjątku Po przechwyceniu i zarejestrowaniu:</span><span class="sxs-lookup"><span data-stu-id="c80e4-197">Solution is to re-throw the exception after catching and logging:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample7.cs)]

### <a name="catch-all-exceptions-in-worker-roles"></a><span data-ttu-id="c80e4-198">Przechwyć wszystkie wyjątki w rolach procesów roboczych</span><span class="sxs-lookup"><span data-stu-id="c80e4-198">Catch all exceptions in worker roles</span></span>

<span data-ttu-id="c80e4-199">Wszystkie Nieobsłużone wyjątki w roli procesu roboczego spowodują, że maszyna wirtualna zostanie odtworzona, więc chcesz otoczyć wszystkie elementy w bloku try-catch i obsłużyć wszystkie wyjątki.</span><span class="sxs-lookup"><span data-stu-id="c80e4-199">Any unhandled exceptions in a worker role will cause the VM to be recycled, so you want to wrap everything you do in a try-catch block and handle all exceptions.</span></span>

### <a name="specify-length-for-string-properties-in-entity-classes"></a><span data-ttu-id="c80e4-200">Określ długość dla właściwości ciągu w klasach jednostek</span><span class="sxs-lookup"><span data-stu-id="c80e4-200">Specify length for string properties in entity classes</span></span>

<span data-ttu-id="c80e4-201">Aby można było wyświetlić prosty kod, oryginalna wersja aplikacji Fix it nie określiła długości dla pól jednostki FixItTask, a w efekcie zostały zdefiniowane jako varchar (max) w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="c80e4-201">In order to display simple code, the original version of the Fix It app didn't specify lengths for the fields of the FixItTask entity, and as a result they were defined as varchar(max) in the database.</span></span> <span data-ttu-id="c80e4-202">W efekcie interfejs użytkownika akceptuje niemal dowolną ilość danych wejściowych.</span><span class="sxs-lookup"><span data-stu-id="c80e4-202">As a result, the UI would accept almost any amount of input.</span></span> <span data-ttu-id="c80e4-203">Określanie długości ustawia limity, które mają zastosowanie zarówno do danych wejściowych użytkownika na stronie sieci Web, jak i w rozmiarze kolumny w bazie danych:</span><span class="sxs-lookup"><span data-stu-id="c80e4-203">Specifying lengths sets limits that apply both to user input in the web page and column size in the database:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample8.cs?highlight=4,7,10,12,14)]

### <a name="mark-private-members-as-readonly-when-they-arent-expected-to-change"></a><span data-ttu-id="c80e4-204">Oznacz prywatne elementy członkowskie jako tylko do odczytu, jeśli nie będą oczekiwane zmiany</span><span class="sxs-lookup"><span data-stu-id="c80e4-204">Mark private members as readonly when they aren't expected to change</span></span>

<span data-ttu-id="c80e4-205">Na przykład w klasie `DashboardController` jest tworzone wystąpienie `FixItTaskRepository` i nie jest oczekiwane jego zmiana, dlatego definiujemy ją jako tylko do [odczytu](https://msdn.microsoft.com/library/acdd6hb7.aspx).</span><span class="sxs-lookup"><span data-stu-id="c80e4-205">For example, in the `DashboardController` class an instance of `FixItTaskRepository` is created and isn't expected to change, so we defined it as [readonly](https://msdn.microsoft.com/library/acdd6hb7.aspx).</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample9.cs?highlight=3)]

### <a name="use-listany-instead-of-listcount-gt-0"></a><span data-ttu-id="c80e4-206">Użyj listy. Any () zamiast listy. Count () &gt; 0</span><span class="sxs-lookup"><span data-stu-id="c80e4-206">Use list.Any() instead of list.Count() &gt; 0</span></span>

<span data-ttu-id="c80e4-207">Jeśli wiesz, że co najmniej jeden element na liście spełnia określone kryteria, użyj [dowolnej](https://msdn.microsoft.com/library/bb534972.aspx) metody, ponieważ jest ona zwracana zaraz po znalezieniu kryteriów, a metoda `Count` zawsze musi wykonać iterację każdego elementu.</span><span class="sxs-lookup"><span data-stu-id="c80e4-207">If you all you care about is whether one or more items in a list fit the specified criteria, use the [Any](https://msdn.microsoft.com/library/bb534972.aspx) method, because it returns as soon as an item fitting the criteria is found, whereas the `Count` method always has to iterate through every item.</span></span> <span data-ttu-id="c80e4-208">Plik *. cshtml indeksu* pulpitu nawigacyjnego pierwotnie miał ten kod:</span><span class="sxs-lookup"><span data-stu-id="c80e4-208">The Dashboard *Index.cshtml* file originally had this code:</span></span>

[!code-cshtml[Main](the-fix-it-sample-application/samples/sample10.cshtml)]

<span data-ttu-id="c80e4-209">Ten element został zmieniony na:</span><span class="sxs-lookup"><span data-stu-id="c80e4-209">We changed it to this:</span></span>

[!code-cshtml[Main](the-fix-it-sample-application/samples/sample11.cshtml?highlight=1)]

### <a name="generate-urls-in-mvc-views-using-mvc-helpers"></a><span data-ttu-id="c80e4-210">Generowanie adresów URL w widokach MVC przy użyciu pomocników MVC</span><span class="sxs-lookup"><span data-stu-id="c80e4-210">Generate URLs in MVC views using MVC helpers</span></span>

<span data-ttu-id="c80e4-211">W przypadku przycisku **Utwórz poprawkę** do tej strony głównej aplikacja Poprawka It stała zakotwiczenie elementu:</span><span class="sxs-lookup"><span data-stu-id="c80e4-211">For the **Create a Fix It** button on the home page, the Fix It app hard coded an anchor element:</span></span>

[!code-cshtml[Main](the-fix-it-sample-application/samples/sample12.cshtml)]

<span data-ttu-id="c80e4-212">W przypadku linków do wyświetlania/akcji, takich jak ta, lepiej jest używać pomocnika HTML [. Action](https://msdn.microsoft.com/library/system.web.mvc.urlhelper.action.aspx) , na przykład:</span><span class="sxs-lookup"><span data-stu-id="c80e4-212">For View/Action links like this it's better to use the [Url.Action](https://msdn.microsoft.com/library/system.web.mvc.urlhelper.action.aspx) HTML helper, for example:</span></span>

[!code-cshtml[Main](the-fix-it-sample-application/samples/sample13.cshtml)]

### <a name="use-taskdelay-instead-of-threadsleep-in-worker-role"></a><span data-ttu-id="c80e4-213">Użyj zadania. opóźnienie zamiast wątku. uśpienia w roli procesu roboczego</span><span class="sxs-lookup"><span data-stu-id="c80e4-213">Use Task.Delay instead of Thread.Sleep in worker role</span></span>

<span data-ttu-id="c80e4-214">Szablon New-Project umieszcza `Thread.Sleep` w przykładowym kodzie dla roli proces roboczy, ale powoduje, że wątek przestanie być w stanie uśpienia w celu rozdzielenia dodatkowych niepotrzebnych wątków w puli wątków.</span><span class="sxs-lookup"><span data-stu-id="c80e4-214">The new-project template puts `Thread.Sleep` in the sample code for a worker role, but causing the thread to sleep can cause the thread pool to spawn additional unnecessary threads.</span></span> <span data-ttu-id="c80e4-215">Można uniknąć tego, aby zamiast tego użyć polecenia [Task. Delay](https://msdn.microsoft.com/library/hh139096.aspx) .</span><span class="sxs-lookup"><span data-stu-id="c80e4-215">You can avoid that by using [Task.Delay](https://msdn.microsoft.com/library/hh139096.aspx) instead.</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample14.cs?highlight=11)]

### <a name="avoid-async-void"></a><span data-ttu-id="c80e4-216">Unikaj asynchronicznego unieważnienia</span><span class="sxs-lookup"><span data-stu-id="c80e4-216">Avoid async void</span></span>

<span data-ttu-id="c80e4-217">Jeśli Metoda asynchroniczna nie musi zwracać wartości, zwróć typ `Task`, a nie `void`.</span><span class="sxs-lookup"><span data-stu-id="c80e4-217">If an async method doesn't need to return a value, return a `Task` type rather than `void`.</span></span>

<span data-ttu-id="c80e4-218">Ten przykład pochodzi z klasy `FixItQueueManager`:</span><span class="sxs-lookup"><span data-stu-id="c80e4-218">This example is from the `FixItQueueManager` class:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample15.cs)]

<span data-ttu-id="c80e4-219">Należy używać `async void` tylko dla programów obsługi zdarzeń najwyższego poziomu.</span><span class="sxs-lookup"><span data-stu-id="c80e4-219">You should use `async void` only for top-level event handlers.</span></span> <span data-ttu-id="c80e4-220">Jeśli określisz metodę jako `async void`, obiekt wywołujący nie może **czekać** na metodę ani wychwycić żadnych wyjątków zwracanych przez metodę.</span><span class="sxs-lookup"><span data-stu-id="c80e4-220">If you define a method as `async void`, the caller cannot **await** the method or catch any exceptions the method throws.</span></span> <span data-ttu-id="c80e4-221">Aby uzyskać więcej informacji, zobacz [najlepsze rozwiązania w programowaniu asynchronicznym](https://msdn.microsoft.com/magazine/jj991977.aspx).</span><span class="sxs-lookup"><span data-stu-id="c80e4-221">For more information, see [Best Practices in Asynchronous Programming](https://msdn.microsoft.com/magazine/jj991977.aspx).</span></span>

### <a name="use-a-cancellation-token-to-break-from-worker-role-loop"></a><span data-ttu-id="c80e4-222">Użyj tokenu anulowania, aby przerwać pętlę roli procesu roboczego</span><span class="sxs-lookup"><span data-stu-id="c80e4-222">Use a cancellation token to break from worker role loop</span></span>

<span data-ttu-id="c80e4-223">Typowo, Metoda **Run** w roli proces roboczy zawiera pętlę nieskończoną.</span><span class="sxs-lookup"><span data-stu-id="c80e4-223">Typically, the **Run** method on a worker role contains an infinite loop.</span></span> <span data-ttu-id="c80e4-224">Gdy rola procesu roboczego jest zatrzymywana, wywoływana jest metoda [RoleEntryPoint. OnStop](https://msdn.microsoft.com/library/windowsazure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstop.aspx) .</span><span class="sxs-lookup"><span data-stu-id="c80e4-224">When the worker role is stopping, the [RoleEntryPoint.OnStop](https://msdn.microsoft.com/library/windowsazure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstop.aspx) method is called.</span></span> <span data-ttu-id="c80e4-225">Tej metody należy użyć, aby anulować pracę wykonywaną wewnątrz metody **Run** i bezpiecznie zakończyć pracę.</span><span class="sxs-lookup"><span data-stu-id="c80e4-225">You should use this method to cancel the work that is being done inside the **Run** method and exit gracefully.</span></span> <span data-ttu-id="c80e4-226">W przeciwnym razie proces może zostać zakończony w trakcie operacji.</span><span class="sxs-lookup"><span data-stu-id="c80e4-226">Otherwise, the process might be terminated in the middle of an operation.</span></span>

### <a name="opt-out-of-automatic-mime-sniffing-procedure"></a><span data-ttu-id="c80e4-227">Rezygnacja z automatycznej procedury wykrywania MIME</span><span class="sxs-lookup"><span data-stu-id="c80e4-227">Opt out of Automatic MIME Sniffing Procedure</span></span>

<span data-ttu-id="c80e4-228">W niektórych przypadkach program Internet Explorer zgłasza typ MIME inny niż typ określony przez serwer sieci Web.</span><span class="sxs-lookup"><span data-stu-id="c80e4-228">In some cases, Internet Explorer reports a MIME type different than the type specified by the web server.</span></span> <span data-ttu-id="c80e4-229">Na przykład jeśli program Internet Explorer odnajdzie zawartość HTML w pliku dostarczonym z zawartością nagłówka odpowiedzi HTTP-Type: text/zwykły, program Internet Explorer określa, że zawartość powinna być renderowana jako HTML.</span><span class="sxs-lookup"><span data-stu-id="c80e4-229">For instance, if Internet Explorer finds HTML content in a file delivered with the HTTP response header Content-Type: text/plain, Internet Explorer determines that the content should be rendered as HTML.</span></span> <span data-ttu-id="c80e4-230">Niestety, to "wykrywanie MIME" może również prowadzić do problemów z zabezpieczeniami serwerów obsługujących niezaufaną zawartość.</span><span class="sxs-lookup"><span data-stu-id="c80e4-230">Unfortunately, this "MIME-sniffing" can also lead to security problems for servers hosting untrusted content.</span></span> <span data-ttu-id="c80e4-231">Aby rozwiązać ten problem, w programie Internet Explorer 8 wprowadzono wiele zmian w kodzie wyznaczania typów MIME i umożliwiają deweloperom aplikacji [rezygnację z wykrywania MIME](https://blogs.msdn.com/b/ie/archive/2008/07/02/ie8-security-part-v-comprehensive-protection.aspx).</span><span class="sxs-lookup"><span data-stu-id="c80e4-231">To combat this problem, Internet Explorer 8 has made a number of changes to MIME-type determination code and allows application developers to [opt out of MIME-sniffing](https://blogs.msdn.com/b/ie/archive/2008/07/02/ie8-security-part-v-comprehensive-protection.aspx).</span></span> <span data-ttu-id="c80e4-232">Następujący kod został dodany do pliku *Web. config* .</span><span class="sxs-lookup"><span data-stu-id="c80e4-232">The following code was added to the *Web.config* file.</span></span>

[!code-xml[Main](the-fix-it-sample-application/samples/sample16.xml?highlight=2-7)]

### <a name="enable-bundling-and-minification"></a><span data-ttu-id="c80e4-233">Włącz zgrupowanie i minifikacja</span><span class="sxs-lookup"><span data-stu-id="c80e4-233">Enable bundling and minification</span></span>

<span data-ttu-id="c80e4-234">Gdy program Visual Studio tworzy nowy projekt sieci Web, zgrupowanie i minifikacja plików JavaScript nie jest domyślnie włączona.</span><span class="sxs-lookup"><span data-stu-id="c80e4-234">When Visual Studio creates a new web project, bundling and minification of JavaScript files is not enabled by default.</span></span> <span data-ttu-id="c80e4-235">Dodaliśmy wiersz kodu w BundleConfig.cs:</span><span class="sxs-lookup"><span data-stu-id="c80e4-235">We added a line of code in BundleConfig.cs:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample17.cs?highlight=9)]

### <a name="set-an-expiration-time-out-for-authentication-cookies"></a><span data-ttu-id="c80e4-236">Ustawianie limitu czasu wygaśnięcia dla plików cookie uwierzytelniania</span><span class="sxs-lookup"><span data-stu-id="c80e4-236">Set an expiration time-out for authentication cookies</span></span>

<span data-ttu-id="c80e4-237">Domyślnie pliki cookie uwierzytelniania wygasają w dwóch tygodniach.</span><span class="sxs-lookup"><span data-stu-id="c80e4-237">By default, authentication cookies expire in two weeks.</span></span> <span data-ttu-id="c80e4-238">Krótszy czas jest bezpieczniejszy.</span><span class="sxs-lookup"><span data-stu-id="c80e4-238">A shorter time is more secure.</span></span> <span data-ttu-id="c80e4-239">To ustawienie można zmienić w *StartupAuth.cs*:</span><span class="sxs-lookup"><span data-stu-id="c80e4-239">You can change this setting in *StartupAuth.cs*:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample18.cs?highlight=4-5)]

<a id="run-in-vs"></a>
## <a name="how-to-run-the-app-from-visual-studio-on-your-local-computer"></a><span data-ttu-id="c80e4-240">Jak uruchomić aplikację z programu Visual Studio na komputerze lokalnym</span><span class="sxs-lookup"><span data-stu-id="c80e4-240">How to run the app from Visual Studio on your local computer</span></span>

<span data-ttu-id="c80e4-241">Istnieją dwa sposoby uruchamiania aplikacji Fix it:</span><span class="sxs-lookup"><span data-stu-id="c80e4-241">There are two ways to run the Fix It app:</span></span>

- <span data-ttu-id="c80e4-242">Uruchom aplikację podstawową, która zapisuje nowe zadania bezpośrednio w bazie danych SQL.</span><span class="sxs-lookup"><span data-stu-id="c80e4-242">Run the base application that writes new tasks directly to the SQL database.</span></span>
- <span data-ttu-id="c80e4-243">Uruchom aplikację przy użyciu kolejki oraz usługi wewnętrznej bazy danych, aby utworzyć zadania.</span><span class="sxs-lookup"><span data-stu-id="c80e4-243">Run the application using a queue plus a backend service to create tasks.</span></span> <span data-ttu-id="c80e4-244">Wzorzec kolejki jest opisany w rozdziale [roboczym zorientowanym na kolejki](queue-centric-work-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="c80e4-244">The queue pattern is described in the chapter [Queue-Centric Work Pattern](queue-centric-work-pattern.md).</span></span>

<a id="runbase"></a>
### <a name="run-the-base-application"></a><span data-ttu-id="c80e4-245">Uruchom aplikację podstawową</span><span class="sxs-lookup"><span data-stu-id="c80e4-245">Run the base application</span></span>

1. <span data-ttu-id="c80e4-246">Zainstaluj [program Visual Studio 2017](https://visualstudio.microsoft.com/downloads/?utm_medium=microsoft&utm_source=docs.microsoft.com&utm_campaign=button+cta&utm_content=download+vs2017).</span><span class="sxs-lookup"><span data-stu-id="c80e4-246">Install [Visual Studio 2017](https://visualstudio.microsoft.com/downloads/?utm_medium=microsoft&utm_source=docs.microsoft.com&utm_campaign=button+cta&utm_content=download+vs2017).</span></span>
2. <span data-ttu-id="c80e4-247">Zainstaluj [zestaw Azure SDK dla programu .NET dla programu Visual Studio](https://azure.microsoft.com/downloads/).</span><span class="sxs-lookup"><span data-stu-id="c80e4-247">Install the [Azure SDK for .NET for Visual Studio](https://azure.microsoft.com/downloads/).</span></span>
3. <span data-ttu-id="c80e4-248">Pobierz plik zip z [galerii kodu MSDN](https://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4).</span><span class="sxs-lookup"><span data-stu-id="c80e4-248">Download the .zip file from the [MSDN Code Gallery](https://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4).</span></span>
4. <span data-ttu-id="c80e4-249">W Eksploratorze plików kliknij prawym przyciskiem myszy plik zip, a następnie kliknij pozycję Właściwości, a następnie w okno Właściwości kliknij pozycję Odblokuj.</span><span class="sxs-lookup"><span data-stu-id="c80e4-249">In File Explorer, right-click the .zip file and click Properties, then in the Properties window click Unblock.</span></span>
5. <span data-ttu-id="c80e4-250">Rozpakuj plik.</span><span class="sxs-lookup"><span data-stu-id="c80e4-250">Unzip the file.</span></span>
6. <span data-ttu-id="c80e4-251">Kliknij dwukrotnie plik. sln, aby uruchomić program Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="c80e4-251">Double-click the .sln file to launch Visual Studio.</span></span>
7. <span data-ttu-id="c80e4-252">W menu **Narzędzia** kliknij kolejno pozycje **Menedżer pakietów NuGet**, **konsola Menedżera pakietów**.</span><span class="sxs-lookup"><span data-stu-id="c80e4-252">From the **Tools** menu, click **NuGet Package Manager**, then **Package Manager Console**.</span></span>
8. <span data-ttu-id="c80e4-253">W konsoli Menedżera pakietów (PMC) kliknij przycisk Przywróć.</span><span class="sxs-lookup"><span data-stu-id="c80e4-253">In the Package Manager Console (PMC), click Restore.</span></span>
9. <span data-ttu-id="c80e4-254">Zamknij program Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="c80e4-254">Exit Visual Studio.</span></span>
10. <span data-ttu-id="c80e4-255">Uruchom [emulator usługi Azure Storage](/azure/storage/common/storage-use-emulator).</span><span class="sxs-lookup"><span data-stu-id="c80e4-255">Start the [Azure storage emulator](/azure/storage/common/storage-use-emulator).</span></span>
11. <span data-ttu-id="c80e4-256">Uruchom ponownie program Visual Studio, otwierając plik rozwiązania zamknięty w poprzednim kroku.</span><span class="sxs-lookup"><span data-stu-id="c80e4-256">Restart Visual Studio, opening the solution file you closed in the previous step.</span></span>
12. <span data-ttu-id="c80e4-257">Upewnij się, że projekt FixIt jest ustawiony jako projekt startowy, a następnie naciśnij klawisze CTRL + F5, aby uruchomić projekt.</span><span class="sxs-lookup"><span data-stu-id="c80e4-257">Make sure the FixIt project is set as the startup project, and then press CTRL+F5 to run the project.</span></span>

<a id="queueslocal"></a>
### <a name="run-the-application-with-queue-processing"></a><span data-ttu-id="c80e4-258">Uruchamianie aplikacji przy użyciu przetwarzania kolejki</span><span class="sxs-lookup"><span data-stu-id="c80e4-258">Run the application with queue processing</span></span>

1. <span data-ttu-id="c80e4-259">Postępuj zgodnie z instrukcjami dotyczącymi [uruchamiania aplikacji podstawowej](#runbase), a następnie zamknij przeglądarkę i Zamknij program Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="c80e4-259">Follow the directions for [Run the base application](#runbase), and then close the browser and close Visual Studio.</span></span>
2. <span data-ttu-id="c80e4-260">Uruchom program Visual Studio z uprawnieniami administratora.</span><span class="sxs-lookup"><span data-stu-id="c80e4-260">Start Visual Studio with administrator privileges.</span></span> <span data-ttu-id="c80e4-261">(Będziesz korzystać z emulatora obliczeń platformy Azure, który wymaga uprawnień administratora).</span><span class="sxs-lookup"><span data-stu-id="c80e4-261">(You'll be using the Azure compute emulator, and that requires administrator privileges.)</span></span>
3. <span data-ttu-id="c80e4-262">W pliku *Web. config* aplikacji w projekcie *MyFixIt* (projekt sieci Web) Zmień wartość `appSettings/UseQueues` na "true":</span><span class="sxs-lookup"><span data-stu-id="c80e4-262">In the application *Web.config* file in the *MyFixIt* project (the web project), change the value of `appSettings/UseQueues` to "true":</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample19.cmd?highlight=3)]
4. <span data-ttu-id="c80e4-263">Jeśli [emulator usługi Azure Storage](https://msdn.microsoft.com/library/windowsazure/hh403989.aspx) nie jest nadal uruchomiony, uruchom go ponownie.</span><span class="sxs-lookup"><span data-stu-id="c80e4-263">If the [Azure storage emulator](https://msdn.microsoft.com/library/windowsazure/hh403989.aspx) isn't still running, start it again.</span></span>
5. <span data-ttu-id="c80e4-264">Uruchom projekt sieci Web FixIt i projekt MyFixItCloudService jednocześnie.</span><span class="sxs-lookup"><span data-stu-id="c80e4-264">Run the FixIt web project and the MyFixItCloudService project simultaneously.</span></span>

    <span data-ttu-id="c80e4-265">Korzystanie z programu Visual Studio:</span><span class="sxs-lookup"><span data-stu-id="c80e4-265">Using Visual Studio:</span></span>

   1. <span data-ttu-id="c80e4-266">Naciśnij klawisz **F5** , aby uruchomić projekt fixit.</span><span class="sxs-lookup"><span data-stu-id="c80e4-266">Press **F5** to run the FixIt project.</span></span>
   2. <span data-ttu-id="c80e4-267">W **Eksplorator rozwiązań**kliknij prawym przyciskiem myszy projekt MyFixItCloudService, a następnie kliknij pozycję **Debuguj** > **Uruchom nowe wystąpienie**.</span><span class="sxs-lookup"><span data-stu-id="c80e4-267">In **Solution Explorer**, right-click the MyFixItCloudService project, and then click **Debug** > **Start New Instance**.</span></span>

    <span data-ttu-id="c80e4-268">Korzystanie z programu Visual Studio 2013 Express for Web:</span><span class="sxs-lookup"><span data-stu-id="c80e4-268">Using Visual Studio 2013 Express for Web:</span></span>

   3. <span data-ttu-id="c80e4-269">W Eksplorator rozwiązań kliknij prawym przyciskiem myszy rozwiązanie FixIt i wybierz pozycję **Właściwości**.</span><span class="sxs-lookup"><span data-stu-id="c80e4-269">In Solution Explorer, right-click the FixIt solution and select **Properties**.</span></span>
   4. <span data-ttu-id="c80e4-270">Wybierz **wiele projektów startowych**.</span><span class="sxs-lookup"><span data-stu-id="c80e4-270">Select **Multiple Startup Projects**.</span></span>
   5. <span data-ttu-id="c80e4-271">Na liście rozwijanej **Akcja** w obszarze MyFixIt i MyFixItCloudService wybierz pozycję **Rozpocznij**.</span><span class="sxs-lookup"><span data-stu-id="c80e4-271">In the **Action** dropdown list under MyFixIt and MyFixItCloudService, select **Start**.</span></span>
   6. <span data-ttu-id="c80e4-272">Kliknij przycisk **OK**.</span><span class="sxs-lookup"><span data-stu-id="c80e4-272">Click **OK**.</span></span>
   7. <span data-ttu-id="c80e4-273">Naciśnij klawisz **F5** , aby uruchomić oba projekty.</span><span class="sxs-lookup"><span data-stu-id="c80e4-273">Press **F5** to run both projects.</span></span>

      <span data-ttu-id="c80e4-274">Po uruchomieniu projektu MyFixItCloudService program Visual Studio uruchamia emulator obliczeń platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="c80e4-274">When you run the MyFixItCloudService project, Visual Studio starts the Azure compute emulator.</span></span> <span data-ttu-id="c80e4-275">W zależności od konfiguracji zapory może być konieczne zezwolenie emulatora przez zaporę.</span><span class="sxs-lookup"><span data-stu-id="c80e4-275">Depending on your firewall configuration, you might need to allow the emulator through the firewall.</span></span>

<a id="deploybase"></a>
## <a name="how-to-deploy-the-base-app-to-azure-app-service-web-apps-by-using-the-windows-powershell-scripts"></a><span data-ttu-id="c80e4-276">Jak wdrożyć aplikację podstawową w Azure App Service Web Apps przy użyciu skryptów programu Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="c80e4-276">How to deploy the base app to Azure App Service Web Apps by using the Windows PowerShell scripts</span></span>

<span data-ttu-id="c80e4-277">Aby zilustrować zautomatyzowany wzorzec [wszystkiego](automate-everything.md) , poprawka aplikacji IT jest dostarczana ze skryptami, które konfigurują środowisko na platformie Azure i wdrażają projekt w nowym środowisku.</span><span class="sxs-lookup"><span data-stu-id="c80e4-277">To illustrate the [Automate Everything](automate-everything.md) pattern, the Fix It app is supplied with scripts that set up an environment in Azure and deploy the project to the new environment.</span></span> <span data-ttu-id="c80e4-278">Poniższe instrukcje wyjaśniają, jak używać skryptów.</span><span class="sxs-lookup"><span data-stu-id="c80e4-278">The following instructions explain how to use the scripts.</span></span>

<span data-ttu-id="c80e4-279">Jeśli chcesz uruchomić program na platformie Azure bez korzystania z kolejek, a zmiany mają być uruchamiane lokalnie z kolejkami, przed wykonaniem poniższych instrukcji upewnij się, że wartość UseQueues element appSetting została ustawiona na false.</span><span class="sxs-lookup"><span data-stu-id="c80e4-279">If you want to run in Azure without using queues, and you made the changes to run locally with queues, make sure you set the UseQueues appSetting value back to false before proceeding with the following instructions.</span></span>

<span data-ttu-id="c80e4-280">W tych instrukcjach przyjęto założenie, że zostało już pobrane i uruchomione rozwiązanie poprawki IT i że masz konto platformy Azure lub masz subskrypcję platformy Azure, którą chcesz zarządzać.</span><span class="sxs-lookup"><span data-stu-id="c80e4-280">These instructions assume you have already downloaded and run the Fix It solution locally, and that you have an Azure account or have an Azure subscription that you are authorized to manage.</span></span>

1. <span data-ttu-id="c80e4-281">Zainstaluj konsolę **Azure PowerShell** .</span><span class="sxs-lookup"><span data-stu-id="c80e4-281">Install the **Azure PowerShell** console.</span></span> <span data-ttu-id="c80e4-282">Aby uzyskać instrukcje, zobacz [How to Install and configure Azure PowerShell](https://docs.microsoft.com/powershell/azure/overview?view=azurermps-4.3.1).</span><span class="sxs-lookup"><span data-stu-id="c80e4-282">For instructions, see [How to install and configure Azure PowerShell](https://docs.microsoft.com/powershell/azure/overview?view=azurermps-4.3.1).</span></span>

    <span data-ttu-id="c80e4-283">Ta dostosowana konsola jest skonfigurowana do pracy z subskrypcją platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="c80e4-283">This customized console is configured to work with your Azure subscription.</span></span> <span data-ttu-id="c80e4-284">Moduł platformy Azure jest instalowany w katalogu *Program Files* i automatycznie importowany przy każdym użyciu konsoli Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="c80e4-284">The Azure module is installed in the *Program Files* directory and is automatically imported on every use of the Azure PowerShell console.</span></span>

    <span data-ttu-id="c80e4-285">Jeśli wolisz korzystać z innego programu hosta, takiego jak Windows PowerShell ISE, należy użyć polecenia cmdlet [Import-Module](https://go.microsoft.com/fwlink/?LinkID=141553) do zaimportowania modułu platformy Azure lub użyć polecenia w module platformy Azure, aby wyzwolić automatyczne Importowanie modułu.</span><span class="sxs-lookup"><span data-stu-id="c80e4-285">If you prefer to work in a different host program, such as Windows PowerShell ISE, be sure to use the [Import-Module](https://go.microsoft.com/fwlink/?LinkID=141553) cmdlet to import the Azure module or use a command in the Azure module to trigger automatic importing of the module.</span></span>
2. <span data-ttu-id="c80e4-286">Uruchom Azure PowerShell przy użyciu opcji **Uruchom jako administrator** .</span><span class="sxs-lookup"><span data-stu-id="c80e4-286">Start Azure PowerShell with the **Run as administrator** option.</span></span>
3. <span data-ttu-id="c80e4-287">Uruchom polecenie cmdlet [Set-executionpolicy](https://go.microsoft.com/fwlink/p/?linkid=293941) , aby ustawić zasady wykonywania Azure PowerShell na `RemoteSigned`.</span><span class="sxs-lookup"><span data-stu-id="c80e4-287">Run the [Set-ExecutionPolicy](https://go.microsoft.com/fwlink/p/?linkid=293941) cmdlet to set the Azure PowerShell execution policy to `RemoteSigned`.</span></span> <span data-ttu-id="c80e4-288">Wprowadź wartość **Y** (tak), aby zakończyć zmianę zasad.</span><span class="sxs-lookup"><span data-stu-id="c80e4-288">Enter **Y** (for Yes) to complete the policy change.</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample20.cmd)]

    <span data-ttu-id="c80e4-289">To ustawienie umożliwia uruchamianie lokalnych skryptów, które nie są podpisane cyfrowo.</span><span class="sxs-lookup"><span data-stu-id="c80e4-289">This setting enables you to run local scripts that aren't digitally signed.</span></span> <span data-ttu-id="c80e4-290">(Można również ustawić zasady wykonywania na `Unrestricted`, co eliminuje konieczność późniejszego odblokowania, ale nie jest to zalecane ze względów bezpieczeństwa).</span><span class="sxs-lookup"><span data-stu-id="c80e4-290">(You can also set the execution policy to `Unrestricted`, which would eliminate the need for the unblock step later, but this is not recommended for security reasons.)</span></span>
4. <span data-ttu-id="c80e4-291">Uruchom polecenie cmdlet `Add-AzureAccount`, aby skonfigurować program PowerShell z poświadczeniami dla Twojego konta.</span><span class="sxs-lookup"><span data-stu-id="c80e4-291">Run the `Add-AzureAccount` cmdlet to set up PowerShell with credentials for your account.</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample21.cmd)]

    <span data-ttu-id="c80e4-292">Te poświadczenia wygasną po upływie upływu czasu i konieczne będzie ponowne uruchomienie `Add-AzureAccount`go polecenia cmdlet.</span><span class="sxs-lookup"><span data-stu-id="c80e4-292">These credentials expire after a period of time and you have to re-run the `Add-AzureAccount` cmdlet.</span></span> <span data-ttu-id="c80e4-293">Podczas pisania tej książki elektronicznej limit czasu przed wygaśnięciem poświadczeń wynosi 12 godzin.</span><span class="sxs-lookup"><span data-stu-id="c80e4-293">As this e-book is being written, the time limit before credentials expire is 12 hours.</span></span>
5. <span data-ttu-id="c80e4-294">Jeśli masz wiele subskrypcji, użyj polecenia cmdlet Select-AzureSubscription, aby określić subskrypcję, w której chcesz utworzyć środowisko testowe.</span><span class="sxs-lookup"><span data-stu-id="c80e4-294">If you have multiple subscriptions, use the Select-AzureSubscription cmdlet to specify the subscription you want to create the test environment in.</span></span>
6. <span data-ttu-id="c80e4-295">Zaimportuj certyfikat zarządzania dla tej samej subskrypcji platformy Azure za pomocą poleceń cmdlet `Get-AzurePublishSettingsFile` i `Import-AzurePublishSettingsFile`.</span><span class="sxs-lookup"><span data-stu-id="c80e4-295">Import a management certificate for the same Azure subscription by using the `Get-AzurePublishSettingsFile` and `Import-AzurePublishSettingsFile` cmdlets.</span></span> <span data-ttu-id="c80e4-296">Pierwsze z tych poleceń cmdlet pobiera plik certyfikatu, a drugi określa lokalizację tego pliku do zaimportowania.</span><span class="sxs-lookup"><span data-stu-id="c80e4-296">The first of these cmdlets downloads a certificate file, and in the second one you specify the location of that file in order to import it.</span></span> > [!IMPORTANT]
   > <span data-ttu-id="c80e4-297">Zachowaj pobrany plik w bezpiecznym miejscu lub usuń go po zakończeniu pracy z nim, ponieważ zawiera certyfikat, którego można użyć do zarządzania usługami platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="c80e4-297">Keep the downloaded file in a safe location or delete it when you're done with it, because it contains a certificate that can be used to manage your Azure services.</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample22.cmd)]

    <span data-ttu-id="c80e4-298">Certyfikat jest używany do wywołania interfejsu API REST, który wykrywa adres IP maszyny deweloperskiej w celu ustawienia reguły zapory na serwerze SQL Database.</span><span class="sxs-lookup"><span data-stu-id="c80e4-298">The certificate is used for a REST API call that detects the development machine's IP address in order to set a firewall rule on the SQL Database server.</span></span>
7. <span data-ttu-id="c80e4-299">Uruchom polecenie cmdlet [Set-Location](https://go.microsoft.com/fwlink/p/?linkid=293912) (aliasy są `cd`, `chdir`i `sl`), aby przejść do katalogu zawierającego skrypty.</span><span class="sxs-lookup"><span data-stu-id="c80e4-299">Run the [Set-Location](https://go.microsoft.com/fwlink/p/?linkid=293912) cmdlet (aliases are `cd`, `chdir`, and `sl`) to navigate to the directory that contains the scripts.</span></span> <span data-ttu-id="c80e4-300">(Znajdują się one w folderze *Automation* w folderze rozwiązanie IT). Ścieżka należy umieścić w cudzysłowie, jeśli którykolwiek z nazw katalogów zawiera spacje.</span><span class="sxs-lookup"><span data-stu-id="c80e4-300">(They're located in the *Automation* folder in the Fix It solution folder.) Put the path in quotes if any of the directory names contain spaces.</span></span> <span data-ttu-id="c80e4-301">Na przykład, aby przejść do katalogu `c:\Sample Apps\FixIt\Automation`, można wprowadzić następujące polecenie:</span><span class="sxs-lookup"><span data-stu-id="c80e4-301">For example, to navigate to the `c:\Sample Apps\FixIt\Automation` directory you could enter the following command:</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample23.cmd)]
8. <span data-ttu-id="c80e4-302">Aby można było uruchamiać te skrypty za pomocą programu Windows PowerShell, należy użyć polecenia cmdlet [odblokowywania pliku](https://go.microsoft.com/fwlink/p/?linkid=294021) .</span><span class="sxs-lookup"><span data-stu-id="c80e4-302">To allow Windows PowerShell to run these scripts, use the [Unblock-File](https://go.microsoft.com/fwlink/p/?linkid=294021) cmdlet.</span></span> <span data-ttu-id="c80e4-303">(Skrypty są blokowane, ponieważ zostały pobrane z Internetu).</span><span class="sxs-lookup"><span data-stu-id="c80e4-303">(The scripts are blocked because they were downloaded from the Internet.)</span></span>

    > [!WARNING]
    > <span data-ttu-id="c80e4-304">Zabezpieczenia — przed uruchomieniem `Unblock-File` na dowolnym skrypcie lub pliku wykonywalnym Otwórz plik w Notatniku, sprawdź polecenia i sprawdź, czy nie zawierają one złośliwego kodu.</span><span class="sxs-lookup"><span data-stu-id="c80e4-304">Security - Before running `Unblock-File` on any script or executable file, open the file in Notepad, examine the commands, and verify that they do not contain any malicious code.</span></span>

    <span data-ttu-id="c80e4-305">Na przykład następujące polecenie uruchamia `Unblock-File` polecenie cmdlet dla wszystkich skryptów w bieżącym katalogu.</span><span class="sxs-lookup"><span data-stu-id="c80e4-305">For example, the following command runs the `Unblock-File` cmdlet on all scripts in the current directory.</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample24.cmd)]
9. <span data-ttu-id="c80e4-306">Aby utworzyć aplikację sieci Web dla bazy (bez przetwarzania kolejek), należy uruchomić skrypt tworzenia środowiska.</span><span class="sxs-lookup"><span data-stu-id="c80e4-306">To create the web app for the base (no queues processing) Fix It app, run the environment creation script.</span></span>

    <span data-ttu-id="c80e4-307">Wymagany `Name` parametr określa nazwę bazy danych i jest również używany dla konta magazynu tworzonego przez skrypt.</span><span class="sxs-lookup"><span data-stu-id="c80e4-307">The required `Name` parameter specifies the name of the database and is also used for the storage account that the script creates.</span></span> <span data-ttu-id="c80e4-308">Nazwa musi być globalnie unikatowa w domenie azurewebsites.net.</span><span class="sxs-lookup"><span data-stu-id="c80e4-308">The name must be globally unique within the azurewebsites.net domain.</span></span> <span data-ttu-id="c80e4-309">Jeśli określisz nazwę, która nie jest unikatowa, np. fixit lub test (lub nawet tak jak w przykładzie, fixitdemo), polecenie cmdlet `New-AzureWebsite` kończy się niepowodzeniem z powodu wewnętrznego błędu, który zgłasza konflikt.</span><span class="sxs-lookup"><span data-stu-id="c80e4-309">If you specify a name that is not unique, like Fixit or Test (or even as in the example, fixitdemo), the `New-AzureWebsite` cmdlet fails with an Internal Error that reports a conflict.</span></span> <span data-ttu-id="c80e4-310">Skrypt konwertuje nazwę na małe litery, aby zapewnić zgodność z wymaganiami dotyczącymi nazw dla aplikacji sieci Web, kont magazynu i baz danych.</span><span class="sxs-lookup"><span data-stu-id="c80e4-310">The script converts the name to all lower-case to comply with name requirements for web apps, storage accounts, and databases.</span></span>

    <span data-ttu-id="c80e4-311">Wymagany `SqlDatabasePassword` parametr określa hasło dla konta administratora, które zostanie utworzone dla SQL Database.</span><span class="sxs-lookup"><span data-stu-id="c80e4-311">The required `SqlDatabasePassword` parameter specifies the password for the admin account that will be created for SQL Database.</span></span> <span data-ttu-id="c80e4-312">Nie dodawaj specjalnych znaków XML w haśle (&amp; &lt; &gt;;).</span><span class="sxs-lookup"><span data-stu-id="c80e4-312">Don't include special XML characters in the password (&amp; &lt; &gt; ;).</span></span> <span data-ttu-id="c80e4-313">Jest to ograniczenie sposobu pisania skryptów, a nie ograniczenia platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="c80e4-313">This is a limitation of the way the scripts were written, not a limitation of Azure.</span></span>

    <span data-ttu-id="c80e4-314">Jeśli na przykład chcesz utworzyć aplikację sieci Web o nazwie "fixitdemo" i użyć hasła administratora SQL Server "Passw0rd1", możesz wprowadzić następujące polecenie:</span><span class="sxs-lookup"><span data-stu-id="c80e4-314">For example, if you want to create a web app named "fixitdemo" and use a SQL Server administrator password of "Passw0rd1", you could enter the following command:</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample25.cmd)]

    <span data-ttu-id="c80e4-315">Nazwa musi być unikatowa w domenie azurewebsites.net, a hasło musi spełniać SQL Database wymagania dotyczące złożoności hasła.</span><span class="sxs-lookup"><span data-stu-id="c80e4-315">The name must be unique in the azurewebsites.net domain, and the password must meet SQL Database requirements for password complexity.</span></span> <span data-ttu-id="c80e4-316">(Przykład Passw0rd1 spełnia wymagania).</span><span class="sxs-lookup"><span data-stu-id="c80e4-316">(The example Passw0rd1 does meet the requirements.)</span></span>

    <span data-ttu-id="c80e4-317">Należy pamiętać, że polecenie zaczyna się od ".\".</span><span class="sxs-lookup"><span data-stu-id="c80e4-317">Note that the command begins with ".\".</span></span> <span data-ttu-id="c80e4-318">Aby zapobiec złośliwemu wykonywaniu skryptów, program Windows PowerShell wymaga podania w pełni kwalifikowanej ścieżki do pliku skryptu podczas uruchamiania skryptu.</span><span class="sxs-lookup"><span data-stu-id="c80e4-318">To help prevent malicious execution of scripts, Windows PowerShell requires that you provide the fully qualified path to the script file when you run a script.</span></span> <span data-ttu-id="c80e4-319">Możesz użyć kropki, aby wskazać bieżący katalog (".\") lub podaj w pełni kwalifikowaną ścieżkę, taką jak:</span><span class="sxs-lookup"><span data-stu-id="c80e4-319">You can use a dot to indicate the current directory (".\") or provide the fully qualified path, such as:</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample26.cmd)]

    <span data-ttu-id="c80e4-320">Aby uzyskać więcej informacji na temat skryptu, użyj polecenia cmdlet `Get-Help`.</span><span class="sxs-lookup"><span data-stu-id="c80e4-320">For more information about the script, use the `Get-Help` cmdlet.</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample27.cmd)]

    <span data-ttu-id="c80e4-321">Możesz użyć parametrów `Detailed`, `Full`, `Parameters`i `Examples` polecenia cmdlet Get-Help, aby odfiltrować zwracaną pomoc.</span><span class="sxs-lookup"><span data-stu-id="c80e4-321">You can use the `Detailed`, `Full`, `Parameters`, and `Examples` parameters of the Get-Help cmdlet to filter the help that is returned.</span></span>

    <span data-ttu-id="c80e4-322">Jeśli skrypt zakończy się niepowodzeniem lub generuje błędy, takie jak "New-AzureWebsite: Call Set-AzureSubscription i Select-AzureSubscription First", prawdopodobnie nie ukończono konfiguracji Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="c80e4-322">If the script fails or generates errors, such as "New-AzureWebsite : Call Set-AzureSubscription and Select-AzureSubscription first," you might not have completed the configuration of Azure PowerShell.</span></span>

    <span data-ttu-id="c80e4-323">Po zakończeniu działania skryptu możesz użyć portal zarządzania platformy Azure, aby wyświetlić zasoby, które zostały utworzone, jak pokazano w rozdziale [Automatyzowanie wszystkiego](automate-everything.md) .</span><span class="sxs-lookup"><span data-stu-id="c80e4-323">After the script finishes, you can use the Azure Management Portal to see the resources that were created, as shown in the [Automate Everything](automate-everything.md) chapter.</span></span>
10. <span data-ttu-id="c80e4-324">Aby wdrożyć projekt FixIt w nowym środowisku platformy Azure, Użyj skryptu *AzureWebsite. ps1* .</span><span class="sxs-lookup"><span data-stu-id="c80e4-324">To deploy the FixIt project to the new Azure environment, use the *AzureWebsite.ps1* script.</span></span> <span data-ttu-id="c80e4-325">Na przykład:</span><span class="sxs-lookup"><span data-stu-id="c80e4-325">For example:</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample28.cmd)]

    <span data-ttu-id="c80e4-326">Po zakończeniu wdrażania zostanie otwarta przeglądarka z poprawkami działającymi na platformie Azure.</span><span class="sxs-lookup"><span data-stu-id="c80e4-326">When deployment is done, the browser opens with Fix It running in Azure.</span></span>

<a id="troubleshooting"></a>
## <a name="troubleshooting-the-windows-powershell-scripts"></a><span data-ttu-id="c80e4-327">Rozwiązywanie problemów ze skryptami programu Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="c80e4-327">Troubleshooting the Windows PowerShell scripts</span></span>

<span data-ttu-id="c80e4-328">Najczęstsze błędy występujące podczas uruchamiania tych skryptów są związane z uprawnieniami.</span><span class="sxs-lookup"><span data-stu-id="c80e4-328">The most common errors encountered when running these scripts are related to permissions.</span></span> <span data-ttu-id="c80e4-329">Upewnij się, że `Add-AzureAccount` i `Import-AzurePublishSettingsFile` zostały pomyślnie i zostały użyte dla tej samej subskrypcji platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="c80e4-329">Make sure that `Add-AzureAccount` and `Import-AzurePublishSettingsFile` were successful and that you used them for the same Azure subscription.</span></span> <span data-ttu-id="c80e4-330">Nawet w przypadku pomyślnego `Add-AzureAccount` może być konieczne jego ponowne uruchomienie.</span><span class="sxs-lookup"><span data-stu-id="c80e4-330">Even if `Add-AzureAccount` was successful you might have to run it again.</span></span> <span data-ttu-id="c80e4-331">Uprawnienia dodane przez `Add-AzureAccount` wygasną w ciągu 12 godzin.</span><span class="sxs-lookup"><span data-stu-id="c80e4-331">The permissions added by `Add-AzureAccount` expire in 12 hours.</span></span>

### <a name="object-reference-not-set-to-an-instance-of-an-object"></a><span data-ttu-id="c80e4-332">Odwołanie do obiektu nie jest ustawione na wystąpienie obiektu.</span><span class="sxs-lookup"><span data-stu-id="c80e4-332">Object reference not set to an instance of an object.</span></span>

<span data-ttu-id="c80e4-333">Jeśli skrypt zwróci błędy, takie jak "odwołanie do obiektu nie jest ustawione na wystąpienie obiektu", co oznacza, że środowisko Windows PowerShell nie może znaleźć obiektu do przetworzenia (jest to wyjątek odwołania o wartości null), uruchom polecenie cmdlet `Add-AzureAccount` i spróbuj ponownie wykonać skrypt.</span><span class="sxs-lookup"><span data-stu-id="c80e4-333">If the script returns errors, such as "Object reference not set to an instance of an object," which means that Windows PowerShell can't find an object to process (this is a null reference exception), run the `Add-AzureAccount` cmdlet and try the script again.</span></span>

[!code-console[Main](the-fix-it-sample-application/samples/sample29.cmd)]

### <a name="internalerror-the-server-encountered-an-internal-error"></a><span data-ttu-id="c80e4-334">InternalError: Serwer napotkał błąd wewnętrzny.</span><span class="sxs-lookup"><span data-stu-id="c80e4-334">InternalError: The server encountered an internal error.</span></span>

<span data-ttu-id="c80e4-335">`New-AzureWebsite` polecenie cmdlet zwraca błąd wewnętrzny, gdy nazwa nie jest unikatowa w domenie azurewebsites.net.</span><span class="sxs-lookup"><span data-stu-id="c80e4-335">The `New-AzureWebsite` cmdlet returns an internal error when the name is not unique in the azurewebsites.net domain.</span></span> <span data-ttu-id="c80e4-336">Aby rozwiązać ten problem, użyj innej wartości dla nazwy, która znajduje się w parametrze name elementu *New-AzureWebsiteEnv. ps1*.</span><span class="sxs-lookup"><span data-stu-id="c80e4-336">To resolve the error, use a different value for the name, which is in the Name parameter of *New-AzureWebsiteEnv.ps1*.</span></span>

[!code-console[Main](the-fix-it-sample-application/samples/sample30.cmd)]

### <a name="restarting-the-script"></a><span data-ttu-id="c80e4-337">Ponowne uruchamianie skryptu</span><span class="sxs-lookup"><span data-stu-id="c80e4-337">Restarting the script</span></span>

<span data-ttu-id="c80e4-338">Jeśli konieczne jest ponowne uruchomienie skryptu *New-AzureWebsiteEnv. ps1* , ponieważ nie powiodło się, zanim wywydrukowano komunikat "skrypt jest kompletny", można usunąć zasoby utworzone przez skrypt przed jego zatrzymaniem.</span><span class="sxs-lookup"><span data-stu-id="c80e4-338">If you need to restart the *New-AzureWebsiteEnv.ps1* script because it failed before it printed the "Script is complete" message, you might want to delete resources that the script created before it stopped.</span></span> <span data-ttu-id="c80e4-339">Jeśli na przykład skrypt utworzył już aplikację sieci Web ContosoFixItDemo, a skrypt zostanie uruchomiony ponownie z tą samą nazwą, skrypt zakończy się niepowodzeniem, ponieważ nazwa jest w użyciu.</span><span class="sxs-lookup"><span data-stu-id="c80e4-339">For example, if the script already created the ContosoFixItDemo web app and you run the script again with the same name, the script will fail because the name is in use.</span></span>

<span data-ttu-id="c80e4-340">Aby określić, które zasoby utworzono przed zatrzymaniem skryptu, użyj następujących poleceń cmdlet:</span><span class="sxs-lookup"><span data-stu-id="c80e4-340">To determine which resources the script created before it stopped, use the following cmdlets:</span></span>

- `Get-AzureWebsite`
- `Get-AzureSqlDatabaseServer`
- <span data-ttu-id="c80e4-341">`Get-AzureSqlDatabase`: Aby uruchomić to polecenie cmdlet, potoku nazwę serwera bazy danych do `Get-AzureSqlDatabase`: `Get-AzureSqlDatabaseServer | Get-AzureSqlDatabase.`</span><span class="sxs-lookup"><span data-stu-id="c80e4-341">`Get-AzureSqlDatabase`: To run this cmdlet, pipe the database server name to `Get-AzureSqlDatabase`:   `Get-AzureSqlDatabaseServer | Get-AzureSqlDatabase.`</span></span>

<span data-ttu-id="c80e4-342">Aby usunąć te zasoby, użyj następujących poleceń.</span><span class="sxs-lookup"><span data-stu-id="c80e4-342">To delete these resources, use the following commands.</span></span> <span data-ttu-id="c80e4-343">Należy pamiętać, że w przypadku usunięcia serwera bazy danych program automatycznie usunie bazy danych skojarzone z serwerem.</span><span class="sxs-lookup"><span data-stu-id="c80e4-343">Note that if you delete the database server, you automatically delete the databases associated with the server.</span></span>

- `Get-AzureWebsite -Name <WebsiteName> | Remove-AzureWebsite`
- `Get-AzureSqlDatabase -Name <DatabaseName> -ServerName <DatabaseServerName> | Remove-SqlAzureDatabase`
- `Get-AzureSqlDatabaseServer | Remove-AzureSqlDatabaseServer`

<a id="deployqueues"></a>
## <a name="how-to-deploy-the-app-with-queue-processing-to-azure-app-service-web-apps-and-an-azure-cloud-service"></a><span data-ttu-id="c80e4-344">Jak wdrożyć aplikację przy użyciu przetwarzania w kolejce w celu Azure App Service Web Apps i usługi w chmurze platformy Azure</span><span class="sxs-lookup"><span data-stu-id="c80e4-344">How to deploy the app with queue processing to Azure App Service Web Apps and an Azure Cloud Service</span></span>

<span data-ttu-id="c80e4-345">Aby włączyć kolejki, wprowadź następujące zmiany w pliku MyFixIt\Web.config.</span><span class="sxs-lookup"><span data-stu-id="c80e4-345">To enable queues, make the following change in the MyFixIt\Web.config file.</span></span> <span data-ttu-id="c80e4-346">W obszarze `appSettings`Zmień wartość `UseQueues` na "true":</span><span class="sxs-lookup"><span data-stu-id="c80e4-346">Under `appSettings`, change the value of `UseQueues` to "true":</span></span>

[!code-xml[Main](the-fix-it-sample-application/samples/sample31.xml)]

<span data-ttu-id="c80e4-347">Następnie wdróż aplikację MVC w aplikacji sieci Web w Azure App Service, zgodnie z [wcześniejszym](#deploybase)opisem.</span><span class="sxs-lookup"><span data-stu-id="c80e4-347">Then deploy the MVC application to an web app in Azure App Service, as described [earlier](#deploybase).</span></span>

<span data-ttu-id="c80e4-348">Następnie utwórz nową usługę w chmurze platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="c80e4-348">Next, create a new Azure cloud service.</span></span> <span data-ttu-id="c80e4-349">Skrypty dołączone do aplikacji Fix it nie tworzą ani nie wdrażają usługi w chmurze, dlatego należy użyć Azure Portal.</span><span class="sxs-lookup"><span data-stu-id="c80e4-349">The scripts included with the Fix It app do not create or deploy the cloud service, so you must use Azure portal for this.</span></span> <span data-ttu-id="c80e4-350">W portalu kliknij kolejno pozycje **nowy** -- **obliczenia** — **Usługa w chmurze** -- **szybkie tworzenie**, a następnie wprowadź adres URL i lokalizację centrum danych.</span><span class="sxs-lookup"><span data-stu-id="c80e4-350">In the portal, click **New** -- **Compute** – **Cloud Service** -- **Quick Create**, and then enter a URL and a data center location.</span></span> <span data-ttu-id="c80e4-351">Użyj tego samego centrum danych, w którym została wdrożona aplikacja internetowa.</span><span class="sxs-lookup"><span data-stu-id="c80e4-351">Use the same data center where you deployed the web app.</span></span>

![](the-fix-it-sample-application/_static/image1.png)

<span data-ttu-id="c80e4-352">Aby można było wdrożyć usługę w chmurze, należy zaktualizować niektóre pliki konfiguracji.</span><span class="sxs-lookup"><span data-stu-id="c80e4-352">Before you can deploy the cloud service, you need to update some of the configuration files.</span></span>

<span data-ttu-id="c80e4-353">W MyFixIt. WorkerRole\app.config w obszarze `connectionStrings`Zastąp wartość parametrów połączenia `appdb` z rzeczywistymi parametrami połączenia dla SQL Database.</span><span class="sxs-lookup"><span data-stu-id="c80e4-353">In MyFixIt.WorkerRole\app.config, under `connectionStrings`, replace the value of the `appdb` connection string with the actual connection string for the SQL Database.</span></span> <span data-ttu-id="c80e4-354">Parametry połączenia można uzyskać z portalu.</span><span class="sxs-lookup"><span data-stu-id="c80e4-354">You can get the connection string from the portal.</span></span> <span data-ttu-id="c80e4-355">W portalu kliknij pozycję **bazy danych SQL** - **AppDB** - **Wyświetl parametry połączenia SQL Database dla obiektów ADO .NET, ODBC, php i JDBC**.</span><span class="sxs-lookup"><span data-stu-id="c80e4-355">In the portal, click **SQL Databases** - **appdb** - **View SQL Database connection strings for ADO .Net, ODBC, PHP, and JDBC**.</span></span> <span data-ttu-id="c80e4-356">Skopiuj parametry połączenia ADO.NET i wklej wartość do pliku App. config.</span><span class="sxs-lookup"><span data-stu-id="c80e4-356">Copy the ADO.NET connection string and paste the value into the app.config file.</span></span> <span data-ttu-id="c80e4-357">Zastąp ciąg "{Twoim\_hasłem\_tutaj}" hasłem Twojej bazy danych.</span><span class="sxs-lookup"><span data-stu-id="c80e4-357">Replace "{your\_password\_here}" with your database password.</span></span> <span data-ttu-id="c80e4-358">(Przy założeniu, że do wdrożenia aplikacji MVC użyto skryptów, w parametrze skryptu `SqlDatabasePassword` określono hasło bazy danych).</span><span class="sxs-lookup"><span data-stu-id="c80e4-358">(Assuming you used the scripts to deploy the MVC app, you specified the database password in the `SqlDatabasePassword` script parameter.)</span></span>

<span data-ttu-id="c80e4-359">Wynik powinien wyglądać następująco:</span><span class="sxs-lookup"><span data-stu-id="c80e4-359">The result should look like the following:</span></span>

[!code-xml[Main](the-fix-it-sample-application/samples/sample32.xml)]

<span data-ttu-id="c80e4-360">W tym samym pliku MyFixIt. WorkerRole\app.config w obszarze `appSettings`Zamień dwie wartości zastępcze dla konta usługi Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="c80e4-360">In the same MyFixIt.WorkerRole\app.config file, under `appSettings`, replace the two placeholder values for the Azure storage account.</span></span>

[!code-xml[Main](the-fix-it-sample-application/samples/sample33.xml?highlight=2-3)]

<span data-ttu-id="c80e4-361">Klucz dostępu można uzyskać z portalu.</span><span class="sxs-lookup"><span data-stu-id="c80e4-361">You can get the access key from the portal.</span></span> <span data-ttu-id="c80e4-362">Zobacz [jak zarządzać kontami magazynu](https://docs.microsoft.com/azure/storage/common/storage-create-storage-account).</span><span class="sxs-lookup"><span data-stu-id="c80e4-362">See [How To Manage Storage Accounts](https://docs.microsoft.com/azure/storage/common/storage-create-storage-account).</span></span>

<span data-ttu-id="c80e4-363">W programie MyFixItCloudService\ServiceConfiguration.Cloud.cscfg Zastąp te same dwa symbole zastępcze dla konta usługi Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="c80e4-363">In MyFixItCloudService\ServiceConfiguration.Cloud.cscfg, replace the same two placeholders values for the Azure storage account.</span></span>

[!code-xml[Main](the-fix-it-sample-application/samples/sample34.xml?highlight=3)]

<span data-ttu-id="c80e4-364">Teraz możesz przystąpić do wdrażania usługi w chmurze.</span><span class="sxs-lookup"><span data-stu-id="c80e4-364">Now you are ready to deploy the cloud service.</span></span> <span data-ttu-id="c80e4-365">W oknie Eksplorowanie rozwiązań kliknij prawym przyciskiem myszy projekt MyFixItCloudService i wybierz polecenie **Publikuj**.</span><span class="sxs-lookup"><span data-stu-id="c80e4-365">In Solution Explore, right-click the MyFixItCloudService project and select **Publish**.</span></span> <span data-ttu-id="c80e4-366">Aby uzyskać więcej informacji, zobacz sekcję "[wdrażanie aplikacji na platformie Azure](https://www.windowsazure.com/develop/net/tutorials/multi-tier-web-site/2-download-and-run/#deployAz)", która znajduje się w części 2 [tego samouczka](https://code.msdn.microsoft.com/Windows-Azure-Multi-Tier-eadceb36).</span><span class="sxs-lookup"><span data-stu-id="c80e4-366">For more information, see "[Deploy the Application to Azure](https://www.windowsazure.com/develop/net/tutorials/multi-tier-web-site/2-download-and-run/#deployAz)", which is in part 2 of [this tutorial](https://code.msdn.microsoft.com/Windows-Azure-Multi-Tier-eadceb36).</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="c80e4-367">Ubiegł</span><span class="sxs-lookup"><span data-stu-id="c80e4-367">Previous</span></span>](more-patterns-and-guidance.md)
