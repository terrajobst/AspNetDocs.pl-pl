---
uid: signalr/overview/getting-started/real-time-web-applications-with-signalr
title: 'Ćwiczenia: aplikacje sieci Web w czasie rzeczywistym za pomocą sygnalizującego | Microsoft Docs'
author: bradygaster
description: Aplikacje sieci Web w czasie rzeczywistym umożliwiają wypychanie zawartości po stronie serwera do podłączonych klientów w czasie rzeczywistym. Dla deweloperów ASP.NET, ASP...
ms.author: bradyg
ms.date: 07/16/2014
ms.assetid: ba07958c-42e1-4da0-81db-ba6925ed6db0
msc.legacyurl: /signalr/overview/getting-started/real-time-web-applications-with-signalr
msc.type: authoredcontent
ms.openlocfilehash: 9e39fd3f2fc9d4e791002450085215096c222fcd
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 03/06/2020
ms.locfileid: "78537101"
---
# <a name="hands-on-lab-real-time-web-applications-with-signalr"></a><span data-ttu-id="38c58-104">Ćwiczenia praktyczne: aplikacje internetowe czasu rzeczywistego z wykorzystaniem usługi SignalR</span><span class="sxs-lookup"><span data-stu-id="38c58-104">Hands On Lab: Real-Time Web Applications with SignalR</span></span>

<span data-ttu-id="38c58-105">przez [zespół Camp sieci Web](https://twitter.com/webcamps)</span><span class="sxs-lookup"><span data-stu-id="38c58-105">by [Web Camps Team](https://twitter.com/webcamps)</span></span>

[!INCLUDE [Consider ASP.NET Core SignalR](~/includes/signalr/signalr-version-disambiguation.md)]

[<span data-ttu-id="38c58-106">Pobierz zestaw szkoleniowy dla sieci Web Camp, wydanie z października 2015</span><span class="sxs-lookup"><span data-stu-id="38c58-106">Download Web Camps Training Kit, October 2015 Release</span></span>](https://github.com/Microsoft-Web/WebCampTrainingKit/releases/tag/v2015.10.13b)

> <span data-ttu-id="38c58-107">Aplikacje sieci Web w czasie rzeczywistym umożliwiają wypychanie zawartości po stronie serwera do podłączonych klientów w czasie rzeczywistym.</span><span class="sxs-lookup"><span data-stu-id="38c58-107">Real-time Web applications feature the ability to push server-side content to the connected clients as it happens, in real-time.</span></span> <span data-ttu-id="38c58-108">W przypadku deweloperów ASP.NET, **sygnalizujący ASP.NET** to biblioteka umożliwiająca dodawanie funkcji sieci Web w czasie rzeczywistym do aplikacji.</span><span class="sxs-lookup"><span data-stu-id="38c58-108">For ASP.NET developers, **ASP.NET SignalR** is a library to add real-time web functionality to their applications.</span></span> <span data-ttu-id="38c58-109">Korzysta ona z kilku transportów, automatycznie wybierając najlepszą dostępną transport, z uwzględnieniem najlepszego dostępnego transportu klienta i serwera.</span><span class="sxs-lookup"><span data-stu-id="38c58-109">It takes advantage of several transports, automatically selecting the best available transport given the client and server's best available transport.</span></span> <span data-ttu-id="38c58-110">Korzysta ona z **protokołu WebSocket**, interfejsu API HTML5, który umożliwia komunikację dwukierunkową między przeglądarką a serwerem.</span><span class="sxs-lookup"><span data-stu-id="38c58-110">It takes advantage of **WebSocket**, an HTML5 API that enables bi-directional communication between the browser and server.</span></span>
> 
> <span data-ttu-id="38c58-111">**Sygnalizuje** także prosty, wysoki poziom interfejsu API służący do wykonywania wywołań RPC serwera na klientach (wywoływanie funkcji JavaScript w przeglądarkach klientów z kodu .NET po stronie serwera) w aplikacji ASP.NET, a także dodawanie przydatnych punktów zaczepienia do zarządzania połączeniami, takich jak zdarzenia łączenia/rozłączania, grupowanie połączeń i autoryzację.</span><span class="sxs-lookup"><span data-stu-id="38c58-111">**SignalR** also provides a simple, high-level API for doing server to client RPC (call JavaScript functions in your clients' browsers from server-side .NET code) in your ASP.NET application, as well as adding useful hooks for connection management, such as connect/disconnect events, grouping connections, and authorization.</span></span>
> 
> <span data-ttu-id="38c58-112">**Sygnalizujący** jest abstrakcją dla niektórych transportów, które są wymagane do pracy w czasie rzeczywistym między klientem i serwerem.</span><span class="sxs-lookup"><span data-stu-id="38c58-112">**SignalR** is an abstraction over some of the transports that are required to do real-time work between client and server.</span></span> <span data-ttu-id="38c58-113">Połączenie **sygnalizujące** zaczyna się od protokołu HTTP i jest następnie podwyższane do połączenia **WebSocket** , jeśli jest dostępne.</span><span class="sxs-lookup"><span data-stu-id="38c58-113">A **SignalR** connection starts as HTTP, and is then promoted to a **WebSocket** connection if available.</span></span> <span data-ttu-id="38c58-114">Protokół **WebSocket** jest idealnym transportem dla **sygnalizującego**, ponieważ sprawia, że jest to najbardziej wydajne wykorzystanie pamięci serwera, ma najniższe opóźnienie i ma najbardziej podstawowe funkcje (takie jak komunikacja pełnego dupleksu między klientem i serwerem), ale również ma najbardziej rygorystyczne wymagania: protokół **WebSocket** wymaga, aby serwer używał **systemu Windows server 2012** lub **Windows 8**wraz z **.NET Framework 4,5**.</span><span class="sxs-lookup"><span data-stu-id="38c58-114">**WebSocket** is the ideal transport for **SignalR**, since it makes the most efficient use of server memory, has the lowest latency, and has the most underlying features (such as full duplex communication between client and server), but it also has the most stringent requirements: **WebSocket** requires the server to be using **Windows Server 2012** or **Windows 8**, along with **.NET Framework 4.5**.</span></span> <span data-ttu-id="38c58-115">Jeśli te wymagania nie są spełnione, program **sygnalizujący** podejmie próbę użycia innych transportów do nawiązywania połączeń (takich jak *AJAX Longing*).</span><span class="sxs-lookup"><span data-stu-id="38c58-115">If these requirements are not met, **SignalR** will attempt to use other transports to make its connections (like *Ajax long polling*).</span></span>
> 
> <span data-ttu-id="38c58-116">Interfejs API **sygnalizującego** zawiera dwa modele komunikacji między klientami i serwerami: **trwałe połączenia** i **centra**.</span><span class="sxs-lookup"><span data-stu-id="38c58-116">The **SignalR** API contains two models for communicating between clients and servers: **Persistent Connections** and **Hubs**.</span></span> <span data-ttu-id="38c58-117">**Połączenie** reprezentuje prosty punkt końcowy do wysyłania komunikatów o pojedynczym odbiorcy, pogrupowanych lub emisji.</span><span class="sxs-lookup"><span data-stu-id="38c58-117">A **Connection** represents a simple endpoint for sending single-recipient, grouped, or broadcast messages.</span></span> <span data-ttu-id="38c58-118">**Koncentrator** to bardziej wysoki poziom potoku oparty na interfejsie API połączenia, który umożliwia klientowi i serwerowi bezpośrednie wywoływanie metod.</span><span class="sxs-lookup"><span data-stu-id="38c58-118">A **Hub** is a more high-level pipeline built upon the Connection API that allows your client and server to call methods on each other directly.</span></span>
> 
> ![Architektura sygnałów](real-time-web-applications-with-signalr/_static/image1.png)
> 
> <span data-ttu-id="38c58-120">Wszystkie przykładowe kod i fragmenty kodu są zawarte w zestawie szkoleniowym dla sieci Web Camp, Wydanie października 2015, dostępne w [https://github.com/Microsoft-Web/WebCampTrainingKit/releases/tag/v2015.10.13b](https://github.com/Microsoft-Web/WebCampTrainingKit/releases/tag/v2015.10.13b).</span><span class="sxs-lookup"><span data-stu-id="38c58-120">All sample code and snippets are included in the Web Camps Training Kit, October 2015 Release, available at [https://github.com/Microsoft-Web/WebCampTrainingKit/releases/tag/v2015.10.13b](https://github.com/Microsoft-Web/WebCampTrainingKit/releases/tag/v2015.10.13b).</span></span>  <span data-ttu-id="38c58-121">Należy pamiętać, że link Instalatora na tej stronie już nie działa; Zamiast tego użyj jednego z linków w sekcji Assets.</span><span class="sxs-lookup"><span data-stu-id="38c58-121">Please note that the Installer link on that page no longer works; use one of the links under the Assets section instead.</span></span>

<a id="Overview"></a>
## <a name="overview"></a><span data-ttu-id="38c58-122">Omówienie</span><span class="sxs-lookup"><span data-stu-id="38c58-122">Overview</span></span>

<a id="Objectives"></a>
### <a name="objectives"></a><span data-ttu-id="38c58-123">Cele</span><span class="sxs-lookup"><span data-stu-id="38c58-123">Objectives</span></span>

<span data-ttu-id="38c58-124">W tym ćwiczeniu dowiesz się, jak:</span><span class="sxs-lookup"><span data-stu-id="38c58-124">In this hands-on lab, you will learn how to:</span></span>

- <span data-ttu-id="38c58-125">Wysyłanie powiadomień z serwera do klienta przy użyciu usługi sygnalizującej.</span><span class="sxs-lookup"><span data-stu-id="38c58-125">Send notifications from server to client using SignalR.</span></span>
- <span data-ttu-id="38c58-126">Skalowanie aplikacji sygnalizującej przy użyciu **SQL Server**.</span><span class="sxs-lookup"><span data-stu-id="38c58-126">Scale Out your SignalR application using **SQL Server**.</span></span>

<a id="Prerequisites"></a>
### <a name="prerequisites"></a><span data-ttu-id="38c58-127">Wymagania wstępne</span><span class="sxs-lookup"><span data-stu-id="38c58-127">Prerequisites</span></span>

<span data-ttu-id="38c58-128">Następujące czynności są wymagane do wykonania tego laboratorium praktycznego:</span><span class="sxs-lookup"><span data-stu-id="38c58-128">The following is required to complete this hands-on lab:</span></span>

- <span data-ttu-id="38c58-129">[Visual Studio Express 2013 dla sieci Web](https://www.microsoft.com/visualstudio/) lub nowszego</span><span class="sxs-lookup"><span data-stu-id="38c58-129">[Visual Studio Express 2013 for Web](https://www.microsoft.com/visualstudio/) or greater</span></span>

<a id="Setup"></a>
### <a name="setup"></a><span data-ttu-id="38c58-130">Konfigurowanie</span><span class="sxs-lookup"><span data-stu-id="38c58-130">Setup</span></span>

<span data-ttu-id="38c58-131">Aby można było uruchomić ćwiczenia w tym ćwiczeniu, należy najpierw skonfigurować środowisko.</span><span class="sxs-lookup"><span data-stu-id="38c58-131">In order to run the exercises in this hands-on lab, you will need to set up your environment first.</span></span>

1. <span data-ttu-id="38c58-132">Otwórz okno Eksploratora Windows i przejdź do folderu **źródłowego** laboratorium.</span><span class="sxs-lookup"><span data-stu-id="38c58-132">Open a Windows Explorer window and browse to the lab's **Source** folder.</span></span>
2. <span data-ttu-id="38c58-133">Kliknij prawym przyciskiem myszy **Setup. cmd** i wybierz polecenie **Uruchom jako administrator** , aby uruchomić proces instalacji, który skonfiguruje środowisko i zainstaluje fragmenty kodu programu Visual Studio dla tego laboratorium.</span><span class="sxs-lookup"><span data-stu-id="38c58-133">Right-click **Setup.cmd** and select **Run as administrator** to launch the setup process that will configure your environment and install the Visual Studio code snippets for this lab.</span></span>
3. <span data-ttu-id="38c58-134">Jeśli zostanie wyświetlone okno dialogowe Kontrola konta użytkownika, potwierdź akcję, aby wykonać operację.</span><span class="sxs-lookup"><span data-stu-id="38c58-134">If the User Account Control dialog box is shown, confirm the action to proceed.</span></span>

> [!NOTE]
> <span data-ttu-id="38c58-135">Upewnij się, że wszystkie zależności dla tego laboratorium zostały sprawdzone przed uruchomieniem Instalatora.</span><span class="sxs-lookup"><span data-stu-id="38c58-135">Make sure you have checked all the dependencies for this lab before running the setup.</span></span>

<a id="CodeSnippets"></a>
### <a name="using-the-code-snippets"></a><span data-ttu-id="38c58-136">Używanie fragmentów kodu</span><span class="sxs-lookup"><span data-stu-id="38c58-136">Using the Code Snippets</span></span>

<span data-ttu-id="38c58-137">W całym dokumencie laboratoryjnym pojawi się monit o wstawienie bloków kodu.</span><span class="sxs-lookup"><span data-stu-id="38c58-137">Throughout the lab document, you will be instructed to insert code blocks.</span></span> <span data-ttu-id="38c58-138">Dla wygody większość tego kodu jest udostępniana jako fragmenty Visual Studio Code, do których można uzyskać dostęp z poziomu Visual Studio 2013, aby uniknąć konieczności ręcznego dodawania go.</span><span class="sxs-lookup"><span data-stu-id="38c58-138">For your convenience, most of this code is provided as Visual Studio Code Snippets, which you can access from within Visual Studio 2013 to avoid having to add it manually.</span></span>

> [!NOTE]
> <span data-ttu-id="38c58-139">Każdemu z nich towarzyszy rozpoczęcie rozwiązanie znajdujące się w folderze **BEGIN** w ćwiczeniu, który umożliwia wykonywanie poszczególnych czynności niezależnie od innych.</span><span class="sxs-lookup"><span data-stu-id="38c58-139">Each exercise is accompanied by a starting solution located in the **Begin** folder of the exercise that allows you to follow each exercise independently of the others.</span></span> <span data-ttu-id="38c58-140">Należy pamiętać, że fragmenty kodu dodawane podczas wykonywania nie są dostępne w tych rozwiązaniach i mogą nie działać do czasu ukończenia ćwiczenia.</span><span class="sxs-lookup"><span data-stu-id="38c58-140">Please be aware that the code snippets that are added during an exercise are missing from these starting solutions and may not work until you have completed the exercise.</span></span> <span data-ttu-id="38c58-141">Wewnątrz kodu źródłowego dla ćwiczenia znajdziesz również folder **końcowy** zawierający rozwiązanie programu Visual Studio z kodem, który wynika z wykonania czynności w odpowiednim ćwiczeniu.</span><span class="sxs-lookup"><span data-stu-id="38c58-141">Inside the source code for an exercise, you will also find an **End** folder containing a Visual Studio solution with the code that results from completing the steps in the corresponding exercise.</span></span> <span data-ttu-id="38c58-142">Te rozwiązania można wykorzystać jako wskazówkę, jeśli potrzebujesz dodatkowej pomocy podczas pracy w ramach tego praktycznego laboratorium.</span><span class="sxs-lookup"><span data-stu-id="38c58-142">You can use these solutions as guidance if you need additional help as you work through this hands-on lab.</span></span>

---

<a id="Exercises"></a>
## <a name="exercises"></a><span data-ttu-id="38c58-143">Symulacyjn</span><span class="sxs-lookup"><span data-stu-id="38c58-143">Exercises</span></span>

<span data-ttu-id="38c58-144">To laboratorium praktyczne obejmuje następujące ćwiczenia:</span><span class="sxs-lookup"><span data-stu-id="38c58-144">This hands-on lab includes the following exercises:</span></span>

1. [<span data-ttu-id="38c58-145">Praca z danymi w czasie rzeczywistym przy użyciu usługi sygnalizującej</span><span class="sxs-lookup"><span data-stu-id="38c58-145">Working with Real-Time Data Using SignalR</span></span>](#Exercise1)
2. [<span data-ttu-id="38c58-146">Skalowanie w dół przy użyciu SQL Server</span><span class="sxs-lookup"><span data-stu-id="38c58-146">Scaling Out Using SQL Server</span></span>](#Exercise2)

<span data-ttu-id="38c58-147">Szacowany czas wykonywania tego laboratorium: **60 minut**</span><span class="sxs-lookup"><span data-stu-id="38c58-147">Estimated time to complete this lab: **60 minutes**</span></span>

> [!NOTE]
> <span data-ttu-id="38c58-148">Po pierwszym uruchomieniu programu Visual Studio należy wybrać jedną z wstępnie zdefiniowanych kolekcji ustawień.</span><span class="sxs-lookup"><span data-stu-id="38c58-148">When you first start Visual Studio, you must select one of the predefined settings collections.</span></span> <span data-ttu-id="38c58-149">Każda wstępnie zdefiniowana kolekcja jest zaprojektowana tak, aby była zgodna z konkretnym stylem deweloperskim i określa układy okien, zachowanie edytora, fragmenty kodu IntelliSense i opcje okna dialogowego.</span><span class="sxs-lookup"><span data-stu-id="38c58-149">Each predefined collection is designed to match a particular development style and determines window layouts, editor behavior, IntelliSense code snippets, and dialog box options.</span></span> <span data-ttu-id="38c58-150">Procedury przedstawione w tym laboratorium opisują akcje niezbędne do wykonania danego zadania w programie Visual Studio, gdy jest używana **Ogólna kolekcja ustawień deweloperskich** .</span><span class="sxs-lookup"><span data-stu-id="38c58-150">The procedures in this lab describe the actions necessary to accomplish a given task in Visual Studio when using the **General Development Settings** collection.</span></span> <span data-ttu-id="38c58-151">W przypadku wybrania innej kolekcji ustawień dla środowiska programistycznego mogą wystąpić różnice w czynnościach, które należy wziąć pod uwagę.</span><span class="sxs-lookup"><span data-stu-id="38c58-151">If you choose a different settings collection for your development environment, there may be differences in the steps that you should take into account.</span></span>

<a id="Exercise1"></a>
### <a name="exercise-1-working-with-real-time-data-using-signalr"></a><span data-ttu-id="38c58-152">Ćwiczenie 1: Praca z danymi w czasie rzeczywistym przy użyciu usługi sygnalizującej</span><span class="sxs-lookup"><span data-stu-id="38c58-152">Exercise 1: Working with Real-Time Data Using SignalR</span></span>

<span data-ttu-id="38c58-153">Podczas gdy rozmowa jest często używana na przykład, można wykonać całą wiele czynności dzięki funkcjom sieci Web w czasie rzeczywistym.</span><span class="sxs-lookup"><span data-stu-id="38c58-153">While chat is often used as an example, you can do a whole lot more with real-time Web functionality.</span></span> <span data-ttu-id="38c58-154">Za każdym razem, gdy użytkownik Odświeża stronę sieci Web, aby zobaczyć nowe dane, lub strona implementuje długotrwałe sondowanie AJAX, aby pobrać nowe dane, można użyć sygnalizującego.</span><span class="sxs-lookup"><span data-stu-id="38c58-154">Any time a user refreshes a web page to see new data or the page implements Ajax long polling to retrieve new data, you can use SignalR.</span></span>

<span data-ttu-id="38c58-155">Sygnalizujący obsługuje funkcje **wypychania** lub **rozgłaszania** serwera; obsługuje ona zarządzanie połączeniami automatycznie.</span><span class="sxs-lookup"><span data-stu-id="38c58-155">SignalR supports **server push** or **broadcasting** functionality; it handles connection management automatically.</span></span> <span data-ttu-id="38c58-156">W przypadku klasycznych połączeń HTTP dla komunikacji klient-serwer połączenie jest ponownie ustanawiane dla każdego żądania, ale sygnalizujący zapewnia trwałe połączenie między klientem a serwerem.</span><span class="sxs-lookup"><span data-stu-id="38c58-156">In classic HTTP connections for client-server communication, connection is re-established for each request, but SignalR provides persistent connection between the client and server.</span></span> <span data-ttu-id="38c58-157">W programie sygnalizujący kod serwera wywołuje kod klienta w przeglądarce przy użyciu zdalnych wywołań procedur (RPC), a nie modelu odpowiedzi Request-Response już dzisiaj.</span><span class="sxs-lookup"><span data-stu-id="38c58-157">In SignalR the server code calls out to a client code in the browser using Remote Procedure Calls (RPC), rather than the request-response model we know today.</span></span>

<span data-ttu-id="38c58-158">W tym ćwiczeniu skonfigurujesz aplikację **quizu pojedynek maniaków komputerowych** , która będzie używać programu sygnalizującego do wyświetlania pulpitu nawigacyjnego statystyk z zaktualizowanymi metrykami bez konieczności odświeżania całej strony.</span><span class="sxs-lookup"><span data-stu-id="38c58-158">In this exercise, you will configure the **Geek Quiz** application to use SignalR to display the Statistics dashboard with the updated metrics without the need to refresh the entire page.</span></span>

<a id="Ex1Task1"></a>
#### <a name="task-1--exploring-the-geek-quiz-statistics-page"></a><span data-ttu-id="38c58-159">Zadanie 1 — Eksplorowanie strony statystyki quizu pojedynek maniaków komputerowych</span><span class="sxs-lookup"><span data-stu-id="38c58-159">Task 1 – Exploring the Geek Quiz Statistics Page</span></span>

<span data-ttu-id="38c58-160">W tym zadaniu przejdziesz przez aplikację i sprawdzisz, jak wyświetlana jest strona Statystyka oraz jak można poprawić sposób aktualizowania informacji.</span><span class="sxs-lookup"><span data-stu-id="38c58-160">In this task, you will go through the application and verify how the statistics page is shown and how you can improve the way the information is updated.</span></span>

1. <span data-ttu-id="38c58-161">Otwórz **Visual Studio Express 2013 dla sieci Web** i Otwórz rozwiązanie **GeekQuiz. sln** znajdujące się w folderze **Source\Ex1-WorkingWithRealTimeData\Begin** .</span><span class="sxs-lookup"><span data-stu-id="38c58-161">Open **Visual Studio Express 2013 for Web** and open the **GeekQuiz.sln** solution located in the **Source\Ex1-WorkingWithRealTimeData\Begin** folder.</span></span>
2. <span data-ttu-id="38c58-162">Naciśnij klawisz **F5** , aby uruchomić rozwiązanie.</span><span class="sxs-lookup"><span data-stu-id="38c58-162">Press **F5** to run the solution.</span></span> <span data-ttu-id="38c58-163">Strona **logowania** powinna zostać wyświetlona w przeglądarce.</span><span class="sxs-lookup"><span data-stu-id="38c58-163">The **Log in** page should appear in the browser.</span></span>

    <span data-ttu-id="38c58-164">![Uruchamianie rozwiązania](real-time-web-applications-with-signalr/_static/image2.png "Uruchamianie rozwiązania")</span><span class="sxs-lookup"><span data-stu-id="38c58-164">![Running the solution](real-time-web-applications-with-signalr/_static/image2.png "Running the solution")</span></span>

    <span data-ttu-id="38c58-165">*Uruchamianie rozwiązania*</span><span class="sxs-lookup"><span data-stu-id="38c58-165">*Running the solution*</span></span>
3. <span data-ttu-id="38c58-166">Kliknij pozycję **zarejestruj** w prawym górnym rogu strony, aby utworzyć nowego użytkownika w aplikacji.</span><span class="sxs-lookup"><span data-stu-id="38c58-166">Click **Register** in the upper-right corner of the page to create a new user in the application.</span></span>

    <span data-ttu-id="38c58-167">![Zarejestruj łącze](real-time-web-applications-with-signalr/_static/image3.png "Zarejestruj łącze")</span><span class="sxs-lookup"><span data-stu-id="38c58-167">![Register link](real-time-web-applications-with-signalr/_static/image3.png "Register link")</span></span>

    <span data-ttu-id="38c58-168">*Zarejestruj łącze*</span><span class="sxs-lookup"><span data-stu-id="38c58-168">*Register link*</span></span>
4. <span data-ttu-id="38c58-169">Na stronie **Rejestr** wprowadź **nazwę użytkownika** i **hasło**, a następnie kliknij pozycję **zarejestruj**.</span><span class="sxs-lookup"><span data-stu-id="38c58-169">In the **Register** page, enter a **User name** and **Password**, and then click **Register**.</span></span>

    <span data-ttu-id="38c58-170">![Rejestrowanie użytkownika](real-time-web-applications-with-signalr/_static/image4.png "Rejestrowanie użytkownika")</span><span class="sxs-lookup"><span data-stu-id="38c58-170">![Registering a user](real-time-web-applications-with-signalr/_static/image4.png "Registering a user")</span></span>

    <span data-ttu-id="38c58-171">*Rejestrowanie użytkownika*</span><span class="sxs-lookup"><span data-stu-id="38c58-171">*Registering a user*</span></span>
5. <span data-ttu-id="38c58-172">Aplikacja rejestruje nowe konto, a użytkownik zostaje uwierzytelniony i przekierowany z powrotem na stronę główną przedstawiającą pierwsze pytanie quizu.</span><span class="sxs-lookup"><span data-stu-id="38c58-172">The application registers the new account and the user is authenticated and redirected back to the home page showing the first quiz question.</span></span>
6. <span data-ttu-id="38c58-173">Otwórz stronę **Statystyka** w nowym oknie i umieść ją **obok strony** **głównej** .</span><span class="sxs-lookup"><span data-stu-id="38c58-173">Open the **Statistics** page in a new window and put the **Home** page and **Statistics** page side-by-side.</span></span>

    <span data-ttu-id="38c58-174">![Okna równoległe](real-time-web-applications-with-signalr/_static/image5.png "Okna sąsiadujące")</span><span class="sxs-lookup"><span data-stu-id="38c58-174">![Side-by-side windows](real-time-web-applications-with-signalr/_static/image5.png "Side by side windows")</span></span>

    <span data-ttu-id="38c58-175">*Okna równoległe*</span><span class="sxs-lookup"><span data-stu-id="38c58-175">*Side-by-side windows*</span></span>
7. <span data-ttu-id="38c58-176">Na stronie **głównej** Odpowiedz na pytanie, klikając jedną z opcji.</span><span class="sxs-lookup"><span data-stu-id="38c58-176">In the **Home** page, answer the question by clicking one of the options.</span></span>

    <span data-ttu-id="38c58-177">![Odpowiadanie na pytanie](real-time-web-applications-with-signalr/_static/image6.png "Odpowiadanie na pytanie")</span><span class="sxs-lookup"><span data-stu-id="38c58-177">![Answering a question](real-time-web-applications-with-signalr/_static/image6.png "Answering a question")</span></span>

    <span data-ttu-id="38c58-178">*Odpowiadanie na pytanie*</span><span class="sxs-lookup"><span data-stu-id="38c58-178">*Answering a question*</span></span>
8. <span data-ttu-id="38c58-179">Po kliknięciu jednego z przycisków powinna zostać wyświetlona odpowiedź.</span><span class="sxs-lookup"><span data-stu-id="38c58-179">After clicking one of the buttons, the answer should appear.</span></span>

    <span data-ttu-id="38c58-180">![Odpowiedź na pytanie poprawna](real-time-web-applications-with-signalr/_static/image7.png "Odpowiedź na pytanie poprawna")</span><span class="sxs-lookup"><span data-stu-id="38c58-180">![Question answered correct](real-time-web-applications-with-signalr/_static/image7.png "Question answered correct")</span></span>

    <span data-ttu-id="38c58-181">*Odpowiedź na pytanie poprawna*</span><span class="sxs-lookup"><span data-stu-id="38c58-181">*Question answered correctly*</span></span>
9. <span data-ttu-id="38c58-182">Zwróć uwagę, że informacje podane na stronie Statystyka są nieaktualne.</span><span class="sxs-lookup"><span data-stu-id="38c58-182">Notice that the information provided in the Statistics page is outdated.</span></span> <span data-ttu-id="38c58-183">Odśwież stronę, aby zobaczyć zaktualizowane wyniki.</span><span class="sxs-lookup"><span data-stu-id="38c58-183">Refresh the page in order to see the updated results.</span></span>

    <span data-ttu-id="38c58-184">![Strona statystyki](real-time-web-applications-with-signalr/_static/image8.png "Strona statystyki")</span><span class="sxs-lookup"><span data-stu-id="38c58-184">![Statistics page](real-time-web-applications-with-signalr/_static/image8.png "Statistics page")</span></span>

    <span data-ttu-id="38c58-185">*Strona statystyki*</span><span class="sxs-lookup"><span data-stu-id="38c58-185">*Statistics page*</span></span>
10. <span data-ttu-id="38c58-186">Wróć do programu Visual Studio i Zatrzymaj debugowanie.</span><span class="sxs-lookup"><span data-stu-id="38c58-186">Go back to Visual Studio and stop debugging.</span></span>

<a id="Ex1Task2"></a>
#### <a name="task-2--adding-signalr-to-geek-quiz-to-show-online-charts"></a><span data-ttu-id="38c58-187">Zadanie 2 — Dodawanie sygnału do pojedynek maniaków komputerowych quizu w celu pokazania wykresów online</span><span class="sxs-lookup"><span data-stu-id="38c58-187">Task 2 – Adding SignalR to Geek Quiz to Show Online Charts</span></span>

<span data-ttu-id="38c58-188">W tym zadaniu dodasz sygnał do rozwiązania i wyślesz aktualizacje do klientów automatycznie po wysłaniu nowej odpowiedzi na serwer.</span><span class="sxs-lookup"><span data-stu-id="38c58-188">In this task, you will add SignalR to the solution and send updates to the clients automatically when a new answer is sent to the server.</span></span>

1. <span data-ttu-id="38c58-189">W menu **Narzędzia** w programie Visual Studio wybierz pozycję **Menedżer pakietów NuGet**, a następnie kliknij pozycję **konsola Menedżera pakietów**.</span><span class="sxs-lookup"><span data-stu-id="38c58-189">From the **Tools** menu in Visual Studio, select **NuGet Package Manager**, and then click **Package Manager Console**.</span></span>
2. <span data-ttu-id="38c58-190">W oknie **konsola Menedżera pakietów** wykonaj następujące polecenie:</span><span class="sxs-lookup"><span data-stu-id="38c58-190">In the **Package Manager Console** window, execute the following command:</span></span>

    [!code-powershell[Main](real-time-web-applications-with-signalr/samples/sample1.ps1)]

    <span data-ttu-id="38c58-191">![Instalacja pakietu sygnalizującego](real-time-web-applications-with-signalr/_static/image9.png "Instalacja pakietu sygnalizującego")</span><span class="sxs-lookup"><span data-stu-id="38c58-191">![SignalR package installation](real-time-web-applications-with-signalr/_static/image9.png "SignalR package installation")</span></span>

    <span data-ttu-id="38c58-192">*Instalacja pakietu sygnalizującego*</span><span class="sxs-lookup"><span data-stu-id="38c58-192">*SignalR package installation*</span></span>

   > [!NOTE]
   > <span data-ttu-id="38c58-193">Podczas instalowania pakietów NuGet usługi **sygnalizującego** w wersji 2.0.2 z zupełnie nowej aplikacji MVC 5 należy ręcznie zaktualizować pakiety **Owin** do wersji 2.0.1 (lub nowszej) przed zainstalowaniem programu sygnalizującego.</span><span class="sxs-lookup"><span data-stu-id="38c58-193">When installing **SignalR** NuGet packages version 2.0.2 from a brand new MVC 5 application, you will need to manually update **OWIN** packages to version 2.0.1 (or higher) before installing SignalR.</span></span> <span data-ttu-id="38c58-194">W tym celu można wykonać następujący skrypt w **konsoli Menedżera pakietów**:</span><span class="sxs-lookup"><span data-stu-id="38c58-194">To do this, you can execute the following script in the **Package Manager Console**:</span></span>
   > 
   > [!code-powershell[Main](real-time-web-applications-with-signalr/samples/sample2.ps1)]
   > 
   > <span data-ttu-id="38c58-195">W przyszłych wydaniach sygnału OWIN zależności zostaną automatycznie zaktualizowane.</span><span class="sxs-lookup"><span data-stu-id="38c58-195">In a future release of SignalR, OWIN dependencies will be automatically updated.</span></span>
3. <span data-ttu-id="38c58-196">W **Eksplorator rozwiązań**rozwiń folder **skrypty** i zwróć uwagę, że pliki *js* programu sygnalizujące zostały dodane do rozwiązania.</span><span class="sxs-lookup"><span data-stu-id="38c58-196">In **Solution Explorer**, expand the **Scripts** folder and notice that the SignalR *js* files were added to the solution.</span></span>

    <span data-ttu-id="38c58-197">![Dokumentacja języka JavaScript dla sygnałów](real-time-web-applications-with-signalr/_static/image10.png "Dokumentacja języka JavaScript dla sygnałów")</span><span class="sxs-lookup"><span data-stu-id="38c58-197">![SignalR JavaScript references](real-time-web-applications-with-signalr/_static/image10.png "SignalR JavaScript references")</span></span>

    <span data-ttu-id="38c58-198">*Dokumentacja języka JavaScript dla sygnałów*</span><span class="sxs-lookup"><span data-stu-id="38c58-198">*SignalR JavaScript references*</span></span>
4. <span data-ttu-id="38c58-199">W **Eksplorator rozwiązań**kliknij prawym przyciskiem myszy projekt **GeekQuiz** , wybierz pozycję **Dodaj** | **Nowy folder**i nadaj nazwę **centram**IT.</span><span class="sxs-lookup"><span data-stu-id="38c58-199">In **Solution Explorer**, right-click the **GeekQuiz** project, select **Add** | **New Folder**, and name it **Hubs**.</span></span>
5. <span data-ttu-id="38c58-200">Kliknij prawym przyciskiem myszy folder **Hubs** i wybierz polecenie **Dodaj | Nowy element**.</span><span class="sxs-lookup"><span data-stu-id="38c58-200">Right-click the **Hubs** folder and select **Add | New Item**.</span></span>

    <span data-ttu-id="38c58-201">![Dodaj nowy element](real-time-web-applications-with-signalr/_static/image11.png "Dodaj nowy element")</span><span class="sxs-lookup"><span data-stu-id="38c58-201">![Add new item](real-time-web-applications-with-signalr/_static/image11.png "Add new item")</span></span>

    <span data-ttu-id="38c58-202">*Dodaj nowy element*</span><span class="sxs-lookup"><span data-stu-id="38c58-202">*Add new item*</span></span>
6. <span data-ttu-id="38c58-203">W oknie dialogowym **Dodaj nowy element** wybierz  **C# wizualizację | Sieć Web | Węzeł sygnalizujący** w lewym okienku, wybierz pozycję **Klasa centrum sygnałów (v2)** w środkowym okienku, Nazwij plik **StatisticsHub.cs** i kliknij przycisk **Dodaj**.</span><span class="sxs-lookup"><span data-stu-id="38c58-203">In the **Add New Item** dialog box, select the **Visual C# | Web | SignalR** node in the left pane, select **SignalR Hub Class (v2)** from the center pane, name the file **StatisticsHub.cs** and click **Add**.</span></span>

    <span data-ttu-id="38c58-204">![Okno dialogowe Dodawanie nowego elementu](real-time-web-applications-with-signalr/_static/image12.png "Okno dialogowe Dodawanie nowego elementu")</span><span class="sxs-lookup"><span data-stu-id="38c58-204">![Add new item dialog box](real-time-web-applications-with-signalr/_static/image12.png "Add new item dialog box")</span></span>

    <span data-ttu-id="38c58-205">*Okno dialogowe Dodawanie nowego elementu*</span><span class="sxs-lookup"><span data-stu-id="38c58-205">*Add new item dialog box*</span></span>
7. <span data-ttu-id="38c58-206">Zastąp kod w klasie **StatisticsHub** następującym kodem.</span><span class="sxs-lookup"><span data-stu-id="38c58-206">Replace the code in the **StatisticsHub** class with the following code.</span></span>

    <span data-ttu-id="38c58-207">(Fragment kodu- *RealTimeSignalR-Ex1-StatisticsHubClass*)</span><span class="sxs-lookup"><span data-stu-id="38c58-207">(Code Snippet - *RealTimeSignalR - Ex1 - StatisticsHubClass*)</span></span>

    [!code-csharp[Main](real-time-web-applications-with-signalr/samples/sample3.cs)]
8. <span data-ttu-id="38c58-208">Otwórz **Startup.cs** i Dodaj następujący wiersz na końcu metody **konfiguracji** .</span><span class="sxs-lookup"><span data-stu-id="38c58-208">Open **Startup.cs** and add the following line at the end of the **Configuration** method.</span></span>

    <span data-ttu-id="38c58-209">(Fragment kodu- *RealTimeSignalR-Ex1-MapSignalR*)</span><span class="sxs-lookup"><span data-stu-id="38c58-209">(Code Snippet - *RealTimeSignalR - Ex1 - MapSignalR*)</span></span>

    [!code-csharp[Main](real-time-web-applications-with-signalr/samples/sample4.cs)]
9. <span data-ttu-id="38c58-210">Otwórz stronę **StatisticsService.cs** wewnątrz folderu **Services** i Dodaj następujące dyrektywy using.</span><span class="sxs-lookup"><span data-stu-id="38c58-210">Open the **StatisticsService.cs** page inside the **Services** folder and add the following using directives.</span></span>

    <span data-ttu-id="38c58-211">(Fragment kodu- *RealTimeSignalR-Ex1-UsingDirectives*)</span><span class="sxs-lookup"><span data-stu-id="38c58-211">(Code Snippet - *RealTimeSignalR - Ex1 - UsingDirectives*)</span></span>

    [!code-csharp[Main](real-time-web-applications-with-signalr/samples/sample5.cs)]
10. <span data-ttu-id="38c58-212">Aby powiadomić podłączonych klientów o aktualizacjach, należy najpierw pobrać obiekt **kontekstu** dla bieżącego połączenia.</span><span class="sxs-lookup"><span data-stu-id="38c58-212">To notify connected clients of updates, you first retrieve a **Context** object for the current connection.</span></span> <span data-ttu-id="38c58-213">Obiekt **Hub** zawiera metody wysyłania komunikatów do pojedynczego klienta lub emisji do wszystkich podłączonych klientów.</span><span class="sxs-lookup"><span data-stu-id="38c58-213">The **Hub** object contains methods to send messages to a single client or broadcast to all connected clients.</span></span> <span data-ttu-id="38c58-214">Dodaj następującą metodę do klasy **StatisticsService** , aby emitować dane statystyczne.</span><span class="sxs-lookup"><span data-stu-id="38c58-214">Add the following method to the **StatisticsService** class to broadcast the statistics data.</span></span>

    <span data-ttu-id="38c58-215">(Fragment kodu- *RealTimeSignalR-Ex1-NotifyUpdatesMethod*)</span><span class="sxs-lookup"><span data-stu-id="38c58-215">(Code Snippet - *RealTimeSignalR - Ex1 - NotifyUpdatesMethod*)</span></span>

    [!code-csharp[Main](real-time-web-applications-with-signalr/samples/sample6.cs)]

    > [!NOTE]
    > <span data-ttu-id="38c58-216">W powyższym kodzie używasz dowolnej nazwy metody do wywołania funkcji na kliencie (tj.: *updateStatistics*).</span><span class="sxs-lookup"><span data-stu-id="38c58-216">In the code above, you are using an arbitrary method name to call a function on the client (i.e.: *updateStatistics*).</span></span> <span data-ttu-id="38c58-217">Określona nazwa metody jest interpretowana jako obiekt dynamiczny, co oznacza, że nie istnieje funkcja IntelliSense ani weryfikacja w czasie kompilacji.</span><span class="sxs-lookup"><span data-stu-id="38c58-217">The method name that you specify is interpreted as a dynamic object, which means there is no IntelliSense or compile-time validation for it.</span></span> <span data-ttu-id="38c58-218">Wyrażenie jest oceniane w czasie wykonywania.</span><span class="sxs-lookup"><span data-stu-id="38c58-218">The expression is evaluated at run time.</span></span> <span data-ttu-id="38c58-219">Gdy wywołanie metody jest wykonywane, sygnalizujący wysyła nazwę metody i wartości parametrów do klienta.</span><span class="sxs-lookup"><span data-stu-id="38c58-219">When the method call executes, SignalR sends the method name and the parameter values to the client.</span></span> <span data-ttu-id="38c58-220">Jeśli klient ma metodę zgodną z nazwą, ta metoda jest wywoływana i wartości parametrów są do niego przenoszone.</span><span class="sxs-lookup"><span data-stu-id="38c58-220">If the client has a method that matches the name, that method is called and the parameter values are passed to it.</span></span> <span data-ttu-id="38c58-221">Jeśli na kliencie nie zostanie znaleziona zgodna Metoda, żaden błąd nie zostanie zgłoszony.</span><span class="sxs-lookup"><span data-stu-id="38c58-221">If no matching method is found on the client, no error is raised.</span></span> <span data-ttu-id="38c58-222">Aby uzyskać więcej informacji, zobacz [Przewodnik interfejsu API centrów sygnałów ASP.NET](../guide-to-the-api/hubs-api-guide-server.md).</span><span class="sxs-lookup"><span data-stu-id="38c58-222">For more information, refer to [ASP.NET SignalR Hubs API Guide](../guide-to-the-api/hubs-api-guide-server.md).</span></span>
11. <span data-ttu-id="38c58-223">Otwórz stronę **TriviaController.cs** wewnątrz folderu **controllers** i Dodaj następujące dyrektywy using.</span><span class="sxs-lookup"><span data-stu-id="38c58-223">Open the **TriviaController.cs** page inside the **Controllers** folder and add the following using directives.</span></span>

    [!code-csharp[Main](real-time-web-applications-with-signalr/samples/sample7.cs)]
12. <span data-ttu-id="38c58-224">Dodaj następujący wyróżniony kod do metody akcji **post** .</span><span class="sxs-lookup"><span data-stu-id="38c58-224">Add the following highlighted code to the **Post** action method.</span></span>

    <span data-ttu-id="38c58-225">(Fragment kodu- *RealTimeSignalR-Ex1-NotifyUpdatesCall*)</span><span class="sxs-lookup"><span data-stu-id="38c58-225">(Code Snippet - *RealTimeSignalR - Ex1 - NotifyUpdatesCall*)</span></span>

    [!code-csharp[Main](real-time-web-applications-with-signalr/samples/sample8.cs)]
13. <span data-ttu-id="38c58-226">Otwórz stronę **Statistics. cshtml** w **widokach | Folder macierzysty** .</span><span class="sxs-lookup"><span data-stu-id="38c58-226">Open the **Statistics.cshtml** page inside the **Views | Home** folder.</span></span> <span data-ttu-id="38c58-227">Znajdź sekcję **skrypty** i Dodaj następujące odwołania do skryptów na początku sekcji.</span><span class="sxs-lookup"><span data-stu-id="38c58-227">Locate the **Scripts** section and add the following script references at the beginning of the section.</span></span>

    <span data-ttu-id="38c58-228">(Fragment kodu- *RealTimeSignalR-Ex1-SignalRScriptReferences*)</span><span class="sxs-lookup"><span data-stu-id="38c58-228">(Code Snippet - *RealTimeSignalR - Ex1 - SignalRScriptReferences*)</span></span>

    [!code-cshtml[Main](real-time-web-applications-with-signalr/samples/sample9.cshtml)]

    > [!NOTE]
    > <span data-ttu-id="38c58-229">Po dodaniu sygnalizującego i innych bibliotek skryptów do projektu programu Visual Studio Menedżer pakietów może zainstalować wersję pliku skryptu sygnalizującego, która jest nowsza niż wersja pokazana w tym temacie.</span><span class="sxs-lookup"><span data-stu-id="38c58-229">When you add SignalR and other script libraries to your Visual Studio project, the Package Manager might install a version of the SignalR script file that is more recent than the version shown in this topic.</span></span> <span data-ttu-id="38c58-230">Upewnij się, że odwołanie do skryptu w kodzie jest zgodne z wersją biblioteki skryptów zainstalowaną w projekcie.</span><span class="sxs-lookup"><span data-stu-id="38c58-230">Make sure that the script reference in your code matches the version of the script library installed in your project.</span></span>
14. <span data-ttu-id="38c58-231">Dodaj następujący wyróżniony kod, aby połączyć klienta z centrum sygnałów i zaktualizować dane statystyczne po odebraniu nowej wiadomości z centrum.</span><span class="sxs-lookup"><span data-stu-id="38c58-231">Add the following highlighted code to connect the client to the SignalR hub and update the statistics data when a new message is received from the hub.</span></span>

    <span data-ttu-id="38c58-232">(Fragment kodu- *RealTimeSignalR-Ex1-SignalRClientCode*)</span><span class="sxs-lookup"><span data-stu-id="38c58-232">(Code Snippet - *RealTimeSignalR - Ex1 - SignalRClientCode*)</span></span>

    [!code-cshtml[Main](real-time-web-applications-with-signalr/samples/sample10.cshtml)]

    <span data-ttu-id="38c58-233">W tym kodzie tworzysz serwer proxy centrum i zarejestrowano procedurę obsługi zdarzeń w celu nasłuchiwania komunikatów wysyłanych przez serwer.</span><span class="sxs-lookup"><span data-stu-id="38c58-233">In this code, you are creating a Hub Proxy and registering an event handler to listen for messages sent by the server.</span></span> <span data-ttu-id="38c58-234">W tym przypadku użytkownik nasłuchuje komunikatów wysyłanych za pomocą metody *updateStatistics* .</span><span class="sxs-lookup"><span data-stu-id="38c58-234">In this case, you listen for messages sent through the *updateStatistics* method.</span></span>

<a id="Ex1Task3"></a>
#### <a name="task-3--running-the-solution"></a><span data-ttu-id="38c58-235">Zadanie 3 — Uruchamianie rozwiązania</span><span class="sxs-lookup"><span data-stu-id="38c58-235">Task 3 – Running the Solution</span></span>

<span data-ttu-id="38c58-236">W tym zadaniu zostanie uruchomione rozwiązanie, aby sprawdzić, czy widok statystyki jest aktualizowany automatycznie przy użyciu programu sygnalizującego po odebraniu nowego pytania.</span><span class="sxs-lookup"><span data-stu-id="38c58-236">In this task, you will run the solution to verify that the statistics view is updated automatically using SignalR after answering a new question.</span></span>

1. <span data-ttu-id="38c58-237">Naciśnij klawisz **F5** , aby uruchomić rozwiązanie.</span><span class="sxs-lookup"><span data-stu-id="38c58-237">Press **F5** to run the solution.</span></span>

    > [!NOTE]
    > <span data-ttu-id="38c58-238">Jeśli nie zostało to jeszcze zalogowane w aplikacji, zaloguj się przy użyciu użytkownika utworzonego w ramach zadania 1.</span><span class="sxs-lookup"><span data-stu-id="38c58-238">If not already logged in to the application, log in with the user you created in Task 1.</span></span>
2. <span data-ttu-id="38c58-239">Otwórz stronę **statystyki** w nowym oknie i umieść stronę **główną** i strony **statystyk** obok siebie jak w zadaniu 1.</span><span class="sxs-lookup"><span data-stu-id="38c58-239">Open the **Statistics** page in a new window and put the **Home** page and **Statistics** page side-by-side as you did in Task 1.</span></span>
3. <span data-ttu-id="38c58-240">Na stronie **głównej** Odpowiedz na pytanie, klikając jedną z opcji.</span><span class="sxs-lookup"><span data-stu-id="38c58-240">In the **Home** page, answer the question by clicking one of the options.</span></span>

    <span data-ttu-id="38c58-241">![Odpowiadanie na inne pytanie](real-time-web-applications-with-signalr/_static/image13.png "Odpowiadanie na inne pytanie")</span><span class="sxs-lookup"><span data-stu-id="38c58-241">![Answering another question](real-time-web-applications-with-signalr/_static/image13.png "Answering another question")</span></span>

    <span data-ttu-id="38c58-242">*Odpowiadanie na inne pytanie*</span><span class="sxs-lookup"><span data-stu-id="38c58-242">*Answering another question*</span></span>
4. <span data-ttu-id="38c58-243">Po kliknięciu jednego z przycisków powinna zostać wyświetlona odpowiedź.</span><span class="sxs-lookup"><span data-stu-id="38c58-243">After clicking one of the buttons, the answer should appear.</span></span> <span data-ttu-id="38c58-244">Zwróć uwagę, że informacje statystyczne na stronie są aktualizowane automatycznie po odebraniu pytania z zaktualizowanymi informacjami bez konieczności odświeżania całej strony.</span><span class="sxs-lookup"><span data-stu-id="38c58-244">Notice that the Statistics information on the page is updated automatically after answering the question with the updated information without the need to refresh the entire page.</span></span>

    <span data-ttu-id="38c58-245">![Strona statystyki została odświeżona po odebraniu odpowiedzi](real-time-web-applications-with-signalr/_static/image14.png "Strona statystyki została odświeżona po odebraniu odpowiedzi")</span><span class="sxs-lookup"><span data-stu-id="38c58-245">![Statistics page refreshed after answer](real-time-web-applications-with-signalr/_static/image14.png "Statistics page refreshed after answer")</span></span>

    <span data-ttu-id="38c58-246">*Strona statystyki została odświeżona po odebraniu odpowiedzi*</span><span class="sxs-lookup"><span data-stu-id="38c58-246">*Statistics page refreshed after answer*</span></span>

<a id="Exercise2"></a>
### <a name="exercise-2-scaling-out-using-sql-server"></a><span data-ttu-id="38c58-247">Ćwiczenie 2: skalowanie w dół przy użyciu SQL Server</span><span class="sxs-lookup"><span data-stu-id="38c58-247">Exercise 2: Scaling Out Using SQL Server</span></span>

<span data-ttu-id="38c58-248">W przypadku skalowania aplikacji sieci Web można ogólnie wybrać opcję *skalowanie w górę* i *skalowanie* w dół.</span><span class="sxs-lookup"><span data-stu-id="38c58-248">When scaling a web application, you can generally choose between *scaling up* and *scaling out* options.</span></span> <span data-ttu-id="38c58-249">*Skalowanie w górę* oznacza użycie większego serwera, z większą ilością zasobów (procesor CPU, pamięć RAM itp.) podczas *skalowania w poziomie* oznacza dodanie większej liczby serwerów do obsługi obciążenia.</span><span class="sxs-lookup"><span data-stu-id="38c58-249">*Scale up* means using a larger server, with more resources (CPU, RAM, etc.) while *scale out* means adding more servers to handle the load.</span></span> <span data-ttu-id="38c58-250">Problem z tym drugim polega na tym, że klienci mogą być kierowani do różnych serwerów.</span><span class="sxs-lookup"><span data-stu-id="38c58-250">The problem with the latter is that the clients can get routed to different servers.</span></span> <span data-ttu-id="38c58-251">Klient połączony z jednym serwerem nie będzie odbierać komunikatów wysyłanych z innego serwera.</span><span class="sxs-lookup"><span data-stu-id="38c58-251">A client that is connected to one server will not receive messages sent from another server.</span></span>

<span data-ttu-id="38c58-252">Te problemy można rozwiązać przy użyciu składnika o nazwie " *Plan*", aby przekazywać komunikaty między serwerami.</span><span class="sxs-lookup"><span data-stu-id="38c58-252">You can solve these issues by using a component called *backplane*, to forward messages between servers.</span></span> <span data-ttu-id="38c58-253">Po włączeniu obsługi planów, każde wystąpienie aplikacji wysyła komunikaty do planu i planuje je do innych wystąpień aplikacji.</span><span class="sxs-lookup"><span data-stu-id="38c58-253">With a backplane enabled, each application instance sends messages to the backplane, and the backplane forwards them to the other application instances.</span></span>

<span data-ttu-id="38c58-254">Obecnie istnieją trzy typy planów dla sygnalizującego:</span><span class="sxs-lookup"><span data-stu-id="38c58-254">There are currently three types of backplanes for SignalR:</span></span>

- <span data-ttu-id="38c58-255">**Azure Service Bus systemu Windows**.</span><span class="sxs-lookup"><span data-stu-id="38c58-255">**Windows Azure Service Bus**.</span></span> <span data-ttu-id="38c58-256">Service Bus to infrastruktura obsługi komunikatów, która umożliwia składnikom wysyłanie luźno sprzężonych komunikatów.</span><span class="sxs-lookup"><span data-stu-id="38c58-256">Service Bus is a messaging infrastructure that allows components to send loosely coupled messages.</span></span>
- <span data-ttu-id="38c58-257">**SQL Server**.</span><span class="sxs-lookup"><span data-stu-id="38c58-257">**SQL Server**.</span></span> <span data-ttu-id="38c58-258">SQL Server planuje zapisywanie komunikatów w tabelach SQL.</span><span class="sxs-lookup"><span data-stu-id="38c58-258">The SQL Server backplane writes messages to SQL tables.</span></span> <span data-ttu-id="38c58-259">Plan nie używa Service Broker do wydajnej obsługi komunikatów.</span><span class="sxs-lookup"><span data-stu-id="38c58-259">The backplane uses Service Broker for efficient messaging.</span></span> <span data-ttu-id="38c58-260">Jednak działa również wtedy, gdy Service Broker nie jest włączona.</span><span class="sxs-lookup"><span data-stu-id="38c58-260">However, it also works if Service Broker is not enabled.</span></span>
- <span data-ttu-id="38c58-261">**Redis**.</span><span class="sxs-lookup"><span data-stu-id="38c58-261">**Redis**.</span></span> <span data-ttu-id="38c58-262">Redis jest magazynem wartości w pamięci.</span><span class="sxs-lookup"><span data-stu-id="38c58-262">Redis is an in-memory key-value store.</span></span> <span data-ttu-id="38c58-263">Redis obsługuje wzorzec publikowania/subskrybowania ("pub/Sub") do wysyłania wiadomości.</span><span class="sxs-lookup"><span data-stu-id="38c58-263">Redis supports a publish/subscribe ("pub/sub") pattern for sending messages.</span></span>

<span data-ttu-id="38c58-264">Każdy komunikat jest wysyłany przez magistralę komunikatów.</span><span class="sxs-lookup"><span data-stu-id="38c58-264">Every message is sent through a message bus.</span></span> <span data-ttu-id="38c58-265">Magistrala komunikatów implementuje interfejs [IMessageBus](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.messaging.imessagebus(v=vs.100).aspx) , który zapewnia abstrakcję publikowania/subskrybowania.</span><span class="sxs-lookup"><span data-stu-id="38c58-265">A message bus implements the [IMessageBus](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.messaging.imessagebus(v=vs.100).aspx) interface, which provides a publish/subscribe abstraction.</span></span> <span data-ttu-id="38c58-266">Planuje działanie, zastępując domyślne **IMessageBus** magistralą zaprojektowaną dla tego planu.</span><span class="sxs-lookup"><span data-stu-id="38c58-266">The backplanes work by replacing the default **IMessageBus** with a bus designed for that backplane.</span></span>

<span data-ttu-id="38c58-267">Każde wystąpienie serwera nawiązuje połączenie z planem w celu przechodzenia przez magistralę.</span><span class="sxs-lookup"><span data-stu-id="38c58-267">Each server instance connects to the backplane through the bus.</span></span> <span data-ttu-id="38c58-268">Po wysłaniu wiadomości zostanie ona zaplanowana, a plan nie wysyła go do każdego serwera.</span><span class="sxs-lookup"><span data-stu-id="38c58-268">When a message is sent, it goes to the backplane, and the backplane sends it to every server.</span></span> <span data-ttu-id="38c58-269">Gdy serwer odbiera komunikat z planu, przechowuje komunikat w lokalnej pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="38c58-269">When a server receives a message from the backplane, it stores the message in its local cache.</span></span> <span data-ttu-id="38c58-270">Serwer następnie dostarcza komunikaty do klientów ze swojej lokalnej pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="38c58-270">The server then delivers messages to clients from its local cache.</span></span>

<span data-ttu-id="38c58-271">Aby uzyskać więcej informacji na temat sposobu działania programu sygnalizującego, przeczytaj ten [artykuł](../performance/scaleout-in-signalr.md).</span><span class="sxs-lookup"><span data-stu-id="38c58-271">For more information about how the SignalR backplane works, read this [article](../performance/scaleout-in-signalr.md).</span></span>

> [!NOTE]
> <span data-ttu-id="38c58-272">Istnieje kilka scenariuszy, w których plan może stać się wąskim gardłem.</span><span class="sxs-lookup"><span data-stu-id="38c58-272">There are some scenarios where a backplane can become a bottleneck.</span></span> <span data-ttu-id="38c58-273">Poniżej przedstawiono kilka typowych scenariuszy sygnalizujących:</span><span class="sxs-lookup"><span data-stu-id="38c58-273">Here are some typical SignalR scenarios:</span></span>
> 
> - <span data-ttu-id="38c58-274">[Emisja serwera](tutorial-server-broadcast-with-signalr.md) (np. giełdowego): plany pracy dla tego scenariusza są odpowiednie, ponieważ serwer kontroluje szybkość, z jaką wysyłane są komunikaty.</span><span class="sxs-lookup"><span data-stu-id="38c58-274">[Server broadcast](tutorial-server-broadcast-with-signalr.md) (e.g., stock ticker): Backplanes work well for this scenario, because the server controls the rate at which messages are sent.</span></span>
> - <span data-ttu-id="38c58-275">[Klient-Klient](tutorial-getting-started-with-signalr.md) (np. rozmowa): w tym scenariuszu plan może być wąskim gardłem, jeśli liczba komunikatów skaluje się do liczby klientów. oznacza to, że jeśli szybkość komunikatów rośnie proporcjonalnie do przyłączenia większej liczby klientów.</span><span class="sxs-lookup"><span data-stu-id="38c58-275">[Client-to-client](tutorial-getting-started-with-signalr.md) (e.g., chat): In this scenario, the backplane might be a bottleneck if the number of messages scales with the number of clients; that is, if the rate of messages grows proportionally as more clients join.</span></span>
> - <span data-ttu-id="38c58-276">[Wysoka częstotliwość](tutorial-high-frequency-realtime-with-signalr.md) w czasie rzeczywistym (np. w grach czasu rzeczywistego): w tym scenariuszu nie zaleca się planowania.</span><span class="sxs-lookup"><span data-stu-id="38c58-276">[High-frequency realtime](tutorial-high-frequency-realtime-with-signalr.md) (e.g., real-time games): A backplane is not recommended for this scenario.</span></span>

<span data-ttu-id="38c58-277">W tym ćwiczeniu będziesz używać **SQL Server** do dystrybuowania komunikatów w aplikacji **quizu pojedynek maniaków komputerowych** .</span><span class="sxs-lookup"><span data-stu-id="38c58-277">In this exercise, you will use **SQL Server** to distribute messages across the **Geek Quiz** application.</span></span> <span data-ttu-id="38c58-278">Te zadania zostaną uruchomione na pojedynczym komputerze testowym, aby dowiedzieć się, jak skonfigurować konfigurację, ale w celu uzyskania pełnego efektu należy wdrożyć aplikację sygnalizującą na co najmniej dwóch serwerach.</span><span class="sxs-lookup"><span data-stu-id="38c58-278">You will run these tasks on a single test machine to learn how to set up the configuration, but in order to get the full effect, you will need to deploy the SignalR application to two or more servers.</span></span> <span data-ttu-id="38c58-279">Należy również zainstalować SQL Server na jednym z serwerów lub na osobnym dedykowanym serwerze.</span><span class="sxs-lookup"><span data-stu-id="38c58-279">You must also install SQL Server on one of the servers, or on a separate dedicated server.</span></span>

![Skalowanie w poziomie przy użyciu diagramu SQL Server](real-time-web-applications-with-signalr/_static/image15.png)

<a id="Ex2Task1"></a>
#### <a name="task-1---understanding-the-scenario"></a><span data-ttu-id="38c58-281">Zadanie 1 — zrozumienie scenariusza</span><span class="sxs-lookup"><span data-stu-id="38c58-281">Task 1 - Understanding the Scenario</span></span>

<span data-ttu-id="38c58-282">W tym zadaniu zostanie uruchomione 2 wystąpienia **quizu pojedynek maniaków komputerowych** , które symulują wiele wystąpień usług IIS na komputerze lokalnym.</span><span class="sxs-lookup"><span data-stu-id="38c58-282">In this task, you will run 2 instances of **Geek Quiz** simulating multiple IIS instances on your local machine.</span></span> <span data-ttu-id="38c58-283">W tym scenariuszu podczas odpowiadania na pytania kwizy w jednej aplikacji aktualizacja nie będzie powiadamiana na stronie statystyk drugiego wystąpienia.</span><span class="sxs-lookup"><span data-stu-id="38c58-283">In this scenario, when answering trivia questions on one application, update won't be notified on the statistics page of the second instance.</span></span> <span data-ttu-id="38c58-284">Ta symulacja przypomina środowisko, w którym aplikacja jest wdrażana w wielu wystąpieniach i używa modułu równoważenia obciążenia do komunikowania się z nimi.</span><span class="sxs-lookup"><span data-stu-id="38c58-284">This simulation resembles an environment where your application is deployed on multiple instances and using a load balancer to communicate with them.</span></span>

1. <span data-ttu-id="38c58-285">Otwórz rozwiązanie **BEGIN. sln** znajdujące się w folderze **Source/Ex2-ScalingOutWithSQLServer/BEGIN** .</span><span class="sxs-lookup"><span data-stu-id="38c58-285">Open the **Begin.sln** solution located in the **Source/Ex2-ScalingOutWithSQLServer/Begin** folder.</span></span> <span data-ttu-id="38c58-286">Po załadowaniu należy **Eksplorator serwera** zauważyć, że rozwiązanie ma dwa projekty z identycznymi strukturami, ale o różnych nazwach.</span><span class="sxs-lookup"><span data-stu-id="38c58-286">Once loaded, you will notice on the **Server Explorer** that the solution has two projects with identical structures but different names.</span></span> <span data-ttu-id="38c58-287">Spowoduje to zasymulowanie uruchamiania dwóch wystąpień tej samej aplikacji na komputerze lokalnym.</span><span class="sxs-lookup"><span data-stu-id="38c58-287">This will simulate running two instances of the same application on your local machine.</span></span>

    <span data-ttu-id="38c58-288">![Rozpocznij rozwiązanie symuluje 2 wystąpienia quizu pojedynek maniaków komputerowych](real-time-web-applications-with-signalr/_static/image16.png "Rozpocznij rozwiązanie symuluje 2 wystąpienia quizu pojedynek maniaków komputerowych")</span><span class="sxs-lookup"><span data-stu-id="38c58-288">![Begin Solution Simulating 2 Instances of Geek Quiz](real-time-web-applications-with-signalr/_static/image16.png "Begin Solution Simulating 2 Instances of Geek Quiz")</span></span>

    <span data-ttu-id="38c58-289">*Rozpocznij rozwiązanie symuluje 2 wystąpienia quizu pojedynek maniaków komputerowych*</span><span class="sxs-lookup"><span data-stu-id="38c58-289">*Begin Solution Simulating 2 Instances of Geek Quiz*</span></span>
2. <span data-ttu-id="38c58-290">Otwórz stronę właściwości rozwiązania, klikając prawym przyciskiem myszy węzeł rozwiązania i wybierając polecenie **Właściwości**.</span><span class="sxs-lookup"><span data-stu-id="38c58-290">Open the properties page of the solution by right-clicking the solution node and selecting **Properties**.</span></span> <span data-ttu-id="38c58-291">W obszarze **projekt startowy**wybierz opcję **wiele projektów startowych** , a następnie zmień wartość **akcji** dla obu projektów na *Rozpocznij*.</span><span class="sxs-lookup"><span data-stu-id="38c58-291">Under **Startup Project**, select **Multiple startup projects** and change the **Action** value for both projects to *Start*.</span></span>

    <span data-ttu-id="38c58-292">![Uruchamianie wielu projektów](real-time-web-applications-with-signalr/_static/image17.png "Uruchamianie wielu projektów")</span><span class="sxs-lookup"><span data-stu-id="38c58-292">![Starting Multiple Projects](real-time-web-applications-with-signalr/_static/image17.png "Starting Multiple Projects")</span></span>

    <span data-ttu-id="38c58-293">*Uruchamianie wielu projektów*</span><span class="sxs-lookup"><span data-stu-id="38c58-293">*Starting Multiple Projects*</span></span>
3. <span data-ttu-id="38c58-294">Naciśnij klawisz **F5** , aby uruchomić rozwiązanie.</span><span class="sxs-lookup"><span data-stu-id="38c58-294">Press **F5** to run the solution.</span></span> <span data-ttu-id="38c58-295">Aplikacja uruchomi dwa wystąpienia **quizu pojedynek maniaków komputerowych** w różnych portach, symulując wiele wystąpień tej samej aplikacji.</span><span class="sxs-lookup"><span data-stu-id="38c58-295">The application will launch two instances of **Geek Quiz** in different ports, simulating multiple instances of the same application.</span></span> <span data-ttu-id="38c58-296">Przypnij jedną z przeglądarek po lewej stronie i drugą na prawo od ekranu.</span><span class="sxs-lookup"><span data-stu-id="38c58-296">Pin one of the browsers on left and the other on the right of your screen.</span></span> <span data-ttu-id="38c58-297">Zaloguj się przy użyciu swoich poświadczeń lub Zarejestruj nowego użytkownika.</span><span class="sxs-lookup"><span data-stu-id="38c58-297">Log in with your credentials or register a new user.</span></span> <span data-ttu-id="38c58-298">Po zalogowaniu Zachowaj stronę kwizy po lewej stronie i przejdź do strony **Statystyka** w przeglądarce po prawej.</span><span class="sxs-lookup"><span data-stu-id="38c58-298">Once logged in, keep the Trivia page on the left and go to the **Statistics** page in the browser on the right.</span></span>

    ![Pojedynek maniaków komputerowych Quiz obok siebie](real-time-web-applications-with-signalr/_static/image18.png)

    <span data-ttu-id="38c58-300">*Pojedynek maniaków komputerowych Quiz obok siebie*</span><span class="sxs-lookup"><span data-stu-id="38c58-300">*Geek Quiz Side by Side*</span></span>

    ![Quiz pojedynek maniaków komputerowych w różnych portach](real-time-web-applications-with-signalr/_static/image19.png)

    <span data-ttu-id="38c58-302">*Quiz pojedynek maniaków komputerowych w różnych portach*</span><span class="sxs-lookup"><span data-stu-id="38c58-302">*Geek Quiz in Different Ports*</span></span>
4. <span data-ttu-id="38c58-303">Zacznij odpowiadać na pytania w lewej przeglądarce, aby zauważyć, że strona **statystyk** w odpowiedniej przeglądarce nie jest aktualizowana.</span><span class="sxs-lookup"><span data-stu-id="38c58-303">Start answering questions in the left browser and you will notice that the **Statistics** page in the right browser is not being updated.</span></span> <span data-ttu-id="38c58-304">Wynika to z faktu, że usługa **sygnalizująca** korzysta z lokalnej pamięci podręcznej do dystrybuowania komunikatów na klientach, a ten scenariusz symuluje wiele wystąpień, dlatego pamięć podręczna nie jest udostępniana między nimi.</span><span class="sxs-lookup"><span data-stu-id="38c58-304">This is because **SignalR** uses a local cache to distribute messages across their clients and this scenario is simulating multiple instances, therefore the cache is not shared between them.</span></span> <span data-ttu-id="38c58-305">Możesz sprawdzić, czy program **sygnalizujący** działa, testując te same kroki, ale używając jednej aplikacji.</span><span class="sxs-lookup"><span data-stu-id="38c58-305">You can verify that **SignalR** is working by testing the same steps but using a single app.</span></span> <span data-ttu-id="38c58-306">Poniższe zadania umożliwiają skonfigurowanie planu w celu replikowania komunikatów między wystąpieniami.</span><span class="sxs-lookup"><span data-stu-id="38c58-306">In the following tasks you will configure a backplane to replicate the messages across instances.</span></span>
5. <span data-ttu-id="38c58-307">Wróć do programu Visual Studio i Zatrzymaj debugowanie.</span><span class="sxs-lookup"><span data-stu-id="38c58-307">Go back to Visual Studio and stop debugging.</span></span>

<a id="Ex2Task2"></a>
#### <a name="task-2--creating-the-sql-server-backplane"></a><span data-ttu-id="38c58-308">Zadanie 2 — Tworzenie planu SQL Server</span><span class="sxs-lookup"><span data-stu-id="38c58-308">Task 2 – Creating the SQL Server Backplane</span></span>

<span data-ttu-id="38c58-309">W tym zadaniu utworzysz bazę danych, która będzie działać jako plan dla aplikacji **quizu pojedynek maniaków komputerowych** .</span><span class="sxs-lookup"><span data-stu-id="38c58-309">In this task, you will create a database that will serve as a backplane for the **Geek Quiz** application.</span></span> <span data-ttu-id="38c58-310">Będziesz używać **Eksplorator obiektów SQL Server** , aby przeglądać serwer i inicjować bazę danych.</span><span class="sxs-lookup"><span data-stu-id="38c58-310">You will use **SQL Server Object Explorer** to browse your server and initialize the database.</span></span> <span data-ttu-id="38c58-311">Ponadto zostanie włączona **Service Broker**.</span><span class="sxs-lookup"><span data-stu-id="38c58-311">Additionally, you will enable the **Service Broker**.</span></span>

1. <span data-ttu-id="38c58-312">W programie **Visual Studio**Otwórz **Widok** menu i wybierz **Eksplorator obiektów SQL Server**.</span><span class="sxs-lookup"><span data-stu-id="38c58-312">In **Visual Studio**, open menu **View** and select **SQL Server Object Explorer**.</span></span>
2. <span data-ttu-id="38c58-313">Połącz się z wystąpieniem LocalDB, klikając prawym przyciskiem myszy węzeł **SQL Server** i wybierając polecenie **Dodaj SQL Server...** .</span><span class="sxs-lookup"><span data-stu-id="38c58-313">Connect to your LocalDB instance by right-clicking the **SQL Server** node and selecting **Add SQL Server...** option.</span></span>

    <span data-ttu-id="38c58-314">![Dodawanie wystąpienia SQL Server](real-time-web-applications-with-signalr/_static/image20.png "Dodawanie wystąpienia SQL Server")</span><span class="sxs-lookup"><span data-stu-id="38c58-314">![Adding a SQL Server Instance](real-time-web-applications-with-signalr/_static/image20.png "Adding a SQL Server Instance")</span></span>

    <span data-ttu-id="38c58-315">*Dodawanie wystąpienia SQL Server do Eksplorator obiektów SQL Server*</span><span class="sxs-lookup"><span data-stu-id="38c58-315">*Adding a SQL Server instance to SQL Server Object Explorer*</span></span>
3. <span data-ttu-id="38c58-316">Ustaw **nazwę serwera** na *(LocalDB) \V11.0* i pozostaw **uwierzytelnianie systemu Windows** jako tryb uwierzytelniania.</span><span class="sxs-lookup"><span data-stu-id="38c58-316">Set the **server name** to *(localdb)\v11.0* and leave **Windows Authentication** as your authentication mode.</span></span> <span data-ttu-id="38c58-317">Kliknij pozycję **Połącz**, aby kontynuować.</span><span class="sxs-lookup"><span data-stu-id="38c58-317">Click **Connect** to continue.</span></span>

    <span data-ttu-id="38c58-318">![Nawiązywanie połączenia z usługą LocalDB](real-time-web-applications-with-signalr/_static/image21.png "Nawiązywanie połączenia z usługą LocalDB")</span><span class="sxs-lookup"><span data-stu-id="38c58-318">![Connecting to LocalDB](real-time-web-applications-with-signalr/_static/image21.png "Connecting to LocalDB")</span></span>

    <span data-ttu-id="38c58-319">*Nawiązywanie połączenia z usługą LocalDB*</span><span class="sxs-lookup"><span data-stu-id="38c58-319">*Connecting to LocalDB*</span></span>
4. <span data-ttu-id="38c58-320">Teraz, gdy masz połączenie z wystąpieniem usługi LocalDB, musisz utworzyć bazę danych, która będzie reprezentować SQL Server plan dla sygnalizującego.</span><span class="sxs-lookup"><span data-stu-id="38c58-320">Now that you are connected to your LocalDB instance, you will need to create a database that will represent the SQL Server backplane for SignalR.</span></span> <span data-ttu-id="38c58-321">Aby to zrobić, kliknij prawym przyciskiem myszy węzeł **bazy danych** i wybierz polecenie **Dodaj nową bazę danych**.</span><span class="sxs-lookup"><span data-stu-id="38c58-321">To do this, right-click the **Databases** node and select **Add New Database**.</span></span>

    <span data-ttu-id="38c58-322">![Dodawanie nowej bazy danych](real-time-web-applications-with-signalr/_static/image22.png "Dodawanie nowej bazy danych")</span><span class="sxs-lookup"><span data-stu-id="38c58-322">![Adding a new database](real-time-web-applications-with-signalr/_static/image22.png "Adding a new database")</span></span>

    <span data-ttu-id="38c58-323">*Dodawanie nowej bazy danych*</span><span class="sxs-lookup"><span data-stu-id="38c58-323">*Adding a new database*</span></span>
5. <span data-ttu-id="38c58-324">Ustaw nazwę bazy danych na *sygnalizacja* i kliknij przycisk **OK** , aby ją utworzyć.</span><span class="sxs-lookup"><span data-stu-id="38c58-324">Set the database name to *SignalR* and click **OK** to create it.</span></span>

    <span data-ttu-id="38c58-325">![Tworzenie bazy danych sygnalizującego](real-time-web-applications-with-signalr/_static/image23.png "Tworzenie bazy danych sygnalizującego")</span><span class="sxs-lookup"><span data-stu-id="38c58-325">![Creating the SignalR database](real-time-web-applications-with-signalr/_static/image23.png "Creating the SignalR database")</span></span>

    <span data-ttu-id="38c58-326">*Tworzenie bazy danych sygnalizującego*</span><span class="sxs-lookup"><span data-stu-id="38c58-326">*Creating the SignalR database*</span></span>

    > [!NOTE]
    > <span data-ttu-id="38c58-327">Możesz wybrać dowolną nazwę bazy danych.</span><span class="sxs-lookup"><span data-stu-id="38c58-327">You can choose any name for the database.</span></span>
6. <span data-ttu-id="38c58-328">Aby szybciej otrzymywać aktualizacje z planu, zaleca się włączenie Service Broker bazy danych.</span><span class="sxs-lookup"><span data-stu-id="38c58-328">To receive updates more efficiently from the backplane, it is recommended to enable Service Broker for the database.</span></span> <span data-ttu-id="38c58-329">Service Broker zapewnia natywną obsługę komunikatów i kolejkowania w programie SQL Server.</span><span class="sxs-lookup"><span data-stu-id="38c58-329">Service Broker provides native support for messaging and queuing in SQL Server.</span></span> <span data-ttu-id="38c58-330">Plan nie działa również bez Service Broker.</span><span class="sxs-lookup"><span data-stu-id="38c58-330">The backplane also works without Service Broker.</span></span> <span data-ttu-id="38c58-331">Otwórz nowe zapytanie, klikając prawym przyciskiem myszy bazę danych i wybierz polecenie **nowe zapytanie**.</span><span class="sxs-lookup"><span data-stu-id="38c58-331">Open a new query by right-clicking the database and select **New Query**.</span></span>

    <span data-ttu-id="38c58-332">![Otwieranie nowego zapytania](real-time-web-applications-with-signalr/_static/image24.png "Otwieranie nowego zapytania")</span><span class="sxs-lookup"><span data-stu-id="38c58-332">![Opening a New Query](real-time-web-applications-with-signalr/_static/image24.png "Opening a New Query")</span></span>

    <span data-ttu-id="38c58-333">*Otwieranie nowego zapytania*</span><span class="sxs-lookup"><span data-stu-id="38c58-333">*Opening a New Query*</span></span>
7. <span data-ttu-id="38c58-334">Aby sprawdzić, czy Service Broker jest włączona, zbadaj kolumnę **is\_Broker\_Enabled** w widoku wykazu **sys. databases** .</span><span class="sxs-lookup"><span data-stu-id="38c58-334">To check whether Service Broker is enabled, query the **is\_broker\_enabled** column in the **sys.databases** catalog view.</span></span> <span data-ttu-id="38c58-335">Wykonaj następujący skrypt w ostatnio otwartym oknie zapytania.</span><span class="sxs-lookup"><span data-stu-id="38c58-335">Execute the following script in the recently opened query window.</span></span>

    [!code-sql[Main](real-time-web-applications-with-signalr/samples/sample11.sql)]

    <span data-ttu-id="38c58-336">![Wykonywanie zapytania dotyczącego stanu Service Broker](real-time-web-applications-with-signalr/_static/image25.png "Wykonywanie zapytania dotyczącego stanu Service Broker")</span><span class="sxs-lookup"><span data-stu-id="38c58-336">![Querying the Service Broker Status](real-time-web-applications-with-signalr/_static/image25.png "Querying the Service Broker Status")</span></span>

    <span data-ttu-id="38c58-337">*Wykonywanie zapytania dotyczącego stanu Service Broker*</span><span class="sxs-lookup"><span data-stu-id="38c58-337">*Querying the Service Broker Status*</span></span>
8. <span data-ttu-id="38c58-338">Jeśli wartość kolumny " **\_broker\_włączona** w bazie danych jest &quot;0&quot;, użyj następującego polecenia, aby je włączyć.</span><span class="sxs-lookup"><span data-stu-id="38c58-338">If the value of the **is\_broker\_enabled** column in your database is &quot;0&quot;, use the following command to enable it.</span></span> <span data-ttu-id="38c58-339">Zastąp **&lt;&gt;bazy danych** nazwą ustawioną podczas tworzenia bazy danych (np.: sygnalizującer).</span><span class="sxs-lookup"><span data-stu-id="38c58-339">Replace **&lt;YOUR-DATABASE&gt;** with the name you set when creating the database (e.g.: SignalR).</span></span>

    [!code-sql[Main](real-time-web-applications-with-signalr/samples/sample12.sql)]

    <span data-ttu-id="38c58-340">![Włączanie Service Broker](real-time-web-applications-with-signalr/_static/image26.png "Włączanie Service Broker")</span><span class="sxs-lookup"><span data-stu-id="38c58-340">![Enabling Service Broker](real-time-web-applications-with-signalr/_static/image26.png "Enabling Service Broker")</span></span>

    <span data-ttu-id="38c58-341">*Włączanie Service Broker*</span><span class="sxs-lookup"><span data-stu-id="38c58-341">*Enabling Service Broker*</span></span>

    > [!NOTE]
    > <span data-ttu-id="38c58-342">Jeśli ta kwerenda wydaje się być zakleszczeniem, upewnij się, że żadne aplikacje nie są połączone z bazą danych.</span><span class="sxs-lookup"><span data-stu-id="38c58-342">If this query appears to deadlock, make sure there are no applications connected to the DB.</span></span>

<a id="Ex2Task3"></a>
#### <a name="task-3--configuring-the-signalr-application"></a><span data-ttu-id="38c58-343">Zadanie 3 — Konfigurowanie aplikacji sygnalizującej</span><span class="sxs-lookup"><span data-stu-id="38c58-343">Task 3 – Configuring the SignalR Application</span></span>

<span data-ttu-id="38c58-344">W tym zadaniu skonfigurujesz **Quiz pojedynek maniaków komputerowych** , aby połączyć się z planem SQL Server.</span><span class="sxs-lookup"><span data-stu-id="38c58-344">In this task, you will configure **Geek Quiz** to connect to the SQL Server backplane.</span></span> <span data-ttu-id="38c58-345">Najpierw dodamy pakiet NuGet programu **signaler. SqlServer** i ustawimy parametry połączenia z bazą danych.</span><span class="sxs-lookup"><span data-stu-id="38c58-345">You will first add the **SignalR.SqlServer** NuGet package and set the connection string to your backplane database.</span></span>

1. <span data-ttu-id="38c58-346">Otwórz **konsolę Menedżera pakietów** z **narzędzi** > **Menedżera pakietów NuGet**.</span><span class="sxs-lookup"><span data-stu-id="38c58-346">Open the **Package Manager Console** from **Tools** > **NuGet Package Manager**.</span></span> <span data-ttu-id="38c58-347">Upewnij się, że na liście rozwijanej **domyślny projekt** jest wybrany projekt **GeekQuiz** .</span><span class="sxs-lookup"><span data-stu-id="38c58-347">Make sure that **GeekQuiz** project is selected in the **Default project** drop-down list.</span></span> <span data-ttu-id="38c58-348">Wpisz następujące polecenie, aby zainstalować pakiet NuGet **Microsoft. ASPNET. Signal. SqlServer** .</span><span class="sxs-lookup"><span data-stu-id="38c58-348">Type the following command to install the **Microsoft.AspNet.SignalR.SqlServer** NuGet package.</span></span>

    [!code-powershell[Main](real-time-web-applications-with-signalr/samples/sample13.ps1)]
2. <span data-ttu-id="38c58-349">Powtórz poprzedni krok, ale ten czas dla projektu **GeekQuiz2**.</span><span class="sxs-lookup"><span data-stu-id="38c58-349">Repeat the previous step but this time for project **GeekQuiz2**.</span></span>
3. <span data-ttu-id="38c58-350">Aby skonfigurować plan SQL Server, Otwórz plik **Startup.cs** projektu **GeekQuiz** i Dodaj następujący kod do metody **Configure** .</span><span class="sxs-lookup"><span data-stu-id="38c58-350">To configure the SQL Server backplane, open the **Startup.cs** file of the **GeekQuiz** project and add the following code to the **Configure** method.</span></span> <span data-ttu-id="38c58-351">Zastąp **&lt;&gt;bazy** danych nazwą swojej bazy danych, która została użyta podczas tworzenia planu SQL Server.</span><span class="sxs-lookup"><span data-stu-id="38c58-351">Replace **&lt;YOUR-DATABASE&gt;** with your database name you used when creating the SQL Server backplane.</span></span> <span data-ttu-id="38c58-352">Powtórz ten krok dla projektu **GeekQuiz2** .</span><span class="sxs-lookup"><span data-stu-id="38c58-352">Repeat this step for the **GeekQuiz2** project.</span></span>

    <span data-ttu-id="38c58-353">(Fragment kodu- *RealTimeSignalR-Ex2-StartupConfiguration*)</span><span class="sxs-lookup"><span data-stu-id="38c58-353">(Code Snippet - *RealTimeSignalR - Ex2 - StartupConfiguration*)</span></span>

    [!code-csharp[Main](real-time-web-applications-with-signalr/samples/sample14.cs)]
4. <span data-ttu-id="38c58-354">Teraz, gdy oba projekty są skonfigurowane do używania planu SQL Server, naciśnij klawisz **F5** , aby uruchomić je jednocześnie.</span><span class="sxs-lookup"><span data-stu-id="38c58-354">Now that both projects are configured to use the SQL Server backplane, press **F5** to run them simultaneously.</span></span>
5. <span data-ttu-id="38c58-355">Ponownie program **Visual Studio** uruchomi dwa wystąpienia **quizu pojedynek maniaków komputerowych** na różnych portach.</span><span class="sxs-lookup"><span data-stu-id="38c58-355">Again, **Visual Studio** will launch two instances of **Geek Quiz** in different ports.</span></span> <span data-ttu-id="38c58-356">Przypnij jedną z przeglądarek po lewej stronie, a drugą z prawej strony ekranu i zaloguj się przy użyciu swoich poświadczeń.</span><span class="sxs-lookup"><span data-stu-id="38c58-356">Pin one of the browsers on the left and the other on the right of your screen and log in with your credentials.</span></span> <span data-ttu-id="38c58-357">Pozostaw stronę kwizy po lewej stronie i przejdź do strony **statystyk** w odpowiedniej przeglądarce.</span><span class="sxs-lookup"><span data-stu-id="38c58-357">Keep the Trivia page on the left and go to **Statistics** pagein the right browser.</span></span>
6. <span data-ttu-id="38c58-358">Zacznij odpowiadać na pytania w przeglądarce po lewej stronie.</span><span class="sxs-lookup"><span data-stu-id="38c58-358">Start answering questions in the left browser.</span></span> <span data-ttu-id="38c58-359">Tym razem strona **statystyki** zostanie zaktualizowana w ramach planu pracy z planem.</span><span class="sxs-lookup"><span data-stu-id="38c58-359">This time, the **Statistics** page is updated thanks to the backplane.</span></span> <span data-ttu-id="38c58-360">Przełączaj między aplikacjami (**statystyki** są teraz po lewej stronie, a **kwizy** znajduje się po prawej) i Powtarzaj test, aby sprawdzić, czy działa on w obu wystąpieniach.</span><span class="sxs-lookup"><span data-stu-id="38c58-360">Switch between applications (**Statistics** is now on the left, and **Trivia** is on the right) and repeat the test to validate that it is working for both instances.</span></span> <span data-ttu-id="38c58-361">Plan jest używany jako *udostępniona pamięć podręczna* komunikatów dla każdego połączonego serwera, a każdy serwer będzie przechowywał komunikaty w swojej lokalnej pamięci podręcznej w celu dystrybucji do podłączonych klientów.</span><span class="sxs-lookup"><span data-stu-id="38c58-361">The backplane serves as a *shared cache* of messages for each connected server, and each server will store the messages in their own local cache to distribute to connected clients.</span></span>
7. <span data-ttu-id="38c58-362">Wróć do programu Visual Studio i Zatrzymaj debugowanie.</span><span class="sxs-lookup"><span data-stu-id="38c58-362">Go back to Visual Studio and stop debugging.</span></span>
8. <span data-ttu-id="38c58-363">Składnik SQL Servera planu automatycznego generuje niezbędne tabele w określonej bazie danych.</span><span class="sxs-lookup"><span data-stu-id="38c58-363">The SQL Server backplane component automatically generates the necessary tables on the specified database.</span></span> <span data-ttu-id="38c58-364">W panelu **Eksplorator obiektów SQL Server** Otwórz bazę danych utworzoną dla planu (np.: sygnalizującer) i rozwiń jej tabele.</span><span class="sxs-lookup"><span data-stu-id="38c58-364">In the **SQL Server Object Explorer** panel, open the database you created for the backplane (e.g.: SignalR) and expand its tables.</span></span> <span data-ttu-id="38c58-365">Powinny zostać wyświetlone następujące tabele:</span><span class="sxs-lookup"><span data-stu-id="38c58-365">You should see the following tables:</span></span>

    ![Tabele wygenerowane przez plan](real-time-web-applications-with-signalr/_static/image27.png)

    <span data-ttu-id="38c58-367">*Tabele wygenerowane przez plan*</span><span class="sxs-lookup"><span data-stu-id="38c58-367">*Backplane Generated Tables*</span></span>
9. <span data-ttu-id="38c58-368">Kliknij prawym przyciskiem myszy składnik **sygnalizujący. messages\_0** Table i wybierz polecenie **Wyświetl dane**.</span><span class="sxs-lookup"><span data-stu-id="38c58-368">Right-click the **SignalR.Messages\_0** table and select **View Data**.</span></span>

    ![Tabela komunikatów planu](real-time-web-applications-with-signalr/_static/image28.png)

    <span data-ttu-id="38c58-370">*Tabela komunikatów planu*</span><span class="sxs-lookup"><span data-stu-id="38c58-370">*View SignalR Backplane Messages Table*</span></span>
10. <span data-ttu-id="38c58-371">Podczas odpowiadania na pytania kwizy można zobaczyć różne komunikaty wysyłane do **centrum** .</span><span class="sxs-lookup"><span data-stu-id="38c58-371">You can see the different messages sent to the **Hub** when answering the trivia questions.</span></span> <span data-ttu-id="38c58-372">Plan moje rozesłać te komunikaty do dowolnego połączonego wystąpienia.</span><span class="sxs-lookup"><span data-stu-id="38c58-372">The backplane distributes these messages to any connected instance.</span></span>

    ![Tabela nieplanowanych komunikatów](real-time-web-applications-with-signalr/_static/image29.png)

    <span data-ttu-id="38c58-374">*Tabela nieplanowanych komunikatów*</span><span class="sxs-lookup"><span data-stu-id="38c58-374">*Backplane Messages Table*</span></span>

---

<a id="Summary"></a>
## <a name="summary"></a><span data-ttu-id="38c58-375">Podsumowanie</span><span class="sxs-lookup"><span data-stu-id="38c58-375">Summary</span></span>

<span data-ttu-id="38c58-376">W tym ćwiczeniu dowiesz się, jak dodać **sygnał** do aplikacji i wysyłać powiadomienia z serwera do podłączonych klientów przy użyciu **centrów**.</span><span class="sxs-lookup"><span data-stu-id="38c58-376">In this hands-on lab, you have learned how to add **SignalR** to your application and send notifications from the server to your connected clients using **Hubs**.</span></span> <span data-ttu-id="38c58-377">Ponadto wiesz już, jak skalować aplikację przy użyciu składnika dla *planu* , gdy aplikacja jest wdrażana w wielu WYSTĄPIENIACH usług IIS.</span><span class="sxs-lookup"><span data-stu-id="38c58-377">Additionally, you learned how to scale out your application by using a *backplane* component when your application is deployed in multiple IIS instances.</span></span>
