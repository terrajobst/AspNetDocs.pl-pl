---
uid: signalr/overview/performance/signalr-connection-density-testing-with-crank
title: Testowanie gęstości połączeń przy użyciu sygnału korbowego | Microsoft Docs
author: bradygaster
description: Testowanie gęstości połączenia usługi SignalR za pomocą funkcji Crank
ms.author: bradyg
ms.date: 02/22/2015
ms.assetid: 148d9ca7-1af1-44b6-a9fb-91e261b9b463
msc.legacyurl: /signalr/overview/performance/signalr-connection-density-testing-with-crank
msc.type: authoredcontent
ms.openlocfilehash: 901e039fbb81651ed18d560c99745b7e7f716e01
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 03/06/2020
ms.locfileid: "78558339"
---
# <a name="signalr-connection-density-testing-with-crank"></a><span data-ttu-id="6f1f6-103">Testowanie gęstości połączenia usługi SignalR za pomocą funkcji Crank</span><span class="sxs-lookup"><span data-stu-id="6f1f6-103">SignalR Connection Density Testing with Crank</span></span>

<span data-ttu-id="6f1f6-104">Autor [FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="6f1f6-104">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

[!INCLUDE [Consider ASP.NET Core SignalR](~/includes/signalr/signalr-version-disambiguation.md)]

> <span data-ttu-id="6f1f6-105">W tym artykule opisano sposób użycia narzędzia korb do testowania aplikacji z wieloma symulowanymi klientami.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-105">This article describes how to use the Crank tool to test an application with multiple simulated clients.</span></span>

<span data-ttu-id="6f1f6-106">Gdy aplikacja jest uruchomiona w środowisku hostingu (rola sieci Web platformy Azure, usługi IIS lub własne hosty za pomocą Owin), można testować odpowiedzi aplikacji na wysoki poziom gęstości połączeń przy użyciu narzędzia.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-106">Once your application is running in its hosting environment (either an Azure web role, IIS, or self-hosted using Owin), you can test application's response to a high level of connection density using the Crank tool.</span></span> <span data-ttu-id="6f1f6-107">Środowisko hostingu może być serwerem Internet Information Services (IIS), hostem Owin lub rolą sieci Web platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-107">The hosting environment can be an Internet Information Services (IIS) server, an Owin host, or an Azure web role.</span></span> <span data-ttu-id="6f1f6-108">(Uwaga: Liczniki wydajności nie są dostępne w Azure App Service Web Apps, więc nie będzie można uzyskać danych dotyczących wydajności z testu gęstości połączenia).</span><span class="sxs-lookup"><span data-stu-id="6f1f6-108">(Note: Performance counters are not available on Azure App Service Web Apps, so you will not be able to get performance data from a connection density test.)</span></span>

<span data-ttu-id="6f1f6-109">Gęstość połączenia odnosi się do liczby jednoczesnych połączeń TCP, które można ustalić na serwerze.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-109">Connection Density refers to the number of simultaneous TCP connections that can be established on a server.</span></span> <span data-ttu-id="6f1f6-110">Każde połączenie TCP wiąże się z własnym obciążeniem i otwarcie dużej liczby nieczynnych połączeń spowoduje powstanie wąskiego gardła pamięci.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-110">Each TCP connection incurs its own overhead, and opening a large number of idle connections will eventually create a memory bottleneck.</span></span>

<span data-ttu-id="6f1f6-111">[Baza kodu sygnalizująca](https://github.com/signalr/signalr) zawiera narzędzie do testowania obciążenia o nazwie **korb**.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-111">[The SignalR codebase](https://github.com/signalr/signalr) includes a load-testing tool called **Crank**.</span></span> <span data-ttu-id="6f1f6-112">Najnowszą wersję platformy 4.0 można znaleźć w [gałęzi dev](https://github.com/SignalR/signalr/tree/dev) w witrynie GitHub.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-112">The latest version of Crank can be found in [the Dev branch](https://github.com/SignalR/signalr/tree/dev) on GitHub.</span></span> <span data-ttu-id="6f1f6-113">W [tym miejscu](https://github.com/SignalR/SignalR/archive/dev.zip)możesz pobrać archiwum zip gałęzi dev dla sygnalizującej.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-113">You can download a Zip archive of the Dev branch of the SignalR codebase [here](https://github.com/SignalR/SignalR/archive/dev.zip).</span></span>

<span data-ttu-id="6f1f6-114">System korb może służyć do całkowitego nasycenia pamięci serwera, aby można było obliczyć łączną liczbę bezczynnych połączeń na sprzęcie serwera.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-114">Crank may be used to fully saturate the server's memory in order to calculate the total number of idle connections possible on the server hardware.</span></span> <span data-ttu-id="6f1f6-115">Alternatywnie, można również użyć opcji korb do załadowania serwera z określoną ilością pamięci, aby obciążać połączenia do momentu osiągnięcia określonej liczby lub określonego progu pamięci.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-115">Alternatively, you may also use Crank to load test the server under a certain amount of memory pressure, by ramping up connections until a specific count or a specific memory threshold is reached.</span></span>

<span data-ttu-id="6f1f6-116">Podczas testowania należy używać zdalnych klientów, aby uniknąć wszelkich konkursów zasobów (tj. połączeń TCP i pamięci).</span><span class="sxs-lookup"><span data-stu-id="6f1f6-116">When testing, it is important to use remote client(s) to avoid any competition for resources (i.e., TCP connections and memory).</span></span> <span data-ttu-id="6f1f6-117">Monitoruj klientów, aby upewnić się, że nie powodują one wąskich gardeł, które mogą uniemożliwić serwerowi osiągnięcie pełnej pojemności (pamięci lub procesora CPU).</span><span class="sxs-lookup"><span data-stu-id="6f1f6-117">Monitor the client(s) to ensure that they are not hitting any bottlenecks that may prevent the server from reaching its full capacity (memory or CPU).</span></span> <span data-ttu-id="6f1f6-118">Może być konieczne zwiększenie liczby klientów w celu całkowitego załadowania serwera.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-118">You may need to increase the number of clients in order to fully load the server.</span></span>

### <a name="running-a-connection-density-test"></a><span data-ttu-id="6f1f6-119">Uruchamianie testu gęstości połączenia</span><span class="sxs-lookup"><span data-stu-id="6f1f6-119">Running a Connection Density Test</span></span>

<span data-ttu-id="6f1f6-120">W tej sekcji opisano kroki wymagane do uruchomienia testu gęstości połączenia w aplikacji sygnalizującej.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-120">This section describes the steps needed to run a connection density test on a SignalR application.</span></span>

1. <span data-ttu-id="6f1f6-121">Pobierz i skompiluj [gałąź Dev dla sygnalizującego kodu](https://github.com/SignalR/SignalR/archive/dev.zip).</span><span class="sxs-lookup"><span data-stu-id="6f1f6-121">Download and build the [Dev branch of the SignalR codebase](https://github.com/SignalR/SignalR/archive/dev.zip).</span></span> <span data-ttu-id="6f1f6-122">W wierszu polecenia przejdź do &lt;katalogu projektu&gt;\src\Microsoft.AspNet.SignalR.Crank\bin\debug.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-122">In a command prompt, navigate to &lt;project directory&gt;\src\Microsoft.AspNet.SignalR.Crank\bin\debug.</span></span>
2. <span data-ttu-id="6f1f6-123">Wdróż aplikację w zamierzonym środowisku hostingu.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-123">Deploy your application to its intended hosting environment.</span></span> <span data-ttu-id="6f1f6-124">Zanotuj punkt końcowy używany przez aplikację; na przykład w aplikacji utworzonej w [samouczku wprowadzenie](../getting-started/tutorial-getting-started-with-signalr.md)punkt końcowy jest `http://<yourhost>:8080/signalr`.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-124">Make a note of the endpoint that your application uses; for example, in the application created in the [Getting Started tutorial](../getting-started/tutorial-getting-started-with-signalr.md), the endpoint is `http://<yourhost>:8080/signalr`.</span></span>
3. <span data-ttu-id="6f1f6-125">[Liczniki wydajności instalacji sygnałów](signalr-performance.md#perfcounters) na serwerze.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-125">Install [SignalR performance counters](signalr-performance.md#perfcounters) on the server.</span></span> <span data-ttu-id="6f1f6-126">Jeśli aplikacja działa na platformie Azure, zobacz [Używanie liczników wydajności sygnałów w roli sieci Web platformy Azure](using-signalr-performance-counters-in-an-azure-web-role.md).</span><span class="sxs-lookup"><span data-stu-id="6f1f6-126">If your application is running on Azure, see [Using SignalR Performance Counters in an Azure Web Role](using-signalr-performance-counters-in-an-azure-web-role.md).</span></span>

<span data-ttu-id="6f1f6-127">Po pobraniu i skompilowaniu bazy kodu i zainstalowaniu liczników wydajności na hoście można znaleźć w folderze `src\Microsoft.AspNet.SignalR.Crank\bin\Debug`.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-127">Once you've downloaded and built the codebase, and installed performance counters on your host, the Crank command-line tool can be found in the `src\Microsoft.AspNet.SignalR.Crank\bin\Debug` folder.</span></span>

<span data-ttu-id="6f1f6-128">Dostępne opcje narzędzia korb to:</span><span class="sxs-lookup"><span data-stu-id="6f1f6-128">Available options for the Crank tool include:</span></span>

- <span data-ttu-id="6f1f6-129">**/?** : Wyświetla ekran pomoc.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-129">**/?**: Shows the help screen.</span></span> <span data-ttu-id="6f1f6-130">Dostępne opcje są również wyświetlane w przypadku pominięcia parametru **adresu URL** .</span><span class="sxs-lookup"><span data-stu-id="6f1f6-130">The available options are also displayed if the **Url** parameter is omitted.</span></span>
- <span data-ttu-id="6f1f6-131">**/URL**: adres URL dla połączeń sygnału.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-131">**/Url**: The URL for SignalR connections.</span></span> <span data-ttu-id="6f1f6-132">Ten parametr jest wymagany.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-132">This parameter is required.</span></span> <span data-ttu-id="6f1f6-133">W przypadku aplikacji sygnalizującej przy użyciu domyślnego mapowania ścieżka zostanie zakończona "/SignalR".</span><span class="sxs-lookup"><span data-stu-id="6f1f6-133">For a SignalR application using the default mapping, the path will end in "/signalr".</span></span>
- <span data-ttu-id="6f1f6-134">**/Transport**: Nazwa używanej transportu.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-134">**/Transport**: The name of the transport used.</span></span> <span data-ttu-id="6f1f6-135">Wartość domyślna to `auto`, co spowoduje wybranie najlepszego dostępnego protokołu.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-135">The default is `auto`, which will select the best available protocol.</span></span> <span data-ttu-id="6f1f6-136">Opcje obejmują `WebSockets`, `ServerSentEvents`i `LongPolling` (`ForeverFrame` nie jest opcją dla systemu korbowego, ponieważ jest używany klient .NET zamiast programu Internet Explorer).</span><span class="sxs-lookup"><span data-stu-id="6f1f6-136">Options include `WebSockets`, `ServerSentEvents`, and `LongPolling` (`ForeverFrame` is not an option for Crank, since the .NET client rather than Internet Explorer is used).</span></span> <span data-ttu-id="6f1f6-137">Aby uzyskać więcej informacji o tym, jak program sygnalizujący wybiera transporty, zobacz [Transports and fallbacks](../getting-started/introduction-to-signalr.md#transports).</span><span class="sxs-lookup"><span data-stu-id="6f1f6-137">For more information on how SignalR selects transports, see [Transports and Fallbacks](../getting-started/introduction-to-signalr.md#transports).</span></span>
- <span data-ttu-id="6f1f6-138">**/BatchSize**: liczba klientów dodanych do każdej partii.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-138">**/BatchSize**: The number of clients added in each batch.</span></span> <span data-ttu-id="6f1f6-139">Wartość domyślna to 50.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-139">The default is 50.</span></span>
- <span data-ttu-id="6f1f6-140">**/ConnectInterval**: interwał w milisekundach między dodawaniem połączeń.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-140">**/ConnectInterval**: The interval in milliseconds between adding connections.</span></span> <span data-ttu-id="6f1f6-141">Wartość domyślna to 500.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-141">The default is 500.</span></span>
- <span data-ttu-id="6f1f6-142">**/Connections**: liczba połączeń używanych do załadowania i testowania aplikacji.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-142">**/Connections**: The number of connections used to load-test the application.</span></span> <span data-ttu-id="6f1f6-143">Wartość domyślna to 100 000.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-143">The default is 100,000.</span></span>
- <span data-ttu-id="6f1f6-144">**/ConnectTimeout**: limit czasu (w sekundach), po upływie którego test zostanie przerwany.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-144">**/ConnectTimeout**: The timeout in seconds before aborting the test.</span></span> <span data-ttu-id="6f1f6-145">Wartość domyślna to 300.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-145">The default is 300.</span></span>
- <span data-ttu-id="6f1f6-146">**MinServerMBytes**: minimalny dostęp do serwera (w megabajtach).</span><span class="sxs-lookup"><span data-stu-id="6f1f6-146">**MinServerMBytes**: The minimum server megabytes to reach.</span></span> <span data-ttu-id="6f1f6-147">Wartość domyślna to 500.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-147">The default is 500.</span></span>
- <span data-ttu-id="6f1f6-148">**SendBytes**: rozmiar ładunku wysyłanego do serwera w bajtach.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-148">**SendBytes**: The size of the payload sent to the server in bytes.</span></span> <span data-ttu-id="6f1f6-149">Wartość domyślna to 0.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-149">The default is 0.</span></span>
- <span data-ttu-id="6f1f6-150">**SendInterval**: opóźnienie (w milisekundach) między komunikatami a serwerem.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-150">**SendInterval**: The delay in milliseconds between messages to the server.</span></span> <span data-ttu-id="6f1f6-151">Wartość domyślna to 500.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-151">The default is 500.</span></span>
- <span data-ttu-id="6f1f6-152">**Właściwości SendTimeout**: limit czasu (w milisekundach) dla komunikatów wysyłanych do serwera.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-152">**SendTimeout**: The timeout in milliseconds for messages to the server.</span></span> <span data-ttu-id="6f1f6-153">Wartość domyślna to 300.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-153">The default is 300.</span></span>
- <span data-ttu-id="6f1f6-154">**ControllerUrl**: adres URL, pod którym jeden klient będzie hostować koncentrator kontrolera.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-154">**ControllerUrl**: The Url where one client will host a controller hub.</span></span> <span data-ttu-id="6f1f6-155">Wartość domyślna to null (brak koncentratora kontrolera).</span><span class="sxs-lookup"><span data-stu-id="6f1f6-155">The default is null (no controller hub).</span></span> <span data-ttu-id="6f1f6-156">Koncentrator kontrolera jest uruchamiany po rozpoczęciu sesji. nie przeprowadzono dalszej komunikacji między koncentratorem kontrolera i etapem.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-156">The controller hub is started when the Crank session starts; no further contact between the controller hub and Crank is made.</span></span>
- <span data-ttu-id="6f1f6-157">**NumClients**: liczba symulowanych klientów do połączenia z aplikacją.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-157">**NumClients**: The number of simulated clients to connect to the application.</span></span> <span data-ttu-id="6f1f6-158">Wartość domyślna to 1.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-158">The default is one.</span></span>
- <span data-ttu-id="6f1f6-159">**Plik_dziennika**: nazwa pliku dziennika dla przebiegu testu.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-159">**Logfile**: The filename for the logfile for the test run.</span></span> <span data-ttu-id="6f1f6-160">Wartość domyślna to `crank.csv`.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-160">The default is `crank.csv`.</span></span>
- <span data-ttu-id="6f1f6-161">**SampleInterval**: czas w milisekundach między próbkami licznika wydajności.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-161">**SampleInterval**: The time in milliseconds between performance counter samples.</span></span> <span data-ttu-id="6f1f6-162">Wartość domyślna to 1000.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-162">The default is 1000.</span></span>
- <span data-ttu-id="6f1f6-163">**SignalRInstance**: nazwa wystąpienia liczników wydajności na serwerze.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-163">**SignalRInstance**: The instance name for the performance counters on the server.</span></span> <span data-ttu-id="6f1f6-164">Wartość domyślna to użycie stanu połączenia klienta.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-164">The default is to use the client connection state.</span></span>

### <a name="example"></a><span data-ttu-id="6f1f6-165">Przykład</span><span class="sxs-lookup"><span data-stu-id="6f1f6-165">Example</span></span>

<span data-ttu-id="6f1f6-166">Następujące polecenie przetestuje lokację o nazwie `pfsignalr` na platformie Azure, która hostuje aplikację na porcie 8080 z centrum o nazwie "ControllerHub", przy użyciu połączeń 100.</span><span class="sxs-lookup"><span data-stu-id="6f1f6-166">The following command will test a site called `pfsignalr` on Azure that hosts an application on port 8080 with a hub named "ControllerHub", using 100 connections.</span></span>

`crank /Connections:100 /Url:http://pfsignalr.cloudapp.net:8080/signalr`
