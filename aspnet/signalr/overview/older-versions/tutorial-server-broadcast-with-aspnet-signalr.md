---
uid: signalr/overview/older-versions/tutorial-server-broadcast-with-aspnet-signalr
title: 'Samouczek: emisja serwera z sygnałem ASP.NET 1. x | Microsoft Docs'
author: bradygaster
description: W tym samouczku pokazano, jak utworzyć aplikację sieci Web korzystającą z sygnalizującego ASP.NET, aby zapewnić funkcję emisji serwera. Emisja serwera oznacza, że gmina...
ms.author: bradyg
ms.date: 04/10/2013
ms.assetid: ab7b2554-956a-4f6d-b2a0-4ae0c62e8580
msc.legacyurl: /signalr/overview/older-versions/tutorial-server-broadcast-with-aspnet-signalr
msc.type: authoredcontent
ms.openlocfilehash: 68908be34f6b010e512677fe5f5e31bfdefab592
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 03/06/2020
ms.locfileid: "78579409"
---
# <a name="tutorial-server-broadcast-with-aspnet-signalr-1x"></a><span data-ttu-id="f360d-104">Samouczek: emisje serwera z użyciem wzorca ASP.NET SignalR 1.x</span><span class="sxs-lookup"><span data-stu-id="f360d-104">Tutorial: Server Broadcast with ASP.NET SignalR 1.x</span></span>

<span data-ttu-id="f360d-105">[Fletcher Patryk](https://github.com/pfletcher), [Tomasz Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="f360d-105">by [Patrick Fletcher](https://github.com/pfletcher), [Tom Dykstra](https://github.com/tdykstra)</span></span>

[!INCLUDE [Consider ASP.NET Core SignalR](~/includes/signalr/signalr-version-disambiguation.md)]

> <span data-ttu-id="f360d-106">W tym samouczku pokazano, jak utworzyć aplikację sieci Web korzystającą z sygnalizującego ASP.NET, aby zapewnić funkcję emisji serwera.</span><span class="sxs-lookup"><span data-stu-id="f360d-106">This tutorial shows how to create a web application that uses ASP.NET SignalR to provide server broadcast functionality.</span></span> <span data-ttu-id="f360d-107">Emisja serwera oznacza, że komunikacja wysyłana do klientów jest inicjowana przez serwer.</span><span class="sxs-lookup"><span data-stu-id="f360d-107">Server broadcast means that communications sent to clients are initiated by the server.</span></span> <span data-ttu-id="f360d-108">W tym scenariuszu wymagane jest inne podejście programistyczne niż scenariusze komunikacji równorzędnej, takie jak aplikacje czatu, w którym komunikacja wysyłana do klientów jest inicjowana przez co najmniej jednego klienta.</span><span class="sxs-lookup"><span data-stu-id="f360d-108">This scenario requires a different programming approach than peer-to-peer scenarios such as chat applications, in which communications sent to clients are initiated by one or more of the clients.</span></span>
> 
> <span data-ttu-id="f360d-109">Aplikacja, którą utworzysz w tym samouczku, symuluje taktowanie giełdowe, typowy scenariusz dla funkcji emisji serwera.</span><span class="sxs-lookup"><span data-stu-id="f360d-109">The application that you'll create in this tutorial simulates a stock ticker, a typical scenario for server broadcast functionality.</span></span>
> 
> <span data-ttu-id="f360d-110">Komentarze w samouczku są powitane.</span><span class="sxs-lookup"><span data-stu-id="f360d-110">Comments on the tutorial are welcome.</span></span> <span data-ttu-id="f360d-111">Jeśli masz pytania, które nie są bezpośrednio związane z samouczkiem, możesz je ogłosić na [forum ASP.NET](https://forums.asp.net/1254.aspx/1?ASP+NET+SignalR) lub [StackOverflow.com](http://stackoverflow.com).</span><span class="sxs-lookup"><span data-stu-id="f360d-111">If you have questions that are not directly related to the tutorial, you can post them to the [ASP.NET SignalR forum](https://forums.asp.net/1254.aspx/1?ASP+NET+SignalR) or [StackOverflow.com](http://stackoverflow.com).</span></span>

## <a name="overview"></a><span data-ttu-id="f360d-112">Omówienie</span><span class="sxs-lookup"><span data-stu-id="f360d-112">Overview</span></span>

<span data-ttu-id="f360d-113">[Microsoft. ASPNET. signaler. przykładowy](http://nuget.org/packages/microsoft.aspnet.signalr.sample) pakiet NuGet instaluje przykład symulowanej aplikacji giełdowej w projekcie programu Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="f360d-113">The [Microsoft.AspNet.SignalR.Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) NuGet package installs a sample simulated stock ticker application in a Visual Studio project.</span></span> <span data-ttu-id="f360d-114">W pierwszej części tego samouczka utworzysz uproszczoną wersję tej aplikacji od podstaw.</span><span class="sxs-lookup"><span data-stu-id="f360d-114">In the first part of this tutorial, you'll create a simplified version of that application from scratch.</span></span> <span data-ttu-id="f360d-115">W pozostałej części tego samouczka zainstalujesz pakiet NuGet i zapoznajesz dodatkowe funkcje i kod, który tworzy.</span><span class="sxs-lookup"><span data-stu-id="f360d-115">In the remainder of the tutorial, you'll install the NuGet package and review the additional features and code that it creates.</span></span>

<span data-ttu-id="f360d-116">Aplikacja ticker jest reprezentatywna dla rodzaju aplikacji w czasie rzeczywistym, w której chcesz okresowo wypchnięciować lub emitować powiadomienia z serwera do wszystkich połączonych klientów.</span><span class="sxs-lookup"><span data-stu-id="f360d-116">The stock ticker application is a representative of a kind of real-time application in which you want to periodically "push," or broadcast, notifications from the server to all connected clients.</span></span>

<span data-ttu-id="f360d-117">Aplikacja, która zostanie utworzona w pierwszej części tego samouczka, wyświetli siatkę z danymi giełdowymi.</span><span class="sxs-lookup"><span data-stu-id="f360d-117">The application that you'll build in the first part of this tutorial displays a grid with stock data.</span></span>

![Wersja wstępna StockTicker](tutorial-server-broadcast-with-aspnet-signalr/_static/image1.png)

<span data-ttu-id="f360d-119">Okresowo aktualizuje ceny giełdowe serwera i wypychanie aktualizacji do wszystkich połączonych klientów.</span><span class="sxs-lookup"><span data-stu-id="f360d-119">Periodically the server randomly updates stock prices and pushes the updates to all connected clients.</span></span> <span data-ttu-id="f360d-120">W przeglądarce numery i symbole w kolumnach **Zmień** i **%** zmieniają się dynamicznie w odpowiedzi na powiadomienia z serwera.</span><span class="sxs-lookup"><span data-stu-id="f360d-120">In the browser the numbers and symbols in the **Change** and **%** columns dynamically change in response to notifications from the server.</span></span> <span data-ttu-id="f360d-121">Jeśli otworzysz dodatkowe przeglądarki pod tym samym adresem URL, wszystkie będą wyświetlać te same dane i te same zmiany w danych jednocześnie.</span><span class="sxs-lookup"><span data-stu-id="f360d-121">If you open additional browsers to the same URL, they all show the same data and the same changes to the data simultaneously.</span></span>

<span data-ttu-id="f360d-122">Ten samouczek zawiera następujące sekcje:</span><span class="sxs-lookup"><span data-stu-id="f360d-122">This tutorial contains the following sections:</span></span>

- [<span data-ttu-id="f360d-123">Wymagania wstępne</span><span class="sxs-lookup"><span data-stu-id="f360d-123">Prerequisites</span></span>](#prerequisites)
- [<span data-ttu-id="f360d-124">Tworzenie projektu</span><span class="sxs-lookup"><span data-stu-id="f360d-124">Create the project</span></span>](#createproject)
- [<span data-ttu-id="f360d-125">Dodaj pakiety NuGet sygnalizującego</span><span class="sxs-lookup"><span data-stu-id="f360d-125">Add the SignalR NuGet packages</span></span>](#nugetpackages)
- [<span data-ttu-id="f360d-126">Konfigurowanie kodu serwera</span><span class="sxs-lookup"><span data-stu-id="f360d-126">Set up the server code</span></span>](#server)
- [<span data-ttu-id="f360d-127">Konfigurowanie kodu klienta</span><span class="sxs-lookup"><span data-stu-id="f360d-127">Set up the client code</span></span>](#client)
- [<span data-ttu-id="f360d-128">Testowanie aplikacji</span><span class="sxs-lookup"><span data-stu-id="f360d-128">Test the application</span></span>](#test)
- [<span data-ttu-id="f360d-129">Włączanie rejestrowania</span><span class="sxs-lookup"><span data-stu-id="f360d-129">Enable logging</span></span>](#enablelogging)
- [<span data-ttu-id="f360d-130">Instalowanie i przeglądanie pełnego przykładu StockTicker</span><span class="sxs-lookup"><span data-stu-id="f360d-130">Install and review the full StockTicker sample</span></span>](#fullsample)
- [<span data-ttu-id="f360d-131">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="f360d-131">Next steps</span></span>](#nextsteps)

> [!NOTE]
> <span data-ttu-id="f360d-132">Jeśli nie chcesz wykonać kroków tworzenia aplikacji, możesz zainstalować program sygnalizujący. przykładowy pakiet w nowym, **pustym projekcie aplikacji sieci Web ASP.NET** , i przeczytaj te kroki, aby uzyskać wyjaśnienia dotyczące kodu.</span><span class="sxs-lookup"><span data-stu-id="f360d-132">If you don't want to work through the steps of building the application, you can install the SignalR.Sample package in a new **Empty ASP.NET Web Application** project, and read through these steps to get explanations of the code.</span></span> <span data-ttu-id="f360d-133">Pierwsza część samouczka obejmuje podzestaw próbnika. przykładowy kod, a druga część objaśnia najważniejsze funkcje dodatkowych funkcji w programie Sygnalizującer. przykładowego pakietu.</span><span class="sxs-lookup"><span data-stu-id="f360d-133">The first part of the tutorial covers a subset of the SignalR.Sample code, and the second part explains key features of the additional functionality in the SignalR.Sample package.</span></span>

<a id="prerequisites"></a>

## <a name="prerequisites"></a><span data-ttu-id="f360d-134">Wymagania wstępne</span><span class="sxs-lookup"><span data-stu-id="f360d-134">Prerequisites</span></span>

<span data-ttu-id="f360d-135">Przed rozpoczęciem upewnij się, że na komputerze jest zainstalowany program Visual Studio 2012 lub 2010 z dodatkiem SP1.</span><span class="sxs-lookup"><span data-stu-id="f360d-135">Before you start, make sure that you have Visual Studio 2012 or 2010 SP1 installed on your computer.</span></span> <span data-ttu-id="f360d-136">Jeśli nie masz programu Visual Studio, zobacz [ASP.NET downloads](https://www.asp.net/downloads) , aby uzyskać bezpłatny program Visual Studio 2012 Express for Web.</span><span class="sxs-lookup"><span data-stu-id="f360d-136">If you don't have Visual Studio, see [ASP.NET Downloads](https://www.asp.net/downloads) to get the free Visual Studio 2012 Express for Web.</span></span>

<span data-ttu-id="f360d-137">Jeśli masz program Visual Studio 2010, upewnij się, że jest zainstalowany pakiet [NuGet](https://visualstudiogallery.msdn.microsoft.com/27077b70-9dad-4c64-adcf-c7cf6bc9970c) .</span><span class="sxs-lookup"><span data-stu-id="f360d-137">If you have Visual Studio 2010, make sure that [NuGet](https://visualstudiogallery.msdn.microsoft.com/27077b70-9dad-4c64-adcf-c7cf6bc9970c) is installed.</span></span>

<a id="createproject"></a>

## <a name="create-the-project"></a><span data-ttu-id="f360d-138">Tworzenie projektu</span><span class="sxs-lookup"><span data-stu-id="f360d-138">Create the project</span></span>

1. <span data-ttu-id="f360d-139">W menu **plik** kliknij pozycję **Nowy projekt**.</span><span class="sxs-lookup"><span data-stu-id="f360d-139">From the **File** menu click **New Project**.</span></span>
2. <span data-ttu-id="f360d-140">W oknie dialogowym **Nowy projekt** rozwiń węzeł **C#** w obszarze **Szablony** i wybierz pozycję **Sieć Web**.</span><span class="sxs-lookup"><span data-stu-id="f360d-140">In the **New Project** dialog box, expand **C#** under **Templates** and select **Web**.</span></span>
3. <span data-ttu-id="f360d-141">Wybierz szablon **pustej aplikacji sieci Web ASP.NET** , nadaj nazwę *sygnalizującemu projektowi. StockTicker*, a następnie kliknij przycisk **OK**.</span><span class="sxs-lookup"><span data-stu-id="f360d-141">Select the **ASP.NET Empty Web Application** template, name the project *SignalR.StockTicker*, and click **OK**.</span></span>

    ![Okno dialogowe Nowy projekt](tutorial-server-broadcast-with-aspnet-signalr/_static/image2.png)

<a id="nugetpackages"></a>

## <a name="add-the-signalr-nuget-packages"></a><span data-ttu-id="f360d-143">Dodaj pakiety NuGet sygnalizującego</span><span class="sxs-lookup"><span data-stu-id="f360d-143">Add the SignalR NuGet Packages</span></span>

### <a name="add-the-signalr-and-jquery-nuget-packages"></a><span data-ttu-id="f360d-144">Dodaj pakiet sygnalizujący i pakiety NuGet programu JQuery</span><span class="sxs-lookup"><span data-stu-id="f360d-144">Add the SignalR and JQuery NuGet Packages</span></span>

<span data-ttu-id="f360d-145">Do projektu można dodać funkcję sygnalizującą, instalując pakiet NuGet.</span><span class="sxs-lookup"><span data-stu-id="f360d-145">You can add SignalR functionality to a project by installing a NuGet package.</span></span>

1. <span data-ttu-id="f360d-146">Kliknij pozycję **Narzędzia | Menedżer pakietów NuGet | Konsola Menedżera pakietów**.</span><span class="sxs-lookup"><span data-stu-id="f360d-146">Click **Tools | NuGet Package Manager | Package Manager Console**.</span></span>
2. <span data-ttu-id="f360d-147">W Menedżerze pakietów wprowadź następujące polecenie.</span><span class="sxs-lookup"><span data-stu-id="f360d-147">Enter the following command in the package manager.</span></span>

    [!code-powershell[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample1.ps1)]

    <span data-ttu-id="f360d-148">Pakiet sygnalizujący instaluje wiele innych pakietów NuGet jako zależności.</span><span class="sxs-lookup"><span data-stu-id="f360d-148">The SignalR package installs a number of other NuGet packages as dependencies.</span></span> <span data-ttu-id="f360d-149">Po zakończeniu instalacji masz wszystkie składniki serwera i klienta wymagane do użycia programu sygnalizującego w aplikacji ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="f360d-149">When the installation is finished you have all of the server and client components required to use SignalR in an ASP.NET application.</span></span>

<a id="server"></a>

## <a name="set-up-the-server-code"></a><span data-ttu-id="f360d-150">Konfigurowanie kodu serwera</span><span class="sxs-lookup"><span data-stu-id="f360d-150">Set up the server code</span></span>

<span data-ttu-id="f360d-151">W tej sekcji skonfigurujesz kod, który jest uruchamiany na serwerze programu.</span><span class="sxs-lookup"><span data-stu-id="f360d-151">In this section you set up the code that runs on the server.</span></span>

### <a name="create-the-stock-class"></a><span data-ttu-id="f360d-152">Tworzenie klasy giełdowej</span><span class="sxs-lookup"><span data-stu-id="f360d-152">Create the Stock class</span></span>

<span data-ttu-id="f360d-153">Zacznij od utworzenia klasy modelu giełdowego, która będzie używana do przechowywania i przesyłania informacji o magazynie.</span><span class="sxs-lookup"><span data-stu-id="f360d-153">You begin by creating the Stock model class that you'll use to store and transmit information about a stock.</span></span>

1. <span data-ttu-id="f360d-154">Utwórz nowy plik klasy w folderze projektu, nadaj mu nazwę *Stock.cs*, a następnie zastąp kod szablonu następującym kodem:</span><span class="sxs-lookup"><span data-stu-id="f360d-154">Create a new class file in the project folder, name it *Stock.cs*, and then replace the template code with the following code:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample2.cs)]

    <span data-ttu-id="f360d-155">Dwie właściwości, które zostaną ustawione podczas tworzenia zasobów, to symbol (na przykład MSFT dla firmy Microsoft) i cena.</span><span class="sxs-lookup"><span data-stu-id="f360d-155">The two properties that you'll set when you create stocks are the Symbol (for example, MSFT for Microsoft) and the Price.</span></span> <span data-ttu-id="f360d-156">Inne właściwości zależą od tego, jak i kiedy ustawiasz cenę.</span><span class="sxs-lookup"><span data-stu-id="f360d-156">The other properties depend on how and when you set Price.</span></span> <span data-ttu-id="f360d-157">Przy pierwszym ustawianiu ceny wartość jest przekazywana do DayOpen.</span><span class="sxs-lookup"><span data-stu-id="f360d-157">The first time you set Price, the value gets propagated to DayOpen.</span></span> <span data-ttu-id="f360d-158">Po wybraniu ceny wartości właściwości Change i PercentChange są obliczane na podstawie różnicy między cenami i DayOpen.</span><span class="sxs-lookup"><span data-stu-id="f360d-158">Subsequent times when you set Price, the Change and PercentChange property values are calculated based on the difference between Price and DayOpen.</span></span>

### <a name="create-the-stockticker-and-stocktickerhub-classes"></a><span data-ttu-id="f360d-159">Tworzenie klas StockTicker i StockTickerHub</span><span class="sxs-lookup"><span data-stu-id="f360d-159">Create the StockTicker and StockTickerHub classes</span></span>

<span data-ttu-id="f360d-160">Użyjesz interfejsu API centrum sygnału do obsługi interakcji między serwerem a klientem.</span><span class="sxs-lookup"><span data-stu-id="f360d-160">You'll use the SignalR Hub API to handle server-to-client interaction.</span></span> <span data-ttu-id="f360d-161">Klasa StockTickerHub, która pochodzi od klasy Hub sygnalizującej, będzie obsługiwać odbierające połączenia i wywołania metod od klientów.</span><span class="sxs-lookup"><span data-stu-id="f360d-161">A StockTickerHub class that derives from the SignalR Hub class will handle receiving connections and method calls from clients.</span></span> <span data-ttu-id="f360d-162">Należy również zachować dane giełdowe i uruchomić obiekt Timer, aby okresowo wyzwalać aktualizacje cenowe niezależnie od połączeń klientów.</span><span class="sxs-lookup"><span data-stu-id="f360d-162">You also need to maintain stock data and run a Timer object to periodically trigger price updates, independently of client connections.</span></span> <span data-ttu-id="f360d-163">Nie można umieścić tych funkcji w klasie centrów, ponieważ wystąpienia centrów są przejściowe.</span><span class="sxs-lookup"><span data-stu-id="f360d-163">You can't put these functions in a Hub class, because Hub instances are transient.</span></span> <span data-ttu-id="f360d-164">Dla każdej operacji w centrum jest tworzone wystąpienie klasy centrum, takie jak połączenia i wywołania z klienta do serwera.</span><span class="sxs-lookup"><span data-stu-id="f360d-164">A Hub class instance is created for each operation on the hub, such as connections and calls from the client to the server.</span></span> <span data-ttu-id="f360d-165">Dlatego mechanizm, który przechowuje dane giełdowe, aktualizuje ceny i emituje aktualizacje cen, musi działać w oddzielnym klasie, o nazwie StockTicker.</span><span class="sxs-lookup"><span data-stu-id="f360d-165">So the mechanism that keeps stock data, updates prices, and broadcasts the price updates has to run in a separate class, which you'll name StockTicker.</span></span>

![Emitowanie z StockTicker](tutorial-server-broadcast-with-aspnet-signalr/_static/image4.png)

<span data-ttu-id="f360d-167">Tylko jedno wystąpienie klasy StockTicker ma działać na serwerze, dlatego należy skonfigurować odwołanie z każdego wystąpienia StockTickerHub do wystąpienia singleton StockTicker.</span><span class="sxs-lookup"><span data-stu-id="f360d-167">You only want one instance of the StockTicker class to run on the server, so you'll need to set up a reference from each StockTickerHub instance to the singleton StockTicker instance.</span></span> <span data-ttu-id="f360d-168">Klasa StockTicker musi być w stanie emitować do klientów, ponieważ ma dane podstawowe i wyzwala aktualizacje, ale StockTicker nie jest klasą centrum.</span><span class="sxs-lookup"><span data-stu-id="f360d-168">The StockTicker class has to be able to broadcast to clients because it has the stock data and triggers updates, but StockTicker is not a Hub class.</span></span> <span data-ttu-id="f360d-169">W związku z tym Klasa StockTicker musi uzyskać odwołanie do obiektu kontekstu połączenia centrum sygnału.</span><span class="sxs-lookup"><span data-stu-id="f360d-169">Therefore, the StockTicker class has to get a reference to the SignalR Hub connection context object.</span></span> <span data-ttu-id="f360d-170">Następnie może użyć obiektu kontekstu połączenia sygnalizującego do emisji do klientów.</span><span class="sxs-lookup"><span data-stu-id="f360d-170">It can then use the SignalR connection context object to broadcast to clients.</span></span>

1. <span data-ttu-id="f360d-171">W **Eksplorator rozwiązań**kliknij prawym przyciskiem myszy projekt, a następnie kliknij pozycję **Dodaj nowy element**.</span><span class="sxs-lookup"><span data-stu-id="f360d-171">In **Solution Explorer**, right-click the project and click **Add New Item**.</span></span>
2. <span data-ttu-id="f360d-172">Jeśli masz program Visual Studio 2012 z [aktualizacją ASP.NET and Web Tools 2012,2](https://go.microsoft.com/fwlink/?LinkId=279941), kliknij pozycję **Sieć Web** w obszarze **Wizualizacja C#**  i wybierz szablon element **klasy centrum sygnałów** .</span><span class="sxs-lookup"><span data-stu-id="f360d-172">If you have Visual Studio 2012 with the [ASP.NET and Web Tools 2012.2 Update](https://go.microsoft.com/fwlink/?LinkId=279941), click **Web** under **Visual C#** and select the **SignalR Hub Class** item template.</span></span> <span data-ttu-id="f360d-173">W przeciwnym razie wybierz szablon **klasy** .</span><span class="sxs-lookup"><span data-stu-id="f360d-173">Otherwise, select the **Class** template.</span></span>
3. <span data-ttu-id="f360d-174">Nazwij nową klasę *StockTickerHub.cs*, a następnie kliknij przycisk **Dodaj**.</span><span class="sxs-lookup"><span data-stu-id="f360d-174">Name the new class *StockTickerHub.cs*, and then click **Add**.</span></span>

    ![Add StockTickerHub.cs](tutorial-server-broadcast-with-aspnet-signalr/_static/image5.png)
4. <span data-ttu-id="f360d-176">Zastąp kod szablonu poniższym kodem:</span><span class="sxs-lookup"><span data-stu-id="f360d-176">Replace the template code with the following code:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample3.cs)]

    <span data-ttu-id="f360d-177">Klasa [Hub](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hub(v=vs.111).aspx) służy do definiowania metod, które mogą być wywoływane przez klientów na serwerze.</span><span class="sxs-lookup"><span data-stu-id="f360d-177">The [Hub](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hub(v=vs.111).aspx) class is used to define methods the clients can call on the server.</span></span> <span data-ttu-id="f360d-178">Definiujesz jedną metodę: `GetAllStocks()`.</span><span class="sxs-lookup"><span data-stu-id="f360d-178">You are defining one method: `GetAllStocks()`.</span></span> <span data-ttu-id="f360d-179">Gdy klient początkowo nawiązuje połączenie z serwerem, wywoła tę metodę, aby uzyskać listę wszystkich zasobów z ich bieżącymi cenami.</span><span class="sxs-lookup"><span data-stu-id="f360d-179">When a client initially connects to the server, it will call this method to get a list of all of the stocks with their current prices.</span></span> <span data-ttu-id="f360d-180">Metoda może wykonywać synchronicznie i zwracać `IEnumerable<Stock>`, ponieważ zwraca dane z pamięci.</span><span class="sxs-lookup"><span data-stu-id="f360d-180">The method can execute synchronously and return `IEnumerable<Stock>` because it is returning data from memory.</span></span> <span data-ttu-id="f360d-181">Jeśli metoda musiała pobrać dane, wykonując czynności, które mogą być zależne, takie jak wyszukiwanie bazy danych lub wywołanie usługi sieci Web, należy określić `Task<IEnumerable<Stock>>` jako wartość zwrotną, aby włączyć asynchroniczne przetwarzanie.</span><span class="sxs-lookup"><span data-stu-id="f360d-181">If the method had to get the data by doing something that would involve waiting, such as a database lookup or a web service call, you would specify `Task<IEnumerable<Stock>>` as the return value to enable asynchronous processing.</span></span> <span data-ttu-id="f360d-182">Aby uzyskać więcej informacji, zobacz [Podręcznik interfejsu API centrów ASP.NETer — serwer — Kiedy należy wykonać asynchronicznie](index.md).</span><span class="sxs-lookup"><span data-stu-id="f360d-182">For more information, see [ASP.NET SignalR Hubs API Guide - Server - When to execute asynchronously](index.md).</span></span>

    <span data-ttu-id="f360d-183">Atrybut HubName określa, w jaki sposób do centrum będzie odwoływać się kod JavaScript na kliencie.</span><span class="sxs-lookup"><span data-stu-id="f360d-183">The HubName attribute specifies how the Hub will be referenced in JavaScript code on the client.</span></span> <span data-ttu-id="f360d-184">Domyślna nazwa na kliencie, jeśli nie jest używany ten atrybut jest notacji CamelCase wersja klasy, która w tym przypadku powinna być stockTickerHub.</span><span class="sxs-lookup"><span data-stu-id="f360d-184">The default name on the client if you don't use this attribute is a camel-cased version of the class name, which in this case would be stockTickerHub.</span></span>

    <span data-ttu-id="f360d-185">Jak zobaczysz później podczas tworzenia klasy StockTicker, pojedyncze wystąpienie tej klasy zostanie utworzone we właściwości wystąpienia statycznego.</span><span class="sxs-lookup"><span data-stu-id="f360d-185">As you'll see later when you create the StockTicker class, a singleton instance of that class is created in its static Instance property.</span></span> <span data-ttu-id="f360d-186">To pojedyncze wystąpienie StockTicker pozostaje w pamięci niezależnie od tego, ile klientów nawiązuje połączenie lub rozłączenie, i że to wystąpienie jest używane przez metodę GetAllStocks do zwracania bieżących informacji o zapasach.</span><span class="sxs-lookup"><span data-stu-id="f360d-186">That singleton instance of StockTicker remains in memory no matter how many clients connect or disconnect, and that instance is what the GetAllStocks method uses to return current stock information.</span></span>
5. <span data-ttu-id="f360d-187">Utwórz nowy plik klasy w folderze projektu, nadaj mu nazwę *StockTicker.cs*, a następnie zastąp kod szablonu następującym kodem:</span><span class="sxs-lookup"><span data-stu-id="f360d-187">Create a new class file in the project folder, name it *StockTicker.cs*, and then replace the template code with the following code:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample4.cs)]

    <span data-ttu-id="f360d-188">Ponieważ wiele wątków będzie działać w tym samym wystąpieniu kodu StockTicker, Klasa StockTicker musi być threadsafe.</span><span class="sxs-lookup"><span data-stu-id="f360d-188">Since multiple threads will be running the same instance of StockTicker code, the StockTicker class has to be threadsafe.</span></span>

    ### <a name="storing-the-singleton-instance-in-a-static-field"></a><span data-ttu-id="f360d-189">Przechowywanie pojedynczego wystąpienia w polu statycznym</span><span class="sxs-lookup"><span data-stu-id="f360d-189">Storing the singleton instance in a static field</span></span>

    <span data-ttu-id="f360d-190">Kod inicjuje pole wystąpienia elementu statycznego \_, które wykonuje kopię zapasową właściwości wystąpienia z wystąpieniem klasy, i jest to jedyne wystąpienie klasy, którą można utworzyć, ponieważ Konstruktor jest oznaczony jako prywatny.</span><span class="sxs-lookup"><span data-stu-id="f360d-190">The code initializes the static \_instance field that backs the Instance property with an instance of the class, and this is the only instance of the class that can be created, because the constructor is marked as private.</span></span> <span data-ttu-id="f360d-191">[Inicjalizacja z opóźnieniem](https://msdn.microsoft.com/library/dd997286.aspx) jest używana dla pola wystąpienia \_, a nie ze względu na wydajność, ale aby upewnić się, że tworzenie wystąpienia jest threadsafe.</span><span class="sxs-lookup"><span data-stu-id="f360d-191">[Lazy initialization](https://msdn.microsoft.com/library/dd997286.aspx) is used for the \_instance field, not for performance reasons but to ensure that the instance creation is threadsafe.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample5.cs)]

    <span data-ttu-id="f360d-192">Za każdym razem, gdy klient nawiązuje połączenie z serwerem, nowe wystąpienie klasy StockTickerHub uruchomione w osobnym wątku Pobiera pojedyncze wystąpienie StockTicker z właściwości statycznej StockTicker. Instance, jak pokazano wcześniej w klasie StockTickerHub.</span><span class="sxs-lookup"><span data-stu-id="f360d-192">Each time a client connects to the server, a new instance of the StockTickerHub class running in a separate thread gets the StockTicker singleton instance from the StockTicker.Instance static property, as you saw earlier in the StockTickerHub class.</span></span>

    ### <a name="storing-stock-data-in-a-concurrentdictionary"></a><span data-ttu-id="f360d-193">Przechowywanie danych giełdowych w ConcurrentDictionary</span><span class="sxs-lookup"><span data-stu-id="f360d-193">Storing stock data in a ConcurrentDictionary</span></span>

    <span data-ttu-id="f360d-194">Konstruktor inicjuje zbieranie \_ych zapasów z niektórymi przykładowymi danymi zapasowymi, a GetAllStocks zwraca te zasoby.</span><span class="sxs-lookup"><span data-stu-id="f360d-194">The constructor initializes the \_stocks collection with some sample stock data, and GetAllStocks returns the stocks.</span></span> <span data-ttu-id="f360d-195">Jak widać wcześniej, ta kolekcja zasobów jest z kolei zwracana przez StockTickerHub. GetAllStocks, która jest metodą serwera w klasie centrów, którą klienci mogą wywoływać.</span><span class="sxs-lookup"><span data-stu-id="f360d-195">As you saw earlier, this collection of stocks is in turn returned by StockTickerHub.GetAllStocks which is a server method in the Hub class that clients can call.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample6.cs)]

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample7.cs)]

    <span data-ttu-id="f360d-196">Kolekcja magazynów jest definiowana jako typ [ConcurrentDictionary](https://msdn.microsoft.com/library/dd287191.aspx) dla bezpieczeństwa wątków.</span><span class="sxs-lookup"><span data-stu-id="f360d-196">The stocks collection is defined as a [ConcurrentDictionary](https://msdn.microsoft.com/library/dd287191.aspx) type for thread safety.</span></span> <span data-ttu-id="f360d-197">Alternatywnie, można użyć obiektu [dictionary](https://msdn.microsoft.com/library/xfhwa508.aspx) i jawnie zablokować słownik po wprowadzeniu w nim zmian.</span><span class="sxs-lookup"><span data-stu-id="f360d-197">As an alternative, you could use a [Dictionary](https://msdn.microsoft.com/library/xfhwa508.aspx) object and explicitly lock the dictionary when you make changes to it.</span></span>

    <span data-ttu-id="f360d-198">W przypadku tej aplikacji przykładowej można przechowywać dane aplikacji w pamięci i utracić dane po usunięciu wystąpienia usługi StockTicker.</span><span class="sxs-lookup"><span data-stu-id="f360d-198">For this sample application, it's OK to store application data in memory and to lose the data when the StockTicker instance is disposed.</span></span> <span data-ttu-id="f360d-199">W rzeczywistej aplikacji należy współpracować z magazynem danych zaplecza, takim jak baza danych.</span><span class="sxs-lookup"><span data-stu-id="f360d-199">In a real application you would work with a back-end data store such as a database.</span></span>

    ### <a name="periodically-updating-stock-prices"></a><span data-ttu-id="f360d-200">Okresowe aktualizowanie cen akcji</span><span class="sxs-lookup"><span data-stu-id="f360d-200">Periodically updating stock prices</span></span>

    <span data-ttu-id="f360d-201">Konstruktor uruchamia obiekt Timer, który okresowo wywołuje metody, które codziennie aktualizują ceny giełdowe.</span><span class="sxs-lookup"><span data-stu-id="f360d-201">The constructor starts up a Timer object that periodically calls methods that update stock prices on a random basis.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample8.cs)]

    <span data-ttu-id="f360d-202">UpdateStockPrices jest wywoływana przez czasomierz, który przekazuje wartość null w parametrze State.</span><span class="sxs-lookup"><span data-stu-id="f360d-202">UpdateStockPrices is called by the Timer, which passes in null in the state parameter.</span></span> <span data-ttu-id="f360d-203">Przed aktualizacją cen jest wykonywana blokada \_obiektu updateStockPricesLock.</span><span class="sxs-lookup"><span data-stu-id="f360d-203">Before updating prices, a lock is taken on the \_updateStockPricesLock object.</span></span> <span data-ttu-id="f360d-204">Kod sprawdza, czy inny wątek już aktualizuje ceny, a następnie wywołuje TryUpdateStockPrice na każdym spisie na liście.</span><span class="sxs-lookup"><span data-stu-id="f360d-204">The code checks if another thread is already updating prices, and then it calls TryUpdateStockPrice on each stock in the list.</span></span> <span data-ttu-id="f360d-205">Metoda TryUpdateStockPrice decyduje o tym, czy należy zmienić cenę giełdową, i ile jej zmienić.</span><span class="sxs-lookup"><span data-stu-id="f360d-205">The TryUpdateStockPrice method decides whether to change the stock price, and how much to change it.</span></span> <span data-ttu-id="f360d-206">W przypadku zmiany ceny giełdowej BroadcastStockPrice jest wywoływana, aby emitować zmianę cen giełdowych do wszystkich połączonych klientów.</span><span class="sxs-lookup"><span data-stu-id="f360d-206">If the stock price is changed, BroadcastStockPrice is called to broadcast the stock price change to all connected clients.</span></span>

    <span data-ttu-id="f360d-207">Flaga updatingStockPrices \_jest oznaczona jako [nietrwała](https://msdn.microsoft.com/library/x13ttww7.aspx) , aby upewnić się, że dostęp do niego jest threadsafe.</span><span class="sxs-lookup"><span data-stu-id="f360d-207">The \_updatingStockPrices flag is marked as [volatile](https://msdn.microsoft.com/library/x13ttww7.aspx) to ensure that access to it is threadsafe.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample9.cs)]

    <span data-ttu-id="f360d-208">W rzeczywistej aplikacji Metoda TryUpdateStockPrice wywoła usługę sieci Web w celu wyszukania ceny. w tym kodzie używa generatora liczb losowych, aby wprowadzać zmiany losowo.</span><span class="sxs-lookup"><span data-stu-id="f360d-208">In a real application, the TryUpdateStockPrice method would call a web service to look up the price; in this code it uses a random number generator to make changes randomly.</span></span>

    ### <a name="getting-the-signalr-context-so-that-the-stockticker-class-can-broadcast-to-clients"></a><span data-ttu-id="f360d-209">Pobieranie kontekstu sygnalizującego, aby Klasa StockTicker mogła emitować się do klientów</span><span class="sxs-lookup"><span data-stu-id="f360d-209">Getting the SignalR context so that the StockTicker class can broadcast to clients</span></span>

    <span data-ttu-id="f360d-210">Ponieważ zmiany cen pochodzą z tego miejsca w obiekcie StockTicker, jest to obiekt, który musi wywołać metodę updateStockPrice na wszystkich połączonych klientach.</span><span class="sxs-lookup"><span data-stu-id="f360d-210">Because the price changes originate here in the StockTicker object, this is the object that needs to call an updateStockPrice method on all connected clients.</span></span> <span data-ttu-id="f360d-211">W klasie centrum masz interfejs API do wywoływania metod klienta, ale StockTicker nie pochodzi od klasy Hub i nie ma odwołań do żadnego obiektu Hub.</span><span class="sxs-lookup"><span data-stu-id="f360d-211">In a Hub class you have an API for calling client methods, but StockTicker does not derive from the Hub class and does not have a reference to any Hub object.</span></span> <span data-ttu-id="f360d-212">W związku z tym, aby emitować do podłączonych klientów, Klasa StockTicker musi uzyskać wystąpienie kontekstu sygnalizującego dla klasy StockTickerHub i używać go do wywoływania metod na klientach.</span><span class="sxs-lookup"><span data-stu-id="f360d-212">Therefore, in order to broadcast to connected clients, the StockTicker class has to get the SignalR context instance for the StockTickerHub class and use that to call methods on clients.</span></span>

    <span data-ttu-id="f360d-213">Kod pobiera odwołanie do kontekstu sygnalizującego, gdy tworzy wystąpienie klasy pojedynczej, przekazuje odwołanie do konstruktora, a Konstruktor umieszcza go we właściwości clients.</span><span class="sxs-lookup"><span data-stu-id="f360d-213">The code gets a reference to the SignalR context when it creates the singleton class instance, passes that reference to the constructor, and the constructor puts it in the Clients property.</span></span>

    <span data-ttu-id="f360d-214">Istnieją dwa powody, dla których chcesz uzyskać kontekst tylko raz: pobieranie kontekstu jest kosztowną operacją i zapewnianie, że zaplanowana kolejność komunikatów wysyłanych do klientów zostanie zachowana.</span><span class="sxs-lookup"><span data-stu-id="f360d-214">There are two reasons why you want to get the context just once: getting the context is an expensive operation, and getting it once ensures that the intended order of messages sent to clients is preserved.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample10.cs)]

    <span data-ttu-id="f360d-215">Pobranie właściwości clients kontekstu i umieszczenie jej we właściwości StockTickerClient umożliwia pisanie kodu w celu wywołania metod klienta, które wyglądają tak samo jak w klasie centrów.</span><span class="sxs-lookup"><span data-stu-id="f360d-215">Getting the Clients property of the context and putting it in the StockTickerClient property lets you write code to call client methods that looks the same as it would in a Hub class.</span></span> <span data-ttu-id="f360d-216">Na przykład, aby emitować do wszystkich klientów, można napisać klienta. ALL. updateStockPrice (stock).</span><span class="sxs-lookup"><span data-stu-id="f360d-216">For instance, to broadcast to all clients you can write Clients.All.updateStockPrice(stock).</span></span>

    <span data-ttu-id="f360d-217">Metoda updateStockPrice wywoływana w BroadcastStockPrice nie istnieje jeszcze. dodasz go później podczas pisania kodu, który jest uruchamiany na kliencie.</span><span class="sxs-lookup"><span data-stu-id="f360d-217">The updateStockPrice method that you are calling in BroadcastStockPrice doesn't exist yet; you'll add it later when you write code that runs on the client.</span></span> <span data-ttu-id="f360d-218">Możesz odwołać się do updateStockPrice tutaj, ponieważ klienci. All są dynamicznymi, co oznacza, że wyrażenie będzie oceniane w czasie wykonywania.</span><span class="sxs-lookup"><span data-stu-id="f360d-218">You can refer to updateStockPrice here because Clients.All is dynamic, which means the expression will be evaluated at runtime.</span></span> <span data-ttu-id="f360d-219">Gdy to wywołanie metody jest wykonywane, sygnalizujący wyśle do klienta nazwę metody i wartość parametru, a jeśli klient ma metodę o nazwie updateStockPrice, ta metoda zostanie wywołana i zostanie do niej przeniesiona wartość parametru.</span><span class="sxs-lookup"><span data-stu-id="f360d-219">When this method call executes, SignalR will send the method name and the parameter value to the client, and if the client has a method named updateStockPrice, that method will be called and the parameter value will be passed to it.</span></span>

    <span data-ttu-id="f360d-220">Klienci. wszystkie oznaczają wysyłanie do wszystkich klientów.</span><span class="sxs-lookup"><span data-stu-id="f360d-220">Clients.All means send to all clients.</span></span> <span data-ttu-id="f360d-221">Sygnalizujący oferuje inne opcje umożliwiające określenie klientów lub grup klientów, do których mają być wysyłane.</span><span class="sxs-lookup"><span data-stu-id="f360d-221">SignalR gives you other options to specify which clients or groups of clients to send to.</span></span> <span data-ttu-id="f360d-222">Aby uzyskać więcej informacji, zobacz [HubConnectionContext](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hubs.hubconnectioncontext(v=vs.111).aspx).</span><span class="sxs-lookup"><span data-stu-id="f360d-222">For more information, see [HubConnectionContext](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hubs.hubconnectioncontext(v=vs.111).aspx).</span></span>

### <a name="register-the-signalr-route"></a><span data-ttu-id="f360d-223">Rejestrowanie trasy sygnalizującej</span><span class="sxs-lookup"><span data-stu-id="f360d-223">Register the SignalR route</span></span>

<span data-ttu-id="f360d-224">Serwer musi wiedzieć, który adres URL przechwycić i bezpośrednio do sygnalizującego.</span><span class="sxs-lookup"><span data-stu-id="f360d-224">The server needs to know which URL to intercept and direct to SignalR.</span></span> <span data-ttu-id="f360d-225">W tym celu należy dodać kod do pliku *Global. asax* .</span><span class="sxs-lookup"><span data-stu-id="f360d-225">To do that you'll add some code to the *Global.asax* file.</span></span>

1. <span data-ttu-id="f360d-226">W **Eksplorator rozwiązań**kliknij prawym przyciskiem myszy projekt, a następnie kliknij pozycję **Dodaj nowy element**.</span><span class="sxs-lookup"><span data-stu-id="f360d-226">In **Solution Explorer**, right-click the project, and then click **Add New Item**.</span></span>
2. <span data-ttu-id="f360d-227">Wybierz szablon **globalny element klasy aplikacji** , a następnie kliknij przycisk **Dodaj**.</span><span class="sxs-lookup"><span data-stu-id="f360d-227">Select the **Global Application Class** item template, and then click **Add**.</span></span>

    ![Dodaj Global. asax](tutorial-server-broadcast-with-aspnet-signalr/_static/image6.png)
3. <span data-ttu-id="f360d-229">Dodaj kod rejestracji trasy sygnału do metody startowej\_aplikacji:</span><span class="sxs-lookup"><span data-stu-id="f360d-229">Add the SignalR route registration code to the Application\_Start method:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample11.cs)]

    <span data-ttu-id="f360d-230">Domyślnie podstawowy adres URL dla całego ruchu sygnalizującego to "/SignalR", a "/SignalR/Hubs" służy do pobierania dynamicznie generowanego pliku języka JavaScript, który definiuje serwery proxy dla wszystkich centrów w aplikacji.</span><span class="sxs-lookup"><span data-stu-id="f360d-230">By default, the base URL for all SignalR traffic is "/signalr", and "/signalr/hubs" is used to retrieve a dynamically generated JavaScript file that defines proxies for all the Hubs you have in your application.</span></span> <span data-ttu-id="f360d-231">Metoda MapHubs zawiera przeciążenia umożliwiające określenie innego podstawowego adresu URL i niektórych opcji sygnalizujących w wystąpieniu klasy [HubConfiguration](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hubconfiguration(v=vs.111).aspx) .</span><span class="sxs-lookup"><span data-stu-id="f360d-231">The MapHubs method includes overloads that let you specify a different base URL and certain SignalR options in an instance of the [HubConfiguration](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hubconfiguration(v=vs.111).aspx) class.</span></span>
4. <span data-ttu-id="f360d-232">Dodaj instrukcję using na początku pliku:</span><span class="sxs-lookup"><span data-stu-id="f360d-232">Add a using statement at the top of the file:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample12.cs)]
5. <span data-ttu-id="f360d-233">Zapisz i zamknij plik *Global. asax* i skompiluj projekt.</span><span class="sxs-lookup"><span data-stu-id="f360d-233">Save and close the *Global.asax* file, and build the project.</span></span>

<span data-ttu-id="f360d-234">Konfiguracja kodu serwera została ukończona.</span><span class="sxs-lookup"><span data-stu-id="f360d-234">You have now completed setting up the server code.</span></span> <span data-ttu-id="f360d-235">W następnej sekcji skonfigurujesz klienta.</span><span class="sxs-lookup"><span data-stu-id="f360d-235">In the next section you'll set up the client.</span></span>

<a id="client"></a>

## <a name="set-up-the-client-code"></a><span data-ttu-id="f360d-236">Konfigurowanie kodu klienta</span><span class="sxs-lookup"><span data-stu-id="f360d-236">Set up the client code</span></span>

1. <span data-ttu-id="f360d-237">Utwórz nowy plik HTML w folderze projektu i nadaj mu nazwę *StockTicker. html*.</span><span class="sxs-lookup"><span data-stu-id="f360d-237">Create a new HTML file in the project folder, and name it *StockTicker.html*.</span></span>
2. <span data-ttu-id="f360d-238">Zastąp kod szablonu poniższym kodem:</span><span class="sxs-lookup"><span data-stu-id="f360d-238">Replace the template code with the following code:</span></span>

    [!code-html[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample13.html)]

    <span data-ttu-id="f360d-239">KOD HTML tworzy tabelę z 5 kolumnami, wierszem nagłówka i wierszem danych z pojedynczą komórką obejmującą wszystkie 5 kolumn.</span><span class="sxs-lookup"><span data-stu-id="f360d-239">The HTML creates a table with 5 columns, a header row, and a data row with a single cell that spans all 5 columns.</span></span> <span data-ttu-id="f360d-240">W wierszu danych zostanie wyświetlona wartość "ładowanie..." i będą wyświetlane tylko chwilę po uruchomieniu aplikacji.</span><span class="sxs-lookup"><span data-stu-id="f360d-240">The data row displays "loading..." and will only be shown momentarily when the application starts.</span></span> <span data-ttu-id="f360d-241">Kod JavaScript spowoduje usunięcie tego wiersza i dodanie go do swoich wierszy z danymi podstawowymi pobranymi z serwera.</span><span class="sxs-lookup"><span data-stu-id="f360d-241">JavaScript code will remove that row and add in its place rows with stock data retrieved from the server.</span></span>

    <span data-ttu-id="f360d-242">Tagi skryptu określają plik skryptu jQuery, podstawowy plik skryptu sygnalizującego, plik skryptu dla serwerów proxy sygnalizującego i plik skryptu StockTicker, który zostanie utworzony później.</span><span class="sxs-lookup"><span data-stu-id="f360d-242">The script tags specify the jQuery script file, the SignalR core script file, the SignalR proxies script file, and a StockTicker script file that you'll create later.</span></span> <span data-ttu-id="f360d-243">Plik skryptu dla serwerów proxy sygnalizujący, który określa adres URL "/SignalR/Hubs", jest generowana dynamicznie i definiuje metody proxy dla metod w klasie centrów, w tym przypadku StockTickerHub. GetAllStocks.</span><span class="sxs-lookup"><span data-stu-id="f360d-243">The SignalR proxies script file, which specifies the "/signalr/hubs" URL, is dynamically generated and defines proxy methods for the methods on the Hub class, in this case for StockTickerHub.GetAllStocks.</span></span> <span data-ttu-id="f360d-244">Jeśli wolisz, możesz wygenerować ten plik JavaScript ręcznie przy użyciu [narzędzi sygnalizujących](http://nuget.org/packages/Microsoft.AspNet.SignalR.Utils/) i wyłączyć dynamiczne tworzenie plików w wywołaniu metody MapHubs.</span><span class="sxs-lookup"><span data-stu-id="f360d-244">If you prefer, you can generate this JavaScript file manually by using [SignalR Utilities](http://nuget.org/packages/Microsoft.AspNet.SignalR.Utils/) and disable dynamic file creation in the MapHubs method call.</span></span>
3. > [!IMPORTANT]
   > <span data-ttu-id="f360d-245">Upewnij się, że odwołania do pliku JavaScript w *StockTicker. html* są poprawne.</span><span class="sxs-lookup"><span data-stu-id="f360d-245">Make sure that the JavaScript file references in *StockTicker.html* are correct.</span></span> <span data-ttu-id="f360d-246">Oznacza to, że wersja jQuery w tagu skryptu (1.8.2 w przykładzie) jest taka sama jak wersja jQuery w folderze *skryptów* projektu i upewnij się, że wersja sygnalizująca w tagu skryptu jest taka sama jak wersja sygnalizująca w folderze *scripts* projektu.</span><span class="sxs-lookup"><span data-stu-id="f360d-246">That is, make sure that the jQuery version in your script tag (1.8.2 in the example) is the same as the jQuery version in your project's *Scripts* folder, and make sure that the SignalR version in your script tag is the same as the SignalR version in your project's *Scripts* folder.</span></span> <span data-ttu-id="f360d-247">W razie potrzeby zmień nazwy plików w tagach skryptów.</span><span class="sxs-lookup"><span data-stu-id="f360d-247">Change the file names in the script tags if necessary.</span></span>
4. <span data-ttu-id="f360d-248">W **Eksplorator rozwiązań**kliknij prawym przyciskiem myszy pozycję *StockTicker. html*, a następnie kliknij pozycję **Ustaw jako stronę początkową**.</span><span class="sxs-lookup"><span data-stu-id="f360d-248">In **Solution Explorer**, right-click *StockTicker.html*, and then click **Set as Start Page**.</span></span>
5. <span data-ttu-id="f360d-249">Utwórz nowy plik JavaScript w folderze projektu i nadaj mu nazwę *StockTicker. js*..</span><span class="sxs-lookup"><span data-stu-id="f360d-249">Create a new JavaScript file in the project folder and name it *StockTicker.js*..</span></span>
6. <span data-ttu-id="f360d-250">Zastąp kod szablonu poniższym kodem:</span><span class="sxs-lookup"><span data-stu-id="f360d-250">Replace the template code with the following code:</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample14.js)]

    <span data-ttu-id="f360d-251">$. Connection odwołuje się do serwerów proxy sygnalizujących.</span><span class="sxs-lookup"><span data-stu-id="f360d-251">$.connection refers to the SignalR proxies.</span></span> <span data-ttu-id="f360d-252">Kod pobiera odwołanie do serwera proxy dla klasy StockTickerHub i umieszcza je w zmiennej ticker.</span><span class="sxs-lookup"><span data-stu-id="f360d-252">The code gets a reference to the proxy for the StockTickerHub class and puts it in the ticker variable.</span></span> <span data-ttu-id="f360d-253">Nazwa serwera proxy jest nazwą ustawioną przez atrybut [HubName]:</span><span class="sxs-lookup"><span data-stu-id="f360d-253">The proxy name is the name that was set by the [HubName] attribute:</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample15.js)]

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample16.cs)]

    <span data-ttu-id="f360d-254">Po zdefiniowaniu wszystkich zmiennych i funkcji, ostatni wiersz kodu w pliku inicjuje połączenie sygnalizujące przez wywołanie funkcji uruchomienia sygnału.</span><span class="sxs-lookup"><span data-stu-id="f360d-254">After all the variables and functions are defined, the last line of code in the file initializes the SignalR connection by calling the SignalR start function.</span></span> <span data-ttu-id="f360d-255">Funkcja Start wykonuje asynchroniczne i zwraca [odroczony obiekt jQuery](http://api.jquery.com/category/deferred-object/), co oznacza, że można wywołać funkcję gotowe, aby określić funkcję do wywołania po zakończeniu operacji asynchronicznej.</span><span class="sxs-lookup"><span data-stu-id="f360d-255">The start function executes asynchronously and returns a [jQuery Deferred object](http://api.jquery.com/category/deferred-object/), which means you can call the done function to specify the function to call when the asynchronous operation is completed..</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample17.js)]

    <span data-ttu-id="f360d-256">Funkcja init wywołuje funkcję getAllStocks na serwerze i używa informacji zwracanych przez serwer w celu zaktualizowania tabeli giełdowej.</span><span class="sxs-lookup"><span data-stu-id="f360d-256">The init function calls the getAllStocks function on the server and uses the information that the server returns to update the stock table.</span></span> <span data-ttu-id="f360d-257">Należy zauważyć, że domyślnie trzeba używać notacji CamelCase wielkości liter na kliencie, chociaż nazwa metody jest w języku Pascal-wielkość liter na serwerze.</span><span class="sxs-lookup"><span data-stu-id="f360d-257">Notice that by default, you have to use camel casing on the client although the method name is pascal-cased on the server.</span></span> <span data-ttu-id="f360d-258">Reguła "notacji CamelCase" dotyczy tylko metod, a nie obiektów.</span><span class="sxs-lookup"><span data-stu-id="f360d-258">The camel-casing rule only applies to methods, not objects.</span></span> <span data-ttu-id="f360d-259">Na przykład odwołujesz się do zasobów. Symbol i magazyn. Cena, niemagazynowa. symbol lub cena giełdowa.</span><span class="sxs-lookup"><span data-stu-id="f360d-259">For example, you refer to stock.Symbol and stock.Price, not stock.symbol or stock.price.</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample18.js)]

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample19.cs)]

    <span data-ttu-id="f360d-260">Jeśli chcesz użyć obudowy Pascala na kliencie lub jeśli chcesz użyć zupełnie innej nazwy metody, możesz dekorować metodę Hub z atrybutem HubMethodName w taki sam sposób jak w przypadku klasy Hub z atrybutem HubName.</span><span class="sxs-lookup"><span data-stu-id="f360d-260">If you wanted to use pascal casing on the client, or if you wanted to use a completely different method name, you could decorate the Hub method with the HubMethodName attribute the same way you decorated the Hub class itself with the HubName attribute.</span></span>

    <span data-ttu-id="f360d-261">W metodzie init kod HTML dla wiersza tabeli jest tworzony dla każdego obiektu giełdowego otrzymanego z serwera przez wywołanie formatStock do formatowania właściwości obiektu giełdowego, a następnie wywołanie supplant (który jest zdefiniowany w górnej części *StockTicker. js*), aby zastąpić symbole zastępcze w zmiennej rowTemplate wartością właściwości obiektu giełdowego.</span><span class="sxs-lookup"><span data-stu-id="f360d-261">In the init method, HTML for a table row is created for each stock object received from the server by calling formatStock to format properties of the stock object, and then by calling supplant (which is defined at the top of *StockTicker.js*) to replace placeholders in the rowTemplate variable with the stock object property values.</span></span> <span data-ttu-id="f360d-262">Otrzymany kod HTML jest następnie dołączany do tabeli giełdowej.</span><span class="sxs-lookup"><span data-stu-id="f360d-262">The resulting HTML is then appended to the stock table.</span></span>

    <span data-ttu-id="f360d-263">Wywoływanie init przez przekazanie go jako funkcji wywołania zwrotnego, która jest wykonywana po zakończeniu asynchronicznej funkcji uruchomienia.</span><span class="sxs-lookup"><span data-stu-id="f360d-263">You call init by passing it in as a callback function that executes after the asynchronous start function completes.</span></span> <span data-ttu-id="f360d-264">Jeśli wywołano init jako oddzielną instrukcję JavaScript po wywołaniu metody Start, funkcja nie powiedzie się, ponieważ zostanie wykonana natychmiast bez oczekiwania na zakończenie tworzenia połączenia przez funkcję startową.</span><span class="sxs-lookup"><span data-stu-id="f360d-264">If you called init as a separate JavaScript statement after calling start, the function would fail because it would execute immediately without waiting for the start function to finish establishing the connection.</span></span> <span data-ttu-id="f360d-265">W takim przypadku funkcja init spróbuje wywołać funkcję getAllStocks przed nawiązaniem połączenia z serwerem.</span><span class="sxs-lookup"><span data-stu-id="f360d-265">In that case, the init function would try to call the getAllStocks function before the server connection is established.</span></span>

    <span data-ttu-id="f360d-266">Gdy serwer zmieni cenę giełdową, wywoła updateStockPrice na podłączonych klientach.</span><span class="sxs-lookup"><span data-stu-id="f360d-266">When the server changes a stock's price, it calls the updateStockPrice on connected clients.</span></span> <span data-ttu-id="f360d-267">Funkcja jest dodawana do właściwości client serwera proxy stockTicker, aby była dostępna dla wywołań z serwera.</span><span class="sxs-lookup"><span data-stu-id="f360d-267">The function is added to the client property of the stockTicker proxy in order to make it available to calls from the server.</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample20.js)]

    <span data-ttu-id="f360d-268">Funkcja updateStockPrice formatuje obiekt giełdowy otrzymany z serwera w wierszu tabeli w taki sam sposób jak w funkcji init.</span><span class="sxs-lookup"><span data-stu-id="f360d-268">The updateStockPrice function formats a stock object received from the server into a table row the same way as in the init function.</span></span> <span data-ttu-id="f360d-269">Jednak zamiast dołączania wiersza do tabeli Znajdź bieżący wiersz zapasu w tabeli i zastępuje ten wiersz nowym.</span><span class="sxs-lookup"><span data-stu-id="f360d-269">However, instead of appending the row to the table, it finds the stock's current row in the table and replaces that row with the new one.</span></span>

<a id="test"></a>

## <a name="test-the-application"></a><span data-ttu-id="f360d-270">Testowanie aplikacji</span><span class="sxs-lookup"><span data-stu-id="f360d-270">Test the application</span></span>

1. <span data-ttu-id="f360d-271">Naciśnij klawisz F5, aby uruchomić aplikację w trybie debugowania.</span><span class="sxs-lookup"><span data-stu-id="f360d-271">Press F5 to run the application in debug mode.</span></span>

    <span data-ttu-id="f360d-272">W tabeli giełdowej początkowo jest wyświetlana wartość "ładowanie..." wiersz po krótkim opóźnieniu wyświetlane są początkowe dane podstawowe, a następnie ceny giełdowe zaczynają ulec zmianie.</span><span class="sxs-lookup"><span data-stu-id="f360d-272">The stock table initially displays the "loading..." line, then after a short delay the initial stock data is displayed, and then the stock prices start to change.</span></span>

    ![Ładowaniu](tutorial-server-broadcast-with-aspnet-signalr/_static/image7.png)

    ![Początkowa tabela giełdowa](tutorial-server-broadcast-with-aspnet-signalr/_static/image8.png)

    ![Tabela giełdowa otrzymuje zmiany z serwera](tutorial-server-broadcast-with-aspnet-signalr/_static/image9.png)
2. <span data-ttu-id="f360d-276">Skopiuj adres URL z paska adresu przeglądarki i wklej go do co najmniej jednego nowego okna przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="f360d-276">Copy the URL from the browser address bar and paste it into one or more new browser window(s).</span></span>

    <span data-ttu-id="f360d-277">Początkowy wyświetlacz giełdowy jest taki sam jak pierwsza przeglądarka i zmiany są wykonywane jednocześnie.</span><span class="sxs-lookup"><span data-stu-id="f360d-277">The initial stock display is the same as the first browser and changes happen simultaneously.</span></span>
3. <span data-ttu-id="f360d-278">Zamknij wszystkie przeglądarki i Otwórz nową przeglądarkę, a następnie przejdź do tego samego adresu URL.</span><span class="sxs-lookup"><span data-stu-id="f360d-278">Close all browsers and open a new browser, then go to the same URL.</span></span>

    <span data-ttu-id="f360d-279">Obiekt StockTicker singleton był nadal uruchamiany na serwerze, dlatego w tabeli giełdowej wyświetlane są wszystkie zasoby, które nadal zmieniają się.</span><span class="sxs-lookup"><span data-stu-id="f360d-279">The StockTicker singleton object has continued to run in the server, so the stock table display shows that the stocks have continued to change.</span></span> <span data-ttu-id="f360d-280">(Nie widzisz tabeli początkowej ze zmianami, które mają wartość zero).</span><span class="sxs-lookup"><span data-stu-id="f360d-280">(You don't see the initial table with zero change figures.)</span></span>
4. <span data-ttu-id="f360d-281">Zamknij okno przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="f360d-281">Close the browser.</span></span>

<a id="enablelogging"></a>

## <a name="enable-logging"></a><span data-ttu-id="f360d-282">Włączanie rejestrowania</span><span class="sxs-lookup"><span data-stu-id="f360d-282">Enable logging</span></span>

<span data-ttu-id="f360d-283">Sygnalizujący ma wbudowaną funkcję rejestrowania, którą można włączyć na kliencie, aby pomóc w rozwiązywaniu problemów.</span><span class="sxs-lookup"><span data-stu-id="f360d-283">SignalR has a built-in logging function that you can enable on the client to aid in troubleshooting.</span></span> <span data-ttu-id="f360d-284">W tej części należy włączyć rejestrowanie i zobaczyć przykłady pokazujące, w jaki sposób dzienniki poinformują o następujących metodach transportu:</span><span class="sxs-lookup"><span data-stu-id="f360d-284">In this section you enable logging and see examples that show how logs tell you which of the following transport methods SignalR is using:</span></span>

- <span data-ttu-id="f360d-285">Obiekty [WebSockets](http://en.wikipedia.org/wiki/WebSocket)obsługiwane przez usługi IIS 8 i bieżące przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="f360d-285">[WebSockets](http://en.wikipedia.org/wiki/WebSocket), supported by IIS 8 and current browsers.</span></span>
- <span data-ttu-id="f360d-286">[Zdarzenia wysyłane przez serwer](http://en.wikipedia.org/wiki/Server-sent_events)obsługiwane przez przeglądarki inne niż Internet Explorer.</span><span class="sxs-lookup"><span data-stu-id="f360d-286">[Server-sent events](http://en.wikipedia.org/wiki/Server-sent_events), supported by browsers other than Internet Explorer.</span></span>
- <span data-ttu-id="f360d-287">[Ramka bez ograniczeń](http://en.wikipedia.org/wiki/Comet_(programming)#Hidden_iframe)obsługiwana przez program Internet Explorer.</span><span class="sxs-lookup"><span data-stu-id="f360d-287">[Forever frame](http://en.wikipedia.org/wiki/Comet_(programming)#Hidden_iframe), supported by Internet Explorer.</span></span>
- <span data-ttu-id="f360d-288">[Długotrwałe sondowanie AJAX](http://en.wikipedia.org/wiki/Comet_(programming)#Ajax_with_long_polling)obsługiwane przez wszystkie przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="f360d-288">[Ajax long polling](http://en.wikipedia.org/wiki/Comet_(programming)#Ajax_with_long_polling), supported by all browsers.</span></span>

<span data-ttu-id="f360d-289">Dla dowolnego połączenia sygnalizujący wybiera najlepszą metodę transportu, którą obsługuje serwer i klient.</span><span class="sxs-lookup"><span data-stu-id="f360d-289">For any given connection, SignalR chooses the best transport method that both the server and the client support.</span></span>

1. <span data-ttu-id="f360d-290">Otwórz *StockTicker. js* i Dodaj wiersz kodu, aby włączyć rejestrowanie bezpośrednio przed kodem, który inicjuje połączenie na końcu pliku:</span><span class="sxs-lookup"><span data-stu-id="f360d-290">Open *StockTicker.js* and add a line of code to enable logging immediately before the code that initializes the connection at the end of the file:</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample21.js)]
2. <span data-ttu-id="f360d-291">Naciśnij klawisz F5, aby uruchomić projekt.</span><span class="sxs-lookup"><span data-stu-id="f360d-291">Press F5 to run the project.</span></span>
3. <span data-ttu-id="f360d-292">Otwórz okno narzędzia deweloperskie w przeglądarce i wybierz konsolę, aby wyświetlić dzienniki.</span><span class="sxs-lookup"><span data-stu-id="f360d-292">Open your browser's developer tools window, and select the Console to see the logs.</span></span> <span data-ttu-id="f360d-293">Może być konieczne odświeżenie strony, aby wyświetlić dzienniki sygnalizujące transportowanie metody transportu dla nowego połączenia.</span><span class="sxs-lookup"><span data-stu-id="f360d-293">You might have to refresh the page to see the logs of Signalr negotiating the transport method for a new connection.</span></span>

    <span data-ttu-id="f360d-294">Jeśli używasz programu Internet Explorer 10 w systemie Windows 8 (IIS 8), Metoda transportowa to WebSockets.</span><span class="sxs-lookup"><span data-stu-id="f360d-294">If you are running Internet Explorer 10 on Windows 8 (IIS 8), the transport method is WebSockets.</span></span>

    ![Konsola programu IE 10 IIS 8](tutorial-server-broadcast-with-aspnet-signalr/_static/image10.png)

    <span data-ttu-id="f360d-296">Jeśli używasz programu Internet Explorer 10 w systemie Windows 7 (IIS 7,5), Metoda transportu jest iframe.</span><span class="sxs-lookup"><span data-stu-id="f360d-296">If you are running Internet Explorer 10 on Windows 7 (IIS 7.5), the transport method is iframe.</span></span>

    ![IE 10 Console, IIS 7.5](tutorial-server-broadcast-with-aspnet-signalr/_static/image11.png)

    <span data-ttu-id="f360d-298">W programie Firefox zainstaluj dodatek Firebug, aby uzyskać okno konsoli.</span><span class="sxs-lookup"><span data-stu-id="f360d-298">In Firefox, install the Firebug add-in to get a Console window.</span></span> <span data-ttu-id="f360d-299">W przypadku korzystania z programu Firefox 19 w systemie Windows 8 (IIS 8) Metoda transportu jest funkcją WebSockets.</span><span class="sxs-lookup"><span data-stu-id="f360d-299">If you are running Firefox 19 on Windows 8 (IIS 8), the transport method is WebSockets.</span></span>

    ![Firefox 19 IIS 8 obiektów WebSockets](tutorial-server-broadcast-with-aspnet-signalr/_static/image12.png)

    <span data-ttu-id="f360d-301">W przypadku korzystania z programu Firefox 19 w systemie Windows 7 (IIS 7,5) Metoda transportu to zdarzenia wysłane przez serwer.</span><span class="sxs-lookup"><span data-stu-id="f360d-301">If you are running Firefox 19 on Windows 7 (IIS 7.5), the transport method is server-sent events.</span></span>

    ![Konsola programu Firefox 19 usług IIS 7,5](tutorial-server-broadcast-with-aspnet-signalr/_static/image13.png)

<a id="fullsample"></a>

## <a name="install-and-review-the-full-stockticker-sample"></a><span data-ttu-id="f360d-303">Instalowanie i przeglądanie pełnego przykładu StockTicker</span><span class="sxs-lookup"><span data-stu-id="f360d-303">Install and review the full StockTicker sample</span></span>

<span data-ttu-id="f360d-304">Aplikacja StockTicker zainstalowana przez [program Microsoft. ASPNET. Signal. przykładowy](http://nuget.org/packages/microsoft.aspnet.signalr.sample) pakiet NuGet zawiera więcej funkcji niż wersja uproszczona, która właśnie została utworzona od podstaw.</span><span class="sxs-lookup"><span data-stu-id="f360d-304">The StockTicker application that is installed by the [Microsoft.AspNet.SignalR.Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) NuGet package includes more features than the simplified version that you just created from scratch.</span></span> <span data-ttu-id="f360d-305">W tej części samouczka zainstalujesz pakiet NuGet i zapoznajesz się z nowymi funkcjami oraz kodem, który je implementuje.</span><span class="sxs-lookup"><span data-stu-id="f360d-305">In this section of the tutorial, you install the NuGet package and review the new features and the code that implements them.</span></span>

### <a name="install-the-signalrsample-nuget-package"></a><span data-ttu-id="f360d-306">Zainstaluj program sygnalizujący. przykładowy pakiet NuGet</span><span class="sxs-lookup"><span data-stu-id="f360d-306">Install the SignalR.Sample NuGet package</span></span>

1. <span data-ttu-id="f360d-307">W **Eksplorator rozwiązań**kliknij prawym przyciskiem myszy projekt, a następnie kliknij pozycję **Zarządzaj pakietami NuGet**.</span><span class="sxs-lookup"><span data-stu-id="f360d-307">In **Solution Explorer**, right-click the project and click **Manage NuGet Packages**.</span></span>
2. <span data-ttu-id="f360d-308">W oknie dialogowym **Zarządzanie pakietami NuGet** kliknij pozycję **online**, wprowadź *próbnik. przykładowo* w polu **Wyszukaj online** , a następnie kliknij pozycję **Zainstaluj** w pakiecie **sygnalizującym. przykładowy** pakiet.</span><span class="sxs-lookup"><span data-stu-id="f360d-308">In the **Manage NuGet Packages** dialog box, click **Online**, enter *SignalR.Sample* in the **Search Online** box, and then click **Install** in the **SignalR.Sample** package.</span></span>

    ![Zainstaluj program sygnalizujący. przykładowy pakiet](tutorial-server-broadcast-with-aspnet-signalr/_static/image14.png)
3. <span data-ttu-id="f360d-310">W pliku *Global. asax* Dodaj komentarz do metody Route. routes. MapHubs (); wiersz, który został dodany wcześniej w aplikacji\_Metoda Start.</span><span class="sxs-lookup"><span data-stu-id="f360d-310">In the *Global.asax* file, comment out the RouteTable.Routes.MapHubs(); line that you added earlier in the Application\_Start method.</span></span>

    <span data-ttu-id="f360d-311">Kod w *Global. asax* nie jest już wymagany, ponieważ sygnalizujący. przykładowy pakiet rejestruje trasę sygnalizującą w *aplikacji\_Start/RegisterHubs. cs* pliku:</span><span class="sxs-lookup"><span data-stu-id="f360d-311">The code in *Global.asax* is no longer needed because the SignalR.Sample package registers the SignalR route in the *App\_Start/RegisterHubs.cs* file:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample22.cs)]

    <span data-ttu-id="f360d-312">Klasa webaktywatora, do której odwołuje się atrybut zestawu, jest zawarta w pakiecie NuGet WebActivatorEx, który jest instalowany jako zależność dla sygnalizującego. przykładowego pakietu.</span><span class="sxs-lookup"><span data-stu-id="f360d-312">The WebActivator class that is referenced by the assembly attribute is included in the WebActivatorEx NuGet package, which is installed as a dependency of the SignalR.Sample package.</span></span>
4. <span data-ttu-id="f360d-313">W **Eksplorator rozwiązań**rozwiń węzeł *sygnalizujący. sample* , który został utworzony przez zainstalowanie próbnika. przykładowy pakiet.</span><span class="sxs-lookup"><span data-stu-id="f360d-313">In **Solution Explorer**, expand the *SignalR.Sample* folder which was created by installing the SignalR.Sample package.</span></span>
5. <span data-ttu-id="f360d-314">W folderze *sygnalizującym. przykład* kliknij prawym przyciskiem myszy *plik StockTicker. html*, a następnie kliknij pozycję **Ustaw jako stronę początkową**.</span><span class="sxs-lookup"><span data-stu-id="f360d-314">In the *SignalR.Sample* folder, right-click *StockTicker.html*, and then click **Set As Start Page**.</span></span>

    > [!NOTE]
    > <span data-ttu-id="f360d-315">Instalowanie programu sygnalizującego. przykładowy pakiet NuGet może zmienić wersję platformy jQuery, która znajduje się w folderze *skryptów* .</span><span class="sxs-lookup"><span data-stu-id="f360d-315">Installing The SignalR.Sample NuGet package might change the version of jQuery that you have in your *Scripts* folder.</span></span> <span data-ttu-id="f360d-316">Nowy plik *StockTicker. html* instalowany przez pakiet w *sygnale. przykładowy* folder będzie synchronizowany z wersją jQuery, którą instaluje pakiet, ale jeśli chcesz ponownie uruchomić oryginalny plik *StockTicker. html* , być może trzeba będzie najpierw zaktualizować odwołanie do jQuery w tagu skryptu.</span><span class="sxs-lookup"><span data-stu-id="f360d-316">The new *StockTicker.html* file that the package installs in the *SignalR.Sample* folder will be in sync with the jQuery version that the package installs, but if you want to run your original *StockTicker.html* file again, you might have to update the jQuery reference in the script tag first.</span></span>

### <a name="run-the-application"></a><span data-ttu-id="f360d-317">Uruchamianie aplikacji</span><span class="sxs-lookup"><span data-stu-id="f360d-317">Run the application</span></span>

1. <span data-ttu-id="f360d-318">Naciśnij klawisz F5, aby uruchomić aplikację.</span><span class="sxs-lookup"><span data-stu-id="f360d-318">Press F5 to run the application.</span></span>

    <span data-ttu-id="f360d-319">Oprócz siatki, która została wcześniej wyświetlona, cała aplikacja taktowania w poziomie obejmuje przewijane okno, które wyświetla te same dane giełdowe.</span><span class="sxs-lookup"><span data-stu-id="f360d-319">In addition to the grid that you saw earlier, the full stock ticker application shows a horizontally scrolling window that displays the same stock data.</span></span> <span data-ttu-id="f360d-320">Po uruchomieniu aplikacji po raz pierwszy "rynek" jest "zamknięty" i widoczna jest siatka statyczna i okno taktowania, które nie jest przewijane.</span><span class="sxs-lookup"><span data-stu-id="f360d-320">When you run the application for the first time, the "market" is "closed" and you see a static grid and a ticker window that isn't scrolling.</span></span>

    ![StockTicker ekranu startowego](tutorial-server-broadcast-with-aspnet-signalr/_static/image15.png)

    <span data-ttu-id="f360d-322">Po kliknięciu przycisku **Otwórz rynek**zostanie wyświetlone okno wydarzenie na **żywo** , które będzie przewinąć w poziomie, a serwer rozpocznie okresowe emitowanie zmian cen giełdowych.</span><span class="sxs-lookup"><span data-stu-id="f360d-322">When you click **Open Market**, the **Live Stock Ticker** box starts to scroll horizontally, and the server starts to periodically broadcast stock price changes on a random basis.</span></span> <span data-ttu-id="f360d-323">Za każdym razem, gdy cena giełdowa ulegnie zmianie, zostanie zaktualizowana siatka siatki **spisu** i **dynamiczny magazyn** .</span><span class="sxs-lookup"><span data-stu-id="f360d-323">Each time a stock price changes, both the **Live Stock Table** grid and the **Live Stock Ticker** box are updated.</span></span> <span data-ttu-id="f360d-324">Gdy zmiana ceny giełdy jest dodatnia, jest ona pokazywana z zielonym tłem, a gdy zmiana jest ujemna, zapasy są wyświetlane z czerwonym tłem.</span><span class="sxs-lookup"><span data-stu-id="f360d-324">When a stock's price change is positive, the stock is shown with a green background, and when the change is negative, the stock is shown with a red background.</span></span>

    ![Aplikacja StockTicker, otwarta na rynku](tutorial-server-broadcast-with-aspnet-signalr/_static/image16.png)

    <span data-ttu-id="f360d-326">Przycisk **Zamknij rynek** powoduje zatrzymanie zmian i zatrzymanie przewijania znacznika, a przycisk **Resetuj** resetuje wszystkie dane giełdowe do stanu początkowego przed rozpoczęciem zmian cen.</span><span class="sxs-lookup"><span data-stu-id="f360d-326">The **Close Market** button stops the changes and stops the ticker scrolling, and the **Reset** button resets all stock data to the initial state before price changes started.</span></span> <span data-ttu-id="f360d-327">Jeśli otworzysz więcej okien przeglądarki i przejdziesz do tego samego adresu URL, zobaczysz te same dane dynamicznie aktualizowane w każdej przeglądarce.</span><span class="sxs-lookup"><span data-stu-id="f360d-327">If you open more browser windows and go to the same URL, you see the same data dynamically updated at the same time in each browser.</span></span> <span data-ttu-id="f360d-328">Po kliknięciu jednego z przycisków wszystkie przeglądarki reagują w ten sam sposób w tym samym czasie.</span><span class="sxs-lookup"><span data-stu-id="f360d-328">When you click one of the buttons, all browsers respond the same way at the same time.</span></span>

### <a name="live-stock-ticker-display"></a><span data-ttu-id="f360d-329">Wyświetlanie grafu giełdowego na żywo</span><span class="sxs-lookup"><span data-stu-id="f360d-329">Live Stock Ticker display</span></span>

<span data-ttu-id="f360d-330">Wyświetlacz **giełdowy na żywo** jest nieuporządkowaną listą w elemencie DIV, który jest sformatowany w jednym wierszu według stylów CSS.</span><span class="sxs-lookup"><span data-stu-id="f360d-330">The **Live Stock Ticker** display is an unordered list in a div element that is formatted into a single line by CSS styles.</span></span> <span data-ttu-id="f360d-331">Znacznik jest inicjowany i aktualizowany w taki sam sposób, jak w tabeli: przez zastąpienie symboli zastępczych w ciągu szablonu &lt;li&gt; i dynamiczne dodanie elementów &lt;li&gt; do &lt;go elementu ul&gt;.</span><span class="sxs-lookup"><span data-stu-id="f360d-331">The ticker is initialized and updated the same way as the table: by replacing placeholders in a &lt;li&gt; template string and dynamically adding the &lt;li&gt; elements to the &lt;ul&gt; element.</span></span> <span data-ttu-id="f360d-332">Przewijanie jest wykonywane przy użyciu funkcji "Animuj animacje" w celu zaróżnienia lewego marginesu listy nieuporządkowanej w bloku DIV.</span><span class="sxs-lookup"><span data-stu-id="f360d-332">The scrolling is performed by using the jQuery animate function to vary the margin-left of the unordered list within the div.</span></span>

<span data-ttu-id="f360d-333">KOD HTML znacznika giełdowego:</span><span class="sxs-lookup"><span data-stu-id="f360d-333">The stock ticker HTML:</span></span>

[!code-html[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample23.html)]

<span data-ttu-id="f360d-334">KOD CSS znacznika giełdowego:</span><span class="sxs-lookup"><span data-stu-id="f360d-334">The stock ticker CSS:</span></span>

[!code-html[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample24.html)]

<span data-ttu-id="f360d-335">Kod jQuery, który umożliwia przewinięcie:</span><span class="sxs-lookup"><span data-stu-id="f360d-335">The jQuery code that makes it scroll:</span></span>

[!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample25.js)]

### <a name="additional-methods-on-the-server-that-the-client-can-call"></a><span data-ttu-id="f360d-336">Dodatkowe metody na serwerze, z którym klient może wywoływać</span><span class="sxs-lookup"><span data-stu-id="f360d-336">Additional methods on the server that the client can call</span></span>

<span data-ttu-id="f360d-337">Klasa StockTickerHub definiuje cztery dodatkowe metody, które klient może wywołać:</span><span class="sxs-lookup"><span data-stu-id="f360d-337">The StockTickerHub class defines four additional methods that the client can call:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample26.cs)]

<span data-ttu-id="f360d-338">OpenMarket, CloseMarket i Reset są wywoływane w odpowiedzi na przyciski w górnej części strony.</span><span class="sxs-lookup"><span data-stu-id="f360d-338">OpenMarket, CloseMarket, and Reset are called in response to the buttons at the top of the page.</span></span> <span data-ttu-id="f360d-339">Pokazują one wzorzec jednego klienta wyzwalającego zmianę stanu, który jest natychmiast propagowany do wszystkich klientów.</span><span class="sxs-lookup"><span data-stu-id="f360d-339">They demonstrate the pattern of one client triggering a change in state that is immediately propagated to all clients.</span></span> <span data-ttu-id="f360d-340">Każda z tych metod wywołuje metodę w klasie StockTicker, która wpływa na zmianę stanu rynku, a następnie emituje nowy stan.</span><span class="sxs-lookup"><span data-stu-id="f360d-340">Each of these methods calls a method in the StockTicker class that effects the market state change and then broadcasts the new state.</span></span>

<span data-ttu-id="f360d-341">W klasie StockTicker stan rynku jest obsługiwany przez właściwość MarketState, która zwraca wartość wyliczenia MarketState:</span><span class="sxs-lookup"><span data-stu-id="f360d-341">In the StockTicker class, the state of the market is maintained by a MarketState property that returns a MarketState enum value:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample27.cs)]

<span data-ttu-id="f360d-342">Każda z metod, które zmieniają stan rynku, to w bloku blokady, ponieważ Klasa StockTicker musi być threadsafe:</span><span class="sxs-lookup"><span data-stu-id="f360d-342">Each of the methods that change the market state do so inside a lock block because the StockTicker class has to be threadsafe:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample28.cs)]

<span data-ttu-id="f360d-343">Aby upewnić się, że ten kod jest threadsafe, pole \_marketState, które wykonuje kopię zapasową właściwości MarketState, jest oznaczone jako nietrwałe.</span><span class="sxs-lookup"><span data-stu-id="f360d-343">To ensure that this code is threadsafe, the \_marketState field that backs the MarketState property is marked as volatile,</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample29.cs)]

<span data-ttu-id="f360d-344">Metody BroadcastMarketStateChange i BroadcastMarketReset są podobne do metody BroadcastStockPrice, która została już wykorzystana, z tą różnicą, że wywołują różne metody zdefiniowane na kliencie:</span><span class="sxs-lookup"><span data-stu-id="f360d-344">The BroadcastMarketStateChange and BroadcastMarketReset methods are similar to the BroadcastStockPrice method that you already saw, except they call different methods defined at the client:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample30.cs)]

### <a name="additional-functions-on-the-client-that-the-server-can-call"></a><span data-ttu-id="f360d-345">Dodatkowe funkcje na kliencie, które może wywoływać serwer</span><span class="sxs-lookup"><span data-stu-id="f360d-345">Additional functions on the client that the server can call</span></span>

<span data-ttu-id="f360d-346">Funkcja updateStockPrice obsługuje teraz zarówno siatkę, jak i wyświetlanie znaczników, a następnie używa jQuery. Color do Flash Red i Green Color.</span><span class="sxs-lookup"><span data-stu-id="f360d-346">The updateStockPrice function now handles both the grid and the ticker display, and it uses jQuery.Color to flash red and green colors.</span></span>

<span data-ttu-id="f360d-347">Nowe funkcje w programie *sygnalizującer. StockTicker. js* włącza i wyłącza przyciski na podstawie stanu na rynku, a także zatrzymuje lub uruchamiają przewijanie w poziomie okna znaczników.</span><span class="sxs-lookup"><span data-stu-id="f360d-347">New functions in *SignalR.StockTicker.js* enable and disable the buttons based on market state, and they stop or start the ticker window horizontal scrolling.</span></span> <span data-ttu-id="f360d-348">Ponieważ wiele funkcji jest dodawanych do programu ticker. Client, [Funkcja rozszerzająca jQuery](http://api.jquery.com/jQuery.extend/) służy do ich dodawania.</span><span class="sxs-lookup"><span data-stu-id="f360d-348">Since multiple functions are being added to ticker.client, the [jQuery extend function](http://api.jquery.com/jQuery.extend/) is used to add them.</span></span>

[!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample31.js)]

### <a name="additional-client-setup-after-establishing-the-connection"></a><span data-ttu-id="f360d-349">Dodatkowa konfiguracja klienta po ustanowieniu połączenia</span><span class="sxs-lookup"><span data-stu-id="f360d-349">Additional client setup after establishing the connection</span></span>

<span data-ttu-id="f360d-350">Po nawiązaniu połączenia klient ma kilka dodatkowych czynności do wykonania: Sprawdź, czy rynek jest otwarty lub zamknięty w celu wywołania odpowiedniej funkcji marketOpened lub marketClosed, i Dołącz wywołania metody serwera do przycisków.</span><span class="sxs-lookup"><span data-stu-id="f360d-350">After the client establishes the connection, it has some additional work to do: find out if the market is open or closed in order to call the appropriate marketOpened or marketClosed function, and attach the server method calls to the buttons.</span></span>

[!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample32.js)]

<span data-ttu-id="f360d-351">Metody serwera nie są połączone z przyciskami aż po nawiązaniu połączenia, dzięki czemu kod nie może próbować wywołać metody serwera przed udostępnieniem.</span><span class="sxs-lookup"><span data-stu-id="f360d-351">The server methods are not wired up to the buttons until after the connection is established, so that the code can't try to call the server methods before they are available.</span></span>

<a id="nextsteps"></a>

## <a name="next-steps"></a><span data-ttu-id="f360d-352">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="f360d-352">Next steps</span></span>

<span data-ttu-id="f360d-353">W tym samouczku przedstawiono sposób programowania aplikacji sygnalizującej, która emituje komunikaty z serwera do wszystkich połączonych klientów, zarówno okresowo, jak i w odpowiedzi na powiadomienia z dowolnego klienta.</span><span class="sxs-lookup"><span data-stu-id="f360d-353">In this tutorial you've learned how to program a SignalR application that broadcasts messages from the server to all connected clients, both on a periodic basis and in response to notifications from any client.</span></span> <span data-ttu-id="f360d-354">Wzorzec korzystania z wielowątkowego wystąpienia pojedynczego do obsługi stanu serwera może również być używany w scenariuszach gier online obejmujących wiele graczy.</span><span class="sxs-lookup"><span data-stu-id="f360d-354">The pattern of using a multi-threaded singleton instance to maintain server state can also be also used in multi-player online game scenarios.</span></span> <span data-ttu-id="f360d-355">Aby zapoznać się z przykładem, zapoznaj się [z grą korzystającą z usługi sygnalizującej](https://github.com/NTaylorMullen/ShootR).</span><span class="sxs-lookup"><span data-stu-id="f360d-355">For an example, see [the ShootR game that is based on SignalR](https://github.com/NTaylorMullen/ShootR).</span></span>

<span data-ttu-id="f360d-356">Aby zapoznać się z samouczkami pokazującymi scenariusze komunikacji równorzędnej, zobacz [wprowadzenie z sygnalizacją](index.md) i [aktualizacją w czasie rzeczywistym za pomocą usługi sygnalizującego](index.md).</span><span class="sxs-lookup"><span data-stu-id="f360d-356">For tutorials that show peer-to-peer communication scenarios, see [Getting Started with SignalR](index.md) and [Real-Time Updating with SignalR](index.md).</span></span>

<span data-ttu-id="f360d-357">Aby dowiedzieć się więcej na temat zaawansowanych koncepcji związanych z programowaniem sygnałów, odwiedź następujące witryny dotyczące kodu źródłowego i zasobów usługi sygnalizującego:</span><span class="sxs-lookup"><span data-stu-id="f360d-357">To learn more advanced SignalR development concepts, visit the following sites for SignalR source code and resources:</span></span>

- [<span data-ttu-id="f360d-358">ASP.NET sygnalizujący</span><span class="sxs-lookup"><span data-stu-id="f360d-358">ASP.NET SignalR</span></span>](https://asp.net/signalr/)
- [<span data-ttu-id="f360d-359">Projekt sygnalizującego</span><span class="sxs-lookup"><span data-stu-id="f360d-359">SignalR Project</span></span>](http://signalr.net/)
- [<span data-ttu-id="f360d-360">Usługi GitHub i przykłady dla sygnałów</span><span class="sxs-lookup"><span data-stu-id="f360d-360">SignalR Github and Samples</span></span>](https://github.com/SignalR/SignalR)
- [<span data-ttu-id="f360d-361">Strona typu wiki sygnalizująca</span><span class="sxs-lookup"><span data-stu-id="f360d-361">SignalR Wiki</span></span>](https://github.com/SignalR/SignalR/wiki)
