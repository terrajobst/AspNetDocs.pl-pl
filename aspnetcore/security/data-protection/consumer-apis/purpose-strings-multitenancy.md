---
title: Hierarchia celów i obsługa wielu dzierżawców w programie ASP.NET Core
author: rick-anderson
description: Dowiedz się więcej o hierarchia ciągu celów i obsługa wielu dzierżawców w odniesieniu do interfejsów API do ochrony danych usługi ASP.NET Core.
ms.author: riande
ms.date: 10/14/2016
uid: security/data-protection/consumer-apis/purpose-strings-multitenancy
ms.openlocfilehash: 1133d40e7b325d58b3f70e7387494dae36ff8ac9
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 03/01/2019
ms.locfileid: "57072746"
---
# <a name="purpose-hierarchy-and-multi-tenancy-in-aspnet-core"></a><span data-ttu-id="14dbb-103">Hierarchia celów i obsługa wielu dzierżawców w programie ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="14dbb-103">Purpose hierarchy and multi-tenancy in ASP.NET Core</span></span>

<span data-ttu-id="14dbb-104">Ponieważ `IDataProtector` jest również niejawnie `IDataProtectionProvider`, celów można łączyć w łańcuch.</span><span class="sxs-lookup"><span data-stu-id="14dbb-104">Since an `IDataProtector` is also implicitly an `IDataProtectionProvider`, purposes can be chained together.</span></span> <span data-ttu-id="14dbb-105">W tym sensie `provider.CreateProtector([ "purpose1", "purpose2" ])` jest odpowiednikiem `provider.CreateProtector("purpose1").CreateProtector("purpose2")`.</span><span class="sxs-lookup"><span data-stu-id="14dbb-105">In this sense, `provider.CreateProtector([ "purpose1", "purpose2" ])` is equivalent to `provider.CreateProtector("purpose1").CreateProtector("purpose2")`.</span></span>

<span data-ttu-id="14dbb-106">Dzięki temu w przypadku niektórych interesujące relacji hierarchicznych za pośrednictwem systemu ochrony danych.</span><span class="sxs-lookup"><span data-stu-id="14dbb-106">This allows for some interesting hierarchical relationships through the data protection system.</span></span> <span data-ttu-id="14dbb-107">We wcześniejszym przykładzie z [Contoso.Messaging.SecureMessage](xref:security/data-protection/consumer-apis/purpose-strings#data-protection-contoso-purpose), można wywołać składnika SecureMessage `provider.CreateProtector("Contoso.Messaging.SecureMessage")` raz ponoszonych z góry i zbuforuj wynik do prywatnej `_myProvider` pola.</span><span class="sxs-lookup"><span data-stu-id="14dbb-107">In the earlier example of [Contoso.Messaging.SecureMessage](xref:security/data-protection/consumer-apis/purpose-strings#data-protection-contoso-purpose), the SecureMessage component can call `provider.CreateProtector("Contoso.Messaging.SecureMessage")` once up-front and cache the result into a private `_myProvider` field.</span></span> <span data-ttu-id="14dbb-108">Funkcje ochrony kluczy w przyszłości można będzie utworzyć za pomocą wywołania `_myProvider.CreateProtector("User: username")`, a te funkcje ochrony kluczy będzie używana do zabezpieczania poszczególnych wiadomości.</span><span class="sxs-lookup"><span data-stu-id="14dbb-108">Future protectors can then be created via calls to `_myProvider.CreateProtector("User: username")`, and these protectors would be used for securing the individual messages.</span></span>

<span data-ttu-id="14dbb-109">To również można odwrócić.</span><span class="sxs-lookup"><span data-stu-id="14dbb-109">This can also be flipped.</span></span> <span data-ttu-id="14dbb-110">Należy rozważyć jednej aplikacji logicznej hosta, którego można skonfigurować wiele dzierżaw (rozsądne wydaje CMS) i każdego dzierżawcy z własnym systemem uwierzytelniania i stanu zarządzania.</span><span class="sxs-lookup"><span data-stu-id="14dbb-110">Consider a single logical application which hosts multiple tenants (a CMS seems reasonable), and each tenant can be configured with its own authentication and state management system.</span></span> <span data-ttu-id="14dbb-111">Aplikacja parasola ma jednego dostawcy głównego i wywołuje `provider.CreateProtector("Tenant 1")` i `provider.CreateProtector("Tenant 2")` aby dać każdej dzierżawy własnego izolowanego wycinek system ochrony danych.</span><span class="sxs-lookup"><span data-stu-id="14dbb-111">The umbrella application has a single master provider, and it calls `provider.CreateProtector("Tenant 1")` and `provider.CreateProtector("Tenant 2")` to give each tenant its own isolated slice of the data protection system.</span></span> <span data-ttu-id="14dbb-112">Dzierżawcy mogą następnie pochodzić własne poszczególne funkcje ochrony kluczy na podstawie własnych potrzeb, ale niezależnie od tego, jaką użytkownik podejmie próbę nie mogą tworzyć funkcje ochrony kluczy, które kolidują z innymi dzierżawami w systemie.</span><span class="sxs-lookup"><span data-stu-id="14dbb-112">The tenants could then derive their own individual protectors based on their own needs, but no matter how hard they try they cannot create protectors which collide with any other tenant in the system.</span></span> <span data-ttu-id="14dbb-113">Graficzne jest reprezentowane poniżej.</span><span class="sxs-lookup"><span data-stu-id="14dbb-113">Graphically, this is represented as below.</span></span>

![Obsługa wielu dzierżawców celów](purpose-strings-multitenancy/_static/purposes-multi-tenancy.png)

>[!WARNING]
> <span data-ttu-id="14dbb-115">Przy założeniu, parasola kontrolki aplikacji, które interfejsy API są dostępne dla poszczególnych dzierżawców i dzierżawcy nie można wykonać dowolnego kodu na serwerze.</span><span class="sxs-lookup"><span data-stu-id="14dbb-115">This assumes the umbrella application controls which APIs are available to individual tenants and that tenants cannot execute arbitrary code on the server.</span></span> <span data-ttu-id="14dbb-116">Jeśli Dzierżawca może wykonywać dowolny kod, wykonują prywatnej odbicia przerwanie gwarancje izolacji lub można po prostu bezpośrednio odczytywać materiał klucza głównego i pochodzić z dowolnych podkluczy działanie.</span><span class="sxs-lookup"><span data-stu-id="14dbb-116">If a tenant can execute arbitrary code, they could perform private reflection to break the isolation guarantees, or they could just read the master keying material directly and derive whatever subkeys they desire.</span></span>

<span data-ttu-id="14dbb-117">System ochrony danych faktycznie używa sortowania wielu dzierżawców w domyślnej konfiguracji poza pole.</span><span class="sxs-lookup"><span data-stu-id="14dbb-117">The data protection system actually uses a sort of multi-tenancy in its default out-of-the-box configuration.</span></span> <span data-ttu-id="14dbb-118">Domyślnie materiał klucza głównego są przechowywane w folderze profilu użytkownika konta procesu roboczego (lub rejestru dla tożsamości puli aplikacji IIS).</span><span class="sxs-lookup"><span data-stu-id="14dbb-118">By default master keying material is stored in the worker process account's user profile folder (or the registry, for IIS application pool identities).</span></span> <span data-ttu-id="14dbb-119">Ale rzeczywiście dość często jest używać jednego konta do uruchomienia wielu aplikacji, a zatem te aplikacje pojawiłyby udostępnianie wzorzec materiału klucza.</span><span class="sxs-lookup"><span data-stu-id="14dbb-119">But it's actually fairly common to use a single account to run multiple applications, and thus all these applications would end up sharing the master keying material.</span></span> <span data-ttu-id="14dbb-120">Aby rozwiązać ten problem, system ochrony danych automatycznie wstawia identyfikator unikatowy dla aplikacji jako pierwszy element w łańcuchu ogólnego przeznaczenia.</span><span class="sxs-lookup"><span data-stu-id="14dbb-120">To solve this, the data protection system automatically inserts a unique-per-application identifier as the first element in the overall purpose chain.</span></span> <span data-ttu-id="14dbb-121">W tym celu niejawne służy do [izolowania aplikacji poszczególnych](xref:security/data-protection/configuration/overview#per-application-isolation) od siebie nawzajem skutecznie traktując każdej aplikacji jako unikatowy dzierżawy w ramach systemu i proces tworzenia ochrony wygląda identyczne z powyższej ilustracji.</span><span class="sxs-lookup"><span data-stu-id="14dbb-121">This implicit purpose serves to [isolate individual applications](xref:security/data-protection/configuration/overview#per-application-isolation) from one another by effectively treating each application as a unique tenant within the system, and the protector creation process looks identical to the image above.</span></span>
