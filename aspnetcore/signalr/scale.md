---
title: ASP.NET Core SignalR produkcji hostowania i skalowania
author: bradygaster
description: Dowiedz się, jak uniknąć wydajności i skalowania problemy w aplikacjach korzystających z biblioteki SignalR platformy ASP.NET Core.
monikerRange: '>= aspnetcore-2.1'
ms.author: bradyg
ms.custom: mvc
ms.date: 11/28/2018
uid: signalr/scale
ms.openlocfilehash: 4ac4509acc89d0091a3757c7cfbc9981614f29ad
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 03/01/2019
ms.locfileid: "57069947"
---
# <a name="aspnet-core-signalr-hosting-and-scaling"></a><span data-ttu-id="1f0bb-103">ASP.NET Core SignalR hostowania i skalowania</span><span class="sxs-lookup"><span data-stu-id="1f0bb-103">ASP.NET Core SignalR hosting and scaling</span></span>

<span data-ttu-id="1f0bb-104">Przez [Andrew Stanton pielęgniarki](https://twitter.com/anurse), [Brady'ego Gastera](https://twitter.com/bradygaster), i [Tom Dykstra](https://github.com/tdykstra),</span><span class="sxs-lookup"><span data-stu-id="1f0bb-104">By [Andrew Stanton-Nurse](https://twitter.com/anurse), [Brady Gaster](https://twitter.com/bradygaster), and [Tom Dykstra](https://github.com/tdykstra),</span></span>

<span data-ttu-id="1f0bb-105">W tym artykule wyjaśniono, hostowanie i skalowanie zagadnienia dotyczące aplikacji o wysokim natężeniu ruchu, korzystających z biblioteki SignalR platformy ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="1f0bb-105">This article explains hosting and scaling considerations for high-traffic apps that use ASP.NET Core SignalR.</span></span>

## <a name="tcp-connection-resources"></a><span data-ttu-id="1f0bb-106">Zasoby połączenia TCP</span><span class="sxs-lookup"><span data-stu-id="1f0bb-106">TCP connection resources</span></span>

<span data-ttu-id="1f0bb-107">Liczba jednoczesnych połączeń TCP, która może obsłużyć serwer sieci web jest ograniczona.</span><span class="sxs-lookup"><span data-stu-id="1f0bb-107">The number of concurrent TCP connections that a web server can support is limited.</span></span> <span data-ttu-id="1f0bb-108">Użyj standardowych klientów HTTP *efemeryczne* połączeń.</span><span class="sxs-lookup"><span data-stu-id="1f0bb-108">Standard HTTP clients use *ephemeral* connections.</span></span> <span data-ttu-id="1f0bb-109">Te połączenia może zostać zamknięty, gdy klient przechodzi bezczynności i otworzyć ponownie później.</span><span class="sxs-lookup"><span data-stu-id="1f0bb-109">These connections can be closed when the client goes idle and reopened later.</span></span> <span data-ttu-id="1f0bb-110">Z drugiej strony, jest połączenia SignalR *trwałego*.</span><span class="sxs-lookup"><span data-stu-id="1f0bb-110">On the other hand, a SignalR connection is *persistent*.</span></span> <span data-ttu-id="1f0bb-111">Połączenia SignalR pozostają otwarte, nawet wtedy, gdy klient wprowadzona bezczynności.</span><span class="sxs-lookup"><span data-stu-id="1f0bb-111">SignalR connections stay open even when the client goes idle.</span></span> <span data-ttu-id="1f0bb-112">W aplikacji o dużym natężeniu ruchu, który obsługuje wielu klientów tych połączeń trwałych może spowodować serwerów trafić ich maksymalna liczba połączeń.</span><span class="sxs-lookup"><span data-stu-id="1f0bb-112">In a high-traffic app that serves many clients, these persistent connections can cause servers to hit their maximum number of connections.</span></span>

<span data-ttu-id="1f0bb-113">Połączenia trwałe wymaga użycia dodatkowej pamięci, aby śledzić każdego połączenia.</span><span class="sxs-lookup"><span data-stu-id="1f0bb-113">Persistent connections also consume some additional memory, to track each connection.</span></span>

<span data-ttu-id="1f0bb-114">Duże wykorzystanie związane z połączeniem zasobów przez element SignalR może wpływać na inne aplikacje sieci web, które są hostowane na tym samym serwerze.</span><span class="sxs-lookup"><span data-stu-id="1f0bb-114">The heavy use of connection-related resources by SignalR can affect other web apps that are hosted on the same server.</span></span> <span data-ttu-id="1f0bb-115">Jeśli SignalR zostanie otwarty i zawiera ostatni dostępnych połączeń TCP, inne aplikacje sieci web na tym samym serwerze również mieć dostępnych do nich żadnych połączeń.</span><span class="sxs-lookup"><span data-stu-id="1f0bb-115">When SignalR opens and holds the last available TCP connections, other web apps on the same server also have no more connections available to them.</span></span>

<span data-ttu-id="1f0bb-116">Jeśli serwer jest uruchomiony poza połączeniami, zostaną wyświetlone błędy losowe gniazda, a połączenie zresetowane błędy.</span><span class="sxs-lookup"><span data-stu-id="1f0bb-116">If a server runs out of connections, you'll see random socket errors and connection reset errors.</span></span> <span data-ttu-id="1f0bb-117">Na przykład:</span><span class="sxs-lookup"><span data-stu-id="1f0bb-117">For example:</span></span>

```
An attempt was made to access a socket in a way forbidden by its access permissions...
```

<span data-ttu-id="1f0bb-118">Aby uniknąć użycia zasobów SignalR przyczyną błędów w innych aplikacjach sieci web, należy uruchomić na różnych serwerach niż inne aplikacje sieci web SignalR.</span><span class="sxs-lookup"><span data-stu-id="1f0bb-118">To keep SignalR resource usage from causing errors in other web apps, run SignalR on different servers than your other web apps.</span></span>

<span data-ttu-id="1f0bb-119">Aby uniknąć użycia zasobów SignalR przyczyną błędów w aplikacji SignalR, skalowanie w poziomie, aby ograniczyć liczbę połączeń serwera musi obsługiwać.</span><span class="sxs-lookup"><span data-stu-id="1f0bb-119">To keep SignalR resource usage from causing errors in a SignalR app, scale out to limit the number of connections a server has to handle.</span></span>

## <a name="scale-out"></a><span data-ttu-id="1f0bb-120">Skalowanie w poziomie</span><span class="sxs-lookup"><span data-stu-id="1f0bb-120">Scale out</span></span>

<span data-ttu-id="1f0bb-121">Aplikację, która używa biblioteki SignalR musi do śledzenia swoich połączeń, które stwarza problemy dla farmy serwerów.</span><span class="sxs-lookup"><span data-stu-id="1f0bb-121">An app that uses SignalR needs to keep track of all its connections, which creates problems for a server farm.</span></span> <span data-ttu-id="1f0bb-122">Dodawanie serwera i pobiera nowe połączenia, które inne serwery nie wiedzieć o.</span><span class="sxs-lookup"><span data-stu-id="1f0bb-122">Add a server, and it gets new connections that the other servers don't know about.</span></span> <span data-ttu-id="1f0bb-123">Na przykład SignalR na każdym serwerze, na poniższym diagramie nie rozpoznaje połączeń na innych serwerach.</span><span class="sxs-lookup"><span data-stu-id="1f0bb-123">For example, SignalR on each server in the following diagram is unaware of the connections on the other servers.</span></span> <span data-ttu-id="1f0bb-124">Gdy SignalR na jednym z serwerów chce wysłać wiadomość do wszystkich klientów, komunikat prowadzi tylko klientów podłączonych do tego serwera.</span><span class="sxs-lookup"><span data-stu-id="1f0bb-124">When SignalR on one of the servers wants to send a message to all clients, the message only goes to the clients connected to that server.</span></span>

![Skalowanie SignalR bez płyty montażowej](scale/_static/scale-no-backplane.png)

<span data-ttu-id="1f0bb-126">Opcje dotyczące rozwiązywania tego problemu są [usługi Azure SignalR Service](#azure-signalr-service) i [Redis płyty montażowej](#redis-backplane).</span><span class="sxs-lookup"><span data-stu-id="1f0bb-126">The options for solving this problem are the [Azure SignalR Service](#azure-signalr-service) and [Redis backplane](#redis-backplane).</span></span>

## <a name="azure-signalr-service"></a><span data-ttu-id="1f0bb-127">Usługa Azure SignalR Service</span><span class="sxs-lookup"><span data-stu-id="1f0bb-127">Azure SignalR Service</span></span>

<span data-ttu-id="1f0bb-128">Usługa Azure SignalR Service to serwer proxy, a nie jako płyty montażowej.</span><span class="sxs-lookup"><span data-stu-id="1f0bb-128">The Azure SignalR Service is a proxy rather than a backplane.</span></span> <span data-ttu-id="1f0bb-129">Każdorazowo, klient inicjuje połączenie z serwerem, klient zostanie przekierowany do połączenia z usługą.</span><span class="sxs-lookup"><span data-stu-id="1f0bb-129">Each time a client initiates a connection to the server, the client is redirected to connect to the service.</span></span> <span data-ttu-id="1f0bb-130">Ten proces jest zilustrowany na poniższym diagramie:</span><span class="sxs-lookup"><span data-stu-id="1f0bb-130">That process is illustrated in the following diagram:</span></span>

![Nawiązywania połączenia z usługi Azure SignalR Service](scale/_static/azure-signalr-service-one-connection.png)

<span data-ttu-id="1f0bb-132">Wynik jest, że usługa zarządza wszystkich połączeń klienta, a każdy serwer wymaga tylko niewielka liczba stałej połączenia z usługą, jak pokazano na poniższym diagramie:</span><span class="sxs-lookup"><span data-stu-id="1f0bb-132">The result is that the service manages all of the client connections, while each server needs only a small constant number of connections to the service, as shown in the following diagram:</span></span>

![Klienci połączeni z usługą serwerów połączonych z usługą](scale/_static/azure-signalr-service-multiple-connections.png)

<span data-ttu-id="1f0bb-134">Takie podejście do skalowania w poziomie ma kilka zalet nad alternatywą płyty montażowej Redis:</span><span class="sxs-lookup"><span data-stu-id="1f0bb-134">This approach to scale-out has several advantages over the Redis backplane alternative:</span></span>

* <span data-ttu-id="1f0bb-135">Trwałych sesji, nazywana również [koligacja klienta](/iis/extensions/configuring-application-request-routing-arr/http-load-balancing-using-application-request-routing#step-3---configure-client-affinity), nie jest wymagana, ponieważ klienci są przekierowywani bezpośrednio do usługi Azure SignalR Service podczas nawiązywania połączenia.</span><span class="sxs-lookup"><span data-stu-id="1f0bb-135">Sticky sessions, also known as [client affinity](/iis/extensions/configuring-application-request-routing-arr/http-load-balancing-using-application-request-routing#step-3---configure-client-affinity), is not required, because clients are immediately redirected to the Azure SignalR Service when they connect.</span></span>
* <span data-ttu-id="1f0bb-136">SignalR, którą można skalować aplikacji na podstawie liczby wiadomości wysyłanych, gdy usługa Azure SignalR Service automatycznie skaluje się do obsługi dowolnej liczby połączeń.</span><span class="sxs-lookup"><span data-stu-id="1f0bb-136">A SignalR app can scale out based on the number of messages sent, while the Azure SignalR Service automatically scales to handle any number of connections.</span></span> <span data-ttu-id="1f0bb-137">Na przykład może być tysiące klientów, ale jeśli tylko kilka komunikatów na sekundę są wysyłane, nie będzie już konieczne aplikacji SignalR, skalowanie w poziomie do wielu serwerów, tylko do obsługi połączeń, samodzielnie.</span><span class="sxs-lookup"><span data-stu-id="1f0bb-137">For example, there could be thousands of clients, but if only a few messages per second are sent, the SignalR app won't need to scale out to multiple servers just to handle the connections themselves.</span></span>
* <span data-ttu-id="1f0bb-138">Aplikacji SignalR nie będzie używać znacznie więcej zasobów połączenia niż aplikacji sieci web bez SignalR.</span><span class="sxs-lookup"><span data-stu-id="1f0bb-138">A SignalR app won't use significantly more connection resources than a web app without SignalR.</span></span>

<span data-ttu-id="1f0bb-139">Z tego względu zalecamy Azure SignalR Service dla wszystkich aplikacji biblioteki SignalR platformy ASP.NET Core hostowanej na platformie Azure, w tym usługi App Service, maszyny wirtualne i kontenery.</span><span class="sxs-lookup"><span data-stu-id="1f0bb-139">For these reasons, we recommend the Azure SignalR Service for all ASP.NET Core SignalR apps hosted on Azure, including App Service, VMs, and containers.</span></span>

<span data-ttu-id="1f0bb-140">Aby uzyskać więcej informacji, zobacz [dokumentacji usługi Azure SignalR Service](/azure/azure-signalr/signalr-overview).</span><span class="sxs-lookup"><span data-stu-id="1f0bb-140">For more information see the [Azure SignalR Service documentation](/azure/azure-signalr/signalr-overview).</span></span>

## <a name="redis-backplane"></a><span data-ttu-id="1f0bb-141">Płyta montażowa Redis</span><span class="sxs-lookup"><span data-stu-id="1f0bb-141">Redis backplane</span></span>

<span data-ttu-id="1f0bb-142">[Redis](https://redis.io/) jest parach klucz wartość w pamięci, który obsługuje system obsługi komunikatów za pomocą modelu publikowania/subskrybowania.</span><span class="sxs-lookup"><span data-stu-id="1f0bb-142">[Redis](https://redis.io/) is an in-memory key-value store that supports a messaging system with a publish/subscribe model.</span></span> <span data-ttu-id="1f0bb-143">Płyty montażowej Redis w SignalR używa funkcji publikowania/subskrybowania do przekazywania wiadomości na inne serwery.</span><span class="sxs-lookup"><span data-stu-id="1f0bb-143">The SignalR Redis backplane uses the pub/sub feature to forward messages to other servers.</span></span> <span data-ttu-id="1f0bb-144">Gdy klient nawiązuje połączenie, informacje o połączeniu są przekazywane do systemu backplane.</span><span class="sxs-lookup"><span data-stu-id="1f0bb-144">When a client makes a connection, the connection information is passed to the backplane.</span></span> <span data-ttu-id="1f0bb-145">Gdy serwer chce, aby wysłać wiadomość do wszystkich klientów, wysyła do systemu backplane.</span><span class="sxs-lookup"><span data-stu-id="1f0bb-145">When a server wants to send a message to all clients, it sends to the backplane.</span></span> <span data-ttu-id="1f0bb-146">Systemu backplane zna wszystkich podłączonych klientów, które serwery są włączone.</span><span class="sxs-lookup"><span data-stu-id="1f0bb-146">The backplane knows all connected clients and which servers they're on.</span></span> <span data-ttu-id="1f0bb-147">Wysyła wiadomość do wszystkich klientów za pośrednictwem ich odpowiednich serwerów.</span><span class="sxs-lookup"><span data-stu-id="1f0bb-147">It sends the message to all clients via their respective servers.</span></span> <span data-ttu-id="1f0bb-148">Ten proces jest zilustrowany na poniższym diagramie:</span><span class="sxs-lookup"><span data-stu-id="1f0bb-148">This process is illustrated in the following diagram:</span></span>

![Redis płyty montażowej, komunikatu wysłanego z jednego serwera do wszystkich klientów](scale/_static/redis-backplane.png)

<span data-ttu-id="1f0bb-150">Płyty montażowej Redis jest zalecanym podejściem skalowalnego w poziomie dla aplikacji hostowanych w ramach swojej własnej infrastruktury.</span><span class="sxs-lookup"><span data-stu-id="1f0bb-150">The Redis backplane is the recommended scale-out approach for apps hosted on your own infrastructure.</span></span> <span data-ttu-id="1f0bb-151">Usługi Azure SignalR Service jest praktyczny dotycząca użycia w środowisku produkcyjnym za pomocą aplikacji w środowisku lokalnym, ze względu na czas oczekiwania na połączenie między centrum danych a centrum danych platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="1f0bb-151">Azure SignalR Service isn't a practical option for production use with on-premises apps due to connection latency between your data center and an Azure data center.</span></span>

<span data-ttu-id="1f0bb-152">Zalety usługi Azure SignalR Service zanotowanej wcześniej są wady płyty montażowej Redis:</span><span class="sxs-lookup"><span data-stu-id="1f0bb-152">The Azure SignalR Service advantages noted earlier are disadvantages for the Redis backplane:</span></span>

* <span data-ttu-id="1f0bb-153">Trwałych sesji, nazywana również [koligacja klienta](/iis/extensions/configuring-application-request-routing-arr/http-load-balancing-using-application-request-routing#step-3---configure-client-affinity), jest wymagana.</span><span class="sxs-lookup"><span data-stu-id="1f0bb-153">Sticky sessions, also known as [client affinity](/iis/extensions/configuring-application-request-routing-arr/http-load-balancing-using-application-request-routing#step-3---configure-client-affinity), is required.</span></span> <span data-ttu-id="1f0bb-154">Po zainicjowaniu połączenia na serwerze, połączenie musi pozostać na tym serwerze.</span><span class="sxs-lookup"><span data-stu-id="1f0bb-154">Once a connection is initiated on a server, the connection has to stay on that server.</span></span>
* <span data-ttu-id="1f0bb-155">Aplikacji SignalR musisz skalować w poziomie na podstawie liczby klientów, nawet wtedy, gdy kilka komunikaty są wysyłane.</span><span class="sxs-lookup"><span data-stu-id="1f0bb-155">A SignalR app must scale out based on number of clients even if few messages are being sent.</span></span>
* <span data-ttu-id="1f0bb-156">Aplikacji SignalR zużywa znacznie więcej zasobów połączenia niż aplikacji sieci web bez SignalR.</span><span class="sxs-lookup"><span data-stu-id="1f0bb-156">A SignalR app uses significantly more connection resources than a web app without SignalR.</span></span>

## <a name="next-steps"></a><span data-ttu-id="1f0bb-157">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="1f0bb-157">Next steps</span></span>

<span data-ttu-id="1f0bb-158">Aby uzyskać więcej informacji, zobacz następujące zasoby:</span><span class="sxs-lookup"><span data-stu-id="1f0bb-158">For more information, see the following resources:</span></span>

* [<span data-ttu-id="1f0bb-159">Dokumentacja usługi Azure SignalR Service</span><span class="sxs-lookup"><span data-stu-id="1f0bb-159">Azure SignalR Service documentation</span></span>](/azure/azure-signalr/signalr-overview)
* [<span data-ttu-id="1f0bb-160">Konfigurowanie montażowa pamięci podręcznej Redis</span><span class="sxs-lookup"><span data-stu-id="1f0bb-160">Set up a Redis backplane</span></span>](xref:signalr/redis-backplane)
